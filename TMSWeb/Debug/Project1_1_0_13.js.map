)]}'
{"version":3,"file":"Project1_1_0_13.js","sources":["../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/tms_1_0_13.js","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/rtl_1_0_13.js","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/system.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/rtlconsts.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/types.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/js.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/sysutils.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/typinfo.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/web.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/p2jsres.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/simplelinkedlist.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/classes.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.Menus.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.Controls.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.Graphics.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.WebCtrls.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.Consts.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.Dialogs.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/math.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.Utils.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.WebTools.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/contnrs.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.Modules.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.Lang.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.JSON.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.ClientConnector.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/RTL/Rtl.BrowserLoadHelper.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.Forms.pas","../../../../../../../AppData/Local/tmssoftware/registered/TMS WEB Core RSXE12/Core Source/WEBLib.StdCtrls.pas","../../Unit1.pas","../../Project1.dpr"],"sourcesContent":["//***********************************************************************************\r\n// TMS WEB CORE framework code is copyright (c) 2018 - 2021 by tmssoftware.com bvba\r\n// The code or parts of the code cannot be used in any way outside \r\n// a TMS WEB Core application generated by a licensed user or company.\r\n//***********************************************************************************\r\n","var pas = { $libimports: {}};\r\n\r\nvar rtl = {\r\n\r\n  version: 20301,\r\n\r\n  quiet: false,\r\n  debug_load_units: false,\r\n  debug_rtti: false,\r\n\r\n  $res : {},\r\n\r\n  debug: function(){\r\n    if (rtl.quiet || !console || !console.log) return;\r\n    console.log(arguments);\r\n  },\r\n\r\n  error: function(s){\r\n    rtl.debug('Error: ',s);\r\n    throw s;\r\n  },\r\n\r\n  warn: function(s){\r\n    rtl.debug('Warn: ',s);\r\n  },\r\n\r\n  checkVersion: function(v){\r\n    if (rtl.version != v) throw \"expected rtl version \"+v+\", but found \"+rtl.version;\r\n  },\r\n\r\n  hiInt: Math.pow(2,53),\r\n\r\n  hasString: function(s){\r\n    return rtl.isString(s) && (s.length>0);\r\n  },\r\n\r\n  isArray: function(a) {\r\n    return Array.isArray(a);\r\n  },\r\n\r\n  isFunction: function(f){\r\n    return typeof(f)===\"function\";\r\n  },\r\n\r\n  isModule: function(m){\r\n    return rtl.isObject(m) && rtl.hasString(m.$name) && (pas[m.$name]===m);\r\n  },\r\n\r\n  isImplementation: function(m){\r\n    return rtl.isObject(m) && rtl.isModule(m.$module) && (m.$module.$impl===m);\r\n  },\r\n\r\n  isNumber: function(n){\r\n    return typeof(n)===\"number\";\r\n  },\r\n\r\n  isObject: function(o){\r\n    var s=typeof(o);\r\n    return (typeof(o)===\"object\") && (o!=null);\r\n  },\r\n\r\n  isString: function(s){\r\n    return typeof(s)===\"string\";\r\n  },\r\n\r\n  getNumber: function(n){\r\n    return typeof(n)===\"number\"?n:NaN;\r\n  },\r\n\r\n  getChar: function(c){\r\n    return ((typeof(c)===\"string\") && (c.length===1)) ? c : \"\";\r\n  },\r\n\r\n  getObject: function(o){\r\n    return ((typeof(o)===\"object\") || (typeof(o)==='function')) ? o : null;\r\n  },\r\n\r\n  isTRecord: function(type){\r\n    return (rtl.isObject(type) && type.hasOwnProperty('$new') && (typeof(type.$new)==='function'));\r\n  },\r\n\r\n  isPasClass: function(type){\r\n    return (rtl.isObject(type) && type.hasOwnProperty('$classname') && rtl.isObject(type.$module));\r\n  },\r\n\r\n  isPasClassInstance: function(type){\r\n    return (rtl.isObject(type) && rtl.isPasClass(type.$class));\r\n  },\r\n\r\n  hexStr: function(n,digits){\r\n    return (\"000000000000000\"+n.toString(16).toUpperCase()).slice(-digits);\r\n  },\r\n\r\n  m_loading: 0,\r\n  m_loading_intf: 1,\r\n  m_intf_loaded: 2,\r\n  m_loading_impl: 3, // loading all used unit\r\n  m_initializing: 4, // running initialization\r\n  m_initialized: 5,\r\n\r\n  module: function(module_name, intfuseslist, intfcode, impluseslist){\r\n    if (rtl.debug_load_units) rtl.debug('rtl.module name=\"'+module_name+'\" intfuses='+intfuseslist+' impluses='+impluseslist);\r\n    if (!rtl.hasString(module_name)) rtl.error('invalid module name \"'+module_name+'\"');\r\n    if (!rtl.isArray(intfuseslist)) rtl.error('invalid interface useslist of \"'+module_name+'\"');\r\n    if (!rtl.isFunction(intfcode)) rtl.error('invalid interface code of \"'+module_name+'\"');\r\n    if (!(impluseslist==undefined) && !rtl.isArray(impluseslist)) rtl.error('invalid implementation useslist of \"'+module_name+'\"');\r\n\r\n    if (pas[module_name])\r\n      rtl.error('module \"'+module_name+'\" is already registered');\r\n\r\n    var r = Object.create(rtl.tSectionRTTI);\r\n    var module = r.$module = pas[module_name] = {\r\n      $name: module_name,\r\n      $intfuseslist: intfuseslist,\r\n      $impluseslist: impluseslist,\r\n      $state: rtl.m_loading,\r\n      $intfcode: intfcode,\r\n      $implcode: null,\r\n      $impl: null,\r\n      $rtti: r\r\n    };\r\n    if (impluseslist) module.$impl = {\r\n          $module: module,\r\n          $rtti: r\r\n        };\r\n  },\r\n\r\n  exitcode: 0,\r\n\r\n  run: function(module_name){\r\n    try {\r\n      if (!rtl.hasString(module_name)) module_name='program';\r\n      if (rtl.debug_load_units) rtl.debug('rtl.run module=\"'+module_name+'\"');\r\n      rtl.initRTTI();\r\n      var module = pas[module_name];\r\n      if (!module) rtl.error('rtl.run module \"'+module_name+'\" missing');\r\n      rtl.loadintf(module);\r\n      rtl.loadimpl(module);\r\n      if ((module_name=='program') || (module_name=='library')){\r\n        if (rtl.debug_load_units) rtl.debug('running $main');\r\n        var r = pas[module_name].$main();\r\n        if (rtl.isNumber(r)) rtl.exitcode = r;\r\n      }\r\n    } catch(re) {\r\n      if (!rtl.showUncaughtExceptions) {\r\n        throw re\r\n      } else {  \r\n        if (!rtl.handleUncaughtException(re)) {\r\n          rtl.showException(re);\r\n          rtl.exitcode = 216;\r\n        }  \r\n      }\r\n    } \r\n    return rtl.exitcode;\r\n  },\r\n  \r\n  showException : function (re) {\r\n    var errMsg = rtl.hasString(re.$classname) ? re.$classname : '';\r\n    errMsg +=  ((errMsg) ? ': ' : '') + (re.hasOwnProperty('fMessage') ? re.fMessage : re);\r\n    alert('Uncaught Exception : '+errMsg);\r\n  },\r\n\r\n  handleUncaughtException: function (e) {\r\n    if (rtl.onUncaughtException) {\r\n      try {\r\n        rtl.onUncaughtException(e);\r\n        return true;\r\n      } catch (ee) {\r\n        return false; \r\n      }\r\n    } else {\r\n      return false;\r\n    }\r\n  },\r\n\r\n  loadintf: function(module){\r\n    if (module.$state>rtl.m_loading_intf) return; // already finished\r\n    if (rtl.debug_load_units) rtl.debug('loadintf: \"'+module.$name+'\"');\r\n    if (module.$state===rtl.m_loading_intf)\r\n      rtl.error('unit cycle detected \"'+module.$name+'\"');\r\n    module.$state=rtl.m_loading_intf;\r\n    // load interfaces of interface useslist\r\n    rtl.loaduseslist(module,module.$intfuseslist,rtl.loadintf);\r\n    // run interface\r\n    if (rtl.debug_load_units) rtl.debug('loadintf: run intf of \"'+module.$name+'\"');\r\n    module.$intfcode(module.$intfuseslist);\r\n    // success\r\n    module.$state=rtl.m_intf_loaded;\r\n    // Note: units only used in implementations are not yet loaded (not even their interfaces)\r\n  },\r\n\r\n  loaduseslist: function(module,useslist,f){\r\n    if (useslist==undefined) return;\r\n    var len = useslist.length;\r\n    for (var i = 0; i<len; i++) {\r\n      var unitname=useslist[i];\r\n      if (rtl.debug_load_units) rtl.debug('loaduseslist of \"'+module.$name+'\" uses=\"'+unitname+'\"');\r\n      if (pas[unitname]==undefined)\r\n        rtl.error('module \"'+module.$name+'\" misses \"'+unitname+'\"');\r\n      f(pas[unitname]);\r\n    }\r\n  },\r\n\r\n  loadimpl: function(module){\r\n    if (module.$state>=rtl.m_loading_impl) return; // already processing\r\n    if (module.$state<rtl.m_intf_loaded) rtl.error('loadimpl: interface not loaded of \"'+module.$name+'\"');\r\n    if (rtl.debug_load_units) rtl.debug('loadimpl: load uses of \"'+module.$name+'\"');\r\n    module.$state=rtl.m_loading_impl;\r\n    // load interfaces of implementation useslist\r\n    rtl.loaduseslist(module,module.$impluseslist,rtl.loadintf);\r\n    // load implementation of interfaces useslist\r\n    rtl.loaduseslist(module,module.$intfuseslist,rtl.loadimpl);\r\n    // load implementation of implementation useslist\r\n    rtl.loaduseslist(module,module.$impluseslist,rtl.loadimpl);\r\n    // Note: At this point all interfaces used by this unit are loaded. If\r\n    //   there are implementation uses cycles some used units might not yet be\r\n    //   initialized. This is by design.\r\n    // run implementation\r\n    if (rtl.debug_load_units) rtl.debug('loadimpl: run impl of \"'+module.$name+'\"');\r\n    if (rtl.isFunction(module.$implcode)) module.$implcode(module.$impluseslist);\r\n    // run initialization\r\n    if (rtl.debug_load_units) rtl.debug('loadimpl: run init of \"'+module.$name+'\"');\r\n    module.$state=rtl.m_initializing;\r\n    if (rtl.isFunction(module.$init)) module.$init();\r\n    // unit initialized\r\n    module.$state=rtl.m_initialized;\r\n  },\r\n\r\n  createCallback: function(scope, fn){\r\n    var cb;\r\n    if (typeof(fn)==='string'){\r\n      if (!scope.hasOwnProperty('$events')) scope.$events = {};\r\n      cb = scope.$events[fn];\r\n      if (cb) return cb;\r\n      scope.$events[fn] = cb = function(){\r\n        return scope[fn].apply(scope,arguments);\r\n      };\r\n    } else {\r\n      cb = function(){\r\n        return fn.apply(scope,arguments);\r\n      };\r\n    };\r\n    cb.scope = scope;\r\n    cb.fn = fn;\r\n    return cb;\r\n  },\r\n\r\n  createSafeCallback: function(scope, fn){\r\n    var cb;\r\n    if (typeof(fn)==='string'){\r\n      if (!scope.hasOwnProperty('$events')) scope.$events = {};\r\n      cb = scope.$events[fn];\r\n      if (cb) return cb;\r\n      scope.$events[fn] = cb = function(){\r\n        try{\r\n          return scope[fn].apply(scope,arguments);\r\n        } catch (err) {\r\n          if (!rtl.handleUncaughtException(err)) throw err;\r\n        }\r\n      };\r\n    } else {\r\n      cb = function(){\r\n        try{\r\n          return fn.apply(scope,arguments);\r\n        } catch (err) {\r\n          if (!rtl.handleUncaughtException(err)) throw err;\r\n        }\r\n      };\r\n    };\r\n    cb.scope = scope;\r\n    cb.fn = fn;\r\n    return cb;\r\n  },\r\n\r\n  eqCallback: function(a,b){\r\n    // can be a function or a function wrapper\r\n    if (a===b){\r\n      return true;\r\n    } else {\r\n      return (a!=null) && (b!=null) && (a.fn) && (a.scope===b.scope) && (a.fn===b.fn);\r\n    }\r\n  },\r\n\r\n  initStruct: function(c,parent,name){\r\n    if ((parent.$module) && (parent.$module.$impl===parent)) parent=parent.$module;\r\n    c.$parent = parent;\r\n    if (rtl.isModule(parent)){\r\n      c.$module = parent;\r\n      c.$name = name;\r\n    } else {\r\n      c.$module = parent.$module;\r\n      c.$name = parent.$name+'.'+name;\r\n    };\r\n    return parent;\r\n  },\r\n\r\n  initClass: function(c,parent,name,initfn,rttiname){\r\n    parent[name] = c;\r\n    c.$class = c; // Note: o.$class === Object.getPrototypeOf(o)\r\n    c.$classname = rttiname?rttiname:name;\r\n    parent = rtl.initStruct(c,parent,name);\r\n    c.$fullname = parent.$name+'.'+name;\r\n    // rtti\r\n    if (rtl.debug_rtti) rtl.debug('initClass '+c.$fullname);\r\n    var t = c.$module.$rtti.$Class(c.$classname,{ \"class\": c });\r\n    c.$rtti = t;\r\n    if (rtl.isObject(c.$ancestor)) t.ancestor = c.$ancestor.$rtti;\r\n    if (!t.ancestor) t.ancestor = null;\r\n    // init members\r\n    initfn.call(c);\r\n  },\r\n\r\n  createClass: function(parent,name,ancestor,initfn,rttiname){\r\n    // create a normal class,\r\n    // ancestor must be null or a normal class,\r\n    // the root ancestor can be an external class\r\n    var c = null;\r\n    if (ancestor != null){\r\n      c = Object.create(ancestor);\r\n      c.$ancestor = ancestor;\r\n      // Note:\r\n      // if root is an \"object\" then c.$ancestor === Object.getPrototypeOf(c)\r\n      // if root is a \"function\" then c.$ancestor === c.__proto__, Object.getPrototypeOf(c) returns the root\r\n    } else {\r\n      c = { $ancestor: null };\r\n      c.$create = function(fn,args){\r\n        if (args == undefined) args = [];\r\n        var o = Object.create(this);\r\n        o.$init();\r\n        try{\r\n          if (typeof(fn)===\"string\"){\r\n            o[fn].apply(o,args);\r\n          } else {\r\n            fn.apply(o,args);\r\n          };\r\n          o.AfterConstruction();\r\n        } catch($e){\r\n          // do not call BeforeDestruction\r\n          if (o.Destroy) o.Destroy();\r\n          o.$final();\r\n          throw $e;\r\n        }\r\n        return o;\r\n      };\r\n      c.$destroy = function(fnname){\r\n        this.BeforeDestruction();\r\n        if (this[fnname]) this[fnname]();\r\n        this.$final();\r\n      };\r\n    };\r\n    rtl.initClass(c,parent,name,initfn,rttiname);\r\n  },\r\n\r\n  createClassExt: function(parent,name,ancestor,newinstancefnname,initfn,rttiname){\r\n    // Create a class using an external ancestor.\r\n    // If newinstancefnname is given, use that function to create the new object.\r\n    // If exist call BeforeDestruction and AfterConstruction.\r\n    var isFunc = rtl.isFunction(ancestor);\r\n    var c = null;\r\n    if (isFunc){\r\n      // create pascal class descendent from JS function\r\n      c = Object.create(ancestor.prototype);\r\n      c.$ancestorfunc = ancestor;\r\n      c.$ancestor = null; // no pascal ancestor\r\n    } else if (ancestor.$func){\r\n      // create pascal class descendent from a pascal class descendent of a JS function\r\n      isFunc = true;\r\n      c = Object.create(ancestor);\r\n      c.$ancestor = ancestor;\r\n    } else {\r\n      c = Object.create(ancestor);\r\n      c.$ancestor = null; // no pascal ancestor\r\n    }\r\n    c.$create = function(fn,args){\r\n      if (args == undefined) args = [];\r\n      var o = null;\r\n      if (newinstancefnname.length>0){\r\n        o = this[newinstancefnname](fn,args);\r\n      } else if(isFunc) {\r\n        o = new this.$func(args);\r\n      } else {\r\n        o = Object.create(c);\r\n      }\r\n      if (o.$init) o.$init();\r\n      try{\r\n        if (typeof(fn)===\"string\"){\r\n          this[fn].apply(o,args);\r\n        } else {\r\n          fn.apply(o,args);\r\n        };\r\n        if (o.AfterConstruction) o.AfterConstruction();\r\n      } catch($e){\r\n        // do not call BeforeDestruction\r\n        if (o.Destroy) o.Destroy();\r\n        if (o.$final) o.$final();\r\n        throw $e;\r\n      }\r\n      return o;\r\n    };\r\n    c.$destroy = function(fnname){\r\n      if (this.BeforeDestruction) this.BeforeDestruction();\r\n      if (this[fnname]) this[fnname]();\r\n      if (this.$final) this.$final();\r\n    };\r\n    rtl.initClass(c,parent,name,initfn,rttiname);\r\n    if (isFunc){\r\n      function f(){}\r\n      f.prototype = c;\r\n      c.$func = f;\r\n    }\r\n  },\r\n\r\n  createHelper: function(parent,name,ancestor,initfn,rttiname){\r\n    // create a helper,\r\n    // ancestor must be null or a helper,\r\n    var c = null;\r\n    if (ancestor != null){\r\n      c = Object.create(ancestor);\r\n      c.$ancestor = ancestor;\r\n      // c.$ancestor === Object.getPrototypeOf(c)\r\n    } else {\r\n      c = { $ancestor: null };\r\n    };\r\n    parent[name] = c;\r\n    c.$class = c; // Note: o.$class === Object.getPrototypeOf(o)\r\n    c.$classname = rttiname?rttiname:name;\r\n    parent = rtl.initStruct(c,parent,name);\r\n    c.$fullname = parent.$name+'.'+name;\r\n    // rtti\r\n    var t = c.$module.$rtti.$Helper(c.$classname,{ \"helper\": c });\r\n    c.$rtti = t;\r\n    if (rtl.isObject(ancestor)) t.ancestor = ancestor.$rtti;\r\n    if (!t.ancestor) t.ancestor = null;\r\n    // init members\r\n    initfn.call(c);\r\n  },\r\n\r\n  tObjectDestroy: \"Destroy\",\r\n\r\n  free: function(obj,name){\r\n    if (obj[name]==null) return null;\r\n    obj[name].$destroy(rtl.tObjectDestroy);\r\n    obj[name]=null;\r\n  },\r\n\r\n  freeLoc: function(obj){\r\n    if (obj==null) return null;\r\n    obj.$destroy(rtl.tObjectDestroy);\r\n    return null;\r\n  },\r\n\r\n  hideProp: function(o,p,v){\r\n    Object.defineProperty(o,p, {\r\n      enumerable: false,\r\n      configurable: true,\r\n      writable: true\r\n    });\r\n    if(arguments.length>2){ o[p]=v; }\r\n  },\r\n\r\n  recNewT: function(parent,name,initfn,full){\r\n    // create new record type\r\n    var t = {};\r\n    if (parent) parent[name] = t;\r\n    var h = rtl.hideProp;\r\n    if (full){\r\n      rtl.initStruct(t,parent,name);\r\n      t.$record = t;\r\n      h(t,'$record');\r\n      h(t,'$name');\r\n      h(t,'$parent');\r\n      h(t,'$module');\r\n      h(t,'$initSpec');\r\n    }\r\n    initfn.call(t);\r\n    if (!t.$new){\r\n      t.$new = function(){ return Object.create(t); };\r\n    }\r\n    t.$clone = function(r){ return t.$new().$assign(r); };\r\n    h(t,'$new');\r\n    h(t,'$clone');\r\n    h(t,'$eq');\r\n    h(t,'$assign');\r\n    return t;\r\n  },\r\n\r\n  is: function(instance,type){\r\n    return type.isPrototypeOf(instance) || (instance===type);\r\n  },\r\n\r\n  isExt: function(instance,type,mode){\r\n    // mode===1 means instance must be a Pascal class instance\r\n    // mode===2 means instance must be a Pascal class\r\n    // Notes:\r\n    // isPrototypeOf and instanceof return false on equal\r\n    // isPrototypeOf does not work for Date.isPrototypeOf(new Date())\r\n    //   so if isPrototypeOf is false test with instanceof\r\n    // instanceof needs a function on right side\r\n    if (instance == null) return false; // Note: ==null checks for undefined too\r\n    if ((typeof(type) !== 'object') && (typeof(type) !== 'function')) return false;\r\n    if (instance === type){\r\n      if (mode===1) return false;\r\n      if (mode===2) return rtl.isPasClass(instance);\r\n      return true;\r\n    }\r\n    if (type.isPrototypeOf && type.isPrototypeOf(instance)){\r\n      if (mode===1) return rtl.isPasClassInstance(instance);\r\n      if (mode===2) return rtl.isPasClass(instance);\r\n      return true;\r\n    }\r\n    if ((typeof type == 'function') && (instance instanceof type)) return true;\r\n    return false;\r\n  },\r\n\r\n  Exception: null,\r\n  EInvalidCast: null,\r\n  EAbstractError: null,\r\n  ERangeError: null,\r\n  EIntOverflow: null,\r\n  EPropWriteOnly: null,\r\n\r\n  raiseE: function(typename){\r\n    var t = rtl[typename];\r\n    if (t==null){\r\n      var mod = pas.SysUtils;\r\n      if (!mod) mod = pas.sysutils;\r\n      if (mod){\r\n        t = mod[typename];\r\n        if (!t) t = mod[typename.toLowerCase()];\r\n        if (!t) t = mod['Exception'];\r\n        if (!t) t = mod['exception'];\r\n      }\r\n    }\r\n    if (t){\r\n      if (t.Create){\r\n        throw t.$create(\"Create\");\r\n      } else if (t.create){\r\n        throw t.$create(\"create\");\r\n      }\r\n    }\r\n    if (typename === \"EInvalidCast\") throw \"invalid type cast\";\r\n    if (typename === \"EAbstractError\") throw \"Abstract method called\";\r\n    if (typename === \"ERangeError\") throw \"range error\";\r\n    throw typename;\r\n  },\r\n\r\n  as: function(instance,type){\r\n    if((instance === null) || rtl.is(instance,type)) return instance;\r\n    rtl.raiseE(\"EInvalidCast\");\r\n  },\r\n\r\n  asExt: function(instance,type,mode){\r\n    if((instance === null) || rtl.isExt(instance,type,mode)) return instance;\r\n    rtl.raiseE(\"EInvalidCast\");\r\n  },\r\n\r\n  createInterface: function(module, name, guid, fnnames, ancestor, initfn){\r\n    //console.log('createInterface name=\"'+name+'\" guid=\"'+guid+'\" names='+fnnames);\r\n    var i = ancestor?Object.create(ancestor):{};\r\n    module[name] = i;\r\n    i.$module = module;\r\n    i.$name = name;\r\n    i.$fullname = module.$name+'.'+name;\r\n    i.$guid = guid;\r\n    i.$guidr = null;\r\n    i.$names = fnnames?fnnames:[];\r\n    if (rtl.isFunction(initfn)){\r\n      // rtti\r\n      if (rtl.debug_rtti) rtl.debug('createInterface '+i.$fullname);\r\n      var t = i.$module.$rtti.$Interface(name,{ \"interface\": i, module: module });\r\n      i.$rtti = t;\r\n      if (ancestor) t.ancestor = ancestor.$rtti;\r\n      if (!t.ancestor) t.ancestor = null;\r\n      initfn.call(i);\r\n    }\r\n    return i;\r\n  },\r\n\r\n  strToGUIDR: function(s,g){\r\n    var p = 0;\r\n    function n(l){\r\n      var h = s.substr(p,l);\r\n      p+=l;\r\n      return parseInt(h,16);\r\n    }\r\n    p+=1; // skip {\r\n    g.D1 = n(8);\r\n    p+=1; // skip -\r\n    g.D2 = n(4);\r\n    p+=1; // skip -\r\n    g.D3 = n(4);\r\n    p+=1; // skip -\r\n    if (!g.D4) g.D4=[];\r\n    g.D4[0] = n(2);\r\n    g.D4[1] = n(2);\r\n    p+=1; // skip -\r\n    for(var i=2; i<8; i++) g.D4[i] = n(2);\r\n    return g;\r\n  },\r\n\r\n  guidrToStr: function(g){\r\n    if (g.$intf) return g.$intf.$guid;\r\n    var h = rtl.hexStr;\r\n    var s='{'+h(g.D1,8)+'-'+h(g.D2,4)+'-'+h(g.D3,4)+'-'+h(g.D4[0],2)+h(g.D4[1],2)+'-';\r\n    for (var i=2; i<8; i++) s+=h(g.D4[i],2);\r\n    s+='}';\r\n    return s;\r\n  },\r\n\r\n  createTGUID: function(guid){\r\n    var TGuid = (pas.System)?pas.System.TGuid:pas.system.tguid;\r\n    var g = rtl.strToGUIDR(guid,TGuid.$new());\r\n    return g;\r\n  },\r\n\r\n  getIntfGUIDR: function(intfTypeOrVar){\r\n    if (!intfTypeOrVar) return null;\r\n    if (!intfTypeOrVar.$guidr){\r\n      var g = rtl.createTGUID(intfTypeOrVar.$guid);\r\n      if (!intfTypeOrVar.hasOwnProperty('$guid')) intfTypeOrVar = Object.getPrototypeOf(intfTypeOrVar);\r\n      g.$intf = intfTypeOrVar;\r\n      intfTypeOrVar.$guidr = g;\r\n    }\r\n    return intfTypeOrVar.$guidr;\r\n  },\r\n\r\n  addIntf: function (aclass, intf, map){\r\n    function jmp(fn){\r\n      if (typeof(fn)===\"function\"){\r\n        return function(){ return fn.apply(this.$o,arguments); };\r\n      } else {\r\n        return function(){ rtl.raiseE('EAbstractError'); };\r\n      }\r\n    }\r\n    if(!map) map = {};\r\n    var t = intf;\r\n    var item = Object.create(t);\r\n    if (!aclass.hasOwnProperty('$intfmaps')) aclass.$intfmaps = {};\r\n    aclass.$intfmaps[intf.$guid] = item;\r\n    do{\r\n      var names = t.$names;\r\n      if (!names) break;\r\n      for (var i=0; i<names.length; i++){\r\n        var intfname = names[i];\r\n        var fnname = map[intfname];\r\n        if (!fnname) fnname = intfname;\r\n        //console.log('addIntf: intftype='+t.$name+' index='+i+' intfname=\"'+intfname+'\" fnname=\"'+fnname+'\" old='+typeof(item[intfname]));\r\n        item[intfname] = jmp(aclass[fnname]);\r\n      }\r\n      t = Object.getPrototypeOf(t);\r\n    }while(t!=null);\r\n  },\r\n\r\n  getIntfG: function (obj, guid, query){\r\n    if (!obj) return null;\r\n    //console.log('getIntfG: obj='+obj.$classname+' guid='+guid+' query='+query);\r\n    // search\r\n    var maps = obj.$intfmaps;\r\n    if (!maps) return null;\r\n    var item = maps[guid];\r\n    if (!item) return null;\r\n    // check delegation\r\n    //console.log('getIntfG: obj='+obj.$classname+' guid='+guid+' query='+query+' item='+typeof(item));\r\n    if (typeof item === 'function') return item.call(obj); // delegate. Note: COM contains _AddRef\r\n    // check cache\r\n    var intf = null;\r\n    if (obj.$interfaces){\r\n      intf = obj.$interfaces[guid];\r\n      //console.log('getIntfG: obj='+obj.$classname+' guid='+guid+' cache='+typeof(intf));\r\n    }\r\n    if (!intf){ // intf can be undefined!\r\n      intf = Object.create(item);\r\n      intf.$o = obj;\r\n      if (!obj.$interfaces) obj.$interfaces = {};\r\n      obj.$interfaces[guid] = intf;\r\n    }\r\n    if (typeof(query)==='object'){\r\n      // called by queryIntfT\r\n      var o = null;\r\n      if (intf.QueryInterface(rtl.getIntfGUIDR(query),\r\n          {get:function(){ return o; }, set:function(v){ o=v; }}) === 0){\r\n        return o;\r\n      } else {\r\n        return null;\r\n      }\r\n    } else if(query===2){\r\n      // called by TObject.GetInterfaceByStr\r\n      if (intf.$kind === 'com') intf._AddRef();\r\n    }\r\n    return intf;\r\n  },\r\n\r\n  getIntfT: function(obj,intftype){\r\n    return rtl.getIntfG(obj,intftype.$guid);\r\n  },\r\n\r\n  queryIntfT: function(obj,intftype){\r\n    return rtl.getIntfG(obj,intftype.$guid,intftype);\r\n  },\r\n\r\n  queryIntfIsT: function(obj,intftype){\r\n    var i = rtl.getIntfG(obj,intftype.$guid);\r\n    if (!i) return false;\r\n    if (i.$kind === 'com') i._Release();\r\n    return true;\r\n  },\r\n\r\n  asIntfT: function (obj,intftype){\r\n    var i = rtl.getIntfG(obj,intftype.$guid);\r\n    if (i!==null) return i;\r\n    rtl.raiseEInvalidCast();\r\n  },\r\n\r\n  intfIsIntfT: function(intf,intftype){\r\n    return (intf!==null) && rtl.queryIntfIsT(intf.$o,intftype);\r\n  },\r\n\r\n  intfAsIntfT: function (intf,intftype){\r\n    if (!intf) return null;\r\n    var i = rtl.getIntfG(intf.$o,intftype.$guid);\r\n    if (i) return i;\r\n    rtl.raiseEInvalidCast();\r\n  },\r\n\r\n  intfIsClass: function(intf,classtype){\r\n    return (intf!=null) && (rtl.is(intf.$o,classtype));\r\n  },\r\n\r\n  intfAsClass: function(intf,classtype){\r\n    if (intf==null) return null;\r\n    return rtl.as(intf.$o,classtype);\r\n  },\r\n\r\n  intfToClass: function(intf,classtype){\r\n    if ((intf!==null) && rtl.is(intf.$o,classtype)) return intf.$o;\r\n    return null;\r\n  },\r\n\r\n  // interface reference counting\r\n  intfRefs: { // base object for temporary interface variables\r\n    ref: function(id,intf){\r\n      // called for temporary interface references needing delayed release\r\n      var old = this[id];\r\n      //console.log('rtl.intfRefs.ref: id='+id+' old=\"'+(old?old.$name:'null')+'\" intf=\"'+(intf?intf.$name:'null')+' $o='+(intf?intf.$o:'null'));\r\n      if (old){\r\n        // called again, e.g. in a loop\r\n        delete this[id];\r\n        old._Release(); // may fail\r\n      }\r\n      if(intf) {\r\n        this[id]=intf;\r\n      }\r\n      return intf;\r\n    },\r\n    free: function(){\r\n      //console.log('rtl.intfRefs.free...');\r\n      for (var id in this){\r\n        if (this.hasOwnProperty(id)){\r\n          var intf = this[id];\r\n          if (intf){\r\n            //console.log('rtl.intfRefs.free: id='+id+' '+intf.$name+' $o='+intf.$o.$classname);\r\n            intf._Release();\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  createIntfRefs: function(){\r\n    //console.log('rtl.createIntfRefs');\r\n    return Object.create(rtl.intfRefs);\r\n  },\r\n\r\n  setIntfP: function(path,name,value,skipAddRef){\r\n    var old = path[name];\r\n    //console.log('rtl.setIntfP path='+path+' name='+name+' old=\"'+(old?old.$name:'null')+'\" value=\"'+(value?value.$name:'null')+'\"');\r\n    if (old === value) return;\r\n    if (old !== null){\r\n      path[name]=null;\r\n      old._Release();\r\n    }\r\n    if (value !== null){\r\n      if (!skipAddRef) value._AddRef();\r\n      path[name]=value;\r\n    }\r\n  },\r\n\r\n  setIntfL: function(old,value,skipAddRef){\r\n    //console.log('rtl.setIntfL old=\"'+(old?old.$name:'null')+'\" value=\"'+(value?value.$name:'null')+'\"');\r\n    if (old !== value){\r\n      if (value!==null){\r\n        if (!skipAddRef) value._AddRef();\r\n      }\r\n      if (old!==null){\r\n        old._Release();  // Release after AddRef, to avoid double Release if Release creates an exception\r\n      }\r\n    } else if (skipAddRef){\r\n      if (old!==null){\r\n        old._Release();  // value has an AddRef\r\n      }\r\n    }\r\n    return value;\r\n  },\r\n\r\n  _AddRef: function(intf){\r\n    //if (intf) console.log('rtl._AddRef intf=\"'+(intf?intf.$name:'null')+'\"');\r\n    if (intf) intf._AddRef();\r\n    return intf;\r\n  },\r\n\r\n  _Release: function(intf){\r\n    //if (intf) console.log('rtl._Release intf=\"'+(intf?intf.$name:'null')+'\"');\r\n    if (intf) intf._Release();\r\n    return intf;\r\n  },\r\n\r\n  _ReleaseArray: function(a,dim){\r\n    if (!a) return null;\r\n    for (var i=0; i<a.length; i++){\r\n      if (dim<=1){\r\n        if (a[i]) a[i]._Release();\r\n      } else {\r\n        rtl._ReleaseArray(a[i],dim-1);\r\n      }\r\n    }\r\n    return null;\r\n  },\r\n\r\n  trunc: function(a){\r\n    return a<0 ? Math.ceil(a) : Math.floor(a);\r\n  },\r\n\r\n  checkMethodCall: function(obj,type){\r\n    if (rtl.isObject(obj) && rtl.is(obj,type)) return;\r\n    rtl.raiseE(\"EInvalidCast\");\r\n  },\r\n\r\n  oc: function(i){\r\n    // overflow check integer\r\n    if ((Math.floor(i)===i) && (i>=-0x1fffffffffffff) && (i<=0x1fffffffffffff)) return i;\r\n    rtl.raiseE('EIntOverflow');\r\n  },\r\n\r\n  rc: function(i,minval,maxval){\r\n    // range check integer\r\n    if ((Math.floor(i)===i) && (i>=minval) && (i<=maxval)) return i;\r\n    rtl.raiseE('ERangeError');\r\n  },\r\n\r\n  rcc: function(c,minval,maxval){\r\n    // range check char\r\n    if ((typeof(c)==='string') && (c.length===1)){\r\n      var i = c.charCodeAt(0);\r\n      if ((i>=minval) && (i<=maxval)) return c;\r\n    }\r\n    rtl.raiseE('ERangeError');\r\n  },\r\n\r\n  rcSetCharAt: function(s,index,c){\r\n    // range check setCharAt\r\n    if ((typeof(s)!=='string') || (index<0) || (index>=s.length)) rtl.raiseE('ERangeError');\r\n    return rtl.setCharAt(s,index,c);\r\n  },\r\n\r\n  rcCharAt: function(s,index){\r\n    // range check charAt\r\n    if ((typeof(s)!=='string') || (index<0) || (index>=s.length)) rtl.raiseE('ERangeError');\r\n    return s.charAt(index);\r\n  },\r\n\r\n  rcArrR: function(arr,index){\r\n    // range check read array\r\n    if (Array.isArray(arr) && (typeof(index)==='number') && (index>=0) && (index<arr.length)){\r\n      if (arguments.length>2){\r\n        // arr,index1,index2,...\r\n        arr=arr[index];\r\n        for (var i=2; i<arguments.length; i++) arr=rtl.rcArrR(arr,arguments[i]);\r\n        return arr;\r\n      }\r\n      return arr[index];\r\n    }\r\n    rtl.raiseE('ERangeError');\r\n  },\r\n\r\n  rcArrW: function(arr,index,value){\r\n    // range check write array\r\n    // arr,index1,index2,...,value\r\n    for (var i=3; i<arguments.length; i++){\r\n      arr=rtl.rcArrR(arr,index);\r\n      index=arguments[i-1];\r\n      value=arguments[i];\r\n    }\r\n    if (Array.isArray(arr) && (typeof(index)==='number') && (index>=0) && (index<arr.length)){\r\n      return arr[index]=value;\r\n    }\r\n    rtl.raiseE('ERangeError');\r\n  },\r\n\r\n  length: function(arr){\r\n    return (arr == null) ? 0 : arr.length;\r\n  },\r\n\r\n  arrayRef: function(a){\r\n    if (a!=null) rtl.hideProp(a,'$pas2jsrefcnt',1);\r\n    return a;\r\n  },\r\n\r\n  arraySetLength: function(arr,defaultvalue,newlength){\r\n    var stack = [];\r\n    var s = 9999;\r\n    for (var i=2; i<arguments.length; i++){\r\n      var j = arguments[i];\r\n      if (j==='s'){ s = i-2; }\r\n      else {\r\n        stack.push({ dim:j+0, a:null, i:0, src:null });\r\n      }\r\n    }\r\n    var dimmax = stack.length-1;\r\n    var depth = 0;\r\n    var lastlen = 0;\r\n    var item = null;\r\n    var a = null;\r\n    var src = arr;\r\n    var srclen = 0, oldlen = 0;\r\n    do{\r\n      if (depth>0){\r\n        item=stack[depth-1];\r\n        src = (item.src && item.src.length>item.i)?item.src[item.i]:null;\r\n      }\r\n      if (!src){\r\n        a = [];\r\n        srclen = 0;\r\n        oldlen = 0;\r\n      } else if (src.$pas2jsrefcnt>0 || depth>=s){\r\n        a = [];\r\n        srclen = src.length;\r\n        oldlen = srclen;\r\n      } else {\r\n        a = src;\r\n        srclen = 0;\r\n        oldlen = a.length;\r\n      }\r\n      lastlen = stack[depth].dim;\r\n      a.length = lastlen;\r\n      if (depth>0){\r\n        item.a[item.i]=a;\r\n        item.i++;\r\n        if ((lastlen===0) && (item.i<item.a.length)) continue;\r\n      }\r\n      if (lastlen>0){\r\n        if (depth<dimmax){\r\n          item = stack[depth];\r\n          item.a = a;\r\n          item.i = 0;\r\n          item.src = src;\r\n          depth++;\r\n          continue;\r\n        } else {\r\n          if (srclen>lastlen) srclen=lastlen;\r\n          if (rtl.isArray(defaultvalue)){\r\n            // array of dyn array\r\n            for (var i=0; i<srclen; i++) a[i]=src[i];\r\n            for (var i=oldlen; i<lastlen; i++) a[i]=[];\r\n          } else if (rtl.isObject(defaultvalue)) {\r\n            if (rtl.isTRecord(defaultvalue)){\r\n              // array of record\r\n              for (var i=0; i<srclen; i++) a[i]=defaultvalue.$clone(src[i]);\r\n              for (var i=oldlen; i<lastlen; i++) a[i]=defaultvalue.$new();\r\n            } else {\r\n              // array of set\r\n              for (var i=0; i<srclen; i++) a[i]=rtl.refSet(src[i]);\r\n              for (var i=oldlen; i<lastlen; i++) a[i]={};\r\n            }\r\n          } else {\r\n            for (var i=0; i<srclen; i++) a[i]=src[i];\r\n            for (var i=oldlen; i<lastlen; i++) a[i]=defaultvalue;\r\n          }\r\n        }\r\n      }\r\n      // backtrack\r\n      while ((depth>0) && (stack[depth-1].i>=stack[depth-1].dim)){\r\n        depth--;\r\n      };\r\n      if (depth===0){\r\n        if (dimmax===0) return a;\r\n        return stack[0].a;\r\n      }\r\n    }while (true);\r\n  },\r\n\r\n  arrayEq: function(a,b){\r\n    if (a===null) return b===null;\r\n    if (b===null) return false;\r\n    if (a.length!==b.length) return false;\r\n    for (var i=0; i<a.length; i++) if (a[i]!==b[i]) return false;\r\n    return true;\r\n  },\r\n\r\n  arrayClone: function(type,src,srcpos,endpos,dst,dstpos){\r\n    // type: 0 for references, \"refset\" for calling refSet(), a function for new type()\r\n    // src must not be null\r\n    // This function does not range check.\r\n    if(type === 'refSet') {\r\n      for (; srcpos<endpos; srcpos++) dst[dstpos++] = rtl.refSet(src[srcpos]); // ref set\r\n    } else if (type === 'slice'){\r\n      for (; srcpos<endpos; srcpos++) dst[dstpos++] = src[srcpos].slice(0); // clone static array of simple types\r\n    } else if (typeof(type)==='function'){\r\n      for (; srcpos<endpos; srcpos++) dst[dstpos++] = type(src[srcpos]); // clone function\r\n    } else if (rtl.isTRecord(type)){\r\n      for (; srcpos<endpos; srcpos++) dst[dstpos++] = type.$clone(src[srcpos]); // clone record\r\n    }  else {\r\n      for (; srcpos<endpos; srcpos++) dst[dstpos++] = src[srcpos]; // reference\r\n    };\r\n  },\r\n\r\n  arrayConcat: function(type){\r\n    // type: see rtl.arrayClone\r\n    var a = [];\r\n    var l = 0;\r\n    for (var i=1; i<arguments.length; i++){\r\n      var src = arguments[i];\r\n      if (src !== null) l+=src.length;\r\n    };\r\n    a.length = l;\r\n    l=0;\r\n    for (var i=1; i<arguments.length; i++){\r\n      var src = arguments[i];\r\n      if (src === null) continue;\r\n      rtl.arrayClone(type,src,0,src.length,a,l);\r\n      l+=src.length;\r\n    };\r\n    return a;\r\n  },\r\n\r\n  arrayConcatN: function(){\r\n    var a = null;\r\n    for (var i=0; i<arguments.length; i++){\r\n      var src = arguments[i];\r\n      if (src === null) continue;\r\n      if (a===null){\r\n        a=rtl.arrayRef(src); // Note: concat(a) does not clone\r\n      } else if (a['$pas2jsrefcnt']){\r\n        a=a.concat(src); // clone a and append src\r\n      } else {\r\n        for (var i=0; i<src.length; i++){\r\n          a.push(src[i]);\r\n        }\r\n      }\r\n    };\r\n    return a;\r\n  },\r\n\r\n  arrayPush: function(type,a){\r\n    if(a===null){\r\n      a=[];\r\n    } else if (a['$pas2jsrefcnt']){\r\n      a=rtl.arrayCopy(type,a,0,a.length);\r\n    }\r\n    rtl.arrayClone(type,arguments,2,arguments.length,a,a.length);\r\n    return a;\r\n  },\r\n\r\n  arrayPushN: function(a){\r\n    if(a===null){\r\n      a=[];\r\n    } else if (a['$pas2jsrefcnt']){\r\n      a=a.concat();\r\n    }\r\n    for (var i=1; i<arguments.length; i++){\r\n      a.push(arguments[i]);\r\n    }\r\n    return a;\r\n  },\r\n\r\n  arrayCopy: function(type, srcarray, index, count){\r\n    // type: see rtl.arrayClone\r\n    // if count is missing, use srcarray.length\r\n    if (srcarray === null) return [];\r\n    if (index < 0) index = 0;\r\n    if (count === undefined) count=srcarray.length;\r\n    var end = index+count;\r\n    if (end>srcarray.length) end = srcarray.length;\r\n    if (index>=end) return [];\r\n    if (type===0){\r\n      return srcarray.slice(index,end);\r\n    } else {\r\n      var a = [];\r\n      a.length = end-index;\r\n      rtl.arrayClone(type,srcarray,index,end,a,0);\r\n      return a;\r\n    }\r\n  },\r\n\r\n  arrayInsert: function(item, arr, index){\r\n    if (arr){\r\n      arr.splice(index,0,item);\r\n      return arr;\r\n    } else {\r\n      return [item];\r\n    }\r\n  },\r\n\r\n  setCharAt: function(s,index,c){\r\n    return s.substr(0,index)+c+s.substr(index+1);\r\n  },\r\n\r\n  getResStr: function(mod,name){\r\n    var rs = mod.$resourcestrings[name];\r\n    return rs.current?rs.current:rs.org;\r\n  },\r\n\r\n  createSet: function(){\r\n    var s = {};\r\n    for (var i=0; i<arguments.length; i++){\r\n      if (arguments[i]!=null){\r\n        s[arguments[i]]=true;\r\n      } else {\r\n        var first=arguments[i+=1];\r\n        var last=arguments[i+=1];\r\n        for(var j=first; j<=last; j++) s[j]=true;\r\n      }\r\n    }\r\n    return s;\r\n  },\r\n\r\n  cloneSet: function(s){\r\n    var r = {};\r\n    for (var key in s) r[key]=true;\r\n    return r;\r\n  },\r\n\r\n  refSet: function(s){\r\n    rtl.hideProp(s,'$shared',true);\r\n    return s;\r\n  },\r\n\r\n  includeSet: function(s,enumvalue){\r\n    if (s.$shared) s = rtl.cloneSet(s);\r\n    s[enumvalue] = true;\r\n    return s;\r\n  },\r\n\r\n  excludeSet: function(s,enumvalue){\r\n    if (s.$shared) s = rtl.cloneSet(s);\r\n    delete s[enumvalue];\r\n    return s;\r\n  },\r\n\r\n  diffSet: function(s,t){\r\n    var r = {};\r\n    for (var key in s) if (!t[key]) r[key]=true;\r\n    return r;\r\n  },\r\n\r\n  unionSet: function(s,t){\r\n    var r = {};\r\n    for (var key in s) r[key]=true;\r\n    for (var key in t) r[key]=true;\r\n    return r;\r\n  },\r\n\r\n  intersectSet: function(s,t){\r\n    var r = {};\r\n    for (var key in s) if (t[key]) r[key]=true;\r\n    return r;\r\n  },\r\n\r\n  symDiffSet: function(s,t){\r\n    var r = {};\r\n    for (var key in s) if (!t[key]) r[key]=true;\r\n    for (var key in t) if (!s[key]) r[key]=true;\r\n    return r;\r\n  },\r\n\r\n  eqSet: function(s,t){\r\n    for (var key in s) if (!t[key]) return false;\r\n    for (var key in t) if (!s[key]) return false;\r\n    return true;\r\n  },\r\n\r\n  neSet: function(s,t){\r\n    return !rtl.eqSet(s,t);\r\n  },\r\n\r\n  leSet: function(s,t){\r\n    for (var key in s) if (!t[key]) return false;\r\n    return true;\r\n  },\r\n\r\n  geSet: function(s,t){\r\n    for (var key in t) if (!s[key]) return false;\r\n    return true;\r\n  },\r\n\r\n  strSetLength: function(s,newlen){\r\n    var oldlen = s.length;\r\n    if (oldlen > newlen){\r\n      return s.substring(0,newlen);\r\n    } else if (s.repeat){\r\n      // Note: repeat needs ECMAScript6!\r\n      return s+' '.repeat(newlen-oldlen);\r\n    } else {\r\n       while (oldlen<newlen){\r\n         s+=' ';\r\n         oldlen++;\r\n       };\r\n       return s;\r\n    }\r\n  },\r\n\r\n  spaceLeft: function(s,width){\r\n    var l=s.length;\r\n    if (l>=width) return s;\r\n    if (s.repeat){\r\n      // Note: repeat needs ECMAScript6!\r\n      return ' '.repeat(width-l) + s;\r\n    } else {\r\n      while (l<width){\r\n        s=' '+s;\r\n        l++;\r\n      };\r\n      return s;\r\n    };\r\n  },\r\n\r\n  floatToStr: function(d,w,p){\r\n    // input 1-3 arguments: double, width, precision\r\n    if (arguments.length>2){\r\n      return rtl.spaceLeft(d.toFixed(p),w);\r\n    } else {\r\n\t  // exponent width\r\n\t  var pad = \"\";\r\n\t  var ad = Math.abs(d);\r\n\t  if (((ad>1) && (ad<1.0e+10)) ||  ((ad>1.e-10) && (ad<1))) {\r\n\t\tpad='00';\r\n\t  } else if ((ad>1) && (ad<1.0e+100) || (ad<1.e-10)) {\r\n\t\tpad='0';\r\n      }  \t\r\n\t  if (arguments.length<2) {\r\n\t    w=24;\t\t\r\n      } else if (w<9) {\r\n\t\tw=9;\r\n      }\t\t  \r\n      var p = w-8;\r\n      var s=(d>0 ? \" \" : \"\" ) + d.toExponential(p);\r\n      s=s.replace(/e(.)/,'E$1'+pad);\r\n      return rtl.spaceLeft(s,w);\r\n    }\r\n  },\r\n\r\n  valEnum: function(s, enumType, setCodeFn){\r\n    s = s.toLowerCase();\r\n    for (var key in enumType){\r\n      if((typeof(key)==='string') && (key.toLowerCase()===s)){\r\n        setCodeFn(0);\r\n        return enumType[key];\r\n      }\r\n    }\r\n    setCodeFn(1);\r\n    return 0;\r\n  },\r\n\r\n  lw: function(l){\r\n    // fix longword bitwise operation\r\n    return l<0?l+0x100000000:l;\r\n  },\r\n\r\n  and: function(a,b){\r\n    var hi = 0x80000000;\r\n    var low = 0x7fffffff;\r\n    var h = (a / hi) & (b / hi);\r\n    var l = (a & low) & (b & low);\r\n    return h*hi + l;\r\n  },\r\n\r\n  or: function(a,b){\r\n    var hi = 0x80000000;\r\n    var low = 0x7fffffff;\r\n    var h = (a / hi) | (b / hi);\r\n    var l = (a & low) | (b & low);\r\n    return h*hi + l;\r\n  },\r\n\r\n  xor: function(a,b){\r\n    var hi = 0x80000000;\r\n    var low = 0x7fffffff;\r\n    var h = (a / hi) ^ (b / hi);\r\n    var l = (a & low) ^ (b & low);\r\n    return h*hi + l;\r\n  },\r\n\r\n  shr: function(a,b){\r\n    if (a<0) a += rtl.hiInt;\r\n    if (a<0x80000000) return a >> b;\r\n    if (b<=0) return a;\r\n    if (b>54) return 0;\r\n    return Math.floor(a / Math.pow(2,b));\r\n  },\r\n\r\n  shl: function(a,b){\r\n    if (a<0) a += rtl.hiInt;\r\n    if (b<=0) return a;\r\n    if (b>54) return 0;\r\n    var r = a * Math.pow(2,b);\r\n    if (r <= rtl.hiInt) return r;\r\n    return r % rtl.hiInt;\r\n  },\r\n\r\n  initRTTI: function(){\r\n    if (rtl.debug_rtti) rtl.debug('initRTTI');\r\n\r\n    // base types\r\n    rtl.tTypeInfo = { name: \"tTypeInfo\", kind: 0, $module: null, attr: null };\r\n    function newBaseTI(name,kind,ancestor){\r\n      if (!ancestor) ancestor = rtl.tTypeInfo;\r\n      if (rtl.debug_rtti) rtl.debug('initRTTI.newBaseTI \"'+name+'\" '+kind+' (\"'+ancestor.name+'\")');\r\n      var t = Object.create(ancestor);\r\n      t.name = name;\r\n      t.kind = kind;\r\n      rtl[name] = t;\r\n      return t;\r\n    };\r\n    function newBaseInt(name,minvalue,maxvalue,ordtype){\r\n      var t = newBaseTI(name,1 /* tkInteger */,rtl.tTypeInfoInteger);\r\n      t.minvalue = minvalue;\r\n      t.maxvalue = maxvalue;\r\n      t.ordtype = ordtype;\r\n      return t;\r\n    };\r\n    newBaseTI(\"tTypeInfoInteger\",1 /* tkInteger */);\r\n    newBaseInt(\"shortint\",-0x80,0x7f,0);\r\n    newBaseInt(\"byte\",0,0xff,1);\r\n    newBaseInt(\"smallint\",-0x8000,0x7fff,2);\r\n    newBaseInt(\"word\",0,0xffff,3);\r\n    newBaseInt(\"longint\",-0x80000000,0x7fffffff,4);\r\n    newBaseInt(\"longword\",0,0xffffffff,5);\r\n    newBaseInt(\"nativeint\",-0x10000000000000,0xfffffffffffff,6);\r\n    newBaseInt(\"nativeuint\",0,0xfffffffffffff,7);\r\n    newBaseTI(\"char\",2 /* tkChar */);\r\n    newBaseTI(\"string\",3 /* tkString */);\r\n    newBaseTI(\"tTypeInfoEnum\",4 /* tkEnumeration */,rtl.tTypeInfoInteger);\r\n    newBaseTI(\"tTypeInfoSet\",5 /* tkSet */);\r\n    newBaseTI(\"double\",6 /* tkDouble */);\r\n    newBaseTI(\"boolean\",7 /* tkBool */);\r\n    newBaseTI(\"tTypeInfoProcVar\",8 /* tkProcVar */);\r\n    newBaseTI(\"tTypeInfoMethodVar\",9 /* tkMethod */,rtl.tTypeInfoProcVar);\r\n    newBaseTI(\"tTypeInfoArray\",10 /* tkArray */);\r\n    newBaseTI(\"tTypeInfoDynArray\",11 /* tkDynArray */);\r\n    newBaseTI(\"tTypeInfoPointer\",15 /* tkPointer */);\r\n    var t = newBaseTI(\"pointer\",15 /* tkPointer */,rtl.tTypeInfoPointer);\r\n    t.reftype = null;\r\n    newBaseTI(\"jsvalue\",16 /* tkJSValue */);\r\n    newBaseTI(\"tTypeInfoRefToProcVar\",17 /* tkRefToProcVar */,rtl.tTypeInfoProcVar);\r\n\r\n    // member kinds\r\n    rtl.tTypeMember = { attr: null };\r\n    function newMember(name,kind){\r\n      var m = Object.create(rtl.tTypeMember);\r\n      m.name = name;\r\n      m.kind = kind;\r\n      rtl[name] = m;\r\n    };\r\n    newMember(\"tTypeMemberField\",1); // tmkField\r\n    newMember(\"tTypeMemberMethod\",2); // tmkMethod\r\n    newMember(\"tTypeMemberProperty\",3); // tmkProperty\r\n\r\n    // base object for storing members: a simple object\r\n    rtl.tTypeMembers = {};\r\n\r\n    // tTypeInfoStruct - base object for tTypeInfoClass, tTypeInfoRecord, tTypeInfoInterface\r\n    var tis = newBaseTI(\"tTypeInfoStruct\",0);\r\n    tis.$addMember = function(name,ancestor,options){\r\n      if (rtl.debug_rtti){\r\n        if (!rtl.hasString(name) || (name.charAt()==='$')) throw 'invalid member \"'+name+'\", this=\"'+this.name+'\"';\r\n        if (!rtl.is(ancestor,rtl.tTypeMember)) throw 'invalid ancestor \"'+ancestor+':'+ancestor.name+'\", \"'+this.name+'.'+name+'\"';\r\n        if ((options!=undefined) && (typeof(options)!='object')) throw 'invalid options \"'+options+'\", \"'+this.name+'.'+name+'\"';\r\n      };\r\n      var t = Object.create(ancestor);\r\n      t.name = name;\r\n      this.members[name] = t;\r\n      this.names.push(name);\r\n      if (rtl.isObject(options)){\r\n        for (var key in options) if (options.hasOwnProperty(key)) t[key] = options[key];\r\n      };\r\n      return t;\r\n    };\r\n    tis.addField = function(name,type,options){\r\n      var t = this.$addMember(name,rtl.tTypeMemberField,options);\r\n      if (rtl.debug_rtti){\r\n        if (!rtl.is(type,rtl.tTypeInfo)) throw 'invalid type \"'+type+'\", \"'+this.name+'.'+name+'\"';\r\n      };\r\n      t.typeinfo = type;\r\n      this.fields.push(name);\r\n      return t;\r\n    };\r\n    tis.addFields = function(){\r\n      var i=0;\r\n      while(i<arguments.length){\r\n        var name = arguments[i++];\r\n        var type = arguments[i++];\r\n        if ((i<arguments.length) && (typeof(arguments[i])==='object')){\r\n          this.addField(name,type,arguments[i++]);\r\n        } else {\r\n          this.addField(name,type);\r\n        };\r\n      };\r\n    };\r\n    tis.addMethod = function(name,methodkind,params,result,flags,options){\r\n      var t = this.$addMember(name,rtl.tTypeMemberMethod,options);\r\n      t.methodkind = methodkind;\r\n      t.procsig = rtl.newTIProcSig(params,result,flags);\r\n      this.methods.push(name);\r\n      return t;\r\n    };\r\n    tis.addProperty = function(name,flags,result,getter,setter,options){\r\n      var t = this.$addMember(name,rtl.tTypeMemberProperty,options);\r\n      t.flags = flags;\r\n      t.typeinfo = result;\r\n      t.getter = getter;\r\n      t.setter = setter;\r\n      // Note: in options: params, stored, defaultvalue\r\n      t.params = rtl.isArray(t.params) ? rtl.newTIParams(t.params) : null;\r\n      this.properties.push(name);\r\n      if (!rtl.isString(t.stored)) t.stored = \"\";\r\n      return t;\r\n    };\r\n    tis.getField = function(index){\r\n      return this.members[this.fields[index]];\r\n    };\r\n    tis.getMethod = function(index){\r\n      return this.members[this.methods[index]];\r\n    };\r\n    tis.getProperty = function(index){\r\n      return this.members[this.properties[index]];\r\n    };\r\n\r\n    newBaseTI(\"tTypeInfoRecord\",12 /* tkRecord */,rtl.tTypeInfoStruct);\r\n    newBaseTI(\"tTypeInfoClass\",13 /* tkClass */,rtl.tTypeInfoStruct);\r\n    newBaseTI(\"tTypeInfoClassRef\",14 /* tkClassRef */);\r\n    newBaseTI(\"tTypeInfoInterface\",18 /* tkInterface */,rtl.tTypeInfoStruct);\r\n    newBaseTI(\"tTypeInfoHelper\",19 /* tkHelper */,rtl.tTypeInfoStruct);\r\n    newBaseTI(\"tTypeInfoExtClass\",20 /* tkExtClass */,rtl.tTypeInfoClass);\r\n  },\r\n\r\n  tSectionRTTI: {\r\n    $module: null,\r\n    $inherited: function(name,ancestor,o){\r\n      if (rtl.debug_rtti){\r\n        rtl.debug('tSectionRTTI.newTI \"'+(this.$module?this.$module.$name:\"(no module)\")\r\n          +'\".\"'+name+'\" ('+ancestor.name+') '+(o?'init':'forward'));\r\n      };\r\n      var t = this[name];\r\n      if (t){\r\n        if (!t.$forward) throw 'duplicate type \"'+name+'\"';\r\n        if (!ancestor.isPrototypeOf(t)) throw 'typeinfo ancestor mismatch \"'+name+'\" ancestor=\"'+ancestor.name+'\" t.name=\"'+t.name+'\"';\r\n      } else {\r\n        t = Object.create(ancestor);\r\n        t.name = name;\r\n        t.$module = this.$module;\r\n        this[name] = t;\r\n      }\r\n      if (o){\r\n        delete t.$forward;\r\n        for (var key in o) if (o.hasOwnProperty(key)) t[key]=o[key];\r\n      } else {\r\n        t.$forward = true;\r\n      }\r\n      return t;\r\n    },\r\n    $Scope: function(name,ancestor,o){\r\n      var t=this.$inherited(name,ancestor,o);\r\n      t.members = {};\r\n      t.names = [];\r\n      t.fields = [];\r\n      t.methods = [];\r\n      t.properties = [];\r\n      return t;\r\n    },\r\n    $TI: function(name,kind,o){ var t=this.$inherited(name,rtl.tTypeInfo,o); t.kind = kind; return t; },\r\n    $Int: function(name,o){ return this.$inherited(name,rtl.tTypeInfoInteger,o); },\r\n    $Enum: function(name,o){ return this.$inherited(name,rtl.tTypeInfoEnum,o); },\r\n    $Set: function(name,o){ return this.$inherited(name,rtl.tTypeInfoSet,o); },\r\n    $StaticArray: function(name,o){ return this.$inherited(name,rtl.tTypeInfoArray,o); },\r\n    $DynArray: function(name,o){ return this.$inherited(name,rtl.tTypeInfoDynArray,o); },\r\n    $ProcVar: function(name,o){ return this.$inherited(name,rtl.tTypeInfoProcVar,o); },\r\n    $RefToProcVar: function(name,o){ return this.$inherited(name,rtl.tTypeInfoRefToProcVar,o); },\r\n    $MethodVar: function(name,o){ return this.$inherited(name,rtl.tTypeInfoMethodVar,o); },\r\n    $Record: function(name,o){ return this.$Scope(name,rtl.tTypeInfoRecord,o); },\r\n    $Class: function(name,o){ return this.$Scope(name,rtl.tTypeInfoClass,o); },\r\n    $ClassRef: function(name,o){ return this.$inherited(name,rtl.tTypeInfoClassRef,o); },\r\n    $Pointer: function(name,o){ return this.$inherited(name,rtl.tTypeInfoPointer,o); },\r\n    $Interface: function(name,o){ return this.$Scope(name,rtl.tTypeInfoInterface,o); },\r\n    $Helper: function(name,o){ return this.$Scope(name,rtl.tTypeInfoHelper,o); },\r\n    $ExtClass: function(name,o){ return this.$Scope(name,rtl.tTypeInfoExtClass,o); }\r\n  },\r\n\r\n  newTIParam: function(param){\r\n    // param is an array, 0=name, 1=type, 2=optional flags\r\n    var t = {\r\n      name: param[0],\r\n      typeinfo: param[1],\r\n      flags: (rtl.isNumber(param[2]) ? param[2] : 0)\r\n    };\r\n    return t;\r\n  },\r\n\r\n  newTIParams: function(list){\r\n    // list: optional array of [paramname,typeinfo,optional flags]\r\n    var params = [];\r\n    if (rtl.isArray(list)){\r\n      for (var i=0; i<list.length; i++) params.push(rtl.newTIParam(list[i]));\r\n    };\r\n    return params;\r\n  },\r\n\r\n  newTIProcSig: function(params,result,flags){\r\n    var s = {\r\n      params: rtl.newTIParams(params),\r\n      resulttype: result?result:null,\r\n      flags: flags?flags:0\r\n    };\r\n    return s;\r\n  },\r\n\r\n  addResource: function(aRes){\r\n    rtl.$res[aRes.name]=aRes;\r\n  },\r\n\r\n  getResource: function(aName){\r\n    var res = rtl.$res[aName];\r\n    if (res !== undefined) {\r\n      return res;\r\n    } else {\r\n      return null;\r\n    }\r\n  },\r\n\r\n  getResourceList: function(){\r\n    return Object.keys(rtl.$res);\r\n  }\r\n}\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2018 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit System;\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\n{$IFDEF NodeJS}\r\nvar\r\n  LineEnding: string = #10;\r\n  sLineBreak: string = #10;\r\n{$ELSE}\r\nconst\r\n  LineEnding = #10;\r\n  sLineBreak = LineEnding;\r\n{$ENDIF}\r\n\r\nVar\r\n  PathDelim : Char = '/';\r\n  AllowDirectorySeparators : Set of Char = ['/'];\r\n  AllowDriveSeparators : Set of Char = [':'];\r\n  ExtensionSeparator : Char = '.';\r\n\r\nconst\r\n  MaxSmallint = 32767;\r\n  MinSmallint = -32768;\r\n  MaxShortInt = 127;\r\n  MinShortInt = -128;\r\n  MaxByte = $FF;\r\n  MaxWord = $FFFF;\r\n  MaxLongint  = $7fffffff;\r\n  MaxCardinal = LongWord($ffffffff);\r\n\r\n  Maxint = MaxLongint;\r\n  IsMultiThread = false;\r\n\r\n{*****************************************************************************\r\n                               Base types\r\n*****************************************************************************}\r\ntype\r\n  HRESULT = Longint; // For Delphi compatibility\r\n  Int8 = ShortInt;\r\n  UInt8 = Byte;\r\n  Int16 = SmallInt;\r\n  UInt16 = Word;\r\n  Int32 = Longint;\r\n  UInt32 = LongWord;\r\n\r\n  Integer = LongInt;\r\n  Cardinal = LongWord;\r\n  DWord = LongWord;\r\n  SizeInt = NativeInt;\r\n  SizeUInt = NativeUInt;\r\n  PtrInt = NativeInt;\r\n  PtrUInt = NativeUInt;\r\n  ValSInt = NativeInt;\r\n  ValUInt = NativeUInt;\r\n  CodePointer = Pointer;\r\n  ValReal = Double;\r\n  Real = type Double;\r\n  Extended = type Double;\r\n\r\n  TDateTime = type double;\r\n  TTime = type TDateTime;\r\n  TDate = type TDateTime;\r\n\r\n\r\n  Int64 = NativeInt; // only 53 bits at runtime\r\n  UInt64 = type NativeUInt unimplemented; // only 52 bits at runtime\r\n  QWord = type NativeUInt unimplemented; // only 52 bits at runtime\r\n  Single = Double; //unimplemented;\r\n  Comp = type NativeInt unimplemented;\r\n  NativeLargeInt = NativeInt;\r\n  NativeLargeUInt = NativeUInt;\r\n\r\n  UnicodeString = String;\r\n  WideString = type String;\r\n  WideChar = char;\r\n  UnicodeChar = char;\r\n\r\n  TDynArrayIndex = NativeInt;\r\n  TTextLineBreakStyle = (tlbsLF,tlbsCRLF,tlbsCR);\r\n\r\n  TCompareOption = ({coLingIgnoreCase, coLingIgnoreDiacritic, }coIgnoreCase{,\r\n                    coIgnoreKanaType, coIgnoreNonSpace, coIgnoreSymbols, coIgnoreWidth,\r\n                    coLingCasing, coDigitAsNumbers, coStringSort});\r\n  TCompareOptions = set of TCompareOption;\r\n\r\n  generic TArray<T> = array of T;\r\n\r\n{*****************************************************************************\r\n            TObject, TClass, IUnknown, IInterface, TInterfacedObject\r\n*****************************************************************************}\r\ntype\r\n  TGuid = record\r\n    D1: DWord;\r\n    D2: word;\r\n    D3: word;\r\n    D4: array[0..7] of byte;\r\n  end;\r\n  TGUIDString = type string;\r\n\r\n  PMethod = ^TMethod;\r\n  TMethod = record\r\n    Code : CodePointer;\r\n    Data : Pointer;\r\n  end;\r\n\r\n  TClass = class of TObject;\r\n\r\n  { TObject }\r\n\r\n  {$DispatchField Msg} // enable checking message methods for record field name \"Msg\"\r\n  {$DispatchStrField MsgStr}\r\n  TObject = class\r\n  private\r\n    class var FClassName: String; external name '$classname';\r\n    class var FClassParent: TClass; external name '$ancestor';\r\n    class var FUnitName: String; external name '$module.$name';\r\n  public\r\n    constructor Create;\r\n    destructor Destroy; virtual;\r\n\r\n    // Free is using compiler magic.\r\n    // Reasons:\r\n    // 1. In JS calling obj.Free when obj=nil would crash.\r\n    // 2. In JS freeing memory requires to set all references to nil.\r\n    // Therefore any obj.free call is replaced by the compiler with some rtl magic.\r\n    procedure Free;\r\n\r\n    class function ClassType: TClass; assembler;\r\n    class property ClassName: String read FClassName;\r\n    class function ClassNameIs(const Name: string): boolean;\r\n    class property ClassParent: TClass read FClassParent;\r\n    class function InheritsFrom(aClass: TClass): boolean; assembler;\r\n    class property UnitName: String read FUnitName;\r\n    Class function MethodName(aCode : Pointer) : String;\r\n    Class function MethodAddress(aName : String) : Pointer;\r\n    Class Function FieldAddress(aName : String) : Pointer;\r\n    Class Function ClassInfo : Pointer;\r\n    class function QualifiedClassName: String;\r\n\r\n    procedure AfterConstruction; virtual;\r\n    procedure BeforeDestruction; virtual;\r\n\r\n    // message handling routines\r\n    procedure Dispatch(var aMessage); virtual;\r\n    procedure DispatchStr(var aMessage); virtual;\r\n    procedure DefaultHandler(var aMessage); virtual;\r\n    procedure DefaultHandlerStr(var aMessage); virtual;\r\n\r\n    function GetInterface(const iid: TGuid; out obj): boolean;\r\n    function GetInterface(const iidstr: String; out obj): boolean; inline;\r\n    function GetInterfaceByStr(const iidstr: String; out obj): boolean;\r\n    function GetInterfaceWeak(const iid: TGuid; out obj): boolean; // equal to GetInterface but the interface returned is not referenced\r\n\r\n    function Equals(Obj: TObject): boolean; virtual;\r\n    function ToString: String; virtual;\r\n  end;\r\n\r\n  { TCustomAttribute - base class of all user defined attributes. }\r\n\r\n  TCustomAttribute = class\r\n  end;\r\n  TCustomAttributeArray = array of TCustomAttribute;\r\n\r\nconst\r\n  { IInterface }\r\n  S_OK          = 0;\r\n  S_FALSE       = 1;\r\n  E_NOINTERFACE = -2147467262; // FPC: longint($80004002)\r\n  E_UNEXPECTED  = -2147418113; // FPC: longint($8000FFFF)\r\n  E_NOTIMPL     = -2147467263; // FPC: longint($80004001)\r\n\r\ntype\r\n  {$Interfaces COM}\r\n  IUnknown = interface\r\n    ['{00000000-0000-0000-C000-000000000046}']\r\n    function QueryInterface(const iid: TGuid; out obj): Integer;\r\n    function _AddRef: Integer;\r\n    function _Release: Integer;\r\n  end;\r\n  IInterface = IUnknown;\r\n\r\n  {$M+}\r\n  IInvokable = interface(IInterface)\r\n  end;\r\n  {$M-}\r\n\r\n  { Enumerator support }\r\n  IEnumerator = interface(IInterface)\r\n    function GetCurrent: TObject;\r\n    function MoveNext: Boolean;\r\n    procedure Reset;\r\n    property Current: TObject read GetCurrent;\r\n  end;\r\n\r\n  IEnumerable = interface(IInterface)\r\n    function GetEnumerator: IEnumerator;\r\n  end;\r\n\r\n  { TInterfacedObject }\r\n\r\n  TInterfacedObject = class(TObject,IUnknown)\r\n  protected\r\n    fRefCount: Integer;\r\n    { implement methods of IUnknown }\r\n    function QueryInterface(const iid: TGuid; out obj): Integer; virtual;\r\n    function _AddRef: Integer; virtual;\r\n    function _Release: Integer; virtual;\r\n  public\r\n    procedure BeforeDestruction; override;\r\n    property RefCount: Integer read fRefCount;\r\n  end;\r\n  TInterfacedClass = class of TInterfacedObject;\r\n\r\n  { TAggregatedObject - sub or satellite object using same interface as controller }\r\n\r\n  TAggregatedObject = class(TObject)\r\n  private\r\n    fController: Pointer;\r\n    function GetController: IUnknown;\r\n  protected\r\n    { implement methods of IUnknown }\r\n    function QueryInterface(const iid: TGuid; out obj): Integer; virtual;\r\n    function _AddRef: Integer; virtual;\r\n    function _Release: Integer; virtual;\r\n  public\r\n    constructor Create(const aController: IUnknown); reintroduce;\r\n    property Controller: IUnknown read GetController;\r\n  end;\r\n\r\n  { TContainedObject }\r\n\r\n  TContainedObject = class(TAggregatedObject,IInterface)\r\n  protected\r\n    function QueryInterface(const iid: TGuid; out obj): Integer; override;\r\n  end;\r\n\r\nconst\r\n  { for safe as operator support }\r\n  IObjectInstance: TGuid = '{D91C9AF4-3C93-420F-A303-BF5BA82BFD23}';\r\n\r\nfunction GUIDToString(const GUID: TGUID): string; external name 'rtl.guidrToStr';\r\n\r\n{*****************************************************************************\r\n                                  RTTI support\r\n*****************************************************************************}\r\ntype\r\n  // if you change the following enumeration type in any way\r\n  // you also have to change the rtl.js in an appropriate way !\r\n  TTypeKind = (\r\n    tkUnknown,  // 0\r\n    tkInteger,  // 1\r\n    tkChar,     // 2 in Delphi/FPC tkWChar, tkUChar\r\n    tkString,   // 3 in Delphi/FPC tkSString, tkWString or tkUString\r\n    tkEnumeration, // 4\r\n    tkSet,      // 5\r\n    tkDouble,   // 6\r\n    tkBool,     // 7\r\n    tkProcVar,  // 8  function or procedure\r\n    tkMethod,   // 9  proc var of object\r\n    tkArray,    // 10 static array\r\n    tkDynArray, // 11\r\n    tkRecord,   // 12\r\n    tkClass,    // 13\r\n    tkClassRef, // 14\r\n    tkPointer,  // 15\r\n    tkJSValue,  // 16\r\n    tkRefToProcVar, // 17  variable of procedure type\r\n    tkInterface, // 18\r\n    //tkObject,\r\n    //tkSString,tkLString,tkAString,tkWString,\r\n    //tkVariant,\r\n    //tkWChar,\r\n    //tkInt64,\r\n    //tkQWord,\r\n    //tkInterfaceRaw,\r\n    //tkUString,tkUChar,\r\n    tkHelper,   // 19\r\n    //tkFile,\r\n    tkExtClass  // 20\r\n    );\r\n  TTypeKinds = set of TTypeKind;\r\n\r\nconst\r\n  tkFloat = tkDouble; // for compatibility with Delphi/FPC\r\n  tkProcedure = tkProcVar; // for compatibility with Delphi\r\n  tkAny = [Low(TTypeKind)..High(TTypeKind)];\r\n  tkMethods = [tkMethod];\r\n  tkProperties = tkAny-tkMethods-[tkUnknown];\r\n\r\n{*****************************************************************************\r\n                              Array of const support\r\n*****************************************************************************}\r\n\r\nconst\r\n  vtInteger       = 0;\r\n  vtBoolean       = 1;\r\n  //vtChar          = 2; // Delphi/FPC: ansichar\r\n  vtExtended      = 3; // Note: double in pas2js, PExtended in Delphi/FPC\r\n  //vtString        = 4; // Delphi/FPC: PShortString\r\n  vtPointer       = 5;\r\n  //vtPChar         = 6;\r\n  vtObject        = 7;\r\n  vtClass         = 8;\r\n  vtWideChar      = 9;\r\n  //vtPWideChar     = 10;\r\n  //vtAnsiString    = 11;\r\n  vtCurrency      = 12; // Note: currency in pas2js, PCurrency in Delphi/FPC\r\n  //vtVariant       = 13;\r\n  vtInterface     = 14;\r\n  //vtWideString    = 15;\r\n  //vtInt64         = 16;\r\n  //vtQWord         = 17;\r\n  vtUnicodeString = 18;\r\n  // only pas2js, not in Delphi/FPC:\r\n  vtNativeInt     = 19;\r\n  vtJSValue       = 20;\r\n\r\ntype\r\n  PVarRec = ^TVarRec;\r\n  TVarRec = record\r\n    VType: byte;\r\n    VJSValue: JSValue;\r\n    VInteger: LongInt external name 'VJSValue';\r\n    VBoolean: Boolean external name 'VJSValue';\r\n    VExtended: Double external name 'VJSValue';\r\n    VPointer: Pointer external name 'VJSValue';\r\n    VObject: TObject external name 'VJSValue';\r\n    VClass: TClass external name 'VJSValue';\r\n    VWideChar: WideChar external name 'VJSValue';\r\n    VCurrency: Currency external name 'VJSValue';\r\n    VInterface: Pointer external name 'VJSValue';\r\n    VUnicodeString: UnicodeString external name 'VJSValue';\r\n    VNativeInt: NativeInt external name 'VJSValue';\r\n  end;\r\n  TVarRecArray = array of TVarRec;\r\n\r\nfunction VarRecs: TVarRecArray; varargs;\r\n\r\n{*****************************************************************************\r\n                            Init / Exit / ExitProc\r\n*****************************************************************************}\r\nvar\r\n  ExitCode: Integer; external name 'rtl.exitcode';\r\n  IsConsole: Boolean = {$IFDEF NodeJS}true{$ELSE}false{$ENDIF};\r\n  FirstDotAtFileNameStartIsExtension : Boolean = False;\r\n\r\ntype\r\n  TOnParamCount = function: Longint;\r\n  TOnParamStr = function(Index: Longint): String;\r\nvar\r\n  OnParamCount: TOnParamCount;\r\n  OnParamStr: TOnParamStr;\r\n\r\nfunction ParamCount: Longint;\r\nfunction ParamStr(Index: Longint): String;\r\n\r\n{*****************************************************************************\r\n                                 Math\r\n*****************************************************************************}\r\nconst\r\n  PI: Double; external name 'Math.PI';\r\n  MathE: Double; external name 'Math.E'; // Euler's number\r\n  MathLN10: Double; external name 'Math.LN10'; // ln(10)\r\n  MathLN2: Double; external name 'Math.LN2'; // ln(2)\r\n  MathLog10E: Double; external name 'Math.Log10E'; // log10(e)\r\n  MathLog2E: Double; external name 'Math.LOG2E'; // log2(e)\r\n  MathSQRT1_2: Double; external name 'Math.SQRT1_2'; // sqrt(0.5)\r\n  MathSQRT2: Double; external name 'Math.SQRT2'; // sqrt(2)\r\n\r\nfunction Abs(const A: integer): integer; overload; external name 'Math.abs';\r\nfunction Abs(const A: NativeInt): integer; overload; external name 'Math.abs';\r\nfunction Abs(const A: Double): Double; overload; external name 'Math.abs';\r\nfunction ArcTan(const A: Double): Double; external name 'Math.atan';\r\nfunction ArcTan2(const A,B: Double): Double; external name 'Math.atan2';\r\nfunction Cos(const A: Double): Double; external name 'Math.cos';\r\nfunction Exp(const A: Double): Double; external name 'Math.exp';\r\nfunction Frac(const A: Double): Double; assembler;\r\nfunction Ln(const A: Double): Double; external name 'Math.log';\r\nfunction Odd(const A: Integer): Boolean; assembler;\r\nfunction Random(const Range: Integer): Integer; overload; assembler;\r\nfunction Random: Double; overload; external name 'Math.random';\r\nfunction Round(const A: Double): NativeInt; external name 'Math.round';\r\nfunction Sin(const A: Double): Double; external name 'Math.sin';\r\nfunction Tan(const A: Double): Double; external name 'Math.tan';\r\nfunction Sqr(const A: Integer): Integer; assembler; overload;\r\nfunction Sqr(const A: Double): Double; assembler; overload;\r\nfunction sqrt(const A: Double): Double; external name 'Math.sqrt';\r\nfunction Trunc(const A: Double): NativeInt;\r\n\r\n{*****************************************************************************\r\n                          String functions\r\n*****************************************************************************}\r\nconst\r\n  DefaultTextLineBreakStyle : TTextLineBreakStyle = tlbsLF;\r\n\r\nfunction Int(const A: Double): double;\r\nfunction Copy(const S: string; Index, Size: Integer): String; assembler; overload;\r\nfunction Copy(const S: string; Index: Integer): String; assembler; overload;\r\nprocedure Delete(var S: String; Index, Size: Integer); overload;\r\nfunction Pos(const Search, InString: String): Integer; assembler; overload;\r\nfunction Pos(const Search, InString: String; StartAt : Integer): Integer; assembler; overload;\r\nprocedure Insert(const Insertion: String; var Target: String; Index: Integer); overload;\r\nfunction upcase(c : char) : char; assembler;\r\nfunction HexStr(Val: NativeInt; cnt: byte): string; external name 'rtl.hexStr'; overload;\r\nfunction binstr(val : NativeUInt; cnt : byte) : string;\r\n\r\nprocedure val(const S: String; out NI : NativeInt; out Code: Integer); overload;\r\nprocedure val(const S: String; out NI : NativeUInt; out Code: Integer); overload;\r\nprocedure val(const S: String; out SI : ShortInt; out Code: Integer); overload;\r\nprocedure val(const S: String; out B : Byte; out Code: Integer); overload;\r\nprocedure val(const S: String; out SI : smallint; out Code: Integer); overload;\r\nprocedure val(const S: String; out W : word; out Code : Integer); overload;\r\nprocedure val(const S: String; out I : integer; out Code : Integer); overload;\r\nprocedure val(const S: String; out C : Cardinal; out Code: Integer); overload;\r\nprocedure val(const S: String; out d : double; out Code : Integer); overload;\r\nprocedure val(const S: String; out b : boolean; out Code: Integer); overload;\r\nfunction StringOfChar(c: Char; l: NativeInt): String;\r\n\r\n{*****************************************************************************\r\n                          Other functions\r\n*****************************************************************************}\r\nprocedure Write; varargs; // ToDo: should be compiler built-in function\r\nprocedure Writeln; varargs; // ToDo: should be compiler built-in function\r\n\r\nType\r\n  TConsoleHandler = Procedure (S : JSValue; NewLine : Boolean);\r\nFunction SetWriteCallBack(H : TConsoleHandler) : TConsoleHandler;\r\n\r\nfunction Assigned(const V: JSValue): boolean; assembler; overload;\r\nfunction StrictEqual(const A: JSValue; const B): boolean; assembler;\r\nfunction StrictInequal(const A: JSValue; const B): boolean; assembler;\r\n\r\nimplementation\r\n\r\ntype\r\n\r\n  { TJSObj - simple access to JS Object }\r\n\r\n  TJSObj = class external name 'Object'\r\n  private\r\n    function GetProperties(Name: String): JSValue; external name '[]';\r\n    procedure SetProperties(Name: String; const AValue: JSValue); external name '[]';\r\n  public\r\n    //constructor new;\r\n    //function hasOwnProperty(prop: String): boolean;\r\n    property Properties[Name: String]: JSValue read GetProperties write SetProperties; default;\r\n  end;\r\n\r\n  TJSArray = class external name 'Array'\r\n  public\r\n    //length: nativeint;\r\n    //constructor new; overload;\r\n    function push(aElement : JSValue) : NativeInt; varargs;\r\n  end;\r\n\r\n  TJSArguments = class external name 'arguments'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    function GetElements(Index: NativeInt): JSValue; external name '[]';\r\n  public\r\n    property Length: NativeInt read FLength;\r\n    property Elements[Index: NativeInt]: JSValue read GetElements; default;\r\n  end;\r\nvar\r\n  JSArguments: TJSArguments; external name 'arguments';\r\n\r\nfunction isNumber(const v: JSValue): boolean; external name 'rtl.isNumber';\r\nfunction isObject(const v: JSValue): boolean; external name 'rtl.isObject'; // true if not null and a JS Object\r\nfunction isString(const v: JSValue): boolean; external name 'rtl.isString';\r\nfunction isNaN(i: JSValue): boolean; external name 'isNaN'; // may result NaN\r\n\r\n// needed by ClassNameIs, the real SameText is in SysUtils\r\nfunction SameText(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1.toLowerCase() == s2.toLowerCase();\r\nend;\r\n\r\nfunction VarRecs: TVarRecArray;\r\nvar\r\n  i: nativeint;\r\n  v: PVarRec;\r\nbegin\r\n  Result:=nil;\r\n  while i<JSArguments.Length do\r\n    begin\r\n    new(v);\r\n    v^.VType:=byte(JSArguments[i]);\r\n    inc(i);\r\n    v^.VJSValue:=JSArguments[i];\r\n    inc(i);\r\n    TJSArray(Result).push(v^);\r\n    end;\r\nend;\r\n\r\nfunction ParamCount: Longint;\r\nbegin\r\n  if Assigned(OnParamCount) then\r\n    Result:=OnParamCount()\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction ParamStr(Index: Longint): String;\r\nbegin\r\n  if Assigned(OnParamStr) then\r\n    Result:=OnParamStr(Index)\r\n  else if Index=0 then\r\n    Result:='js'\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nfunction Frac(const A: Double): Double; assembler;\r\nasm\r\n  return A % 1;\r\nend;\r\n\r\nfunction Odd(const A: Integer): Boolean; assembler;\r\nasm\r\n  return A&1 != 0;\r\nend;\r\n\r\nfunction Random(const Range: Integer): Integer; assembler;\r\nasm\r\n  return Math.floor(Math.random()*Range);\r\nend;\r\n\r\nfunction Sqr(const A: Integer): Integer; assembler;\r\nasm\r\n  return A*A;\r\nend;\r\n\r\nfunction Sqr(const A: Double): Double; assembler;\r\nasm\r\n  return A*A;\r\nend;\r\n\r\nfunction Trunc(const A: Double): NativeInt; assembler;\r\nasm\r\n  if (!Math.trunc) {\r\n    Math.trunc = function(v) {\r\n      v = +v;\r\n      if (!isFinite(v)) return v;\r\n      return (v - v % 1) || (v < 0 ? -0 : v === 0 ? v : 0);\r\n    };\r\n  }\r\n  $mod.Trunc = Math.trunc;\r\n  return Math.trunc(A);\r\nend;\r\n\r\nfunction Copy(const S: string; Index, Size: Integer): String; assembler;\r\nasm\r\n  if (Index<1) Index = 1;\r\n  return (Size>0) ? S.substring(Index-1,Index+Size-1) : \"\";\r\nend;\r\n\r\nfunction Copy(const S: string; Index: Integer): String; assembler;\r\nasm\r\n  if (Index<1) Index = 1;\r\n  return S.substr(Index-1);\r\nend;\r\n\r\nprocedure Delete(var S: String; Index, Size: Integer);\r\nvar\r\n  h: String;\r\nbegin\r\n  if (Index<1) or (Index>length(S)) or (Size<=0) then exit;\r\n  h:=S;\r\n  S:=copy(h,1,Index-1)+copy(h,Index+Size);\r\nend;\r\n\r\nfunction Pos(const Search, InString: String): Integer; assembler;\r\nasm\r\n  return InString.indexOf(Search)+1;\r\nend;\r\n\r\nfunction Pos(const Search, InString: String; StartAt : Integer): Integer; assembler; overload;\r\nasm\r\n  return InString.indexOf(Search,StartAt-1)+1;\r\nend;\r\n\r\nprocedure Insert(const Insertion: String; var Target: String; Index: Integer);\r\nvar\r\n  t: String;\r\nbegin\r\n  if Insertion='' then exit;\r\n  t:=Target;\r\n  if Index<1 then\r\n    Target:=Insertion+t\r\n  else if Index>length(t) then\r\n    Target:=t+Insertion\r\n  else\r\n    Target:=copy(t,1,Index-1)+Insertion+copy(t,Index,length(t));\r\nend;\r\n\r\nvar\r\n  WriteBuf: String;\r\n  WriteCallBack : TConsoleHandler;\r\n\r\nFunction SetWriteCallBack(H : TConsoleHandler) : TConsoleHandler;\r\n\r\nbegin\r\n  Result:=WriteCallBack;\r\n  WriteCallBack:=H;\r\nend;\r\n\r\nprocedure Write;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  for i:=0 to JSArguments.Length-1 do\r\n    if Assigned(WriteCallBack) then\r\n      WriteCallBack(JSArguments[i],False)\r\n    else\r\n      WriteBuf:=WriteBuf+String(JSArguments[i]);\r\nend;\r\n\r\nprocedure Writeln;\r\n\r\nvar\r\n  i,l: Integer;\r\n  s: String;\r\n\r\nbegin\r\n  L:=JSArguments.Length-1;\r\n  if Assigned(WriteCallBack) then\r\n    begin\r\n    for i:=0 to L do\r\n      WriteCallBack(JSArguments[i],I=L);\r\n    end\r\n  else\r\n    begin\r\n    s:=WriteBuf;\r\n    for i:=0 to L do\r\n      s:=s+String(JSArguments[i]);\r\n    asm\r\n      console.log(s);\r\n    end;\r\n    WriteBuf:='';\r\n    end;\r\nend;\r\n\r\nfunction Int(const A: Double): double;\r\n\r\nbegin\r\n  // trunc contains fix for missing Math.trunc in IE\r\n  Result:=Trunc(A);\r\nend;\r\n\r\nfunction Number(S: String): Double; external name 'Number';\r\n\r\nfunction valint(const S: String; MinVal, MaxVal: NativeInt; out Code: Integer): NativeInt;\r\nvar\r\n  x: double;\r\nbegin\r\n  if S='' then\r\n    begin\r\n    code:=1;\r\n    exit;\r\n    end;\r\n  x:=Number(S);\r\n  if isNaN(x) then\r\n    case copy(s,1,1) of\r\n    '$': x:=Number('0x'+copy(S,2));\r\n    '&': x:=Number('0o'+copy(S,2));\r\n    '%': x:=Number('0b'+copy(S,2));\r\n    else\r\n      Code:=1;\r\n      exit;\r\n    end;\r\n  if isNaN(x) or (X<>Int(X)) then\r\n    Code:=1\r\n  else if (x<MinVal) or (x>MaxVal) then\r\n    Code:=2\r\n  else\r\n    begin\r\n    Result:=Trunc(x);\r\n    Code:=0;\r\n    end;\r\nend;\r\n\r\nprocedure val(const S: String; out NI : NativeInt; out Code: Integer);\r\nbegin\r\n  NI:=valint(S,low(NI),high(NI),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out NI: NativeUInt; out Code: Integer);\r\nvar\r\n  x : double;\r\nbegin\r\n  if S='' then\r\n    begin\r\n    code:=1;\r\n    exit;\r\n    end;\r\n  x:=Number(S);\r\n  if isNaN(x) or (X<>Int(X)) or (X<0) then\r\n    Code:=1\r\n  else\r\n    begin\r\n    Code:=0;\r\n    NI:=Trunc(x);\r\n    end;\r\nend;\r\n\r\nprocedure val(const S: String; out SI : ShortInt; out Code: Integer);\r\nbegin\r\n  SI:=valint(S,low(SI),high(SI),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out SI: smallint; out Code: Integer);\r\nbegin\r\n  SI:=valint(S,low(SI),high(SI),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out C: Cardinal; out Code: Integer);\r\nbegin\r\n  C:=valint(S,low(C),high(C),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out B: Byte; out Code: Integer);\r\nbegin\r\n  B:=valint(S,low(B),high(B),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out W: word; out Code: Integer);\r\nbegin\r\n  W:=valint(S,low(W),high(W),Code);\r\nend;\r\n\r\nprocedure val(const S : String; out I : integer; out Code : Integer);\r\nbegin\r\n  I:=valint(S,low(I),high(I),Code);\r\nend;\r\n\r\nprocedure val(const S : String; out d : double; out Code : Integer);\r\nVar\r\n  x: double;\r\nbegin\r\n  if S='' then\r\n    begin\r\n    code:=1;\r\n    exit;\r\n    end;\r\n  x:=Number(S);\r\n  if isNaN(x) then\r\n    Code:=1\r\n  else\r\n    begin\r\n    Code:=0;\r\n    d:=x;\r\n    end;\r\nend;\r\n\r\nprocedure val(const S: String; out b: boolean; out Code: Integer);\r\nbegin\r\n  if SameText(S,'true') then\r\n    begin\r\n    Code:=0;\r\n    b:=true;\r\n    end\r\n  else if SameText(S,'false') then\r\n    begin\r\n    Code:=0;\r\n    b:=false;\r\n    end\r\n  else\r\n    Code:=1;\r\nend;\r\n\r\nfunction binstr(val : NativeUInt;cnt : byte) : string;\r\nvar\r\n  i : Integer;\r\nbegin\r\n  SetLength(Result,cnt);\r\n  for i:=cnt downto 1 do\r\n   begin\r\n     Result[i]:=char(48+val and 1);\r\n     val:=val shr 1;\r\n   end;\r\nend;\r\n\r\nfunction upcase(c : char) : char; assembler;\r\nasm\r\n  return c.toUpperCase();\r\nend;\r\n\r\nfunction StringOfChar(c: Char; l: NativeInt): String;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  asm\r\n    if ((l>0) && c.repeat) return c.repeat(l);\r\n  end;\r\n  Result:='';\r\n  for i:=1 to l do Result:=Result+c;\r\nend;\r\n\r\nfunction Assigned(const V: JSValue): boolean; assembler;\r\nasm\r\n  return (V!=undefined) && (V!=null) && (!rtl.isArray(V) || (V.length > 0));\r\nend;\r\n\r\nfunction StrictEqual(const A: JSValue; const B): boolean; assembler;\r\nasm\r\n  return A === B;\r\nend;\r\n\r\nfunction StrictInequal(const A: JSValue; const B): boolean; assembler;\r\nasm\r\n  return A !== B;\r\nend;\r\n\r\n{ TContainedObject }\r\n\r\nfunction TContainedObject.QueryInterface(const iid: TGuid; out obj): Integer;\r\nbegin\r\n  if GetInterface(iid,obj) then\r\n    Result:=S_OK\r\n  else\r\n    Result:=Integer(E_NOINTERFACE);\r\nend;\r\n\r\n{ TAggregatedObject }\r\n\r\nfunction TAggregatedObject.GetController: IUnknown;\r\nbegin\r\n  Result := IUnknown(fController);\r\nend;\r\n\r\nfunction TAggregatedObject.QueryInterface(const iid: TGuid; out obj): Integer;\r\nbegin\r\n  Result := IUnknown(fController).QueryInterface(iid, obj);\r\nend;\r\n\r\nfunction TAggregatedObject._AddRef: Integer;\r\nbegin\r\n  Result := IUnknown(fController)._AddRef;\r\nend;\r\n\r\nfunction TAggregatedObject._Release: Integer;\r\nbegin\r\n  Result := IUnknown(fController)._Release;\r\nend;\r\n\r\nconstructor TAggregatedObject.Create(const aController: IUnknown);\r\nbegin\r\n  inherited Create;\r\n  { do not keep a counted reference to the controller! }\r\n  fController := Pointer(aController);\r\nend;\r\n\r\n{ TInterfacedObject }\r\n\r\nfunction TInterfacedObject.QueryInterface(const iid: TGuid; out obj): Integer;\r\nbegin\r\n  if GetInterface(iid,obj) then\r\n    Result:=S_OK\r\n  else\r\n    Result:=Integer(E_NOINTERFACE);\r\nend;\r\n\r\nfunction TInterfacedObject._AddRef: Integer;\r\nbegin\r\n  inc(fRefCount);\r\n  Result:=fRefCount;\r\nend;\r\n\r\nfunction TInterfacedObject._Release: Integer;\r\nbegin\r\n  dec(fRefCount);\r\n  Result:=fRefCount;\r\n  if fRefCount=0 then\r\n    Destroy;\r\nend;\r\n\r\nprocedure TInterfacedObject.BeforeDestruction;\r\nbegin\r\n  if fRefCount<>0 then\r\n    asm\r\n    rtl.raiseE('EHeapMemoryError');\r\n    end;\r\nend;\r\n\r\n{ TObject }\r\n\r\nconstructor TObject.Create;\r\nbegin\r\n\r\nend;\r\n\r\ndestructor TObject.Destroy;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TObject.Free;\r\nbegin\r\n  Destroy;\r\nend;\r\n\r\nclass function TObject.ClassType: TClass; assembler;\r\nasm\r\n  return this;\r\nend;\r\n\r\nclass function TObject.ClassNameIs(const Name: string): boolean;\r\nbegin\r\n  Result:=SameText(Name,ClassName);\r\nend;\r\n\r\nclass function TObject.InheritsFrom(aClass: TClass): boolean; assembler;\r\nasm\r\n  return (aClass!=null) && ((this==aClass) || aClass.isPrototypeOf(this));\r\nend;\r\n\r\nClass function TObject.MethodName(aCode : Pointer) : String;\r\n\r\nbegin\r\n  Result:='';\r\n  if aCode=Nil then\r\n    exit;\r\nasm\r\n  if (typeof(aCode)!=='function') return \"\";\r\n  var i = 0;\r\n  var TI = this.$rtti;\r\n  if (rtl.isObject(aCode.scope)){\r\n    // callback\r\n    if (typeof aCode.fn === \"string\") return aCode.fn;\r\n    aCode = aCode.fn;\r\n  }\r\n  // Not a callback, check rtti\r\n  while ((Result === \"\") && (TI != null)) {\r\n    i = 0;\r\n    while ((Result === \"\") && (i < TI.methods.length)) {\r\n      if (this[TI.getMethod(i).name] === aCode)\r\n        Result=TI.getMethod(i).name;\r\n      i += 1;\r\n    };\r\n    if (Result === \"\") TI = TI.ancestor;\r\n  };\r\n  // return Result;\r\nend;\r\nend;\r\n\r\nClass function TObject.MethodAddress(aName : String) : Pointer;\r\n\r\n// We must do this in asm, because the typinfo unit is not available.\r\nbegin\r\n  Result:=Nil;\r\n  if AName='' then\r\n    exit;\r\nasm\r\n  var i = 0;\r\n  var TI = this.$rtti;\r\n  var N = \"\";\r\n  var MN = \"\";\r\n  N = aName.toLowerCase();\r\n  while ((MN === \"\") && (TI != null)) {\r\n    i = 0;\r\n    while ((MN === \"\") && (i < TI.methods.length)) {\r\n      if (TI.getMethod(i).name.toLowerCase() === N) MN = TI.getMethod(i).name;\r\n      i += 1;\r\n    };\r\n    if (MN === \"\") TI = TI.ancestor;\r\n  };\r\n  if (MN !== \"\") Result = this[MN];\r\n//  return Result;\r\nend;\r\nend;\r\n\r\nclass function TObject.FieldAddress(aName: String): Pointer;\r\n\r\nbegin\r\n  Result:=Nil;\r\n  if aName='' then exit;\r\n  asm\r\n    var aClass = this.$class;\r\n    var ClassTI = null;\r\n    var myName = aName.toLowerCase();\r\n    var MemberTI = null;\r\n    while (aClass !== null) {\r\n      ClassTI = aClass.$rtti;\r\n      for (var i = 0, $end2 = ClassTI.fields.length - 1; i <= $end2; i++) {\r\n        MemberTI = ClassTI.getField(i);\r\n        if (MemberTI.name.toLowerCase() === myName) {\r\n           return MemberTI;\r\n        };\r\n      };\r\n      aClass = aClass.$ancestor ? aClass.$ancestor : null;\r\n    };\r\n  end;\r\nend;\r\n\r\nClass Function TObject.ClassInfo : Pointer;\r\n\r\nbegin\r\n  // This works different from FPC/Delphi.\r\n  // We get the actual type info.\r\n  Result:=TypeInfo(Self);\r\nend;\r\n\r\nprocedure TObject.AfterConstruction;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TObject.BeforeDestruction;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TObject.Dispatch(var aMessage);\r\n// aMessage is a record with an integer field 'Msg'\r\nvar\r\n  aClass: TClass;\r\n  Msg: TJSObj absolute aMessage;\r\n  Id: jsvalue;\r\nbegin\r\n  if not isObject(Msg) then exit;\r\n  Id:=Msg['Msg'];\r\n  if not isNumber(Id) then exit;\r\n  aClass:=ClassType;\r\n  while aClass<>nil do\r\n    begin\r\n    asm\r\n      var Handlers = aClass.$msgint;\r\n      if (rtl.isObject(Handlers) && Handlers.hasOwnProperty(Id)){\r\n        this[Handlers[Id]](aMessage);\r\n        return;\r\n      }\r\n    end;\r\n    aClass:=aClass.ClassParent;\r\n    end;\r\n  DefaultHandler(aMessage);\r\nend;\r\n\r\nprocedure TObject.DispatchStr(var aMessage);\r\n// aMessage is a record with a string field 'MsgStr'\r\nvar\r\n  aClass: TClass;\r\n  Msg: TJSObj absolute aMessage;\r\n  Id: jsvalue;\r\nbegin\r\n  if not isObject(Msg) then exit;\r\n  Id:=Msg['MsgStr'];\r\n  if not isString(Id) then exit;\r\n  aClass:=ClassType;\r\n  while (aClass<>Nil) do\r\n    begin\r\n    asm\r\n      var Handlers = aClass.$msgstr;\r\n      if (rtl.isObject(Handlers) && Handlers.hasOwnProperty(Id)){\r\n        this[Handlers[Id]](aMessage);\r\n        return;\r\n      }\r\n    end;\r\n    aClass:=aClass.ClassParent;\r\n    end;\r\n  DefaultHandlerStr(aMessage);\r\nend;\r\n\r\nprocedure TObject.DefaultHandler(var aMessage);\r\nbegin\r\n  if jsvalue(TMethod(aMessage)) then ;\r\nend;\r\n\r\nprocedure TObject.DefaultHandlerStr(var aMessage);\r\nbegin\r\n  if jsvalue(TMethod(aMessage)) then ;\r\nend;\r\n\r\nfunction TObject.GetInterface(const iid: TGuid; out obj): boolean;\r\nbegin\r\n  asm\r\n    var i = iid.$intf;\r\n    if (i){\r\n      // iid is the private TGuid of an interface\r\n      i = rtl.getIntfG(this,i.$guid,2);\r\n      if (i){\r\n        obj.set(i);\r\n        return true;\r\n      }\r\n    }\r\n  end;\r\n  Result := GetInterfaceByStr(GUIDToString(iid),obj);\r\nend;\r\n\r\nfunction TObject.GetInterface(const iidstr: String; out obj): boolean;\r\nbegin\r\n  Result := GetInterfaceByStr(iidstr,obj);\r\nend;\r\n\r\nfunction TObject.GetInterfaceByStr(const iidstr: String; out obj): boolean;\r\nbegin\r\n  Result:=false;\r\n  if not TJSObj(IObjectInstance)['$str'] then\r\n    TJSObj(IObjectInstance)['$str']:=GUIDToString(IObjectInstance);\r\n  if iidstr = TJSObj(IObjectInstance)['$str'] then\r\n    begin\r\n    obj:=Self;\r\n    exit(true);\r\n    end;\r\n  asm\r\n    var i = rtl.getIntfG(this,iidstr,2);\r\n    obj.set(i);\r\n    Result=(i!==null);\r\n  end;\r\nend;\r\n\r\nfunction TObject.GetInterfaceWeak(const iid: TGuid; out obj): boolean;\r\nbegin\r\n  Result:=GetInterface(iid,obj);\r\n  asm\r\n    if (Result){\r\n      var o = obj.get();\r\n      if (o.$kind==='com'){\r\n        o._Release();\r\n      }\r\n    }\r\n  end;\r\nend;\r\n\r\nfunction TObject.Equals(Obj: TObject): boolean;\r\nbegin\r\n  Result:=Obj=Self;\r\nend;\r\n\r\nfunction TObject.ToString: String;\r\nbegin\r\n  Result:=ClassName;\r\nend;\r\n\r\nclass function TObject.QualifiedClassName: String;\r\nbegin\r\n  Result := UnitName + '.' + ClassName;\r\nend;\r\n\r\ninitialization\r\n  ExitCode:=0; // set it here, so that WPO does not remove it\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit RTLConsts;\r\n\r\ninterface\r\n\r\nResourcestring\r\n  SArgumentMissing              = 'Missing argument in format \"%s\"';\r\n  SInvalidFormat                = 'Invalid format specifier : \"%s\"';\r\n  SInvalidArgIndex              = 'Invalid argument index in format: \"%s\"';\r\n  SListCapacityError            = 'List capacity (%s) exceeded.';\r\n  SListCountError               = 'List count (%s) out of bounds.';\r\n  SMapKeyError                  = 'Key not found : %s';\r\n  SListIndexError               = 'List index (%s) out of bounds';\r\n  SSortedListError              = 'Operation not allowed on sorted list';\r\n  SDuplicateString              = 'String list does not allow duplicates';\r\n  SDuplicateItem                = 'ThreadList does not allow duplicates';\r\n  SErrFindNeedsSortedList       = 'Cannot use find on unsorted list';\r\n\r\n  SInvalidName                  = 'Invalid component name: \"%s\"';\r\n  SInvalidBoolean               = '\"%s\" is not a valid boolean.';\r\n  SDuplicateName                = 'Duplicate component name: \"%s\"';\r\n\r\n  SErrInvalidDate               = 'Invalid date: \"%s\"';\r\n  SErrInvalidTimeFormat         = 'Invalid time format: \"%s\"';\r\n  SInvalidDateFormat            = 'Invalid date format: \"%s\"';\r\n\r\n  SCantReadPropertyS            = 'Cannot read property \"%s\"';\r\n  SCantWritePropertyS           = 'Cannot write property \"%s\"';\r\n  SErrPropertyNotFound          = 'Unknown property: \"%s\"';\r\n  SIndexedPropertyNeedsParams   = 'Indexed property \"%s\" needs parameters';\r\n  SErrInvalidTypecast           = 'Invalid class typecast';\r\n\r\n  SErrInvalidInteger            = 'Invalid integer value: \"%s\"';\r\n  SErrInvalidFloat              = 'Invalid floating-point value: \"%s\"';\r\n  SInvalidDateTime              = 'Invalid date-time value: %s';\r\n  SInvalidCurrency              = 'Invalid currency value: %s';\r\n  SErrInvalidDayOfWeek          = '%d is not a valid day of the week';\r\n  SErrInvalidTimeStamp          = 'Invalid date/timestamp : \"%s\"';\r\n  SErrInvalidDateWeek           = '%d %d %d is not a valid dateweek';\r\n  SErrInvalidDayOfYear          = 'Year %d does not have a day number %d';\r\n  SErrInvalidDateMonthWeek      = 'Year %d, month %d, Week %d and day %d is not a valid date.';\r\n  SErrInvalidDayOfWeekInMonth   = 'Year %d Month %d NDow %d DOW %d is not a valid date';\r\n  SInvalidJulianDate            = '%f Julian cannot be represented as a DateTime';\r\n  SErrInvalidHourMinuteSecMsec  = '%d:%d:%d.%d is not a valid time specification';\r\n\r\n  SInvalidGUID                  = '\"%s\" is not a valid GUID value';\r\n\r\n  SEmptyStreamIllegalReader       = 'Illegal Nil stream for TReader constructor';\r\n  SInvalidPropertyValue           = 'Invalid value for property';\r\n  SInvalidImage                   = 'Invalid stream format';\r\n  SUnknownProperty                = 'Unknown property: \"%s\"';\r\n  SUnknownPropertyType            = 'Unknown property type %s';\r\n  SAncestorNotFound               = 'Ancestor class for \"%s\" not found.';\r\n  SUnsupportedPropertyVariantType = 'Unsupported property variant type %d';\r\n  SPropertyException              = 'Error reading %s%s%s: %s';\r\n  SInvalidPropertyPath            = 'Invalid property path';\r\n  SReadOnlyProperty               = 'Property is read-only';\r\n  SClassNotFound                  = 'Class \"%s\" not found';\r\n\r\n  SEmptyStreamIllegalWriter       = 'Illegal Nil stream for TWriter constructor';\r\n  SErrInvalidPropertyType         = 'Invalid property type from streamed property: %d';\r\n  SParserExpected                 = 'Wrong token type: %s expected';\r\n  SParserInvalidFloat             = 'Invalid floating point number: %s';\r\n  SParserInvalidInteger           = 'Invalid integer number: %s';\r\n  SParserUnterminatedString       = 'Unterminated string';\r\n  SParserWrongTokenType           = 'Wrong token type: %s expected but %s found';\r\n  SParserWrongTokenSymbol         = 'Wrong token symbol: %s expected but %s found';\r\n  SParserLocInfo                  = ' (at %d,%d, stream offset %.8x)';\r\n  SParserUnterminatedBinValue     = 'Unterminated byte value';\r\n  SParserInvalidProperty          = 'Invalid property';\r\n  SRangeError                     = 'Range error';\r\n\r\n  SParamIsNegative                = 'Parameter \"%s\" cannot be negative.';\r\n\r\n  SErrNoStreaming                 = 'Failed to initialize component class \"%s\": No streaming method available.';\r\n  SResNotFound                    = 'Resource %s not found';\r\n  SErrResourceStreamNoWrite       = 'Cannot write to resource stream';\r\n  SErrResourceNotBase64           = 'Resource %s is not base64 encoded';\r\n  SErrUnknownResourceEncoding     = 'Unknown encoding for resource: \"%s\"';\r\n\r\nimplementation\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2018 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit Types;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\ntype\r\n  THandle = NativeInt;\r\n  TDirection = (FromBeginning, FromEnd);\r\n\r\n  TBooleanDynArray = array of Boolean;\r\n  TWordDynArray = array of Word;\r\n  TIntegerDynArray = array of Integer;\r\n  TNativeIntDynArray = array of NativeInt;\r\n  TStringDynArray = array of String;\r\n  TDoubleDynArray = array of Double;\r\n  TJSValueDynArray = array of JSValue;\r\n  TObjectDynArray = array of TObject;\r\n  TByteDynArray = array of Byte;\r\n\r\n  TDuplicates = (dupIgnore, dupAccept, dupError);\r\n  TProc = Reference to Procedure;\r\n  TProcString = Reference to Procedure(Const aString : String);\r\n\r\n  TListCallback = procedure(data, arg: JSValue) of object;\r\n  TListStaticCallback = procedure(data, arg: JSValue);\r\n\r\n  TSize  = record\r\n    cx, cy: integer;\r\n  end;\r\n\r\n  TPoint  = record\r\n    x, y: integer;\r\n  end;\r\n\r\n  TRect  = record\r\n    Left, Top, Right, Bottom: Integer;\r\n  end;\r\n  \r\nfunction EqualRect(const r1,r2 : TRect) : Boolean;\r\nfunction Rect(Left, Top, Right, Bottom : Integer) : TRect;\r\nfunction Bounds(ALeft, ATop, AWidth, AHeight : Integer) : TRect;\r\nfunction Point(x,y : Integer): TPoint; {$IFDEF Has_Inline}inline;{$ENDIF}\r\nfunction PtInRect(const aRect: TRect; const p: TPoint) : Boolean;\r\nfunction IntersectRect(out aRect: TRect; const R1,R2: TRect) : Boolean;\r\nfunction UnionRect(out aRect: TRect; const R1,R2: TRect) : Boolean;\r\nfunction IsRectEmpty(const aRect: TRect) : Boolean;\r\nfunction OffsetRect(var aRect: TRect; DX, DY: Integer) : Boolean;\r\nfunction CenterPoint(const aRect: TRect): TPoint;\r\nfunction InflateRect(var aRect: TRect; dx, dy: Integer): Boolean;\r\nfunction Size(AWidth, AHeight: Integer): TSize;\r\nfunction Size(const aRect: TRect): TSize;\r\n\r\nimplementation\r\n\r\nfunction EqualRect(const r1, r2: TRect): Boolean;\r\nbegin\r\n  Result:=(r1.left=r2.left) and (r1.right=r2.right) and (r1.top=r2.top) and (r1.bottom=r2.bottom);\r\nend;\r\n\r\nfunction Rect(Left, Top, Right, Bottom: Integer): TRect;\r\nbegin\r\n  Result.Left:=Left;\r\n  Result.Top:=Top;\r\n  Result.Right:=Right;\r\n  Result.Bottom:=Bottom;\r\nend;\r\n\r\nfunction Bounds(ALeft, ATop, AWidth, AHeight: Integer): TRect;\r\nbegin\r\n  Result.Left:=ALeft;\r\n  Result.Top:=ATop;\r\n  Result.Right:=ALeft+AWidth;\r\n  Result.Bottom:=ATop+AHeight;\r\nend;\r\n\r\nfunction Point(x, y: Integer): TPoint;\r\nbegin\r\n  Result.x:=x;\r\n  Result.y:=y;\r\nend;\r\n\r\nfunction PtInRect(const aRect: TRect; const p: TPoint): Boolean;\r\nbegin\r\n  Result:=(p.y>=aRect.Top) and\r\n          (p.y<aRect.Bottom) and\r\n          (p.x>=aRect.Left) and\r\n          (p.x<aRect.Right);\r\nend;\r\n\r\nfunction IntersectRect(out aRect: TRect; const R1, R2: TRect): Boolean;\r\nvar\r\n  lRect: TRect;\r\nbegin\r\n  lRect := R1;\r\n  if R2.Left > R1.Left then\r\n    lRect.Left := R2.Left;\r\n  if R2.Top > R1.Top then\r\n    lRect.Top := R2.Top;\r\n  if R2.Right < R1.Right then\r\n    lRect.Right := R2.Right;\r\n  if R2.Bottom < R1.Bottom then\r\n    lRect.Bottom := R2.Bottom;\r\n\r\n  // The var parameter is only assigned in the end to avoid problems\r\n  // when passing the same rectangle in the var and const parameters.\r\n  if IsRectEmpty(lRect) then\r\n  begin\r\n    aRect:=Rect(0,0,0,0);\r\n    Result:=false;\r\n  end\r\n  else\r\n  begin\r\n    Result:=true;\r\n    aRect := lRect;\r\n  end;\r\nend;\r\n\r\nfunction UnionRect(out aRect: TRect; const R1, R2: TRect): Boolean;\r\nvar\r\n  lRect: TRect;\r\nbegin\r\n  lRect:=R1;\r\n  if R2.Left<R1.Left then\r\n    lRect.Left:=R2.Left;\r\n  if R2.Top<R1.Top then\r\n    lRect.Top:=R2.Top;\r\n  if R2.Right>R1.Right then\r\n    lRect.Right:=R2.Right;\r\n  if R2.Bottom>R1.Bottom then\r\n    lRect.Bottom:=R2.Bottom;\r\n\r\n  if IsRectEmpty(lRect) then\r\n  begin\r\n    aRect:=Rect(0,0,0,0);\r\n    Result:=false;\r\n  end\r\n  else\r\n  begin\r\n    aRect:=lRect;\r\n    Result:=true;\r\n  end;\r\nend;\r\n\r\nfunction IsRectEmpty(const aRect: TRect): Boolean;\r\nbegin\r\n  Result:=(aRect.Right<=aRect.Left) or (aRect.Bottom<=aRect.Top);\r\nend;\r\n\r\nfunction OffsetRect(var aRect: TRect; DX, DY: Integer): Boolean;\r\nbegin\r\n  with aRect do\r\n    begin\r\n    inc(Left,dx);\r\n    inc(Top,dy);\r\n    inc(Right,dx);\r\n    inc(Bottom,dy);\r\n    end;\r\n  Result:=true;\r\nend;\r\n\r\nfunction CenterPoint(const aRect: TRect): TPoint;\r\n\r\n  function Avg(a, b: Longint): Longint;\r\n  begin\r\n    if a < b then\r\n      Result := a + ((b - a) shr 1)\r\n    else\r\n      Result := b + ((a - b) shr 1);\r\n  end;\r\n\r\nbegin\r\n  with aRect do\r\n    begin\r\n      Result.X := Avg(Left, Right);\r\n      Result.Y := Avg(Top, Bottom);\r\n    end;\r\nend;\r\n\r\nfunction InflateRect(var aRect: TRect; dx, dy: Integer): Boolean;\r\nbegin\r\n  with aRect do\r\n  begin\r\n    dec(Left, dx);\r\n    dec(Top, dy);\r\n    inc(Right, dx);\r\n    inc(Bottom, dy);\r\n  end;\r\n  Result := True;\r\nend;\r\n\r\nfunction Size(AWidth, AHeight: Integer): TSize;\r\nbegin\r\n  Result.cx := AWidth;\r\n  Result.cy := AHeight;\r\nend;\r\n\r\nfunction Size(const aRect: TRect): TSize;\r\nbegin\r\n  Result.cx := aRect.Right - aRect.Left;\r\n  Result.cy := aRect.Bottom - aRect.Top;\r\nend;\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017-2020 by the Pas2JS development team.\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit JS;\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  Types;\r\n\r\ntype\r\n  // We cannot use EConvertError or Exception, this would result in a circular dependency.\r\n\r\n  AsyncAttribute = class(TCustomAttribute);\r\n\r\n  ExternalJSAttribute = class(TCustomAttribute)\r\n  strict private\r\n    FName: string;\r\n  public\r\n    constructor Create(const AName: string);\r\n    property Name: string read FName;\r\n  end;\r\n\r\n  { EJS }\r\n\r\n  EJS = class(TObject)\r\n  private\r\n    FMessage: string;\r\n  Public\r\n    constructor Create(const Msg: String); reintroduce;\r\n    property Message : string Read FMessage Write FMessage;\r\n  end;\r\n\r\n  TJSObjectPropertyDescriptor = JSValue;\r\n  Float32 = Double;\r\n  Float64 = Double;\r\n\r\n  { TJSObject }\r\n\r\n  TJSObject = class external name 'Object'\r\n  private\r\n    function GetProperties(Name: String): JSValue; external name '[]';\r\n    procedure SetProperties(Name: String; const AValue: JSValue); external name '[]';\r\n  public\r\n    constructor new;\r\n    class function create(const proto: TJSObject): TJSObject;\r\n    class function create(const proto, propertiesObject: TJSObject): TJSObject;\r\n    class function assign(const Target, Source1: TJSObject): TJSObject; varargs;\r\n    class procedure defineProperty(const obj: TJSObject; propname: String; const descriptor: TJSObjectPropertyDescriptor);\r\n    //class procedure defineProperties\r\n    class function freeze(const obj: TJSObject): TJSObject;\r\n    class function getOwnPropertyDescriptor(const obj: TJSObject; propname: String): TJSObjectPropertyDescriptor;\r\n    //class function getOwnPropertyDescriptors\r\n    class function getOwnPropertyNames(const obj: TJSObject): TStringDynArray;\r\n    class function values(const obj: JSValue): TJSObject;\r\n    {$IFDEF FIREFOX}\r\n    class function getOwnPropertySymbols(const obj: TJSObject): TJSValueDynArray;\r\n    {$ENDIF}\r\n    class function getPrototypeOf(const obj: TJSObject): TJSObject;\r\n    {$IFDEF FIREFOX}\r\n    class function _is(const value1, value2: JSValue): boolean;\r\n    {$ENDIF}\r\n    class function isExtensible(const obj: TJSObject): boolean;\r\n    class function isFrozen(const obj: TJSObject): boolean;\r\n    class function isSealed(const obj: TJSObject): boolean;\r\n    class function keys(const obj: TJSObject): TStringDynArray;\r\n    class function preventExtensions(const obj: TJSObject): TJSObject;\r\n    class function seal(const obj: TJSObject): TJSObject;\r\n    class function setPrototypeOf(const obj, prototype: TJSObject): TJSObject;\r\n    function hasOwnProperty(prop: String): boolean;\r\n    function isPrototypeOf(const obj: TJSObject): boolean;\r\n    function propertyIsEnumerable(propname: String): boolean;\r\n    function toLocaleString: String;\r\n    function toString: String;\r\n    function valueOf: JSValue;\r\n    property Properties[Name: String]: JSValue read GetProperties write SetProperties; default;\r\n  end;\r\n\r\n  TJSObjectDynArray = Array of TJSObject;\r\n  TJSObjectDynArrayArray = Array of TJSObjectDynArray;\r\n  TJSStringDynArray = Array of String;\r\n\r\n\r\n  { TJSIteratorValue }\r\n  TJSIteratorValue = class external name 'IteratorValue'\r\n  public\r\n    value : JSValue; external name 'value';\r\n    done : boolean; external name 'done';\r\n  end;\r\n\r\n  { TJSIterator }\r\n  TJSIterator = class external name 'Iterator'\r\n  Public\r\n    function next: TJSIteratorValue;\r\n  end;\r\n\r\n\r\n  TJSSet = class;\r\n\r\n  TJSSetEventProc = reference to procedure(value : JSValue; key: NativeInt; set_: TJSSet);\r\n  TJSSetProcCallBack = reference  to procedure(value: JSValue; key: JSValue);\r\n\r\n   { TJSSet }\r\n  TJSSet = class external name 'Set'\r\n  private\r\n    FSize : NativeInt; external name 'size';\r\n  public\r\n    constructor new; overload;\r\n    constructor new(aElement1 : JSValue); varargs; overload;\r\n    function add(value: JSValue): TJSSet;\r\n    function has(value: JSValue): Boolean;\r\n    function delete(value: JSValue): Boolean;\r\n    procedure clear;\r\n    function values: TJSIterator;\r\n    procedure forEach(const aCallBack: TJSSetEventProc); overload;\r\n    procedure forEach(const aCallBack: TJSSetProcCallBack); overload;\r\n    procedure forEach(const aCallBack: TJSSetEventProc; thisArg: JSValue); overload;\r\n    function entries: TJSIterator;\r\n    function keys: TJSIterator;\r\n    Property size : NativeInt Read FSize;\r\n  end;\r\n\r\n  TJSMapFunctionCallBack = reference  to function(arg : JSValue): JSValue;\r\n  TJSMapProcCallBack = reference  to procedure(value: JSValue; key: JSValue);\r\n\r\n  { TJSMap }\r\n  TJSMap = class external name 'Map'\r\n  Private\r\n    FSize : NativeInt; external name 'size';\r\n  public\r\n    constructor new; varargs; overload;\r\n    constructor new(aElement1 : JSValue); varargs; overload;\r\n    function &set(key: JSValue; value: JSValue) :TJSMap;\r\n    function get(key : JSValue): JSValue;\r\n    function has(key: JSValue): Boolean;\r\n    function delete(key: JSValue): Boolean;\r\n    procedure clear;\r\n    function entries: TJSIterator;\r\n    procedure forEach(const aCallBack: TJSMapFunctionCallBack); overload;\r\n    procedure forEach(const aCallBack: TJSMapFunctionCallBack; thisArg: JSValue); overload;\r\n    procedure forEach(const aCallBack: TJSMapProcCallBack); overload;\r\n    function keys: TJSIterator;\r\n    function values: TJSIterator;\r\n    property size : NativeInt Read FSize;\r\n  end;\r\n\r\n  { TJSFunction }\r\n\r\n  TJSFunction = class external name 'Function'(TJSObject)\r\n  private\r\n    Flength: NativeInt external name 'length';\r\n    Fprototyp: TJSFunction external name 'prototyp';\r\n  public\r\n    name: String;\r\n    property prototyp: TJSFunction read Fprototyp;\r\n    property length: NativeInt read Flength;\r\n    function apply(thisArg: TJSObject; const ArgArray: TJSValueDynArray): JSValue; varargs;\r\n    function bind(thisArg: TJSObject): JSValue; varargs;\r\n    function call(thisArg: TJSObject): JSValue; varargs;\r\n  end;\r\n\r\n  { TJSDate - wrapper for JavaScript Date }\r\n\r\n  TJSDate = class external name 'Date'(TJSFunction)\r\n  private\r\n    function getDate: NativeInt;\r\n    function getFullYear: NativeInt;\r\n    function getHours: NativeInt;\r\n    function getMilliseconds: NativeInt;\r\n    function getMinutes: NativeInt;\r\n    function getMonth: NativeInt;\r\n    function getSeconds: NativeInt;\r\n    function getYear: NativeInt;\r\n    function getTime: NativeInt;\r\n    function getUTCDate: NativeInt;\r\n    function getUTCFullYear: NativeInt;\r\n    function getUTCHours: NativeInt;\r\n    function getUTCMilliseconds: NativeInt;\r\n    function getUTCMinutes: NativeInt;\r\n    function getUTCMonth: NativeInt;\r\n    function getUTCSeconds: NativeInt;\r\n    procedure setDate(const AValue: NativeInt);\r\n    procedure setFullYear(const AValue: NativeInt);\r\n    procedure setHours(const AValue: NativeInt);\r\n    procedure setMilliseconds(const AValue: NativeInt);\r\n    procedure setMinutes(const AValue: NativeInt);\r\n    procedure setMonth(const AValue: NativeInt);\r\n    procedure setSeconds(const AValue: NativeInt);\r\n    procedure setYear(const AValue: NativeInt);\r\n    procedure setTime(const AValue: NativeInt);\r\n    procedure setUTCDate(const AValue: NativeInt);\r\n    procedure setUTCFullYear(const AValue: NativeInt);\r\n    procedure setUTCHours(const AValue: NativeInt);\r\n    procedure setUTCMilliseconds(const AValue: NativeInt);\r\n    procedure setUTCMinutes(const AValue: NativeInt);\r\n    procedure setUTCMonth(const AValue: NativeInt);\r\n    procedure setUTCSeconds(const AValue: NativeInt);\r\n  public\r\n    constructor New; reintroduce;\r\n    constructor New(const MilliSecsSince1970: NativeInt); // milliseconds since 1 January 1970 00:00:00 UTC, with leap seconds ignored\r\n    constructor New(const aDateString: String); // RFC 2822, ISO8601\r\n    constructor New(aYear: NativeInt; aMonth: NativeInt; aDayOfMonth: NativeInt = 1;\r\n      TheHours: NativeInt = 0; TheMinutes: NativeInt = 0; TheSeconds: NativeInt = 0;\r\n      TheMilliseconds: NativeInt = 0);\r\n    class function now: NativeInt; // current date and time in milliseconds since 1 January 1970 00:00:00 UTC, with leap seconds ignored\r\n    class function parse(const aDateString: string): NativeInt; // format depends on browser\r\n    class function UTC(aYear: NativeInt; aMonth: NativeInt = 0; aDayOfMonth: NativeInt = 1;\r\n      TheHours: NativeInt = 0; TheMinutes: NativeInt = 0; TheSeconds: NativeInt = 0;\r\n      TheMilliseconds: NativeInt = 0): NativeInt;\r\n    function getDay: NativeInt;\r\n    function getTimezoneOffset: NativeInt;\r\n    function getUTCDay: NativeInt; // day of the week\r\n    function toDateString: string; // human readable date, without time\r\n    function toISOString: string; // ISO 8601 Extended Format\r\n    function toJSON: string;\r\n    function toGMTString: string; // in GMT timezone\r\n    function toLocaleDateString: string; overload; // date in locale timezone, no time\r\n    function toLocaleDateString(const aLocale : string) : string; overload; // date in locale timezone, no time\r\n    function toLocaleDateString(const aLocale : string; aOptions : TJSObject) : string; overload; // date in locale timezone, no time\r\n    function toLocaleString: string; reintroduce; // date and time in locale timezone\r\n    function toLocaleTimeString: string; // time in locale timezone, no date\r\n    function toTimeString: string; // time human readable, no date\r\n    function toUTCString: string; // date and time using UTC timezone\r\n    property Year: NativeInt read getYear write setYear;\r\n    property Time: NativeInt read getTime write setTime; // milliseconds since 1 January 1970 00:00:00 UTC, with leap seconds ignored\r\n    property FullYear: NativeInt read getFullYear write setFullYear;\r\n    property UTCDate: NativeInt read getUTCDate write setUTCDate; // day of month\r\n    property UTCFullYear: NativeInt read getUTCFullYear write setUTCFullYear;\r\n    property UTCHours: NativeInt read getUTCHours write setUTCHours;\r\n    property UTCMilliseconds: NativeInt read getUTCMilliseconds write setUTCMilliseconds;\r\n    property UTCMinutes: NativeInt read getUTCMinutes write setUTCMinutes;\r\n    property UTCMonth: NativeInt read getUTCMonth write setUTCMonth;\r\n    property UTCSeconds: NativeInt read getUTCSeconds write setUTCSeconds;\r\n    property Month: NativeInt read getMonth write setMonth;\r\n    property Date: NativeInt read getDate write setDate; // day of the month, starting at 1\r\n    property Hours: NativeInt read getHours write setHours;\r\n    property Minutes: NativeInt read getMinutes write setMinutes;\r\n    property Seconds: NativeInt read getSeconds write setSeconds;\r\n    property Milliseconds: NativeInt read getMilliseconds write setMilliseconds;\r\n  end;\r\n\r\n  TLocaleCompareOptions = record\r\n    localematched : string;\r\n    usage: string;\r\n    sensitivity : string;\r\n    ignorePunctuation : Boolean;\r\n    numeric : boolean;\r\n    caseFirst : string;\r\n  end;\r\n\r\n  TJSRegexp = class external name 'RegExp'\r\n  private\r\n  {$IFDEF FIREFOX}\r\n    // not on all browsers:\r\n    FFlags : string; external name 'flags';\r\n    FSticky : boolean; external name 'sticky';\r\n  {$endif}\r\n    fglobal: boolean; external name 'global';\r\n    fignoreCase : boolean; external name 'ignoreCase';\r\n    fmultiline : boolean; external name 'multiline';\r\n    fsource : string; external name 'source';\r\n    funicode : boolean; external name 'unicode';\r\n  public\r\n    Constructor New(Pattern : string);\r\n    Constructor New(Pattern, Flags : string);\r\n    lastIndex: NativeInt;\r\n    function exec(aString : string): TStringDynArray;\r\n    function test(aString : string) : boolean;\r\n    function toString : String;\r\n    property Global : boolean read fglobal;\r\n    property IgnoreCase : Boolean read FIgnoreCase;\r\n    property Multiline : Boolean Read FMultiLine;\r\n    Property Source : string Read FSource;\r\n    Property Unicode : boolean Read FUnicode;\r\n    {$IFDEF FIREFOX}\r\n    // not on all browsers:\r\n    property Flags : string read FFlags;\r\n    property Sticky : boolean read FSticky;\r\n    {$endif}\r\n  end;\r\n\r\n\r\n  TReplaceCallBack = reference to Function (Const match : string) : string; varargs;\r\n  TReplaceCallBack0 = reference to Function (Const match : string; offset : Integer; AString : String) : string;\r\n  TReplaceCallBack1 = reference to Function (Const match,p1 : string; offset : Integer; AString : String) : string;\r\n  TReplaceCallBack2 = reference to Function (Const match,p1,p2 : string; offset : Integer; AString : String) : string;\r\n\r\n  TJSString = class external name 'String'\r\n  private\r\n    flength : NativeInt; external name 'length';\r\n  public \r\n    constructor New(Const S : String);\r\n    constructor New(Const I : NativeInt);\r\n    constructor New(Const D : double);\r\n    property length : NativeInt read flength; \r\n    class function fromCharCode() : string; varargs;\r\n    class function fromCodePoint() : string; varargs;\r\n    function anchor(const aName : string) : string;\r\n    function charAt(aIndex : NativeInt) : string;\r\n    function charCodeAt(aIndex : NativeInt) : NativeInt;\r\n    function codePointAt(aIndex : NativeInt) : NativeInt;\r\n    function concat(s : string) : string; varargs;\r\n    function endsWith(aSearchString : string) : boolean; overload;\r\n    function endsWith(aSearchString : string; Pos : NativeInt) : boolean; overload;\r\n    function includes(aSearchString : string; Pos : NativeInt = 0) : boolean;\r\n    function indexOf(aSearchString : String; Pos : NativeInt = 0) : Integer;\r\n    function lastIndexOf(aSearchString : String) : NativeInt;overload;\r\n    function lastIndexOf(aSearchString : String; Pos : NativeInt) : Integer;overload;\r\n    function link(aUrl : string) : String;\r\n    function localeCompare(aCompareString : string) : NativeInt; overload;\r\n    function localeCompare(aCompareString : string; aLocales: string) : integer; overload;\r\n    function localeCompare(compareString : string; locales: string; Options : TlocaleCompareOptions) : integer; overload;\r\n    function match(aRegexp : TJSRegexp) : TStringDynArray; overload;\r\n    function match(aRegexp : String) : TStringDynArray;overload;\r\n    {$IFDEF ECMAScript6}\r\n    function normalize : string;\r\n    function normalize(aForm : string) : string;\r\n    {$ENDIF}\r\n    function _repeat(aCount : NativeInt) : Integer; external name 'repeat';\r\n    function replace(aRegexp : String; NewString : String) : String; overload;\r\n    function replace(aRegexp : TJSRegexp; NewString : String) : String; overload;\r\n    function replace(Regexp : String; aCallback : TReplaceCallBack) : String; overload;\r\n    function replace(Regexp : TJSRegexp; aCallback : TReplaceCallBack) : String; overload;\r\n    function replace(Regexp : String; aCallback : TReplaceCallBack0) : String; overload;\r\n    function replace(Regexp : TJSRegexp; aCallback : TReplaceCallBack0) : String; overload;\r\n    function replace(Regexp : String; aCallback : TReplaceCallBack1) : String; overload;\r\n    function replace(Regexp : TJSRegexp; aCallback : TReplaceCallBack1) : String; overload;\r\n    function replace(Regexp : String; aCallback : TReplaceCallBack2) : String; overload;\r\n    function replace(Regexp : TJSRegexp; aCallback : TReplaceCallBack2) : String; overload;\r\n    function search(Regexp : TJSRegexp) : NativeInt; overload;\r\n    function search(Regexp : JSValue) : NativeInt; overload;\r\n    function slice(aBeginIndex : NativeInt) : String; overload;\r\n    function slice(aBeginIndex, aEndIndex : NativeInt) : String; overload;\r\n    function split : TStringDynArray; overload;\r\n    function split(aRegexp : TJSRegexp) : TStringDynArray; overload;\r\n    function split(aSeparator : string) : TStringDynArray; overload;\r\n    function split(aSeparator : string; aLimit : NativeInt) : TStringDynArray; overload;\r\n    function split(aSeparator : array of string) : TStringDynArray; overload;\r\n    function split(aSeparator : array of string; aLimit : NativeInt) : TStringDynArray; overload;\r\n    function startsWith(aSearchString : String) : Boolean; overload;\r\n    function startsWith(aSearchString : String; aPosition : NativeInt) : Boolean; overload;\r\n    function substr(aStartIndex : NativeInt) : String; overload;\r\n    function substr(aStartIndex,aLength : NativeInt) : String; overload;\r\n    function substring(aStartIndex : NativeInt) : String; overload;\r\n    function substring(aStartIndex,aEndIndex : NativeInt) : String; overload;\r\n    function toLocaleLowerCase : String;\r\n    function toLocaleUpperCase : String;\r\n    function toLowerCase : String;\r\n    function toString : string;\r\n    function toUpperCase : String;\r\n    function trim : string;\r\n    function valueOf : string;\r\n  end;\r\n\r\n  TJSArray = Class;\r\n  \r\n  TJSArrayEventProc = reference to procedure(element : JSValue; index: NativeInt; anArray : TJSArray);\r\n  TJSArrayEvent = reference to function (element : JSValue; index: NativeInt; anArray : TJSArray) : Boolean;\r\n  TJSArrayMapEvent = reference to function (element : JSValue; index: NativeInt; anArray : TJSArray) : JSValue;\r\n  TJSArrayReduceEvent = reference to function (accumulator, currentValue : JSValue; currentIndex : NativeInt; anArray : TJSArray) : JSValue;\r\n  TJSArrayCompareEvent = reference to function (a,b : JSValue) : NativeInt;\r\n  TJSArrayCallback = TJSArrayEvent;\r\n  TJSArrayMapCallback = TJSArrayMapEvent;\r\n  TJSArrayReduceCallBack = TJSArrayReduceEvent;\r\n  TJSArrayCompareCallBack = TJSArrayCompareEvent;\r\n\r\n  { TJSArray }\r\n\r\n  TJSArray = Class external name 'Array'\r\n  private\r\n    function GetElements(Index: NativeInt): JSValue; external name '[]';\r\n    procedure SetElements(Index: NativeInt; const AValue: JSValue); external name '[]';\r\n  public\r\n    FLength : NativeInt; external name 'length';\r\n    constructor new; overload;\r\n    constructor new(aLength : NativeInt); overload;\r\n    constructor new(aElement1 : JSValue); varargs; overload;\r\n    class function _of() : TJSArray; varargs; external name 'of'; \r\n    class function isArray(a: JSValue) : Boolean;\r\n{$IFDEF JAVASCRIPT2015}    \r\n    class function from(a : JSValue) : TJSArray;\r\n    class function from(arrayLike : JSValue; mapFunction : TJSMapFunctionCallBack): TJSArray; overload;\r\n    class function from(arrayLike : JSValue; mapFunction : TJSMapFunctionCallBack; thisArg : JSValue): TJSArray; overload;\r\n{$ENDIF}\r\n    function concat(el : JSValue) : TJSArray; varargs;\r\n    function copyWithin(aTarget : NativeInt) : TJSarray;overload; // not in IE\r\n    function copyWithin(aTarget, aStart : NativeInt) : TJSarray;overload; // not in IE\r\n    function copyWithin(aTarget, aStart, aEnd : NativeInt) : TJSarray;overload; // not in IE\r\n    function entries: TJSIterator;\r\n    Function every(const aCallback : TJSArrayCallBack) : boolean;overload;\r\n    Function every(const aCallback : TJSArrayEvent; aThis : TObject) : boolean;overload;\r\n    Function filter(const aCallBack : TJSArrayCallBack) : TJSArray; overload;\r\n    Function filter(const aCallBack : TJSArrayEvent; aThis : TObject) : TJSArray;overload;\r\n    Function fill(aValue : JSValue) : TJSArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex : NativeInt) : TJSArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex,aEndIndex : NativeInt) : TJSArray; overload;\r\n    Function find(const aCallBack : TJSArrayCallBack) : JSValue; overload;\r\n    Function find(const aCallBack : TJSArrayEvent; aThis : TObject) : JSValue; overload;\r\n    Function findIndex(const aCallBack : TJSArrayCallBack) : NativeInt; overload;\r\n    Function findIndex(const aCallBack : TJSArrayEvent; aThis : TObject) : NativeInt; overload;\r\n    procedure forEach(const aCallBack : TJSArrayEventProc); overload;\r\n    procedure forEach(const aCallBack : TJSArrayEvent); overload;\r\n    procedure forEach(const aCallBack : TJSArrayEvent; aThis : TObject); overload;\r\n    function includes(aElement : JSValue) : Boolean; overload;\r\n    function includes(aElement : JSValue; FromIndex : NativeInt) : Boolean; overload;\r\n    function indexOf(aElement : JSValue) : NativeInt; overload;\r\n    function indexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    function join : String; overload;\r\n    function join (aSeparator : string) : String; overload;\r\n    function keys: TJSIterator;\r\n    function lastIndexOf(aElement : JSValue) : NativeInt; overload;\r\n    function lastIndexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n//    Function map(const aCallBack : TJSArrayMapEventArray) : JSValue; overload;\r\n    Function map(const aCallBack : TJSArrayMapCallBack) : TJSArray; overload;\r\n    Function map(const aCallBack : TJSArrayMapEvent; aThis : TObject) : TJSArray; overload;\r\n    function pop : JSValue; \r\n    function push(aElement : JSValue) : NativeInt; varargs;\r\n    function reduce(const aCallBack : TJSArrayReduceCallBack) : JSValue; overload;\r\n    function reduce(const aCallBack : TJSArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSArrayReduceCallBack) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    Function reverse : TJSArray;\r\n    Function shift : JSValue;\r\n    Function slice : TJSArray; overload;\r\n    function slice(aBegin : NativeInt) : TJSArray; overload;\r\n    function slice(aBegin,aEnd : NativeInt) : TJSArray; overload;\r\n    Function some(const aCallback : TJSArrayCallBack) : boolean; overload;\r\n    Function some(const aCallback : TJSArrayEvent; aThis : TObject) : boolean; overload;\r\n    Function sort(const aCallback : TJSArrayCompareCallBack) : TJSArray; overload;\r\n    Function sort() : TJSArray; overload;\r\n    function splice(aStart : NativeInt) : TJSArray; overload;\r\n    function splice(aStart,aDeleteCount : NativeInt) : TJSArray; varargs; overload;\r\n    function toLocaleString: String; overload;\r\n    function toLocaleString(locales : string) : String; overload;\r\n    function toLocaleString(locales : string; const Options : TLocaleCompareOptions) : String; overload;\r\n    function toString : String;\r\n    function unshift : NativeInt; varargs;\r\n    function values: TJSIterator;\r\n    Property Length : NativeInt Read FLength Write FLength;\r\n    property Elements[Index: NativeInt]: JSValue read GetElements write SetElements; default;\r\n  end;\r\n\r\n  TJSArrayBuffer = Class external name 'ArrayBuffer' (TJSObject)\r\n  private\r\n    fLength : NativeInt; external name 'byteLength';\r\n  public\r\n    constructor new(aByteLength : NativeInt);\r\n    class function isView(aValue : JSValue) : Boolean;   \r\n    function slice(aBegin : NativeInt) : TJSArrayBuffer; overload;\r\n    function slice(aBegin,aEnd : NativeInt) : TJSArrayBuffer; overload;\r\n    Property byteLength : NativeInt Read fLength;\r\n  end;\r\n\r\n  TJSBufferSource = class external name 'BufferSource'\r\n  end;\r\n\r\n  { TJSTypedArray }\r\n  TJSTypedArray = Class;\r\n\r\n  TJSTypedArrayCallBack = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : Boolean;\r\n  TJSTypedArrayEvent = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : Boolean of object;\r\n  TJSTypedArrayMapCallBack = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : JSValue;\r\n  TJSTypedArrayMapEvent = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : JSValue of object;\r\n  TJSTypedArrayReduceCallBack = function (accumulator, currentValue : JSValue; currentIndex : NativeInt; anArray : TJSTypedArray) : JSValue;\r\n  TJSTypedArrayCompareCallBack = function (a,b : JSValue) : NativeInt;\r\n\r\n  TJSTypedArray = class external name 'TypedArray' (TJSBufferSource)\r\n  Private\r\n    FBuffer: TJSArrayBuffer; external name 'buffer';\r\n    FByteLength: NativeInt; external name 'byteLength';\r\n    FLength: NativeInt; external name 'length';\r\n    FByteOffset: NativeInt; external name 'byteOffset';\r\n    FBytesPerElement : NativeInt; external name 'BYTES_PER_ELEMENT';\r\n    function getValue(Index : NativeInt) : JSValue; external name '[]';\r\n    procedure setValue(Index : NativeInt;AValue : JSValue); external name '[]';\r\n  Public\r\n    property BYTES_PER_ELEMENT : NativeInt Read FBytesPerElement;\r\n    class var name : string;\r\n//    class function from(aValue : jsValue) : TJSTypedArray;\r\n//    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSTypedArray;\r\n//    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSTypedArray;\r\n    class function _of(aValue : jsValue) : TJSTypedArray; varargs; external name 'of';\r\n    function copyWithin(aTarget : NativeInt) : TJSTypedArray;overload;\r\n    function copyWithin(aTarget, aStart : NativeInt) : TJSTypedArray;overload;\r\n    function copyWithin(aTarget, aStart, aEnd : NativeInt) : TJSTypedArray;overload;\r\n    Function every(const aCallback : TJSTypedArrayCallBack) : boolean;overload;\r\n    Function every(const aCallback : TJSTypedArrayEvent; aThis : TObject) : boolean;overload;\r\n    Function fill(aValue : JSValue) : TJSTypedArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex : NativeInt) : TJSTypedArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex,aEndIndex : NativeInt) : TJSTypedArray; overload;\r\n    Function filter(const aCallBack : TJSTypedArrayCallBack) : TJSTypedArray; overload;\r\n    Function filter(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : TJSTypedArray;overload;\r\n    Function find(const aCallBack : TJSTypedArrayCallBack) : JSValue; overload;\r\n    Function find(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : JSValue; overload;\r\n    Function findIndex(const aCallBack : TJSTypedArrayCallBack) : NativeInt; overload;\r\n    Function findIndex(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : NativeInt; overload;\r\n    procedure forEach(const aCallBack : TJSTypedArrayCallBack); overload;\r\n    procedure forEach(const aCallBack : TJSTypedArrayEvent; aThis : TObject); overload;\r\n    function includes(aElement : JSValue) : Boolean; overload;\r\n    function includes(aElement : JSValue; FromIndex : NativeInt) : Boolean; overload;\r\n    function indexOf(aElement : JSValue) : NativeInt; overload;\r\n    function indexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    function join : String; overload;\r\n    function join (aSeparator : string) : String; overload;\r\n    function lastIndexOf(aElement : JSValue) : NativeInt; overload;\r\n    function lastIndexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    Function map(const aCallBack : TJSTypedArrayCallBack) : TJSTypedArray; overload;\r\n    Function map(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : TJSTypedArray; overload;\r\n    function reduce(const aCallBack : TJSTypedArrayReduceCallBack) : JSValue; overload;\r\n    function reduce(const aCallBack : TJSTypedArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSTypedArrayReduceCallBack) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSTypedArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    Function reverse : TJSTypedArray;\r\n    procedure _set(anArray : TJSArray); external name 'set';\r\n    procedure _set(anArray : TJSArray; anOffset : NativeInt); external name 'set';\r\n    procedure _set(anArray : TJSTypedArray); external name 'set';\r\n    procedure _set(anArray : TJSTypedArray; anOffset : NativeInt); external name 'set';\r\n    Function slice : TJSTypedArray; overload;\r\n    function slice(aBegin : NativeInt) : TJSTypedArray; overload;\r\n    function slice(aBegin,aEnd : NativeInt) : TJSTypedArray; overload;\r\n    Function some(const aCallback : TJSTypedArrayCallBack) : boolean; overload;\r\n    Function some(const aCallback : TJSTypedArrayEvent; aThis : TObject) : boolean; overload;\r\n    Function sort(const aCallback : TJSTypedArrayCompareCallBack) : TJSTypedArray; overload;\r\n    Function sort() : TJSTypedArray; overload;\r\n    function splice(aStart : NativeInt) : TJSTypedArray; overload;\r\n    function splice(aStart,aDeleteCount : NativeInt) : TJSTypedArray; varargs; overload;\r\n    function toLocaleString: String; overload;\r\n    function toLocaleString(locales : string) : String; overload;\r\n    function toLocaleString(locales : string; const Options : TLocaleCompareOptions) : String; overload;\r\n    function toString : String;\r\n    function unshift : NativeInt; varargs;\r\n    property buffer : TJSArrayBuffer read FBuffer;\r\n    property byteLength : NativeInt Read FByteLength;\r\n    property byteOffset : NativeInt Read FByteOffset;\r\n    property length : NativeInt Read FLength;\r\n    property values[Index : NativeInt] : JSValue Read getValue Write SetValue; default;\r\n  end;\r\n\r\n  { TJSInt8Array }\r\n\r\n  TJSInt8Array = class external name 'Int8Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Shortint; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Shortint);external name '[]';\r\n  public\r\n{$IFDEF JAVASCRIPT2017}\r\n    constructor new; // new in ES2017\r\n{$ENDIF}\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSInt8Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSInt8Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSInt8Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSInt8Array; varargs; external name 'of'; reintroduce;overload;\r\n    class function _of(aValue : TJSValueDynArray) : TJSInt8Array; varargs; external name 'of'; reintroduce; overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSInt8Array;  overload;\r\n    function subarray(aBegin: Integer): TJSInt8Array; overload;\r\n    procedure _set(anArray : Array of ShortInt); external name 'set'; reintroduce; overload;\r\n    procedure _set(anArray : Array of ShortInt; anOffset : NativeInt); external name 'set';\r\n    property values[Index : NativeInt] : Shortint Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint8Array  = class external name 'Uint8Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Byte; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Byte);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt8Array; reintroduce; overload;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt8Array; reintroduce;overload;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt8Array; reintroduce;overload;\r\n    class function _of(aValue : jsValue) : TJSUInt8Array; varargs; external name 'of'; reintroduce; overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSUInt8Array;  overload;\r\n    function subarray(aBegin: Integer): TJSUInt8Array; overload;\r\n    procedure _set(anArray : Array of Byte); external name 'set'; reintroduce; overload;\r\n    procedure _set(anArray : Array of Byte; anOffset : NativeInt); external name 'set'; overload;\r\n    Property values[Index : NativeInt] : Byte Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint8ClampedArray  = class external name 'Uint8ClampedArray' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Byte; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Byte);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt8ClampedArray; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt8ClampedArray; reintroduce;overload;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt8ClampedArray; reintroduce;overload;\r\n    class function _of(aValue : jsValue) : TJSUInt8ClampedArray; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of Byte); external name 'set'; reintroduce;overload;\r\n    procedure _set(anArray : Array of Byte; anOffset : NativeInt); external name 'set';overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSUInt8ClampedArray;  overload;\r\n    function subarray(aBegin: Integer): TJSUInt8ClampedArray; overload;\r\n    Property values[Index : NativeInt] : Byte Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSInt16Array = class external name 'Int16Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): smallint; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Smallint);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSInt16Array; reintroduce;overload;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSInt16Array; reintroduce;overload;\r\n    class function _of(aValue : jsValue) : TJSInt16Array; varargs; external name 'of'; reintroduce;overload;\r\n    procedure _set(anArray : Array of SmallInt); external name 'set'; reintroduce;overload;\r\n    procedure _set(anArray : Array of SmallInt; anOffset : NativeInt); external name 'set';overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSInt16Array;  overload;\r\n    function subarray(aBegin: Integer): TJSInt16Array; overload;\r\n    Property values[Index : NativeInt] : SmallInt Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint16Array = class external name 'Uint16Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Word; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Word);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt16Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSUInt16Array; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of Word); external name 'set'; reintroduce; overload;\r\n    procedure _set(anArray : Array of Word; anOffset : NativeInt); external name 'set'; overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSUInt16Array;  overload;\r\n    function subarray(aBegin: Integer): TJSUInt16Array; overload;\r\n    Property values[Index : NativeInt] : Word Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSInt32Array = class external name 'Int32Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): longint; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: longint);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSInt32Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSInt32Array; varargs;external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of LongInt); external name 'set'; reintroduce; overload;\r\n    procedure _set(anArray : Array of LongInt; anOffset : NativeInt); external name 'set'; overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSInt32Array;  overload;\r\n    function subarray(aBegin: Integer): TJSInt32Array; overload;\r\n    Property values[Index : NativeInt] : longint Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint32Array = class external name 'Uint32Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): LongWord; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: LongWord);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt32Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSUInt32Array; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of Cardinal); external name 'set'; reintroduce; overload;\r\n    procedure _set(anArray : Array of Cardinal; anOffset : NativeInt); external name 'set'; overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSUInt32Array;  overload;\r\n    function subarray(aBegin: Integer): TJSUInt32Array; overload;\r\n    Property values[Index : NativeInt] : LongWord Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSFloat32Array = class external name 'Float32Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Float32; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Float32);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSFloat32Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSFloat32Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSFloat32Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSFloat32Array; varargs; reintroduce;\r\n    procedure _set(anArray : Array of Double); external name 'set'; reintroduce; overload;\r\n    procedure _set(anArray : Array of Double; anOffset : NativeInt); external name 'set'; reintroduce; overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSFloat32Array;  overload;\r\n    function subarray(aBegin: Integer): TJSFloat32Array; overload;\r\n    Property values[Index : NativeInt] : Float32 Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSFloat64Array = class external name 'Float64Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Float64; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Float64);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSFloat64Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSFloat64Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSFloat64Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSFloat64Array; varargs; reintroduce;\r\n    procedure _set(anArray : Array of Double); external name 'set'; reintroduce; overload;\r\n    procedure _set(anArray : Array of Double; anOffset : NativeInt); external name 'set'; reintroduce; overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSFloat64Array;  overload;\r\n    function subarray(aBegin: Integer): TJSFloat64Array; overload;\r\n    Property values[Index : NativeInt] : Float64 Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSDataView = Class external name 'DataView' (TJSBufferSource)\r\n  private\r\n    fBuffer : TJSArrayBuffer; external name 'buffer';\r\n    fLength : NativeInt; external name 'byteLength';\r\n    fOffset : NativeInt; external name 'byteOffset';\r\n  public\r\n    constructor new(aBuffer : TJSArrayBuffer); overload;\r\n    constructor new(aBuffer : TJSArrayBuffer; aOffset : NativeInt); overload;\r\n    constructor new(aBuffer : TJSArrayBuffer; aOffset,aByteLength : NativeInt); overload;\r\n    function getFloat32(aByteOffset : NativeInt) : double; overload;\r\n    function getFloat32(aByteOffset : NativeInt; aLittleEndian: Boolean) : double; overload;\r\n    function getFloat64(aByteOffset : NativeInt) : double; overload;\r\n    function getFloat64(aByteOffset : NativeInt; aLittleEndian: Boolean) : double; overload;\r\n    function getInt8(aByteOffset : NativeInt) : ShortInt; \r\n    function getInt16(aByteOffset : NativeInt) : SmallInt; overload;\r\n    function getInt16(aByteOffset : NativeInt; aLittleEndian : Boolean) : SmallInt; overload;\r\n    function getInt32(aByteOffset : NativeInt) : Longint; overload;\r\n    function getInt32(aByteOffset : NativeInt; aLittleEndian : Boolean) : Longint; overload;\r\n    function getUint8(aByteOffset : NativeInt) : Byte; overload;\r\n    function getUint16(aByteOffset : NativeInt) : Word; overload;\r\n    function getUint16(aByteOffset : NativeInt; aLittleEndian : Boolean) : Word; overload;\r\n    function getUint32(aByteOffset : NativeInt) : LongWord; overload;\r\n    function getUint32(aByteOffset : NativeInt; aLittleEndian : Boolean) : LongWord; overload;\r\n\r\n    procedure setFloat32(aByteOffset : NativeInt; aValue : double); overload;\r\n    procedure setFloat32(aByteOffset : NativeInt; aValue : double; aLittleEndian: Boolean); overload;\r\n    procedure setFloat64(aByteOffset : NativeInt; aValue : double); overload;\r\n    procedure setFloat64(aByteOffset : NativeInt; aValue : double; aLittleEndian: Boolean); overload;\r\n    procedure setInt8(aByteOffset : NativeInt; aValue : ShortInt); \r\n    procedure setInt16(aByteOffset : NativeInt; aValue : SmallInt); overload;\r\n    procedure setInt16(aByteOffset : NativeInt; aValue : SmallInt; aLittleEndian : Boolean); overload;\r\n    procedure setInt32(aByteOffset : NativeInt; aValue : Longint); overload;\r\n    procedure setInt32(aByteOffset : NativeInt; aValue : Longint; aLittleEndian : Boolean); overload;\r\n    procedure setUint8(aByteOffset : NativeInt; aValue : Byte); overload;\r\n    procedure setUint16(aByteOffset : NativeInt; aValue : Word); overload;\r\n    procedure setUint16(aByteOffset : NativeInt; aValue : Word; aLittleEndian : Boolean); overload;\r\n    procedure setUint32(aByteOffset : NativeInt; aValue : LongWord); overload;\r\n    procedure setUint32(aByteOffset : NativeInt; aValue: LongWord; aLittleEndian : Boolean); overload;\r\n    Property byteLength : NativeInt Read fLength;\r\n    Property byteOffset : NativeInt read fOffset;\r\n    property buffer : TJSArrayBuffer Read fBuffer;\r\n  end;\r\n\r\n  TJSJSON = class external name 'JSON' (TJSObject)\r\n  Public\r\n    class function parse(aJSON : String) : JSValue;\r\n    // Use this only when you are sure you will get an object, no checking is done.\r\n    class function parseObject(aJSON : String) : TJSObject; external name 'parse';\r\n    class function stringify(aValue : JSValue) : string;\r\n    class function stringify(aValue,aReplacer : JSValue) : string;\r\n    class function stringify(aValue,aReplacer : JSValue; space:  NativeInt) : string;\r\n    class function stringify(aValue,aReplacer : JSValue; space:  String) : string;\r\n  end;\r\n\r\n  { TJSError }\r\n\r\n  TJSError = Class external name 'Error'   (TJSObject)\r\n  private\r\n    FMessage: String; external name 'message';\r\n    {$ifdef NodeJS}\r\n    FStack: JSValue; external name 'stack';\r\n    {$endif}\r\n  Public\r\n    Constructor new;\r\n    Constructor new(Const aMessage : string);\r\n    Constructor new(Const aMessage,aFileName : string);\r\n    Constructor new(Const aMessage,aFileName : string; aLineNumber : NativeInt);\r\n    Property Message : String Read FMessage;\r\n    {$ifdef NodeJS}\r\n    Property Stack: JSValue read FStack;\r\n    {$endif}\r\n  end;\r\n\r\n\r\n  TJSPromiseResolver = reference to function (aValue : JSValue) : JSValue;\r\n  TJSPromiseExecutor = reference to procedure (resolve,reject : TJSPromiseResolver);\r\n  TJSPromiseFinallyHandler = reference to procedure;\r\n  TJSPromise = Class;\r\n  TJSPromiseArray = array of TJSPromise;\r\n\r\n  TJSPromise = class external name 'Promise'\r\n    constructor new(Executor : TJSPromiseExecutor);\r\n    class function all(arg : Array of JSValue) : TJSPromise; overload;\r\n    class function all(arg : JSValue) : TJSPromise; overload;\r\n    class function all(arg : TJSPromiseArray) : TJSPromise; overload;\r\n    class function race(arg : Array of JSValue) : TJSPromise; overload;\r\n    class function race(arg : JSValue) : TJSPromise; overload;\r\n    class function race(arg : TJSPromiseArray) : TJSPromise; overload;\r\n    class function reject(reason : JSValue) : TJSPromise;\r\n    class function resolve(value : JSValue): TJSPromise; overload;\r\n    class function resolve : TJSPromise; overload;\r\n    function _then (onAccepted : TJSPromiseResolver) : TJSPromise; external name 'then';\r\n    function _then (onAccepted,OnRejected: TJSPromiseResolver) : TJSPromise; external name 'then';\r\n    function catch (onRejected : TJSPromiseResolver) : TJSPromise;\r\n    function _finally(value : TJSPromiseFinallyHandler): TJSPromise; external name 'finally';\r\n  end;\r\n\r\n\r\n  TJSFunctionArguments = class external name 'arguments'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    function GetElements(Index: NativeInt): JSValue; external name '[]';\r\n    procedure SetElements(Index: NativeInt; const AValue: JSValue); external name '[]';\r\n  public\r\n    property Length: NativeInt read FLength;\r\n    property Elements[Index: NativeInt]: JSValue read GetElements write SetElements; default;\r\n  end;\r\n\r\n  TJSIteratorResult = Class external name 'IteratorResult' (TJSObject)\r\n  Private\r\n    fDone : Boolean; external name 'done';\r\n    fValue : JSValue; external name 'value';\r\n  Public\r\n    property done : boolean Read FDone;\r\n    property value : JSValue read FValue;\r\n  end;\r\n\r\n  TJSAsyncIterator = Class external name 'AsyncIterator' (TJSObject)\r\n    function next: TJSIteratorResult;\r\n  end;\r\n\r\n  TJSSyntaxError = class external name 'SyntaxError' (TJSError);\r\n\r\n  TJSTextDecoderOptions = class external name 'Object' (TJSObject)\r\n    fatal : Boolean;\r\n    ignoreBOM : Boolean;\r\n  end;\r\n\r\n  TJSTextDecodeOptions = class external name 'Object' (TJSObject)\r\n    stream : Boolean;\r\n  end;\r\n\r\n  TJSTextDecoder = class external name 'TextDecoder' (TJSObject)\r\n  Private\r\n    FEncoding : String; external name 'encoding';\r\n    FFatal : Boolean; external name 'fatal';\r\n    FIgnoreBOM : Boolean; external name 'ignoreBOM';\r\n  Public\r\n    Constructor New(utfLabel : String); overload;\r\n    Constructor New(utfLabel : String; Options : TJSTextDecoderOptions); overload;\r\n    Function decode(arr : TJSTypedArray) : String; overload;\r\n    Function decode(arr : TJSArrayBuffer) : String; overload;\r\n    Function decode(arr : TJSTypedArray; opts : TJSTextDecodeOptions) : String; overload;\r\n    Function decode(arr : TJSArrayBuffer; opts : TJSTextDecodeOptions) : String; overload;\r\n    property Encoding : string Read FEncoding;\r\n    Property Fatal : Boolean Read FFatal;\r\n    Property IgnoreBOM : Boolean Read FIgnoreBOM;\r\n  end;\r\n\r\n  TJSTextEncoderEncodeIntoResult = class external name 'Object' (TJSObject)\r\n    read : Nativeint;\r\n    written : NativeInt;\r\n  end;\r\n\r\n  TJSTextEncoder = class external name 'TextEncoder' (TJSObject)\r\n  Private\r\n    FEncoding : String; external name 'encoding';\r\n  Public\r\n    Constructor New;\r\n    function encode(aString : String) : TJSUInt8Array;\r\n    Function encodeInto(aString : String; aArray : TJSUInt8Array) : TJSTextEncoderEncodeIntoResult;\r\n    Property Encoding : string Read FEncoding;\r\n  end;\r\n\r\nvar\r\n  // JSArguments can be used in procedures/functions to provide access to the 'arguments' array.\r\n  JSArguments: TJSFunctionArguments; external name 'arguments';\r\n  // JSThis can be used in all code to access the javascript 'this' object.\r\n  JSThis: TJSObject; external name 'this';\r\n  // JSExceptValue can be used in catch blocks to access the JS throw value\r\n  JSExceptValue: JSValue; external name '$e';\r\n\r\nfunction new(aElements: TJSValueDynArray) : TJSObject; overload;\r\nfunction JSDelete(const Obj: JSValue; const PropName: string): boolean; assembler; overload;\r\n\r\nfunction decodeURIComponent(encodedURI : String) : String; external name 'decodeURIComponent';\r\nfunction encodeURIComponent(str : String) : String; external name 'encodeURIComponent';\r\n\r\nfunction parseInt(s: String; Radix: NativeInt): NativeInt; overload; external name 'parseInt'; // may result NaN\r\nfunction parseInt(s: String): NativeInt; overload; external name 'parseInt'; // may result NaN\r\nfunction parseFloat(s: String): double; overload; external name 'parseFloat'; // may result NaN\r\n\r\nfunction hasString(const v: JSValue): boolean; external name 'rtl.hasString';// isString(v) and v<>''\r\nfunction hasValue(const v: JSValue): boolean; assembler; // returns the JS definition of if(v): v is not false, undefined, null, 0, NaN, or the empty string. Note: JS if(new Boolean(false)) returns true.\r\nfunction isArray(const v: JSValue): boolean; external name 'rtl.isArray';\r\nfunction isBoolean(const v: JSValue): boolean; assembler;\r\nfunction isDate(const v: JSValue): boolean; assembler;\r\nfunction isCallback(const v: JSValue): boolean; assembler;\r\nfunction isChar(const v: JSValue): boolean; assembler;\r\nfunction isClass(const v: JSValue): boolean; assembler; // is a Pascal class, e.g. a TClass\r\nfunction isClassInstance(const v: JSValue): boolean; assembler;// is a Pascal class instance, e.g. a TObject\r\nfunction isFunction(const v: JSValue): boolean; external name 'rtl.isFunction';\r\nfunction isInteger(const v: JSValue): boolean; assembler;\r\nfunction isModule(const v: JSValue): boolean; external name 'rtl.isModule';\r\nfunction isNull(const v: JSValue): boolean; assembler;\r\nfunction isNumber(const v: JSValue): boolean; external name 'rtl.isNumber';\r\nfunction isObject(const v: JSValue): boolean; external name 'rtl.isObject'; // true if not null and a JS Object\r\nfunction isRecord(const v: JSValue): boolean; assembler;\r\nfunction isString(const v: JSValue): boolean; external name 'rtl.isString';\r\nfunction isUndefined(const v: JSValue): boolean; assembler;\r\nfunction isDefined(const v: JSValue): boolean; assembler;\r\nfunction isUTF16Char(const v: JSValue): boolean; assembler;\r\nfunction isExt(const InstanceOrClass, aClass: JSValue): boolean; external name 'rtl.isExt'; // aClass can be a JS object or function\r\nfunction jsInstanceOf(const aFunction, aFunctionWithPrototype: JSValue): Boolean; assembler;\r\nfunction jsTypeOf(const v: JSValue): String; external name 'typeof';\r\nfunction jsIsNaN(const v: JSValue): boolean; external name 'isNaN';// true if value cannot be converted to a number. e.g. True on NaN, undefined, {}, '123'. False on true, null, '', ' ', '1A'\r\nfunction jsIsFinite(const v: JSValue): boolean; external name 'isFinite';// true if value is a Finite number\r\nfunction toNumber(const v: JSValue): double; assembler; // if not possible, returns NaN\r\nfunction toInteger(const v: JSValue): NativeInt; // if v is not an integer, returns 0\r\nfunction toObject(Value: JSValue): TJSObject; // If Value is not a Javascript object, returns Nil\r\nfunction toArray(Value: JSValue): TJSArray; // If Value is not a Javascript array, returns Nil\r\nfunction toBoolean(Value: JSValue): Boolean; // If Value is not a Boolean, returns False\r\nfunction toString(Value: JSValue): String; // If Value is not a string, returns ''\r\n\r\nType\r\n  TJSValueType = (jvtNull,jvtBoolean,jvtInteger,jvtFloat,jvtString,jvtObject,jvtArray);\r\n\r\nFunction GetValueType(JS : JSValue) : TJSValueType;\r\n\r\nConst\r\n  Null : JSValue; external name 'null';\r\n  Undefined : JSValue; external name 'undefined';\r\n\r\nimplementation\r\n\r\nfunction new(aElements: TJSValueDynArray): TJSObject;\r\n\r\n  function toString(I : Integer): string; external name 'String';\r\n\r\nVar\r\n  L,I : integer;\r\n  S : String;\r\n\r\nbegin\r\n  L:=length(aElements);\r\n  if (L mod 2)=1 then\r\n    raise EJS.Create('Number of arguments must be even');\r\n  I:=0;\r\n  // Check all arguments;\r\n  While (i<L) do\r\n    begin\r\n    if Not isString(aElements[i]) then\r\n      begin\r\n      S:=ToString(I);\r\n      raise EJS.Create('Argument '+S+' must be a string.');\r\n      end;\r\n    inc(I,2);\r\n    end;\r\n  I:=0;\r\n  Result:=TJSObject.New;\r\n  While (i<L) do\r\n    begin\r\n    S:=String(aElements[i]);\r\n    Result.Properties[S]:=aElements[i+1];\r\n    inc(I,2);\r\n    end;\r\nend;\r\n\r\nfunction JSDelete(const Obj: JSValue; const PropName: string): boolean; assembler;\r\nasm\r\n  return delete Obj[PropName];\r\nend;\r\n\r\nfunction hasValue(const v: JSValue): boolean; assembler;\r\nasm\r\n  if(v){ return true; } else { return false; };\r\nend;\r\n\r\nfunction isBoolean(const v: JSValue): boolean; assembler;\r\nasm\r\n  return typeof(v) == 'boolean';\r\nend;\r\n\r\nfunction isDate(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (v instanceof Date);\r\nend;\r\n\r\nfunction isCallback(const v: JSValue): boolean; assembler;\r\nasm\r\n  return rtl.isObject(v) && rtl.isObject(v.scope) && (rtl.isString(v.fn) || rtl.isFunction(v.fn));\r\nend;\r\n\r\nfunction isChar(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)!=\"string\") && (v.length==1);\r\nend;\r\n\r\nfunction isClass(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)==\"object\") && (v!=null) && (v.$class == v);\r\nend;\r\n\r\nfunction isClassInstance(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)==\"object\") && (v!=null) && (v.$class == Object.getPrototypeOf(v));\r\nend;\r\n\r\nfunction isInteger(const v: JSValue): boolean; assembler;\r\nasm\r\n  return Math.floor(v)===v;\r\nend;\r\n\r\nfunction isNull(const v: JSValue): boolean; assembler;\r\n// Note: use identity, \"==\" would fit undefined\r\nasm\r\n  return v === null;\r\nend;\r\n\r\nfunction isRecord(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)===\"object\")\r\n      && (typeof(v.$new)===\"function\")\r\n      && (typeof(v.$clone)===\"function\")\r\n      && (typeof(v.$eq)===\"function\")\r\n      && (typeof(v.$assign)===\"function\");\r\nend;\r\n\r\nfunction isUndefined(const v: JSValue): boolean; assembler;\r\nasm\r\n  return v == undefined;\r\nend;\r\n\r\nfunction isDefined(const v: JSValue): boolean; assembler;\r\nasm\r\n  return !(v == undefined);\r\nend;\r\n\r\nfunction isUTF16Char(const v: JSValue): boolean; assembler;\r\nasm\r\n  if (typeof(v)!=\"string\") return false;\r\n  if ((v.length==0) || (v.length>2)) return false;\r\n  var code = v.charCodeAt(0);\r\n  if (code < 0xD800){\r\n    if (v.length == 1) return true;\r\n  } else if (code <= 0xDBFF){\r\n    if (v.length==2){\r\n      code = v.charCodeAt(1);\r\n      if (code >= 0xDC00 && code <= 0xDFFF) return true;\r\n    };\r\n  };\r\n  return false;\r\nend;\r\n\r\nfunction jsInstanceOf(const aFunction, aFunctionWithPrototype: JSValue\r\n  ): Boolean; assembler;\r\nasm\r\n  return aFunction instanceof aFunctionWithPrototype;\r\nend;\r\n\r\nfunction toNumber(const v: JSValue): double; assembler;\r\nasm\r\n  return v-0;\r\nend;\r\n\r\nfunction toInteger(const v: JSValue): NativeInt;\r\nbegin\r\n  if IsInteger(v) then\r\n    Result:=NativeInt(v)\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction toObject(Value: JSValue): TJSObject;\r\n\r\nbegin\r\n  if IsObject(Value) then\r\n    Result:=TJSObject(Value)\r\n  else\r\n    Result:=Nil;\r\nend;\r\n\r\nfunction toArray(Value: JSValue): TJSArray; // If not possible, returns Nil\r\n\r\nbegin\r\n  if IsArray(Value) then\r\n    Result:=TJSArray(Value)\r\n  else\r\n    Result:=Nil;\r\nend;\r\n\r\nfunction toBoolean(Value: JSValue): Boolean; // If not possible, returns False\r\n\r\nbegin\r\n  if isBoolean(Value) then\r\n    Result:=Boolean(Value)\r\n  else\r\n    Result:=False;\r\nend;\r\n\r\nfunction toString(Value: JSValue): String; // If not possible, returns ''\r\n\r\nbegin\r\n  if IsString(Value) then\r\n    Result:=String(Value)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\n{ EJS }\r\n\r\nconstructor EJS.Create(const Msg: String);\r\nbegin\r\n  FMessage:=Msg;\r\nend;\r\n\r\n\r\nfunction GetValueType(JS: JSValue): TJSValueType;\r\n\r\nVar\r\n  t : string;\r\n\r\nbegin\r\n  if isNull(js) then   // null reported as object\r\n    result:=jvtNull\r\n  else\r\n    begin\r\n    t:=jsTypeOf(js);\r\n    if (t='string') then\r\n      Result:=jvtString\r\n    else if (t='boolean') then\r\n      Result:=jvtBoolean\r\n    else if (t='object') then\r\n      begin\r\n      if IsArray(JS) then\r\n        Result:=jvtArray\r\n      else\r\n        Result:=jvtObject;\r\n      end\r\n    else if (t='number') then\r\n      if isInteger(JS) then\r\n        result:=jvtInteger\r\n      else\r\n        result:=jvtFloat\r\n    end;\r\nend;\r\n\r\n{ ExternalJSAttribute }\r\n\r\nconstructor ExternalJSAttribute.Create(const AName: string);\r\nbegin\r\n  inherited Create;\r\n  FName := AName;\r\nend;\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit SysUtils;\r\n\r\n{$mode objfpc}\r\n{$modeswitch typehelpers}\r\n{$modeswitch advancedrecords}\r\n{$WARN 5078 off}\r\n\r\ninterface\r\n\r\nuses\r\n  RTLConsts, js;\r\n\r\nprocedure FreeAndNil(var Obj);\r\n\r\ntype\r\n  TProcedure = procedure;\r\n\r\n {*****************************************************************************\r\n                              Various types\r\n  *****************************************************************************}\r\nConst\r\n  FloatRecDigits = 19;\r\n\r\ntype\r\n  TSysCharSet = Set of Char;\r\n\r\n  { TFloatRec }\r\n  TFloatRec = Record\r\n    Exponent: Integer;\r\n    Negative: Boolean;\r\n    Digits: Array[0..FloatRecDigits-1] of Char;\r\n  End;\r\n  TEndian = (Little,Big);\r\n  TFileName = String;\r\n  TByteArray = array [0..32767] of Byte;\r\n  TWordArray = array [0..16383] of Word;\r\n  TBytes = Array of byte;\r\n  TStringArray = array of string;\r\n\r\n  TMonthNameArray = array [1..12] of string;\r\n  TDayTable = array [1..12] of Word;\r\n  TWeekNameArray = array [1..7] of string;\r\n  TMonthNames = TMonthNameArray;\r\n  TDayNames = array[1..7] of string;\r\n\r\ntype\r\n\r\n  { TFormatSettings }\r\n\r\n  TFormatSettings = record\r\n  strict private\r\n    class function GetBrowserLocale: string; assembler; static;\r\n    class function GetJSLocale: string; assembler; static;\r\n    class function GetLocaleDecimalSeparator(const ALocale: string): string; assembler; static;\r\n    class function GetLocaleLongDayName(const ADayOfWeek: Integer; const ALocale: string): string; assembler; static;\r\n    class function GetLocaleLongMonthName(const AMonth: Integer; const ALocale: string): string; assembler; static;\r\n    class function GetLocaleLongTimeFormat(ALocale: string): string; static;\r\n    class function GetLocaleShortDateFormat(ALocale: string): string; static;\r\n    class function GetLocaleShortDayName(const ADayOfWeek: Integer; const ALocale: string): string; assembler; static;\r\n    class function GetLocaleShortMonthName(const AMonth: Integer; const ALocale: string): string; assembler; static;\r\n    class function GetLocaleShortTimeFormat(ALocale: string): string; static;\r\n  public\r\n    CurrencyDecimals: Byte;\r\n    CurrencyFormat: Byte;\r\n    CurrencyString: string;\r\n    DateSeparator: Char;\r\n    DateTimeToStrFormat: array[Boolean] of string;\r\n    DecimalSeparator: string;\r\n    LongDateFormat: string;\r\n    LongDayNames: TDayNames;\r\n    LongMonthNames: TMonthNames;\r\n    LongTimeFormat: string;\r\n    NegCurrFormat: Byte;\r\n    ShortDateFormat: string;\r\n    ShortDayNames: TDayNames;\r\n    ShortMonthNames: TMonthNames;\r\n    ShortTimeFormat: string;\r\n    ThousandSeparator: string;\r\n    TimeAMString: string;\r\n    TimePMString: string;\r\n    TimeSeparator: Char;\r\n    TwoDigitYearCenturyWindow: Word;\r\n  public\r\n    Type\r\n       TLocaleInitCallback = Procedure(const aLocale : String; aInstance : TFormatSettings);\r\n    class var InitLocaleHandler : TLocaleInitCallback;\r\n    class function Create: TFormatSettings; overload; static;\r\n    class function Create(const ALocale: string): TFormatSettings; overload; static;\r\n    class function Invariant: TFormatSettings; static;\r\n    class constructor Init;\r\n  end;\r\n\r\n\r\n{*****************************************************************************\r\n                            Exception handling\r\n*****************************************************************************}\r\n\r\n  { Exception }\r\n\r\n  Exception = class(TObject)\r\n  private\r\n    fMessage: String;\r\n    fHelpContext: Integer;\r\n    {$ifdef NodeJS}\r\n    FNodeJSError: TJSError;\r\n    {$endif}\r\n  public\r\n    class var\r\n      LogMessageOnCreate : Boolean;\r\n  Public\r\n    constructor Create(const Msg: String); reintroduce;\r\n    constructor CreateFmt(const Msg: string; const Args: array of const);\r\n    constructor CreateHelp(const Msg: String; AHelpContext: Integer);\r\n    constructor CreateFmtHelp(const Msg: string; const Args: array of const; AHelpContext: Integer);\r\n    function ToString: String; override;\r\n    property HelpContext: Integer read fHelpContext write fHelpContext;\r\n    property Message: String read fMessage write fMessage;\r\n    {$ifdef NodeJS}\r\n    property NodeJSError: TJSError read FNodeJSError write FNodeJSError;\r\n    {$endif}\r\n  end;\r\n\r\n  ExceptClass = class of Exception;\r\n\r\n  EExternal = class(Exception);\r\n\r\n  { General math errors }\r\n  EMathError  = class(EExternal);\r\n  EInvalidOp  = class(EMathError);\r\n  EZeroDivide = class(EMathError);\r\n  EOverflow   = class(EMathError);\r\n  EUnderflow  = class(EMathError);\r\n\r\n  EAbort           = class(Exception);\r\n  EInvalidCast     = class(Exception);\r\n  EAssertionFailed = class(Exception);\r\n  EObjectCheck     = class(Exception);\r\n\r\n  { String conversion errors }\r\n  EConvertError = class(Exception);\r\n  EFormatError = class(Exception);\r\n\r\n\r\n  { integer math exceptions }\r\n  EIntError    = Class(EExternal);\r\n  EDivByZero   = Class(EIntError);\r\n  ERangeError  = Class(EIntError);\r\n  EIntOverflow = Class(EIntError);\r\n\r\n  { General math errors }\r\n\r\n  { Run-time and I/O Errors }\r\n  EInOutError = class(Exception)\r\n  public\r\n    ErrorCode : Integer;\r\n  end;\r\n\r\n  EHeapMemoryError = class(Exception);\r\n  EHeapException = EHeapMemoryError;\r\n\r\n  EExternalException = class(EExternal);\r\n  EInvalidPointer  = Class(EHeapMemoryError);\r\n  EOutOfMemory     = Class(EHeapMemoryError);\r\n\r\n  { EVariantError }\r\n\r\n  EVariantError = Class(Exception)\r\n    ErrCode : longint;\r\n    Constructor CreateCode(Code : Longint);\r\n  end;\r\n\r\n  EAccessViolation = Class(EExternal);\r\n  EBusError = Class(EAccessViolation);\r\n  EPrivilege = class(EExternal);\r\n  EStackOverflow = class(EExternal);\r\n  EControlC = class(EExternal);\r\n\r\n  { String conversion errors }\r\n\r\n  { Other errors }\r\n  EAbstractError   = Class(Exception);\r\n\r\n  EPropReadOnly = class(Exception);\r\n  EPropWriteOnly = class(Exception);\r\n\r\n  EIntfCastError = class(Exception);\r\n  EInvalidContainer = class(Exception);\r\n  EInvalidInsert = class(Exception);\r\n\r\n  EPackageError = class(Exception);\r\n\r\n  EOSError = class(Exception)\r\n  public\r\n    ErrorCode: Longint;\r\n  end;\r\n\r\n  ESafecallException = class(Exception);\r\n  ENoThreadSupport = Class(Exception);\r\n  ENoWideStringSupport = Class(Exception);\r\n  ENotImplemented = class(Exception);\r\n\r\n  EArgumentException = class(Exception);\r\n  EArgumentOutOfRangeException = class(EArgumentException);\r\n  EArgumentNilException = class(EArgumentException);\r\n\r\n  EPathTooLongException = class(Exception);\r\n  ENotSupportedException = class(Exception);\r\n  EDirectoryNotFoundException = class(Exception);\r\n  EFileNotFoundException = class(Exception);\r\n  EPathNotFoundException = class(Exception);\r\n\r\n  ENoConstructException = class(Exception);\r\n\r\n//function GetTickCount: Integer;\r\n\r\n\r\n{*****************************************************************************\r\n                            String function\r\n*****************************************************************************}\r\n\r\nConst\r\n  EmptyStr = '';\r\n  EmptyWideStr = ''; // No difference here.\r\n  HexDisplayPrefix: string = '$';\r\n  LeadBytes = [] unimplemented;\r\n\r\nFunction CharInSet(Ch: Char;Const CSet : array of char) : Boolean; overload;\r\nFunction CharInSet(Ch: Char;Const CSet : TSysCharSet) : Boolean; overload;\r\n\r\nfunction LeftStr(const S: string; Count: Integer): String; assembler;\r\nfunction RightStr(const S: string; Count: Integer): String; assembler;\r\n\r\nfunction Trim(const S: String): String; assembler;\r\nfunction TrimLeft(const S: String): String; assembler;\r\nfunction TrimRight(const S: String): String; assembler;\r\n\r\nfunction UpperCase(const s: String): String; assembler; overload;\r\nfunction LowerCase(const s: String): String; assembler; overload;\r\n\r\nfunction CompareStr(const s1, s2: String): Integer; assembler;\r\nfunction SameStr(const s1, s2: String): Boolean; assembler;\r\nfunction CompareText(const s1, s2: String): Integer; assembler;\r\nfunction SameText(const s1, s2: String): Boolean; assembler;\r\nfunction AnsiCompareText(const s1, s2: String): Integer; assembler;\r\nfunction AnsiSameText(const s1, s2: String): Boolean; assembler;\r\nfunction AnsiCompareStr(const s1, s2: String): Integer;\r\nprocedure AppendStr(var Dest: String; const S: string);\r\n\r\nfunction Format(const Fmt: String; const Args: array of const): String;\r\nfunction Format(const Fmt: String; const Args: array of const; const aSettings : TFormatSettings): String;\r\n\r\nfunction BytesOf(const AVal: string): TBytes;\r\nfunction StringOf(const ABytes: TBytes): string;\r\n\r\n// JavaScript built-in functions\r\nfunction LocaleCompare(const s1, s2, locales: String): Boolean; assembler; overload;\r\nfunction NormalizeStr(const S: String; const Norm: String = 'NFC'): String; assembler; overload; // not in IE\r\n\r\nfunction IsValidIdent(const Ident: string; AllowDots: Boolean = False; StrictDots: Boolean = False): Boolean;\r\n\r\nType\r\n  TStringReplaceFlag = (rfReplaceAll, rfIgnoreCase);\r\n  TReplaceFlag = TStringReplaceFlag;\r\n  TStringReplaceFlags = set of TStringReplaceFlag;\r\n  TReplaceFlags = TStringReplaceFlags;\r\n\r\nfunction StringReplace(aOriginal, aSearch, aReplace: string; Flags: TStringReplaceFlags): String;\r\nfunction QuoteString(aOriginal: String; AQuote: Char): String;\r\nfunction QuotedStr(const s: string; QuoteChar: Char = ''''): string;\r\nfunction DeQuoteString(aQuoted: String; AQuote: Char): String;\r\nFunction LastDelimiter(const Delimiters, S: string): SizeInt;\r\nfunction IsDelimiter(const Delimiters, S: string; Index: Integer): Boolean;\r\nfunction AdjustLineBreaks(const S: string): string;\r\nfunction AdjustLineBreaks(const S: string; Style: TTextLineBreakStyle): string;\r\nfunction WrapText(const Line, BreakStr: string; const BreakChars: Array of char;  MaxCol: Integer): string;\r\nfunction WrapText(const Line: string; MaxCol: Integer): string;\r\n\r\n{ *****************************************************************************\r\n  Integer conversions\r\n  *****************************************************************************}\r\n\r\nFunction SwapEndian(W : Word) : Word;\r\nFunction SwapEndian(C : Cardinal) : Cardinal;\r\nfunction IntToStr(const Value: Integer): string;\r\nFunction TryStrToInt(const S : String; Out res : Integer) : Boolean;\r\nFunction TryStrToInt(const S : String; Out res : NativeInt) : Boolean;\r\nfunction TryStrToInt(const S: String; out res: NativeInt; Const aSettings : TFormatSettings): Boolean;\r\nFunction StrToIntDef(const S : String; Const aDef : Integer) : Integer;\r\nFunction StrToIntDef(const S : String; Const aDef : NativeInt) : NativeInt;\r\nFunction StrToInt(const S : String) : Integer;\r\nFunction StrToNativeInt(const S : String) : NativeInt;\r\nfunction StrToUInt(const s: string): Cardinal;\r\nfunction StrToUIntDef(const s: string; aDef : Cardinal): Cardinal;\r\nfunction UIntToStr(Value: Cardinal): string; \r\nfunction TryStrToUInt(const s: string; out C: Cardinal): Boolean;\r\n// For compatibility\r\nFunction StrToInt64(const S : String) : NativeLargeInt;\r\nFunction StrToInt64Def(const S : String; ADefault : NativeLargeInt) : NativeLargeInt;\r\nFunction TryStrToInt64(const S : String; Out res : NativeLargeInt) : Boolean; overload;\r\nFunction StrToQWord(const S : String) : NativeLargeUInt;\r\nFunction StrToQWordDef(const S : String; ADefault : NativeLargeUInt) : NativeLargeUInt;\r\nFunction TryStrToQWord(const S : String; Out res : NativeLargeUInt) : Boolean; overload;\r\nFunction TryStrToQWord(const S : String; Out res : QWord) : Boolean; unimplemented; overload; // only 52 bits\r\nFunction StrToUInt64(const S : String) : NativeLargeUInt;\r\nFunction StrToUInt64Def(const S : String; ADefault : NativeLargeUInt) : NativeLargeUInt;\r\nFunction TryStrToUInt64(const S : String; Out res : NativeLargeUInt) : Boolean; overload;\r\nFunction TryStrToUInt64(const S : String; Out res : UInt64) : Boolean; unimplemented; overload; // only 52 bits\r\nFunction StrToDWord(const S : String) : DWord;\r\nFunction StrToDWordDef(const S : String; ADefault : DWord) : DWord;\r\nFunction TryStrToDWord(const S : String; Out res : DWord) : Boolean;\r\n\r\nfunction IntToHex(Value: NativeInt; Digits: Integer): string; overload;\r\n\r\n{ *****************************************************************************\r\n  Float conversions\r\n  *****************************************************************************}\r\n\r\nconst\r\n  // Note: Currency is internally a double, multiplied by 10000 and truncated.\r\n  // The below values are the safe limits, within every step exists.\r\n  // Since currency is a double it can take much larger values, but the result\r\n  // may differ from Delphi/FPC\r\n  MaxCurrency: Currency =  900719925474.0991; // fpc: 922337203685477.5807;\r\n  MinCurrency: Currency = -900719925474.0991; // fpc: -922337203685477.5808;\r\n\r\nType\r\n  TFloatFormat = (ffFixed,ffGeneral,ffExponent,ffNumber,ffCurrency);\r\n\r\nFunction FloatToDecimal(Value : double; Precision, Decimals : integer) :  TFloatRec;\r\nFunction FloatToStr(Value: Double): String; overload;\r\nFunction FloatToStr(Value: Double; const aSettings : TFormatSettings): String; overload;\r\nFunction FloatToStrF(const Value : double; format: TFloatFormat; Precision, Digits: Integer): String; overload;\r\nFunction FloatToStrF(const Value : double; format: TFloatFormat; Precision, Digits: Integer;const aSettings : TFormatSettings): String; overload;\r\nFunction TryStrToFloat(const S : String; Out res : Extended) : Boolean; overload;\r\nFunction TryStrToFloat(const S : String; Out res : Extended; const aSettings : TFormatSettings) : Boolean; overload;\r\nFunction TryStrToFloat(const S : String; Out res : Double) : Boolean; overload;\r\nFunction TryStrToFloat(const S : String; Out res : Double; const aSettings : TFormatSettings) : Boolean; overload;\r\nFunction StrToFloatDef(const S : String; Const aDef : Double) : Double;\r\nfunction StrToFloatDef(const S: String; const aDef: Double; const aSettings : TFormatSettings): Double;\r\nFunction StrToFloat(const S : String) : Double; overload;\r\nFunction StrToFloat(const S : String; const aSettings : TFormatSettings) : Double; overload;\r\nFunction FormatFloat (Fmt : String; aValue : Double) : String; overload;\r\nFunction FormatFloat (Fmt : String; aValue : Double; aSettings : TFormatSettings) : String; overload;\r\n\r\n\r\n{ *****************************************************************************\r\n  Boolean conversions\r\n  *****************************************************************************}\r\n\r\nVar\r\n  TrueBoolStrs, FalseBoolStrs : Array of String;\r\n\r\nfunction StrToBool(const S: String): Boolean;\r\nfunction BoolToStr(B: Boolean; UseBoolStrs:Boolean=False): string;\r\nfunction BoolToStr(B: Boolean; const TrueS, FalseS: String): string;\r\nfunction StrToBoolDef(const S: String; Default: Boolean): Boolean;\r\nfunction TryStrToBool(const S: String; out Value: Boolean): Boolean;\r\n\r\n\r\n{*****************************************************************************\r\n                              OS/Environment\r\n*****************************************************************************}\r\n\r\nConst\r\n  ConfigExtension : String = '.cfg';\r\n  SysConfigDir    : String = '';\r\n\r\ntype\r\n  TOnGetEnvironmentVariable = function(Const EnvVar: String): String;\r\n  TOnGetEnvironmentString = function(Index: Integer): String;\r\n  TOnGetEnvironmentVariableCount = function: Integer;\r\n  TShowExceptionHandler = Procedure (Const Msg : String);\r\n  TUncaughtPascalExceptionHandler = reference to Procedure(aObject : TObject);\r\n  TUncaughtJSExceptionHandler = reference to Procedure(aObject : TJSObject);\r\n\r\nvar\r\n  OnGetEnvironmentVariable: TOnGetEnvironmentVariable;\r\n  OnGetEnvironmentString: TOnGetEnvironmentString;\r\n  OnGetEnvironmentVariableCount: TOnGetEnvironmentVariableCount;\r\n  // Handler to show an exception (used when showexception is called)\r\n  OnShowException : TShowExceptionHandler = nil;\r\n\r\n// Set handlers for uncaught exceptions. These will call HookUncaughtExceptions\r\n// They return the old exception handler, if there was any.\r\nFunction SetOnUnCaughtExceptionHandler(aValue : TUncaughtPascalExceptionHandler) : TUncaughtPascalExceptionHandler;\r\nFunction SetOnUnCaughtExceptionHandler(aValue : TUncaughtJSExceptionHandler) : TUncaughtJSExceptionHandler;\r\n// Hook the rtl handler for uncaught exceptions. If any exception handlers were set, they will be called.\r\n// If none were set, the exceptions will be displayed using ShowException.\r\nProcedure HookUncaughtExceptions;\r\n\r\nfunction GetEnvironmentVariable(Const EnvVar: String): String;\r\nfunction GetEnvironmentVariableCount: Integer;\r\nfunction GetEnvironmentString(Index: Integer): String;\r\n\r\n\r\nprocedure ShowException(ExceptObject: TObject; ExceptAddr: Pointer = Nil);\r\nProcedure Abort;\r\n\r\n\r\n{*****************************************************************************\r\n                               Events\r\n*****************************************************************************}\r\nType\r\n  TEventType = (etCustom,etInfo,etWarning,etError,etDebug);\r\n  TEventTypes = Set of TEventType;\r\n\r\n{*****************************************************************************\r\n                            Date and time\r\n*****************************************************************************}\r\nType\r\n  \r\n  TSystemTime = record\r\n     Year, Month, Day, DayOfWeek: word;\r\n     Hour, Minute, Second, MilliSecond: word;\r\n  end ;\r\n  TTimeStamp = record\r\n     Time: longint;   { Number of milliseconds since midnight }\r\n     Date: longint;   { One plus number of days since 1/1/0001 }\r\n  end ;\r\n\r\n\r\nVar\r\n  TimeSeparator : char deprecated;\r\n  DateSeparator : char deprecated;\r\n  ShortDateFormat : string deprecated;\r\n  LongDateFormat : string deprecated;\r\n  ShortTimeFormat : string deprecated;\r\n  LongTimeFormat : string deprecated;\r\n  DecimalSeparator : string deprecated;\r\n  ThousandSeparator : string deprecated;\r\n  TimeAMString : string deprecated;\r\n  TimePMString : string deprecated;\r\n\r\nconst\r\n\r\n  HoursPerDay = 24;\r\n  MinsPerHour = 60;\r\n  SecsPerMin  = 60;\r\n  MSecsPerSec = 1000;\r\n  MinsPerDay  = HoursPerDay * MinsPerHour;\r\n  SecsPerHour = SecsPerMin * MinsPerHour;\r\n  SecsPerDay  = MinsPerDay * SecsPerMin;\r\n  MSecsPerDay = SecsPerDay * MSecsPerSec;\r\n  MaxDateTime: TDateTime =  2958465.99999999;\r\n  MinDateTime: TDateTime =  -693593.99999999;\r\n\r\n  JulianEpoch = TDateTime(-2415018.5);\r\n  UnixEpoch = JulianEpoch + TDateTime(2440587.5);\r\n\r\n  DateDelta = 693594;        // Days between 1/1/0001 and 12/31/1899\r\n  UnixDateDelta = 25569;\r\n\r\n  { True=Leapyear }\r\n\r\nVar\r\n  MonthDays : array [Boolean] of TDayTable =\r\n    ((31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31),\r\n     (31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31));\r\n\r\nVar\r\n  ShortMonthNames : TMonthNames deprecated;\r\n  LongMonthNames : TMonthNames deprecated;\r\n  ShortDayNames : TDayNames deprecated;\r\n  LongDayNames : TDayNames deprecated;\r\n\r\n\r\nVar\r\n  FormatSettings: TFormatSettings;\r\n  TwoDigitYearCenturyWindow : word = 50;\r\n                             { Threshold to be subtracted from year before age-detection.}\r\n\r\n\r\n// Various conversions\r\n\r\nfunction DateTimeToJSDate(aDateTime : TDateTime) : TJSDate;\r\nfunction JSDateToDateTime(aDate : TJSDate) : TDateTime;\r\nfunction DateTimeToTimeStamp(DateTime: TDateTime): TTimeStamp;\r\nfunction TimeStampToDateTime(const TimeStamp: TTimeStamp): TDateTime;\r\nfunction MSecsToTimeStamp(MSecs: NativeInt): TTimeStamp;\r\nfunction TimeStampToMSecs(const TimeStamp: TTimeStamp): NativeInt;\r\nprocedure DateTimeToSystemTime(DateTime: TDateTime; out SystemTime: TSystemTime);\r\nfunction SystemTimeToDateTime(const SystemTime: TSystemTime): TDateTime;\r\nFunction FloatToDateTime (Const Value : Extended) : TDateTime;\r\n\r\n// Encode/Decode\r\nfunction TryEncodeDate(Year, Month, Day: Word; out Date: TDateTime): Boolean; overload;\r\nfunction TryEncodeTime(Hour, Min, Sec, MSec: Word; out Time: TDateTime): Boolean;\r\nfunction EncodeDate(Year, Month, Day :word): TDateTime;\r\nfunction EncodeTime(Hour, Minute, Second, MilliSecond:word): TDateTime;\r\nprocedure DecodeDate(Date: TDateTime; out Year, Month, Day: word);\r\nprocedure DecodeTime(Time: TDateTime; out Hour, Minute, Second, MilliSecond: word);\r\nfunction DecodeDateFully(const DateTime: TDateTime; out Year, Month, Day, DOW: Word): Boolean;\r\nfunction ComposeDateTime(Date,Time : TDateTime) : TDateTime;\r\nprocedure ReplaceTime(var dati: TDateTime; NewTime : TDateTime);\r\nprocedure ReplaceDate(var DateTime: TDateTime; const NewDate: TDateTime);\r\n\r\nfunction Date: TDateTime;\r\nfunction Time: TDateTime;\r\nfunction Now: TDateTime;\r\nfunction DayOfWeek(DateTime: TDateTime): integer;\r\nfunction IncMonth(const DateTime: TDateTime; NumberOfMonths: integer = 1 ): TDateTime;\r\nprocedure IncAMonth(var Year, Month, Day: Word; NumberOfMonths: Integer = 1);\r\nfunction IsLeapYear(Year: Word): boolean;\r\nfunction CurrentYear:Word;\r\n\r\n// Date <-> String conversion\r\n\r\nfunction DateToStr(Date: TDateTime): string; overload;\r\nfunction DateToStr(Date: TDateTime; const aSettings: TFormatSettings): string; overload;\r\nfunction StrToDate(const S: String): TDateTime; overload;\r\nfunction StrToDate(const S: String; separator : char): TDateTime; overload;\r\nfunction StrToDate(const S: String; const useformat : string; separator : char): TDateTime; overload;\r\nfunction StrToDate(const S: string; const aSettings : TFormatSettings): TDateTime; overload;\r\nfunction TryStrToDate(const S: String; out Value: TDateTime): Boolean; overload;\r\nfunction TryStrToDate(const S: String; out Value: TDateTime; const aSettings : TFormatSettings): Boolean; overload;\r\nfunction TryStrToDate(const S: String; out Value: TDateTime; separator : char): Boolean; overload;\r\nfunction TryStrToDate(const S: String; out Value: TDateTime; const useformat : string; separator : char): Boolean; overload;\r\nfunction StrToDateDef(const S: String; const Defvalue : TDateTime): TDateTime; overload;\r\nfunction StrToDateDef(const S: String; const Defvalue : TDateTime; separator : char): TDateTime; overload;\r\nfunction StrToDateDef(const S: string; const Defvalue: TDateTime; const aSettings: TFormatSettings): TDateTime; overload;\r\n\r\n// Time <-> String conversion\r\n\r\nfunction TimeToStr(Time: TDateTime): string;overload;\r\nfunction TimeToStr(Time: TDateTime; const aSettings: TFormatSettings): string;overload;\r\nfunction StrToTime(const S: String): TDateTime;overload;\r\nfunction StrToTime(const S: String; separator : char): TDateTime;overload;\r\nfunction StrToTime(const S: string; const aSettings : TFormatSettings): TDateTime;overload;\r\nfunction TryStrToTime(const S: String; out Value: TDateTime): Boolean;overload;\r\nfunction TryStrToTime(const S: String; out Value: TDateTime; aSettings : TFormatSettings): Boolean;overload;\r\nfunction TryStrToTime(const S: String; out Value: TDateTime; separator : char): Boolean; overload;\r\nfunction StrToTimeDef(const S: String; const Defvalue : TDateTime): TDateTime;overload;\r\nfunction StrToTimeDef(const S: String; const Defvalue : TDateTime; separator : char): TDateTime;overload;\r\nfunction StrToTimeDef(const AString: string; const ADefault: TDateTime; const aSettings: TFormatSettings): TDateTime;\r\n\r\n// DateTime <-> String conversion\r\n\r\nfunction DateTimeToStr(DateTime: TDateTime; ForceTimeIfZero : Boolean = False): string;overload;\r\nfunction DateTimeToStr(DateTime: TDateTime; const aSettings: TFormatSettings; ForceTimeIfZero : Boolean = False): string;overload;\r\nfunction StrToDateTime(const S: String): TDateTime;overload;\r\nfunction StrToDateTime(const s: String; const aSettings : TFormatSettings): TDateTime;overload;\r\nfunction TryStrToDateTime(const S: String; out Value: TDateTime): Boolean; overload;\r\nfunction TryStrToDateTime(const S: string; out Value: TDateTime; const aSettings: TFormatSettings): Boolean; overload;\r\nfunction StrToDateTimeDef(const S: String; const Defvalue : TDateTime): TDateTime; overload;\r\nfunction StrToDateTimeDef(const S: String; const Defvalue : TDateTime; aSettings : TFormatSettings): TDateTime; overload;\r\nfunction FormatDateTime(const FormatStr: string; const DateTime: TDateTime): string; overload;\r\nfunction FormatDateTime(const FormatStr: string; const DateTime: TDateTime; const aSettings: TFormatSettings): string; overload;\r\n\r\n\r\n{ *****************************************************************************\r\n  Currency support\r\n  *****************************************************************************}\r\n\r\n\r\nVar\r\n  CurrencyFormat : Byte deprecated;\r\n  NegCurrFormat : Byte deprecated;\r\n  CurrencyDecimals : Byte deprecated;\r\n  CurrencyString : String deprecated;\r\n\r\nFunction FloattoCurr (Const Value : Extended) : Currency;\r\nfunction TryFloatToCurr(const Value: Extended; var AResult: Currency): Boolean;\r\nFunction CurrToStr(Value: Currency): string;\r\nFunction CurrToStr(Value: Currency; Const aSettings: TFormatSettings): string;\r\nfunction StrToCurr(const S: string): Currency;\r\nfunction StrToCurr(const S: string; Const aSettings: TFormatSettings): Currency;\r\nfunction TryStrToCurr(const S: string;Out Value : Currency): Boolean;\r\nfunction TryStrToCurr(const S: string;Out Value : Currency; Const aSettings: TFormatSettings): Boolean;\r\nfunction StrToCurrDef(const S: string; Default : Currency): Currency;\r\nfunction StrToCurrDef(const S: string; Default : Currency; Const aSettings: TFormatSettings): Currency;\r\n\r\n{*****************************************************************************\r\n                               File Paths\r\n*****************************************************************************}\r\ntype\r\n  PathStr = String;\r\n  TPathStrArray = Array of PathStr;\r\n\r\nfunction ChangeFileExt(const FileName, Extension: PathStr): PathStr;\r\nfunction ExtractFilePath(const FileName: PathStr): PathStr;\r\nfunction ExtractFileDrive(const FileName: PathStr): PathStr;\r\nfunction ExtractFileName(const FileName: PathStr): PathStr;\r\nfunction ExtractFileExt(const FileName: PathStr): PathStr;\r\nfunction ExtractFileDir(Const FileName : PathStr): PathStr;\r\nfunction ExtractRelativepath (Const BaseName,DestName : PathStr): PathStr;\r\nfunction IncludeTrailingPathDelimiter(Const Path : PathStr) : PathStr;\r\nfunction ExcludeTrailingPathDelimiter(Const Path: PathStr): PathStr;\r\nfunction IncludeLeadingPathDelimiter(Const Path : PathStr) : PathStr;\r\nfunction ExcludeLeadingPathDelimiter(Const Path: PathStr): PathStr;\r\nfunction IsPathDelimiter(Const Path: PathStr; Index: Integer): Boolean;\r\nFunction SetDirSeparators (Const FileName : PathStr) : PathStr;\r\nFunction GetDirs (DirName : PathStr) : TPathStrArray;\r\nfunction ConcatPaths(const Paths: array of PathStr): PathStr;\r\n\r\n\r\n{*****************************************************************************\r\n                               Interfaces\r\n*****************************************************************************}\r\n\r\nconst\r\n  GUID_NULL: TGuid = '{00000000-0000-0000-0000-000000000000}';\r\n\r\nfunction Supports(const Instance: IInterface; const AClass: TClass; out Obj): Boolean; overload;\r\nfunction Supports(const Instance: IInterface; const IID: TGuid; out Intf): Boolean; overload;\r\nfunction Supports(const Instance: TObject; const IID: TGuid; out Intf): Boolean; overload;\r\nfunction Supports(const Instance: TObject; const IID: TGuidString; out Intf): Boolean; overload;\r\n\r\nfunction Supports(const Instance: IInterface; const AClass: TClass): Boolean; overload;\r\nfunction Supports(const Instance: IInterface; const IID: TGuid): Boolean; overload;\r\nfunction Supports(const Instance: TObject; const IID: TGuid): Boolean; overload;\r\nfunction Supports(const Instance: TObject; const IID: TGuidString): Boolean; overload;\r\n\r\nfunction Supports(const AClass: TClass; const IID: TGuid): Boolean; overload;\r\nfunction Supports(const AClass: TClass; const IID: TGuidString): Boolean; overload;\r\n\r\nfunction TryStringToGUID(const s: string; out Guid: TGuid): Boolean;\r\nfunction StringToGUID(const S: string): TGuid;\r\nfunction GUIDToString(const guid: TGuid): string;\r\nfunction IsEqualGUID(const guid1, guid2: TGuid): Boolean;\r\nfunction GuidCase(const guid: TGuid; const List: array of TGuid): Integer;\r\nFunction CreateGUID(out GUID : TGUID) : Integer;\r\n\r\nFunction EncodeHTMLEntities (S : String) : String;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Type Helpers\r\n  ---------------------------------------------------------------------}\r\n\r\nType\r\n  TCharArray = Array of char;\r\n\r\n  TByteBitIndex = 0..7;\r\n  TShortIntBitIndex = 0..7;\r\n  TWordBitIndex = 0..15;\r\n  TSmallIntBitIndex = 0..15;\r\n  TCardinalBitIndex = 0..31;\r\n  TIntegerBitIndex = 0..31;\r\n  TLongIntBitIndex = TIntegerBitIndex;\r\n  TQwordBitIndex = 0..52;\r\n  TInt64BitIndex = 0..52;\r\n  TNativeIntBitIndex = 0..52;\r\n  TNativeUIntBitIndex = 0..52;\r\n\r\nConst\r\n  CPUEndian = {$IFNDEF FPC_LITTLE_ENDIAN}TEndian.Big{$ELSE}TEndian.Little{$ENDIF};\r\n\r\nType\r\n\r\n  { TGuidHelper }\r\n\r\n  TGuidHelper = record helper for TGUID\r\n    class function Create(Src : TGUID; BigEndian: Boolean): TGUID; overload; static;\r\n    class function Create(const Buf : TJSArrayBuffer; AStartIndex: Cardinal; BigEndian: Boolean): TGUID; overload; static;\r\n    class function Create(const Data: array of Byte; AStartIndex: Cardinal; BigEndian: Boolean): TGUID; overload; static;\r\n    Class Function Create(const B: TBytes; DataEndian: TEndian = CPUEndian): TGUID; overload; static; inline;\r\n    Class Function Create(const B: TBytes; AStartIndex: Cardinal; DataEndian: TEndian = CPUEndian): TGUID; overload; static;\r\n    Class Function Create(const S: string): TGUID; overload; static;\r\n    Class Function Create(A: Integer; B: SmallInt; C: SmallInt; const D: TBytes): TGUID; overload; static;\r\n//    Class Function Create(A: Integer; B: SmallInt; C: SmallInt; D, E, F, G, H, I, J, K: Byte): TGUID; overload; static;\r\n    Class Function Create(A: Cardinal; B: Word; C: Word; D, E, F, G, H, I, J, K: Byte): TGUID; overload; static;\r\n    Class Function NewGuid: TGUID; static;\r\n    Function ToByteArray(DataEndian: TEndian = CPUEndian): TBytes;\r\n    Function ToString(SkipBrackets: Boolean = False): string;\r\n  end;\r\n\r\n\r\n{$SCOPEDENUMS ON}\r\n  TStringSplitOptions = (None, ExcludeEmpty);\r\n{$SCOPEDENUMS OFF}\r\n\r\n  { TStringHelper }\r\n\r\n  TStringHelper = Type Helper for String\r\n  Private\r\n    Function GetChar(AIndex : SizeInt) : Char;\r\n    Function GetLength : SizeInt;\r\n  public\r\n    const Empty = '';\r\n    // Methods\r\n    Class Function Compare(const A: string; const B: string): Integer; overload; static; //inline;\r\n    Class Function Compare(const A: string; const B: string; IgnoreCase: Boolean): Integer; overload; static; //inline; //deprecated 'Use same with TCompareOptions';\r\n    Class Function Compare(const A: string; const B: string; Options: TCompareOptions): Integer; overload; static; // inline;\r\n    Class Function Compare(const A: string; IndexA: SizeInt; const B: string; IndexB: SizeInt; ALen: SizeInt): Integer; overload; static; // inline;\r\n    Class Function Compare(const A: string; IndexA: SizeInt; const B: string; IndexB: SizeInt; ALen: SizeInt; IgnoreCase: Boolean): Integer; overload; static; // inline; //deprecated 'Use same with TCompareOptions';\r\n    Class Function Compare(const A: string; IndexA: SizeInt; const B: string; IndexB: SizeInt; ALen: SizeInt; Options: TCompareOptions): Integer; overload; static;//  inline;\r\n    Class Function CompareOrdinal(const A: string; const B: string): Integer; overload; static;\r\n    Class Function CompareOrdinal(const A: string; IndexA: SizeInt; const B: string; IndexB: SizeInt; ALen: SizeInt): Integer; overload; static;\r\n    Class Function CompareText(const A: string; const B: string): Integer; static; inline;\r\n    Class Function Copy(const Str: string): string; inline; static;\r\n    Class Function Create(AChar: Char; ACount: SizeInt): string; overload; inline; static;\r\n    Class Function Create(const AValue: array of Char): string; overload; static;\r\n    Class Function Create(const AValue: array of Char; StartIndex: SizeInt; ALen: SizeInt): string; overload; static;\r\n    Class Function EndsText(const ASubText, AText: string): Boolean; static;\r\n    Class Function Equals(const a: string; const b: string): Boolean; overload; static;\r\n    Class Function Format(const AFormat: string; const args: array of const): string; overload; static;\r\n    Class Function IsNullOrEmpty(const AValue: string): Boolean; static;\r\n    Class Function IsNullOrWhiteSpace(const AValue: string): Boolean; static;\r\n    Class Function Join(const Separator: string; const Values: array of const): string; overload; static;\r\n    Class Function Join(const Separator: string; const Values: array of string): string; overload; static;\r\n    Class Function Join(const Separator: string; const Values: array of string; StartIndex: SizeInt; ACount: SizeInt): string; overload; static;\r\n    Class Function LowerCase(const S: string): string; overload; static; inline;\r\n    Class Function Parse(const AValue: Boolean): string; overload; static; inline;\r\n    Class Function Parse(const AValue: Extended): string; overload; static;inline;\r\n    Class Function Parse(const AValue: NativeInt): string; overload; static; inline;\r\n    Class Function Parse(const AValue: Integer): string; overload; static; inline;\r\n    Class Function ToBoolean(const S: string): Boolean; overload; static; inline;\r\n    Class Function ToDouble(const S: string): Double; overload; static; inline;\r\n    Class Function ToExtended(const S: string): Extended; overload; static; inline;\r\n    Class Function ToNativeInt(const S: string): NativeInt; overload; static; inline;\r\n    Class Function ToInteger(const S: string): Integer; overload; static; inline;\r\n    Class Function UpperCase(const S: string): string; overload; static; inline;\r\n    Class Function ToCharArray(const S : String) : TCharArray; static;\r\n    Function CompareTo(const B: string): Integer;\r\n    Function Contains(const AValue: string): Boolean;\r\n    Function CountChar(const C: Char): SizeInt;\r\n    Function DeQuotedString: string; overload;\r\n    Function DeQuotedString(const AQuoteChar: Char): string; overload;\r\n    Function EndsWith(const AValue: string): Boolean; overload; inline;\r\n    Function EndsWith(const AValue: string; IgnoreCase: Boolean): Boolean; overload;\r\n    Function Equals(const AValue: string): Boolean; overload;\r\n    Function Format(const args: array of const): string; overload;\r\n    Function GetHashCode: Integer;\r\n    Function IndexOf(AValue: Char): SizeInt; overload; inline;\r\n    Function IndexOf(const AValue: string): SizeInt; overload; inline;\r\n    Function IndexOf(AValue: Char; StartIndex: SizeInt): SizeInt; overload;\r\n    Function IndexOf(const AValue: string; StartIndex: SizeInt): SizeInt; overload;\r\n    Function IndexOf(AValue: Char; StartIndex: SizeInt; ACount: SizeInt): SizeInt; overload;\r\n    Function IndexOf(const AValue: string; StartIndex: SizeInt; ACount: SizeInt): SizeInt; overload;\r\n    Function IndexOfUnQuoted(const AValue: string; StartQuote, EndQuote: Char; StartIndex: SizeInt = 0): SizeInt; overload;\r\n    Function IndexOfAny(const AnyOf: string): SizeInt; overload;\r\n    Function IndexOfAny(const AnyOf: array of Char): SizeInt; overload;\r\n    Function IndexOfAny(const AnyOf: String; StartIndex: SizeInt): SizeInt; overload;\r\n    Function IndexOfAny(const AnyOf: array of Char; StartIndex: SizeInt): SizeInt; overload;\r\n    Function IndexOfAny(const AnyOf: String; StartIndex: SizeInt; ACount: SizeInt): SizeInt; overload;\r\n    Function IndexOfAny(const AnyOf: array of Char; StartIndex: SizeInt; ACount: SizeInt): SizeInt; overload;\r\n    Function IndexOfAny(const AnyOf: array of String): SizeInt; overload;\r\n    Function IndexOfAny(const AnyOf: array of String; StartIndex: SizeInt): SizeInt; overload;\r\n    Function IndexOfAny(const AnyOf: array of String; StartIndex: SizeInt; ACount: SizeInt): SizeInt; overload;\r\n    Function IndexOfAny(const AnyOf: array of String; StartIndex: SizeInt; ACount: SizeInt; Out AMatch : SizeInt): SizeInt; overload;\r\n    Function IndexOfAnyUnquoted(const AnyOf: array of Char; StartQuote, EndQuote: Char): SizeInt; overload;\r\n    Function IndexOfAnyUnquoted(const AnyOf: array of Char; StartQuote, EndQuote: Char; StartIndex: SizeInt): SizeInt; overload;\r\n    Function IndexOfAnyUnquoted(const AnyOf: array of Char; StartQuote, EndQuote: Char; StartIndex: SizeInt; ACount: SizeInt): SizeInt; overload;\r\n    function IndexOfAnyUnquoted(const AnyOf: array of string; StartQuote, EndQuote: Char; StartIndex: SizeInt; Out Matched: SizeInt): SizeInt; overload;\r\n    Function Insert(StartIndex: SizeInt; const AValue: string): string;\r\n    Function IsDelimiter(const Delimiters: string; Index: SizeInt): Boolean;\r\n    Function IsEmpty: Boolean;\r\n    Function LastDelimiter(const Delims: string): SizeInt;\r\n    Function LastIndexOf(AValue: Char): SizeInt; overload;\r\n    Function LastIndexOf(const AValue: string): SizeInt; overload;\r\n    Function LastIndexOf(AValue: Char; AStartIndex: SizeInt): SizeInt; overload;\r\n    Function LastIndexOf(const AValue: string; AStartIndex: SizeInt): SizeInt; overload;\r\n    Function LastIndexOf(AValue: Char; AStartIndex: SizeInt; ACount: SizeInt): SizeInt; overload;\r\n    Function LastIndexOf(const AValue: string; AStartIndex: SizeInt; ACount: SizeInt): SizeInt; overload;\r\n    Function LastIndexOfAny(const AnyOf: array of Char): SizeInt; overload;\r\n    Function LastIndexOfAny(const AnyOf: array of Char; AStartIndex: SizeInt): SizeInt; overload;\r\n    Function LastIndexOfAny(const AnyOf: array of Char; AStartIndex: SizeInt; ACount: SizeInt): SizeInt; overload;\r\n    Function PadLeft(ATotalWidth: SizeInt): string; overload; inline;\r\n    Function PadLeft(ATotalWidth: SizeInt; PaddingChar: Char): string; overload; inline;\r\n    Function PadRight(ATotalWidth: SizeInt): string; overload; inline;\r\n    Function PadRight(ATotalWidth: SizeInt; PaddingChar: Char): string; overload; inline;\r\n    Function QuotedString: string; overload;\r\n    Function QuotedString(const AQuoteChar: Char): string; overload;\r\n    Function Remove(StartIndex: SizeInt): string; overload; inline;\r\n    Function Remove(StartIndex: SizeInt; ACount: SizeInt): string; overload; inline;\r\n    Function Replace(OldChar: Char; NewChar: Char): string; overload;\r\n    Function Replace(OldChar: Char; NewChar: Char; ReplaceFlags: TReplaceFlags): string; overload;\r\n    Function Replace(const OldValue: string; const NewValue: string): string; overload;\r\n    Function Replace(const OldValue: string; const NewValue: string; ReplaceFlags: TReplaceFlags): string; overload;\r\n    Function Split(const Separators: String): TStringArray; overload;\r\n    Function Split(const Separators: array of Char): TStringArray; overload;\r\n    Function Split(const Separators: string; ACount: SizeInt): TStringArray; overload;\r\n    Function Split(const Separators: array of Char; ACount: SizeInt): TStringArray; overload;\r\n    Function Split(const Separators: string; Options: TStringSplitOptions): TStringArray; overload;\r\n    Function Split(const Separators: array of Char; Options: TStringSplitOptions): TStringArray; overload;\r\n    Function Split(const Separators: string; ACount: SizeInt; Options: TStringSplitOptions): TStringArray; overload;\r\n    Function Split(const Separators: array of Char; ACount: SizeInt; Options: TStringSplitOptions): TStringArray; overload;\r\n    Function Split(const Separators: array of string): TStringArray; overload;\r\n    Function Split(const Separators: array of string; ACount: SizeInt): TStringArray; overload;\r\n    Function Split(const Separators: array of string; Options: TStringSplitOptions): TStringArray; overload;\r\n    Function Split(const Separators: array of string; ACount: SizeInt; Options: TStringSplitOptions): TStringArray; overload;\r\n    Function Split(const Separators: String; AQuote: Char): TStringArray; overload;\r\n    Function Split(const Separators: array of Char; AQuote: Char): TStringArray; overload;\r\n    Function Split(const Separators: String; AQuoteStart, AQuoteEnd: Char): TStringArray; overload;\r\n    Function Split(const Separators: array of Char; AQuoteStart, AQuoteEnd: Char): TStringArray; overload;\r\n    Function Split(const Separators: string; AQuoteStart, AQuoteEnd: Char; Options: TStringSplitOptions): TStringArray; overload;\r\n    Function Split(const Separators: array of Char; AQuoteStart, AQuoteEnd: Char; Options: TStringSplitOptions): TStringArray; overload;\r\n    Function Split(const Separators: string; AQuoteStart, AQuoteEnd: Char; ACount: SizeInt): TStringArray; overload;\r\n    Function Split(const Separators: array of Char; AQuoteStart, AQuoteEnd: Char; ACount: SizeInt): TStringArray; overload;\r\n    Function Split(const Separators: string; AQuoteStart, AQuoteEnd: Char; ACount: SizeInt; Options: TStringSplitOptions): TStringArray; overload;\r\n    Function Split(const Separators: array of Char; AQuoteStart, AQuoteEnd: Char; ACount: SizeInt; Options: TStringSplitOptions): TStringArray; overload;\r\n    Function Split(const Separators: array of string; AQuote: Char): TStringArray; overload;\r\n    Function Split(const Separators: array of string; AQuoteStart, AQuoteEnd: Char): TStringArray; overload;\r\n    Function Split(const Separators: array of string; AQuoteStart, AQuoteEnd: Char; Options: TStringSplitOptions): TStringArray; overload;\r\n    Function Split(const Separators: array of string; AQuoteStart, AQuoteEnd: Char; ACount: SizeInt): TStringArray; overload;\r\n    Function Split(const Separators: array of string; AQuoteStart, AQuoteEnd: Char; ACount: SizeInt; Options: TStringSplitOptions): TStringArray; overload;\r\n    Function StartsWith(const AValue: string): Boolean; overload; inline;\r\n    Function StartsWith(const AValue: string; IgnoreCase: Boolean): Boolean; overload;\r\n    Function Substring(AStartIndex: SizeInt): string; overload;\r\n    Function Substring(AStartIndex: SizeInt; ALen: SizeInt): string; overload;\r\n    Function ToBoolean: Boolean; overload; inline;\r\n    Function ToInteger: Integer; overload; inline;\r\n    Function ToNativeInt: NativeInt; overload; inline;\r\n    Function ToDouble: Double; overload; inline;\r\n    Function ToExtended: Extended; overload; inline;\r\n    Function ToCharArray: TCharArray; overload;\r\n    Function ToCharArray(AStartIndex: SizeInt; ALen: SizeInt): TCharArray; overload;\r\n    Function ToLower: string; overload; inline;\r\n    Function ToLowerInvariant: string;\r\n    Function ToUpper: string; overload; inline;\r\n    Function ToUpperInvariant: string; inline;\r\n    Function Trim: string; overload;\r\n    Function TrimLeft: string; overload;\r\n    Function TrimRight: string; overload;\r\n    Function Trim(const ATrimChars: array of Char): string; overload;\r\n    Function TrimLeft(const ATrimChars: array of Char): string; overload;\r\n    Function TrimRight(const ATrimChars: array of Char): string; overload;\r\n    Function TrimEnd(const ATrimChars: array of Char): string; deprecated 'Use TrimRight';\r\n    Function TrimStart(const ATrimChars: array of Char): string; deprecated 'Use TrimLeft';\r\n    property Chars[AIndex: SizeInt]: Char read GetChar;\r\n    property Length: SizeInt read GetLength;\r\n  end;\r\n\r\n  TDoubleHelper = Type Helper for Double\r\n  private\r\n    Function GetB(AIndex: Cardinal): Byte;\r\n    Function GetW(AIndex: Cardinal): Word;\r\n    Function GetE: NativeUInt; inline;\r\n    Function GetF: NativeUInt; inline;\r\n    Function GetS: Boolean; inline;\r\n    Procedure SetS(aValue : Boolean); inline;\r\n    procedure SetB(AIndex: Cardinal; const AValue: Byte);\r\n    procedure SetW(AIndex: Cardinal; const AValue: Word);\r\n  public\r\n    const\r\n    {$push}\r\n    {$R-}\r\n    {$Q-}\r\n      Epsilon          : Double = 4.9406564584124654418e-324;\r\n      MaxValue         : Double = 1.7976931348623157081e+308;\r\n      MinValue         : Double = -1.7976931348623157081e+308;\r\n      // PositiveInfinity : Double = 1.0/0.0;\r\n      // NegativeInfinity : Double = -1.0/0.0;\r\n      // NaN              : Double = 0.0/0.0;\r\n    {$POP}\r\n    Class Function IsInfinity(const AValue: Double): Boolean; overload; inline; static;\r\n    Class Function IsNan(const AValue: Double): Boolean; overload; inline; static;\r\n    Class Function IsNegativeInfinity(const AValue: Double): Boolean; overload; inline; static;\r\n    Class Function IsPositiveInfinity(const AValue: Double): Boolean; overload; inline; static;\r\n    Class Function Parse(const AString: string): Double; overload; inline; static;\r\n    Class Function ToString(const AValue: Double): string; overload; inline; static;\r\n    Class Function ToString(const AValue: Double; const AFormat: TFloatFormat; const APrecision, ADigits: Integer): string; overload; inline; static;\r\n    Class Function TryParse(const AString: string; out AValue: Double): Boolean; overload; inline; static;\r\n\r\n    Procedure BuildUp(const ASignFlag: Boolean; const AMantissa: NativeUInt; const AExponent: Integer);\r\n    Function Exponent: Integer;\r\n    Function Fraction: Extended;\r\n    Function IsInfinity: Boolean; overload; inline;\r\n    Function IsNan: Boolean; overload; inline;\r\n    Function IsNegativeInfinity: Boolean; overload; inline;\r\n    Function IsPositiveInfinity: Boolean; overload; inline;\r\n    Function Mantissa: NativeUInt;\r\n\r\n    Function ToString(const AFormat: TFloatFormat; const APrecision, ADigits: Integer): string; overload; inline;\r\n    Function ToString: string; overload; inline;\r\n\r\n    property Bytes[AIndex: Cardinal]: Byte read GetB write SetB;  // 0..7\r\n    property Words[AIndex: Cardinal]: Word read GetW write SetW; // 0..3\r\n    property Sign: Boolean read GetS Write SetS;\r\n    property Exp: NativeUInt read GetE;\r\n    property Frac: NativeUInt read GetF;\r\n  end;\r\n\r\n  TByteHelper = Type Helper for Byte\r\n  public\r\n    const\r\n      MaxValue = 255;\r\n      MinValue = 0;\r\n  public\r\n    Class Function Parse(const AString: string): Byte; inline; static;\r\n    Class Function Size: Integer; inline; static;\r\n    Class Function ToString(const AValue: Byte): string; overload; inline; static;\r\n    Class Function TryParse(const AString: string; out AValue: Byte): Boolean; inline; static;\r\n  Public\r\n    Function ToBoolean: Boolean; inline;\r\n    Function ToDouble: Double; inline;\r\n    Function ToExtended: Extended; inline;\r\n    Function ToBinString:string; inline;\r\n    Function ToHexString(const AMinDigits: Integer): string; overload; inline;\r\n    Function ToHexString: string; overload; inline;\r\n    Function ToString: string; overload; inline;\r\n    Function SetBit(const Index: TByteBitIndex) : Byte; inline;\r\n    Function ClearBit(const Index: TByteBitIndex) : Byte; inline;\r\n    Function ToggleBit(const Index: TByteBitIndex) : Byte; inline;\r\n    Function TestBit(const Index:TByteBitIndex):Boolean; inline;\r\n  end;\r\n\r\n  TShortIntHelper = Type Helper for ShortInt\r\n  public\r\n    const\r\n      MaxValue = 127;\r\n      MinValue = -128;\r\n  public\r\n    Class Function Parse(const AString: string): ShortInt; inline; static;\r\n    Class Function Size: Integer; inline; static;\r\n    Class Function ToString(const AValue: ShortInt): string; overload; inline; static;\r\n    Class Function TryParse(const AString: string; out AValue: ShortInt): Boolean; inline; static;\r\n  public\r\n    Function ToBoolean: Boolean; inline;\r\n    Function ToDouble: Double; inline;\r\n    Function ToExtended: Extended; inline;\r\n    Function ToBinString:string; inline;\r\n    Function ToHexString(const AMinDigits: Integer): string; overload; inline;\r\n    Function ToHexString: string; overload; inline;\r\n    Function ToString: string; overload; inline;\r\n    Function SetBit(const Index: TShortIntBitIndex): Shortint; inline;\r\n    Function ClearBit(const Index: TShortIntBitIndex): Shortint; inline;\r\n    Function ToggleBit(const Index: TShortIntBitIndex): Shortint; inline;\r\n    Function TestBit(const Index:TShortIntBitIndex):Boolean; inline;\r\n  end;\r\n\r\n  TSmallIntHelper = Type Helper for SmallInt\r\n  public\r\n    const\r\n      MaxValue = 32767;\r\n      MinValue = -32768;\r\n  public\r\n    Class Function Parse(const AString: string): SmallInt; inline; static;\r\n    Class Function Size: Integer; inline; static;\r\n    Class Function ToString(const AValue: SmallInt): string; overload; inline; static;\r\n    Class Function TryParse(const AString: string; out AValue: SmallInt): Boolean; inline; static;\r\n  public\r\n    Function ToString: string; overload; inline;\r\n    Function ToBoolean: Boolean; inline;\r\n    Function ToBinString:string; inline;\r\n    Function ToHexString: string; overload; inline;\r\n    Function ToHexString(const AMinDigits: Integer): string; overload; inline;\r\n    Function ToDouble: Double; inline;\r\n    Function ToExtended: Extended; inline;\r\n    Function SetBit(const Index: TSmallIntBitIndex) : Smallint; inline;\r\n    Function ClearBit(const Index: TSmallIntBitIndex) : Smallint; inline;\r\n    Function ToggleBit(const Index: TSmallIntBitIndex) : Smallint; inline;\r\n    Function TestBit(const Index:TSmallIntBitIndex):Boolean; inline;\r\n  end;\r\n\r\n  TWordHelper = Type Helper for Word\r\n  public\r\n    const\r\n      MaxValue = 65535;\r\n      MinValue = 0;\r\n  Public\r\n    Class Function Parse(const AString: string): Word; inline; static;\r\n    Class Function Size: Integer; inline; static;\r\n    Class Function ToString(const AValue: Word): string; overload; inline; static;\r\n    Class Function TryParse(const AString: string; out AValue: Word): Boolean; inline; static;\r\n  Public\r\n    Function ToBoolean: Boolean; inline;\r\n    Function ToDouble: Double; inline;\r\n    Function ToExtended: Extended; inline;\r\n    Function ToBinString:string; inline;\r\n    Function ToHexString(const AMinDigits: Integer): string; overload; inline;\r\n    Function ToHexString: string; overload; inline;\r\n    Function ToString: string; overload; inline;\r\n    Function SetBit(const Index: TWordBitIndex) : Word; inline;\r\n    Function ClearBit(const Index: TWordBitIndex) : Word; inline;\r\n    Function ToggleBit(const Index: TWordBitIndex) : Word; inline;\r\n    Function TestBit(const Index:TWordBitIndex):Boolean; inline;\r\n  end;\r\n\r\n  TCardinalHelper = Type Helper for Cardinal { for LongWord Type too }\r\n  public\r\n    const\r\n      MaxValue = 4294967295;\r\n      MinValue = 0;\r\n  Public\r\n    Class Function Parse(const AString: string): Cardinal; inline; static;\r\n    Class Function Size: Integer; inline; static;\r\n    Class Function ToString(const AValue: Cardinal): string; overload; inline; static;\r\n    Class Function TryParse(const AString: string; out AValue: Cardinal): Boolean; inline; static;\r\n  Public\r\n    Function ToBoolean: Boolean; inline;\r\n    Function ToDouble: Double; inline;\r\n    Function ToExtended: Extended; inline;\r\n    Function ToBinString:string; inline;\r\n    Function ToHexString(const AMinDigits: Integer): string; overload; inline;\r\n    Function ToHexString: string; overload; inline;\r\n    Function ToString: string; overload; inline;\r\n    Function SetBit(const Index: TCardinalBitIndex) : Cardinal; inline;\r\n    Function ClearBit(const Index: TCardinalBitIndex) : Cardinal; inline;\r\n    Function ToggleBit(const Index: TCardinalBitIndex) : Cardinal; inline;\r\n    Function TestBit(const Index:TCardinalBitIndex):Boolean; inline;\r\n  end;\r\n\r\n  TIntegerHelper = Type Helper for Integer { for LongInt Type too }\r\n  public\r\n    const\r\n      MaxValue = 2147483647;\r\n      MinValue = -2147483648;\r\n  Public\r\n    Class Function Size: Integer; inline; static;\r\n    Class Function ToString(const AValue: Integer): string; overload; inline; static;\r\n    Class Function Parse(const AString: string): Integer; inline; static;\r\n    Class Function TryParse(const AString: string; out AValue: Integer): Boolean; inline; static;\r\n  Public\r\n    Function ToBoolean: Boolean; inline;\r\n    Function ToDouble: Double; inline;\r\n    Function ToExtended: Extended; inline;\r\n    Function ToBinString:string; inline;\r\n    Function ToHexString(const AMinDigits: Integer): string; overload; inline;\r\n    Function ToHexString: string; overload; inline;\r\n    Function ToString: string; overload; inline;\r\n    Function SetBit(const Index: TIntegerBitIndex) : Integer; inline;\r\n    Function ClearBit(const Index: TIntegerBitIndex) : Integer; inline;\r\n    Function ToggleBit(const Index: TIntegerBitIndex) : Integer; inline;\r\n    Function TestBit(const Index:TIntegerBitIndex):Boolean; inline;\r\n  end;\r\n\r\n  TNativeIntHelper = Type Helper for NativeInt\r\n  public\r\n    const\r\n      MaxValue = High(NativeInt);\r\n      MinValue = Low(NativeInt);\r\n  Public\r\n    Class Function Parse(const AString: string): NativeInt; inline; static;\r\n    Class Function Size: Integer; inline; static;\r\n    Class Function ToString(const AValue: NativeInt): string; overload; inline; static;\r\n    Class Function TryParse(const AString: string; out AValue: NativeInt): Boolean; inline; static;\r\n  Public\r\n    Function ToBoolean: Boolean; inline;\r\n    Function ToDouble: Double; inline;\r\n    Function ToExtended: Extended; inline;\r\n    Function ToBinString:string; inline;\r\n    Function ToHexString(const AMinDigits: Integer): string; overload; inline;\r\n    Function ToHexString: string; overload; inline;\r\n    Function ToString: string; overload; inline;\r\n    Function SetBit(const Index: TNativeIntBitIndex) : NativeInt; inline;\r\n    Function ClearBit(const Index: TNativeIntBitIndex) : NativeInt; inline;\r\n    Function ToggleBit(const Index: TNativeIntBitIndex) : NativeInt; inline;\r\n    Function TestBit(const Index:TNativeIntBitIndex):Boolean; inline;\r\n  end;\r\n\r\n  TNativeUIntHelper = Type Helper for NativeUInt\r\n  public\r\n    const\r\n      MaxValue = High(NativeUInt);\r\n      MinValue = 0;\r\n  Public\r\n    Class Function Parse(const AString: string): NativeUInt; inline; static;\r\n    Class Function Size: Integer; inline; static;\r\n    Class Function ToString(const AValue: NativeUInt): string; overload; inline; static;\r\n    Class Function TryParse(const AString: string; out AValue: NativeUInt): Boolean; inline; static;\r\n  Public\r\n    Function ToBoolean: Boolean; inline;\r\n    Function ToDouble: Double; inline;\r\n    Function ToExtended: Extended; inline;\r\n    Function ToBinString:string; inline;\r\n    Function ToHexString(const AMinDigits: Integer): string; overload; inline;\r\n    Function ToHexString: string; overload; inline;\r\n    Function ToSingle: Single; inline;\r\n    Function ToString: string; overload; inline;\r\n    Function SetBit(const Index: TNativeUIntBitIndex) : NativeUint; inline;\r\n    Function ClearBit(const Index: TNativeUIntBitIndex): NativeUint; inline;\r\n    Function ToggleBit(const Index: TNativeUIntBitIndex) : NativeUint; inline;\r\n    Function TestBit(const Index:TNativeUIntBitIndex) :Boolean; inline;\r\n  end;\r\n\r\n{$SCOPEDENUMS ON}\r\n  TUseBoolStrs = (False,True);\r\n{$SCOPEDENUMS OFF}\r\n\r\n  TBooleanHelper = Type Helper for Boolean\r\n  public\r\n    Class Function Parse(const S: string): Boolean; inline; static;\r\n    Class Function Size: Integer; inline; static;\r\n    Class Function ToString(const AValue: Boolean; UseBoolStrs: TUseBoolStrs = TUseBoolStrs.false): string; overload; inline; static;\r\n    Class Function TryToParse(const S: string; out AValue: Boolean): Boolean; inline; static;\r\n  Public\r\n    Function ToInteger: Integer; inline;\r\n    Function ToString(UseBoolStrs: TUseBoolStrs = TUseBoolStrs.False): string; overload; inline;\r\n  end;\r\n\r\n  TByteBoolHelper = Type Helper for ByteBool\r\n  public\r\n    Class Function Parse(const S: string): Boolean; inline; static;\r\n    Class Function Size: Integer; inline; static;\r\n    Class Function ToString(const AValue: Boolean; UseBoolStrs : Boolean = False): string; overload; inline; static;\r\n    Class Function TryToParse(const S: string; out AValue: Boolean): Boolean; inline; static;\r\n  Public\r\n    Function ToInteger: Integer; inline;\r\n    Function ToString(UseBoolStrs: Boolean = False): string; overload; inline;\r\n  end;\r\n\r\n  TWordBoolHelper = Type Helper for WordBool\r\n  public\r\n    Class Function Parse(const S: string): Boolean; inline; static;\r\n    Class Function Size: Integer; inline; static;\r\n    Class Function ToString(const AValue: Boolean; UseBoolStrs: Boolean = False): string; overload; inline; static;\r\n    Class Function TryToParse(const S: string; out AValue: Boolean): Boolean; inline; static;\r\n  Public\r\n    Function ToInteger: Integer; inline;\r\n    Function ToString(UseBoolStrs: boolean = False): string; overload; inline;\r\n  end;\r\n\r\n  TLongBoolHelper = Type Helper for LongBool\r\n  public\r\n    Class Function Parse(const S: string): Boolean; inline; static;\r\n    Class Function Size: Integer; inline; static;\r\n    Class Function ToString(const AValue: Boolean; UseBoolStrs: Boolean= False): string; overload; inline; static;\r\n    Class Function TryToParse(const S: string; out AValue: Boolean): Boolean; inline; static;\r\n  public\r\n    Function ToInteger: Integer; inline;\r\n    Function ToString(UseBoolStrs: Boolean = False): string; overload; inline;\r\n  end;\r\n\r\n  { TStringBuilder }\r\n\r\n  TStringBuilder = class\r\n  private\r\n    const\r\n      DefaultCapacity = 64;\r\n  private\r\n    Function  GetCapacity: Integer;\r\n    Procedure SetCapacity(AValue: Integer);\r\n    Function  GetC(Index: Integer): Char;\r\n    Procedure SetC(Index: Integer; AValue: Char);\r\n    Function  GetLength: Integer; inline;\r\n    Procedure SetLength(AValue: Integer);\r\n  protected\r\n    FData: String;\r\n    FMaxCapacity: Integer;\r\n    // Raise error on range check.\r\n    Procedure CheckRange(Idx,Count,MaxLen : Integer);inline;\r\n    Procedure CheckNegative(Const AValue : Integer; Const AName: String); inline;\r\n    // All appends/inserts pass through here.\r\n\r\n    Procedure DoAppend(Const S : String);virtual;\r\n    Procedure DoAppend(const AValue: Array of char; Idx, aCount: Integer); virtual;\r\n    Procedure DoInsert(Index: Integer; const AValue: String); virtual;\r\n    Procedure DoInsert(Index: Integer; const AValue: Array of char; StartIndex, aCharCount: Integer); virtual;\r\n    Procedure DoReplace(Index: Integer; const Old, New: String); virtual;\r\n    Procedure Grow;\r\n    Procedure Shrink;\r\n  public\r\n    Constructor Create;\r\n    Constructor Create(aCapacity: Integer);\r\n    Constructor Create(const AValue: String);\r\n    Constructor Create(aCapacity: Integer; aMaxCapacity: Integer);\r\n    Constructor Create(const AValue: String; aCapacity: Integer);\r\n    Constructor Create(const AValue: String; StartIndex: Integer; aLength: Integer; aCapacity: Integer);\r\n\r\n    Function Append(const AValue: Boolean): TStringBuilder;\r\n    Function Append(const AValue: Byte): TStringBuilder;\r\n    Function Append(const AValue: Char): TStringBuilder;\r\n    Function Append(const AValue: Currency): TStringBuilder;\r\n    Function Append(const AValue: Double): TStringBuilder;\r\n    Function Append(const AValue: Smallint): TStringBuilder;\r\n    Function Append(const AValue: LongInt): TStringBuilder;\r\n    Function Append(const AValue: Int64): TStringBuilder;\r\n    Function Append(const AValue: TObject): TStringBuilder;\r\n    Function Append(const AValue: Shortint): TStringBuilder;\r\n    Function Append(const AValue: UInt64): TStringBuilder;\r\n    Function Append(const AValue: Array of char): TStringBuilder;\r\n    Function Append(const AValue: Word): TStringBuilder;\r\n    Function Append(const AValue: Cardinal): TStringBuilder;\r\n    Function Append(const AValue: String): TStringBuilder;\r\n    Function Append(const AValue: Char; RepeatCount: Integer): TStringBuilder;\r\n    Function Append(const AValue: Array of char; StartIndex: Integer; SBCharCount: Integer): TStringBuilder;\r\n    Function Append(const AValue: String; StartIndex: Integer; Count: Integer): TStringBuilder;\r\n\r\n    Function Append(const Fmt: String; const Args: array of const): TStringBuilder;\r\n    Function AppendFormat(const Fmt: String; const Args: array of const): TStringBuilder;\r\n    Function AppendLine: TStringBuilder;\r\n    Function AppendLine(const AValue: String): TStringBuilder;\r\n\r\n    Procedure Clear;\r\n    Procedure CopyTo(SourceIndex: Integer; Var Destination: Array of char; DestinationIndex: Integer; Count: Integer);\r\n    Function EnsureCapacity(aCapacity: Integer): Integer;\r\n    Function Equals(StringBuilder: TStringBuilder): Boolean; reintroduce;\r\n\r\n    Function Insert(Index: Integer; const AValue: Boolean): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: Byte): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: Char): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: Currency): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: Double): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: Smallint): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: LongInt): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: Array of char): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: Int64): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: TObject): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: Shortint): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: String): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: Word): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: Cardinal): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: UInt64): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: String; const aRepeatCount: Integer): TStringBuilder;\r\n    Function Insert(Index: Integer; const AValue: Array of char; startIndex: Integer; SBCharCount: Integer): TStringBuilder;\r\n\r\n    Function Remove(StartIndex: Integer; RemLength: Integer): TStringBuilder;\r\n\r\n    Function Replace(const OldValue, NewValue: String): TStringBuilder;\r\n    Function Replace(const OldValue, NewValue: String; StartIndex: Integer; Count: Integer): TStringBuilder;\r\n    Function ToString: String; override;\r\n    Function ToString(aStartIndex: Integer; aLength: Integer): String; reintroduce;\r\n    property Chars[index: Integer]: Char read GetC write SetC; default;\r\n    property Length: Integer read GetLength write SetLength;\r\n    property Capacity: Integer read GetCapacity write SetCapacity;\r\n    property MaxCapacity: Integer read FMaxCapacity;\r\n  end;\r\n\r\n\r\n\r\nimplementation\r\n\r\nConst\r\n  DefaultShortMonthNames : TMonthNames = (\r\n    'Jan',\r\n    'Feb',\r\n    'Mar',\r\n    'Apr',\r\n    'May',\r\n    'Jun',\r\n    'Jul',\r\n    'Aug',\r\n    'Sep',\r\n    'Oct',\r\n    'Nov',\r\n    'Dec');\r\n  DefaultLongMonthNames : TMonthNames = (\r\n    'January',\r\n    'February',\r\n    'March',\r\n    'April',\r\n    'May',\r\n    'June',\r\n    'July',\r\n    'August',\r\n    'September',\r\n    'October',\r\n    'November',\r\n    'December');\r\n  DefaultShortDayNames : TDayNames = (\r\n    'Sun',\r\n    'Mon',\r\n    'Tue',\r\n    'Wed',\r\n    'Thu',\r\n    'Fri',\r\n    'Sat');\r\n\r\n  DefaultLongDayNames : TDayNames = (\r\n    'Sunday',\r\n    'Monday',\r\n    'Tuesday',\r\n    'Wednesday',\r\n    'Thursday',\r\n    'Friday',\r\n    'Saturday');\r\n\r\nvar\r\n  FInvariant: TFormatSettings;\r\n  FInvariantCreated: Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Exception handling\r\n  ---------------------------------------------------------------------}\r\nResourcestring\r\n  SAbortError = 'Operation aborted';\r\n  SApplicationException = 'Application raised an exception: ';\r\n  SErrUnknownExceptionType = 'Caught unknown exception type : ';\r\n\r\nprocedure DoShowException(S : String);\r\n\r\nbegin\r\n  if Assigned(OnShowException) then\r\n    OnShowException(S)\r\n  else\r\n    begin\r\n    {$IFDEF BROWSER}\r\n      asm\r\n        window.alert(S);\r\n      end;\r\n    {$ENDIF}\r\n    {$IFDEF NODEJS}\r\n      Writeln(S);\r\n    {$ENDIF}\r\n    end;\r\nend;\r\n\r\nprocedure ShowException(ExceptObject: TObject; ExceptAddr: Pointer = Nil);\r\n\r\nVar\r\n  S : String;\r\n\r\nbegin\r\n  S:=SApplicationException+ExceptObject.ClassName;\r\n  if ExceptObject is Exception then\r\n    S:=S+' : '+Exception(ExceptObject).Message;\r\n  DoShowException(S);\r\n  if ExceptAddr=nil then;\r\nend;\r\n\r\nType\r\n  TRTLExceptionHandler = procedure (aError : JSValue);\r\n\r\nVar\r\n  rtlExceptionHandler : TRTLExceptionHandler; External name 'rtl.onUncaughtException';\r\n  rtlShowUncaughtExceptions : Boolean; External name 'rtl.showUncaughtExceptions';\r\n  OnPascalException : TUncaughtPascalExceptionHandler;\r\n  OnJSException : TUncaughtJSExceptionHandler;\r\n\r\nProcedure RTLExceptionHook(aError : JSValue);\r\n\r\nVar\r\n  S : String;\r\n\r\nbegin\r\n  if isClassInstance(aError) then\r\n    begin\r\n    if Assigned(OnPascalException) then\r\n      OnPascalException(TObject(aError))\r\n    else\r\n      ShowException(TObject(aError),Nil);\r\n    end\r\n  else if isObject(aError) then\r\n    begin\r\n    if Assigned(OnJSException) then\r\n      OnJSException(TJSObject(aError))\r\n    else\r\n      begin\r\n      if TJSObject(aError).hasOwnProperty('message') then\r\n        S:=SErrUnknownExceptionType+String(TJSObject(aError).Properties['message'])\r\n      else\r\n        S:=SErrUnknownExceptionType+TJSObject(aError).toString;\r\n      DoShowException(S);\r\n      end\r\n    end\r\n  else\r\n    begin\r\n    S:=SErrUnknownExceptionType+String(aError);\r\n    DoShowException(S);\r\n    end;\r\nend;\r\n\r\n\r\n\r\nFunction SetOnUnCaughtExceptionHandler(aValue : TUncaughtPascalExceptionHandler) : TUncaughtPascalExceptionHandler;\r\n\r\nbegin\r\n  Result:=OnPascalException;\r\n  OnPascalException:=aValue;\r\n  HookUncaughtExceptions;\r\nend;\r\n\r\nFunction SetOnUnCaughtExceptionHandler(aValue : TUncaughtJSExceptionHandler) : TUncaughtJSExceptionHandler;\r\n\r\nbegin\r\n  Result:=OnJSException;\r\n  OnJSException:=aValue;\r\n  HookUncaughtExceptions;\r\nend;\r\n\r\nProcedure HookUncaughtExceptions;\r\n\r\nbegin\r\n  rtlExceptionHandler:=@RTLExceptionHook;\r\n  rtlShowUncaughtExceptions:=True;\r\nend;\r\n\r\nprocedure Abort;\r\nbegin\r\n  Raise EAbort.Create(SAbortError);\r\nend;\r\n\r\nFunction CharInSet(Ch: Char;Const CSet : TSysCharSet) : Boolean; overload;\r\nbegin\r\n  Result:=Ch in CSet;\r\nend;\r\n\r\nfunction CharInSet(Ch: Char; const CSet: array of char): Boolean; overload;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  Result:=False;\r\n  I:=Length(CSet)-1;\r\n  While (Not Result) and (I>=0) do\r\n    begin\r\n    Result:=(Ch=CSet[i]);\r\n    Dec(I);\r\n    end;\r\nend;\r\n\r\nfunction LeftStr(const S: string; Count: Integer): String; assembler;\r\nasm\r\n  return (Count>0) ? S.substr(0,Count) : \"\";\r\nend;\r\n\r\nfunction RightStr(const S: string; Count: Integer): String; assembler;\r\nasm\r\n  var l = S.length;\r\n  return (Count<1) ? \"\" : ( Count>=l ? S : S.substr(l-Count));\r\nend;\r\n\r\nfunction Trim(const S: String): String; assembler;\r\nasm\r\n  return S.replace(/^[\\s\\uFEFF\\xA0\\x00-\\x1f]+/,'').replace(/[\\s\\uFEFF\\xA0\\x00-\\x1f]+$/,'');\r\nend;\r\n\r\nfunction TrimLeft(const S: String): String; assembler;\r\nasm\r\n  return S.replace(/^[\\s\\uFEFF\\xA0\\x00-\\x1f]+/,'');\r\nend;\r\n\r\nfunction TrimRight(const S: String): String; assembler;\r\nasm\r\n  return S.replace(/[\\s\\uFEFF\\xA0\\x00-\\x1f]+$/,'');\r\nend;\r\n\r\nfunction IntToStr(const Value: Integer): string;\r\nbegin\r\n  Result:=str(Value);\r\nend;\r\n\r\nfunction FloatToDecimal(Value: double; Precision, Decimals: integer): TFloatRec;\r\n\r\nConst\r\n  Rounds = '123456789:';\r\n\r\nvar\r\n  Buffer: String;  //Though str func returns only 25 chars, this might change in the future\r\n  InfNan: string;\r\n  OutPos,Error, N, L, C: Integer;\r\n  GotNonZeroBeforeDot, BeforeDot : boolean;\r\n\r\nbegin\r\n  Result.Negative:=False;\r\n  Result.Exponent:=0;\r\n  For C:=0 to FloatRecDigits do\r\n    Result.Digits[C]:='0';\r\n  if Value=0 then\r\n    exit;\r\n  asm\r\n    Buffer=Value.toPrecision(21); // Double precision\r\n  end;\r\n  // Writeln('Buffer :',Buffer);\r\n  N := 1;\r\n  L := Length(Buffer);\r\n  while Buffer[N]=' ' do\r\n    Inc(N);\r\n  Result.Negative := (Buffer[N] = '-');\r\n  if Result.Negative then\r\n    Inc(N)\r\n  else if (Buffer[N] = '+') then\r\n    inc(N);\r\n  { special cases for Inf and Nan }\r\n  if (L>=N+2) then\r\n    begin\r\n      InfNan:=copy(Buffer,N,3);\r\n      if (InfNan='Inf') then\r\n        begin\r\n          Result.Digits[0]:=#0;\r\n          Result.Exponent:=32767;\r\n          exit\r\n        end;\r\n      if (InfNan='Nan') then\r\n        begin\r\n          Result.Digits[0]:=#0;\r\n          Result.Exponent:=-32768;\r\n          exit\r\n        end;\r\n    end;\r\n  //Start := N;  //Start of digits\r\n  Outpos:=0;\r\n  Result.Exponent := 0; BeforeDot := true;\r\n  GotNonZeroBeforeDot := false;\r\n  while (L>=N) and (Buffer[N]<>'E') do\r\n    begin\r\n      // Writeln('Examining : ',Buffer[N],'( output pos: ',outPos,')');\r\n      if Buffer[N]='.' then\r\n        BeforeDot := false\r\n      else\r\n        begin\r\n        if BeforeDot then\r\n          begin  // Currently this is always 1 char\r\n            Inc(Result.Exponent);\r\n            Result.Digits[Outpos] := Buffer[N];\r\n            if Buffer[N] <> '0' then\r\n              GotNonZeroBeforeDot := true;\r\n          end\r\n        else\r\n          Result.Digits[Outpos] := Buffer[N];\r\n        Inc(outpos);\r\n        end;\r\n      Inc(N);\r\n    end;\r\n  Inc(N); // Pass through 'E'\r\n  if N<=L then\r\n    begin\r\n      Val(Copy(Buffer, N, L-N+1), C, Error); // Get exponent after 'E'\r\n      Inc(Result.Exponent, C);\r\n    end;\r\n  // Calculate number of digits we have from str\r\n  N:=OutPos;\r\n  // Writeln('Number of digits: ',N,' requested precision : ',Precision);\r\n  L:=Length(Result.Digits);\r\n  While N<L do\r\n    begin\r\n    Result.Digits[N]:='0';  //Zero remaining space\r\n    Inc(N);\r\n    end;\r\n  if Decimals + Result.Exponent < Precision Then //After this it is the same as in FloatToDecimal\r\n    N := Decimals + Result.Exponent\r\n  Else\r\n    N := Precision;\r\n  if N >= L Then\r\n    N := L-1;\r\n  // Writeln('Rounding on digit : ',N);\r\n  if N = 0 Then\r\n    begin\r\n      if Result.Digits[0] >= '5' Then\r\n        begin\r\n          Result.Digits[0] := '1';\r\n          Result.Digits[1] := #0;\r\n          Inc(Result.Exponent);\r\n        end\r\n      Else\r\n        Result.Digits[0] := #0;\r\n    end  //N=0\r\n  Else if N > 0 Then\r\n    begin\r\n      if Result.Digits[N] >= '5' Then\r\n        begin\r\n          Repeat\r\n            Result.Digits[N] := #0;\r\n            Dec(N);\r\n            // Writeln(N,': ',Result.Digits[N],', Rounding to : ',Rounds[StrToInt(Result.Digits[N])]);\r\n            Result.Digits[N]:=Rounds[StrToInt(Result.Digits[N])+1];\r\n          Until (N = 0) Or (Result.Digits[N] < ':');\r\n          If Result.Digits[0] = ':' Then\r\n            begin\r\n              Result.Digits[0] := '1';\r\n              Inc(Result.Exponent);\r\n            end;\r\n        end\r\n      Else\r\n        begin\r\n          Result.Digits[N] := '0';\r\n          While (N > -1) And (Result.Digits[N] = '0') Do\r\n            begin\r\n              Result.Digits[N] := #0;\r\n              Dec(N);\r\n            end;\r\n        end;\r\n      end //N>0\r\n  Else\r\n    Result.Digits[0] := #0;\r\n  if (Result.Digits[0] = #0) and\r\n     not GotNonZeroBeforeDot then\r\n    begin\r\n      Result.Exponent := 0;\r\n      Result.Negative := False;\r\n    end;\r\nend;\r\n\r\n\r\nFunction FloatToStr(Value: Double; const aSettings : TFormatSettings): String; overload;\r\n\r\nbegin\r\n  Result:=FloatToStrF(Value,ffGeneral,15,0,aSettings);\r\nend;\r\n\r\nfunction FloatToStr(Value: Double): String;\r\nbegin\r\n  Result:=FloatToStr(Value,FormatSettings);\r\nend;\r\n\r\nfunction TryStrToFloat(const S: String; out res: Extended): Boolean;\r\nbegin\r\n  Result:=TryStrToFloat(S,double(res));\r\nend;\r\n\r\nfunction TryStrToFloat(const S: String; out res: Double): Boolean;\r\n\r\nbegin\r\n  Result:=TryStrToFloat(S,Res,FormatSettings);\r\nend;\r\n\r\nfunction TryStrToFloat(const S: String; out res: Extended; const aSettings : TFormatSettings): Boolean;\r\n\r\nbegin\r\n  Result:=TryStrToFloat(S,double(res),aSettings);\r\nend;\r\n\r\nfunction TryStrToFloat(const S: String; out res: Double; const aSettings : TFormatSettings): Boolean;\r\n\r\nVar\r\n  J : JSValue;\r\n  N : String;\r\n\r\nbegin\r\n  N:=S;\r\n  // Delocalize\r\n  if (aSettings.ThousandSeparator <>'') then\r\n    N:=StringReplace(N,aSettings.ThousandSeparator,'',[rfReplaceAll]);\r\n  if (aSettings.DecimalSeparator<>'.') then\r\n    N:=StringReplace(N,aSettings.DecimalSeparator,'.',[]);\r\n  J:=parseFloat(N);\r\n  Result:=Not jsIsNaN(J);\r\n  if Result then\r\n    Res:=Double(J);\r\nend;\r\n\r\nfunction StrToFloatDef(const S: String; const aDef: Double; const aSettings : TFormatSettings): Double;\r\nbegin\r\n  if not TryStrToFloat(S,Result,aSettings) then\r\n    Result:=aDef;\r\nend;\r\n\r\nfunction StrToFloatDef(const S: String; const aDef: Double): Double;\r\nbegin\r\n  if not TryStrToFloat(S,Result,FormatSettings) then\r\n    Result:=aDef;\r\nend;\r\n\r\nfunction StrToFloat(const S: String): Double;\r\nbegin\r\n  Result:=StrToFloat(S,FormatSettings);\r\nend;\r\n\r\nfunction StrToFloat(const S: String; const aSettings : TFormatSettings): Double;\r\nbegin\r\n  if not TryStrToFloat(S,Result,aSettings) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidFloat,[S]);\r\nend;\r\n\r\nFunction FormatFloat (Fmt : String; aValue : Double) : String;\r\nbegin\r\n  Result:=FormatFloat(Fmt,aValue,FormatSettings);\r\nend;\r\n\r\nfunction FormatFloat(Fmt: String; aValue: Double; aSettings : TFormatSettings): String;\r\n\r\nType\r\n  TPosArray = Array of Integer;\r\n\r\nconst\r\n  MaxPrecision = 18;  // Extended precision\r\n\r\nvar\r\n  // Input in usable format\r\n  E : Extended;              // Value as extended.\r\n  FV: TFloatRec;             // Value as floatrec.\r\n  Section : String;          // Format can contain 3 sections, semicolon separated: Pos;Neg;Zero. This is the one to use.\r\n  SectionLength : Integer;   // Length of section.\r\n  // Calculated based on section. Static during output\r\n  ThousandSep: Boolean;      // Thousands separator detected in format ?\r\n  IsScientific: Boolean;     // Use Scientific notation ? (E detected in format)\r\n  DecimalPos: Integer;       // Position of decimal point in pattern.\r\n  FirstDigit: Integer;       // First actual digit in input (# or 0), relative to decimal point\r\n  LastDigit: Integer;        // Last required (0) digit, relative to decimal point\r\n  RequestedDigits: Integer;  // Number of requested digits, # and 0 alike\r\n  ExpSize : Integer;         // Number of digits in exponent\r\n  Available: Integer;        // Available digits in FV.\r\n  // These change during output loop\r\n  Current: Integer;          // Current digit in available digits\r\n  PadZeroes: Integer;        // Difference in requested digits before comma and exponent, needs to be padded with zeroes.\r\n  DistToDecimal: Integer;    // Place of current digit, relative to decimal point taking in account PadZeroes!\r\n\r\n  Procedure InitVars;\r\n\r\n  begin\r\n    E:=aValue;\r\n    Section:='';\r\n    SectionLength:=0;\r\n    ThousandSep:=false;\r\n    IsScientific:=false;\r\n    DecimalPos:=0;\r\n    FirstDigit:=MaxInt;\r\n    LastDigit:=0;\r\n    RequestedDigits:=0;\r\n    ExpSize:=0;\r\n    Available:=-1;\r\n  end;\r\n\r\n  procedure ToResult(const AChar: Char);\r\n  begin\r\n    Result:=Result+AChar;\r\n  end;\r\n\r\n  procedure AddToResult(const AStr: String);\r\n\r\n  begin\r\n    Result:=Result+AStr;\r\n  end;\r\n\r\n  procedure WriteDigit(ADigit: Char);\r\n\r\n  // Write a digit to result, prepend with decimalseparator or append with 1000 separator\r\n\r\n  begin\r\n    if ADigit=#0 then exit;\r\n    // Writeln('WriteDigit: ',ADigit,', DistToDecimal: ',DistToDecimal);\r\n    Dec(DistToDecimal);\r\n    // -1 -> we've arrived behind the decimal\r\n    if (DistToDecimal=-1) then\r\n      begin\r\n      AddToResult(aSettings.DecimalSeparator);\r\n      ToResult(ADigit);\r\n      end\r\n    else\r\n      begin\r\n      // We're still before the decimal.\r\n      ToResult(ADigit);\r\n      if ThousandSep and ((DistToDecimal mod 3)=0) and (DistToDecimal>1) then\r\n        AddToResult(aSettings.ThousandSeparator);\r\n      end;\r\n  end;\r\n\r\n  Function GetDigit : Char;\r\n\r\n  // Return next digit from available digits.\r\n  // May return #0 if none available.\r\n  // Will return '0' if applicable.\r\n\r\n  begin\r\n    // Writeln(' DistToDecimal <= LastDigit : ',DistToDecimal,' <= ',LastDigit,' have digit: ',Current<=Available, ' (',Current,')');\r\n    Result:=#0;\r\n    if (Current<=Available) then\r\n      begin\r\n      Result:=FV.Digits[Current];\r\n      Inc(Current);\r\n      end\r\n    else if (DistToDecimal <= LastDigit) then\r\n      Dec(DistToDecimal)\r\n    else\r\n      Result:='0';\r\n    // Writeln('GetDigit ->: ',Result);\r\n  end;\r\n\r\n  procedure CopyDigit;\r\n\r\n  // Copy a digit (#, 0) to the output with the correct value\r\n\r\n  begin\r\n    // Writeln('CopyDigit: Padzeroes: ',PadZeroes,', DistToDecimal: ',DistToDecimal);\r\n    if (PadZeroes=0) then\r\n      WriteDigit(GetDigit) // No shift needed, just copy what is available.\r\n    else if (PadZeroes<0) then\r\n      begin\r\n      // We must prepend zeroes\r\n      Inc(PadZeroes);\r\n      if (DistToDecimal<=FirstDigit) then\r\n        WriteDigit('0')\r\n      else\r\n        Dec(DistToDecimal);\r\n      end\r\n    else\r\n      begin\r\n      // We must append zeroes\r\n      while PadZeroes > 0 do\r\n        begin\r\n        WriteDigit(GetDigit);\r\n        Dec(PadZeroes);\r\n        end;\r\n      WriteDigit(GetDigit);\r\n      end;\r\n  end;\r\n\r\n  Function GetSections(Var SP : TPosArray) : Integer;\r\n\r\n  var\r\n    FL : Integer;\r\n    i : Integer;\r\n    C,Q : Char;\r\n    inQuote : Boolean;\r\n\r\n  begin\r\n    Result:=1;\r\n    SP[1]:=-1;\r\n    SP[2]:=-1;\r\n    SP[3]:=-1;\r\n    inQuote:=False;\r\n    Q:=#0;\r\n    I:=1;\r\n    FL:=Length(Fmt);\r\n    while (I<=FL) do\r\n      begin\r\n      C:=Fmt[I];\r\n      case C of\r\n      ';':\r\n        begin\r\n        if not InQuote then\r\n          begin\r\n          if Result>3 then\r\n            Raise Exception.Create('Invalid float format');\r\n          SP[Result]:=I;\r\n          Inc(Result);\r\n          end;\r\n        end;\r\n      '\"','''':\r\n        begin\r\n        if InQuote then\r\n          InQuote:=C<>Q\r\n        else\r\n          begin\r\n          InQuote:=True;\r\n          Q:=C;\r\n          end;\r\n        end;\r\n      end;\r\n      Inc(I);\r\n      end;\r\n    if SP[Result]=-1 then\r\n      SP[Result]:=FL+1;\r\n  end;\r\n\r\n  Procedure AnalyzeFormat;\r\n\r\n  var\r\n    I,Len: Integer;\r\n    Q,C: Char;\r\n    InQuote : Boolean;\r\n\r\n  begin\r\n    Len:=Length(Section);\r\n    // writeln(len);\r\n    I:=1;\r\n    InQuote:=False;\r\n    Q:=#0;\r\n    while (I<=Len) do\r\n      begin\r\n      C:=Section[i];\r\n      if C in ['\"',''''] then\r\n        begin\r\n        if InQuote then\r\n          InQuote:=C<>Q\r\n        else\r\n          begin\r\n          InQuote:=True;\r\n          Q:=C;\r\n          end;\r\n        end\r\n      else if not InQuote then\r\n        case C of\r\n        '.':\r\n          if (DecimalPos=0) then\r\n            DecimalPos:=RequestedDigits+1;\r\n        ',':\r\n            ThousandSep:=aSettings.ThousandSeparator<>#0;\r\n        'e', 'E':\r\n            begin\r\n            Inc(I);\r\n            if (I<Len) then\r\n              begin\r\n              C:=Section[i];\r\n              IsScientific:=C in ['-','+'];\r\n              if IsScientific then\r\n                while (I<Len) and (Section[i+1]='0') do\r\n                  begin\r\n                  Inc(ExpSize);\r\n                  Inc(I);\r\n                  end;\r\n              if ExpSize>4 then\r\n                ExpSize:=4;\r\n              end;\r\n            end;\r\n        '#':\r\n            Inc(RequestedDigits);\r\n        '0':\r\n            begin\r\n            if RequestedDigits<FirstDigit then\r\n              FirstDigit:=RequestedDigits+1;\r\n            Inc(RequestedDigits);\r\n            LastDigit:=RequestedDigits+1;\r\n            end;\r\n        end;\r\n      Inc(I);\r\n      end;\r\n    if DecimalPos=0 then\r\n      DecimalPos:=RequestedDigits+1;\r\n    // Writeln('LastDigit: ',DecimalPos,'-',LastDigit);\r\n    LastDigit:=DecimalPos-LastDigit;\r\n    if LastDigit>0 then\r\n      LastDigit:=0;\r\n    // Writeln('FirstDigit: ',DecimalPos,'-',FirstDigit);\r\n    FirstDigit:=DecimalPos-FirstDigit;\r\n    if FirstDigit<0 then\r\n      FirstDigit:=0;\r\n  end;\r\n\r\n  Function ValueOutSideScope : Boolean;\r\n  begin\r\n    With FV do\r\n     Result:=((Exponent >= 18) and (not IsScientific)) or (Exponent = $7FF) or (Exponent = $800)\r\n  end;\r\n\r\n  Procedure CalcRunVars;\r\n\r\n  Var\r\n    D,P: Integer;\r\n\r\n  begin\r\n    if IsScientific then\r\n      begin\r\n      P:=RequestedDigits;\r\n      D:=9999;\r\n      end\r\n    else\r\n      begin\r\n      P:=MaxPrecision;\r\n      // Writeln(RequestedDigits,'-',DecimalPos,'+1');\r\n      D:=RequestedDigits-DecimalPos+1;\r\n      end;\r\n    FV:=FloatToDecimal(aValue,P,D);\r\n    // Writeln('Number of digits available : ',Length(FV.Digits));\r\n    //   For p:=0 to Length(FV.Digits)-1 do\r\n    // Writeln(P,': ',FV.Digits[p]);\r\n    DistToDecimal:=DecimalPos-1;\r\n    // Writeln('DistToDecimal : ',DistToDecimal);\r\n    if IsScientific then\r\n      PadZeroes:=0 // No padding.\r\n    else\r\n      begin\r\n      PadZeroes:=FV.Exponent-(DecimalPos-1);\r\n      if (PadZeroes>=0) then\r\n        DistToDecimal:=FV.Exponent\r\n      end;\r\n    // Writeln('PadZeroes : ',PadZeroes, ', DistToDecimal : ',DistToDecimal);\r\n    Available:=-1;\r\n    while (Available<High(FV.Digits)) and (FV.Digits[Available+1]<>#0) do\r\n      Inc(Available);\r\n    // Writeln('Available: ',Available);\r\n  end;\r\n\r\n  Function FormatExponent(ASign: Char; aExponent: Integer) : String;\r\n\r\n  begin\r\n    Result:=IntToStr(aExponent);\r\n    Result:=StringOfChar('0',ExpSize-Length(Result))+Result;\r\n    if (aExponent<0) then\r\n      Result:='-'+Result\r\n    else if (aExponent>0) and (aSign='+') then\r\n      Result:=aSign+Result;\r\n  end;\r\n\r\nvar\r\n  I,S : Integer;\r\n  C,Q : Char;\r\n  PA : TPosArray;\r\n  InLiteral : Boolean;\r\n\r\nbegin\r\n  SetLength(PA,4);\r\n  Result:='';\r\n  Initvars;\r\n  // What section to use ?\r\n  if (E>0) then\r\n    S:=1\r\n  else if (E<0) then\r\n    S:=2\r\n  else\r\n    S:=3;\r\n  PA[0]:=0;\r\n  I:=GetSections(PA);\r\n  if (I<S) or (PA[S]-PA[S-1]=0) then\r\n    S:=1;\r\n  // Extract correct section\r\n  SectionLength:=PA[S]-PA[S-1]-1;\r\n  Section:=Copy(Fmt,PA[S-1]+1,SectionLength);\r\n  SetLength(Section,SectionLength);\r\n  // Writeln('Section ',I,' : \"',Section,'\" ',SectionLength);\r\n  AnalyzeFormat;\r\n  // Writeln('RequestedDigits: ',RequestedDigits,', DecimalPos : ',DecimalPos,', LastDigit: ',LastDigit,', FirstDigit: ',FirstDigit);\r\n  CalcRunVars;\r\n  // If we cannot process value using current settings, fallback\r\n  if (SectionLength=0) or ValueOutSideScope then\r\n    begin\r\n    asm\r\n     Section=E.toPrecision(15);\r\n    end;\r\n    Result:=Section;\r\n    end;\r\n  // Get Started\r\n  I:=1;\r\n  Current:=0;\r\n  Q:=' ';\r\n  InLiteral:=False;\r\n  if (FV.Negative) and (S=1) then\r\n    ToResult('-');\r\n  while (I<=SectionLength) do\r\n    begin\r\n    C:=Section[i];\r\n    // Writeln('Analyzing pos ',I,': \"',C,'\"');\r\n    If (C in ['\"', '''']) then\r\n      begin\r\n      if InLiteral then\r\n        InLiteral:=C<>Q\r\n      else\r\n        begin\r\n        inLiteral:=True;\r\n        Q:=C;\r\n        end;\r\n      end\r\n    else if InLiteral then\r\n      ToResult(C)\r\n    else\r\n      case C of\r\n      '0', '#':\r\n        CopyDigit;\r\n      '.', ',':\r\n        ; // Do nothing, handled by CopyDigit\r\n      'e', 'E':\r\n        begin\r\n        ToResult(C); // Always needed\r\n        Inc(I);\r\n        if I<=Length(Section) then\r\n          begin\r\n          C:=Section[I];\r\n          if (C in ['+','-']) then\r\n            begin\r\n            AddToResult(FormatExponent(C,FV.Exponent-DecimalPos+1));\r\n            // Skip rest\r\n            while (I<SectionLength) and (Section[i+1]='0') do\r\n              Inc(I);\r\n            end;\r\n          end;\r\n        end;\r\n      else\r\n        ToResult(C);\r\n      end;\r\n    Inc(i);\r\n    end;\r\nend;\r\n\r\nfunction StrToBool(const S: String): Boolean;\r\nbegin\r\n  if not(TryStrToBool(S,Result)) then\r\n    raise EConvertError.CreateFmt(SInvalidBoolean,[S]);\r\nend;\r\n\r\nprocedure CheckBoolStrs;\r\nbegin\r\n  if Length(TrueBoolStrs)=0 then\r\n  begin\r\n    SetLength(TrueBoolStrs,1);\r\n    TrueBoolStrs[0]:='True';\r\n  end;\r\n  if Length(FalseBoolStrs)=0 then\r\n  begin\r\n    SetLength(FalseBoolStrs,1);\r\n    FalseBoolStrs[0]:='False';\r\n  end;\r\nend;\r\n\r\nfunction BoolToStr(B: Boolean; UseBoolStrs: Boolean): string;\r\nbegin\r\n  if UseBoolStrs Then\r\n  begin\r\n    CheckBoolStrs;\r\n    if B then\r\n      Result:=TrueBoolStrs[0]\r\n    else\r\n      Result:=FalseBoolStrs[0];\r\n  end else\r\n    if B then\r\n      Result:='-1'\r\n    else\r\n      Result:='0';\r\nend;\r\n\r\nfunction BoolToStr(B: Boolean; const TrueS, FalseS: String): string;\r\nbegin\r\n  if B then Result:=TrueS else Result:=FalseS;\r\nend;\r\n\r\nfunction StrToBoolDef(const S: String; Default: Boolean): Boolean;\r\nbegin\r\n  if not TryStrToBool(S,Result) then\r\n    Result:=Default;\r\nend;\r\n\r\nfunction TryStrToBool(const S: String; out Value: Boolean): Boolean;\r\nVar\r\n  Temp : String;\r\n  I    : Longint;\r\n  D : Double;\r\n  Code: integer;\r\nbegin\r\n  Temp:=uppercase(S);\r\n  Val(Temp,D,code);\r\n  Result:=true;\r\n  If Code=0 then\r\n    Value:=(D<>0.0)\r\n  else\r\n    begin\r\n      CheckBoolStrs;\r\n      for I:=low(TrueBoolStrs) to High(TrueBoolStrs) do\r\n        if Temp=uppercase(TrueBoolStrs[I]) then\r\n          begin\r\n            Value:=true;\r\n            exit;\r\n          end;\r\n      for I:=low(FalseBoolStrs) to High(FalseBoolStrs) do\r\n        if Temp=uppercase(FalseBoolStrs[I]) then\r\n          begin\r\n            Value:=false;\r\n            exit;\r\n          end;\r\n      Result:=false;\r\n    end;\r\nend;\r\n\r\nfunction UpperCase(const s: String): String; assembler;\r\nasm\r\n  return s.toUpperCase();\r\nend;\r\n\r\nfunction LowerCase(const s: String): String; assembler;\r\nasm\r\n  return s.toLowerCase();\r\nend;\r\n\r\nfunction CompareStr(const s1, s2: String): Integer; assembler;\r\nasm\r\n  var l1 = s1.length;\r\n  var l2 = s2.length;\r\n  if (l1<=l2){\r\n    var s = s2.substr(0,l1);\r\n    if (s1<s){ return -1;\r\n    } else if (s1>s){ return 1;\r\n    } else { return l1<l2 ? -1 : 0; };\r\n  } else {\r\n    var s = s1.substr(0,l2);\r\n    if (s<s2){ return -1;\r\n    } else { return 1; };\r\n  };\r\nend;\r\n\r\nfunction SameStr(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1 == s2;\r\nend;\r\n\r\nfunction CompareText(const s1, s2: String): Integer; assembler;\r\nasm\r\n  var l1 = s1.toLowerCase();\r\n  var l2 = s2.toLowerCase();\r\n  if (l1>l2){ return 1;\r\n  } else if (l1<l2){ return -1;\r\n  } else { return 0; }\r\nend;\r\n\r\nfunction SameText(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1.toLowerCase() == s2.toLowerCase();\r\nend;\r\n\r\nfunction AnsiCompareText(const s1, s2: String): Integer; assembler;\r\nasm\r\n  return s1.localeCompare(s2);\r\nend;\r\n\r\nfunction AnsiSameText(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1.toLowerCase() == s2.toLowerCase();\r\nend;\r\n\r\nfunction AnsiCompareStr(const s1, s2: String): Integer;\r\nbegin\r\n  {$IFDEF ECMAScript6}\r\n  Result:=CompareText(TJSString(s1).normalize(),TJSString(s2).normalize());\r\n  {$ELSE}\r\n  Result:=CompareText(s1,s2);\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure AppendStr(var Dest: String; const S: string);\r\n\r\nbegin\r\n  Dest:=Dest+S;\r\nend;\r\n\r\n\r\nConst\r\n  feInvalidFormat   = 1;\r\n  feMissingArgument = 2;\r\n  feInvalidArgIndex = 3;\r\n\r\nProcedure DoFormatError (ErrCode : Longint;const fmt: String);\r\nbegin\r\n  //!! must be changed to contain format string...\r\n  Case ErrCode of\r\n   feInvalidFormat : raise EConvertError.Createfmt(SInvalidFormat,[Fmt]);\r\n   feMissingArgument : raise EConvertError.Createfmt(SArgumentMissing,[Fmt]);\r\n   feInvalidArgIndex : raise EConvertError.Createfmt(SInvalidArgIndex,[Fmt]);\r\n  end;\r\nend;\r\n\r\nConst\r\n  maxdigits = 15;\r\nFunction SwapEndian(W : Word) : Word;\r\n\r\nbegin\r\n  Result:=((W and $FF) shl 8) or ((W shr 8) and $FF)\r\nend;\r\n\r\nFunction SwapEndian(C : Cardinal) : Cardinal;\r\n\r\nbegin\r\n  Result:=((C and $FF) shl 24)\r\n           or ((C and $FF00) shl 8)\r\n           or ((C shr 8) and $FF00)\r\n           or ((C shr 24) and $FF);\r\nend;\r\n\r\nFunction ReplaceDecimalSep(S: String; Const DS : string) : string;\r\n\r\nVar\r\n  P : Integer;\r\n\r\nbegin\r\n  P:=Pos('.',S);\r\n  if P>0 then\r\n    Result:=Copy(S,1,P-1)+DS+Copy(S,P+1,Length(S)-P)\r\n  else\r\n    Result:=S;\r\nend;\r\n\r\nfunction FormatGeneralFloat(Value : double; Precision : Integer; DS : String) : string;\r\n\r\nVar\r\n  P, PE, Q, Exponent: Integer;\r\n\r\nBegin\r\n  If (Precision = -1) Or (Precision > maxdigits) Then\r\n     Precision := maxdigits;\r\n  { First convert to scientific format, with correct precision }\r\n  Str(Value:precision+7, Result);\r\n  { Delete leading spaces }\r\n  Result:=TrimLeft(Result);\r\n  P:=Pos('.',Result);\r\n  if P=0 then\r\n    exit;\r\n   { Consider removing exponent }\r\n  PE:=Pos('E',Result);\r\n  if PE=0 then\r\n    begin\r\n    Result:=ReplaceDecimalSep(Result,DS);\r\n    exit;\r\n    end;\r\n  { Read exponent }\r\n  Q:=PE+2;\r\n  Exponent := 0;\r\n  while (Q <= Length(Result)) do\r\n    begin\r\n    Exponent := Exponent*10 + Ord(Result[Q])-Ord('0');\r\n    Inc(Q);\r\n    end;\r\n  if Result[PE+1] = '-' then\r\n    Exponent := -Exponent;\r\n  if (P+Exponent < PE) and (Exponent > -6) then\r\n    begin\r\n    { OK to remove exponent }\r\n    SetLength(Result,PE-1); { Trim exponent }\r\n    if Exponent >= 0 then\r\n      begin\r\n        { Shift point to right }\r\n      for Q := 0 to Exponent-1 do\r\n        begin\r\n        Result[P] := Result[P+1];\r\n        Inc(P);\r\n        end;\r\n      Result[P] := '.';\r\n      P := 1;\r\n      if Result[P] = '-' then\r\n        Inc(P);\r\n      while (Result[P] = '0') and (P < Length(Result)) and (Copy(Result,P+1,Length(DS))<>DS) do\r\n          { Trim leading zeros; conversion above should not give any, but occasionally does\r\n            because of rounding }\r\n          System.Delete(Result,P,1);\r\n      end\r\n    else\r\n      begin\r\n      { Add zeros at start }\r\n      Insert(Copy('00000',1,-Exponent),Result,P-1);\r\n      Result[P-Exponent] := Result[P-Exponent-1]; { Copy leading digit }\r\n      Result[P] := '.';\r\n      if Exponent <> -1 then\r\n        Result[P-Exponent-1] := '0';\r\n      end;\r\n    { Remove trailing zeros }\r\n    Q := Length(Result);\r\n    while (Q > 0) and (Result[Q] = '0') do\r\n      Dec(Q);\r\n    if Result[Q] = '.' then\r\n      Dec(Q); { Remove trailing decimal point }\r\n    if (Q = 0) or ((Q=1) and (Result[1] = '-')) then\r\n      Result := '0'\r\n    else\r\n      SetLength(Result,Q);\r\n    end\r\n  else\r\n    begin\r\n    { Need exponent, but remove superfluous characters }\r\n    { Delete trailing zeros }\r\n    while Result[PE-1] = '0' do\r\n      begin\r\n      System.Delete(Result,PE-1,1);\r\n      Dec(PE);\r\n      end;\r\n    { If number ends in decimal point, remove it }\r\n    if Result[PE-1] = DS then\r\n      begin\r\n      System.Delete(Result,PE-1,1);\r\n      Dec(PE);\r\n      end;\r\n    { delete superfluous + in exponent }\r\n    if Result[PE+1]='+' then\r\n      System.Delete(Result,PE+1,1)\r\n    else\r\n      Inc(PE);\r\n    while Result[PE+1] = '0' do\r\n      { Delete leading zeros in exponent }\r\n      System.Delete(Result,PE+1,1)\r\n    end;\r\n  Result:=ReplaceDecimalSep(Result,DS)\r\nend;\r\n\r\n\r\nfunction FormatExponentFloat(Value : double; Precision,Digits : Integer;DS : String) : string;\r\n\r\nVar\r\n  P: Integer;\r\nBegin\r\n  DS:=FormatSettings.DecimalSeparator;\r\n  If (Precision = -1) Or (Precision > maxdigits) Then\r\n    Precision := maxdigits;\r\n  Str(Value:Precision+7, Result);\r\n  { Delete leading spaces }\r\n  while Result[1] = ' ' do\r\n    System.Delete(Result, 1, 1);\r\n  P:=Pos('E',Result);\r\n  if P=0 then\r\n    begin\r\n    Result:=ReplaceDecimalSep(Result,DS);\r\n    exit;\r\n    end;\r\n  Inc(P, 2);\r\n  if Digits > 4 then\r\n    Digits:=4;\r\n  Digits:=Length(Result) - P - Digits + 1;\r\n  if Digits < 0 then\r\n    insert(copy('0000',1,-Digits),Result,P)\r\n  else\r\n    while (Digits > 0) and (Result[P] = '0') do\r\n      begin\r\n      System.Delete(Result, P, 1);\r\n      if P > Length(Result) then\r\n        begin\r\n        System.Delete(Result, P - 2, 2);\r\n        break;\r\n        end;\r\n      Dec(Digits);\r\n      end;\r\n  Result:=ReplaceDecimalSep(Result,DS);\r\nEnd;\r\n\r\nfunction FormatFixedFloat(Value : double; Digits : Integer; DS : String) : string;\r\n\r\nBegin\r\n  If Digits = -1 Then\r\n    Digits := 2\r\n  Else If Digits > 18 Then\r\n    Digits := 18;\r\n  Str(Value:0:Digits, Result);\r\n  if (Result<>'') and (Result[1]=' ') then\r\n    Delete(Result,1,1);\r\n  Result:=ReplaceDecimalSep(Result,DS);\r\nend;\r\n\r\n\r\nfunction FormatNumberFloat(Value : double; Digits : Integer; DS,TS : String) : string;\r\n\r\nVar\r\n  P : integer;\r\n\r\nBegin\r\n  If Digits = -1 Then\r\n    Digits := 2\r\n  else If Digits > maxdigits Then\r\n    Digits := maxdigits;\r\n  Str(Value:0:Digits, Result);\r\n  if (Result<>'') and (Result[1]=' ') then\r\n    Delete(Result,1,1);\r\n  P:=Pos('.',Result);\r\n  if (P<=0) then\r\n    P:=Length(Result)+1;\r\n  Result:=ReplaceDecimalSep(Result,DS);\r\n  Dec(P,3);\r\n  if (TS<>'') and (TS<>#0) then\r\n    While (P>1) Do\r\n      Begin\r\n      If (Result[P-1] <> '-')  Then\r\n        Insert(TS, Result, P);\r\n      Dec(P, 3);\r\n      End;\r\nEnd;\r\n\r\nfunction RemoveLeadingNegativeSign(var AValue: String; DS : String; aThousandSeparator : String): Boolean;\r\n\r\n// removes negative sign in case when result is zero eg. -0.00\r\n\r\nvar\r\n  i: PtrInt;\r\n  TS: String;\r\n  StartPos: PtrInt;\r\n\r\nbegin\r\n  Result:=False;\r\n  StartPos := 2;\r\n  TS := aThousandSeparator;\r\n  for i :=StartPos to length(AValue) do\r\n    begin\r\n    Result := (AValue[i] in ['0', DS, 'E', '+']) or (aValue[i]=TS);\r\n    if not Result then\r\n      break;\r\n    end;\r\n  if (Result) and (AValue[1]='-') then\r\n    Delete(AValue, 1, 1);\r\nend;\r\n\r\nFunction FormatNumberCurrency(const Value : Currency; Digits : Integer; const aSettings: TFormatSettings) : string;\r\n\r\nVar\r\n  Negative: Boolean;\r\n  P : Integer;\r\n  CS,DS,TS : String;\r\n\r\nBegin\r\n   DS:=aSettings.DecimalSeparator;\r\n   TS:=aSettings.ThousandSeparator;\r\n   CS:=aSettings.CurrencyString;\r\n  //  Writeln('Value ',D);\r\n   If Digits = -1 Then\r\n     Digits := aSettings.CurrencyDecimals\r\n   Else If Digits > 18 Then\r\n     Digits := 18;\r\n   Str(Value:0:Digits, Result);\r\n   // Writeln('1. Result ',Result,' currencystring : ',CS);\r\n   Negative:=Result[1] = '-';\r\n   if Negative then\r\n     System.Delete(Result, 1, 1);\r\n   P := Pos('.', Result);\r\n   // Writeln('2. Result ',Result,' currencystring : ',CurrencyString);\r\n   If TS<>'' Then\r\n     begin\r\n     If P <> 0 Then\r\n       Result:=ReplaceDecimalSep(Result,DS)\r\n     else\r\n       P := Length(Result)+1;\r\n     Dec(P, 3);\r\n     While (P > 1) Do\r\n     Begin\r\n         Insert(TS, Result, P);\r\n     Dec(P, 3);\r\n     End;\r\n     end;\r\n   // Writeln('3. Result ',Result,' currencystring : ',CS);\r\n   if Negative then\r\n     RemoveLeadingNegativeSign(Result,DS,TS);\r\n   // Writeln('4. Result ',Result,' currencystring : ',CurrencyString);\r\n   // Writeln('CurrencyFormat:  ',CurrencyFormat,'NegcurrencyFormat: ',NegCurrFormat);\r\n   If Not Negative Then\r\n     Case aSettings.CurrencyFormat Of\r\n       0: Result := CS + Result;\r\n       1: Result := Result + CS;\r\n       2: Result := CS + ' ' + Result;\r\n       3: Result := Result + ' ' + CS;\r\n     end\r\n   else\r\n     Case aSettings.NegCurrFormat Of\r\n       0: Result := '(' + CS + Result + ')';\r\n       1: Result := '-' + CS + Result;\r\n       2: Result := CS + '-' + Result;\r\n       3: Result := CS + Result + '-';\r\n       4: Result := '(' + Result + CS + ')';\r\n       5: Result := '-' + Result + CS;\r\n       6: Result := Result + '-' + CS;\r\n       7: Result := Result + CS + '-';\r\n       8: Result := '-' + Result + ' ' + CS;\r\n       9: Result := '-' + CS + ' ' + Result;\r\n       10: Result := Result + ' ' + CS + '-';\r\n       11: Result := CS + ' ' + Result + '-';\r\n       12: Result := CS + ' ' + '-' + Result;\r\n       13: Result := Result + '-' + ' ' + CS;\r\n       14: Result := '(' + CS + ' ' + Result + ')';\r\n       15: Result := '(' + Result + ' ' + CS + ')';\r\n     end;\r\nend;\r\n\r\n\r\nfunction FloatToStrF(const Value: double; format: TFloatFormat; Precision,\r\n  Digits: Integer): String;\r\nbegin\r\n  Result:=FloatToStrF(Value,Format,Precision,Digits,Formatsettings);\r\nend;\r\n\r\nfunction FloatToStrF(const Value: double; format: TFloatFormat; Precision,\r\n  Digits: Integer ;const aSettings : TFormatSettings): String;\r\n\r\nVar\r\n  TS,DS: string;\r\n\r\nBegin\r\n  DS:=aSettings.DecimalSeparator;\r\n  TS:=aSettings.ThousandSeparator;\r\n  Case format Of\r\n    ffGeneral:\r\n      Result:=FormatGeneralFloat(Value,Precision,DS);\r\n    ffExponent:\r\n      Result:=FormatExponentFloat(Value,Precision,Digits,DS);\r\n    ffFixed:\r\n      Result:=FormatFixedFloat(Value,Digits,DS);\r\n    ffNumber:\r\n      Result:=FormatNumberFloat(Value,Digits,DS,TS);\r\n    ffCurrency:\r\n     Result:=FormatNumberCurrency(Value,Digits,aSettings);\r\n  end;\r\n  if (Format<>ffCurrency) and (length(Result)>1) and (Result[1]='-') then\r\n    RemoveLeadingNegativeSign(Result,DS,TS);\r\nend;\r\n\r\nfunction Format(const Fmt: String; const Args: array of const): String;\r\n\r\nbegin\r\n  Result:=Format(Fmt,Args,FormatSettings)\r\nend;\r\n\r\nfunction Format(const Fmt: String; const Args: array of Const; const aSettings : TFormatSettings): String;\r\n\r\nVar ChPos,OldPos,ArgPos,DoArg,Len : SizeInt;\r\n    Hs,ToAdd : String;\r\n    Index : Byte;\r\n    Width,Prec : Longint;\r\n    Left : Boolean;\r\n    Fchar : char;\r\n    vq : nativeint;\r\n\r\n  {\r\n    ReadFormat reads the format string. It returns the type character in\r\n    uppercase, and sets index, Width, Prec to their correct values,\r\n    or -1 if not set. It sets Left to true if left alignment was requested.\r\n    In case of an error, DoFormatError is called.\r\n  }\r\n\r\n  Function ReadFormat : Char;\r\n\r\n  Var Value : NativeInt;\r\n\r\n    Procedure ReadInteger;\r\n\r\n    var\r\n      Code: integer;\r\n      ArgN: SizeInt;\r\n    begin\r\n      If Value<>-1 then exit; // Was already read.\r\n      OldPos:=ChPos;\r\n      While (ChPos<=Len) and\r\n            (Fmt[ChPos]<='9') and (Fmt[ChPos]>='0') do inc(ChPos);\r\n      If ChPos>len then\r\n        DoFormatError(feInvalidFormat,Fmt);\r\n      If Fmt[ChPos]='*' then\r\n        begin\r\n\r\n        if Index=High(byte) then\r\n          ArgN:=Argpos\r\n        else\r\n        begin\r\n          ArgN:=Index;\r\n          Inc(Index);\r\n        end;\r\n\r\n        If (ChPos>OldPos) or (ArgN>High(Args)) then\r\n          DoFormatError(feInvalidFormat,Fmt);\r\n\r\n        ArgPos:=ArgN+1;\r\n\r\n        case Args[ArgN].Vtype of\r\n           vtInteger: Value := Args[ArgN].VInteger;\r\n           vtNativeInt: Value := Args[ArgN].VNativeInt;\r\n        else\r\n          DoFormatError(feInvalidFormat,Fmt);\r\n        end;\r\n        Inc(ChPos);\r\n        end\r\n      else\r\n        begin\r\n        If (OldPos<ChPos) Then\r\n          begin\r\n          Val (Copy(Fmt,OldPos,ChPos-OldPos),value,code);\r\n          // This should never happen !!\r\n          If Code>0 then DoFormatError (feInvalidFormat,Fmt);\r\n          end\r\n        else\r\n          Value:=-1;\r\n        end;\r\n    end;\r\n\r\n    Procedure ReadIndex;\r\n\r\n    begin\r\n      If Fmt[ChPos]<>':' then\r\n        ReadInteger\r\n      else\r\n        value:=0; // Delphi undocumented behaviour, assume 0, #11099\r\n      If Fmt[ChPos]=':' then\r\n        begin\r\n        If Value=-1 then DoFormatError(feMissingArgument,Fmt);\r\n        Index:=Value;\r\n        Value:=-1;\r\n        Inc(ChPos);\r\n        end;\r\n    end;\r\n\r\n    Procedure ReadLeft;\r\n\r\n    begin\r\n      If Fmt[ChPos]='-' then\r\n        begin\r\n        left:=True;\r\n        Inc(ChPos);\r\n        end\r\n      else\r\n        Left:=False;\r\n    end;\r\n\r\n    Procedure ReadWidth;\r\n\r\n    begin\r\n      ReadInteger;\r\n      If Value<>-1 then\r\n        begin\r\n        Width:=Value;\r\n        Value:=-1;\r\n        end;\r\n    end;\r\n\r\n    Procedure ReadPrec;\r\n\r\n    begin\r\n      If Fmt[ChPos]='.' then\r\n        begin\r\n        inc(ChPos);\r\n          ReadInteger;\r\n        If Value=-1 then\r\n         Value:=0;\r\n        prec:=Value;\r\n        end;\r\n    end;\r\n\r\n\r\n  begin\r\n    Index:=High(byte);\r\n    Width:=-1;\r\n    Prec:=-1;\r\n    Value:=-1;\r\n    inc(ChPos);\r\n    If Fmt[ChPos]='%' then\r\n      begin\r\n      Result:='%';\r\n      exit;                           // VP fix\r\n      end;\r\n    ReadIndex;\r\n    ReadLeft;\r\n    ReadWidth;\r\n    ReadPrec;\r\n    Result:=Upcase(Fmt[ChPos]);\r\n  end;\r\n\r\n\r\n  function Checkarg (AT : Integer; err:boolean):boolean;\r\n  {\r\n    Check if argument INDEX is of correct type (AT)\r\n    If Index=-1, ArgPos is used, and argpos is augmented with 1\r\n    DoArg is set to the argument that must be used.\r\n  }\r\n  begin\r\n    result:=false;\r\n    if Index=High(Byte) then\r\n      DoArg:=Argpos\r\n    else\r\n      DoArg:=Index;\r\n    ArgPos:=DoArg+1;\r\n    If (Doarg>High(Args)) or (Args[Doarg].VType<>AT) then\r\n     begin\r\n       if err then\r\n        DoFormatError(feInvalidArgindex,Fmt);\r\n       dec(ArgPos);\r\n       exit;\r\n     end;\r\n    result:=true;\r\n  end;\r\n\r\nbegin\r\n  Result:='';\r\n  Len:=Length(Fmt);\r\n  ChPos:=1;\r\n  OldPos:=1;\r\n  ArgPos:=0;\r\n  While ChPos<=len do\r\n    begin\r\n    While (ChPos<=Len) and (Fmt[ChPos]<>'%') do\r\n      inc(ChPos);\r\n    If ChPos>OldPos Then\r\n      Result:=Result+Copy(Fmt,OldPos,ChPos-Oldpos);\r\n    If ChPos<Len then\r\n      begin\r\n      FChar:=ReadFormat;\r\n{$ifdef fmtdebug}\r\n      DumpFormat(FCHar);\r\n{$endif}\r\n      Case FChar of\r\n        'D' : begin\r\n              if Checkarg(vtinteger,false) then\r\n                toAdd:=IntToStr(Args[DoArg].VInteger)\r\n              else if CheckArg(vtNativeInt,True) then\r\n                toAdd:=IntToStr(Args[DoArg].VNativeInt);\r\n              Width:=Abs(width);\r\n              Index:=Prec-Length(ToAdd);\r\n              If ToAdd[1]<>'-' then\r\n                ToAdd:=StringOfChar('0',Index)+ToAdd\r\n              else\r\n                // + 1 to accomodate for - sign in length !!\r\n                Insert(StringOfChar('0',Index+1),toadd,2);\r\n              end;\r\n        'U' : begin\r\n              if Checkarg(vtinteger,false) then\r\n                toAdd:=IntToStr(Cardinal(Args[DoArg].VInteger))\r\n              else if CheckArg(vtNativeInt,True) then\r\n                toAdd:=IntToStr(NativeUInt(Args[DoArg].VNativeInt));\r\n              Width:=Abs(width);\r\n              Index:=Prec-Length(ToAdd);\r\n              ToAdd:=StringOfChar('0',Index)+ToAdd\r\n              end;\r\n        'E' : begin\r\n              if CheckArg(vtCurrency,false) then\r\n                ToAdd:=FloatToStrF(Args[doarg].VCurrency,ffExponent,3,Prec,aSettings)\r\n              else if CheckArg(vtExtended,True) then\r\n                ToAdd:=FloatToStrF(Args[doarg].VExtended,ffExponent,3,Prec,aSettings);\r\n              end;\r\n        'F' : begin\r\n              if CheckArg(vtCurrency,false) then\r\n                ToAdd:=FloatToStrF(Args[doarg].VCurrency,ffFixed,9999,Prec,aSettings)\r\n              else if CheckArg(vtInteger,false) then\r\n                ToAdd:=FloatToStrF(Args[doarg].VExtended,ffFixed,9999,Prec,aSettings)\r\n              else if CheckArg(vtExtended,True) then\r\n                ToAdd:=FloatToStrF(Args[doarg].VExtended,ffFixed,9999,Prec,aSettings);\r\n              end;\r\n        'G' : begin\r\n              if CheckArg(vtCurrency,false) then\r\n                ToAdd:=FloatToStrF(Args[doarg].VCurrency,ffGeneral,Prec,3,aSettings)\r\n              else if CheckArg(vtExtended,True) then\r\n                ToAdd:=FloatToStrF(Args[doarg].VExtended,ffGeneral,Prec,3,aSettings);\r\n              end;\r\n        'N' : begin\r\n              if CheckArg(vtCurrency,false) then\r\n                ToAdd:=FloatToStrF(Args[doarg].VCurrency,ffNumber,9999,Prec,aSettings)\r\n              else if CheckArg(vtExtended,True) then\r\n                ToAdd:=FloatToStrF(Args[doarg].VExtended,ffNumber,9999,Prec,aSettings);\r\n              end;\r\n        'M' : begin\r\n              if CheckArg(vtCurrency,false) then\r\n                ToAdd:=FloatToStrF(Args[doarg].VCurrency,ffCurrency,9999,Prec,aSettings)\r\n              else if CheckArg(vtExtended,True) then\r\n                ToAdd:=FloatToStrF(Args[doarg].VExtended,ffCurrency,9999,Prec,aSettings);\r\n              end;\r\n        'S' : begin\r\n              if CheckArg(vtUnicodeString,false) then\r\n                hs:=Args[doarg].VUnicodeString\r\n              else if CheckArg(vtWideChar,True) then\r\n                hs:=Args[doarg].VWideChar;\r\n              Index:=Length(hs);\r\n              If (Prec<>-1) and (Index>Prec) then\r\n                Index:=Prec;\r\n              ToAdd:=Copy(hs,1,Index);\r\n              end;\r\n        'P' : Begin\r\n              if CheckArg(vtInteger,false) then\r\n                ToAdd:=IntToHex(Args[DoArg].VInteger,8)\r\n              else if CheckArg(vtInteger,true) then\r\n                ToAdd:=IntToHex(Args[DoArg].VNativeInt,16);\r\n              end;\r\n        'X' : begin\r\n              if Checkarg(vtinteger,false) then\r\n                begin\r\n                vq:=Args[Doarg].VInteger;\r\n                Index:=16;\r\n                end\r\n              else if Checkarg(vtNativeint,True) then\r\n                begin\r\n                vq:=Args[Doarg].VNativeInt;\r\n                index:=31; // May need to adjust to NativeInt\r\n                end;\r\n              If Prec>index then\r\n                ToAdd:=IntToHex(vq,index)\r\n              else\r\n                begin\r\n                // determine minimum needed number of hex digits.\r\n                Index:=1;\r\n                While (NativeInt(1) shl (Index*4)<=vq) and (index<16) do\r\n                  inc(Index);\r\n                If Index>Prec then\r\n                  Prec:=Index;\r\n                ToAdd:=IntToHex(vq,Prec);\r\n                end;\r\n              end;\r\n        '%': ToAdd:='%';\r\n      end;\r\n      If Width<>-1 then\r\n        If Length(ToAdd)<Width then\r\n          If not Left then\r\n            ToAdd:=StringOfChar(' ',Width-Length(ToAdd))+ToAdd\r\n          else\r\n            ToAdd:=ToAdd+StringOfChar(' ',Width-Length(ToAdd));\r\n      Result:=Result+ToAdd;\r\n      end;\r\n    inc(ChPos);\r\n    Oldpos:=ChPos;\r\n    end;\r\nend;\r\n\r\nfunction BytesOf(const AVal: string): TBytes;\r\nvar\r\n  I: SizeUInt;\r\nbegin\r\n  SetLength(Result, Length(AVal));\r\n  for I := 0 to Length(AVal)-1 do\r\n    Result[I] := Ord(AVal[I+1]);\r\nend;\r\n\r\nfunction StringOf(const ABytes: TBytes): string;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result:='';\r\n  for I := 0 to Length(ABytes)-1 do\r\n    Result:=Result+Char(ABytes[I]);\r\nend;\r\n\r\nfunction LocaleCompare(const s1, s2, locales: String): Boolean; assembler;\r\nasm\r\n  return s1.localeCompare(s2,locales) == 0;\r\nend;\r\n\r\nfunction NormalizeStr(const S: String; const Norm: String): String; assembler;\r\nasm\r\n  return S.normalize(Norm);\r\nend;\r\n\r\nfunction IsValidIdent(const Ident: string; AllowDots: Boolean = False; StrictDots: Boolean = False): Boolean;\r\nconst\r\n  Alpha = ['A'..'Z', 'a'..'z', '_'];\r\n  AlphaNum = Alpha + ['0'..'9'];\r\n  Dot = '.';\r\nvar\r\n  First: Boolean;\r\n  I, Len: Integer;\r\nbegin\r\n  Len := Length(Ident);\r\n  if Len < 1 then\r\n    Exit(False);\r\n  First := True;\r\n  Result:=false;\r\n  I:=1;\r\n  While I<=len do\r\n    begin\r\n    if First then\r\n    begin\r\n      if not (Ident[I] in Alpha) then exit;\r\n      First := False;\r\n    end\r\n    else if AllowDots and (Ident[I] = Dot) then\r\n    begin\r\n      if StrictDots then\r\n      begin\r\n        if I >= Len then exit;\r\n        First := True;\r\n      end;\r\n    end\r\n    else\r\n      if not (Ident[I] in AlphaNum) then exit;\r\n    I:=I+1;\r\n    end;\r\n  Result:=true;\r\nend;\r\n\r\nprocedure FreeAndNil(var Obj);\r\nvar\r\n  o: TObject;\r\nbegin\r\n  o:=TObject(Obj);\r\n  if o=nil then exit;\r\n  TObject(Obj):=nil;\r\n  o.Destroy;\r\nend;\r\n\r\n{ EVariantError }\r\n\r\nconstructor EVariantError.CreateCode(Code: Longint);\r\nbegin\r\n  ErrCode:=Code;\r\nend;\r\n\r\n{ Exception }\r\n\r\nconstructor Exception.Create(const Msg: String);\r\nbegin\r\n  fMessage:=Msg;\r\n  {$ifdef nodejs}\r\n  FNodeJSError:=TJSError.new;\r\n  {$endif}\r\n  if LogMessageOnCreate then\r\n    Writeln('Created exception ',ClassName,' with message: ',Msg);\r\nend;\r\n\r\nconstructor Exception.CreateFmt(const Msg: string; const Args: array of Const\r\n  );\r\nbegin\r\n  //writeln('Exception.CreateFmt START ',ClassName,' \"',Msg,'\" Args=',Args);\r\n  Create(Format(Msg,Args));\r\n  //writeln('Exception.CreateFmt END ',ClassName,' \"',Msg,'\" fMessage=',fMessage);\r\nend;\r\n\r\nconstructor Exception.CreateHelp(const Msg: String; AHelpContext: Integer);\r\nbegin\r\n  Create(Msg);\r\n  fHelpContext:=AHelpContext;\r\nend;\r\n\r\nconstructor Exception.CreateFmtHelp(const Msg: string;\r\n  const Args: array of Const; AHelpContext: Integer);\r\nbegin\r\n  Create(Format(Msg,Args));\r\n  fHelpContext:=AHelpContext;\r\nend;\r\n\r\nfunction Exception.ToString: String;\r\nbegin\r\n  Result:=ClassName+': '+Message;\r\nend;\r\n\r\nConst\r\n  RESpecials = '([\\$\\+\\[\\]\\(\\)\\\\\\.\\*\\^\\?\\|])';\r\n\r\nfunction StringReplace(aOriginal, aSearch, aReplace: string;\r\n  Flags: TStringReplaceFlags): String;\r\n\r\nVar\r\n  REFlags : String;\r\n  REString : String;\r\n\r\nbegin\r\n  REFlags:='';\r\n  if rfReplaceAll in flags then\r\n    ReFlags:='g';\r\n  if rfIgnoreCase in flags then\r\n    ReFlags:=ReFlags+'i';\r\n  REString:=TJSString(aSearch).replace(TJSRegexp.new(RESpecials,'g'),'\\$1');\r\n  Result:=TJSString(aOriginal).replace(TJSRegexp.new(REString,REFlags),aReplace);\r\nend;\r\n\r\nfunction QuoteString(aOriginal: String; AQuote: Char): String;\r\n\r\nbegin\r\n  Result:=AQuote+StringReplace(aOriginal,aQuote,aQuote+aQuote,[rfReplaceAll])+AQuote;\r\nend;\r\n\r\nfunction QuotedStr(const s: string; QuoteChar : Char = ''''): string;\r\n\r\nbegin\r\n  Result:=QuoteString(S,QuoteChar);\r\nend;\r\n\r\nfunction DeQuoteString(aQuoted: String; AQuote: Char): String;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  Result:=aQuoted;\r\n  if TJSString(Result).substr(0,1)<>AQuote then exit;\r\n  Result:=TJSString(Result).slice(1);\r\n  i:=1;\r\n  while i<=length(Result) do\r\n    begin\r\n    if Result[i]=AQuote then\r\n      begin\r\n      if (i=length(Result)) or (Result[i+1]<>AQuote) then\r\n        begin\r\n        Result:=TJSString(Result).slice(0,i-1);\r\n        exit;\r\n        end\r\n      else\r\n        Result:=TJSString(Result).slice(0,i-1)+TJSString(Result).slice(i);\r\n      end\r\n    else\r\n      inc(i);\r\n    end;\r\nend;\r\n\r\nfunction IsDelimiter(const Delimiters, S: string; Index: Integer): Boolean;\r\nbegin\r\n  Result:=False;\r\n  if (Index>0) and (Index<=Length(S)) then\r\n    Result:=Pos(S[Index],Delimiters)<>0; // Note we don't do MBCS yet\r\nend;\r\n\r\nFunction LastDelimiter(const Delimiters, S: string): SizeInt;\r\n\r\nbegin\r\n  Result:=Length(S);\r\n  While (Result>0) and (Pos(S[Result],Delimiters)=0) do\r\n    Dec(Result);\r\nend;\r\n\r\n\r\nfunction AdjustLineBreaks(const S: string): string;\r\n\r\nbegin\r\n  Result:=AdjustLineBreaks(S,DefaultTextLineBreakStyle);\r\nend;\r\n\r\nfunction AdjustLineBreaks(const S: string; Style: TTextLineBreakStyle): string;\r\n\r\nvar\r\n  I,L: Longint;\r\n  Res : String;\r\n\r\n  Procedure Add(C  : Char);\r\n  begin\r\n    Res:=Res+C;\r\n  end;\r\n\r\nbegin\r\n  I:=0;\r\n  L:=Length(S);\r\n  Result:='';\r\n  While (I<=L) do\r\n    case S[I] of\r\n      #10: begin\r\n          if Style in [tlbsCRLF,tlbsCR] then\r\n            Add(#13);\r\n          if Style=tlbsCRLF then\r\n            Add(#10);\r\n          Inc(I);\r\n          end;\r\n     #13: begin\r\n          if Style=tlbsCRLF then\r\n            Add(#13);\r\n          Add(#10);\r\n          Inc(I);\r\n          if S[I]=#10 then\r\n            Inc(I);\r\n          end;\r\n    else\r\n      Add(S[i]);\r\n      Inc(I);\r\n    end;\r\n  Result:=Res;\r\nend;\r\n\r\nfunction WrapText(const Line, BreakStr: string;\r\n  const BreakChars: array of char; MaxCol: Integer): string;\r\n\r\nconst\r\n  Quotes = ['''', '\"'];\r\n\r\nVar\r\n  L : String;\r\n  C,LQ,BC : Char;\r\n  P,BLen,Len : Integer;\r\n  HB,IBC : Boolean;\r\n\r\nbegin\r\n  Result:='';\r\n  L:=Line;\r\n  Blen:=Length(BreakStr);\r\n  If (BLen>0) then\r\n    BC:=BreakStr[1]\r\n  else\r\n    BC:=#0;\r\n  Len:=Length(L);\r\n  While (Len>0) do\r\n    begin\r\n    P:=1;\r\n    LQ:=#0;\r\n    HB:=False;\r\n    IBC:=False;\r\n    While ((P<=Len) and ((P<=MaxCol) or not IBC)) and ((LQ<>#0) or Not HB) do\r\n      begin\r\n      C:=L[P];\r\n      If (C=LQ) then\r\n        LQ:=#0\r\n      else If (C in Quotes) then\r\n        LQ:=C;\r\n      If (LQ<>#0) then\r\n        Inc(P)\r\n      else\r\n        begin\r\n        HB:=((C=BC) and (BreakStr=Copy(L,P,BLen)));\r\n        If HB then\r\n          Inc(P,Blen)\r\n        else\r\n          begin\r\n          If (P>=MaxCol) then\r\n            IBC:=CharInSet(C,BreakChars);\r\n          Inc(P);\r\n          end;\r\n        end;\r\n//      Writeln('\"',C,'\" : IBC : ',IBC,' HB  : ',HB,' LQ  : ',LQ,' P>MaxCol : ',P>MaxCol);\r\n      end;\r\n    Result:=Result+Copy(L,1,P-1);\r\n    Delete(L,1,P-1);\r\n    Len:=Length(L);\r\n    If (Len>0) and Not HB then\r\n      Result:=Result+BreakStr;\r\n    end;\r\nend;\r\n\r\nfunction WrapText(const Line: string; MaxCol: Integer): string;\r\n\r\nbegin\r\n  Result:=WrapText(Line,sLineBreak, [' ', '-', #9], MaxCol);\r\nend;\r\n\r\n\r\nfunction GetEnvironmentVariable(const EnvVar: String): String;\r\nbegin\r\n  if Assigned(OnGetEnvironmentVariable) then\r\n    Result:=OnGetEnvironmentVariable(EnvVar)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nfunction GetEnvironmentVariableCount: Integer;\r\nbegin\r\n  if Assigned(OnGetEnvironmentVariableCount) then\r\n    Result:=OnGetEnvironmentVariableCount()\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction GetEnvironmentString(Index: Integer): String;\r\nbegin\r\n  if Assigned(OnGetEnvironmentString) then\r\n    Result:=OnGetEnvironmentString(Index)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\n{ Date/Time routines}\r\n\r\nFunction DoEncodeDate(Year, Month, Day: Word): longint;\r\n\r\nVar\r\n  D : TDateTime;\r\n\r\nbegin\r\n  If TryEncodeDate(Year,Month,Day,D) then\r\n    Result:=Trunc(D)\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction DoEncodeTime(Hour, Minute, Second, MilliSecond: word): TDateTime;\r\n\r\nbegin\r\n  If not TryEncodeTime(Hour,Minute,Second,MilliSecond,Result) then\r\n    Result:=0;\r\nend;\r\n\r\nfunction DateTimeToJSDate(aDateTime: TDateTime): TJSDate;\r\n\r\nVar\r\n  Y,M,D,h,n,s,z : Word;\r\n\r\nbegin\r\n  DecodeDate(Trunc(aDateTime),Y,M,D);\r\n  DecodeTime(Frac(aDateTime),H,N,S,Z);\r\n  Result:=TJSDate.New(Y,M-1,D,h,n,s,z);\r\nend;\r\n\r\nfunction JSDateToDateTime(aDate: TJSDate): TDateTime;\r\n\r\nbegin\r\n  Result:=EncodeDate(ADate.FullYear,ADate.Month+1,ADate.Date) +\r\n          EncodeTime(ADate.Hours,ADate.Minutes,ADate.Seconds,ADate.Milliseconds);\r\nend;\r\n\r\n\r\n{   ComposeDateTime converts a Date and a Time into one TDateTime   }\r\nfunction ComposeDateTime(Date,Time : TDateTime) : TDateTime;\r\n\r\nbegin\r\n  if Date < 0 then\r\n    Result := trunc(Date) - Abs(frac(Time))\r\n  else\r\n    Result := trunc(Date) + Abs(frac(Time));\r\nend;\r\n\r\n\r\nfunction TryEncodeDate(Year, Month, Day: Word; out Date: TDateTime): Boolean;\r\n\r\nvar\r\n  c, ya: LongWord;\r\nbegin\r\n  Result:=(Year>0) and (Year<10000) and\r\n          (Month >= 1) and (Month<=12) and\r\n          (Day>0) and (Day<=MonthDays[IsleapYear(Year),Month]);\r\n If Result then\r\n   begin\r\n     if month > 2 then\r\n      Dec(Month,3)\r\n     else\r\n      begin\r\n        Inc(Month,9);\r\n        Dec(Year);\r\n      end;\r\n     c:= Year DIV 100;\r\n     ya:= Year - 100*c;\r\n     Date := (146097*c) SHR 2 + (1461*ya) SHR 2 + (153*LongWord(Month)+2) DIV 5 + LongWord(Day);\r\n     // Note that this line can't be part of the line above, since TDateTime is\r\n     // signed and c and ya are not\r\n     Date := Date - 693900;\r\n   end\r\nend;\r\n\r\nfunction TryEncodeTime(Hour, Min, Sec, MSec: Word; out Time: TDateTime\r\n  ): Boolean;\r\n\r\nbegin\r\n  Result:=(Hour<24) and (Min<60) and (Sec<60) and (MSec<1000);\r\n  If Result then\r\n    Time:=TDateTime(LongWord(Hour)*3600000+LongWord(Min)*60000+LongWord(Sec)*1000+MSec)/MSecsPerDay;\r\nend;\r\n\r\n{   EncodeDate packs three variables Year, Month and Day into a\r\n    TDateTime value the result is the number of days since 12/30/1899   }\r\n\r\nfunction EncodeDate(Year, Month, Day: word): TDateTime;\r\n\r\nbegin\r\n  If Not TryEncodeDate(Year,Month,Day,Result) then\r\n    Raise EConvertError.CreateFmt('%s-%s-%s is not a valid date specification',\r\n                              [IntToStr(Year),IntToStr(Month),IntToStr(Day)]);\r\nend;\r\n\r\n{   EncodeTime packs four variables Hour, Minute, Second and MilliSecond into\r\n    a TDateTime value     }\r\n\r\nfunction EncodeTime(Hour, Minute, Second, MilliSecond:word):TDateTime;\r\n\r\nbegin\r\n  If not TryEncodeTime(Hour,Minute,Second,MilliSecond,Result) then\r\n    Raise EConvertError.CreateFmt('%s:%s:%s.%s is not a valid time specification',\r\n                              [IntToStr(Hour),IntToStr(Minute),IntToStr(Second),IntToStr(MilliSecond)]);\r\nend;\r\n\r\n\r\n{   DecodeDate unpacks the value Date into three values:\r\n    Year, Month and Day   }\r\n\r\nprocedure DecodeDate(Date: TDateTime; out Year, Month, Day: word);\r\nvar\r\n  ly,ld,lm,j : LongWord;\r\nbegin\r\n  if Date <= -datedelta then  // If Date is before 1-1-1 then return 0-0-0\r\n    begin\r\n    Year := 0;\r\n    Month := 0;\r\n    Day := 0;\r\n    end\r\n  else\r\n    begin\r\n    if Date>0 then\r\n      Date:=(Date+(1/(msecsperday*2)))\r\n    else\r\n      Date:=Date-(1/(msecsperday*2));\r\n    if Date>MaxDateTime then\r\n      Date:=MaxDateTime;\r\n//       Raise EConvertError.CreateFmt('%f is not a valid TDatetime encoding, maximum value is %f.',[Date,MaxDateTime]);\r\n    j := ((Trunc(Date) + 693900) SHL 2)-1;\r\n    ly:= j DIV 146097;\r\n    j:= j - 146097 * LongWord(ly);\r\n    ld := j SHR 2;\r\n    j:=(ld SHL 2 + 3) DIV 1461;\r\n    ld:= ((ld SHL 2) + 7 - 1461*j) SHR 2;\r\n    lm:=(5 * ld-3) DIV 153;\r\n    ld:= (5 * ld +2 - 153*lm) DIV 5;\r\n    ly:= 100 * LongWord(ly) + j;\r\n    if lm < 10 then\r\n     inc(lm,3)\r\n    else\r\n      begin\r\n        dec(lm,9);\r\n        inc(ly);\r\n      end;\r\n    year:=ly;\r\n    month:=lm;\r\n    day:=ld;\r\n    end;\r\nend;\r\n\r\n\r\nfunction DecodeDateFully(const DateTime: TDateTime; out Year, Month, Day, DOW: Word): Boolean;\r\nbegin\r\n  DecodeDate(DateTime,Year,Month,Day);\r\n  DOW:=DayOfWeek(DateTime);\r\n  Result:=IsLeapYear(Year);\r\nend;\r\n  {   DateTimeToTimeStamp converts DateTime to a TTimeStamp   }\r\n\r\nfunction DateTimeToTimeStamp(DateTime: TDateTime): TTimeStamp;\r\n\r\nVar\r\n  D : Double;\r\nbegin\r\n  D:=DateTime * Double(MSecsPerDay);\r\n  if D<0 then\r\n    D:=D-0.5\r\n  else\r\n    D:=D+0.5;\r\n  result.Time := Trunc(Abs(Trunc(D)) Mod MSecsPerDay);\r\n  result.Date := DateDelta + (Trunc(D) div MSecsPerDay);\r\nend;\r\n\r\n{   TimeStampToDateTime converts TimeStamp to a TDateTime value   }\r\n\r\nfunction TimeStampToDateTime(const TimeStamp: TTimeStamp): TDateTime;\r\nbegin\r\n  Result := ComposeDateTime(TimeStamp.Date - DateDelta,TimeStamp.Time/MSecsPerDay)\r\nend;\r\n\r\n{   MSecsToTimeStamp   }\r\n\r\nfunction MSecsToTimeStamp(MSecs: NativeInt): TTimeStamp;\r\nbegin\r\n  result.Date := Trunc(msecs/msecsperday);\r\n  msecs:= msecs-NativeInt(result.date)*msecsperday;\r\n  result.Time := Round(MSecs);\r\nend;\r\n\r\nfunction TimeStampToMSecs(const TimeStamp: TTimeStamp): NativeInt;\r\nbegin\r\n  result := TimeStamp.Time + (timestamp.date*msecsperday);\r\nend ;\r\n\r\n\r\n\r\n{   DecodeTime unpacks Time into four values:\r\n    Hour, Minute, Second and MilliSecond    }\r\n\r\nprocedure DecodeTime(Time: TDateTime; out Hour, Minute, Second, MilliSecond: word);\r\nVar\r\n  l : LongWord;\r\nbegin\r\n  l := DateTimeToTimeStamp(Time).Time;\r\n  Hour   := l div 3600000;\r\n  l := l mod 3600000;\r\n  Minute := l div 60000;\r\n  l := l mod 60000;\r\n  Second := l div 1000;\r\n  l := l mod 1000;\r\n  MilliSecond := l;\r\nend;\r\n\r\n{   DateTimeToSystemTime converts DateTime value to SystemTime   }\r\n\r\nprocedure DateTimeToSystemTime(DateTime: TDateTime; out SystemTime: TSystemTime);\r\nbegin\r\n  DecodeDateFully(DateTime, SystemTime.Year, SystemTime.Month, SystemTime.Day,SystemTime.DayOfWeek);\r\n  DecodeTime(DateTime, SystemTime.Hour, SystemTime.Minute, SystemTime.Second, SystemTime.MilliSecond);\r\n  Dec(SystemTime.DayOfWeek);\r\nend ;\r\n\r\n{   SystemTimeToDateTime converts SystemTime to a TDateTime value   }\r\n\r\nfunction SystemTimeToDateTime(const SystemTime: TSystemTime): TDateTime;\r\nbegin\r\n  result := ComposeDateTime(DoEncodeDate(SystemTime.Year, SystemTime.Month, SystemTime.Day),\r\n                            DoEncodeTime(SystemTime.Hour, SystemTime.Minute, SystemTime.Second, SystemTime.MilliSecond));\r\nend ;\r\n\r\nfunction DayOfWeek(DateTime: TDateTime): integer;\r\nbegin\r\n  Result:= 1+((Trunc(DateTime) - 1) mod 7);\r\n  If (Result<=0) then\r\n    Inc(Result,7);\r\nend;\r\n\r\n\r\n\r\nfunction Now: TDateTime;\r\nbegin\r\n  Result:=JSDateToDateTime(TJSDate.New());\r\nend;\r\n\r\nfunction Date: TDateTime;\r\n\r\nbegin\r\n  Result:=Trunc(Now);\r\nend;\r\n\r\nfunction Time: TDateTime;\r\nbegin\r\n  Result:=Now-Date;\r\nend ;\r\n\r\n{   IncMonth increments DateTime with NumberOfMonths months,\r\n    NumberOfMonths can be less than zero   }\r\n\r\nfunction IncMonth(const DateTime: TDateTime; NumberOfMonths: integer = 1 ): TDateTime;\r\nvar\r\n  Year, Month, Day : word;\r\nbegin\r\n  DecodeDate(DateTime, Year, Month, Day);\r\n  IncAMonth(Year, Month, Day, NumberOfMonths);\r\n  result := ComposeDateTime(DoEncodeDate(Year, Month, Day), DateTime);\r\nend ;\r\n\r\n{   IncAMonth is the same as IncMonth, but operates on decoded date  }\r\n\r\nprocedure IncAMonth(var Year, Month, Day: Word; NumberOfMonths: Integer = 1);\r\nvar\r\n  TempMonth, S: Integer;\r\nbegin\r\n  If NumberOfMonths>=0 then\r\n    s:=1\r\n  else\r\n    s:=-1;\r\n  inc(Year,(NumberOfMonths div 12));\r\n  TempMonth:=Month+(NumberOfMonths mod 12)-1;\r\n  if (TempMonth>11) or\r\n     (TempMonth<0) then\r\n   begin\r\n     Dec(TempMonth, S*12);\r\n     Inc(Year, S);\r\n   end;\r\n  Month:=TempMonth+1;          {   Months from 1 to 12   }\r\n  If (Day>MonthDays[IsLeapYear(Year)][Month]) then\r\n    Day:=MonthDays[IsLeapYear(Year)][Month];\r\nend;\r\n\r\n{  IsLeapYear returns true if Year is a leap year   }\r\n\r\nfunction IsLeapYear(Year: Word): boolean;\r\nbegin\r\n  Result := (Year mod 4 = 0) and ((Year mod 100 <> 0) or (Year mod 400 = 0));\r\nend;\r\n\r\n{  DateToStr returns a string representation of Date using ShortDateFormat   }\r\n\r\nfunction DateToStr(Date: TDateTime): string;\r\nbegin\r\n  Result:=DateToStr(Date,FormatSettings);\r\nend;\r\n\r\nfunction DateToStr(Date: TDateTime; const aSettings : TFormatSettings): string;\r\nbegin\r\n  Result:=FormatDateTime('ddddd', Date, aSettings);\r\nend ;\r\n\r\n{  TimeToStr returns a string representation of Time using LongTimeFormat   }\r\n\r\nfunction TimeToStr(Time: TDateTime): string;\r\nbegin\r\n  Result:=TimeToStr(Time,FormatSettings);\r\nend;\r\n\r\nfunction TimeToStr(Time: TDateTime; const aSettings : TFormatSettings): string;\r\nbegin\r\n  Result:=FormatDateTime('tt',Time,aSettings);\r\nend ;\r\n\r\n\r\n{   DateTimeToStr returns a string representation of DateTime using LongDateTimeFormat   }\r\n\r\nVar\r\n  DateTimeToStrFormat : Array[Boolean] of string = ('c','f');\r\n\r\n\r\nfunction DateTimeToStr(DateTime: TDateTime; ForceTimeIfZero : Boolean = False): string;\r\n\r\nbegin\r\n  Result:=DateTimeToStr(DateTime,FormatSettings,ForceTimeIfZero);\r\nend;\r\n\r\nfunction DateTimeToStr(DateTime: TDateTime; Const aSettings : TFormatSettings; ForceTimeIfZero : Boolean = False): string;\r\n\r\n\r\nbegin\r\n  Result:=FormatDateTime(DateTimeToStrFormat[ForceTimeIfZero], DateTime,aSettings)\r\nend ;\r\n\r\n\r\n{   StrToDate converts the string S to a TDateTime value\r\n    if S does not represent a valid date value\r\n    an EConvertError will be raised   }\r\n\r\nfunction IntStrToDate(Out ErrorMsg : String; const S: String; const useformat : string; separator : char): TDateTime;\r\n\r\nConst\r\n  WhiteSpace = ' '#8#9#10#12#13;\r\n  Digits = '0123456789';\r\n\r\n  procedure FixErrorMsg(const errmarg : String);\r\n\r\n  begin\r\n    ErrorMsg:=Format(SInvalidDateFormat,[errmarg]);\r\n  end;\r\n\r\nvar\r\n   df:string;\r\n   d,m,y,ly,ld,lm:word;\r\n   n,i,len:longint;\r\n   c: integer;\r\n   dp,mp,yp,which : Byte;\r\n   s1:string;\r\n   values: array of integer;\r\n   YearMoreThenTwoDigits : boolean;\r\n\r\nbegin\r\n  SetLength(values,4);\r\n  Result:=0;\r\n  Len:=Length(S);\r\n  ErrorMsg:='';\r\n  While (Len>0) and (Pos(S[Len],WhiteSpace)>0) do\r\n    Dec(len);\r\n  if (Len=0) then\r\n    begin\r\n    FixErrorMsg(S);\r\n    exit;\r\n    end;\r\n  YearMoreThenTwoDigits := False;\r\n  if separator = #0 then\r\n    if (FormatSettings.DateSeparator<>#0) then\r\n      separator := FormatSettings.DateSeparator\r\n    else\r\n      separator:='-';\r\n  // Writeln('Separator: ',Separator);\r\n  df := UpperCase(useFormat);\r\n  { Determine order of D,M,Y }\r\n  yp:=0;\r\n  mp:=0;\r\n  dp:=0;\r\n  Which:=0;\r\n  i:=0;\r\n  while (i<Length(df)) and (Which<3) do\r\n   begin\r\n     inc(i);\r\n     Case df[i] of\r\n       'Y' :\r\n         if yp=0 then\r\n          begin\r\n            Inc(Which);\r\n            yp:=which;\r\n          end;\r\n       'M' :\r\n         if mp=0 then\r\n          begin\r\n            Inc(Which);\r\n            mp:=which;\r\n          end;\r\n       'D' :\r\n         if dp=0 then\r\n          begin\r\n            Inc(Which);\r\n            dp:=which;\r\n          end;\r\n     end;\r\n   end;\r\n  // Writeln('YP: ',Yp,', MP: ',Mp,', DP: ',DP);\r\n  for i := 1 to 3 do\r\n    values[i] := 0;\r\n  s1 := '';\r\n  n := 0;\r\n  for i := 1 to len do\r\n     begin\r\n     if Pos(s[i],Digits)>0 then\r\n       s1 := s1 + s[i];\r\n     { space can be part of the shortdateformat, and is defaultly in slovak\r\n       windows, therefor it shouldn't be taken as separator (unless so specified)\r\n       and ignored }\r\n     if (Separator <> ' ') and (s[i] = ' ') then\r\n       Continue;\r\n     if (s[i] = separator) or ((i = len) and (Pos(s[i],Digits)>0)) then\r\n      begin\r\n        inc(n);\r\n        if n>3 then\r\n          begin\r\n//            Writeln('More than 3 separators');\r\n            FixErrorMsg(S);\r\n            exit;\r\n          end;\r\n         // Check if the year has more then two digits (if n=yp, then we are evaluating the year.)\r\n        if (n=yp) and (length(s1)>2) then YearMoreThenTwoDigits := True;\r\n        val(s1, values[n], c);\r\n        if c<>0 then\r\n          begin\r\n//            Writeln('S1 not a number ',S1);\r\n            FixErrorMsg(s);\r\n            Exit;\r\n          end;\r\n        s1 := '';\r\n      end\r\n     else if (Pos(s[i],Digits)=0) then\r\n       begin\r\n//       Writeln('Not a number at pos ',I,' ',S[i]);\r\n       FixErrorMsg(s);\r\n       Exit;\r\n       end;\r\n   end ;\r\n//   Writeln('Which : ',Which,' N : ',N);\r\n   if (Which<3) and (N>Which) then\r\n    begin\r\n    FixErrorMsg(s);\r\n    Exit;\r\n    end;\r\n  // Fill in values.\r\n  DecodeDate(Date,Ly,LM,LD);\r\n  If N=3 then\r\n   begin\r\n     y:=values[yp];\r\n     m:=values[mp];\r\n     d:=values[dp];\r\n   end\r\n  Else\r\n  begin\r\n    Y:=ly;\r\n    If n<2 then\r\n     begin\r\n       d:=values[1];\r\n       m := LM;\r\n     end\r\n    else\r\n     If dp<mp then\r\n      begin\r\n        d:=values[1];\r\n        m:=values[2];\r\n      end\r\n    else\r\n      begin\r\n        d:=values[2];\r\n        m:=values[1];\r\n      end;\r\n  end;\r\n  if (y >= 0) and (y < 100) and not YearMoreThenTwoDigits then\r\n    begin\r\n    ly := ly - TwoDigitYearCenturyWindow;\r\n    Inc(Y, ly div 100 * 100);\r\n    if (TwoDigitYearCenturyWindow > 0) and (Y < ly) then\r\n      Inc(Y, 100);\r\n    end;\r\n  if not TryEncodeDate(y, m, d, result) then\r\n    errormsg:=SErrInvalidDate;\r\nend;\r\n\r\nfunction StrToDate(const S: String; const useformat : string; separator : char): TDateTime;\r\nVar\r\n  MSg : String;\r\nbegin\r\n  Result:=IntStrToDate(Msg,S,useFormat,Separator);\r\n  If (Msg<>'') then\r\n    Raise EConvertError.Create(Msg);\r\nend;\r\n\r\nfunction StrToDate(const S: String; const aSettings : TFormatSettings): TDateTime;\r\n\r\nbegin\r\n  Result:=StrToDate(S,aSettings.ShortDateFormat,aSettings.DateSeparator);\r\nend;\r\n\r\nfunction StrToDate(const S: String): TDateTime;\r\nbegin\r\n  result:=StrToDate(S,FormatSettings);\r\nend;\r\n\r\nfunction StrToDate(const S: String; separator : char): TDateTime;\r\nbegin\r\n  result := StrToDate(S,FormatSettings.ShortDateFormat,separator)\r\nend;\r\n\r\n\r\n{   StrToTime converts the string S to a TDateTime value\r\n    if S does not represent a valid time value an\r\n    EConvertError will be raised   }\r\n\r\n\r\nfunction IntStrToTime(Out ErrorMsg : String; const S: String; Len : integer; Const aSettings : TFormatSettings): TDateTime;\r\n\r\nconst\r\n  AMPM_None = 0;\r\n  AMPM_AM = 1;\r\n  AMPM_PM = 2;\r\n  tiHour = 0;\r\n  tiMin = 1;\r\n  tiSec = 2;\r\n  tiMSec = 3;\r\n\r\ntype\r\n  TTimeValues = array of Word;\r\n\r\nvar\r\n   AmPm: integer;\r\n   TimeValues: TTimeValues;\r\n\r\n\r\n   function SplitElements(out TimeValues: TTimeValues; out AmPm: Integer): Boolean;\r\n   //Strict version. It does not allow #32 as Separator, it will treat it as whitespace always\r\n   const\r\n     Digits = '0123456789';\r\n   var\r\n      Cur, Offset, ElemLen, Err, TimeIndex, FirstSignificantDigit: Integer;\r\n      Value: Integer;\r\n      DigitPending, MSecPending: Boolean;\r\n      AmPmStr: String;\r\n      CurChar: Char;\r\n      I : Integer;\r\n      allowedchars : string;\r\n\r\n   begin\r\n     Result := False;\r\n     AmPm := AMPM_None; //No Am or PM in string found yet\r\n     MSecPending := False;\r\n     TimeIndex := 0; //indicating which TTimeValue must be filled next\r\n     For I:=tiHour to tiMSec do\r\n      TimeValues[i]:=0;\r\n     Cur := 1;\r\n     //skip leading blanks\r\n     While (Cur < Len) and (S[Cur] =#32) do Inc(Cur);\r\n     Offset := Cur;\r\n     //First non-blank cannot be Separator or DecimalSeparator\r\n     if (Cur > Len - 1) or (S[Cur] = aSettings.TimeSeparator) or (S[Cur] = aSettings.Decimalseparator) then\r\n       begin\r\n       // Writeln('Error in sep S[Cur]',S[Cur],' ',separator,' ',GetDecimalSeparator);\r\n       Exit;\r\n       end;\r\n     DigitPending := (Pos(S[Cur],Digits)>0);\r\n     While (Cur <= Len) do\r\n     begin\r\n       //writeln;\r\n       // writeln('Main While loop:  Cur = ',Cur,' S[Cur] = \"',S[Cur],'\" Len = ',Len,' separator : ',Separator);\r\n       CurChar := S[Cur];\r\n       if Pos(CurChar,Digits)>0 then\r\n       begin//Digits\r\n         //HH, MM, SS, or Msec?\r\n         // writeln('Digit: ', CurChar);\r\n         //Digits are only allowed after starting Am/PM or at beginning of string or after Separator\r\n         //and TimeIndex must be <= tiMSec\r\n         //Uncomment \"or (#32 = Separator)\" and it will allllow #32 as separator\r\n         if (not (DigitPending {or (#32 = Separator)})) or (TimeIndex > tiMSec) then\r\n            begin\r\n            // Writeln('DigitPending',ElemLen);\r\n            Exit;\r\n            end;\r\n         OffSet := Cur;\r\n         if (CurChar <> '0') then FirstSignificantDigit := OffSet else FirstSignificantDigit := -1;\r\n         while (Cur < Len) and (Pos(S[Cur + 1],Digits)>0) do\r\n         begin\r\n           //Mark first Digit that is not '0'\r\n           if (FirstSignificantDigit = -1) and (S[Cur] <> '0') then FirstSignificantDigit := Cur;\r\n           Inc(Cur);\r\n         end;\r\n         if (FirstSignificantDigit = -1) then FirstSignificantDigit := Cur;\r\n         ElemLen := 1+ Cur - FirstSignificantDigit;\r\n         // writeln('  S[FirstSignificantDigit] = ',S[FirstSignificantDigit], ' S[Cur] = ',S[Cur],' ElemLen = ',ElemLen,' -> ', S[Offset], ElemLen);\r\n         // writeln('  Cur = ',Cur);\r\n         //this way we know that Val() will never overflow Value !\r\n         if (ElemLen <= 2) or ((ElemLen <= 3) and (TimeIndex = tiMSec) ) then\r\n         begin\r\n           Val(Copy(S,FirstSignificantDigit, ElemLen), Value, Err);\r\n           // writeln('  Value = ',Value,' HH = ',TimeValues[0],' MM = ',TimeValues[1],' SS = ',TimeValues[2],' MSec = ',Timevalues[3]);\r\n           //This is safe now, because we know Value < High(Word)\r\n           TimeValues[TimeIndex] := Value;\r\n           Inc(TimeIndex);\r\n           DigitPending := False;\r\n         end\r\n         else\r\n           begin\r\n           // Writeln('Wrong elemlen: ',ElemLen, ' timeIndex: ',timeindex);\r\n           Exit; //Value to big, so it must be a wrong timestring\r\n           end;\r\n       end//Digits\r\n       else if (CurChar = #32) then\r\n       begin\r\n         //writeln('#32');\r\n         //just skip, but we must adress this, or it will be parsed by either AM/PM or Separator\r\n       end\r\n       else if (CurChar = aSettings.TimeSeparator) then\r\n       begin\r\n         // writeln('Separator ',Separator);\r\n         if DigitPending or (TimeIndex > tiSec) then\r\n           begin\r\n           // Writeln ('DigitPending ',DigitPending,' or (TimeIndex',Timeindex,' > tiSec,', tiSec,')');\r\n           Exit;\r\n           end;\r\n         DigitPending := True;\r\n         MSecPending := False;\r\n       end\r\n       else if (CurChar = aSettings.DecimalSeparator) then\r\n       begin\r\n         //writeln('DecimalSeparator');\r\n         if DigitPending or MSecPending or (TimeIndex <> tiMSec) then\r\n            begin\r\n            // Writeln('DigitPending ',DigitPending,' or MSecPending ',MSecPending,' (',TimeIndex,',Timeindex, >', tiMSec,'  tiSec)');\r\n            Exit;\r\n            end;\r\n         DigitPending := True;\r\n         MSecPending := True;\r\n       end\r\n       else\r\n       begin//AM/PM?\r\n         //None of the above, so this char _must_ be the start of AM/PM string\r\n         //If we already have found AM/PM or we expect a digit then then timestring must be wrong at this point\r\n         //writeln('AM/PM?');\r\n         if (AmPm <> AMPM_None) or DigitPending then\r\n           begin\r\n           // Writeln('AmPm <> AMPM_None) or DigitPending');\r\n           Exit;\r\n           end;\r\n         OffSet := Cur;\r\n         allowedchars:=aSettings.DecimalSeparator+' ';\r\n         if aSettings.TimeSeparator<>#0 then\r\n           allowedchars:=allowedchars+aSettings.TimeSeparator;\r\n         while (Cur < Len) and (Pos(S[Cur + 1],AllowedChars)=0)\r\n           and (Pos(S[Cur + 1],Digits)=0) do Inc(Cur);\r\n         ElemLen := 1 + Cur - OffSet;\r\n//         writeln('  S[Offset] = ',S[Offset], ' S[Cur] = ',S[Cur],' ElemLen = ',ElemLen,' -> ', S[1+Offset], ElemLen);\r\n//         writeln('  Cur = ',Cur, ', S =',S);\r\n         AmPmStr := Copy(S,OffSet, ElemLen);\r\n\r\n         // writeln('AmPmStr = ',ampmstr,' (',length(ampmstr),')');\r\n         //We must compare to TimeAMString before hardcoded 'AM' for delphi compatibility\r\n         //Also it is perfectly legal, though insane to have TimeAMString = 'PM' and vice versa\r\n         if (CompareText(AmPmStr, aSettings.TimeAMString) = 0) then AmPm := AMPM_AM\r\n         else if (CompareText(AmPmStr, aSettings.TimePMString) = 0) then AmPm := AMPM_PM\r\n         else if (CompareText(AmPmStr, 'AM') = 0) then AmPm := AMPM_AM\r\n         else if (CompareText(AmPmStr, 'PM') = 0) then AmPm := AMPM_PM\r\n         else\r\n           begin\r\n           // Writeln('No timestring ',AmPmStr);\r\n           Exit; //If text does not match any of these, timestring must be wrong;\r\n           end;\r\n         //if AM/PM is at beginning of string, then a digit is mandatory after it\r\n         if (TimeIndex = tiHour) then\r\n         begin\r\n           DigitPending := True;\r\n         end\r\n         //otherwise, no more TimeValues allowed after this\r\n         else\r\n         begin\r\n           TimeIndex := tiMSec + 1;\r\n           DigitPending := False;\r\n         end;\r\n       end;//AM/PM\r\n       Inc(Cur)\r\n     end;//while\r\n\r\n     //If we arrive here, parsing the elements has been successfull\r\n     //if not at least Hours specified then input is not valid\r\n     //when am/pm is specified Hour must be <= 12 and not 0\r\n     if (TimeIndex = tiHour) or ((AmPm <> AMPM_None) and ((TimeValues[tiHour] > 12) or (TimeValues[tiHour] = 0))) or DigitPending then\r\n       Exit;\r\n     Result := True;\r\n   end;\r\n\r\nbegin\r\n  setlength(timevalues,4);\r\n  AmPm := AMPM_None;\r\n  if not SplitElements(TimeValues, AmPm) then\r\n  begin\r\n    ErrorMsg:=Format(SErrInvalidTimeFormat,[S]);\r\n    Exit;\r\n  end;\r\n  if (AmPm=AMPM_PM) and (TimeValues[tiHour]<>12) then Inc(TimeValues[tiHour], 12)\r\n  else if (AmPm=AMPM_AM) and (TimeValues[tiHour]=12) then TimeValues[tiHour]:=0;\r\n  // Writeln(      TimeValues[tiHour], TimeValues[tiMin], TimeValues[tiSec], TimeValues[tiMSec]);\r\n  if not TryEncodeTime(TimeValues[tiHour], TimeValues[tiMin], TimeValues[tiSec], TimeValues[tiMSec], result) Then\r\n\r\n    ErrorMsg:=Format(SErrInvalidTimeFormat,[S]);\r\nend ;\r\n\r\nfunction StrToTime(const S: String; const aSettings : TFormatSettings): TDateTime;\r\n\r\nVar\r\n  Msg : String;\r\n\r\nbegin\r\n  Result:=IntStrToTime(Msg,S,Length(S),aSettings);\r\n  If (Msg<>'') then\r\n    Raise EConvertError.Create(Msg);\r\nend;\r\n\r\nfunction StrToTime(const S: String): TDateTime;\r\nbegin\r\n   result:=StrToTime(S, FormatSettings);\r\nend;\r\n\r\n\r\nfunction StrToTime(const S: String; separator: char): TDateTime;\r\n\r\nVar\r\n  aSettings : TFormatSettings;\r\n\r\nbegin\r\n  aSettings:=TFormatSettings.Create;\r\n  aSettings.TimeSeparator:=Separator;\r\n  Result:=StrToTime(S,aSettings);\r\nend;\r\n\r\n\r\n{   StrToDateTime converts the string S to a TDateTime value\r\n    if S does not represent a valid date and/or time value\r\n    an EConvertError will be raised   }\r\n\r\nfunction SplitDateTimeStr(DateTimeStr: String; out DateStr, TimeStr: String; Const aSettings : TFormatSettings): Integer;\r\n\r\n{ Helper function for StrToDateTime\r\n  Pre-condition\r\n    Date is before Time\r\n    If either Date or Time is omitted then see what fits best, a time or a date (issue #0020522)\r\n    Date and Time are separated by whitespace (space Tab, Linefeed or carriage return)\r\n    FS.DateSeparator can be the same as FS.TimeSeparator (issue #0020522)\r\n    If they are both #32 and TrimWhite(DateTimeStr) contains a #32 a date is assumed.\r\n  Post-condition\r\n    DateStr holds date as string or is empty\r\n    TimeStr holds time as string or is empty\r\n    Result = number of strings returned, 0 = error\r\n}\r\nconst\r\n  WhiteSpace = #9#10#13#32;\r\n\r\nvar\r\n  p: Integer;\r\n  DummyDT: TDateTime;\r\nbegin\r\n  Result := 0;\r\n  DateStr := '';\r\n  TimeStr := '';\r\n  DateTimeStr := Trim(DateTimeStr);\r\n  if Length(DateTimeStr) = 0 then exit;\r\n  if (aSettings.DateSeparator = #32) and (aSettings.TimeSeparator = #32) and (Pos(#32, DateTimeStr) > 0) then\r\n    begin\r\n    DateStr:=DateTimeStr;\r\n    {\r\n      Assume a date: dd [mm [yy]].\r\n      Really fancy would be counting the number of whitespace occurrences and decide\r\n      and split accordingly\r\n    }\r\n    Exit(1);\r\n    end;\r\n  p:=1;\r\n  //find separator\r\n  if (aSettings.DateSeparator<>#32) then\r\n    begin\r\n    while (p<Length(DateTimeStr)) and (not (Pos(DateTimeStr[p+1],WhiteSpace)>0)) do\r\n      Inc(p);\r\n    end\r\n  else\r\n    begin\r\n    p:=Pos(aSettings.TimeSeparator, DateTimeStr);\r\n    if (p<>0) then\r\n      repeat\r\n        Dec(p);\r\n      until (p=0) or (Pos(DateTimeStr[p],WhiteSpace)>0);\r\n    end;\r\n  //Always fill DateStr, it eases the algorithm later\r\n  if (p=0) then\r\n    p:=Length(DateTimeStr);\r\n  DateStr:=Copy(DateTimeStr,1,p);\r\n  TimeStr:=Trim(Copy(DateTimeStr,p+1,100));\r\n  if (Length(TimeStr)<>0) then\r\n    Result:=2\r\n  else\r\n    begin\r\n    Result:=1; //found 1 string\r\n    // 2 cases when DateTimeStr only contains a time:\r\n    // Date/time separator differ, and string contains a timeseparator\r\n    // Date/time separators are equal, but transformation to date fails.\r\n    if ((aSettings.DateSeparator<>aSettings.TimeSeparator) and (Pos(aSettings.TimeSeparator,DateStr) > 0))\r\n       or ((aSettings.DateSeparator=aSettings.TimeSeparator) and (not TryStrToDate(DateStr, DummyDT)))  then\r\n      begin\r\n      TimeStr := DateStr;\r\n      DateStr := '';\r\n      end;\r\n    end;\r\nend;\r\n\r\nfunction StrToDateTime(const S: String): TDateTime;\r\n\r\nbegin\r\n  Result:=StrToDateTime(S,FormatSettings);\r\nend;\r\n\r\nfunction StrToDateTime(const S: String; Const aSettings : TFormatSettings): TDateTime;\r\n\r\nvar\r\n  TimeStr, DateStr: String;\r\n  PartsFound: Integer;\r\nbegin\r\n  PartsFound := SplitDateTimeStr(S, DateStr, TimeStr,aSettings);\r\n  case PartsFound of\r\n    0: Result:=StrToDate('');\r\n    1: if (Length(DateStr) > 0) then\r\n         Result := StrToDate(DateStr,aSettings.ShortDateFormat,aSettings.DateSeparator)\r\n       else\r\n         Result := StrToTime(TimeStr);\r\n    2: Result := ComposeDateTime(StrTodate(DateStr,aSettings.ShortDateFormat,aSettings.DateSeparator),\r\n                                  StrToTime(TimeStr));\r\n  end;\r\nend;\r\n\r\nfunction FormatDateTime(const FormatStr: string; const DateTime: TDateTime): string;\r\n\r\nbegin\r\n  Result:=FormatDateTime(FormatStr,DateTime,FormatSettings);\r\nend;\r\n\r\nfunction FormatDateTime(const FormatStr: string; const DateTime: TDateTime; const aSettings : TFormatSettings): string;\r\n\r\n  procedure StoreStr(APos,Len: Integer);\r\n  begin\r\n//    Writeln('StoreStr: ',Result,'+',Copy(FormatStr,APos,Len));\r\n    Result:=Result+Copy(FormatStr,APos,Len);\r\n  end;\r\n\r\n  procedure StoreString(const AStr: string);\r\n\r\n  begin\r\n//    Writeln('StoreString: ',Result,'+',AStr);\r\n    Result:=Result+AStr;\r\n  end;\r\n\r\n  procedure StoreInt(Value, Digits: Integer);\r\n  var\r\n    S: string;\r\n\r\n  begin\r\n    S:=IntToStr(Value);\r\n    While (Length(S)<Digits) do\r\n      S:='0'+S;\r\n    StoreString(S);\r\n  end;\r\n\r\nvar\r\n  Year, Month, Day, DayOfWeek, Hour, Minute, Second, MilliSecond: word;\r\n\r\n  procedure StoreFormat(const FormatStr: string; Nesting: Integer; TimeFlag: Boolean);\r\n  var\r\n    Token, lastformattoken, prevlasttoken: char;\r\n    Count: integer;\r\n    Clock12: boolean;\r\n    tmp: integer;\r\n    isInterval: Boolean;\r\n    P,FormatCurrent,FormatEnd : Integer;\r\n  begin\r\n    if Nesting > 1 then  // 0 is original string, 1 is included FormatString\r\n      Exit;\r\n    FormatCurrent := 1;\r\n    FormatEnd := Length(FormatStr);\r\n    Clock12 := false;\r\n    isInterval := false;\r\n    // look for unquoted 12-hour clock token\r\n    P:=1;\r\n    while P<=FormatEnd do\r\n      begin\r\n      Token := FormatStr[P];\r\n      case Token of\r\n        '''', '\"':\r\n        begin\r\n          Inc(P);\r\n          while (P < FormatEnd) and (FormatStr[P]<>Token) do\r\n            Inc(P);\r\n        end;\r\n        'A', 'a':\r\n        begin\r\n          if (CompareText(Copy(FormatStr,P,3),'A/P')=0) or\r\n             (CompareText(Copy(FormatStr,P,4),'AMPM')=0) or\r\n             (CompareText(Copy(FormatStr,P,5),'AM/PM')=0) then\r\n          begin\r\n            Clock12 := true;\r\n            break;\r\n          end;\r\n        end;\r\n      end;  // case\r\n      Inc(P);\r\n    end ;\r\n    token := #255;\r\n    lastformattoken := ' ';\r\n    prevlasttoken := 'H';\r\n    while FormatCurrent <= FormatEnd do\r\n    begin\r\n      Token := UpperCase(FormatStr[FormatCurrent])[1];\r\n     //  Writeln('Treating token at pos ',FormatCurrent,', : ',Token,' (',FormatStr,')');\r\n      Count := 1;\r\n      P := FormatCurrent + 1;\r\n      case Token of\r\n        '''', '\"':\r\n        begin\r\n          while (P < FormatEnd) and (FormatStr[P]<>Token) do\r\n            Inc(P);\r\n          Inc(P);\r\n          Count := P - FormatCurrent;\r\n          StoreStr(FormatCurrent + 1, Count - 2);\r\n        end ;\r\n        'A':\r\n        begin\r\n          if CompareText(Copy(FormatStr,FormatCurrent,4), 'AMPM') = 0 then\r\n          begin\r\n            Count := 4;\r\n            if Hour < 12 then\r\n              StoreString(aSettings.TimeAMString)\r\n            else\r\n              StoreString(aSettings.TimePMString);\r\n          end\r\n          else if CompareText(Copy(FormatStr,FormatCurrent,5), 'AM/PM') = 0 then\r\n          begin\r\n            Count := 5;\r\n            if Hour < 12 then StoreStr(FormatCurrent, 2)\r\n                         else StoreStr(FormatCurrent+3, 2);\r\n          end\r\n          else if CompareText(Copy(FormatStr,FormatCurrent,3), 'A/P') = 0 then\r\n          begin\r\n            Count := 3;\r\n            if Hour < 12 then StoreStr(FormatCurrent, 1)\r\n            else StoreStr(FormatCurrent+2, 1);\r\n          end\r\n          else\r\n            raise EConvertError.Create('Illegal character in format string');\r\n        end ;\r\n        '/':\r\n          begin\r\n           //  Writeln('Detected date separator');\r\n          StoreString(aSettings.DateSeparator);\r\n          end;\r\n        ':': StoreString(aSettings.TimeSeparator);\r\n        ' ', 'C', 'D', 'H', 'M', 'N', 'S', 'T', 'Y', 'Z', 'F' :\r\n        begin\r\n          // Writeln(FormatCurrent,' Special Token: ',Token,', Count: ',Count,', P: ',P);\r\n          while (P <= FormatEnd) and (UpperCase(FormatStr[P]) = Token) do\r\n            Inc(P);\r\n          Count := P - FormatCurrent;\r\n          // Writeln(FormatCurrent,' Special Token: ',Token,', Count: ',Count,', P: ',P);\r\n          case Token of\r\n            ' ': StoreStr(FormatCurrent, Count);\r\n            'Y': begin\r\n              if Count > 2 then\r\n                StoreInt(Year, 4)\r\n              else\r\n                StoreInt(Year mod 100, 2);\r\n            end;\r\n            'M': begin\r\n\t      if isInterval and ((prevlasttoken = 'H') or TimeFlag) then\r\n\t        StoreInt(Minute + (Hour + trunc(abs(DateTime))*24)*60, 0)\r\n\t      else\r\n              if (lastformattoken = 'H') or TimeFlag then\r\n              begin\r\n                if Count = 1 then\r\n                  StoreInt(Minute, 0)\r\n                else\r\n                  StoreInt(Minute, 2);\r\n              end\r\n              else\r\n              begin\r\n                case Count of\r\n                  1: StoreInt(Month, 0);\r\n                  2: StoreInt(Month, 2);\r\n                  3: StoreString(aSettings.ShortMonthNames[Month]);\r\n                else\r\n                  StoreString(aSettings.LongMonthNames[Month]);\r\n                end;\r\n              end;\r\n            end;\r\n            'D': begin\r\n              case Count of\r\n                1: StoreInt(Day, 0);\r\n                2: StoreInt(Day, 2);\r\n                3: StoreString(aSettings.ShortDayNames[DayOfWeek]);\r\n                4: StoreString(aSettings.LongDayNames[DayOfWeek]);\r\n                5: StoreFormat(aSettings.ShortDateFormat, Nesting+1, False);\r\n              else\r\n                StoreFormat(aSettings.LongDateFormat, Nesting+1, False);\r\n              end ;\r\n            end ;\r\n            'H':\r\n\t      if isInterval then\r\n\t        StoreInt(Hour + trunc(abs(DateTime))*24, 0)\r\n\t      else\r\n\t      if Clock12 then\r\n              begin\r\n                tmp := hour mod 12;\r\n                if tmp=0 then tmp:=12;\r\n                if Count = 1 then\r\n                  StoreInt(tmp, 0)\r\n                else\r\n                  StoreInt(tmp, 2);\r\n              end\r\n              else begin\r\n                if Count = 1 then\r\n\t\t  StoreInt(Hour, 0)\r\n                else\r\n                  StoreInt(Hour, 2);\r\n              end;\r\n            'N': if isInterval then\r\n\t           StoreInt(Minute + (Hour + trunc(abs(DateTime))*24)*60, 0)\r\n\t\t else\r\n\t\t if Count = 1 then\r\n                   StoreInt(Minute, 0)\r\n                 else\r\n                   StoreInt(Minute, 2);\r\n            'S': if isInterval then\r\n\t           StoreInt(Second + (Minute + (Hour + trunc(abs(DateTime))*24)*60)*60, 0)\r\n\t         else\r\n\t         if Count = 1 then\r\n                   StoreInt(Second, 0)\r\n                 else\r\n                   StoreInt(Second, 2);\r\n            'Z': if Count = 1 then\r\n                   StoreInt(MilliSecond, 0)\r\n                 else\r\n\t\t   StoreInt(MilliSecond, 3);\r\n            'T': if Count = 1 then\r\n\t\t   StoreFormat(aSettings.ShortTimeFormat, Nesting+1, True)\r\n                 else\r\n\t           StoreFormat(aSettings.LongTimeFormat, Nesting+1, True);\r\n            'C': begin\r\n                   StoreFormat(aSettings.ShortDateFormat, Nesting+1, False);\r\n                   if (Hour<>0) or (Minute<>0) or (Second<>0) then\r\n                     begin\r\n                      StoreString(' ');\r\n                      StoreFormat(aSettings.LongTimeFormat, Nesting+1, True);\r\n                     end;\r\n                 end;\r\n            'F': begin\r\n                   StoreFormat(aSettings.ShortDateFormat, Nesting+1, False);\r\n                   StoreString(' ');\r\n                   StoreFormat(aSettings.LongTimeFormat, Nesting+1, True);\r\n                 end;\r\n          end;\r\n\t  prevlasttoken := lastformattoken;\r\n          lastformattoken := token;\r\n        end;\r\n        else\r\n          StoreString(Token);\r\n      end ;\r\n      Inc(FormatCurrent, Count);\r\n    end;\r\n  end;\r\n\r\nbegin\r\n  DecodeDateFully(DateTime, Year, Month, Day, DayOfWeek);\r\n  DecodeTime(DateTime, Hour, Minute, Second, MilliSecond);\r\n  // Writeln(DateTime,'->',Year,',', Month, ',',Day, ',',DayOfWeek,',',Hour, ',',Minute, ',',Second, ',',MilliSecond);\r\n  if FormatStr <> '' then\r\n    StoreFormat(FormatStr, 0, False)\r\n  else\r\n    StoreFormat('C', 0, False);\r\nend ;\r\n\r\n\r\nfunction CurrentYear: Word;\r\n\r\nbegin\r\n  Result:=TJSDate.New().FullYear;\r\nend;\r\n\r\nfunction TryStrToDate(const S: String; out Value: TDateTime): Boolean;\r\nbegin\r\n  Result:=TryStrToDate(S,Value,FormatSettings);\r\nend;\r\n\r\nfunction TryStrToDate(const S: String; out Value: TDateTime; separator : char): Boolean;\r\n\r\nbegin\r\n  Result:=TryStrToDate(S,Value,FormatSettings.ShortDateFormat,Separator);\r\nend;\r\n\r\nfunction TryStrToDate(const S: String; out Value: TDateTime;  const useformat : string; separator : char): Boolean;\r\n\r\nVar\r\n  Msg : String;\r\n\r\nbegin\r\n  Result:=Length(S)<>0;\r\n  If Result then\r\n    begin\r\n    Value:=IntStrToDate(Msg,S,useformat,Separator);\r\n    Result:=(Msg='');\r\n    end;\r\nend;\r\n\r\nfunction TryStrToDate(const S: String; out Value: TDateTime; const aSettings : TFormatSettings): Boolean;\r\n\r\nbegin\r\n  Result:=TryStrToDate(S,Value,aSettings.ShortDateFormat,aSettings.DateSeparator);\r\nend;\r\n\r\nfunction TryStrToTime(const S: String; out Value: TDateTime; aSettings : TFormatSettings): Boolean;\r\n\r\nVar\r\n  Msg : String;\r\n\r\nbegin\r\n  Result:=Length(S)<>0;\r\n  If Result then\r\n    begin\r\n      Value:=IntStrToTime(Msg,S,Length(S),aSettings);\r\n      Result:=(Msg='');\r\n    end;\r\nend;\r\n\r\nfunction TryStrToTime(const S: String; out Value: TDateTime; separator : char): Boolean;\r\n\r\nVar\r\n  Fmt : TFormatSettings;\r\n\r\nbegin\r\n  fmt:=TFormatSettings.Create;\r\n  fmt.TimeSeparator:=Separator;\r\n  Result:=TryStrToTime(S,Value,Fmt);\r\nend;\r\n\r\nfunction TryStrToTime(const S: String; out Value: TDateTime): Boolean;\r\nbegin\r\n  result:=TryStrToTime(S,Value,FormatSettings);\r\nend;\r\n\r\nfunction TryStrToDateTime(const S: String; out Value: TDateTime): Boolean;\r\n\r\nbegin\r\n  Result:=TryStrToDateTime(S,Value,FormatSettings);\r\nend;\r\n\r\nfunction TryStrToDateTime(const S: String; out Value: TDateTime; Const aSettings : TFormatSettings): Boolean;\r\n\r\nvar\r\n  I: integer;\r\n  dtdate, dttime :TDateTime;\r\nbegin\r\n  result:=false;\r\n  I:=Pos(aSettings.TimeSeparator,S);\r\n  If (I>0) then\r\n    begin\r\n      While (I>0) and (S[I]<>' ') do\r\n        Dec(I);\r\n      If I>0 then\r\n        begin\r\n          if not TryStrToDate(Copy(S,1,I-1),dtdate) then\r\n            exit;\r\n          if not TryStrToTime(Copy(S,i+1, Length(S)-i),dttime) then\r\n            exit;\r\n          Value:=ComposeDateTime(dtdate,dttime);\r\n          result:=true;\r\n        end\r\n      else\r\n         result:=TryStrToTime(s,Value);\r\n    end\r\n  else\r\n    result:=TryStrToDate(s,Value);\r\nend;\r\n\r\n\r\n\r\nfunction StrToDateDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nbegin\r\n   result := StrToDateDef(S,DefValue,#0);\r\nend;\r\n\r\nfunction StrToDateDef(const S: string; const Defvalue: TDateTime; const aSettings: TFormatSettings): TDateTime;\r\nbegin\r\n  if not TryStrToDate(S, Result, aSettings) Then\r\n    Result := Defvalue;\r\nend;\r\n\r\nfunction StrToTimeDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nbegin\r\n   result := StrToTimeDef(S,DefValue,#0);\r\nend;\r\n\r\nfunction StrToDateTimeDef(const S: String; const Defvalue : TDateTime; aSettings : TFormatSettings): TDateTime; overload;\r\nbegin\r\n  if not TryStrToDateTime(s,Result,aSettings) Then\r\n    result:=defvalue;\r\nend;\r\n\r\nfunction StrToDateTimeDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nbegin\r\n  Result:=StrToDateTimeDef(s,DefValue,FormatSettings);\r\nend;\r\n\r\nfunction StrToDateDef(const S: String; const Defvalue : TDateTime; separator : char): TDateTime;\r\nbegin\r\n  if not TryStrToDate(s,Result, separator) Then\r\n    result:=defvalue;\r\nend;\r\n\r\nfunction StrToTimeDef(const S: String; const Defvalue : TDateTime; separator : char): TDateTime;\r\nbegin\r\n  if not TryStrToTime(s,Result, separator) Then\r\n    result:=defvalue;\r\nend;\r\n\r\nfunction StrToTimeDef(const AString: string; const ADefault: TDateTime;\r\n  const aSettings: TFormatSettings): TDateTime;\r\nbegin\r\n  if not TryStrToTime(AString, Result, aSettings) Then\r\n    Result := ADefault;\r\nend;\r\n\r\nprocedure ReplaceTime(var dati:TDateTime; NewTime : TDateTime);\r\nbegin\r\n  dati:= ComposeDateTime(dati, newtime);\r\nend;\r\n\r\nprocedure ReplaceDate(var DateTime: TDateTime; const NewDate: TDateTime);\r\nvar\r\n  tmp : TDateTime;\r\nbegin\r\n  tmp:=NewDate;\r\n  ReplaceTime(tmp,DateTime);\r\n  DateTime:=tmp;\r\nend;\r\n\r\nfunction FloatToDateTime(const Value: Extended): TDateTime;\r\nbegin\r\n  If (Value<MinDateTime) or (Value>MaxDateTime) then\r\n    Raise EConvertError.CreateFmt (SInvalidDateTime,[FloatToStr(Value)]);\r\n  Result:=Value;\r\nend;\r\n\r\nfunction FloattoCurr(const Value: Extended): Currency;\r\nbegin\r\n  if not TryFloatToCurr(Value, Result) then\r\n    Raise EConvertError.CreateFmt(SInvalidCurrency, [FloatToStr(Value)]);\r\nend;\r\n\r\nfunction TryFloatToCurr(const Value: Extended; var AResult: Currency): Boolean;\r\nbegin\r\n  Result:=(Value>=MinCurrency) and (Value<=MaxCurrency);\r\n  if Result then\r\n    AResult := Value;\r\nend;\r\n\r\nfunction CurrToStr(Value: Currency): string;\r\nbegin\r\n  Result:=FloatToStrF(Value,ffGeneral,-1,0,FormatSettings);\r\nend;\r\n\r\n\r\nfunction CurrToStr(Value: Currency; const aSettings: TFormatSettings): string;\r\nbegin\r\n  Result:=FloatToStrF(Value,ffGeneral,-1,0,aSettings);\r\nend;\r\n\r\n\r\nfunction StrToCurr(const S: string): Currency;\r\n\r\nbegin\r\n  if not TryStrToCurr(S,Result) then\r\n    Raise EConvertError.createfmt(SInvalidCurrency,[S]);\r\nend;\r\n\r\nfunction StrToCurr(const S: string; const aSettings: TFormatSettings): Currency;\r\nbegin\r\n  if not TryStrToCurr(S,Result,aSettings) then\r\n    Raise EConvertError.createfmt(SInvalidCurrency,[S]);\r\nend;\r\n\r\nfunction TryStrToCurr(const S: string; out Value: Currency): Boolean;\r\n\r\nVar\r\n  D : Double;\r\n\r\nbegin\r\n  Result:=TryStrToFloat(S,D,FormatSettings);\r\n  if Result then\r\n    Value:=D;\r\nend;\r\n\r\n\r\nfunction TryStrToCurr(const S: string; out Value: Currency; const aSettings: TFormatSettings): Boolean;\r\nVar\r\n  D : Double;\r\n\r\nbegin\r\n  Result:=TryStrToFloat(S,D,aSettings);\r\n  if Result then\r\n    Value:=D;\r\nend;\r\n\r\n\r\nfunction StrToCurrDef(const S: string; Default: Currency): Currency;\r\n\r\nVar\r\n  R : Currency;\r\n\r\nbegin\r\n  if TryStrToCurr(S,R,FormatSettings) then\r\n    Result:=R\r\n  else\r\n    Result:=Default;\r\nend;\r\n\r\n\r\nfunction StrToCurrDef(const S: string; Default: Currency; const aSettings: TFormatSettings): Currency;\r\nVar\r\n  R : Currency;\r\n\r\nbegin\r\n  if TryStrToCurr(S,R,aSettings) then\r\n    Result:=R\r\n  else\r\n    Result:=Default;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n  Interface related\r\n  ---------------------------------------------------------------------}\r\nfunction Supports(const Instance: IInterface; const AClass: TClass; out Obj\r\n  ): Boolean;\r\nbegin\r\n  Result := (Instance<>nil) and (Instance.QueryInterface(IObjectInstance,Obj)=S_OK)\r\n     and (TObject(Obj).InheritsFrom(AClass));\r\nend;\r\n\r\nfunction Supports(const Instance: IInterface; const IID: TGuid; out Intf\r\n  ): Boolean;\r\nbegin\r\n  Result:=(Instance<>nil) and (Instance.QueryInterface(IID,Intf)=S_OK);\r\nend;\r\n\r\nfunction Supports(const Instance: TObject; const IID: TGuid; out Intf): Boolean;\r\nbegin\r\n  Result:=(Instance<>nil) and Instance.GetInterface(IID,Intf);\r\nend;\r\n\r\nfunction Supports(const Instance: TObject; const IID: TGuidString; out Intf\r\n  ): Boolean;\r\nbegin\r\n  Result:=(Instance<>nil) and Instance.GetInterfaceByStr(IID,Intf);\r\nend;\r\n\r\nfunction Supports(const Instance: IInterface; const AClass: TClass): Boolean;\r\nvar\r\n  Temp: TObject;\r\nbegin\r\n  Result:=Supports(Instance,AClass,Temp);\r\nend;\r\n\r\nfunction Supports(const Instance: IInterface; const IID: TGuid): Boolean;\r\nvar\r\n  Temp: IInterface;\r\nbegin\r\n  Result:=Supports(Instance,IID,Temp);\r\nend;\r\n\r\nfunction Supports(const Instance: TObject; const IID: TGuid): Boolean;\r\nvar\r\n  Temp: TJSObject;\r\nbegin\r\n  Result:=Supports(Instance,IID,Temp);\r\n  asm\r\n    if (Temp && Temp.$kind==='com') Temp._Release();\r\n  end;\r\nend;\r\n\r\nfunction Supports(const Instance: TObject; const IID: TGuidString): Boolean;\r\nvar\r\n  Temp: TJSObject;\r\nbegin\r\n  Result:=Supports(Instance,IID,Temp);\r\n  asm\r\n    if (Temp && Temp.$kind==='com') Temp._Release();\r\n  end;\r\nend;\r\n\r\nfunction Supports(const AClass: TClass; const IID: TGuid): Boolean;\r\nvar\r\n  maps: JSValue;\r\nbegin\r\n  if AClass=nil then exit(false);\r\n  maps := TJSObject(AClass)['$intfmaps'];\r\n  if not maps then exit(false);\r\n  if TJSObject(maps)[GUIDToString(IID)] then exit(true);\r\n  Result:=false;\r\nend;\r\n\r\nfunction Supports(const AClass: TClass; const IID: TGuidString): Boolean;\r\nvar\r\n  maps: JSValue;\r\nbegin\r\n  if AClass=nil then exit(false);\r\n  maps := TJSObject(AClass)['$intfmaps'];\r\n  if not maps then exit(false);\r\n  if TJSObject(maps)[uppercase(IID)] then exit(true);\r\n  Result:=false;\r\nend;\r\n\r\nfunction TryStringToGUID(const s: string; out Guid: TGuid): Boolean;\r\nvar\r\n  re: TJSRegexp;\r\nbegin\r\n  if Length(s)<>38 then Exit(False);\r\n  re:=TJSRegexp.new('^\\{[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\\}$');\r\n  Result:=re.test(s);\r\n  if not Result then\r\n    begin\r\n    Guid.D1:=0;\r\n    exit;\r\n    end;\r\n  asm\r\n    rtl.strToGUIDR(s,Guid);\r\n  end;\r\n  Result:=true;\r\nend;\r\n\r\nfunction StringToGUID(const S: string): TGuid;\r\nbegin\r\n  if not TryStringToGUID(S, Result) then\r\n    raise EConvertError.CreateFmt(SInvalidGUID, [S]);\r\nend;\r\n\r\nfunction GUIDToString(const guid: TGuid): string;\r\nbegin\r\n  Result:=System.GUIDToString(guid);\r\nend;\r\n\r\nfunction IsEqualGUID(const guid1, guid2: TGuid): Boolean;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if (guid1.D1<>guid2.D1) or (guid1.D2<>guid2.D2) or (guid1.D3<>guid2.D3) then\r\n    exit(false);\r\n  for i:=0 to 7 do if guid1.D4[i]<>guid2.D4[i] then exit(false);\r\n  Result:=true;\r\nend;\r\n\r\nfunction GuidCase(const guid: TGuid; const List: array of TGuid): Integer;\r\nbegin\r\n  for Result := High(List) downto 0 do\r\n    if IsEqualGUID(guid, List[Result]) then\r\n      Exit;\r\n  Result := -1;\r\nend;\r\n\r\nfunction CreateGUID(out GUID: TGUID): Integer;\r\n\r\n  Function R(B: Integer) : NativeInt;\r\n\r\n  Var\r\n    v : NativeInt;\r\n  begin\r\n    v:=Random(256);\r\n    While B>1 do\r\n      begin\r\n      v:=v*256+Random(256);\r\n      Dec(B);\r\n      end;\r\n    Result:=V;\r\n  end;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  GUID.D1:= R(4);\r\n  GUID.D2:= R(2);\r\n  GUID.D3:= R(2);\r\n  For I:=0 to 7 do\r\n   GUID.D4[I]:=R(1);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Integer/Ordinal related\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction TryStrToInt(const S: String; out res: Integer): Boolean;\r\n\r\nVar\r\n  NI : NativeInt;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,NI);\r\n  Result:=Result and (-2147483648<=NI) and (NI<=2147483647);\r\n  if Result then\r\n    res:=NI;\r\nend;\r\n\r\n\r\nfunction IntTryStrToInt(const S: String; out res: NativeInt; Const aSep : string): Boolean;\r\n\r\nVar\r\n  Radix : Integer = 10;\r\n  N : String;\r\n  J : JSValue;\r\n\r\nbegin\r\n  N:=S;\r\n  // Javascript Parseint allows 1.0 or 1E0 to be an integer, so we must check for this to get the same behaviour as FPC/Delphi.\r\n  if (Pos(aSep,N)<>0) or (Pos('.',N)<>0) then\r\n    exit(False);\r\n  case Copy(N,1,1) of\r\n  '$': Radix:=16;\r\n  '&': Radix:=8;\r\n  '%': Radix:=2;\r\n  end;\r\n  // Check for E after we know radix\r\n  if (Radix<>16) and (Pos('e',LowerCase(N))<>0) then\r\n    exit(False);\r\n  If Radix<>10 then\r\n    Delete(N,1,1);\r\n  J:=parseInt(N,Radix);\r\n  Result:=Not jsIsNan(j);\r\n  if Result then\r\n    res:=NativeInt(J);\r\nend;\r\n\r\nfunction TryStrToInt(const S: String; out res: NativeInt): Boolean;\r\n\r\nbegin\r\n  Result:=IntTryStrToInt(S,res,FormatSettings.DecimalSeparator);\r\nend;\r\n\r\nfunction TryStrToInt(const S: String; out res: NativeInt; Const aSettings : TFormatSettings): Boolean;\r\n\r\nbegin\r\n  Result:=IntTryStrToInt(S,res,aSettings.DecimalSeparator);\r\nend;\r\n\r\nfunction StrToIntDef(const S: String; const aDef: Integer): Integer;\r\n\r\nVar\r\n  R : NativeInt;\r\n\r\nbegin\r\n  if TryStrToInt(S,R) then\r\n    Result:=R\r\n  else\r\n    Result:=aDef;\r\nend;\r\n\r\nfunction StrToIntDef(const S: String; const aDef: NativeInt): NativeInt;\r\n\r\nVar\r\n  R : NativeInt;\r\n\r\nbegin\r\n  if TryStrToInt(S,R) then\r\n    Result:=R\r\n  else\r\n    Result:=aDef;\r\nend;\r\n\r\nfunction StrToInt(const S: String): Integer;\r\n\r\nVar\r\n  R : NativeInt;\r\n\r\nbegin\r\n  if not TryStrToInt(S,R) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\n  Result:=R;\r\nend;\r\n\r\nfunction StrToNativeInt(const S: String): NativeInt;\r\n\r\nbegin\r\n  if not TryStrToInt(S,Result) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\nend;\r\n\r\nfunction StrToUInt(const s: string): Cardinal;\r\n\r\nbegin\r\n  If not TryStrToUint(S,Result) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S])\r\nend;\r\n\r\nfunction StrToUIntDef(const s: string; aDef : Cardinal): Cardinal;\r\n\r\nbegin\r\n  If not TryStrToUint(S,Result) then\r\n    Result:=aDef;\r\nend;\r\n\r\nfunction UIntToStr(Value: Cardinal): string; \r\n\r\nbegin\r\n  Result:=IntToStr(Value);\r\nend;\r\n\r\nfunction TryStrToUInt(const s: string; out C: Cardinal): Boolean;\r\nVar\r\n  N : NativeInt;\r\nbegin\r\n  Result:=TryStrToInt(S,N);\r\n  Result:=(N>=0) and (N<=high(longword));\r\n  If Result then \r\n    C:=N;\r\nend;\r\n\r\nfunction StrToInt64(const S: String): NativeLargeInt;\r\n\r\nVar\r\n  N : NativeInt;\r\n\r\nbegin\r\n  if not TryStrToInt(S,N) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\n  Result:=N;\r\nend;\r\n\r\nfunction TryStrToInt64(const S: String; out res: NativeLargeInt): Boolean;\r\n\r\nVar\r\n  R : nativeint;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,R);\r\n  If Result then\r\n    Res:=R;\r\nend;\r\n\r\nfunction StrToInt64Def(const S: String; ADefault: NativeLargeInt\r\n  ): NativeLargeInt;\r\n\r\n\r\nbegin\r\n  if not TryStrToInt64(S,Result) then\r\n    Result:=ADefault;\r\nend;\r\n\r\nfunction StrToQWord(const S: String): NativeLargeUInt;\r\n\r\nVar\r\n  N : NativeInt;\r\n\r\nbegin\r\n  if (not TryStrToInt(S,N)) or (N<0) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\n  Result:=N;\r\nend;\r\n\r\nfunction TryStrToQWord(const S: String; out res: NativeLargeUInt): Boolean;\r\n\r\nVar\r\n  R : nativeint;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,R) and (R>=0);\r\n  If Result then\r\n    Res:=R;\r\nend;\r\n\r\nfunction TryStrToQWord(const S: String; out res: QWord): Boolean;\r\nbegin\r\n  Result:=TryStrToQWord(S,NativeLargeUInt(res));\r\nend;\r\n\r\nfunction StrToQWordDef(const S: String; ADefault: NativeLargeUInt\r\n  ): NativeLargeUInt;\r\n\r\nbegin\r\n  if Not TryStrToQword(S,Result) then\r\n    Result:=ADefault;\r\nend;\r\n\r\nfunction StrToUInt64(const S: String): NativeLargeUInt;\r\n\r\nVar\r\n  N : NativeInt;\r\n\r\nbegin\r\n  if (not TryStrToInt(S,N)) or (N<0) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\n  Result:=N;\r\nend;\r\n\r\nfunction TryStrToUInt64(const S: String; out res: NativeLargeUInt): Boolean;\r\n\r\nVar\r\n  R : nativeint;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,R) and (R>=0);\r\n  If Result then\r\n    Res:=R;\r\nend;\r\n\r\nfunction TryStrToUInt64(const S: String; out res: UInt64): Boolean;\r\nbegin\r\n  Result:=TryStrToUInt64(S,NativeLargeUInt(res));\r\nend;\r\n\r\nfunction StrToUInt64Def(const S: String; ADefault: NativeLargeUInt\r\n  ): NativeLargeUInt;\r\n\r\n\r\nbegin\r\n  if Not TryStrToUInt64(S,Result) then\r\n    Result:=ADefault;\r\nend;\r\n\r\nfunction TryStrToDWord(const S: String; out res: DWord): Boolean;\r\n\r\nVar\r\n  R : nativeint;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,R) and (R>=0) and (R<=DWord($FFFFFFFF));\r\n  If Result then\r\n    Res:=R;\r\nend;\r\n\r\nfunction StrToDWord(const S: String): DWord;\r\n\r\nbegin\r\n  if not TryStrToDWord(S,Result) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\nend;\r\n\r\n\r\nfunction StrToDWordDef(const S: String; ADefault: DWord): DWord;\r\n\r\nbegin\r\n  if Not TryStrToDWord(S,Result) then\r\n    Result:=ADefault;\r\nend;\r\n\r\n\r\nfunction IntToHex(Value: NativeInt; Digits: integer): string;\r\n\r\nbegin\r\n//  Result:=HexStr(Value,Digits);     // TestNegLongintHelper  Failed: \"ToHexString\" expected: <FFFE0000> but was: <00-20000> !\r\n  Result:='';\r\n  if Value<0 then\r\n    asm\r\n    if (Value<0) Value = 0xFFFFFFFF + Value + 1;\r\n    end;\r\n  asm\r\n  Result=Value.toString(16);\r\n  end;\r\n  Result:=UpperCase(Result);\r\n  while (Length(Result)<Digits) do\r\n    Result:='0'+Result;\r\nend;\r\n\r\nprocedure InitGlobalFormatSettings;\r\nbegin\r\n  // So the defaults are taken from FormatSettings.\r\n  {$WARN 5043 off}\r\n  FormatSettings:=TFormatSettings.Create;\r\n  TimeSeparator:=FormatSettings.TimeSeparator;\r\n  DateSeparator:=FormatSettings.DateSeparator;\r\n  ShortDateFormat:=FormatSettings.ShortDateFormat;\r\n  LongDateFormat:=FormatSettings.LongDateFormat;\r\n  ShortTimeFormat:=FormatSettings.ShortTimeFormat;\r\n  LongTimeFormat:=FormatSettings.LongTimeFormat;\r\n  DecimalSeparator:=FormatSettings.DecimalSeparator;\r\n  ThousandSeparator:=FormatSettings.ThousandSeparator;\r\n  TimeAMString:=FormatSettings.TimeAMString;\r\n  TimePMString:=FormatSettings.TimePMString;\r\n  CurrencyFormat:=FormatSettings.CurrencyFormat;\r\n  NegCurrFormat:=FormatSettings.NegCurrFormat;\r\n  CurrencyDecimals:=FormatSettings.CurrencyDecimals;\r\n  CurrencyString:=FormatSettings.CurrencyString;\r\nend;\r\n\r\n{ TFormatSettings }\r\n\r\nclass function TFormatSettings.Create: TFormatSettings;\r\nbegin\r\n  Result := Create(GetJSLocale);\r\nend;\r\n\r\nclass function TFormatSettings.Create(const ALocale: string): TFormatSettings;\r\nconst\r\n  cDateSeps: array of Char = ('/', '.', '-');\r\n  cTimeSeps: array of Char = (':', '.', '-');\r\n  cDecSeps: array of Char = (',', '.');\r\n  cThousandSeps: array of Char = ('.', ',');\r\nvar\r\n  lTimeStr: string;\r\n  lCount: Integer;\r\n  lLoc: string;\r\nbegin\r\n  lLoc := Uppercase(ALocale);\r\n  if pos('DE-', lLoc) = 1 then\r\n  begin\r\n    Result.LongDayNames[1] := 'Sonntag';\r\n    Result.LongDayNames[2] := 'Montag';\r\n    Result.LongDayNames[3] := 'Dienstag';\r\n    Result.LongDayNames[4] := 'Mittwoch';\r\n    Result.LongDayNames[5] := 'Donnerstag';\r\n    Result.LongDayNames[6] := 'Freitag';\r\n    Result.LongDayNames[7] := 'Samstag';\r\n    Result.ShortDayNames[1] := 'Son';\r\n    Result.ShortDayNames[2] := 'Mon';\r\n    Result.ShortDayNames[3] := 'Die';\r\n    Result.ShortDayNames[4] := 'Mit';\r\n    Result.ShortDayNames[5] := 'Don';\r\n    Result.ShortDayNames[6] := 'Fre';\r\n    Result.ShortDayNames[7] := 'Sam';\r\n    Result.ShortMonthNames[1] := 'Jan';\r\n    Result.ShortMonthNames[2] := 'Feb';\r\n    Result.ShortMonthNames[3] := 'Mr';\r\n    Result.ShortMonthNames[4] := 'Apr';\r\n    Result.ShortMonthNames[5] := 'Mai';\r\n    Result.ShortMonthNames[6] := 'Jun';\r\n    Result.ShortMonthNames[7] := 'Jul';\r\n    Result.ShortMonthNames[8] := 'Aug';\r\n    Result.ShortMonthNames[9] := 'Sep';\r\n    Result.ShortMonthNames[10] := 'Okt';\r\n    Result.ShortMonthNames[11] := 'Nov';\r\n    Result.ShortMonthNames[12] := 'Dez';\r\n    Result.LongMonthNames[1] := 'Januar';\r\n    Result.LongMonthNames[2] := 'Februar';\r\n    Result.LongMonthNames[3] := 'Mrz';\r\n    Result.LongMonthNames[4] := 'April';\r\n    Result.LongMonthNames[5] := 'Mai';\r\n    Result.LongMonthNames[6] := 'Juni';\r\n    Result.LongMonthNames[7] := 'Juli';\r\n    Result.LongMonthNames[8] := 'August';\r\n    Result.LongMonthNames[9] := 'September';\r\n    Result.LongMonthNames[10] := 'Oktober';\r\n    Result.LongMonthNames[11] := 'November';\r\n    Result.LongMonthNames[12] := 'Dezember';\r\n  end\r\n  else\r\n  if pos('FR-', Uppercase(ALocale)) = 1 then\r\n  begin\r\n    Result.LongDayNames[1] := 'Dimanche';\r\n    Result.LongDayNames[2] := 'Lundi';\r\n    Result.LongDayNames[3] := 'Mardi';\r\n    Result.LongDayNames[4] := 'Mecredi';\r\n    Result.LongDayNames[5] := 'Jeudi';\r\n    Result.LongDayNames[6] := 'Vendredi';\r\n    Result.LongDayNames[7] := 'Samedi';\r\n    Result.ShortDayNames[1] := 'Dim';\r\n    Result.ShortDayNames[2] := 'Lun';\r\n    Result.ShortDayNames[3] := 'Mar';\r\n    Result.ShortDayNames[4] := 'Mer';\r\n    Result.ShortDayNames[5] := 'Jeu';\r\n    Result.ShortDayNames[6] := 'Ven';\r\n    Result.ShortDayNames[7] := 'Sam';\r\n\r\n    Result.ShortMonthNames[1] := 'Jan';\r\n    Result.ShortMonthNames[2] := 'Fv';\r\n    Result.ShortMonthNames[3] := 'Mar';\r\n    Result.ShortMonthNames[4] := 'Avr';\r\n    Result.ShortMonthNames[5] := 'Mai';\r\n    Result.ShortMonthNames[6] := 'Jun';\r\n    Result.ShortMonthNames[7] := 'Jul';\r\n    Result.ShortMonthNames[8] := 'Ao';\r\n    Result.ShortMonthNames[9] := 'Sep';\r\n    Result.ShortMonthNames[10] := 'Oct';\r\n    Result.ShortMonthNames[11] := 'Nov';\r\n    Result.ShortMonthNames[12] := 'Dec';\r\n    Result.LongMonthNames[1] := 'Janvier';\r\n    Result.LongMonthNames[2] := 'Fvrier';\r\n    Result.LongMonthNames[3] := 'Mars';\r\n    Result.LongMonthNames[4] := 'Avril';\r\n    Result.LongMonthNames[5] := 'Mai';\r\n    Result.LongMonthNames[6] := 'Juin';\r\n    Result.LongMonthNames[7] := 'Juillet';\r\n    Result.LongMonthNames[8] := 'Aot';\r\n    Result.LongMonthNames[9] := 'Septembre';\r\n    Result.LongMonthNames[10] := 'Octobre';\r\n    Result.LongMonthNames[11] := 'Novembre';\r\n    Result.LongMonthNames[12] := 'Dcembre';\r\n  end\r\n  else\r\n  if pos('ES-', Uppercase(ALocale)) = 1 then\r\n  begin\r\n    Result.LongDayNames[1] := 'Domingo';\r\n    Result.LongDayNames[2] := 'Lunes';\r\n    Result.LongDayNames[3] := 'Martes';\r\n    Result.LongDayNames[4] := 'Mircoles';\r\n    Result.LongDayNames[5] := 'Jueves';\r\n    Result.LongDayNames[6] := 'Viernes';\r\n    Result.LongDayNames[7] := 'Sbado';\r\n    Result.ShortDayNames[1] := 'Dom';\r\n    Result.ShortDayNames[2] := 'Lun';\r\n    Result.ShortDayNames[3] := 'Mar';\r\n    Result.ShortDayNames[4] := 'Mi';\r\n    Result.ShortDayNames[5] := 'Jue';\r\n    Result.ShortDayNames[6] := 'Vie';\r\n    Result.ShortDayNames[7] := 'Sab';\r\n\r\n    Result.ShortMonthNames[1] := 'Ene';\r\n    Result.ShortMonthNames[2] := 'Feb';\r\n    Result.ShortMonthNames[3] := 'Mar';\r\n    Result.ShortMonthNames[4] := 'Abr';\r\n    Result.ShortMonthNames[5] := 'May';\r\n    Result.ShortMonthNames[6] := 'Jun';\r\n    Result.ShortMonthNames[7] := 'Jul';\r\n    Result.ShortMonthNames[8] := 'Ago';\r\n    Result.ShortMonthNames[9] := 'Sep';\r\n    Result.ShortMonthNames[10] := 'Oct';\r\n    Result.ShortMonthNames[11] := 'Nov';\r\n    Result.ShortMonthNames[12] := 'Dic';\r\n    Result.LongMonthNames[1] := 'January';\r\n    Result.LongMonthNames[2] := 'Febrero';\r\n    Result.LongMonthNames[3] := 'Marzi';\r\n    Result.LongMonthNames[4] := 'Abril';\r\n    Result.LongMonthNames[5] := 'Mayo';\r\n    Result.LongMonthNames[6] := 'Junio';\r\n    Result.LongMonthNames[7] := 'Julio';\r\n    Result.LongMonthNames[8] := 'Agusto';\r\n    Result.LongMonthNames[9] := 'Septiembre';\r\n    Result.LongMonthNames[10] := 'Octubre';\r\n    Result.LongMonthNames[11] := 'Noviembre';\r\n    Result.LongMonthNames[12] := 'Diciembre';\r\n  end\r\n  else\r\n  begin\r\n    Result.LongDayNames[1] := 'Sunday';\r\n    Result.LongDayNames[2] := 'Monday';\r\n    Result.LongDayNames[3] := 'Tuesday';\r\n    Result.LongDayNames[4] := 'Wednesday';\r\n    Result.LongDayNames[5] := 'Thursday';\r\n    Result.LongDayNames[6] := 'Friday';\r\n    Result.LongDayNames[7] := 'Saturday';\r\n    Result.ShortDayNames[1] := 'Sun';\r\n    Result.ShortDayNames[2] := 'Mon';\r\n    Result.ShortDayNames[3] := 'Tue';\r\n    Result.ShortDayNames[4] := 'Wed';\r\n    Result.ShortDayNames[5] := 'Thu';\r\n    Result.ShortDayNames[6] := 'Fri';\r\n    Result.ShortDayNames[7] := 'Sat';\r\n    Result.ShortMonthNames[1] := 'Jan';\r\n    Result.ShortMonthNames[2] := 'Feb';\r\n    Result.ShortMonthNames[3] := 'Mar';\r\n    Result.ShortMonthNames[4] := 'Apr';\r\n    Result.ShortMonthNames[5] := 'May';\r\n    Result.ShortMonthNames[6] := 'Jun';\r\n    Result.ShortMonthNames[7] := 'Jul';\r\n    Result.ShortMonthNames[8] := 'Aug';\r\n    Result.ShortMonthNames[9] := 'Sep';\r\n    Result.ShortMonthNames[10] := 'Oct';\r\n    Result.ShortMonthNames[11] := 'Nov';\r\n    Result.ShortMonthNames[12] := 'Dec';\r\n    Result.LongMonthNames[1] := 'January';\r\n    Result.LongMonthNames[2] := 'February';\r\n    Result.LongMonthNames[3] := 'March';\r\n    Result.LongMonthNames[4] := 'April';\r\n    Result.LongMonthNames[5] := 'May';\r\n    Result.LongMonthNames[6] := 'June';\r\n    Result.LongMonthNames[7] := 'July';\r\n    Result.LongMonthNames[8] := 'August';\r\n    Result.LongMonthNames[9] := 'September';\r\n    Result.LongMonthNames[10] := 'October';\r\n    Result.LongMonthNames[11] := 'November';\r\n    Result.LongMonthNames[12] := 'December';\r\n  end;\r\n\r\n  Result.DateTimeToStrFormat[False] := 'c';\r\n  Result.DateTimeToStrFormat[True] := 'f';\r\n  Result.DateSeparator := '-';\r\n  Result.TimeSeparator := ':';\r\n  Result.ShortDateFormat := 'yyyy-mm-dd';\r\n  Result.LongDateFormat := 'ddd, yyyy-mm-dd';\r\n  Result.DecimalSeparator := '.';\r\n  Result.ThousandSeparator := ',';\r\n  Result.TimeAMString := 'AM';\r\n  Result.TimePMString := 'PM';\r\n  Result.TwoDigitYearCenturyWindow := 50;\r\n\r\n  Result.ShortTimeFormat := GetLocaleShortTimeFormat(ALocale); // 'hh:nn';\r\n  Result.LongTimeFormat := GetLocaleLongTimeFormat(ALocale); // 'hh:nn:ss';\r\n  Result.ShortDateFormat := GetLocaleShortDateFormat(ALocale);\r\n\r\n  for lCount := Low(cDateSeps) to High(cDateSeps) do\r\n  begin\r\n    if Result.ShortDateFormat.IndexOf(cDateSeps[lCount]) >= 0 then\r\n      Result.DateSeparator := cDateSeps[lCount];\r\n  end;\r\n\r\n  asm\r\n    var lEvent = new Date('Jan 1, 1980 06:07:08 GMT+00:00');\r\n    var lLoc = \"\";\r\n    if (ALocale == \"\")\r\n      lLoc = navigator.language;\r\n    else\r\n      lLoc = ALocale;\r\n    lTimeStr = lEvent.toLocaleTimeString(lLoc);\r\n  end;\r\n\r\n  for lCount := Low(cTimeSeps) to High(cTimeSeps) do\r\n  begin\r\n    if lTimeStr.IndexOf(cTimeSeps[lCount]) >= 0 then\r\n      Result.TimeSeparator := cTimeSeps[lCount];\r\n  end;\r\n\r\n  for lCount := Low(Result.ShortDayNames) to High(Result.ShortDayNames) do\r\n    Result.ShortDayNames[lCount] := GetLocaleShortDayName(lCount, ALocale);\r\n  for lCount := Low(Result.LongDayNames) to High(Result.LongDayNames) do\r\n    Result.LongDayNames[lCount] := GetLocaleLongDayName(lCount, ALocale);\r\n\r\n  for lCount := Low(Result.ShortMonthNames) to High(Result.ShortMonthNames) do\r\n    Result.ShortMonthNames[lCount] := GetLocaleShortMonthName(lCount, ALocale);\r\n  for lCount := Low(Result.LongMonthNames) to High(Result.LongMonthNames) do\r\n    Result.LongMonthNames[lCount] := GetLocaleLongMonthName(lCount, ALocale);\r\n\r\n  Result.DecimalSeparator := GetLocaleDecimalSeparator(ALocale);\r\n\r\n  for lCount := Low(cDecSeps) to High(cDecSeps) do\r\n  begin\r\n    if Result.DecimalSeparator = cDecSeps[lCount] then\r\n    begin\r\n      Result.ThousandSeparator := cThousandSeps[lCount];\r\n      Break;\r\n    end;\r\n  end;\r\n\r\n  if Assigned(TFormatSettings.InitLocaleHandler) then\r\n    TFormatSettings.InitLocaleHandler(UpperCase(aLocale),Result);\r\nend;\r\n\r\nclass function TFormatSettings.GetBrowserLocale: string;\r\nasm\r\n  return navigator.language;\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleDecimalSeparator(const ALocale: string): string; assembler;\r\nasm\r\n  var lNumber = 1.1;\r\n  lNumber = lNumber.toLocaleString(ALocale).substring(1, 2);\r\n  return lNumber;\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleLongDayName(const ADayOfWeek: Integer; const ALocale: string): string; assembler;\r\nasm\r\n  var lBaseDate = new Date(2017, 0, 1); // Sunday\r\n  lBaseDate.setDate(lBaseDate.getDate() + ADayOfWeek - 1);\r\n  return lBaseDate.toLocaleDateString(ALocale, { weekday: 'long' });\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleLongMonthName(const AMonth: Integer; const ALocale: string): string; assembler;\r\nasm\r\n  var lBaseDate = new Date(2017, AMonth - 1, 1);\r\n  return lBaseDate.toLocaleDateString(ALocale, { month: 'long' });\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleLongTimeFormat(ALocale: string): string;\r\nbegin\r\n  Result := 'hh:nn:ss';\r\n\r\n  if Uppercase(ALocale) = 'EN-US' then\r\n    Result := 'hh:nn:ss AMPM';\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleShortDateFormat(ALocale: string): string;\r\nconst\r\n  cDeli = '-';\r\n  cShortLength = 2;\r\nvar\r\n  lIndex: Integer;\r\n  res: string;\r\nbegin\r\n  res := string.Empty;\r\n\r\n  ALocale := ALocale.ToLower;\r\n\r\n  lIndex := ALocale.IndexOf(cDeli);\r\n\r\n  if lIndex >= 0 then\r\n    // ensure the first part is lowercase, second part is uppercase\r\n    ALocale := ALocale.SubString(0, lIndex) + ALocale.SubString(lIndex).ToUpper\r\n  else\r\n  begin\r\n    // when the locale is the main locale specifier only without country\r\n    if ALocale.Length = cShortLength then\r\n      ALocale := ALocale + cDeli + ALocale.ToUpper;\r\n  end;\r\n\r\n  asm\r\n    var lFormats = {\r\n      \"ar-SA\" : \"dd/MM/yy\",\r\n      \"bg-BG\" : \"dd.M.yyyy\",\r\n      \"ca-ES\" : \"dd/MM/yyyy\",\r\n      \"zh-TW\" : \"yyyy/M/d\",\r\n      \"cs-CZ\" : \"d.M.yyyy\",\r\n      \"da-DK\" : \"dd-MM-yyyy\",\r\n      \"de-DE\" : \"dd.MM.yyyy\",\r\n      \"el-GR\" : \"d/M/yyyy\",\r\n      \"en-US\" : \"M/d/yyyy\",\r\n      \"fi-FI\" : \"d.M.yyyy\",\r\n      \"fr-FR\" : \"dd/MM/yyyy\",\r\n      \"he-IL\" : \"dd/MM/yyyy\",\r\n      \"hu-HU\" : \"yyyy. MM. dd.\",\r\n      \"is-IS\" : \"d.M.yyyy\",\r\n      \"it-IT\" : \"dd/MM/yyyy\",\r\n      \"ja-JP\" : \"yyyy/MM/dd\",\r\n      \"ko-KR\" : \"yyyy-MM-dd\",\r\n      \"nl-NL\" : \"d-M-yyyy\",\r\n      \"nb-NO\" : \"dd.MM.yyyy\",\r\n      \"pl-PL\" : \"yyyy-MM-dd\",\r\n      \"pt-BR\" : \"d/M/yyyy\",\r\n      \"ro-RO\" : \"dd.MM.yyyy\",\r\n      \"ru-RU\" : \"dd.MM.yyyy\",\r\n      \"hr-HR\" : \"d.M.yyyy\",\r\n      \"sk-SK\" : \"d. M. yyyy\",\r\n      \"sq-AL\" : \"yyyy-MM-dd\",\r\n      \"sv-SE\" : \"yyyy-MM-dd\",\r\n      \"th-TH\" : \"d/M/yyyy\",\r\n      \"tr-TR\" : \"dd.MM.yyyy\",\r\n      \"ur-PK\" : \"dd/MM/yyyy\",\r\n      \"id-ID\" : \"dd/MM/yyyy\",\r\n      \"uk-UA\" : \"dd.MM.yyyy\",\r\n      \"be-BY\" : \"dd.MM.yyyy\",\r\n      \"sl-SI\" : \"d.M.yyyy\",\r\n      \"et-EE\" : \"d.MM.yyyy\",\r\n      \"lv-LV\" : \"yyyy.MM.dd.\",\r\n      \"lt-LT\" : \"yyyy.MM.dd\",\r\n      \"fa-IR\" : \"MM/dd/yyyy\",\r\n      \"vi-VN\" : \"dd/MM/yyyy\",\r\n      \"hy-AM\" : \"dd.MM.yyyy\",\r\n      \"az-Latn-AZ\" : \"dd.MM.yyyy\",\r\n      \"eu-ES\" : \"yyyy/MM/dd\",\r\n      \"mk-MK\" : \"dd.MM.yyyy\",\r\n      \"af-ZA\" : \"yyyy/MM/dd\",\r\n      \"ka-GE\" : \"dd.MM.yyyy\",\r\n      \"fo-FO\" : \"dd-MM-yyyy\",\r\n      \"hi-IN\" : \"dd-MM-yyyy\",\r\n      \"ms-MY\" : \"dd/MM/yyyy\",\r\n      \"kk-KZ\" : \"dd.MM.yyyy\",\r\n      \"ky-KG\" : \"dd.MM.yy\",\r\n      \"sw-KE\" : \"M/d/yyyy\",\r\n      \"uz-Latn-UZ\" : \"dd/MM yyyy\",\r\n      \"tt-RU\" : \"dd.MM.yyyy\",\r\n      \"pa-IN\" : \"dd-MM-yy\",\r\n      \"gu-IN\" : \"dd-MM-yy\",\r\n      \"ta-IN\" : \"dd-MM-yyyy\",\r\n      \"te-IN\" : \"dd-MM-yy\",\r\n      \"kn-IN\" : \"dd-MM-yy\",\r\n      \"mr-IN\" : \"dd-MM-yyyy\",\r\n      \"sa-IN\" : \"dd-MM-yyyy\",\r\n      \"mn-MN\" : \"yy.MM.dd\",\r\n      \"gl-ES\" : \"dd/MM/yy\",\r\n      \"kok-IN\" : \"dd-MM-yyyy\",\r\n      \"syr-SY\" : \"dd/MM/yyyy\",\r\n      \"dv-MV\" : \"dd/MM/yy\",\r\n      \"ar-IQ\" : \"dd/MM/yyyy\",\r\n      \"zh-CN\" : \"yyyy/M/d\",\r\n      \"de-CH\" : \"dd.MM.yyyy\",\r\n      \"en-GB\" : \"dd/MM/yyyy\",\r\n      \"es-MX\" : \"dd/MM/yyyy\",\r\n      \"fr-BE\" : \"d/MM/yyyy\",\r\n      \"it-CH\" : \"dd.MM.yyyy\",\r\n      \"nl-BE\" : \"d/MM/yyyy\",\r\n      \"nn-NO\" : \"dd.MM.yyyy\",\r\n      \"pt-PT\" : \"dd-MM-yyyy\",\r\n      \"sr-Latn-CS\" : \"d.M.yyyy\",\r\n      \"sv-FI\" : \"d.M.yyyy\",\r\n      \"az-Cyrl-AZ\" : \"dd.MM.yyyy\",\r\n      \"ms-BN\" : \"dd/MM/yyyy\",\r\n      \"uz-Cyrl-UZ\" : \"dd.MM.yyyy\",\r\n      \"ar-EG\" : \"dd/MM/yyyy\",\r\n      \"zh-HK\" : \"d/M/yyyy\",\r\n      \"de-AT\" : \"dd.MM.yyyy\",\r\n      \"en-AU\" : \"d/MM/yyyy\",\r\n      \"es-ES\" : \"dd/MM/yyyy\",\r\n      \"fr-CA\" : \"yyyy-MM-dd\",\r\n      \"sr-Cyrl-CS\" : \"d.M.yyyy\",\r\n      \"ar-LY\" : \"dd/MM/yyyy\",\r\n      \"zh-SG\" : \"d/M/yyyy\",\r\n      \"de-LU\" : \"dd.MM.yyyy\",\r\n      \"en-CA\" : \"dd/MM/yyyy\",\r\n      \"es-GT\" : \"dd/MM/yyyy\",\r\n      \"fr-CH\" : \"dd.MM.yyyy\",\r\n      \"ar-DZ\" : \"dd-MM-yyyy\",\r\n      \"zh-MO\" : \"d/M/yyyy\",\r\n      \"de-LI\" : \"dd.MM.yyyy\",\r\n      \"en-NZ\" : \"d/MM/yyyy\",\r\n      \"es-CR\" : \"dd/MM/yyyy\",\r\n      \"fr-LU\" : \"dd/MM/yyyy\",\r\n      \"ar-MA\" : \"dd-MM-yyyy\",\r\n      \"en-IE\" : \"dd/MM/yyyy\",\r\n      \"es-PA\" : \"MM/dd/yyyy\",\r\n      \"fr-MC\" : \"dd/MM/yyyy\",\r\n      \"ar-TN\" : \"dd-MM-yyyy\",\r\n      \"en-ZA\" : \"yyyy/MM/dd\",\r\n      \"es-DO\" : \"dd/MM/yyyy\",\r\n      \"ar-OM\" : \"dd/MM/yyyy\",\r\n      \"en-JM\" : \"dd/MM/yyyy\",\r\n      \"es-VE\" : \"dd/MM/yyyy\",\r\n      \"ar-YE\" : \"dd/MM/yyyy\",\r\n      \"en-029\" : \"MM/dd/yyyy\",\r\n      \"es-CO\" : \"dd/MM/yyyy\",\r\n      \"ar-SY\" : \"dd/MM/yyyy\",\r\n      \"en-BZ\" : \"dd/MM/yyyy\",\r\n      \"es-PE\" : \"dd/MM/yyyy\",\r\n      \"ar-JO\" : \"dd/MM/yyyy\",\r\n      \"en-TT\" : \"dd/MM/yyyy\",\r\n      \"es-AR\" : \"dd/MM/yyyy\",\r\n      \"ar-LB\" : \"dd/MM/yyyy\",\r\n      \"en-ZW\" : \"M/d/yyyy\",\r\n      \"es-EC\" : \"dd/MM/yyyy\",\r\n      \"ar-KW\" : \"dd/MM/yyyy\",\r\n      \"en-PH\" : \"M/d/yyyy\",\r\n      \"es-CL\" : \"dd-MM-yyyy\",\r\n      \"ar-AE\" : \"dd/MM/yyyy\",\r\n      \"es-UY\" : \"dd/MM/yyyy\",\r\n      \"ar-BH\" : \"dd/MM/yyyy\",\r\n      \"es-PY\" : \"dd/MM/yyyy\",\r\n      \"ar-QA\" : \"dd/MM/yyyy\",\r\n      \"es-BO\" : \"dd/MM/yyyy\",\r\n      \"es-SV\" : \"dd/MM/yyyy\",\r\n      \"es-HN\" : \"dd/MM/yyyy\",\r\n      \"es-NI\" : \"dd/MM/yyyy\",\r\n      \"es-PR\" : \"dd/MM/yyyy\",\r\n      \"am-ET\" : \"d/M/yyyy\",\r\n      \"tzm-Latn-DZ\" : \"dd-MM-yyyy\",\r\n      \"iu-Latn-CA\" : \"d/MM/yyyy\",\r\n      \"sma-NO\" : \"dd.MM.yyyy\",\r\n      \"mn-Mong-CN\" : \"yyyy/M/d\",\r\n      \"gd-GB\" : \"dd/MM/yyyy\",\r\n      \"en-MY\" : \"d/M/yyyy\",\r\n      \"prs-AF\" : \"dd/MM/yy\",\r\n      \"bn-BD\" : \"dd-MM-yy\",\r\n      \"wo-SN\" : \"dd/MM/yyyy\",\r\n      \"rw-RW\" : \"M/d/yyyy\",\r\n      \"qut-GT\" : \"dd/MM/yyyy\",\r\n      \"sah-RU\" : \"MM.dd.yyyy\",\r\n      \"gsw-FR\" : \"dd/MM/yyyy\",\r\n      \"co-FR\" : \"dd/MM/yyyy\",\r\n      \"oc-FR\" : \"dd/MM/yyyy\",\r\n      \"mi-NZ\" : \"dd/MM/yyyy\",\r\n      \"ga-IE\" : \"dd/MM/yyyy\",\r\n      \"se-SE\" : \"yyyy-MM-dd\",\r\n      \"br-FR\" : \"dd/MM/yyyy\",\r\n      \"smn-FI\" : \"d.M.yyyy\",\r\n      \"moh-CA\" : \"M/d/yyyy\",\r\n      \"arn-CL\" : \"dd-MM-yyyy\",\r\n      \"ii-CN\" : \"yyyy/M/d\",\r\n      \"dsb-DE\" : \"d. M. yyyy\",\r\n      \"ig-NG\" : \"d/M/yyyy\",\r\n      \"kl-GL\" : \"dd-MM-yyyy\",\r\n      \"lb-LU\" : \"dd/MM/yyyy\",\r\n      \"ba-RU\" : \"dd.MM.yy\",\r\n      \"nso-ZA\" : \"yyyy/MM/dd\",\r\n      \"quz-BO\" : \"dd/MM/yyyy\",\r\n      \"yo-NG\" : \"d/M/yyyy\",\r\n      \"ha-Latn-NG\" : \"d/M/yyyy\",\r\n      \"fil-PH\" : \"M/d/yyyy\",\r\n      \"ps-AF\" : \"dd/MM/yy\",\r\n      \"fy-NL\" : \"d-M-yyyy\",\r\n      \"ne-NP\" : \"M/d/yyyy\",\r\n      \"se-NO\" : \"dd.MM.yyyy\",\r\n      \"iu-Cans-CA\" : \"d/M/yyyy\",\r\n      \"sr-Latn-RS\" : \"d.M.yyyy\",\r\n      \"si-LK\" : \"yyyy-MM-dd\",\r\n      \"sr-Cyrl-RS\" : \"d.M.yyyy\",\r\n      \"lo-LA\" : \"dd/MM/yyyy\",\r\n      \"km-KH\" : \"yyyy-MM-dd\",\r\n      \"cy-GB\" : \"dd/MM/yyyy\",\r\n      \"bo-CN\" : \"yyyy/M/d\",\r\n      \"sms-FI\" : \"d.M.yyyy\",\r\n      \"as-IN\" : \"dd-MM-yyyy\",\r\n      \"ml-IN\" : \"dd-MM-yy\",\r\n      \"en-IN\" : \"dd-MM-yyyy\",\r\n      \"or-IN\" : \"dd-MM-yy\",\r\n      \"bn-IN\" : \"dd-MM-yy\",\r\n      \"tk-TM\" : \"dd.MM.yy\",\r\n      \"bs-Latn-BA\" : \"d.M.yyyy\",\r\n      \"mt-MT\" : \"dd/MM/yyyy\",\r\n      \"sr-Cyrl-ME\" : \"d.M.yyyy\",\r\n      \"se-FI\" : \"d.M.yyyy\",\r\n      \"zu-ZA\" : \"yyyy/MM/dd\",\r\n      \"xh-ZA\" : \"yyyy/MM/dd\",\r\n      \"tn-ZA\" : \"yyyy/MM/dd\",\r\n      \"hsb-DE\" : \"d. M. yyyy\",\r\n      \"bs-Cyrl-BA\" : \"d.M.yyyy\",\r\n      \"tg-Cyrl-TJ\" : \"dd.MM.yy\",\r\n      \"sr-Latn-BA\" : \"d.M.yyyy\",\r\n      \"smj-NO\" : \"dd.MM.yyyy\",\r\n      \"rm-CH\" : \"dd/MM/yyyy\",\r\n      \"smj-SE\" : \"yyyy-MM-dd\",\r\n      \"quz-EC\" : \"dd/MM/yyyy\",\r\n      \"quz-PE\" : \"dd/MM/yyyy\",\r\n      \"hr-BA\" : \"d.M.yyyy.\",\r\n      \"sr-Latn-ME\" : \"d.M.yyyy\",\r\n      \"sma-SE\" : \"yyyy-MM-dd\",\r\n      \"en-SG\" : \"d/M/yyyy\",\r\n      \"ug-CN\" : \"yyyy-M-d\",\r\n      \"sr-Cyrl-BA\" : \"d.M.yyyy\",\r\n      \"es-US\" : \"M/d/yyyy\"};\r\n    res = lFormats[ALocale] || 'dd/MM/yyyy';\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleShortDayName(const ADayOfWeek: Integer; const ALocale: string): string; assembler;\r\nasm\r\n  var lBaseDate = new Date(2017, 0, 1); // Sunday\r\n  lBaseDate.setDate(lBaseDate.getDate() + ADayOfWeek - 1);\r\n\r\n  var lLoc = \"\";\r\n  if (ALocale == '')\r\n    lLoc = navigator.language\r\n  else\r\n    lLoc = ALocale;\r\n\r\n  return lBaseDate.toLocaleDateString(lLoc, { weekday: 'short' });\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleShortMonthName(const AMonth: Integer; const ALocale: string): string; assembler;\r\nasm\r\n  var lBaseDate = new Date(2017, AMonth - 1, 1);\r\n  var lLoc = \"\";\r\n  if (ALocale == '')\r\n    lLoc = navigator.language\r\n  else\r\n    lLoc = ALocale;\r\n  return lBaseDate.toLocaleDateString(lLoc, { month: 'short' });\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleShortTimeFormat(\r\n  ALocale: string): string;\r\nbegin\r\n  Result := 'hh:nn';\r\n\r\n  if Uppercase(ALocale) = 'EN-US' then\r\n    Result := 'h:nn AMPM';\r\nend;\r\n\r\nclass function TFormatSettings.Invariant: TFormatSettings;\r\nbegin\r\n  if not FInvariantCreated then\r\n  begin\r\n    FInvariant := Create('EN-US');\r\n    FInvariant.CurrencyString := #$00A4;\r\n    FInvariant.CurrencyFormat := 0;\r\n    FInvariant.CurrencyDecimals := 2;\r\n    FInvariant.DateSeparator := '/';\r\n    FInvariant.TimeSeparator := ':';\r\n    FInvariant.ShortDateFormat := 'MM/dd/yyyy';\r\n    FInvariant.LongDateFormat := 'dddd, dd MMMMM yyyy HH:mm:ss';\r\n    FInvariant.TimeAMString := 'AM';\r\n    FInvariant.TimePMString := 'PM';\r\n    FInvariant.ShortTimeFormat := 'HH:mm';\r\n    FInvariant.LongTimeFormat := 'HH:mm:ss';\r\n    FInvariant.ShortMonthNames := DefaultShortMonthNames;\r\n    FInvariant.LongMonthNames := DefaultLongMonthNames;\r\n    FInvariant.ShortDayNames := DefaultShortDayNames;\r\n    FInvariant.LongDayNames := DefaultLongDayNames;\r\n    FInvariant.ThousandSeparator := ',';\r\n    FInvariant.DecimalSeparator := '.';\r\n    FInvariant.TwoDigitYearCenturyWindow := 50;\r\n    FInvariant.NegCurrFormat := 0;\r\n    FInvariantCreated := True;\r\n  end;\r\n  Result := FInvariant;\r\nend;\r\n\r\nclass constructor TFormatSettings.Init;\r\nbegin\r\n  InitGlobalFormatSettings;\r\nend;\r\n\r\nclass function TFormatSettings.GetJSLocale: string; assembler;\r\nasm\r\n  return Intl.DateTimeFormat().resolvedOptions().locale\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  FileNames\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction ChangeFileExt(const FileName, Extension: PathStr): PathStr;\r\nvar\r\n  i : longint;\r\n  EndSep : Set of Char;\r\n  SOF : Boolean;\r\n\r\nbegin\r\n  i := Length(FileName);\r\n  EndSep:=AllowDirectorySeparators+AllowDriveSeparators+[ExtensionSeparator];\r\n  while (I > 0) and not(FileName[I] in EndSep) do\r\n    Dec(I);\r\n  if (I = 0) or (FileName[I] <> ExtensionSeparator) then\r\n    I := Length(FileName)+1\r\n  else\r\n    begin\r\n        SOF:=(I=1) or (FileName[i-1] in AllowDirectorySeparators);\r\n        if (SOF) and not FirstDotAtFileNameStartIsExtension then\r\n          I:=Length(FileName)+1;\r\n        end;\r\n  Result := Copy(FileName, 1, I - 1) + Extension;\r\nend;\r\n\r\nfunction ExtractFilePath(const FileName: PathStr): PathStr;\r\nvar\r\n  i : longint;\r\n  EndSep : Set of Char;\r\nbegin\r\n  i := Length(FileName);\r\n  EndSep:=AllowDirectorySeparators+AllowDriveSeparators;\r\n  while (i > 0) and not CharInSet(FileName[i],EndSep) do\r\n    Dec(i);\r\n  If I>0 then\r\n    Result := Copy(FileName, 1, i)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nfunction ExtractFileDir(const FileName: PathStr): PathStr;\r\nvar\r\n  i : longint;\r\n  EndSep : Set of Char;\r\nbegin\r\n  I := Length(FileName);\r\n  EndSep:=AllowDirectorySeparators+AllowDriveSeparators;\r\n  while (I > 0) and not CharInSet(FileName[I],EndSep) do\r\n    Dec(I);\r\n  if (I > 1) and CharInSet(FileName[I],AllowDirectorySeparators) and\r\n     not CharInSet(FileName[I - 1],EndSep) then\r\n    Dec(I);\r\n  Result := Copy(FileName, 1, I);\r\nend;\r\n\r\nfunction ExtractFileDrive(const FileName: PathStr): PathStr;\r\nvar\r\n  i,l: longint;\r\nbegin\r\n  Result := '';\r\n  l:=Length(FileName);\r\n  if (l<2) then\r\n    exit;\r\n  If CharInSet(FileName[2],AllowDriveSeparators) then\r\n    result:=Copy(FileName,1,2)\r\n  else if CharInSet(FileName[1],AllowDirectorySeparators) and\r\n          CharInSet(FileName[2],AllowDirectorySeparators) then\r\n    begin\r\n      i := 2;\r\n\r\n      { skip share }\r\n      While (i<l) and Not CharInSet(Filename[i+1],AllowDirectorySeparators) do\r\n        inc(i);\r\n      inc(i);\r\n\r\n      While (i<l) and Not CharInSet(Filename[i+1],AllowDirectorySeparators) do\r\n        inc(i);\r\n      Result:=Copy(FileName,1,i);\r\n    end;\r\nend;\r\n\r\nfunction ExtractFileName(const FileName: PathStr): PathStr;\r\nvar\r\n  i : longint;\r\n  EndSep : Set of Char;\r\nbegin\r\n  I := Length(FileName);\r\n  EndSep:=AllowDirectorySeparators+AllowDriveSeparators;\r\n  while (I > 0) and not CharInSet(FileName[I],EndSep) do\r\n    Dec(I);\r\n  Result := Copy(FileName, I + 1, MaxInt);\r\nend;\r\n\r\nfunction ExtractFileExt(const FileName: PathStr): PathStr;\r\nvar\r\n  i : longint;\r\n  EndSep : Set of Char;\r\n  SOF : Boolean; // Dot at Start of filename ?\r\n\r\nbegin\r\n  Result:='';\r\n  I := Length(FileName);\r\n  EndSep:=AllowDirectorySeparators+AllowDriveSeparators+[ExtensionSeparator];\r\n  while (I > 0) and not CharInSet(FileName[I],EndSep) do\r\n    Dec(I);\r\n  if (I > 0) and (FileName[I] = ExtensionSeparator) then\r\n    begin\r\n        SOF:=(I=1) or (FileName[i-1] in AllowDirectorySeparators);\r\n        if (Not SOF) or FirstDotAtFileNameStartIsExtension then\r\n          Result := Copy(FileName, I, MaxInt);\r\n        end\r\n  else\r\n    Result := '';\r\nend;\r\n\r\nfunction ExtractRelativepath(const BaseName, DestName: PathStr): PathStr;\r\n\r\nVar\r\n  OneLevelBack,Source, Dest   : PathStr;\r\n  Sc,Dc,I,J      : Longint;\r\n  SD,DD          : TPathStrArray;\r\n\r\n\r\nbegin\r\n  OneLevelBack := '..'+PathDelim;\r\n  If Uppercase(ExtractFileDrive(BaseName))<>Uppercase(ExtractFileDrive(DestName)) Then\r\n    begin\r\n    Result:=DestName;\r\n    exit;\r\n    end;\r\n  Source:=ExcludeTrailingPathDelimiter(ExtractFilePath(BaseName));\r\n  Dest:=ExcludeTrailingPathDelimiter(ExtractFilePath(DestName));\r\n  SD:=GetDirs (Source);\r\n  SC:=Length(SD);\r\n  DD:=GetDirs (Dest);\r\n  DC:=Length(SD);\r\n  I:=0;\r\n  While (I<DC) and (I<SC) do\r\n    begin\r\n    If SameText(DD[i],SD[i]) then\r\n      Inc(i)\r\n    else\r\n      Break;\r\n    end;\r\n  Result:='';\r\n  For J:=I to SC do Result:=Result+OneLevelBack;\r\n  For J:=I to DC do Result:=Result+DD[J]+PathDelim;\r\n  Result:=Result+ExtractFileName(DestName);\r\nend;\r\n\r\nfunction SetDirSeparators(const FileName: PathStr): PathStr;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  Result:=FileName;\r\n  For I:=1 to Length(Result) do\r\n    If CharInSet(Result[I],AllowDirectorySeparators) then\r\n      Result[i]:=PathDelim;\r\nend;\r\n\r\nfunction GetDirs(DirName: PathStr): TPathStrArray;\r\n\r\nVar\r\n  I,J,L : Longint;\r\n  D : String;\r\n\r\nbegin\r\n  I:=1;\r\n  J:=0;\r\n  L:=0;\r\n  SetLength(Result,Length(DirName));\r\n  While I<=Length(DirName) do\r\n    begin\r\n    If CharInSet(DirName[i],AllowDirectorySeparators) then\r\n      begin\r\n      D:=Copy(DirName,J+1,J-I);\r\n      if (D<>'') then\r\n        begin\r\n        Result[L]:=D;\r\n        Inc(L);\r\n        end;\r\n      J:=I;\r\n      end;\r\n    Inc(I);\r\n    end;\r\n  SetLength(Result,L);\r\nend;\r\n\r\nfunction IncludeTrailingPathDelimiter(const Path: PathStr): PathStr;\r\n\r\nVar\r\n  l : Integer;\r\n\r\nbegin\r\n  Result:=Path;\r\n  l:=Length(Result);\r\n  If (L=0) or not CharInSet(Result[l],AllowDirectorySeparators) then\r\n    Result:=Result+PathDelim;\r\nend;\r\n\r\nfunction ExcludeTrailingPathDelimiter(const Path: PathStr): PathStr;\r\n\r\nVar\r\n  L : Integer;\r\n\r\nbegin\r\n  L:=Length(Path);\r\n  If (L>0) and CharInSet(Path[L],AllowDirectorySeparators) then\r\n    Dec(L);\r\n  Result:=Copy(Path,1,L);\r\nend;\r\n\r\nfunction IncludeLeadingPathDelimiter(const Path: PathStr): PathStr;\r\n\r\nVar\r\n  l : Integer;\r\n\r\nbegin\r\n  Result:=Path;\r\n  l:=Length(Result);\r\n  If (L=0) or not CharInSet(Result[1],AllowDirectorySeparators) then\r\n    Result:=PathDelim+Result;\r\nend;\r\n\r\nfunction ExcludeLeadingPathDelimiter(const Path: PathStr): PathStr;\r\n\r\nVar\r\n  L : Integer;\r\n\r\nbegin\r\n  Result:=Path;\r\n  L:=Length(Result);\r\n  If (L>0) and CharInSet(Result[1],AllowDirectorySeparators) then\r\n    Delete(Result,1,1);\r\nend;\r\n\r\nfunction IsPathDelimiter(const Path: PathStr; Index: Integer): Boolean;\r\n\r\nbegin\r\n  Result:=(Index>0) and (Index<=Length(Path)) and CharInSet(Path[Index],AllowDirectorySeparators);\r\nend;\r\n\r\nfunction ConcatPaths(const Paths: array of PathStr): PathStr;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if Length(Paths) > 0 then\r\n  begin\r\n    Result := Paths[0];\r\n    for I := 1 to Length(Paths) - 1 do\r\n      Result := IncludeTrailingPathDelimiter(Result) + ExcludeLeadingPathDelimiter(Paths[I]);\r\n  end else\r\n    Result := '';\r\nend;\r\n\r\nFunction EncodeHTMLEntities (S : String) : String;\r\n\r\nbegin\r\n  Result:='';\r\n  if S='' then exit;\r\n  asm\r\n   return S.replace(/[\\u00A0-\\u9999<>\\&]/gim, function(i) {\r\n     return '&#'+i.charCodeAt(0)+';';\r\n   });\r\n  end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Type helpers implementation\r\n  ---------------------------------------------------------------------}\r\n\r\n{ ---------------------------------------------------------------------\r\n  TGUIDHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nProcedure NotImplemented(S : String);\r\n\r\nbegin\r\n  Raise Exception.Create('Not yet implemented : '+S);\r\nend;\r\n\r\nclass function TGuidHelper.Create(Src: TGUID; BigEndian: Boolean): TGUID;\r\nbegin\r\n  Result:=Src;\r\n  if Not Bigendian then\r\n    begin\r\n    Result.D1:=SwapEndian(Result.D1);\r\n    Result.D2:=SwapEndian(Result.D2);\r\n    Result.D3:=SwapEndian(Result.D3);\r\n    end;\r\nend;\r\n\r\nclass function TGuidHelper.Create(const Buf: TJSArrayBuffer; AStartIndex: Cardinal; BigEndian: Boolean): TGUID;\r\n\r\nVar\r\n  A : Cardinal;\r\n  B,C : Word;\r\n  V : TJSDataView;\r\n\r\nbegin\r\n  V:=TJSDataView.New(Buf);\r\n  // The get functions return by default correct endianness.\r\n  if BigEndian then\r\n    begin\r\n    A:=V.getUint32(aStartIndex);\r\n    B:=V.getUint16(AStartIndex+4);\r\n    C:=V.getUint16(AStartIndex+6);\r\n    end\r\n  else\r\n    begin\r\n    A:=SwapEndian(V.getUint32(aStartIndex));\r\n    B:=SwapEndian(V.getUint16(AStartIndex+4));\r\n    C:=SwapEndian(V.getUint16(AStartIndex+6));\r\n    end;\r\n  Result:=Create(A,B,C,V.GetUint8(AStartIndex+8),V.GetUint8(AStartIndex+9),V.GetUint8(AStartIndex+10),V.GetUint8(AStartIndex+11),V.GetUint8(AStartIndex+12),V.GetUint8(AStartIndex+13),V.GetUint8(AStartIndex+14),V.GetUint8(AStartIndex+15));\r\nend;\r\n\r\n\r\nclass function TGuidHelper.Create(const Data: array of Byte; AStartIndex: Cardinal; BigEndian: Boolean): TGUID;\r\n\r\nVar\r\n  D : TJSUint8Array;\r\n\r\nbegin\r\n  if ((System.Length(Data)-AStartIndex)<16) then\r\n    raise EArgumentException.CreateFmt('The length of a GUID array must be at least %d',[]);\r\n  D:=TJSUint8Array.From(Data);\r\n  Result:=Create(D.buffer,aStartIndex,BigEndian);\r\nend;\r\n\r\n\r\nclass function TGuidHelper.Create(const B: TBytes; DataEndian: TEndian): TGUID;\r\n\r\nbegin\r\n  Result:=Create(B,0,DataEndian);\r\nend;\r\n\r\nclass function TGuidHelper.Create(const B: TBytes; AStartIndex: Cardinal; DataEndian: TEndian): TGUID;\r\n\r\nbegin\r\n  if ((System.Length(B)-AStartIndex)<16) then\r\n    raise EArgumentException.CreateFmt('The length of a GUID array must be at least %d',[]);\r\n  Result:=Create(B,AStartIndex,DataEndian=TEndian.Big);\r\nend;\r\n\r\nclass function TGuidHelper.Create(const S: string): TGUID;\r\n\r\nbegin\r\n  Result:=StringToGUID(S);\r\nend;\r\n\r\nclass function TGuidHelper.Create(A: Integer; B: SmallInt; C: SmallInt; const D: TBytes): TGUID;\r\n\r\nbegin\r\n  if (System.Length(D)<>8) then\r\n    raise EArgumentException.CreateFmt('The length of a GUID array must be %d',[]);\r\n  Result:=Create(Cardinal(A),Word(B),Word(C),D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7]);\r\nend;\r\n\r\n(*\r\nclass function TGuidHelper.Create(A: Integer; B: SmallInt; C: SmallInt; D, E, F, G, H, I, J, K: Byte): TGUID;\r\n\r\nbegin\r\n  Result:=Create(Cardinal(A),Word(B),Word(C),D,E,F,G,H,I,J,K);\r\nend;\r\n*)\r\nclass function TGuidHelper.Create(A: Cardinal; B: Word; C: Word; D, E, F, G, H, I, J, K: Byte): TGUID;\r\n\r\nbegin\r\n  Result.D1 := Cardinal(A);\r\n  Result.D2 := Word(B);\r\n  Result.D3 := Word(C);\r\n  Result.D4[0] := D;\r\n  Result.D4[1] := E;\r\n  Result.D4[2] := F;\r\n  Result.D4[3] := G;\r\n  Result.D4[4] := H;\r\n  Result.D4[5] := I;\r\n  Result.D4[6] := J;\r\n  Result.D4[7] := K;\r\nend;\r\n\r\nclass function TGuidHelper.NewGuid: TGUID;\r\n\r\nbegin\r\n  CreateGUID(Result)\r\nend;\r\n\r\nfunction TGuidHelper.ToByteArray(DataEndian: TEndian): TBytes;\r\n\r\nVar\r\n  D : TJSUint8Array;\r\n  V : TJSDataView;\r\n  I : Integer;\r\n\r\nbegin\r\n  D:=TJSUint8array.New(16);\r\n  V:=TJSDataView.New(D.buffer);\r\n  V.setUint32(0,D1,DataEndian=TEndian.Little);\r\n  V.setUint16(4,D2,DataEndian=TEndian.Little);\r\n  V.setUint16(6,D3,DataEndian=TEndian.Little);\r\n  for I:=0 to 7 do\r\n    V.setUint8(8+I,D4[i]);\r\n  SetLength(Result, 16);\r\n  for I:=0 to 15 do\r\n    Result[i]:=V.getUint8(I);\r\nend;\r\n\r\nfunction TGuidHelper.ToString(SkipBrackets: Boolean): string;\r\n\r\nbegin\r\n  Result:=GuidToString(Self);\r\n  If SkipBrackets then\r\n    Result:=Copy(Result,2,Length(Result)-2);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TStringHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction HaveChar(AChar : Char; const AList: array of Char) : Boolean;\r\n\r\nVar\r\n  I : SizeInt;\r\n\r\nbegin\r\n  I:=0;\r\n  Result:=False;\r\n  While (Not Result) and (I<Length(AList)) do\r\n    begin\r\n    Result:=(AList[i]=AChar);\r\n    Inc(I);\r\n    end;\r\nend;\r\n\r\nfunction TStringHelper.GetChar(AIndex: SizeInt): Char;\r\nbegin\r\n  Result:=Self[AIndex+1];\r\nend;\r\n\r\n\r\nfunction TStringHelper.GetLength: SizeInt;\r\n\r\nbegin\r\n  Result:=System.Length(Self);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Compare(const A: string; const B: string): Integer;\r\nbegin\r\n  Result:=Compare(A,0,B,0,System.Length(B),[]);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Compare(const A: string; const B: string;\r\n  IgnoreCase: Boolean): Integer; //deprecated 'Use same with TCompareOptions';\r\nbegin\r\n  if IgnoreCase then\r\n    Result:=Compare(A,B,[coIgnoreCase])\r\n  else\r\n    Result:=Compare(A,B,[]);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Compare(const A: string; const B: string;\r\n  Options: TCompareOptions): Integer;\r\nbegin\r\n  Result:=Compare(A,0,B,0,System.Length(B),Options);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Compare(const A: string; IndexA: SizeInt;\r\n  const B: string; IndexB: SizeInt; ALen: SizeInt): Integer;\r\nbegin\r\n  Result:=Compare(A,IndexA,B,IndexB,ALen,[]);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Compare(const A: string; IndexA: SizeInt;\r\n  const B: string; IndexB: SizeInt; ALen: SizeInt; IgnoreCase: Boolean\r\n  ): Integer; //deprecated 'Use same with TCompareOptions';\r\nbegin\r\n  if IgnoreCase then\r\n    Result:=Compare(A,IndexA,B,IndexB,ALen,[coIgnoreCase])\r\n  else\r\n    Result:=Compare(A,IndexA,B,IndexB,ALen,[])\r\nend;\r\n\r\n\r\nclass function TStringHelper.Compare(const A: string; IndexA: SizeInt;\r\n  const B: string; IndexB: SizeInt; ALen: SizeInt; Options: TCompareOptions\r\n  ): Integer;\r\n\r\nVar\r\n  AL,BL : String;\r\n\r\nbegin\r\n  AL:=System.Copy(A,IndexA+1,aLen);\r\n  BL:=System.Copy(B,IndexB+1,aLen);\r\n  if (coIgnoreCase in Options) then\r\n    Result:=TJSString(UpperCase(AL)).localeCompare(UpperCase(BL))\r\n  else\r\n    Result:=TJSString(AL).localeCompare(BL)\r\nend;\r\n\r\n\r\nclass function TStringHelper.CompareOrdinal(const A: string; const B: string\r\n  ): Integer;\r\n\r\nVar\r\n  L : SizeInt;\r\n\r\nbegin\r\n  L:=System.Length(B);\r\n  if L>System.Length(A) then\r\n    L:=System.Length(A);\r\n  Result:=CompareOrdinal(A,0,B,0,L);\r\nend;\r\n\r\n\r\nclass function TStringHelper.CompareOrdinal(const A: string; IndexA: SizeInt;\r\n  const B: string; IndexB: SizeInt; ALen: SizeInt): Integer;\r\n\r\nVar\r\n  I,M : integer;\r\n\r\nbegin\r\n  M:=System.Length(A)-IndexA;\r\n  If M>(System.Length(B)-IndexB) then\r\n    M:=(System.Length(B)-IndexB);\r\n  if M>aLen then\r\n    M:=aLen;\r\n  I:=0;\r\n  Result:=0;\r\n  While (Result=0) and (I<M) do\r\n    begin\r\n    Result:=TJSString(A).charCodeAt(IndexA+I)-TJSString(B).charCodeAt(IndexB+I);\r\n    Inc(I);\r\n    end;\r\nend;\r\n\r\n\r\nclass function TStringHelper.CompareText(const A: string; const B: string\r\n  ): Integer;\r\nbegin\r\n  Result:=SysUtils.CompareText(A,B);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Copy(const Str: string): string;\r\nbegin\r\n  Result:=Str;\r\nend;\r\n\r\n\r\nclass function TStringHelper.Create(AChar: Char; ACount: SizeInt): string;\r\nbegin\r\n   Result:=StringOfChar(AChar,ACount);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Create(const AValue: array of Char): string;\r\n\r\nbegin\r\n  Result:=Create(AValue,0,System.Length(AValue));\r\nend;\r\n\r\n\r\nclass function TStringHelper.Create(const AValue: array of Char;\r\n  StartIndex: SizeInt; ALen: SizeInt): string;\r\nVar\r\n  I : Integer;\r\nbegin\r\n  SetLength(Result,ALen);\r\n  For I:=1 to ALen do\r\n    Result[I]:=AValue[StartIndex+I-1];\r\nend;\r\n\r\n\r\nclass function TStringHelper.EndsText(const ASubText, AText: string): Boolean;\r\nbegin\r\n  Result:=(ASubText<>'') and (SysUtils.CompareText(System.Copy(AText,System.Length(AText)-System.Length(ASubText)+1,System.Length(ASubText)),ASubText)=0);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Equals(const a: string; const b: string): Boolean;\r\nbegin\r\n  Result:=A=B;\r\nend;\r\n\r\n\r\nclass function TStringHelper.Format(const AFormat: string; const args: array of const): string;\r\nbegin\r\n  Result:=SysUtils.Format(AFormat,Args);\r\nend;\r\n\r\n\r\nclass function TStringHelper.IsNullOrEmpty(const AValue: string): Boolean;\r\nbegin\r\n  Result:=system.Length(AValue)=0;\r\nend;\r\n\r\n\r\nclass function TStringHelper.IsNullOrWhiteSpace(const AValue: string): Boolean;\r\nbegin\r\n  Result:=system.Length(SysUtils.Trim(AValue))=0;\r\nend;\r\n\r\n\r\nclass function TStringHelper.Join(const Separator: string; const Values: array of const): string;\r\n\r\nbegin\r\n  Result:=TJSArray(Values).Join(Separator);\r\nend;\r\n\r\nclass function TStringHelper.Join(const Separator: string;\r\n  const Values: array of string): string;\r\nbegin\r\n  Result:=TJSArray(Values).Join(Separator);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Join(const Separator: string;\r\n  const Values: array of string; StartIndex: SizeInt; ACount: SizeInt): string;\r\n\r\nVar\r\n  VLen : SizeInt;\r\n\r\nbegin\r\n  VLen:=High(Values);\r\n  If (ACount<0) or ((StartIndex>0) and (StartIndex>VLen)) then\r\n    raise ERangeError.Create(SRangeError);\r\n  If (ACount=0) or (VLen<0) then\r\n    Result:=''\r\n  else\r\n    Result:=TJSArray(Values).Slice(StartIndex,StartIndex+aCount).Join(Separator);\r\nend;\r\n\r\n\r\nclass function TStringHelper.LowerCase(const S: string): string;\r\nbegin\r\n  Result:=SysUtils.Lowercase(S);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Parse(const AValue: Boolean): string;\r\nbegin\r\n  Result:=BoolToStr(AValue);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Parse(const AValue: Extended): string;\r\nbegin\r\n  Result:=FloatToStr(AValue);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Parse(const AValue: NativeInt): string;\r\nbegin\r\n  Result:=IntToStr(AValue);\r\nend;\r\n\r\n\r\nclass function TStringHelper.Parse(const AValue: Integer): string;\r\nbegin\r\n  Result:=IntToStr(AValue);\r\nend;\r\n\r\n\r\nclass function TStringHelper.ToBoolean(const S: string): Boolean;\r\nbegin\r\n  Result:=StrToBool(S);\r\nend;\r\n\r\n\r\nclass function TStringHelper.ToDouble(const S: string): Double;\r\nbegin\r\n  Result:=StrToFloat(S);\r\nend;\r\n\r\n\r\nclass function TStringHelper.ToExtended(const S: string): Extended;\r\nbegin\r\n  Result:=StrToFloat(S);\r\nend;\r\n\r\n\r\nclass function TStringHelper.ToNativeInt(const S: string): NativeInt;\r\nbegin\r\n  Result:=StrToInt64(S);\r\nend;\r\n\r\n\r\nclass function TStringHelper.ToInteger(const S: string): Integer;\r\nbegin\r\n  Result:=StrToInt(S);\r\nend;\r\n\r\n\r\nclass function TStringHelper.UpperCase(const S: string): string;\r\nbegin\r\n  Result:=SysUtils.Uppercase(S);\r\nend;\r\n\r\nclass function TStringHelper.ToCharArray(const S: String): TCharArray;\r\n\r\nVar\r\n  I,Len: integer;\r\n\r\nbegin\r\n  Len:=System.Length(S);\r\n  SetLength(Result,Len);\r\n  For I:=1 to Len do\r\n    Result[I-1]:=S[I];\r\nend;\r\n\r\nfunction TStringHelper.CompareTo(const B: string): Integer;\r\nbegin\r\n  // Order is important\r\n  Result:=Compare(Self,B);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Contains(const AValue: string): Boolean;\r\nbegin\r\n  Result:=(AValue<>'') and (Pos(AValue,Self)>0);\r\nend;\r\n\r\n\r\nfunction TStringHelper.CountChar(const C: Char): SizeInt;\r\n\r\nVar\r\n  S : Char;\r\nbegin\r\n  Result:=0;\r\n  For S in Self do\r\n    if (S=C) then\r\n      Inc(Result);\r\nend;\r\n\r\n\r\nfunction TStringHelper.DeQuotedString: string;\r\nbegin\r\n  Result:=DeQuotedString('''');\r\nend;\r\n\r\n\r\nfunction TStringHelper.DeQuotedString(const AQuoteChar: Char): string;\r\n\r\nvar\r\n  L,I : SizeInt;\r\n  Res : Array of Char;\r\n  PS,PD : SizeInt;\r\n  IsQuote : Boolean;\r\n\r\nbegin\r\n  L:=System.Length(Self);\r\n  if (L<2) or Not ((Self[1]=AQuoteChar) and (Self[L]=AQuoteChar)) then\r\n    Exit(Self);\r\n  SetLength(Res,L);\r\n  IsQuote:=False;\r\n  PS:=2;\r\n  PD:=1;\r\n  For I:=2 to L-1 do\r\n    begin\r\n    if (Self[PS]=AQuoteChar) then\r\n      begin\r\n      IsQuote:=Not IsQuote;\r\n      if Not IsQuote then\r\n        begin\r\n        Result[PD]:=Self[PS];\r\n        Inc(PD);\r\n        end;\r\n      end\r\n    else\r\n      begin\r\n      if IsQuote then\r\n        IsQuote:=false;\r\n      Result[PD]:=Self[PS];\r\n      Inc(PD);\r\n      end;\r\n    Inc(PS);\r\n    end;\r\n  SetLength(Result,PD-1);\r\nend;\r\n\r\n\r\nfunction TStringHelper.EndsWith(const AValue: string): Boolean;\r\nbegin\r\n  Result:=EndsWith(AValue,False);\r\nend;\r\n\r\n\r\nfunction TStringHelper.EndsWith(const AValue: string; IgnoreCase: Boolean): Boolean;\r\n\r\nVar\r\n  L : SizeInt;\r\n  S : String;\r\n\r\nbegin\r\n  L:=system.Length(AVAlue);\r\n  Result:=L=0;\r\n  if Not Result then\r\n    begin\r\n    S:=system.Copy(Self,Length-L+1,L);\r\n    Result:=system.Length(S)=L;\r\n    if Result then\r\n      if IgnoreCase then\r\n        Result:=CompareText(S,AValue)=0\r\n      else\r\n        Result:=S=AValue;\r\n    end;\r\nend;\r\n\r\n\r\nfunction TStringHelper.Equals(const AValue: string): Boolean;\r\n\r\nbegin\r\n  Result:=(Self=AValue);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Format(const args: array of const): string;\r\n\r\nbegin\r\n  Result:=SysUtils.Format(Self,Args);\r\nend;\r\n\r\n\r\nfunction TStringHelper.GetHashCode: Integer;\r\n\r\n// Taken from contnrs, fphash\r\nvar\r\n  P,pmax : Integer;\r\n  L : TJSString;\r\n\r\nbegin\r\n{$push}\r\n{$Q-}\r\n  L:=TJSString(Self);\r\n  Result:=0;\r\n\r\n  P:=1;\r\n  pmax:=length+1;\r\n  while (p<pmax) do\r\n    begin\r\n    Result:=LongWord(LongInt(Result shl 5) - LongInt(Result)) xor L.CharCodeAt(P);\r\n    Inc(p);\r\n    end;\r\n{$pop}\r\nend;\r\n\r\n\r\nfunction TStringHelper.IndexOf(AValue: Char): SizeInt;\r\nbegin\r\n  Result:=IndexOf(AValue,0,Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.IndexOf(const AValue: string): SizeInt;\r\nbegin\r\n  Result:=IndexOf(AValue,0,Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.IndexOf(AValue: Char; StartIndex: SizeInt): SizeInt;\r\nbegin\r\n  Result:=IndexOf(AValue,StartIndex,Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.IndexOf(const AValue: string; StartIndex: SizeInt\r\n  ): SizeInt;\r\nbegin\r\n  Result:=IndexOf(AValue,StartIndex,Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.IndexOf(AValue: Char; StartIndex: SizeInt;\r\n  ACount: SizeInt): SizeInt;\r\n\r\nVar\r\n  S : String;\r\n\r\nbegin\r\n  S:=System.Copy(Self,StartIndex+1,ACount);\r\n  Result:=Pos(AValue,S)-1;\r\n  if Result<>-1 then\r\n    Result:=Result+StartIndex;\r\nend;\r\n\r\n\r\nfunction TStringHelper.IndexOf(const AValue: string; StartIndex: SizeInt;\r\n  ACount: SizeInt): SizeInt;\r\n\r\nVar\r\n  S : String;\r\n\r\nbegin\r\n  S:=System.Copy(Self,StartIndex+1,ACount);\r\n  Result:=Pos(AValue,S)-1;\r\n  if Result<>-1 then\r\n    Result:=Result+StartIndex;\r\nend;\r\n\r\nfunction TStringHelper.IndexOfUnQuoted(const AValue: string; StartQuote,\r\n  EndQuote: Char; StartIndex: SizeInt = 0): SizeInt;\r\n\r\nVar\r\n  LV : SizeInt;\r\n  S : String;\r\n\r\n  Function MatchAt(I : SizeInt) : Boolean ; Inline;\r\n\r\n  Var\r\n    J : SizeInt;\r\n\r\n  begin\r\n    J:=1;\r\n    Repeat\r\n      Result:=(S[I+J-1]=AValue[j]);\r\n      Inc(J);\r\n    Until (Not Result) or (J>LV);\r\n  end;\r\n\r\nVar\r\n  I,L,Q: SizeInt;\r\n\r\nbegin\r\n  S:=Self;\r\n  Result:=-1;\r\n  LV:=system.Length(AValue);\r\n  L:=Length-LV+1;\r\n  if L<0 then\r\n    L:=0;\r\n  I:=StartIndex+1;\r\n  Q:=0;\r\n  if StartQuote=EndQuote then\r\n    begin\r\n    While (Result=-1) and (I<=L) do\r\n      begin\r\n      if (S[I]=StartQuote) then\r\n        Q:=1-Q;\r\n      if (Q=0) and MatchAt(i) then\r\n        Result:=I-1;\r\n      Inc(I);\r\n      end;\r\n    end\r\n  else\r\n    begin\r\n    While (Result=-1) and (I<=L) do\r\n      begin\r\n      if S[I]=StartQuote then\r\n        Inc(Q)\r\n      else if (S[I]=EndQuote) and (Q>0) then\r\n        Dec(Q);\r\n      if (Q=0) and MatchAt(i) then\r\n        Result:=I-1;\r\n      Inc(I);\r\n      end;\r\n    end;\r\nend;\r\n\r\nfunction TStringHelper.IndexOfAny(const AnyOf: string): SizeInt;\r\nbegin\r\n  Result:=IndexOfAny(AnyOf.ToCharArray);\r\nend;\r\n\r\n\r\nfunction TStringHelper.IndexOfAny(const AnyOf: array of Char): SizeInt;\r\nbegin\r\n  Result:=IndexOfAny(AnyOf,0,Length);\r\nend;\r\n\r\nfunction TStringHelper.IndexOfAny(const AnyOf: String; StartIndex: SizeInt): SizeInt;\r\nbegin\r\n  Result:=IndexOfAny(AnyOf.ToCharArray,StartIndex);\r\nend;\r\n\r\n\r\nfunction TStringHelper.IndexOfAny(const AnyOf: array of Char;\r\n  StartIndex: SizeInt): SizeInt;\r\nbegin\r\n  Result:=IndexOfAny(AnyOf,StartIndex,Length);\r\nend;\r\n\r\nfunction TStringHelper.IndexOfAny(const AnyOf: String; StartIndex: SizeInt; ACount: SizeInt): SizeInt;\r\nbegin\r\n  Result:=IndexOfAny(AnyOf.ToCharArray,StartIndex,aCount);\r\nend;\r\n\r\nfunction TStringHelper.IndexOfAny(const AnyOf: array of Char;\r\n  StartIndex: SizeInt; ACount: SizeInt): SizeInt;\r\n\r\nVar\r\n  i,L : SizeInt;\r\n\r\nbegin\r\n  I:=StartIndex+1;\r\n  L:=I+ACount-1;\r\n  If L>Length then\r\n    L:=Length;\r\n  Result:=-1;\r\n  While (Result=-1) and (I<=L) do\r\n    begin\r\n    if HaveChar(Self[i],AnyOf) then\r\n      Result:=I-1;\r\n    Inc(I);\r\n    end;\r\nend;\r\n\r\nfunction TStringHelper.IndexOfAny(const AnyOf: array of String): SizeInt;\r\nbegin\r\n  Result:=IndexOfAny(AnyOf,0,Length);\r\nend;\r\n\r\nfunction TStringHelper.IndexOfAny(const AnyOf: array of String;\r\n  StartIndex: SizeInt): SizeInt;\r\nbegin\r\n  Result:=IndexOfAny(AnyOf,StartIndex,Length-StartIndex);\r\nend;\r\n\r\nfunction TStringHelper.IndexOfAny(const AnyOf: array of String;\r\n  StartIndex: SizeInt; ACount: SizeInt): SizeInt;\r\n\r\nVar\r\n  M : SizeInt;\r\n\r\nbegin\r\n  Result:=IndexOfAny(AnyOf,StartIndex,ACount,M);\r\nend;\r\n\r\nfunction TStringHelper.IndexOfAny(const AnyOf: array of String;\r\n  StartIndex: SizeInt; ACount: SizeInt; out AMatch: SizeInt): SizeInt;\r\n\r\nVar\r\n  L,I : SizeInt;\r\n\r\nbegin\r\n  Result:=-1;\r\n  For I:=0 to System.Length(AnyOf)-1 do\r\n    begin\r\n    L:=IndexOf(AnyOf[i],StartIndex,ACount);\r\n    If (L>=0) and ((Result=-1) or (L<Result)) then\r\n      begin\r\n      Result:=L;\r\n      AMatch:=I;\r\n      end;\r\n    end;\r\nend;\r\n\r\n\r\nfunction TStringHelper.IndexOfAnyUnquoted(const AnyOf: array of Char;\r\n  StartQuote, EndQuote: Char): SizeInt;\r\nbegin\r\n  Result:=IndexOfAnyUnquoted(AnyOf,StartQuote,EndQuote,0,Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.IndexOfAnyUnquoted(const AnyOf: array of Char;\r\n  StartQuote, EndQuote: Char; StartIndex: SizeInt): SizeInt;\r\nbegin\r\n  Result:=IndexOfAnyUnquoted(AnyOf,StartQuote,EndQuote,StartIndex,Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.IndexOfAnyUnquoted(const AnyOf: array of Char;\r\n  StartQuote, EndQuote: Char; StartIndex: SizeInt; ACount: SizeInt): SizeInt;\r\n\r\nVar\r\n  I,L : SizeInt;\r\n  Q : SizeInt;\r\n\r\nbegin\r\n  Result:=-1;\r\n  L:=StartIndex+ACount-1;\r\n  if L>Length then\r\n    L:=Length;\r\n  I:=StartIndex+1;\r\n  Q:=0;\r\n  if StartQuote=EndQuote then\r\n    begin\r\n    While (Result=-1) and (I<=L) do\r\n      begin\r\n      if (Self[I]=StartQuote) then\r\n        Q:=1-Q;\r\n      if (Q=0) and HaveChar(Self[i],AnyOf) then\r\n        Result:=I-1;\r\n      Inc(I);\r\n      end;\r\n    end\r\n  else\r\n  begin\r\n    While (Result=-1) and (I<=L) do\r\n      begin\r\n      if Self[I]=StartQuote then\r\n        Inc(Q)\r\n      else if (Self[I]=EndQuote) and (Q>0) then\r\n        Dec(Q);\r\n      if (Q=0) and HaveChar(Self[i],AnyOf) then\r\n        Result:=I-1;\r\n      Inc(I);\r\n      end;\r\n    end;\r\n\r\nend;\r\n\r\nfunction TStringHelper.IndexOfAnyUnquoted(const AnyOf: array of string;\r\n  StartQuote, EndQuote: Char; StartIndex: SizeInt; out Matched: SizeInt\r\n  ): SizeInt;\r\n\r\nVar\r\n  L,I : SizeInt;\r\n\r\nbegin\r\n  Result:=-1;\r\n  For I:=0 to System.Length(AnyOf)-1 do\r\n    begin\r\n    L:=IndexOfUnquoted(AnyOf[i],StartQuote,EndQuote,StartIndex);\r\n    If (L>=0) and ((Result=-1) or (L<Result)) then\r\n      begin\r\n      Result:=L;\r\n      Matched:=I;\r\n      end;\r\n    end;\r\nend;\r\n\r\n\r\nfunction TStringHelper.Insert(StartIndex: SizeInt; const AValue: string\r\n  ): string;\r\nbegin\r\n  system.Insert(AValue,Self,StartIndex+1);\r\n  Result:=Self;\r\nend;\r\n\r\n\r\nfunction TStringHelper.IsDelimiter(const Delimiters: string; Index: SizeInt\r\n  ): Boolean;\r\nbegin\r\n  Result:=SysUtils.IsDelimiter(Delimiters,Self,Index+1);\r\nend;\r\n\r\n\r\nfunction TStringHelper.IsEmpty: Boolean;\r\nbegin\r\n  Result:=(Length=0)\r\nend;\r\n\r\n\r\nfunction TStringHelper.LastDelimiter(const Delims: string): SizeInt;\r\nbegin\r\n  Result:=SysUtils.LastDelimiter(Delims,Self)-1;\r\nend;\r\n\r\n\r\nfunction TStringHelper.LastIndexOf(AValue: Char): SizeInt;\r\nbegin\r\n  Result:=LastIndexOf(AValue,Length-1,Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.LastIndexOf(const AValue: string): SizeInt;\r\nbegin\r\n  Result:=LastIndexOf(AValue,Length-1,Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.LastIndexOf(AValue: Char; AStartIndex: SizeInt): SizeInt;\r\nbegin\r\n  Result:=LastIndexOf(AValue,AStartIndex,Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.LastIndexOf(const AValue: string; AStartIndex: SizeInt\r\n  ): SizeInt;\r\nbegin\r\n  Result:=LastIndexOf(AValue,AStartIndex,Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.LastIndexOf(AValue: Char; AStartIndex: SizeInt;\r\n  ACount: SizeInt): SizeInt;\r\n\r\nVar\r\n  Min : SizeInt;\r\n\r\nbegin\r\n  Result:=AStartIndex+1;\r\n  Min:=Result-ACount+1;\r\n  If Min<1 then\r\n    Min:=1;\r\n  While (Result>=Min) and (Self[Result]<>AValue) do\r\n    Dec(Result);\r\n  if Result<Min then\r\n    Result:=-1\r\n  else\r\n    Result:=Result-1;\r\nend;\r\n\r\n\r\nfunction TStringHelper.LastIndexOf(const AValue: string; AStartIndex: SizeInt; ACount: SizeInt): SizeInt;\r\n\r\nbegin\r\n  Result:=TJSString(Self).lastIndexOf(aValue,aStartIndex);\r\n  if (aStartIndex-Result)>aCount then\r\n    Result:=-1;\r\nend;\r\n\r\n\r\nfunction TStringHelper.LastIndexOfAny(const AnyOf: array of Char): SizeInt;\r\nbegin\r\n  Result:=LastIndexOfAny(AnyOf,Length-1,Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.LastIndexOfAny(const AnyOf: array of Char;\r\n  AStartIndex: SizeInt): SizeInt;\r\nbegin\r\n  Result:=LastIndexOfAny(AnyOf,AStartIndex,Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.LastIndexOfAny(const AnyOf: array of Char;\r\n  AStartIndex: SizeInt; ACount: SizeInt): SizeInt;\r\n\r\nVar\r\n  Min : SizeInt;\r\n\r\nbegin\r\n  Result:=AStartIndex+1;\r\n  Min:=Result-ACount+1;\r\n  If Min<1 then\r\n    Min:=1;\r\n  While (Result>=Min) and Not HaveChar(Self[Result],AnyOf) do\r\n    Dec(Result);\r\n  if Result<Min then\r\n    Result:=-1\r\n  else\r\n    Result:=Result-1;\r\nend;\r\n\r\n\r\nfunction TStringHelper.PadLeft(ATotalWidth: SizeInt): string;\r\nbegin\r\n  Result:=PadLeft(ATotalWidth,' ');\r\nend;\r\n\r\n\r\nfunction TStringHelper.PadLeft(ATotalWidth: SizeInt; PaddingChar: Char): string;\r\nVar\r\n  L : SizeInt;\r\n\r\nbegin\r\n  Result:=Self;\r\n  L:=ATotalWidth-Length;\r\n  If L>0 then\r\n    Result:=StringOfChar(PaddingChar,L)+Result;\r\nend;\r\n\r\n\r\nfunction TStringHelper.PadRight(ATotalWidth: SizeInt): string;\r\nbegin\r\n  Result:=PadRight(ATotalWidth,' ');\r\nend;\r\n\r\n\r\nfunction TStringHelper.PadRight(ATotalWidth: SizeInt; PaddingChar: Char\r\n  ): string;\r\n\r\nVar\r\n  L : SizeInt;\r\n\r\nbegin\r\n  Result:=Self;\r\n  L:=ATotalWidth-Length;\r\n  If L>0 then\r\n    Result:=Result+StringOfChar(PaddingChar,L);\r\nend;\r\n\r\n\r\nfunction TStringHelper.QuotedString: string;\r\nbegin\r\n  Result:=QuotedStr(Self);\r\nend;\r\n\r\n\r\nfunction TStringHelper.QuotedString(const AQuoteChar: Char): string;\r\nbegin\r\n  Result:=QuotedStr(Self,AQuoteChar);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Remove(StartIndex: SizeInt): string;\r\nbegin\r\n  Result:=Remove(StartIndex,Self.Length-StartIndex);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Remove(StartIndex: SizeInt; ACount: SizeInt): string;\r\nbegin\r\n  Result:=Self;\r\n  System.Delete(Result,StartIndex+1,ACount);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Replace(OldChar: Char; NewChar: Char): string;\r\nbegin\r\n  Result:=Replace(OldChar,NewChar,[rfReplaceAll]);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Replace(OldChar: Char; NewChar: Char;\r\n  ReplaceFlags: TReplaceFlags): string;\r\nbegin\r\n  Result:=StringReplace(Self,OldChar,NewChar,ReplaceFlags);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Replace(const OldValue: string; const NewValue: string\r\n  ): string;\r\nbegin\r\n  Result:=Replace(OldValue,NewValue,[rfReplaceAll]);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Replace(const OldValue: string; const NewValue: string;\r\n  ReplaceFlags: TReplaceFlags): string;\r\nbegin\r\n  Result:=StringReplace(Self,OldValue,NewValue,ReplaceFlags);\r\nend;\r\n\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: String): TStringArray;\r\nbegin\r\n  Result:=Split(Separators.ToCharArray);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of Char): TStringArray;\r\nbegin\r\n  Result:=Split(Separators,#0,#0,Length+1,TStringSplitOptions.None);\r\nend;\r\n\r\nfunction TStringHelper.Split(const Separators: string; ACount: SizeInt): TStringArray;\r\nbegin\r\n  Result:=Split(Separators.ToCharArray,aCount);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of Char; ACount: SizeInt\r\n  ): TStringArray;\r\nbegin\r\n  Result:=Split(Separators,#0,#0,ACount,TStringSplitOptions.None);\r\nend;\r\n\r\nfunction TStringHelper.Split(const Separators: string; Options: TStringSplitOptions): TStringArray;\r\nbegin\r\n  Result:=Split(Separators.ToCharArray,Options);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of Char;\r\n  Options: TStringSplitOptions): TStringArray;\r\nbegin\r\n  Result:=Split(Separators,Length+1,Options);\r\nend;\r\n\r\nfunction TStringHelper.Split(const Separators: string; ACount: SizeInt; Options: TStringSplitOptions): TStringArray;\r\nbegin\r\n  Result:=Split(Separators.ToCharArray,aCount,Options);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of Char; ACount: SizeInt;\r\n  Options: TStringSplitOptions): TStringArray;\r\nbegin\r\n  Result:=Split(Separators,#0,#0,ACount,Options);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of string): TStringArray;\r\nbegin\r\n  Result:=Split(Separators,Length+1);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of string; ACount: SizeInt\r\n  ): TStringArray;\r\nbegin\r\n  Result:=Split(Separators,ACount,TStringSplitOptions.None);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of string;\r\n  Options: TStringSplitOptions): TStringArray;\r\nbegin\r\n  Result:=Split(Separators,Length+1,Options);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of string;\r\n  ACount: SizeInt; Options: TStringSplitOptions): TStringArray;\r\nbegin\r\n  Result:=Split(Separators,#0,#0,ACount,Options);\r\nend;\r\n\r\nfunction TStringHelper.Split(const Separators: String; AQuote: Char): TStringArray;\r\nbegin\r\n  Result:=Split(Separators.ToCharArray,aQuote);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of Char; AQuote: Char\r\n  ): TStringArray;\r\nbegin\r\n  Result:=Split(Separators,AQuote,AQuote);\r\nend;\r\n\r\nfunction TStringHelper.Split(const Separators: String; AQuoteStart, AQuoteEnd: Char): TStringArray;\r\nbegin\r\n  Result:=Split(Separators.ToCharArray,aQuoteStart,aQuoteEnd);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of Char; AQuoteStart,\r\n  AQuoteEnd: Char): TStringArray;\r\nbegin\r\n  Result:=Split(Separators,AQuoteStart,AQuoteEnd,TStringSplitOptions.None);\r\nend;\r\n\r\nfunction TStringHelper.Split(const Separators: string; AQuoteStart, AQuoteEnd: Char; Options: TStringSplitOptions): TStringArray;\r\nbegin\r\n  Result:=Split(Separators.ToCharArray,aQuoteStart,aQuoteEnd,Options);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of Char; AQuoteStart,\r\n  AQuoteEnd: Char; Options: TStringSplitOptions): TStringArray;\r\nbegin\r\n  Result:=Split(Separators,AQuoteStart,AQuoteEnd,Length+1,Options);\r\nend;\r\n\r\nfunction TStringHelper.Split(const Separators: string; AQuoteStart, AQuoteEnd: Char; ACount: SizeInt): TStringArray;\r\nbegin\r\n  Result:=Split(Separators.ToCharArray,aQuoteStart,aQuoteEnd,aCount);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of Char; AQuoteStart,\r\n  AQuoteEnd: Char; ACount: SizeInt): TStringArray;\r\nbegin\r\n  Result:=Split(Separators,AQuoteStart,AQuoteEnd,ACount,TStringSplitOptions.None);\r\nend;\r\n\r\nfunction TStringHelper.Split(const Separators: string; AQuoteStart, AQuoteEnd: Char; ACount: SizeInt; Options: TStringSplitOptions\r\n  ): TStringArray;\r\nbegin\r\n  Result:=Split(Separators.ToCharArray,aQuoteStart,aQuoteEnd,aCount,Options);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of Char; AQuoteStart,\r\n  AQuoteEnd: Char; ACount: SizeInt; Options: TStringSplitOptions): TStringArray;\r\n\r\n\r\nConst\r\n  BlockSize = 10;\r\n\r\nVar\r\n  S : String;\r\n\r\n  Function NextSep(StartIndex : SizeInt) : SizeInt;\r\n\r\n  begin\r\n    if (AQuoteStart<>#0) then\r\n      Result:=S.IndexOfAnyUnQuoted(Separators,AQuoteStart,AQuoteEnd,StartIndex)\r\n    else\r\n      Result:=S.IndexOfAny(Separators,StartIndex);\r\n  end;\r\n\r\n  Procedure MaybeGrow(Curlen : SizeInt);\r\n\r\n  begin\r\n    if System.Length(Result)<=CurLen then\r\n      SetLength(Result,System.Length(Result)+BlockSize);\r\n  end;\r\n\r\nVar\r\n  Sep,LastSep,Len : SizeInt;\r\n  T : String;\r\n\r\nbegin\r\n\r\n  S:=Self;\r\n  SetLength(Result,BlockSize);\r\n  Len:=0;\r\n  LastSep:=0;\r\n  Sep:=NextSep(0);\r\n  While (Sep<>-1) and ((ACount=0) or (Len<ACount)) do\r\n    begin\r\n    T:=SubString(LastSep,Sep-LastSep);\r\n//    Writeln('Examining >',T,'< at pos ',LastSep,', till pos ',Sep);\r\n    If (T<>'') or (not (TStringSplitOptions.ExcludeEmpty=Options)) then\r\n      begin\r\n      MaybeGrow(Len);\r\n      Result[Len]:=T;\r\n      Inc(Len);\r\n      end;\r\n    LastSep:=Sep+1;\r\n    Sep:=NextSep(LastSep);\r\n    end;\r\n  if (LastSep<=Length) and ((ACount=0) or (Len<ACount)) then\r\n    begin\r\n    T:=SubString(LastSep);\r\n//    Writeln('Examining >',T,'< at pos,',LastSep,' till pos ',Sep);\r\n    If (T<>'') or (not (TStringSplitOptions.ExcludeEmpty=Options)) then\r\n      begin\r\n      MaybeGrow(Len);\r\n      Result[Len]:=T;\r\n      Inc(Len);\r\n      end;\r\n    end;\r\n  SetLength(Result,Len);\r\n\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of string; AQuote: Char\r\n  ): TStringArray;\r\nbegin\r\n  Result:=SPlit(Separators,AQuote,AQuote);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of string; AQuoteStart,\r\n  AQuoteEnd: Char): TStringArray;\r\nbegin\r\n  Result:=SPlit(Separators,AQuoteStart,AQuoteEnd,Length+1,TStringSplitOptions.None);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of string; AQuoteStart,\r\n  AQuoteEnd: Char; Options: TStringSplitOptions): TStringArray;\r\nbegin\r\n  Result:=SPlit(Separators,AQuoteStart,AQuoteEnd,Length+1,Options);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of string; AQuoteStart,\r\n  AQuoteEnd: Char; ACount: SizeInt): TStringArray;\r\nbegin\r\n  Result:=SPlit(Separators,AQuoteStart,AQuoteEnd,ACount,TStringSplitOptions.None);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Split(const Separators: array of string; AQuoteStart,\r\n  AQuoteEnd: Char; ACount: SizeInt; Options: TStringSplitOptions): TStringArray;\r\n\r\nConst\r\n  BlockSize = 10;\r\n\r\nVar\r\n  S : String;\r\n\r\n  Function NextSep(StartIndex : SizeInt; out Match : SizeInt) : SizeInt;\r\n\r\n  begin\r\n    if (AQuoteStart<>#0) then\r\n      Result:=S.IndexOfAnyUnQuoted(Separators,AQuoteStart,AQuoteEnd,StartIndex,Match)\r\n    else\r\n      Result:=S.IndexOfAny(Separators,StartIndex,Length,Match);\r\n  end;\r\n\r\n  Procedure MaybeGrow(Curlen : SizeInt);\r\n\r\n  begin\r\n    if System.Length(Result)<=CurLen then\r\n      SetLength(Result,System.Length(Result)+BlockSize);\r\n  end;\r\n\r\nVar\r\n  Sep,LastSep,Len,Match : SizeInt;\r\n  T : String;\r\n\r\nbegin\r\n  S:=Self;\r\n  SetLength(Result,BlockSize);\r\n  Len:=0;\r\n  LastSep:=0;\r\n  Sep:=NextSep(0,Match);\r\n  While (Sep<>-1) and ((ACount=0) or (Len<ACount)) do\r\n    begin\r\n    T:=SubString(LastSep,Sep-LastSep);\r\n    If (T<>'') or (not (TStringSplitOptions.ExcludeEmpty=Options)) then\r\n      begin\r\n      MaybeGrow(Len);\r\n      Result[Len]:=T;\r\n      Inc(Len);\r\n      end;\r\n    LastSep:=Sep+System.Length(Separators[Match]);\r\n    Sep:=NextSep(LastSep,Match);\r\n    end;\r\n  if (LastSep<=Length) and ((ACount=0) or (Len<ACount)) then\r\n    begin\r\n    T:=SubString(LastSep);\r\n//    Writeln('Examining >',T,'< at pos,',LastSep,' till pos ',Sep);\r\n    If (T<>'') or (not (TStringSplitOptions.ExcludeEmpty=Options)) then\r\n      begin\r\n      MaybeGrow(Len);\r\n      Result[Len]:=T;\r\n      Inc(Len);\r\n      end;\r\n    end;\r\n  SetLength(Result,Len);\r\n\r\nend;\r\n\r\n\r\nfunction TStringHelper.StartsWith(const AValue: string): Boolean;\r\nbegin\r\n  Result:=StartsWith(AValue,False);\r\nend;\r\n\r\n\r\nfunction TStringHelper.StartsWith(const AValue: string; IgnoreCase: Boolean\r\n  ): Boolean;\r\nVar\r\n  L : SizeInt;\r\n  S : String;\r\n\r\nbegin\r\n  L:=System.Length(AValue);\r\n  Result:=L<=0;\r\n  if not Result then\r\n    begin\r\n    S:=System.Copy(Self,1,L);\r\n    Result:=(System.Length(S)=L);\r\n    if Result then\r\n      if IgnoreCase then\r\n        Result:=SameText(S,aValue)\r\n      else\r\n        Result:=SameStr(S,AValue);\r\n    end;\r\nend;\r\n\r\n\r\nfunction TStringHelper.Substring(AStartIndex: SizeInt): string;\r\nbegin\r\n  Result:=Self.SubString(AStartIndex,Self.Length-AStartIndex);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Substring(AStartIndex: SizeInt; ALen: SizeInt): string;\r\nbegin\r\n  Result:=system.Copy(Self,AStartIndex+1,ALen);\r\nend;\r\n\r\n\r\nfunction TStringHelper.ToBoolean: Boolean;\r\nbegin\r\n  Result:=StrToBool(Self);\r\nend;\r\n\r\n\r\nfunction TStringHelper.ToInteger: Integer;\r\nbegin\r\n  Result:=StrToInt(Self);\r\nend;\r\n\r\n\r\nfunction TStringHelper.ToNativeInt: NativeInt;\r\nbegin\r\n  Result:=StrToNativeInt(Self);\r\nend;\r\n\r\nfunction TStringHelper.ToDouble: Double;\r\nbegin\r\n  Result:=StrToFLoat(Self);\r\nend;\r\n\r\n\r\nfunction TStringHelper.ToExtended: Extended;\r\nbegin\r\n  Result:=StrToFLoat(Self);\r\nend;\r\n\r\n\r\nfunction TStringHelper.ToCharArray: TCharArray;\r\n\r\nbegin\r\n  Result:=ToCharArray(0,Self.Length);\r\nend;\r\n\r\n\r\nfunction TStringHelper.ToCharArray(AStartIndex: SizeInt; ALen: SizeInt\r\n  ): TCharArray;\r\n\r\nVar\r\n  I : SizeInt;\r\n\r\nbegin\r\n  SetLength(Result,ALen);\r\n  For I:=0 to ALen-1 do\r\n    Result[I]:=Self[AStartIndex+I+1];\r\nend;\r\n\r\n\r\nfunction TStringHelper.ToLower: string;\r\nbegin\r\n  Result:=LowerCase(Self);\r\nend;\r\n\r\n\r\nfunction TStringHelper.ToLowerInvariant: string;\r\nbegin\r\n  Result:=LowerCase(Self);\r\nend;\r\n\r\n\r\nfunction TStringHelper.ToUpper: string;\r\nbegin\r\n  Result:=UpperCase(Self);\r\nend;\r\n\r\n\r\nfunction TStringHelper.ToUpperInvariant: string;\r\nbegin\r\n  Result:=UpperCase(Self);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Trim: string;\r\nbegin\r\n  Result:=SysUtils.Trim(self);\r\nend;\r\n\r\n\r\nfunction TStringHelper.TrimLeft: string;\r\nbegin\r\n  Result:=SysUtils.TrimLeft(Self);\r\nend;\r\n\r\n\r\nfunction TStringHelper.TrimRight: string;\r\nbegin\r\n  Result:=SysUtils.TrimRight(Self);\r\nend;\r\n\r\n\r\nfunction TStringHelper.Trim(const ATrimChars: array of Char): string;\r\nbegin\r\n  Result:=Self.TrimLeft(ATrimChars).TrimRight(ATrimChars);\r\nend;\r\n\r\n\r\nfunction TStringHelper.TrimLeft(const ATrimChars: array of Char): string;\r\n\r\nVar\r\n  I,Len : SizeInt;\r\n\r\nbegin\r\n  I:=1;\r\n  Len:=Self.Length;\r\n  While (I<=Len) and HaveChar(Self[i],ATrimChars) do Inc(I);\r\n  if I=1 then\r\n    Result:=Self\r\n  else if I>Len then\r\n    Result:=''\r\n  else\r\n    Result:=system.Copy(Self,I,Len-I+1);\r\nend;\r\n\r\n\r\nfunction TStringHelper.TrimRight(const ATrimChars: array of Char): string;\r\n\r\nVar\r\n  I,Len : SizeInt;\r\n\r\nbegin\r\n  Len:=Self.Length;\r\n  I:=Len;\r\n  While (I>=1) and HaveChar(Self[i],ATrimChars) do Dec(I);\r\n  if I<1 then\r\n    Result:=''\r\n  else if I=Len then\r\n    Result:=Self\r\n  else\r\n    Result:=system.Copy(Self,1,I);\r\nend;\r\n\r\n\r\nfunction TStringHelper.TrimEnd(const ATrimChars: array of Char): string;\r\nbegin\r\n  Result:=TrimRight(ATrimChars);\r\nend;\r\n\r\n\r\nfunction TStringHelper.TrimStart(const ATrimChars: array of Char): string;\r\nbegin\r\n  Result:=TrimLeft(ATrimChars);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TDoubleHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nClass Function TDoubleHelper.IsNan(const AValue: Double): Boolean; overload; inline;\r\n\r\nbegin\r\n  Result:=JS.jsIsNaN(AValue);\r\nend;\r\n\r\nClass Function TDoubleHelper.IsInfinity(const AValue: Double): Boolean; overload; inline;\r\n\r\nbegin\r\n  Result:=Not jsIsFinite(aValue);\r\nend;\r\n\r\nClass Function TDoubleHelper.IsNegativeInfinity(const AValue: Double): Boolean; overload; inline;\r\n\r\nbegin\r\n  asm\r\n    return (AValue=Number.NEGATIVE_INFINITY);\r\n  end;\r\n  Result:=aValue=0; // Fool compiler\r\nend;\r\n\r\nClass Function TDoubleHelper.IsPositiveInfinity(const AValue: Double): Boolean; overload; inline;\r\n\r\nbegin\r\n  asm\r\n    return (AValue=Number.POSITIVE_INFINITY);\r\n  end;\r\n  Result:=aValue=0;  // Fool compiler.\r\nend;\r\n\r\nClass Function TDoubleHelper.Parse(const AString: string): Double; overload; inline;\r\n\r\nbegin\r\n  Result:=StrToFloat(AString);\r\nend;\r\n\r\n\r\nClass Function TDoubleHelper.ToString(const AValue: Double): string; overload; inline;\r\n\r\nbegin\r\n  Result:=FloatToStr(AValue);\r\nend;\r\n\r\n\r\nClass Function TDoubleHelper.ToString(const AValue: Double; const AFormat: TFloatFormat; const APrecision, ADigits: Integer): string; overload; inline;\r\n\r\nbegin\r\n  Result:=FloatToStrF(AValue,AFormat,APrecision,ADigits);\r\nend;\r\n\r\n\r\nClass Function TDoubleHelper.TryParse(const AString: string; out AValue: Double): Boolean; overload; inline;\r\n\r\nbegin\r\n  Result:=TryStrToFloat(AString,AValue);\r\nend;\r\n\r\n\r\n\r\nFunction TDoubleHelper.GetB(AIndex: Cardinal): Byte;\r\n\r\nvar\r\n  F : TJSFloat64Array;\r\n  B : TJSUInt8array;\r\n\r\nbegin\r\n  F:=TJSFloat64Array.New(1);\r\n  B:=TJSUInt8array.New(F.Buffer);\r\n  F[0]:=Self;\r\n  Result:=B[AIndex];\r\nend;\r\n\r\nFunction TDoubleHelper.GetW(AIndex: Cardinal): Word;\r\n\r\nvar\r\n  F : TJSFloat64Array;\r\n  W : TJSUInt16array;\r\n\r\nbegin\r\n  F:=TJSFloat64Array.New(1);\r\n  W:=TJSUInt16array.New(F.Buffer);\r\n  F[0]:=Self;\r\n  Result:=W[AIndex];\r\nend;\r\n\r\nType\r\n  TFloatParts = Record\r\n    sign : boolean;\r\n    exp : integer;\r\n    mantissa : double;\r\n  end;\r\n\r\n// See https://stackoverflow.com/questions/9383593/extracting-the-exponent-and-mantissa-of-a-javascript-number\r\n\r\nFunction FloatToParts(aValue : Double) : TFloatParts;\r\n\r\nvar\r\n  F : TJSFloat64Array;\r\n  B : TJSUInt8array;\r\n\r\nbegin\r\n  F:=TJSFloat64Array.New(1);\r\n  B:=TJSUInt8array.New(F.Buffer);\r\n  F[0]:=aValue;\r\n  Result.Sign:=(B[7] shr 7)=0;\r\n  Result.exp:=(((B[7] and $7f) shl 4) or (B[6] shr 4))- $3ff;\r\n  B[3]:=$3F;\r\n  B[6]:=B[6] or $F0;\r\n  Result.Mantissa:=F[0];\r\nend;\r\n\r\nFunction TDoubleHelper.GetE: NativeUInt; inline;\r\n\r\nbegin\r\n  Result:=FloatToParts(Self).Exp;\r\nend;\r\n\r\nFunction TDoubleHelper.GetF: NativeUInt; inline;\r\n\r\nbegin\r\n  Result:=0;\r\n  NotImplemented('GetF');\r\nend;\r\n\r\nFunction TDoubleHelper.GetS: Boolean; inline;\r\n\r\nbegin\r\n  Result:=FloatToParts(Self).Sign;\r\nend;\r\n\r\nprocedure TDoubleHelper.SetB(AIndex: Cardinal; const AValue: Byte);\r\n\r\nvar\r\n  F : TJSFloat64Array;\r\n  B : TJSUInt8array;\r\n\r\nbegin\r\n  if (AIndex>=8) then\r\n    raise ERangeError.Create(SRangeError);\r\n  F:=TJSFloat64Array.New(1);\r\n  B:=TJSUInt8array.New(F.Buffer);\r\n  F[0]:=Self;\r\n  B[AIndex]:=aValue;\r\n  Self:=F[0];\r\nend;\r\n\r\nprocedure TDoubleHelper.SetW(AIndex: Cardinal; const AValue: Word);\r\n\r\nVar\r\n  F : TJSFloat64Array;\r\n  W : TJSUInt16array;\r\n\r\nbegin\r\n  if (AIndex>=4) then\r\n    raise ERangeError.Create(SRangeError);\r\n  F:=TJSFloat64Array.New(1);\r\n  W:=TJSUInt16array.New(F.Buffer);\r\n  F[0]:=Self;\r\n  W[AIndex]:=aValue;\r\n  Self:=F[0];\r\nend;\r\n\r\n\r\n\r\nprocedure TDoubleHelper.SetS(AValue: Boolean);\r\n\r\n\r\nVar\r\n  F : TJSFloat64Array;\r\n  B : TJSUInt8array;\r\n\r\nbegin\r\n  F:=TJSFloat64Array.New(1);\r\n  B:=TJSUInt8array.New(F.Buffer);\r\n  F[0]:=Self;\r\n  if aValue then\r\n    B[7]:=B[7] or (1 shr 7)\r\n  else\r\n    B[7]:=B[7] and not (1 shr 7);\r\n  Self:=F[0];\r\nend;\r\n\r\n\r\nProcedure TDoubleHelper.BuildUp(const ASignFlag: Boolean; const AMantissa: NativeUInt; const AExponent: Integer);\r\n\r\nbegin\r\n  NotImplemented('BuildUp');\r\n  // Following statement is just to fool the compiler\r\n  if ASignFlag and (AMantissa>0) and (AExponent<0) then exit;\r\n//  TFloatRec(Self).BuildUp(ASignFlag, AMantissa, AExponent);\r\nend;\r\n\r\nFunction TDoubleHelper.Exponent: Integer;\r\n\r\nbegin\r\n  Result:=FloatToParts(Self).Exp;\r\nend;\r\n\r\nFunction TDoubleHelper.Fraction: Extended;\r\n\r\nbegin\r\n  Result:=system.Frac(Self);\r\nend;\r\n\r\nFunction TDoubleHelper.IsInfinity: Boolean; overload; inline;\r\n\r\nbegin\r\n  Result:=Double.IsInfinity(Self);\r\nend;\r\n\r\nFunction TDoubleHelper.IsNan: Boolean; overload; inline;\r\n\r\nbegin\r\n  Result:=Double.IsNan(Self);\r\nend;\r\n\r\nFunction TDoubleHelper.IsNegativeInfinity: Boolean; overload; inline;\r\n\r\nbegin\r\n  Result:=Double.IsNegativeInfinity(Self);\r\nend;\r\n\r\nFunction TDoubleHelper.IsPositiveInfinity: Boolean; overload; inline;\r\n\r\nbegin\r\n  Result:=Double.IsPositiveInfinity(Self);\r\nend;\r\n\r\nFunction TDoubleHelper.Mantissa: NativeUInt;\r\n\r\nbegin\r\n  Result:=Trunc(FloatToParts(Self).mantissa);\r\nend;\r\n\r\nFunction TDoubleHelper.ToString(const AFormat: TFloatFormat; const APrecision, ADigits: Integer): string; overload; inline;\r\n\r\nbegin\r\n  Result:=FloatToStrF(Self,AFormat,APrecision,ADigits);\r\nend;\r\n\r\nFunction TDoubleHelper.ToString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=FloatToStr(Self);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TByteHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nClass Function TByteHelper.Parse(const AString: string): Byte; inline;\r\n\r\nbegin\r\n  Result:=StrToInt(AString);\r\nend;\r\n\r\nClass Function TByteHelper.Size: Integer; inline;\r\n\r\nbegin\r\n  Result:=1;\r\nend;\r\n\r\nClass Function TByteHelper.ToString(const AValue: Byte): string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(AValue);\r\nend;\r\n\r\nClass Function TByteHelper.TryParse(const AString: string; out AValue: Byte): Boolean; inline;\r\n\r\nVar\r\n  C : Integer;\r\n\r\nbegin\r\n  Val(AString,AValue,C);\r\n  Result:=(C=0);\r\nend;\r\n\r\nFunction TByteHelper.ToBoolean: Boolean; inline;\r\n\r\nbegin\r\n  Result:=(Self<>0);\r\nend;\r\n\r\nFunction TByteHelper.ToDouble: Double; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TByteHelper.ToExtended: Extended; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TByteHelper.ToBinString: string; inline;\r\n\r\nbegin\r\n  Result:=BinStr(Self,Size*8);\r\nend;\r\n\r\nFunction TByteHelper.ToHexString(const AMinDigits: Integer): string;\r\noverload; inline;\r\n\r\nbegin\r\n  Result:=IntToHex(Self,AMinDigits);\r\nend;\r\n\r\nFunction TByteHelper.ToHexString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToHex(Self,Size*2);\r\nend;\r\n\r\nFunction TByteHelper.ToString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(Self);\r\nend;\r\n\r\nFunction TByteHelper.SetBit(const index: TByteBitIndex) : Byte; inline;\r\n\r\nbegin\r\n  Self := Self or (Byte(1) shl index);\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TByteHelper.ClearBit(const index: TByteBitIndex) : Byte; inline;\r\n\r\nbegin\r\n  Self:=Self and not Byte((Byte(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TByteHelper.ToggleBit(const index: TByteBitIndex) : Byte; inline;\r\n\r\nbegin\r\n  Self := Self xor Byte((Byte(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TByteHelper.TestBit(const Index: TByteBitIndex):Boolean; inline;\r\n\r\nbegin\r\n  Result := (Self and Byte((Byte(1) shl index)))<>0;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TShortintHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nClass Function TShortIntHelper.Parse(const AString: string): ShortInt; inline;\r\n\r\nbegin\r\n  Result:=StrToInt(AString);\r\nend;\r\n\r\nClass Function TShortIntHelper.Size: Integer; inline;\r\n\r\nbegin\r\n  Result:=1;\r\nend;\r\n\r\nClass Function TShortIntHelper.ToString(const AValue: ShortInt): string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(AValue);\r\nend;\r\n\r\nClass Function TShortIntHelper.TryParse(const AString: string; out AValue: ShortInt): Boolean; inline;\r\n\r\nVar\r\n  C : Integer;\r\n\r\nbegin\r\n  Val(AString,AValue,C);\r\n  Result:=(C=0);\r\nend;\r\n\r\nFunction TShortIntHelper.ToBoolean: Boolean; inline;\r\n\r\nbegin\r\n  Result:=(Self<>0);\r\nend;\r\n\r\nFunction TShortIntHelper.ToDouble: Double; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TShortIntHelper.ToExtended: Extended; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TShortIntHelper.ToBinString: string; inline;\r\n\r\nbegin\r\n  Result:=BinStr(Self,Size*8);\r\nend;\r\n\r\nFunction TShortIntHelper.ToHexString(const AMinDigits: Integer): string; overload; inline;\r\n\r\nVar\r\n  B : Word;\r\n  U : TJSUInt8Array;\r\n  S : TJSInt8array;\r\n\r\nbegin\r\n  if Self>=0 then\r\n    B:=Self\r\n  else\r\n    begin\r\n    S:=TJSInt8Array.New(1);\r\n    S[0]:=Self;\r\n    U:=TJSUInt8Array.New(S);\r\n    B:=U[0];\r\n    if AMinDigits>2 then\r\n      B:=$FF00+B;\r\n    end;\r\n  Result:=IntToHex(B,AMinDigits);\r\nend;\r\n\r\nFunction TShortIntHelper.ToHexString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=ToHexString(Size*2);\r\nend;\r\n\r\nFunction TShortIntHelper.ToString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(Self);\r\nend;\r\n\r\nFunction TShortIntHelper.SetBit(const index: TShortIntBitIndex) : ShortInt; inline;\r\n\r\nbegin\r\n  Self := Self or (ShortInt(1) shl index);\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TShortIntHelper.ClearBit(const index: TShortIntBitIndex) : ShortInt; inline;\r\n\r\nbegin\r\n  Self:=Self and not ShortInt((ShortInt(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TShortIntHelper.ToggleBit(const index: TShortIntBitIndex) : ShortInt; inline;\r\n\r\nbegin\r\n  Self := Self xor ShortInt((ShortInt(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TShortIntHelper.TestBit(const Index: TShortIntBitIndex):Boolean; inline;\r\n\r\nbegin\r\n  Result := (Self and ShortInt((ShortInt(1) shl index)))<>0;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TSmallintHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nClass Function TSmallIntHelper.Parse(const AString: string): SmallInt; inline;\r\n\r\nbegin\r\n  Result:=StrToInt(AString);\r\nend;\r\n\r\nClass Function TSmallIntHelper.Size: Integer; inline;\r\n\r\nbegin\r\n  Result:=2;\r\nend;\r\n\r\nClass Function TSmallIntHelper.ToString(const AValue: SmallInt): string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(AValue);\r\nend;\r\n\r\nClass Function TSmallIntHelper.TryParse(const AString: string; out AValue: SmallInt): Boolean; inline;\r\n\r\nVar\r\n  C : Integer;\r\n\r\nbegin\r\n  Val(AString,AValue,C);\r\n  Result:=(C=0);\r\nend;\r\n\r\nFunction TSmallIntHelper.ToBoolean: Boolean; inline;\r\n\r\nbegin\r\n  Result:=(Self<>0);\r\nend;\r\n\r\nFunction TSmallIntHelper.ToDouble: Double; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TSmallIntHelper.ToExtended: Extended; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TSmallIntHelper.ToBinString: string; inline;\r\n\r\nbegin\r\n  Result:=BinStr(Self,Size*8);\r\nend;\r\n\r\nFunction TSmallIntHelper.ToHexString(const AMinDigits: Integer): string; overload; inline;\r\n\r\nVar\r\n  B : Cardinal;\r\n  U : TJSUInt16Array;\r\n  S : TJSInt16array;\r\n\r\n\r\nbegin\r\n  if Self>=0 then\r\n    B:=Self\r\n  else\r\n    begin\r\n    S:=TJSInt16Array.New(1);\r\n    S[0]:=Self;\r\n    U:=TJSUInt16Array.New(S);\r\n    B:=U[0];\r\n    if AMinDigits>6 then\r\n      B:=$FFFF0000+B\r\n    else if AMinDigits>4 then\r\n      B:=$FF0000+B;\r\n    end;\r\n  Result:=IntToHex(B,AMinDigits);\r\nend;\r\n\r\nFunction TSmallIntHelper.ToHexString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=ToHexString(Size*2);\r\nend;\r\n\r\n\r\nFunction TSmallIntHelper.ToString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(Self);\r\nend;\r\n\r\nFunction TSmallIntHelper.SetBit(const index: TSmallIntBitIndex) : SmallInt; inline;\r\n\r\nbegin\r\n  Self := Self or (SmallInt(1) shl index);\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TSmallIntHelper.ClearBit(const index: TSmallIntBitIndex) : SmallInt; inline;\r\n\r\nbegin\r\n  Self:=Self and not SmallInt((SmallInt(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TSmallIntHelper.ToggleBit(const index: TSmallIntBitIndex) : SmallInt; inline;\r\n\r\nbegin\r\n  Self := Self xor SmallInt((SmallInt(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TSmallIntHelper.TestBit(const Index: TSmallIntBitIndex):Boolean; inline;\r\n\r\nbegin\r\n  Result := (Self and SmallInt((SmallInt(1) shl index)))<>0;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TWordHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nClass Function TWordHelper.Parse(const AString: string): Word; inline;\r\n\r\nbegin\r\n  Result:=StrToInt(AString);\r\nend;\r\n\r\nClass Function TWordHelper.Size: Integer; inline;\r\n\r\nbegin\r\n  Result:=2;\r\nend;\r\n\r\nClass Function TWordHelper.ToString(const AValue: Word): string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(AValue);\r\nend;\r\n\r\nClass Function TWordHelper.TryParse(const AString: string; out AValue: Word): Boolean; inline;\r\n\r\nVar\r\n  C : Integer;\r\n\r\nbegin\r\n  Val(AString,AValue,C);\r\n  Result:=(C=0);\r\nend;\r\n\r\nFunction TWordHelper.ToBoolean: Boolean; inline;\r\n\r\nbegin\r\n  Result:=(Self<>0);\r\nend;\r\n\r\nFunction TWordHelper.ToDouble: Double; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TWordHelper.ToExtended: Extended; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TWordHelper.ToBinString: string; inline;\r\n\r\nbegin\r\n  Result:=BinStr(Self,Size*8);\r\nend;\r\n\r\nFunction TWordHelper.ToHexString(const AMinDigits: Integer): string;\r\noverload; inline;\r\n\r\nbegin\r\n  Result:=IntToHex(Self,AMinDigits);\r\nend;\r\n\r\nFunction TWordHelper.ToHexString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToHex(Self,Size*2);\r\nend;\r\n\r\n\r\nFunction TWordHelper.ToString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(Self);\r\nend;\r\n\r\nFunction TWordHelper.SetBit(const index: TWordBitIndex) : Word; inline;\r\n\r\nbegin\r\n  Self := Self or (Word(1) shl index);\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TWordHelper.ClearBit(const index: TWordBitIndex) : Word; inline;\r\n\r\nbegin\r\n  Self:=Self and not Word((Word(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TWordHelper.ToggleBit(const index: TWordBitIndex) : Word; inline;\r\n\r\nbegin\r\n  Self := Self xor Word((Word(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TWordHelper.TestBit(const Index: TWordBitIndex):Boolean; inline;\r\n\r\nbegin\r\n  Result := (Self and Word((Word(1) shl index)))<>0;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TCardinalHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nClass Function TCardinalHelper.Parse(const AString: string): Cardinal; inline;\r\n\r\nbegin\r\n  Result:=StrToInt(AString);\r\nend;\r\n\r\nClass Function TCardinalHelper.Size: Integer; inline;\r\n\r\nbegin\r\n  Result:=4;\r\nend;\r\n\r\nClass Function TCardinalHelper.ToString(const AValue: Cardinal): string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(AValue);\r\nend;\r\n\r\nClass Function TCardinalHelper.TryParse(const AString: string; out AValue: Cardinal): Boolean; inline;\r\n\r\nVar\r\n  C : Integer;\r\n\r\nbegin\r\n  Val(AString,AValue,C);\r\n  Result:=(C=0);\r\nend;\r\n\r\nFunction TCardinalHelper.ToBoolean: Boolean; inline;\r\n\r\nbegin\r\n  Result:=(Self<>0);\r\nend;\r\n\r\nFunction TCardinalHelper.ToDouble: Double; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TCardinalHelper.ToExtended: Extended; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TCardinalHelper.ToBinString: string; inline;\r\n\r\nbegin\r\n  Result:=BinStr(Self,Size*8);\r\nend;\r\n\r\nFunction TCardinalHelper.ToHexString(const AMinDigits: Integer): string;\r\noverload; inline;\r\n\r\nbegin\r\n  Result:=IntToHex(Self,AMinDigits);\r\nend;\r\n\r\nFunction TCardinalHelper.ToHexString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=ToHexString(Size*2);\r\nend;\r\n\r\nFunction TCardinalHelper.ToString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(Self);\r\nend;\r\n\r\nFunction TCardinalHelper.SetBit(const index: TCardinalBitIndex) : Cardinal; inline;\r\n\r\nbegin\r\n  Self := Self or (Cardinal(1) shl index);\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TCardinalHelper.ClearBit(const index: TCardinalBitIndex) : Cardinal; inline;\r\n\r\nbegin\r\n  Self:=Self and not Cardinal((Cardinal(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TCardinalHelper.ToggleBit(const index: TCardinalBitIndex) : Cardinal; inline;\r\n\r\nbegin\r\n  Self := Self xor Cardinal((Cardinal(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TCardinalHelper.TestBit(const Index: TCardinalBitIndex):Boolean; inline;\r\n\r\nbegin\r\n  Result := (Self and Cardinal((Cardinal(1) shl index)))<>0;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n  TIntegerHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nClass Function TIntegerHelper.Parse(const AString: string): Integer; inline;\r\n\r\nbegin\r\n  Result:=StrToInt(AString);\r\nend;\r\n\r\nClass Function TIntegerHelper.Size: Integer; inline;\r\n\r\nbegin\r\n  Result:=4;\r\nend;\r\n\r\nClass Function TIntegerHelper.ToString(const AValue: Integer): string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(AValue);\r\nend;\r\n\r\nClass Function TIntegerHelper.TryParse(const AString: string; out AValue: Integer): Boolean; inline;\r\n\r\nVar\r\n  C : Integer;\r\n\r\nbegin\r\n  Val(AString,AValue,C);\r\n  Result:=(C=0);\r\nend;\r\n\r\nFunction TIntegerHelper.ToBoolean: Boolean; inline;\r\n\r\nbegin\r\n  Result:=(Self<>0);\r\nend;\r\n\r\nFunction TIntegerHelper.ToDouble: Double; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TIntegerHelper.ToExtended: Extended; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TIntegerHelper.ToBinString: string; inline;\r\n\r\nbegin\r\n  Result:=BinStr(Self,Size*8);\r\nend;\r\n\r\nFunction TIntegerHelper.ToHexString(const AMinDigits: Integer): string;\r\noverload; inline;\r\n\r\n\r\nVar\r\n  B : Word;\r\n  U : TJSUInt32Array;\r\n  S : TJSInt32array;\r\n\r\nbegin\r\n  if Self>=0 then\r\n    B:=Self\r\n  else\r\n    begin\r\n    S:=TJSInt32Array.New(1);\r\n    S[0]:=Self;\r\n    U:=TJSUInt32Array.New(S);\r\n    B:=U[0];\r\n    end;\r\n  Result:=IntToHex(B,AMinDigits);\r\nend;\r\n\r\nFunction TIntegerHelper.ToHexString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=ToHexString(Size*2);\r\nend;\r\n\r\n\r\nFunction TIntegerHelper.ToString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(Self);\r\nend;\r\n\r\nFunction TIntegerHelper.SetBit(const index: TIntegerBitIndex) : Integer; inline;\r\n\r\nbegin\r\n  Self := Self or (Integer(1) shl index);\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TIntegerHelper.ClearBit(const index: TIntegerBitIndex) : Integer; inline;\r\n\r\nbegin\r\n  Self:=Self and not Integer((Integer(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TIntegerHelper.ToggleBit(const index: TIntegerBitIndex) : Integer; inline;\r\n\r\nbegin\r\n  Self := Self xor Integer((Integer(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TIntegerHelper.TestBit(const Index: TIntegerBitIndex):Boolean; inline;\r\n\r\nbegin\r\n  Result := (Self and Integer((Integer(1) shl index)))<>0;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n  TNativeIntHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nClass Function TNativeIntHelper.Parse(const AString: string): NativeInt; inline;\r\n\r\nbegin\r\n  Result:=StrToInt(AString);\r\nend;\r\n\r\nClass Function TNativeIntHelper.Size: Integer; inline;\r\n\r\nbegin\r\n  Result:=7;\r\nend;\r\n\r\nClass Function TNativeIntHelper.ToString(const AValue: NativeInt): string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(AValue);\r\nend;\r\n\r\nClass Function TNativeIntHelper.TryParse(const AString: string; out AValue: NativeInt): Boolean; inline;\r\n\r\nVar\r\n  C : Integer;\r\n\r\nbegin\r\n  Val(AString,AValue,C);\r\n  Result:=(C=0);\r\nend;\r\n\r\nFunction TNativeIntHelper.ToBoolean: Boolean; inline;\r\n\r\nbegin\r\n  Result:=(Self<>0);\r\nend;\r\n\r\nFunction TNativeIntHelper.ToDouble: Double; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TNativeIntHelper.ToExtended: Extended; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TNativeIntHelper.ToBinString: string; inline;\r\n\r\nbegin\r\n  Result:=BinStr(Self,Size*8);\r\nend;\r\n\r\nFunction TNativeIntHelper.ToHexString(const AMinDigits: Integer): string;\r\noverload; inline;\r\n\r\nbegin\r\n  Result:=IntToHex(Self,AMinDigits);\r\nend;\r\n\r\nFunction TNativeIntHelper.ToHexString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToHex(Self,Size*2);\r\nend;\r\n\r\nFunction TNativeIntHelper.ToString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(Self);\r\nend;\r\n\r\nFunction TNativeIntHelper.SetBit(const index: TNativeIntBitIndex) : NativeInt; inline;\r\n\r\nbegin\r\n  Self := Self or (NativeInt(1) shl index);\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TNativeIntHelper.ClearBit(const index: TNativeIntBitIndex) : NativeInt; inline;\r\n\r\nbegin\r\n  Self:=Self and not NativeInt((NativeInt(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TNativeIntHelper.ToggleBit(const index: TNativeIntBitIndex) : NativeInt; inline;\r\n\r\nbegin\r\n  Self := Self xor NativeInt((NativeInt(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TNativeIntHelper.TestBit(const Index: TNativeIntBitIndex):Boolean; inline;\r\n\r\nbegin\r\n  Result := (Self and NativeInt((NativeInt(1) shl index)))<>0;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n  TNativeUIntHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nClass Function TNativeUIntHelper.Parse(const AString: string): NativeUInt; inline;\r\n\r\nbegin\r\n  Result:=StrToInt(AString);\r\nend;\r\n\r\nClass Function TNativeUIntHelper.Size: Integer; inline;\r\n\r\nbegin\r\n  Result:=7;\r\nend;\r\n\r\nClass Function TNativeUIntHelper.ToString(const AValue: NativeUInt): string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(AValue);\r\nend;\r\n\r\nClass Function TNativeUIntHelper.TryParse(const AString: string; out AValue: NativeUInt): Boolean; inline;\r\n\r\nVar\r\n  C : Integer;\r\n\r\nbegin\r\n  Val(AString,AValue,C);\r\n  Result:=(C=0);\r\nend;\r\n\r\nFunction TNativeUIntHelper.ToBoolean: Boolean; inline;\r\n\r\nbegin\r\n  Result:=(Self<>0);\r\nend;\r\n\r\nFunction TNativeUIntHelper.ToDouble: Double; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TNativeUIntHelper.ToExtended: Extended; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TNativeUIntHelper.ToBinString: string; inline;\r\n\r\nbegin\r\n  Result:=BinStr(Self,Size*8);\r\nend;\r\n\r\nFunction TNativeUIntHelper.ToHexString(const AMinDigits: Integer): string;\r\noverload; inline;\r\n\r\nbegin\r\n  Result:=IntToHex(Self,AMinDigits);\r\nend;\r\n\r\nFunction TNativeUIntHelper.ToHexString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToHex(Self,Size*2);\r\nend;\r\n\r\nFunction TNativeUIntHelper.ToSingle: Single; inline;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TNativeUIntHelper.ToString: string; overload; inline;\r\n\r\nbegin\r\n  Result:=IntToStr(Self);\r\nend;\r\n\r\nFunction TNativeUIntHelper.SetBit(const index: TNativeUIntBitIndex) : NativeUInt; inline;\r\n\r\nbegin\r\n  Self := Self or (NativeUInt(1) shl index);\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TNativeUIntHelper.ClearBit(const index: TNativeUIntBitIndex) : NativeUInt; inline;\r\n\r\nbegin\r\n  Self:=Self and not NativeUInt((NativeUInt(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TNativeUIntHelper.ToggleBit(const index: TNativeUIntBitIndex) : NativeUInt; inline;\r\n\r\nbegin\r\n  Self := Self xor NativeUInt((NativeUInt(1) shl index));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TNativeUIntHelper.TestBit(const Index: TNativeUIntBitIndex):Boolean; inline;\r\n\r\nbegin\r\n  Result := (Self and NativeUInt((NativeUInt(1) shl index)))<>0;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TBooleanHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nClass Function TBooleanHelper.Parse(const S: string): Boolean; inline;\r\n\r\nbegin\r\n  Result:=StrToBool(S);\r\nend;\r\n\r\nClass Function TBooleanHelper.Size: Integer; inline;\r\n\r\nbegin\r\n  Result:=1;\r\nend;\r\n\r\nClass Function TBooleanHelper.ToString(const AValue: Boolean; UseBoolStrs: TUseBoolStrs = TUseBoolStrs.False): string; overload; inline;\r\n\r\nbegin\r\n  Result:=BoolToStr(AValue,UseBoolStrs=TUseBoolStrs.True);\r\nend;\r\n\r\nClass Function TBooleanHelper.TryToParse(const S: string; out AValue: Boolean): Boolean; inline;\r\n\r\nbegin\r\n  Result:=TryStrToBool(S,AValue);\r\nend;\r\n\r\nFunction TBooleanHelper.ToInteger: Integer; inline;\r\n\r\nbegin\r\n  Result:=Integer(Self);\r\nend;\r\n\r\nFunction TBooleanHelper.ToString(UseBoolStrs: TUseBoolStrs = TUseBoolStrs.False): string; overload; inline;\r\n\r\nbegin\r\n  Result:=BoolToStr(Self,UseBoolStrs=TUseBoolStrs.True);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TByteBoolHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nClass Function TByteBoolHelper.Parse(const S: string): Boolean; inline;\r\n\r\nbegin\r\n  Result:=StrToBool(S);\r\nend;\r\n\r\nClass Function TByteBoolHelper.Size: Integer; inline;\r\n\r\nbegin\r\n  Result:=1;\r\nend;\r\n\r\nClass Function TByteBoolHelper.ToString(const AValue: Boolean; UseBoolStrs: Boolean = False): string; overload; inline;\r\n\r\nbegin\r\n  Result:=BoolToStr(AValue,UseBoolStrs);\r\nend;\r\n\r\nClass Function TByteBoolHelper.TryToParse(const S: string; out AValue: Boolean): Boolean; inline;\r\n\r\nbegin\r\n  Result:=TryStrToBool(S,AValue);\r\nend;\r\n\r\nFunction TByteBoolHelper.ToInteger: Integer; inline;\r\n\r\nbegin\r\n  Result:=Integer(Self);\r\nend;\r\n\r\nFunction TByteBoolHelper.ToString(UseBoolStrs: Boolean = False): string; overload; inline;\r\n\r\nbegin\r\n  Result:=BoolToStr(Self,UseBoolStrs);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TWordBoolHelper\r\n  ---------------------------------------------------------------------}\r\n\r\nClass Function TWordBoolHelper.Parse(const S: string): Boolean; inline;\r\n\r\nbegin\r\n  Result:=StrToBool(S);\r\nend;\r\n\r\nClass Function TWordBoolHelper.Size: Integer; inline;\r\n\r\nbegin\r\n  Result:=2;\r\nend;\r\n\r\nClass Function TWordBoolHelper.ToString(const AValue: Boolean; UseBoolStrs: boolean = False): string; overload; inline;\r\n\r\nbegin\r\n  Result:=BoolToStr(AValue,UseBoolStrs);\r\nend;\r\n\r\nClass Function TWordBoolHelper.TryToParse(const S: string; out AValue: Boolean): Boolean; inline;\r\n\r\nbegin\r\n  Result:=TryStrToBool(S,AValue);\r\nend;\r\n\r\nFunction TWordBoolHelper.ToInteger: Integer; inline;\r\n\r\nbegin\r\n  Result:=Integer(Self);\r\nend;\r\n\r\nFunction TWordBoolHelper.ToString(UseBoolStrs: Boolean = False): string; overload; inline;\r\n\r\nbegin\r\n  Result:=BoolToStr(Self,UseBoolStrs);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TLongBoolHelper\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nClass Function TLongBoolHelper.Parse(const S: string): Boolean; inline;\r\n\r\nbegin\r\n  Result:=StrToBool(S);\r\nend;\r\n\r\nClass Function TLongBoolHelper.Size: Integer; inline;\r\n\r\nbegin\r\n  Result:=4;\r\nend;\r\n\r\nClass Function TLongBoolHelper.ToString(const AValue: Boolean; UseBoolStrs: Boolean = False): string; overload; inline;\r\n\r\nbegin\r\n  Result:=BoolToStr(AValue,UseBoolStrs);\r\nend;\r\n\r\nClass Function TLongBoolHelper.TryToParse(const S: string; out AValue: Boolean): Boolean; inline;\r\n\r\nbegin\r\n  Result:=TryStrToBool(S,AValue);\r\nend;\r\n\r\nFunction TLongBoolHelper.ToInteger: Integer; inline;\r\n\r\nbegin\r\n  Result:=Integer(Self);\r\nend;\r\n\r\nFunction TLongBoolHelper.ToString(UseBoolStrs: Boolean = False): string; overload; inline;\r\n\r\nbegin\r\n  Result:=BoolToStr(Self,UseBoolStrs);\r\nend;\r\n\r\n{ TStringBuilder }\r\n\r\nconstructor TStringBuilder.Create;\r\nbegin\r\n  Create(DefaultCapacity,Maxint);\r\nend;\r\n\r\nconstructor TStringBuilder.Create(const AValue: String; aCapacity: Integer);\r\nbegin\r\n  Create(aCapacity,Maxint);\r\n  if (system.Length(AValue)>0) then\r\n    Append(AValue);\r\nend;\r\n\r\n\r\nconstructor TStringBuilder.Create(const AValue: String; StartIndex, Alength,\r\n  aCapacity: Integer);\r\nbegin\r\n  Create(Copy(AValue,StartIndex+1,Alength), aCapacity);\r\nend;\r\n\r\nconstructor TStringBuilder.Create(aCapacity, aMaxCapacity: Integer);\r\nbegin\r\n  FMaxCapacity:=aMaxCapacity;\r\n  Capacity:=aCapacity;\r\nend;\r\n\r\nconstructor TStringBuilder.Create(aCapacity: Integer);\r\nbegin\r\n  Create(aCapacity,MaxInt);\r\nend;\r\n\r\nconstructor TStringBuilder.Create(const AValue: String);\r\nbegin\r\n  Create(aValue,DefaultCapacity);\r\nend;\r\n\r\n\r\n{ Property getter/setter }\r\n\r\nfunction TStringBuilder.GetLength: Integer;\r\nbegin\r\n  Result:=System.Length(FData);\r\nend;\r\n\r\nfunction TStringBuilder.GetCapacity: Integer;\r\nbegin\r\n  Result:=System.Length(FData);\r\nend;\r\n\r\nfunction TStringBuilder.GetC(Index: Integer): Char;\r\nbegin\r\n  CheckNegative(Index,'Index');\r\n  CheckRange(Index,0,Length);\r\n  Result:=FData[Index];\r\nend;\r\n\r\nprocedure TStringBuilder.SetC(Index: Integer; AValue: Char);\r\nbegin\r\n  CheckNegative(Index,'Index');\r\n  CheckRange(Index,0,Length-1);\r\n  FData[Index]:=AValue;\r\nend;\r\n\r\nprocedure TStringBuilder.SetLength(AValue: Integer);\r\n\r\nbegin\r\n  CheckNegative(AValue,'AValue');\r\n  CheckRange(AValue,0,MaxCapacity);\r\n  SetLength(FData,aValue);\r\nend;\r\n\r\n{ Check functions }\r\n\r\n\r\n\r\nprocedure TStringBuilder.CheckRange(Idx, Count, MaxLen: Integer);\r\n\r\nbegin\r\n  if (Idx<0) or (Idx+Count>MaxLen) then\r\n    Raise ERangeError.CreateFmt(SListIndexError,[Idx]);\r\nend;\r\n\r\n\r\nprocedure TStringBuilder.CheckNegative(const AValue: Integer;\r\n  const AName: String);\r\n\r\nbegin\r\n  if (AValue<0) then\r\n    Raise ERangeError.CreateFmt(SParamIsNegative,[AName])\r\nend;\r\n\r\n{  These do the actual Appending/Inserting }\r\n\r\nprocedure TStringBuilder.DoAppend(const S: String);\r\n\r\nbegin\r\n  FData:=FData+S;\r\nend;\r\n\r\nprocedure TStringBuilder.DoAppend(const AValue: Array of Char; Idx, aCount: Integer\r\n  );\r\n\r\nVar\r\n  S : String;\r\n  I : Integer;\r\n\r\nbegin\r\n  S:='';\r\n  CheckRange(Idx,aCount,System.Length(AValue));\r\n  for I:=Idx to Idx+aCount-1 do\r\n    S:=S+aValue[I];\r\n  DoAppend(S);\r\nend;\r\n\r\nprocedure TStringBuilder.DoInsert(Index: Integer; const AValue: String);\r\n\r\nbegin\r\n  CheckRange(Index,0,Length-1);\r\n  System.Insert(aValue,FData,Index+1);\r\nend;\r\n\r\nprocedure TStringBuilder.DoInsert(Index: Integer; const AValue: Array of Char;\r\n  StartIndex, aCharCount: Integer);\r\n\r\nVar\r\n  I : Integer;\r\n  S : String;\r\n\r\nbegin\r\n  CheckRange(Index,0,Length-1);\r\n  CheckNegative(StartIndex,'StartIndex');\r\n  CheckNegative(aCharCount,'SBCharCount');\r\n  CheckRange(StartIndex,aCharCount,System.Length(AValue));\r\n  S:='';\r\n  for I:=StartIndex to StartIndex+aCharCount-1 do\r\n    S:=S+aValue[I];\r\n  DoInsert(Index,S);\r\nend;\r\n\r\n{ Public routines for appending }\r\n\r\nfunction TStringBuilder.Append(const AValue: UInt64): TStringBuilder;\r\nbegin\r\n  DoAppend(IntToStr(AValue));\r\n  Result:=self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: Array of Char): TStringBuilder;\r\n\r\nvar\r\n  I,L: Integer;\r\n\r\nbegin\r\n  I:=-1;\r\n  L:=System.Length(AValue);\r\n  If L=0 then\r\n    Exit(Self);\r\n  Repeat\r\n    Inc(I);\r\n  Until (I>=L) or (AValue[I]=#0);\r\n  DoAppend(AValue,0,I);\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: Single): TStringBuilder;\r\nbegin\r\n  DoAppend(FloatToStr(AValue));\r\n  Result:=self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: Word): TStringBuilder;\r\nbegin\r\n  Append(IntToStr(AValue));\r\n  Result:=self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: Cardinal): TStringBuilder;\r\nbegin\r\n  DoAppend(IntToStr(AValue));\r\n  Result:=self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: Char; RepeatCount: Integer\r\n  ): TStringBuilder;\r\nbegin\r\n  DoAppend(StringOfChar(AValue,RepeatCount));\r\n  Result:=Self;\r\nend;\r\n\r\n\r\nfunction TStringBuilder.Append(const AValue: Shortint): TStringBuilder;\r\nbegin\r\n  DoAppend(IntToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: Char): TStringBuilder;\r\nbegin\r\n  DoAppend(AValue);\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: Currency): TStringBuilder;\r\nbegin\r\n  DoAppend(CurrToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: Boolean): TStringBuilder;\r\nbegin\r\n  DoAppend(BoolToStr(AValue, True));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: Byte): TStringBuilder;\r\nbegin\r\n  DoAppend(IntToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: Int64): TStringBuilder;\r\nbegin\r\n  DoAppend(IntToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: TObject): TStringBuilder;\r\nbegin\r\n  DoAppend(AValue.ToString);\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: Smallint): TStringBuilder;\r\nbegin\r\n  DoAppend(IntToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: LongInt): TStringBuilder;\r\nbegin\r\n  DoAppend(IntToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TStringBuilder.Append(const AValue: Array of Char; StartIndex, SBCharCount: Integer): TStringBuilder;\r\n\r\nbegin\r\n  DoAppend(AValue,StartIndex,SBCharCount);\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TStringBuilder.Append(const AValue: String; StartIndex, Count: Integer): TStringBuilder;\r\n\r\nbegin\r\n  CheckRange(StartIndex,Count,System.Length(AValue));\r\n  DoAppend(Copy(AValue,StartIndex+1,Count));\r\n  Result:=Self;\r\nend;\r\n\r\n\r\nfunction TStringBuilder.Append(const AValue: String): TStringBuilder;\r\nbegin\r\n  DoAppend(AValue);\r\n  Result:=Self;\r\nend;\r\n\r\n\r\nfunction TStringBuilder.AppendFormat(const Fmt: String;\r\n  const Args: array of const): TStringBuilder;\r\nbegin\r\n  DoAppend(Format(Fmt,Args));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const Fmt: String;\r\n  const Args: array of const): TStringBuilder;\r\nbegin\r\n  DoAppend(Format(Fmt,Args));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.AppendLine: TStringBuilder;\r\nbegin\r\n  DoAppend(sLineBreak);\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.AppendLine(const AValue: String): TStringBuilder;\r\nbegin\r\n  DoAppend(AValue);\r\n  Result:=AppendLine();\r\nend;\r\n\r\nprocedure TStringBuilder.Clear;\r\nbegin\r\n  Length:=0;\r\n  Capacity:=DefaultCapacity;\r\nend;\r\n\r\n\r\nprocedure TStringBuilder.CopyTo(SourceIndex: Integer;\r\n  Var Destination: Array of Char; DestinationIndex: Integer; Count: Integer);\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  CheckNegative(Count,'Count');\r\n  CheckNegative(DestinationIndex,'DestinationIndex');\r\n  CheckRange(DestinationIndex,Count,System.Length(Destination));\r\n  if Count>0 then\r\n    begin\r\n    CheckRange(SourceIndex,Count,Length);\r\n    For I:=SourceIndex+1 to SourceIndex+Count do\r\n      Destination[DestinationIndex]:=FData[I];\r\n    end;\r\nend;\r\n\r\n\r\nfunction TStringBuilder.EnsureCapacity(aCapacity: Integer): Integer;\r\nbegin\r\n  CheckRange(aCapacity,0,MaxCapacity);\r\n  if Capacity<aCapacity then\r\n    Capacity:=aCapacity;\r\n  Result:=Capacity;\r\nend;\r\n\r\nfunction TStringBuilder.Equals(StringBuilder: TStringBuilder): Boolean;\r\nbegin\r\n  Result:=(StringBuilder<>nil);\r\n  if Result then\r\n    Result:=(Length=StringBuilder.Length)\r\n             and (MaxCapacity=StringBuilder.MaxCapacity)\r\n             and (FData=StringBuilder.FData[0]);\r\nend;\r\n\r\nprocedure TStringBuilder.Grow;\r\n\r\nvar\r\n  NewCapacity: SizeInt;\r\n\r\nbegin\r\n  NewCapacity:=Capacity*2;\r\n  if NewCapacity>MaxCapacity then\r\n    NewCapacity:=MaxCapacity;\r\n  Capacity:=NewCapacity;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: TObject\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,AValue.ToString());\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: Int64\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,IntToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: Single\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,FloatToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: String\r\n  ): TStringBuilder;\r\n\r\nbegin\r\n  DoInsert(Index,AValue);\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: Word\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,IntToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: Shortint\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index, IntToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: Currency\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,CurrToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: Char\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,AValue);\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: Byte\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,IntToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: LongInt\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,IntToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: Smallint\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,IntToStr(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: Boolean\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,BoolToStr(AValue,True));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: String;\r\n  const aRepeatCount: Integer): TStringBuilder;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  for I:=0 to aRepeatCount-1 do\r\n    DoInsert(Index,AValue);\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: Array of Char\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,AValue,0,System.Length(AValue));\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: Array of Char;\r\n  startIndex: Integer; SBCharCount: Integer): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,AValue,StartIndex,SBCharCount);\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: Cardinal\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,IntToStr(AValue));\r\n  Result:=self;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(Index: Integer; const AValue: UInt64\r\n  ): TStringBuilder;\r\nbegin\r\n  DoInsert(Index,IntToStr(AValue));\r\n  Result:=self;\r\nend;\r\n\r\nprocedure TStringBuilder.Shrink;\r\n\r\nbegin\r\n  if (Capacity div 4)>=Length then\r\n    Capacity:=Capacity div 2;\r\nend;\r\n\r\nfunction TStringBuilder.Remove(StartIndex: Integer; RemLength: Integer\r\n  ): TStringBuilder;\r\n\r\nVar\r\n  MoveIndex : Integer;\r\n\r\nbegin\r\n  if (RemLength=0) then\r\n    exit(Self);\r\n  CheckNegative(RemLength,'RemLength');\r\n  CheckRange(StartIndex,0,Length);\r\n  MoveIndex:=StartIndex+RemLength;\r\n  CheckRange(MoveIndex,0,Length);\r\n  Delete(FData,StartIndex+1,RemLength);\r\n  Shrink;\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TStringBuilder.Replace(const OldValue, NewValue: String; StartIndex, Count: Integer): TStringBuilder;\r\n\r\nvar\r\n  I : Integer;\r\n  Start : String;\r\n\r\nbegin\r\n  if Count=0 then\r\n    Exit(Self);\r\n  // Some checks.\r\n  CheckNegative(StartIndex,'StartIndex');\r\n  CheckNegative(Count,'Count');\r\n  CheckRange(Startindex,Count,Length);\r\n  // Init\r\n  Start:=Copy(FData,1,StartIndex+1);\r\n  FData:=Copy(FData,StartIndex+1);\r\n  For I:=1 to Count do\r\n    FData:=StringReplace(FData,OldValue,NewValue,[]);\r\n  FData:=Start+FData;\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TStringBuilder.Replace(const OldValue, NewValue: String): TStringBuilder;\r\nbegin\r\n  Result:=Replace(OldValue,NewValue,0,Length);\r\nend;\r\n\r\nprocedure TStringBuilder.SetCapacity(AValue: Integer);\r\nbegin\r\n  if (AValue>FMaxCapacity) then\r\n    Raise ERangeError.CreateFmt(SListCapacityError,[AValue]);\r\n  if (AValue<Length) then\r\n    Raise ERangeError.CreateFmt(SListCapacityError,[AValue]);\r\n  // No-op\r\nend;\r\n\r\nfunction TStringBuilder.ToString: String;\r\nbegin\r\n  Result:=ToString(0,Length);\r\nend;\r\n\r\nfunction TStringBuilder.ToString(aStartIndex: Integer; aLength: Integer\r\n  ): String;\r\nbegin\r\n  CheckNegative(aStartIndex,'aStartIndex');\r\n  CheckNegative(aLength,'aLength');\r\n  CheckRange(aStartIndex,aLength,Length);\r\n  Writeln('FData : ',FData);\r\n  Result:=Copy(FData,1+aStartIndex,aStartIndex+aLength);\r\nend;\r\n\r\nprocedure TStringBuilder.DoReplace(Index: Integer; const Old, New: String);\r\n\r\nvar\r\n  OVLen : Integer;\r\n\r\nbegin\r\n  OVLen:=System.Length(Old);\r\n  System.Delete(FData,Index+1,OVLen);\r\n  System.Insert(New,FData,Index+1);\r\nend;\r\n\r\ninitialization\r\n  ShortMonthNames:=DefaultShortMonthNames;\r\n  LongMonthNames:=DefaultLongMonthNames;\r\n  ShortDayNames:=DefaultShortDayNames;\r\n  LongDayNames:=DefaultLongDayNames;\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2018 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit TypInfo;\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils, Types, RTLConsts, JS;\r\n\r\ntype\r\n  // TCallConv for compatibility with Delphi/FPC, ignored under pas2js\r\n  TCallConv = (ccReg, ccCdecl, ccPascal, ccStdCall, ccSafeCall, ccCppdecl,\r\n    ccFar16, ccOldFPCCall, ccInternProc, ccSysCall, ccSoftFloat, ccMWPascal);\r\n\r\n\r\n  { TSectionRTTI }\r\n  TSectionRTTI = class external name 'rtl.tSectionRTTI'(TJSObject)\r\n  end;\r\n\r\n  { TTypeInfoModule }\r\n\r\n  TTypeInfoModule = class external name 'pasmodule'(TJSObject)\r\n  public\r\n    Name: String external name '$name';\r\n    RTTI: TSectionRTTI external name '$rtti';\r\n  end;\r\n\r\n  TTypeInfoAttributes = type TJSValueDynArray;\r\n\r\n  { TTypeInfo }\r\n\r\n  TTypeInfo = class external name 'rtl.tTypeInfo'\r\n  public\r\n    Name: String external name 'name';\r\n    Kind: TTypeKind external name 'kind';\r\n    Attributes: TTypeInfoAttributes external name 'attr'; // can be nil\r\n    Module: TTypeInfoModule external name '$module'; // can be nil\r\n  end;\r\n  TTypeInfoClassOf = class of TTypeInfo;\r\n\r\n  PTypeInfo = Pointer; // for compatibility with Delphi/FPC, under pas2js it is a TTypeInfo\r\n\r\n  TOrdType  = (\r\n    otSByte,      // 0\r\n    otUByte,      // 1\r\n    otSWord,      // 2\r\n    otUWord,      // 3\r\n    otSLong,      // 4\r\n    otULong,      // 5\r\n    otSIntDouble, // 6 NativeInt\r\n    otUIntDouble  // 7 NativeUInt\r\n    );\r\n\r\n  { TTypeInfoInteger - Kind = tkInteger }\r\n\r\n  TTypeInfoInteger = class external name 'rtl.tTypeInfoInteger'(TTypeInfo)\r\n  public\r\n    MinValue: NativeInt external name 'minvalue';\r\n    MaxValue: NativeInt external name 'maxvalue';\r\n    OrdType : TOrdType external name 'ordtype';\r\n  end;\r\n\r\n  { TEnumType }\r\n\r\n  TEnumType = class external name 'anonymous'\r\n  private\r\n    function GetIntToName(Index: NativeInt): String; external name '[]';\r\n    function GetNameToInt(Name: String): NativeInt; external name '[]';\r\n  public\r\n    property IntToName[Index: NativeInt]: String read GetIntToName;\r\n    property NameToInt[Name: String]: NativeInt read GetNameToInt;\r\n  end;\r\n\r\n  { TTypeInfoEnum - Kind = tkEnumeration }\r\n\r\n  TTypeInfoEnum = class external name 'rtl.tTypeInfoEnum'(TTypeInfoInteger)\r\n  public\r\n    // not supported: BaseType: TTypeInfo\r\n    EnumType: TEnumType external name 'enumtype';\r\n  end;\r\n\r\n  { TTypeInfoSet - Kind = tkSet }\r\n\r\n  TTypeInfoSet = class external name 'rtl.tTypeInfoSet'(TTypeInfo)\r\n  public\r\n    // not supported: BaseType: TTypeInfo\r\n    CompType: TTypeInfo external name 'comptype';\r\n  end;\r\n\r\n  { TTypeInfoStaticArray - Kind = tkArray }\r\n\r\n  TTypeInfoStaticArray = class external name 'rtl.tTypeInfoStaticArray'(TTypeInfo)\r\n  public\r\n    Dims: TIntegerDynArray external name 'dims';\r\n    ElType: TTypeInfo external name 'eltype';\r\n  end;\r\n\r\n  { TTypeInfoDynArray - Kind = tkDynArray }\r\n\r\n  TTypeInfoDynArray = class external name 'rtl.tTypeInfoDynArray'(TTypeInfo)\r\n  public\r\n    ElType: TTypeInfo external name 'eltype';\r\n  end;\r\n\r\n  TParamFlag     = (\r\n    pfVar,     // 2^0 = 1\r\n    pfConst,   // 2^1 = 2\r\n    pfOut,     // 2^2 = 4\r\n    pfArray,   // 2^3 = 8\r\n    pfAddress, // 2^4 = 16\r\n    pfReference // 2^5 = 32\r\n    );\r\n  TParamFlags = set of TParamFlag;\r\n\r\n  { TProcedureParam }\r\n\r\n  TProcedureParam = class external name 'anonymous'\r\n  public\r\n    Name: String external name 'name';\r\n    TypeInfo: TTypeInfo external name 'typeinfo';\r\n    Flags: NativeInt external name 'flags'; // TParamFlags as bit vector\r\n  end;\r\n\r\n  TProcedureParams = array of TProcedureParam;\r\n\r\n  TProcedureFlag = (\r\n    pfStatic,   // 2^0 = 1\r\n    pfVarargs,  // 2^1 = 2\r\n    pfExternal, // 2^2 = 4  name may be an expression\r\n    pfSafeCall, // 2^3 = 8\r\n    pfAsync     // 2^4 = 16\r\n    );\r\n  TProcedureFlags = set of TProcedureFlag;\r\n\r\n  { TProcedureSignature }\r\n\r\n  TProcedureSignature = class external name 'anonymous'\r\n  public\r\n    Params: TProcedureParams external name 'params'; // can be nil\r\n    ResultType: TTypeInfo external name 'resulttype'; // can be nil\r\n    Flags: NativeInt external name 'flags'; // TProcedureFlags as bit vector\r\n  end;\r\n\r\n  { TTypeInfoProcVar - Kind = tkProcVar }\r\n\r\n  TTypeInfoProcVar = class external name 'rtl.tTypeInfoProcVar'(TTypeInfo)\r\n  public\r\n    ProcSig: TProcedureSignature external name 'procsig';\r\n  end;\r\n\r\n  { TTypeInfoRefToProcVar - Kind = tkRefToProcVar }\r\n\r\n  TTypeInfoRefToProcVar = class external name 'rtl.tTypeInfoRefToProcVar'(TTypeInfoProcVar)\r\n  end;\r\n\r\n  TMethodKind = (\r\n    mkProcedure,     // 0  default\r\n    mkFunction,      // 1\r\n    mkConstructor,   // 2\r\n    mkDestructor,    // 3\r\n    mkClassProcedure,// 4\r\n    mkClassFunction  // 5\r\n    //mkClassConstructor,mkClassDestructor,mkOperatorOverload\r\n    );\r\n  TMethodKinds = set of TMethodKind;\r\n\r\n  { TTypeInfoMethodVar - Kind = tkMethod }\r\n\r\n  TTypeInfoMethodVar = class external name 'rtl.tTypeInfoMethodVar'(TTypeInfoProcVar)\r\n  public\r\n    MethodKind: TMethodKind external name 'methodkind';\r\n  end;\r\n\r\n  TTypeMemberKind = (\r\n    tmkUnknown,  // 0\r\n    tmkField,    // 1\r\n    tmkMethod,   // 2\r\n    tmkProperty  // 3\r\n    );\r\n  TTypeMemberKinds = set of TTypeMemberKind;\r\n\r\n  { TTypeMember }\r\n\r\n  TTypeMember = class external name 'rtl.tTypeMember'\r\n  public\r\n    Name: String external name 'name';\r\n    Kind: TTypeMemberKind external name 'kind';\r\n    Attributes: TTypeInfoAttributes external name 'attr'; // can be nil\r\n  end;\r\n  TTypeMemberDynArray = array of TTypeMember;\r\n\r\n  { TTypeMemberField - Kind = tmkField }\r\n\r\n  TTypeMemberField = class external name 'rtl.tTypeMemberField'(TTypeMember)\r\n  public\r\n    TypeInfo: TTypeInfo external name 'typeinfo';\r\n  end;\r\n\r\n  { TTypeMemberMethod - Kind = tmkMethod }\r\n\r\n  TTypeMemberMethod = class external name 'rtl.tTypeMemberMethod'(TTypeMember)\r\n  public\r\n    MethodKind: TMethodKind external name 'methodkind';\r\n    ProcSig: TProcedureSignature external name 'procsig';\r\n  end;\r\n  TTypeMemberMethodDynArray = array of TTypeMemberMethod;\r\n\r\nconst\r\n  pfGetFunction = 1; // getter is a function\r\n  pfSetProcedure = 2; // setter is a procedure\r\n  // stored is a 2-bit vector:\r\n  pfStoredFalse = 4; // stored false, never\r\n  pfStoredField = 8; // stored field, field name is in Stored\r\n  pfStoredFunction = 12; // stored function, function name is in Stored\r\n  pfHasIndex = 16; { if getter is function, append Index as last param\r\n                     if setter is function, append Index as second last param }\r\ntype\r\n  { TTypeMemberProperty - Kind = tmkProperty }\r\n\r\n  TTypeMemberProperty = class external name 'rtl.tTypeMemberProperty'(TTypeMember)\r\n  public\r\n    TypeInfo: TTypeInfo external name 'typeinfo';\r\n    Flags: NativeInt external name 'flags'; // bit vector, see pf constants above\r\n    Params: TProcedureParams external name 'params'; // can be nil\r\n    Index: JSValue external name 'index'; // can be undefined\r\n    Getter: String external name 'getter'; // name of field or function\r\n    Setter: String external name 'setter'; // name of field or function\r\n    Stored: String external name 'stored'; // name of field or function, can be undefined\r\n    Default: JSValue external name 'Default'; // can be undefined\r\n  end;\r\n  TTypeMemberPropertyDynArray = array of TTypeMemberProperty;\r\n\r\n  { TTypeMembers }\r\n\r\n  TTypeMembers = class external name 'rtl.tTypeMembers'\r\n  private\r\n    function GetItems(Name: String): TTypeMember; external name '[]';\r\n    procedure SetItems(Name: String; const AValue: TTypeMember); external name '[]';\r\n  public\r\n    property Members[Name: String]: TTypeMember read GetItems write SetItems; default;\r\n  end;\r\n\r\n  { TTypeInfoStruct }\r\n\r\n  TTypeInfoStruct = class external name 'rtl.tTypeInfoStruct'(TTypeInfo)\r\n  private\r\n    FFieldCount: NativeInt external name 'fields.length';\r\n    FMethodCount: NativeInt external name 'methods.length';\r\n    FPropCount: NativeInt external name 'properties.length';\r\n  public\r\n    Members: TTypeMembers external name 'members';\r\n    Names: TStringDynArray external name 'names'; // all member names with TTypeInfo\r\n    Fields: TStringDynArray external name 'fields';\r\n    Methods: TStringDynArray external name 'methods';\r\n    Properties: TStringDynArray external name 'properties';\r\n    property FieldCount: NativeInt read FFieldCount;\r\n    function GetField(Index: NativeInt): TTypeMemberField; external name 'getField';\r\n    function AddField(aName: String; aType: TTypeInfo; Options: TJSObject = nil\r\n      ): TTypeMemberField; external name 'addField';\r\n    property MethodCount: NativeInt read FMethodCount;\r\n    function GetMethod(Index: NativeInt): TTypeMemberMethod; external name 'getMethod';\r\n    function AddMethod(aName: String; MethodKind: TMethodKind = mkProcedure;\r\n      Params: TJSArray = nil; ResultType: TTypeInfo = nil;\r\n      Options: TJSObject = nil): TTypeMemberMethod; external name 'addMethod';\r\n    property PropCount: NativeInt read FPropCount;\r\n    function GetProp(Index: NativeInt): TTypeMemberProperty; external name 'getProperty';\r\n    function AddProperty(aName: String; Flags: NativeInt; ResultType: TTypeInfo;\r\n      Getter, Setter: String; Options: TJSObject = nil): TTypeMemberProperty; external name 'addProperty';\r\n  end;\r\n\r\n  { TTypeInfoRecord - Kind = tkRecord }\r\n\r\n  TTypeInfoRecord = class external name 'rtl.tTypeInfoRecord'(TTypeInfoStruct)\r\n  public\r\n    RecordType: TJSObject external name '$record';  // only records with class vars, else jsundefined\r\n  end;\r\n\r\n  { TTypeInfoClass - Kind = tkClass }\r\n\r\n  TTypeInfoClass = class external name 'rtl.tTypeInfoClass'(TTypeInfoStruct)\r\n  public\r\n    ClassType: TClass external name 'class';\r\n    Ancestor: TTypeInfoClass external name 'ancestor';\r\n  end;\r\n\r\n  { TTypeInfoExtClass - Kind = tkExtClass }\r\n\r\n  TTypeInfoExtClass = class external name 'rtl.tTypeInfoExtClass'(TTypeInfo)\r\n  public\r\n    Ancestor: TTypeInfoExtClass external name 'ancestor';\r\n    JSClassName: String external name 'jsclass';\r\n  end;\r\n\r\n  { TTypeInfoClassRef - class-of, Kind = tkClassRef }\r\n\r\n  TTypeInfoClassRef = class external name 'rtl.tTypeInfoClassRef'(TTypeInfo)\r\n  public\r\n    InstanceType: TTypeInfo external name 'instancetype';\r\n  end;\r\n\r\n  { TTypeInfoPointer - Kind = tkPointer }\r\n\r\n  TTypeInfoPointer = class external name 'rtl.tTypeInfoPointer'(TTypeInfo)\r\n  public\r\n    RefType: TTypeInfo external name 'reftype'; // can be null\r\n  end;\r\n\r\n  { TTypeInfoInterface - Kind = tkInterface }\r\n\r\n  TTypeInfoInterface = class external name 'rtl.tTypeInfoInterface'(TTypeInfoStruct)\r\n  public\r\n    InterfaceType: TJSObject external name 'interface';\r\n    Ancestor: TTypeInfoInterface external name 'ancestor';\r\n  end;\r\n\r\n  { TTypeInfoHelper - Kind = tkHelper }\r\n\r\n  TTypeInfoHelper = class external name 'rtl.tTypeInfoHelper'(TTypeInfoStruct)\r\n  public\r\n    HelperType: TJSObject external name 'helper';\r\n    Ancestor: TTypeInfoHelper external name 'ancestor';\r\n    HelperFor: TTypeInfo external name 'helperfor';\r\n  end;\r\n\r\n  EPropertyError  = class(Exception);\r\n\r\nfunction GetTypeName(TypeInfo: TTypeInfo): string;\r\n\r\nfunction GetClassMembers(aTIStruct: TTypeInfoStruct): TTypeMemberDynArray;\r\nfunction GetClassMember(aTIStruct: TTypeInfoStruct; const aName: String): TTypeMember;\r\nfunction GetInstanceMethod(Instance: TObject; const aName: String): Pointer;\r\nfunction GetClassMethods(aTIStruct: TTypeInfoStruct): TTypeMemberMethodDynArray;\r\nfunction CreateMethod(Instance: TObject; FuncName: String): Pointer; external name 'rtl.createCallback';\r\n\r\nfunction GetInterfaceMembers(aTIInterface: TTypeInfoInterface): TTypeMemberDynArray;\r\nfunction GetInterfaceMember(aTIInterface: TTypeInfoInterface; const aName: String): TTypeMember;\r\nfunction GetInterfaceMethods(aTIInterface: TTypeInfoInterface): TTypeMemberMethodDynArray;\r\n\r\nfunction GetRTTIAttributes(const Attributes: TTypeInfoAttributes): TCustomAttributeArray;\r\n\r\nfunction GetPropInfos(aTIStruct: TTypeInfoStruct): TTypeMemberPropertyDynArray;\r\nfunction GetPropList(aTIStruct: TTypeInfoStruct; TypeKinds: TTypeKinds; Sorted: boolean = true): TTypeMemberPropertyDynArray;\r\nfunction GetPropList(aTIStruct: TTypeInfoStruct): TTypeMemberPropertyDynArray;\r\nfunction GetPropList(AClass: TClass): TTypeMemberPropertyDynArray;\r\nfunction GetPropList(Instance: TObject): TTypeMemberPropertyDynArray;\r\n\r\nfunction GetPropInfo(TI: TTypeInfoStruct; const PropName: String): TTypeMemberProperty;\r\nfunction GetPropInfo(TI: TTypeInfoStruct; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\nfunction GetPropInfo(Instance: TObject; const PropName: String): TTypeMemberProperty;\r\nfunction GetPropInfo(Instance: TObject; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\nfunction GetPropInfo(aClass: TClass; const PropName: String): TTypeMemberProperty;\r\nfunction GetPropInfo(aClass: TClass; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\n\r\nfunction FindPropInfo(Instance: TObject; const PropName: String): TTypeMemberProperty;\r\nfunction FindPropInfo(Instance: TObject; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\nfunction FindPropInfo(aClass: TClass; const PropName: String): TTypeMemberProperty;\r\nfunction FindPropInfo(aClass: TClass; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\n\r\n// Property information routines.\r\nFunction IsStoredProp(Instance: TObject; const PropInfo: TTypeMemberProperty): Boolean;\r\nFunction IsStoredProp(Instance: TObject; const PropName: string): Boolean;\r\nfunction IsPublishedProp(Instance: TObject; const PropName: String): Boolean;\r\nfunction IsPublishedProp(aClass: TClass; const PropName: String): Boolean;\r\nfunction PropType(Instance: TObject; const PropName: string): TTypeKind;\r\nfunction PropType(aClass: TClass; const PropName: string): TTypeKind;\r\nfunction PropIsType(Instance: TObject; const PropName: string; const TypeKind: TTypeKind): Boolean;\r\nfunction PropIsType(aClass: TClass; const PropName: string; const TypeKind: TTypeKind): Boolean;\r\n\r\nfunction GetJSValueProp(Instance: TJSObject; TI: TTypeInfoStruct; const PropName: String): JSValue;\r\nfunction GetJSValueProp(Instance: TJSObject; const PropInfo: TTypeMemberProperty): JSValue;\r\nfunction GetJSValueProp(Instance: TObject; const PropName: String): JSValue;\r\nfunction GetJSValueProp(Instance: TObject; const PropInfo: TTypeMemberProperty): JSValue;\r\nprocedure SetJSValueProp(Instance: TJSObject; TI: TTypeInfoStruct; const PropName: String; Value: JSValue);\r\nprocedure SetJSValueProp(Instance: TJSObject; const PropInfo: TTypeMemberProperty; Value: JSValue);\r\nprocedure SetJSValueProp(Instance: TObject; const PropName: String; Value: JSValue);\r\nprocedure SetJSValueProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: JSValue);\r\n\r\nfunction GetNativeIntProp(Instance: TObject; const PropName: String): NativeInt;\r\nfunction GetNativeIntProp(Instance: TObject; const PropInfo: TTypeMemberProperty): NativeInt;\r\nprocedure SetNativeIntProp(Instance: TObject; const PropName: String; Value: NativeInt);\r\nprocedure SetNativeIntProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: NativeInt);\r\n\r\nfunction GetOrdProp(Instance: TObject; const PropName: String): longint;\r\nfunction GetOrdProp(Instance: TObject; const PropInfo: TTypeMemberProperty): longint;\r\nprocedure SetOrdProp(Instance: TObject; const PropName: String; Value: longint);\r\nprocedure SetOrdProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: longint);\r\n\r\nfunction GetEnumProp(Instance: TObject; const PropName: String): String;\r\nfunction GetEnumProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String;\r\nprocedure SetEnumProp(Instance: TObject; const PropName: String; const Value: String);\r\nprocedure SetEnumProp(Instance: TObject; const PropInfo: TTypeMemberProperty; const Value: String);\r\n// Auxiliary routines, which may be useful\r\nfunction GetEnumName(TypeInfo: TTypeInfoEnum; Value: Integer): String;\r\nfunction GetEnumValue(TypeInfo: TTypeInfoEnum; const Name: string): Longint;\r\nfunction GetEnumNameCount(TypeInfo: TTypeInfoEnum): Longint;\r\n\r\nfunction GetSetProp(Instance: TObject; const PropName: String): String; overload;\r\nfunction GetSetProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String; overload;\r\nfunction GetSetPropArray(Instance: TObject; const PropName: String): TIntegerDynArray; overload;\r\nfunction GetSetPropArray(Instance: TObject; const PropInfo: TTypeMemberProperty): TIntegerDynArray; overload;\r\nprocedure SetSetPropArray(Instance: TObject; const PropName: String; const Arr: TIntegerDynArray); overload;\r\nprocedure SetSetPropArray(Instance: TObject; const PropInfo: TTypeMemberProperty; const Arr: TIntegerDynArray); overload;\r\n\r\nfunction GetBoolProp(Instance: TObject; const PropName: String): boolean;\r\nfunction GetBoolProp(Instance: TObject; const PropInfo: TTypeMemberProperty): boolean;\r\nprocedure SetBoolProp(Instance: TObject; const PropName: String; Value: boolean);\r\nprocedure SetBoolProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: boolean);\r\n\r\nfunction GetStrProp(Instance: TObject; const PropName: String): String;\r\nfunction GetStrProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String;\r\nprocedure SetStrProp(Instance: TObject; const PropName: String; Value: String);\r\nprocedure SetStrProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: String);\r\n\r\nfunction GetStringProp(Instance: TObject; const PropName: String): String; deprecated; // use GetStrProp\r\nfunction GetStringProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String; deprecated; // use GetStrProp\r\nprocedure SetStringProp(Instance: TObject; const PropName: String; Value: String); deprecated; // use GetStrProp\r\nprocedure SetStringProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: String); deprecated; // use GetStrProp\r\n\r\nfunction  GetFloatProp(Instance: TObject; const PropName: string): Double;\r\nfunction  GetFloatProp(Instance: TObject; PropInfo : TTypeMemberProperty) : Double;\r\nprocedure SetFloatProp(Instance: TObject; const PropName: string; Value: Double);\r\nprocedure SetFloatProp(Instance: TObject; PropInfo : TTypeMemberProperty;  Value : Double);\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropName: String): TObject;\r\nfunction GetObjectProp(Instance: TObject; const PropName: String; MinClass: TClass): TObject;\r\nfunction GetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty):  TObject;\r\nfunction GetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty; MinClass: TClass):  TObject;\r\nprocedure SetObjectProp(Instance: TObject; const PropName: String; Value: TObject) ;\r\nprocedure SetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: TObject);\r\n\r\nfunction GetMethodProp(Instance: TObject; PropInfo: TTypeMemberProperty): TMethod;\r\nfunction GetMethodProp(Instance: TObject; const PropName: string): TMethod;\r\nprocedure SetMethodProp(Instance: TObject; PropInfo: TTypeMemberProperty;  const Value : TMethod);\r\nprocedure SetMethodProp(Instance: TObject; const PropName: string; const Value: TMethod);\r\n\r\nfunction GetInterfaceProp(Instance: TObject; const PropName: string): IInterface;\r\nfunction GetInterfaceProp(Instance: TObject; PropInfo: TTypeMemberProperty): IInterface;\r\nprocedure SetInterfaceProp(Instance: TObject; const PropName: string; const Value: IInterface);\r\nprocedure SetInterfaceProp(Instance: TObject; PropInfo: TTypeMemberProperty; const Value: IInterface);\r\n\r\nfunction GetRawInterfaceProp(Instance: TObject; const PropName: string): Pointer;\r\nfunction GetRawInterfaceProp(Instance: TObject; PropInfo: TTypeMemberProperty): Pointer;\r\nprocedure SetRawInterfaceProp(Instance: TObject; const PropName: string; const Value: Pointer);\r\nprocedure SetRawInterfaceProp(Instance: TObject; PropInfo: TTypeMemberProperty; const Value: Pointer);\r\n\r\nimplementation\r\n\r\nfunction GetTypeName(TypeInfo: TTypeInfo): string;\r\nbegin\r\n  Result := TypeInfo.Name;\r\nend;\r\n\r\nfunction GetClassMembers(aTIStruct: TTypeInfoStruct): TTypeMemberDynArray;\r\nvar\r\n  C: TTypeInfoStruct;\r\n  i: Integer;\r\n  PropName: String;\r\n  Names: TJSObject;\r\nbegin\r\n  Result:=nil;\r\n  Names:=TJSObject.new;\r\n  C:=aTIStruct;\r\n  while C<>nil do\r\n  begin\r\n    for i:=0 to length(C.Names)-1 do\r\n    begin\r\n      PropName:=C.Names[i];\r\n      if Names.hasOwnProperty(PropName) then continue;\r\n      TJSArray(Result).push(C.Members[PropName]);\r\n      Names[PropName]:=true;\r\n    end;\r\n    if not (C is TTypeInfoClass) then break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetClassMember(aTIStruct: TTypeInfoStruct; const aName: String): TTypeMember;\r\nvar\r\n  C: TTypeInfoStruct;\r\n  i: Integer;\r\nbegin\r\n  // quick search: case sensitive\r\n  C:=aTIStruct;\r\n  while C<>nil do\r\n  begin\r\n    if TJSObject(C.Members).hasOwnProperty(aName) then\r\n      exit(C.Members[aName]);\r\n    if not (C is TTypeInfoClass) then break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\n  // slow search: case insensitive\r\n  C:=aTIStruct;\r\n  while C<>nil do\r\n  begin\r\n    for i:=0 to length(C.Names)-1 do\r\n      if CompareText(C.Names[i],aName)=0 then\r\n        exit(C.Members[C.Names[i]]);\r\n    if not (C is TTypeInfoClass) then break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\n  Result:=nil;\r\nend;\r\n\r\nfunction GetInstanceMethod(Instance: TObject; const aName: String): Pointer;\r\nvar\r\n  TI: TTypeMember;\r\nbegin\r\n  if Instance=nil then exit(nil);\r\n  TI:=GetClassMember(TypeInfo(Instance),aName);\r\n  if not (TI is TTypeMemberMethod) then exit(nil);\r\n  Result:=CreateMethod(Instance,TI.Name); // Note: use TI.Name for the correct case!\r\nend;\r\n\r\nfunction GetClassMethods(aTIStruct: TTypeInfoStruct): TTypeMemberMethodDynArray;\r\nvar\r\n  C: TTypeInfoStruct;\r\n  i, Cnt, j: Integer;\r\nbegin\r\n  Cnt:=0;\r\n  C:=aTIStruct;\r\n  while C<>nil do\r\n  begin\r\n    inc(Cnt,C.MethodCount);\r\n    if not (C is TTypeInfoClass) then break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\n  SetLength(Result,Cnt);\r\n  C:=aTIStruct;\r\n  i:=0;\r\n  while C<>nil do\r\n  begin\r\n    for j:=0 to C.MethodCount-1 do\r\n    begin\r\n      Result[i]:=TTypeMemberMethod(C.Members[C.Methods[j]]);\r\n      inc(i);\r\n    end;\r\n    if not (C is TTypeInfoClass) then break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetInterfaceMembers(aTIInterface: TTypeInfoInterface\r\n  ): TTypeMemberDynArray;\r\nvar\r\n  Intf: TTypeInfoInterface;\r\n  i, Cnt, j: Integer;\r\nbegin\r\n  Cnt:=0;\r\n  Intf:=aTIInterface;\r\n  while Intf<>nil do\r\n  begin\r\n    inc(Cnt,length(Intf.Names));\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\n  SetLength(Result,Cnt);\r\n  Intf:=aTIInterface;\r\n  i:=0;\r\n  while Intf<>nil do\r\n  begin\r\n    for j:=0 to length(Intf.Names)-1 do\r\n    begin\r\n      Result[i]:=Intf.Members[Intf.Names[j]];\r\n      inc(i);\r\n    end;\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetInterfaceMember(aTIInterface: TTypeInfoInterface;\r\n  const aName: String): TTypeMember;\r\nvar\r\n  Intf: TTypeInfoInterface;\r\n  i: Integer;\r\nbegin\r\n  // quick search: case sensitive\r\n  Intf:=aTIInterface;\r\n  while Intf<>nil do\r\n  begin\r\n    if TJSObject(Intf.Members).hasOwnProperty(aName) then\r\n      exit(Intf.Members[aName]);\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\n  // slow search: case insensitive\r\n  Intf:=aTIInterface;\r\n  while Intf<>nil do\r\n  begin\r\n    for i:=0 to length(Intf.Names)-1 do\r\n      if CompareText(Intf.Names[i],aName)=0 then\r\n        exit(Intf.Members[Intf.Names[i]]);\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\n  Result:=nil;\r\nend;\r\n\r\nfunction GetInterfaceMethods(aTIInterface: TTypeInfoInterface\r\n  ): TTypeMemberMethodDynArray;\r\nvar\r\n  Intf: TTypeInfoInterface;\r\n  i, Cnt, j: Integer;\r\nbegin\r\n  Cnt:=0;\r\n  Intf:=aTIInterface;\r\n  while Intf<>nil do\r\n  begin\r\n    inc(Cnt,Intf.MethodCount);\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\n  SetLength(Result,Cnt);\r\n  Intf:=aTIInterface;\r\n  i:=0;\r\n  while Intf<>nil do\r\n  begin\r\n    for j:=0 to Intf.MethodCount-1 do\r\n    begin\r\n      Result[i]:=TTypeMemberMethod(Intf.Members[Intf.Methods[j]]);\r\n      inc(i);\r\n    end;\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\nend;\r\n\r\ntype\r\n  TCreatorAttribute = class external name 'attr'\r\n    class function Create(const ProcName: string): TCustomAttribute; overload; external name '$create';\r\n    class function Create(const ProcName: string; Params: jsvalue): TCustomAttribute; overload; external name '$create';\r\n  end;\r\n  TCreatorAttributeClass = class of TCreatorAttribute;\r\n\r\nfunction GetRTTIAttributes(const Attributes: TTypeInfoAttributes\r\n  ): TCustomAttributeArray;\r\nvar\r\n  i, len: Integer;\r\n  AttrClass: TCreatorAttributeClass;\r\n  ProcName: String;\r\n  Attr: TCustomAttribute;\r\nbegin\r\n  Result:=nil;\r\n  if Attributes=Undefined then exit;\r\n  i:=0;\r\n  len:=length(Attributes);\r\n  while i<len do\r\n    begin\r\n    AttrClass:=TCreatorAttributeClass(Attributes[i]);\r\n    inc(i);\r\n    ProcName:=String(Attributes[i]);\r\n    inc(i);\r\n    if (i<len) and isArray(Attributes[i]) then\r\n      begin\r\n      Attr:=AttrClass.Create(ProcName,Attributes[i]);\r\n      inc(i);\r\n      end\r\n    else\r\n      Attr:=AttrClass.Create(ProcName);\r\n    Insert(Attr,Result,length(Result));\r\n    end;\r\nend;\r\n\r\nfunction GetPropInfos(aTIStruct: TTypeInfoStruct): TTypeMemberPropertyDynArray;\r\nvar\r\n  C: TTypeInfoStruct;\r\n  i: Integer;\r\n  Names: TJSObject;\r\n  PropName: String;\r\nbegin\r\n  Result:=nil;\r\n  C:=aTIStruct;\r\n  Names:=TJSObject.new;\r\n  while C<>nil do\r\n  begin\r\n    for i:=0 to C.PropCount-1 do\r\n    begin\r\n      PropName:=C.Properties[i];\r\n      if Names.hasOwnProperty(PropName) then continue;\r\n      TJSArray(Result).push(TTypeMemberProperty(C.Members[PropName]));\r\n      Names[PropName]:=true;\r\n    end;\r\n    if not (C is TTypeInfoClass) then\r\n      break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetPropList(aTIStruct: TTypeInfoStruct; TypeKinds: TTypeKinds;\r\n  Sorted: boolean): TTypeMemberPropertyDynArray;\r\n\r\n  function NameSort(a,b: JSValue): NativeInt;\r\n  begin\r\n    if TTypeMemberProperty(a).Name<TTypeMemberProperty(b).Name then\r\n      Result:=-1\r\n    else if TTypeMemberProperty(a).Name>TTypeMemberProperty(b).Name then\r\n      Result:=1\r\n    else\r\n      Result:=0;\r\n  end;\r\n\r\nvar\r\n  C: TTypeInfoStruct;\r\n  i: Integer;\r\n  Names: TJSObject;\r\n  PropName: String;\r\n  Prop: TTypeMemberProperty;\r\nbegin\r\n  Result:=nil;\r\n  C:=aTIStruct;\r\n  Names:=TJSObject.new;\r\n  while C<>nil do\r\n  begin\r\n    for i:=0 to C.PropCount-1 do\r\n    begin\r\n      PropName:=C.Properties[i];\r\n      if Names.hasOwnProperty(PropName) then continue;\r\n      Prop:=TTypeMemberProperty(C.Members[PropName]);\r\n      if not (Prop.TypeInfo.Kind in TypeKinds) then continue;\r\n      TJSArray(Result).push(Prop);\r\n      Names[PropName]:=true;\r\n    end;\r\n    if not (C is TTypeInfoClass) then\r\n      break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\n  if Sorted then\r\n    TJSArray(Result).sort(@NameSort);\r\nend;\r\n\r\nfunction GetPropList(aTIStruct: TTypeInfoStruct): TTypeMemberPropertyDynArray;\r\nbegin\r\n  Result:=GetPropInfos(aTIStruct);\r\nend;\r\n\r\nfunction GetPropList(AClass: TClass): TTypeMemberPropertyDynArray;\r\nbegin\r\n  Result:=GetPropInfos(TypeInfo(AClass));\r\nend;\r\n\r\nfunction GetPropList(Instance: TObject): TTypeMemberPropertyDynArray;\r\nbegin\r\n  Result:=GetPropList(Instance.ClassType);\r\nend;\r\n\r\nfunction GetPropInfo(TI: TTypeInfoStruct; const PropName: String\r\n  ): TTypeMemberProperty;\r\nvar\r\n  m: TTypeMember;\r\n  i: Integer;\r\n  C: TTypeInfoStruct;\r\nbegin\r\n  // quick search case sensitive\r\n  C:=TI;\r\n  while C<>nil do\r\n  begin\r\n    m:=C.Members[PropName];\r\n    if m is TTypeMemberProperty then\r\n      exit(TTypeMemberProperty(m));\r\n    if not (C is TTypeInfoClass) then\r\n      break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\n\r\n  // slow search case insensitive\r\n  Result:=nil;\r\n  repeat\r\n    for i:=0 to TI.PropCount-1 do\r\n      if CompareText(PropName,TI.Properties[i])=0 then\r\n      begin\r\n        m:=TI.Members[TI.Properties[i]];\r\n        if m is TTypeMemberProperty then\r\n          Result:=TTypeMemberProperty(m);\r\n        exit;\r\n      end;\r\n    if not (TI is TTypeInfoClass) then\r\n      break;\r\n    TI:=TTypeInfoClass(TI).Ancestor;\r\n  until TI=nil;\r\nend;\r\n\r\nfunction GetPropInfo(TI: TTypeInfoStruct; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TI,PropName);\r\n  if (Kinds<>[]) and (Result<>nil) and not (Result.TypeInfo.Kind in Kinds) then\r\n    Result:=nil;\r\nend;\r\n\r\nfunction GetPropInfo(Instance: TObject; const PropName: String\r\n  ): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(Instance),PropName,[]);\r\nend;\r\n\r\nfunction GetPropInfo(Instance: TObject; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(Instance),PropName,Kinds);\r\nend;\r\n\r\nfunction GetPropInfo(aClass: TClass; const PropName: String\r\n  ): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(AClass),PropName,[]);\r\nend;\r\n\r\nfunction GetPropInfo(aClass: TClass; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(AClass),PropName,Kinds);\r\nend;\r\n\r\nfunction FindPropInfo(Instance: TObject; const PropName: String\r\n  ): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(Instance), PropName);\r\n  if Result=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\nend;\r\n\r\nfunction FindPropInfo(Instance: TObject; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(Instance), PropName, Kinds);\r\n  if Result=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\nend;\r\n\r\nfunction FindPropInfo(aClass: TClass; const PropName: String\r\n  ): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(aClass), PropName);\r\n  if Result=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\nend;\r\n\r\nfunction FindPropInfo(aClass: TClass; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(aClass), PropName, Kinds);\r\n  if Result=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\nend;\r\n\r\nfunction IsStoredProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): Boolean;\r\ntype\r\n  TIsStored = function: Boolean of object;\r\nbegin\r\n  case PropInfo.Flags and 12 of\r\n  0: Result:=true;\r\n  4: Result:=false;\r\n  8: Result:=Boolean(TJSObject(Instance)[PropInfo.Stored]);\r\n  else Result:=TIsStored(TJSObject(Instance)[PropInfo.Stored])();\r\n  end;\r\nend;\r\n\r\nfunction IsStoredProp(Instance: TObject; const PropName: string): Boolean;\r\nbegin\r\n  Result:=IsStoredProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction IsPublishedProp(Instance: TObject; const PropName: String): Boolean;\r\nbegin\r\n  Result:=GetPropInfo(Instance,PropName)<>nil;\r\nend;\r\n\r\nfunction IsPublishedProp(aClass: TClass; const PropName: String): Boolean;\r\nbegin\r\n  Result:=GetPropInfo(aClass,PropName)<>nil;\r\nend;\r\n\r\nfunction PropType(Instance: TObject; const PropName: string): TTypeKind;\r\nbegin\r\n  Result:=FindPropInfo(Instance,PropName).TypeInfo.Kind;\r\nend;\r\n\r\nfunction PropType(aClass: TClass; const PropName: string): TTypeKind;\r\nbegin\r\n  Result:=FindPropInfo(aClass,PropName).TypeInfo.Kind;\r\nend;\r\n\r\nfunction PropIsType(Instance: TObject; const PropName: string;\r\n  const TypeKind: TTypeKind): Boolean;\r\nbegin\r\n  Result:=PropType(Instance,PropName)=TypeKind;\r\nend;\r\n\r\nfunction PropIsType(aClass: TClass; const PropName: string;\r\n  const TypeKind: TTypeKind): Boolean;\r\nbegin\r\n  Result:=PropType(aClass,PropName)=TypeKind;\r\nend;\r\n\r\ntype\r\n  TGetterKind = (\r\n    gkNone,\r\n    gkField,\r\n    gkFunction,\r\n    gkFunctionWithParams\r\n  );\r\n\r\nfunction GetPropGetterKind(const PropInfo: TTypeMemberProperty): TGetterKind;\r\nbegin\r\n  if PropInfo.Getter='' then\r\n    Result:=gkNone\r\n  else if (pfGetFunction and PropInfo.Flags)>0 then\r\n    begin\r\n    if length(PropInfo.Params)>0 then\r\n      // array property\r\n      Result:=gkFunctionWithParams\r\n    else\r\n      Result:=gkFunction;\r\n    end\r\n  else\r\n    Result:=gkField;\r\nend;\r\n\r\ntype\r\n  TSetterKind = (\r\n    skNone,\r\n    skField,\r\n    skProcedure,\r\n    skProcedureWithParams\r\n  );\r\n\r\nfunction GetPropSetterKind(const PropInfo: TTypeMemberProperty): TSetterKind;\r\nbegin\r\n  if PropInfo.Setter='' then\r\n    Result:=skNone\r\n  else if (pfSetProcedure and PropInfo.Flags)>0 then\r\n    begin\r\n    if length(PropInfo.Params)>0 then\r\n      // array property\r\n      Result:=skProcedureWithParams\r\n    else\r\n      Result:=skProcedure;\r\n    end\r\n  else\r\n    Result:=skField;\r\nend;\r\n\r\nfunction GetJSValueProp(Instance: TJSObject; TI: TTypeInfoStruct;\r\n  const PropName: String): JSValue;\r\nvar\r\n  PropInfo: TTypeMemberProperty;\r\nbegin\r\n  PropInfo:=GetPropInfo(TI,PropName);\r\n  if PropInfo=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\n  Result:=GetJSValueProp(Instance,PropInfo);\r\nend;\r\n\r\nfunction GetJSValueProp(Instance: TJSObject;\r\n  const PropInfo: TTypeMemberProperty): JSValue;\r\ntype\r\n  TGetter = function: JSValue of object;\r\n  TGetterWithIndex = function(Index: JSValue): JSValue of object;\r\nvar\r\n  gk: TGetterKind;\r\nbegin\r\n  gk:=GetPropGetterKind(PropInfo);\r\n  case gk of\r\n    gkNone:\r\n      raise EPropertyError.CreateFmt(SCantReadPropertyS, [PropInfo.Name]);\r\n    gkField:\r\n      Result:=Instance[PropInfo.Getter];\r\n    gkFunction:\r\n      if (pfHasIndex and PropInfo.Flags)>0 then\r\n        Result:=TGetterWithIndex(Instance[PropInfo.Getter])(PropInfo.Index)\r\n      else\r\n        Result:=TGetter(Instance[PropInfo.Getter])();\r\n    gkFunctionWithParams:\r\n      raise EPropertyError.CreateFmt(SIndexedPropertyNeedsParams, [PropInfo.Name]);\r\n  end;\r\nend;\r\n\r\nfunction GetJSValueProp(Instance: TObject; const PropName: String): JSValue;\r\nbegin\r\n  Result:=GetJSValueProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetJSValueProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): JSValue;\r\nbegin\r\n  Result:=GetJSValueProp(TJSObject(Instance),PropInfo);\r\nend;\r\n\r\nprocedure SetJSValueProp(Instance: TJSObject; TI: TTypeInfoStruct;\r\n  const PropName: String; Value: JSValue);\r\nvar\r\n  PropInfo: TTypeMemberProperty;\r\nbegin\r\n  PropInfo:=GetPropInfo(TI,PropName);\r\n  if PropInfo=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nprocedure SetJSValueProp(Instance: TJSObject;\r\n  const PropInfo: TTypeMemberProperty; Value: JSValue);\r\ntype\r\n  TSetter = procedure(Value: JSValue) of object;\r\n  TSetterWithIndex = procedure(Index, Value: JSValue) of object;\r\nvar\r\n  sk: TSetterKind;\r\nbegin\r\n  sk:=GetPropSetterKind(PropInfo);\r\n  case sk of\r\n    skNone:\r\n      raise EPropertyError.CreateFmt(SCantWritePropertyS, [PropInfo.Name]);\r\n    skField:\r\n      Instance[PropInfo.Setter]:=Value;\r\n    skProcedure:\r\n      if (pfHasIndex and PropInfo.Flags)>0 then\r\n        TSetterWithIndex(Instance[PropInfo.Setter])(PropInfo.Index,Value)\r\n      else\r\n        TSetter(Instance[PropInfo.Setter])(Value);\r\n    skProcedureWithParams:\r\n      raise EPropertyError.CreateFmt(SIndexedPropertyNeedsParams, [PropInfo.Name]);\r\n  end;\r\nend;\r\n\r\nprocedure SetJSValueProp(Instance: TObject; const PropName: String;\r\n  Value: JSValue);\r\nbegin\r\n  SetJSValueProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetJSValueProp(Instance: TObject;\r\n  const PropInfo: TTypeMemberProperty; Value: JSValue);\r\nbegin\r\n  SetJSValueProp(TJSObject(Instance),PropInfo,Value);\r\nend;\r\n\r\nfunction GetNativeIntProp(Instance: TObject; const PropName: String): NativeInt;\r\nbegin\r\n  Result:=GetNativeIntProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetNativeIntProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): NativeInt;\r\nbegin\r\n  Result:=NativeInt(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetNativeIntProp(Instance: TObject; const PropName: String;\r\n  Value: NativeInt);\r\nbegin\r\n  SetJSValueProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetNativeIntProp(Instance: TObject;\r\n  const PropInfo: TTypeMemberProperty; Value: NativeInt);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetOrdProp(Instance: TObject; const PropName: String): longint;\r\nbegin\r\n  Result:=GetOrdProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetOrdProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): longint;\r\nvar\r\n  o: TJSObject;\r\n  Key: String;\r\n  n: NativeInt;\r\n  v : JSValue;\r\n  vs : TJSString absolute key;\r\n\r\nbegin\r\n  if PropInfo.TypeInfo.Kind=tkSet then\r\n  begin\r\n    // a set is a JS object, with the following property: o[ElementDecimal]=true\r\n    o:=TJSObject(GetJSValueProp(Instance,PropInfo));\r\n    Result:=0;\r\n    for Key in o do\r\n    begin\r\n      n:=parseInt(Key,10);\r\n      if n<32 then\r\n        Result:=Result+(1 shl n);\r\n    end;\r\n  end else if PropInfo.TypeInfo.Kind=tkChar then\r\n  begin\r\n    v:=GetJSValueProp(Instance,PropInfo);\r\n    if isNumber(v) then\r\n      Result:=Longint(V)\r\n    else\r\n      begin\r\n      Key:=String(v);\r\n      If Key='' then\r\n        Result:=0\r\n      else\r\n        Result:=vs.CharCodeAt(0);\r\n      end\r\n  end else\r\n    Result:=longint(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetOrdProp(Instance: TObject; const PropName: String; Value: longint);\r\nbegin\r\n  SetOrdProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetOrdProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  Value: longint);\r\nvar\r\n  o: TJSObject;\r\n  i: Integer;\r\nbegin\r\n  if PropInfo.TypeInfo.Kind=tkSet then\r\n  begin\r\n    o:=TJSObject.new;\r\n    for i:=0 to 31 do\r\n      if (1 shl i) and Value>0 then\r\n        o[str(i)]:=true;\r\n    SetJSValueProp(Instance,PropInfo,o);\r\n  end else if PropInfo.TypeInfo.Kind=tkChar then\r\n    SetJSValueProp(Instance,PropInfo,TJSString.fromCharCode(Value))\r\n  else\r\n    SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetEnumProp(Instance: TObject; const PropName: String): String;\r\nbegin\r\n  Result:=GetEnumProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetEnumProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String;\r\nvar\r\n  n: NativeInt;\r\n  TIEnum: TTypeInfoEnum;\r\nbegin\r\n  TIEnum:=PropInfo.TypeInfo as TTypeInfoEnum;\r\n  n:=NativeInt(GetJSValueProp(Instance,PropInfo));\r\n  if (n>=TIEnum.MinValue) and (n<=TIEnum.MaxValue) then\r\n    Result:=TIEnum.EnumType.IntToName[n]\r\n  else\r\n    Result:=str(n);\r\nend;\r\n\r\nprocedure SetEnumProp(Instance: TObject; const PropName: String;\r\n  const Value: String);\r\nbegin\r\n  SetEnumProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetEnumProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  const Value: String);\r\nvar\r\n  TIEnum: TTypeInfoEnum;\r\n  n: NativeInt;\r\nbegin\r\n  TIEnum:=PropInfo.TypeInfo as TTypeInfoEnum;\r\n  n:=TIEnum.EnumType.NameToInt[Value];\r\n  if not isUndefined(n) then\r\n    SetJSValueProp(Instance,PropInfo,n);\r\nend;\r\n\r\nfunction GetEnumName(TypeInfo: TTypeInfoEnum; Value: Integer): String;\r\nbegin\r\n  Result:=TypeInfo.EnumType.IntToName[Value];\r\nend;\r\n\r\nfunction GetEnumValue(TypeInfo: TTypeInfoEnum; const Name: string): Longint;\r\nbegin\r\n  Result:=TypeInfo.EnumType.NameToInt[Name];\r\nend;\r\n\r\nfunction GetEnumNameCount(TypeInfo: TTypeInfoEnum): Longint;\r\nvar\r\n  o: TJSObject;\r\n  l, r: LongInt;\r\nbegin\r\n  o:=TJSObject(TypeInfo.EnumType);\r\n  // as of pas2js 1.0 the RTTI does not contain a min/max value\r\n  // -> use exponential search\r\n  // ToDo: adapt this once enums with gaps are supported\r\n  Result:=1;\r\n  while o.hasOwnProperty(String(JSValue(Result))) do\r\n    Result:=Result*2;\r\n  l:=Result div 2;\r\n  r:=Result;\r\n  while l<=r do\r\n    begin\r\n    Result:=(l+r) div 2;\r\n    if o.hasOwnProperty(String(JSValue(Result))) then\r\n      l:=Result+1\r\n    else\r\n      r:=Result-1;\r\n    end;\r\n  if o.hasOwnProperty(String(JSValue(Result))) then\r\n    inc(Result);\r\nend;\r\n\r\nfunction GetSetProp(Instance: TObject; const PropName: String): String;\r\nbegin\r\n  Result:=GetSetProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetSetProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): String;\r\nvar\r\n  o: TJSObject;\r\n  key, Value: String;\r\n  n: NativeInt;\r\n  TIEnum: TTypeInfoEnum;\r\n  TISet: TTypeInfoSet;\r\nbegin\r\n  Result:='';\r\n  // get enum type if available\r\n  TISet:=PropInfo.TypeInfo as TTypeInfoSet;\r\n  TIEnum:=nil;\r\n  if TISet.CompType is TTypeInfoEnum then\r\n    TIEnum:=TTypeInfoEnum(TISet.CompType);\r\n  // read value\r\n  o:=TJSObject(GetJSValueProp(Instance,PropInfo));\r\n  // a set is a JS object, where included element is stored as: o[ElementDecimal]=true\r\n  for Key in o do\r\n  begin\r\n    n:=parseInt(Key,10);\r\n    if (TIEnum<>nil) and (n>=TIEnum.MinValue) and (n<=TIEnum.MaxValue) then\r\n      Value:=TIEnum.EnumType.IntToName[n]\r\n    else\r\n      Value:=str(n);\r\n    if Result<>'' then Result:=Result+',';\r\n    Result:=Result+Value;\r\n  end;\r\n  Result:='['+Result+']';\r\nend;\r\n\r\nfunction GetSetPropArray(Instance: TObject; const PropName: String\r\n  ): TIntegerDynArray;\r\nbegin\r\n  Result:=GetSetPropArray(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetSetPropArray(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): TIntegerDynArray;\r\nvar\r\n  o: TJSObject;\r\n  Key: string;\r\nbegin\r\n  Result:=[];\r\n  // read value\r\n  o:=TJSObject(GetJSValueProp(Instance,PropInfo));\r\n  // a set is a JS object, where included element is stored as: o[ElementDecimal]=true\r\n  for Key in o do\r\n    TJSArray(Result).push(parseInt(Key,10));\r\nend;\r\n\r\nprocedure SetSetPropArray(Instance: TObject; const PropName: String;\r\n  const Arr: TIntegerDynArray);\r\nbegin\r\n  SetSetPropArray(Instance,FindPropInfo(Instance,PropName),Arr);\r\nend;\r\n\r\nprocedure SetSetPropArray(Instance: TObject;\r\n  const PropInfo: TTypeMemberProperty; const Arr: TIntegerDynArray);\r\nvar\r\n  o: TJSObject;\r\n  i: integer;\r\nbegin\r\n  o:=TJSObject.new;\r\n  for i in Arr do\r\n    o[str(i)]:=true;\r\n  SetJSValueProp(Instance,PropInfo,o);\r\nend;\r\n\r\nfunction GetStrProp(Instance: TObject; const PropName: String): String;\r\nbegin\r\n  Result:=GetStrProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetStrProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): String;\r\nbegin\r\n  Result:=String(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetStrProp(Instance: TObject; const PropName: String; Value: String\r\n  );\r\nbegin\r\n  SetStrProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetStrProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  Value: String);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetStringProp(Instance: TObject; const PropName: String): String;\r\nbegin\r\n  Result:=GetStrProp(Instance,PropName);\r\nend;\r\n\r\nfunction GetStringProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): String;\r\nbegin\r\n  Result:=GetStrProp(Instance,PropInfo);\r\nend;\r\n\r\nprocedure SetStringProp(Instance: TObject; const PropName: String; Value: String\r\n  );\r\nbegin\r\n  SetStrProp(Instance,PropName,Value);\r\nend;\r\n\r\nprocedure SetStringProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  Value: String);\r\nbegin\r\n  SetStrProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetBoolProp(Instance: TObject; const PropName: String): boolean;\r\nbegin\r\n  Result:=GetBoolProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetBoolProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): boolean;\r\nbegin\r\n  Result:=Boolean(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetBoolProp(Instance: TObject; const PropName: String; Value: boolean\r\n  );\r\nbegin\r\n  SetBoolProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetBoolProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  Value: boolean);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropName: String): TObject;\r\nbegin\r\n  Result:=GetObjectProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropName: String; MinClass : TClass): TObject;\r\nbegin\r\n  Result:=GetObjectProp(Instance,FindPropInfo(Instance,PropName));\r\n  if (MinClass<>Nil) and (Result<>Nil) Then\r\n    if not Result.InheritsFrom(MinClass) then\r\n      Result:=Nil;\r\nend;\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty):  TObject;\r\n\r\nbegin\r\n  Result:=GetObjectProp(Instance,PropInfo,Nil);\r\nend;\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty; MinClass : TClass):  TObject;\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  O:=TObject(GetJSValueProp(Instance,PropInfo));\r\n  if (MinClass<>Nil) and not O.InheritsFrom(MinClass) then\r\n    Result:=Nil\r\n  else\r\n    Result:=O;\r\nend;\r\n\r\nprocedure SetObjectProp(Instance: TObject; const PropName: String; Value: TObject) ;\r\n\r\nbegin\r\n  SetObjectProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: TObject);\r\n\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetMethodProp(Instance: TObject; PropInfo: TTypeMemberProperty\r\n  ): TMethod;\r\nvar\r\n  v, fn: JSValue;\r\nbegin\r\n  Result.Code:=nil;\r\n  Result.Data:=nil;\r\n  v:=GetJSValueProp(Instance,PropInfo);\r\n  if not isFunction(v) then exit;\r\n  Result.Data:=Pointer(TJSObject(v)['scope']);\r\n  fn:=TJSObject(v)['fn'];\r\n  if isString(fn) then\r\n    begin\r\n    if Result.Data<>nil then\r\n      // named callback\r\n      Result.Code:=CodePointer(TJSObject(Result.Data)[String(fn)])\r\n    else\r\n      // this is not an rtl callback, return the value\r\n      Result.Code:=CodePointer(v);\r\n    end\r\n  else\r\n    // anonymous callback\r\n    Result.Code:=CodePointer(fn);\r\nend;\r\n\r\nfunction GetMethodProp(Instance: TObject; const PropName: string): TMethod;\r\nbegin\r\n  Result:=GetMethodProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction createCallbackPtr(scope: Pointer; fn: CodePointer): TJSFunction; external name 'rtl.createCallback';\r\nfunction createCallbackStr(scope: Pointer; fn: string): TJSFunction; external name 'rtl.createCallback';\r\n\r\nprocedure SetMethodProp(Instance: TObject; PropInfo: TTypeMemberProperty;\r\n  const Value: TMethod);\r\nvar\r\n  cb: TJSFunction;\r\n  Code: Pointer;\r\nbegin\r\n  // Note: Value.Data=nil is allowed and can be used by designer code\r\n  Code:=Value.Code;\r\n  if Code=nil then\r\n    cb:=nil\r\n  else if isFunction(Code) then\r\n    begin\r\n    if (TJSObject(Code)['scope']=Value.Data)\r\n        and (isFunction(TJSObject(Code)['fn']) or isString(TJSObject(Code)['fn']))\r\n      then\r\n      begin\r\n      // Value.Code is already the needed callback\r\n      cb:=TJSFunction(Code);\r\n      end\r\n    else if isString(TJSObject(Code)['fn']) then\r\n      // named callback, different scope\r\n      cb:=createCallbackStr(Value.Data,string(TJSObject(Code)['fn']))\r\n    else\r\n      // normal function\r\n      cb:=createCallbackPtr(Value.Data,Code);\r\n    end\r\n  else\r\n    // not a valid value -> for compatibility set it anyway\r\n    cb:=createCallbackPtr(Value.Data,Code);\r\n  SetJSValueProp(Instance,PropInfo,cb);\r\nend;\r\n\r\nprocedure SetMethodProp(Instance: TObject; const PropName: string;\r\n  const Value: TMethod);\r\nbegin\r\n  SetMethodProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nfunction GetInterfaceProp(Instance: TObject; const PropName: string\r\n  ): IInterface;\r\nbegin\r\n  Result:=GetInterfaceProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetInterfaceProp(Instance: TObject; PropInfo: TTypeMemberProperty\r\n  ): IInterface;\r\ntype\r\n  TGetter = function: IInterface of object;\r\n  TGetterWithIndex = function(Index: JSValue): IInterface of object;\r\nvar\r\n  gk: TGetterKind;\r\nbegin\r\n  if Propinfo.TypeInfo.Kind<>tkInterface then\r\n    raise Exception.Create('Cannot get RAW interface from IInterface interface');\r\n  gk:=GetPropGetterKind(PropInfo);\r\n  case gk of\r\n    gkNone:\r\n      raise EPropertyError.CreateFmt(SCantReadPropertyS, [PropInfo.Name]);\r\n    gkField:\r\n      Result:=IInterface(TJSObject(Instance)[PropInfo.Getter]);\r\n    gkFunction:\r\n      if (pfHasIndex and PropInfo.Flags)>0 then\r\n        Result:=TGetterWithIndex(TJSObject(Instance)[PropInfo.Getter])(PropInfo.Index)\r\n      else\r\n        Result:=TGetter(TJSObject(Instance)[PropInfo.Getter])();\r\n    gkFunctionWithParams:\r\n      raise EPropertyError.CreateFmt(SIndexedPropertyNeedsParams, [PropInfo.Name]);\r\n  end;\r\nend;\r\n\r\nprocedure SetInterfaceProp(Instance: TObject; const PropName: string;\r\n  const Value: IInterface);\r\nbegin\r\n  SetInterfaceProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetInterfaceProp(Instance: TObject; PropInfo: TTypeMemberProperty;\r\n  const Value: IInterface);\r\ntype\r\n  TSetter = procedure(Value: IInterface) of object;\r\n  TSetterWithIndex = procedure(Index: JSValue; Value: IInterface) of object;\r\nprocedure setIntfP(Instance: TObject; const PropName: string; value: jsvalue); external name 'rtl.setIntfP';\r\nvar\r\n  sk: TSetterKind;\r\n  Setter: String;\r\nbegin\r\n  if Propinfo.TypeInfo.Kind<>tkInterface then\r\n    raise Exception.Create('Cannot set RAW interface from IInterface interface');\r\n  sk:=GetPropSetterKind(PropInfo);\r\n  Setter:=PropInfo.Setter;\r\n  case sk of\r\n    skNone:\r\n      raise EPropertyError.CreateFmt(SCantWritePropertyS, [PropInfo.Name]);\r\n    skField:\r\n      setIntfP(Instance,Setter,Value);\r\n    skProcedure:\r\n      if (pfHasIndex and PropInfo.Flags)>0 then\r\n        TSetterWithIndex(TJSObject(Instance)[Setter])(PropInfo.Index,Value)\r\n      else\r\n        TSetter(TJSObject(Instance)[Setter])(Value);\r\n    skProcedureWithParams:\r\n      raise EPropertyError.CreateFmt(SIndexedPropertyNeedsParams, [PropInfo.Name]);\r\n  end;\r\nend;\r\n\r\nfunction GetRawInterfaceProp(Instance: TObject; const PropName: string\r\n  ): Pointer;\r\nbegin\r\n  Result:=GetRawInterfaceProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetRawInterfaceProp(Instance: TObject; PropInfo: TTypeMemberProperty\r\n  ): Pointer;\r\nbegin\r\n  Result:=Pointer(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetRawInterfaceProp(Instance: TObject; const PropName: string;\r\n  const Value: Pointer);\r\nbegin\r\n  SetRawInterfaceProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetRawInterfaceProp(Instance: TObject; PropInfo: TTypeMemberProperty;\r\n  const Value: Pointer);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetFloatProp(Instance: TObject; PropInfo: TTypeMemberProperty): Double;\r\nbegin\r\n  Result:=Double(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nfunction GetFloatProp(Instance: TObject; const PropName: string): Double;\r\nbegin\r\n  Result:=GetFloatProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nprocedure SetFloatProp(Instance: TObject; const PropName: string; Value: Double\r\n  );\r\nbegin\r\n  SetFloatProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetFloatProp(Instance: TObject; PropInfo: TTypeMemberProperty;\r\n  Value: Double);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017-2020 by the Pas2JS development team.\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\nunit Web;\r\n\r\ninterface\r\n\r\nuses Types, JS;\r\n\r\nType\r\n  TJSEvent = Class;\r\n  // Forward definitions\r\n  TJSHTMLElement = Class;\r\n  TJSWindow = class;\r\n  TJSDOMTokenList = class;\r\n  TJSXPathResult = CLass;\r\n  TJSNodeList = class;\r\n  TJSDocument = class;\r\n  TJSElement = class;\r\n  TJSCSSStyleSheet = Class;\r\n  TJSNodeFilter = Class;\r\n  TJSIDBObjectStore = Class;\r\n  TIDBDatabase = class;\r\n  TJSIDBRequest = class;\r\n  TJSEventTarget = class;\r\n  TJSMouseEvent = Class;\r\n  TJSWheelEvent = Class;\r\n  TJSKeyBoardEvent = class;\r\n  TJSPointerEvent = Class;\r\n  TJSUIEvent = class;\r\n  TJSTouchEvent = Class;\r\n  TJSInputEvent = class;\r\n  TJSBlob = class;\r\n  TJSPermissions = class;\r\n  TJSFileSystemFileHandle = class;\r\n  TJSFileSystemFileHandleArray = array of TJSFileSystemFileHandle;\r\n  TJSFileSystemDirectoryHandle = class;\r\n  TJSFileSystemDirectoryHandleArray = array of TJSFileSystemDirectoryHandle;\r\n  TJSShowOpenFilePickerOptions = class;\r\n  TJSShowSaveFilePickerOptions = class;\r\n  TJSServiceWorker = class;\r\n  TJSClient = class;\r\n  TJSRequest = Class;\r\n  TJSResponse = Class;\r\n  TJSServiceWorkerRegistration = class;\r\n\r\n  { TEventListenerEvent }\r\n\r\n(*\r\nTEventListenerEvent = class external name 'EventListener_Event' (TJSObject)\r\n  private\r\n    FTarget: TJSEventTarget; external name 'target';\r\n  public\r\n    Property target: TJSEventTarget Read FTarget;\r\n  end;\r\n*)\r\n  TEventListenerEvent = TJSEvent;\r\n\r\n  TJSEventHandler = reference to function(Event: TEventListenerEvent): boolean; safecall;\r\n  TJSRawEventHandler = reference to Procedure(Event: TJSEvent); safecall;\r\n\r\n  TJSEventTarget = class external name 'EventTarget' (TJSObject)\r\n  public\r\n    procedure addEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure addEventListener(aname : string; aListener : TJSRawEventHandler);\r\n    procedure addEventListener(aname : string; aListener : JSValue);\r\n    function dispatchEvent(event : JSValue) : Boolean;\r\n    procedure removeEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure removeEventListener(aname : string; aListener : TJSRawEventHandler);\r\n    procedure removeEventListener(aname : string; aListener : JSValue);\r\n  end;\r\n\r\n  TJSNode = class external name 'Node' (TJSEventTarget)\r\n  Private\r\n    FBaseURI : String; external name 'baseURI';\r\n    FChildNodes: TJSNodeList; external name 'childNodes';\r\n    FFirstChild : TJSNode; external name 'firstChild';\r\n    FLastChild : TJSNode; external name 'lastChild';\r\n    FNextSibling : TJSNode; external name 'nextSibling';\r\n    FNodeName : String; external name 'nodeName';\r\n    FNodeType : NativeInt; external name 'nodeType';\r\n    FOwnerDocument : TJSDocument; external name 'ownerDocument';\r\n    FParentElement : TJSElement; external name 'parentElement';\r\n    FParentNode : TJSNode; external name 'parentNode';\r\n    FPreviousSibling : TJSNode; external name 'previousSibling';\r\n  Public \r\n    Const\r\n      ELEMENT_NODE \t=1;\r\n      TEXT_NODE \t=3;\r\n      PROCESSING_INSTRUCTION_NODE = \t7;\r\n      COMMENT_NODE \t=8;\r\n      DOCUMENT_NODE \t=9;\r\n      DOCUMENT_TYPE_NODE \t= 10;\r\n      DOCUMENT_FRAGMENT_NODE  = 11;\r\n\r\n      DOCUMENT_POSITION_DISCONNECTED \t= 1;\r\n      DOCUMENT_POSITION_PRECEDING \t= 2;\r\n      DOCUMENT_POSITION_FOLLOWING \t= 4;\r\n      DOCUMENT_POSITION_CONTAINS \t= 8;\r\n      DOCUMENT_POSITION_CONTAINED_BY \t= 16;\r\n      DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC = 32;\r\n  Public  \r\n    nodeValue: string;\r\n    innerText : string;\r\n    textContent : string;\r\n    function appendChild(aChild : TJSNode) : TJSNode;\r\n    function cloneNode(deep:  boolean): TJSNode;\r\n    function compareDocumentPosition(aNode : TJSNode) : NativeInt;\r\n    function contains(aNode : TJSNode) : boolean;\r\n    function hasChildNodes : boolean;\r\n    function insertBefore(newNode, referenceNode : TJSNode) : TJSNode;\r\n    function isDefaultNameSpace(aNameSpaceURI : String) : Boolean;\r\n    function isEqualNode(aNode : TJSNode) : boolean;\r\n    function isSameNode(aNode : TJSNode) : boolean;\r\n    function lookupNamespaceURI(aPrefix : string) : string;\r\n    function lookupPrefix(aPrefix : string) : string;\r\n    procedure normalize;\r\n    function removeChild(aChild: TJSNode) : TJSNode;\r\n    function replaceChild(aNewChild, aOldChild : TJSNode) : TJSNode;\r\n    property baseURI : string read FBaseURI;\r\n    property childNodes : TJSNodeList read FChildNodes;\r\n    property firstChild : TJSNode read FFirstChild;\r\n    property lastChild: TJSNode read FLastChild;\r\n    property nextSibling : TJSNode read FNextSibling;\r\n    property nodeName : String Read FNodeName;\r\n    property nodeType : NativeInt Read FNodeType;\r\n    property ownerDocument : TJSDocument read FOwnerDocument;    \r\n    property parentElement : TJSElement read FParentElement;\r\n    property parentNode : TJSNode read FParentNode;\r\n    property previousSibling : TJSNode Read FPreviousSibling;\r\n  end;\r\n\r\n\r\n  TJSNodeListCallBack = procedure (currentValue : TJSNode; currentIndex: NativeInt; list : TJSNodeList);\r\n  TJSNodeListEvent = procedure (currentValue : TJSNode; currentIndex: NativeInt; list : TJSNodeList) of object;\r\n  \r\n  TJSNodeList = class external name 'NodeList' (TJSObject)\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  Public\r\n    procedure forEach(const aCallBack : TJSNodeListCallBack);\r\n    procedure forEach(const aCallBack : TJSNodeListEvent);\r\n    function item(aIndex : NativeInt) : TJSNode;\r\n    Property length : NativeInt Read FLength;\r\n    Property Nodes [aIndex : NativeInt] : TJSNode Read item; default;\r\n  end;\r\n\r\n  TJSAttr = class external name 'Attr' (TJSNode)\r\n  Private\r\n    fLocalName : String; external name 'localName';\r\n    fNameSpaceURI : String external name 'namespaceURI';\r\n    fPrefix : string; external name 'prefix';\r\n    fName : string; external name 'name';\r\n    fSpecified : Boolean; external name 'specified';\r\n  public\r\n    value : JSValue;\r\n    property localName : String Read fLocalName;\r\n    property namespaceURI : string Read fNameSpaceURI;\r\n    property prefix : string read fPrefix;\r\n    property name : string Read fName;\r\n    property specified : boolean Read fSpecified; // Useless, always true\r\n  end;\r\n\r\n\r\n  TJSNamedNodeMap = class external name 'NamedNodeMap'  (TJSObject)\r\n  Public\r\n    function getNamedItem(aName : string) : TJSAttr;\r\n    Property Attrs[aIndex : String] : TJSattr Read getNamedItem; default;\r\n  end;\r\n  \r\n  TJSHTMLCollection = class external name 'HTMLCollection'  (TJSObject)\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  public\r\n    Function item(aIndex : Integer) : TJSNode;\r\n    Function namedItem(aName : string) : TJSNode;\r\n    property Items[aIndex : Integer] : TJSNode Read item; default;\r\n    property NamedItems[aName : String] : TJSNode Read namedItem; \r\n    Property length : NativeInt Read FLength;\r\n  end;  \r\n  \r\n  TJSDOMString = String;\r\n\r\n  TDOMTokenlistCallBack = Procedure (Current : JSValue; currentIndex : NativeInt; list : TJSDOMTokenList);\r\n  \r\n  // Interface\r\n  TJSDOMTokenList = class external name 'DOMTokenList'  (TJSObject)\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  public\r\n    Procedure add(aToken : TJSDOMString); varargs;\r\n    Procedure remove(aToken : TJSDOMString); varargs;\r\n    function item(aIndex : NativeInt) : String;\r\n    function contains(aToken : TJSDOMString) : Boolean;\r\n    Procedure replace(aOldToken, ANewToken : TJSDOMString);\r\n    function supports(aToken : TJSDOMString) : Boolean;\r\n    function toggle(aToken : TJSDOMString) : Boolean;\r\n    // entries,keys, values\r\n    procedure forEach(const callback: TDOMTokenlistCallBack);\r\n    property length : NativeInt read FLength;\r\n  end;\r\n\r\n  TJSDOMRect = class external name 'DOMRect'  (TJSObject)\r\n  public\r\n    left,top,right,bottom,x,y,width,height : double;\r\n    {$IFDEF FIREFOX}\r\n    constructor New;\r\n    {$ENDIF}\r\n  end;\r\n  TJSClientRect = record\r\n    left,top,right,bottom : double;\r\n    {$IFDEF FIREFOX}\r\n    width, height: double;\r\n    {$ENDIF}\r\n  end;\r\n  \r\n  TJSClientRectArray = array of TJSClientRect;\r\n  \r\n  TJSElement = class external name 'Element' (TJSNode)\r\n  Private\r\n    FAttributes : TJSNamedNodeMap; external name 'attributes';\r\n    FChildElementCount : NativeInt; external name 'childElementCount';\r\n    FChildren : TJSHTMLCollection; external name 'children';\r\n    FClassList : TJSDOMTokenList; external name 'classList';\r\n    FCLientHeight : NativeInt; external name 'clientHeight';\r\n    FCLientLeft : NativeInt; external name 'clientLeft';\r\n    FCLientTop : NativeInt; external name 'clientTop';\r\n    FCLientWidth : NativeInt; external name 'clientWidth';\r\n    FFirstElementChild : TJSElement; external name 'firstElementChild';\r\n    FLastElementChild : TJSElement; external name 'lastElementChild';\r\n    FLocalName : string; external name 'localName';\r\n    FNameSpaceURI : String; external name 'namespaceURI';\r\n    FNextElementSibling : TJSElement; external name 'nextElementSibling';\r\n    FPreviousElementSibling : TJSElement; external name 'previousElementSibling';\r\n    FPrefix : String; external name 'prefix';\r\n    FScrollHeight : NativeInt; external name 'scrollHeight';\r\n{$IFDEF FIREFOX}\r\n    FScrollLeftMax : NativeInt; external name 'scrollLeftMax';\r\n    FScrollTopMax : NativeInt; external name 'scrollTopMax';\r\n{$endif}\r\n    FScrollWidth : NativeInt; external name 'scrollWidth';\r\n    FTagName : string; external name 'tagName';\r\n  Public\r\n    name : string;\r\n    className : string;\r\n    id : string;\r\n    innerHTML : String;\r\n    outerHTML : string;\r\n    scrollLeft : NativeInt;\r\n    scrollTop : NativeInt;\r\n    procedure append(aText : String); overload;\r\n    procedure append(aNode : TJSElement); overload;\r\n    procedure append(aText : String; aNode : TJSElement); varargs; overload;\r\n    procedure append(aNode1,aNode2: TJSElement); varargs; overload;\r\n    function getAttribute(aName : string) : string;\r\n    function getAttributeNode(aName : string) : TJSAttr;\r\n    function getAttributeNodeNS(aNameSpace, aName : string) : TJSAttr;\r\n    function getAttributeNS(aNameSpace, aName : string) : string;\r\n    function getBoundingClientRect : TJSDOMRect;\r\n    function getClientRects : TJSClientRectArray;\r\n    function getElementsByClassName(aClassName: string) : TJSHTMLCollection;\r\n    function getElementsByTagNameNS(aNameSpace, aTagName : String): TJSHTMLCollection;\r\n    function getElementsByTagName(aTagName : String): TJSHTMLCollection;\r\n    function hasAttribute(aName : String) : Boolean;\r\n    function hasAttributeNS(aNameSpace,aName : String) : Boolean;\r\n    function hasAttributes : Boolean;\r\n    function insertAdjacentElement(aPosition : string; aElement : TJSElement) : TJSElement;\r\n    procedure insertAdjacentHTML(aPosition,aHTML : string);\r\n    procedure insertAdjacentText(aPosition,aText : string);\r\n    function matches(aSelectorString : String) : Boolean;\r\n    function querySelector(aSelectors : String) : TJSElement;\r\n    function querySelectorAll(aSelectors : String) : TJSNodeList;\r\n    procedure remove; overload;\r\n    procedure releasePointerCapture(evID : JSValue);\r\n    procedure removeAttribute(aName: string);\r\n    procedure removeAttributeNS(aNameSpace,aName: string);\r\n    function removeAttributeNode(aAttr : TJSAttr) : TJSAttr;\r\n    procedure setAttribute(aName : string; AValue : String);\r\n    function setAttributeNode(aNode: TJSAttr) : TJSAttr;\r\n    function setAttributeNodeNS(aNode: TJSAttr) : TJSAttr;\r\n    procedure setAttributeNS(aNameSpace,aName : string; AValue : String);\r\n    procedure setCapture(retargetToElement : Boolean);\r\n    procedure setPointerCapture(pointerID : JSValue);\r\n    procedure requestFullScreen;    \r\n    Property attributes : TJSNamedNodeMap read FAttributes;\r\n    Property childElementCount : NativeInt Read FChildElementCount;\r\n    Property children : TJSHTMLCollection Read FChildren;\r\n    Property classList : TJSDOMTokenList read FClassList;\r\n    property clientHeight : NativeInt read FClientHeight;\r\n    property clientLeft : NativeInt read FClientLeft;\r\n    property clientTop : NativeInt read FClientTop;\r\n    property clientWidth : NativeInt read FClientWidth;\r\n    property firstElementChild : TJSElement Read FFirstElementChild;\r\n    property lastElementChild : TJSElement Read FLastElementChild;\r\n    property localName : string Read FLocalName;\r\n    property namespaceURI : String read FNameSpaceURI;\r\n    property nextElementSibling : TJSElement Read FNextElementSibling;\r\n    property previousElementSibling : TJSElement Read FPreviousElementSibling;\r\n    property prefix : String read FPrefix;\r\n    property scrollHeight : NativeInt Read FScrollHeight;\r\n{$IFDEF FIREFOX}\r\n    property scrollLeftMax  : NativeInt Read FScrollLeftMax;\r\n    property scrollTopMax  : NativeInt Read FScrollTopMax;\r\n{$ENDIF}\r\n    property scrollWidth : NativeInt Read FScrollWidth;\r\n    property tagName : String read FTagName;\r\n    Property Attrs[aName : string] : String read getAttribute write setAttribute; default;\r\n  end;\r\n   \r\n  TJSElementCreationOptions = record\r\n    named : string;\r\n  end;\r\n \r\n  TJSDocumentType = class external name 'DocumentType' (TJSNode)\r\n  private\r\n    FName : String; external name 'name';\r\n    FPublicID : String; external name 'publicId';\r\n    FSystemID : String; external name 'systemId';\r\n  public\r\n    property name : String read FName;\r\n    property publicId : String Read FPublicID;\r\n    property systemId : String read FSystemID;\r\n  end;\r\n\r\n  TJSDOMImplementation  = class external name 'DocumentImplementation'  (TJSObject)\r\n  Public  \r\n    function createDocument(aNamespaceURI, aQualifiedNameStr : String; aDocumentType : TJSDocumentType) : TJSDocument;\r\n    function createDocumentType(aQualifiedNameStr,aPublicId,aSystemId : String) : TJSDocumentType;\r\n    function createHTMLDocument(aTitle : String) : TJSDocument;\r\n  end;\r\n\r\n  TJSLocation = class external name 'Location'  (TJSObject)\r\n  Private\r\n    FOrigin : string; external name 'origin';\r\n  Public\r\n    hash : string;\r\n    host : string;\r\n    hostname : string;\r\n    href : string;\r\n    password : string;\r\n    pathname : string;\r\n    port : string;\r\n    protocol : string;\r\n    search : string;\r\n    username : string;\r\n    procedure assign(aURL : String); overload;\r\n    procedure reload(aForce : Boolean);\r\n    procedure replace(aURL : String);\r\n    property origin : string read FOrigin;\r\n  end;\r\n  \r\n  TJSCSSStyleDeclaration = class; // forward\r\n\r\n  TJSStyleSheet = class external name 'StyleSheet' (TJSEventTarget)\r\n  Private\r\n    FHRef : String; external name 'href';\r\n    FOwnerNode : TJSNode; external name 'ownerNode';\r\n    FParentStyleSheet : TJSStyleSheet; external name 'parentStyleSheet';\r\n    FTitle : String; external name 'title';\r\n    FType : String; external name 'type';\r\n  Public\r\n    disabled : String;\r\n    Property href : String read FHRef;\r\n    property ownerNode : TJSNode Read FOwnerNode;\r\n    property parentStyleSheet : TJSStyleSheet read FParentStyleSheet;\r\n    property title : string Read FTitle;\r\n    property _type : String read FType;\r\n  end;\r\n\r\n  TJSCSSRule = class external name 'CSSRule'  (TJSObject)\r\n  Private\r\n    FCSSText : String; external name 'cssText';\r\n    FParentStyleSheet : TJSCSSStyleSheet; external name 'parentStyleSheet';\r\n    FparentRule : TJSCSSRule; external name 'parentRule';\r\n  Public\r\n    property cssText : String Read FCSSText;\r\n    property parentRule : TJSCSSRule read FparentRule;\r\n    property parentStyleSheet : TJSCSSStyleSheet Read FParentStyleSheet;\r\n  end;\r\n\r\n  TJSCSSStyleRule = class external name 'CSSStyleRule' (TJSCSSRule)\r\n  private\r\n    FStyle: TJSCSSStyleDeclaration; external name 'style';\r\n  public\r\n    selectorText: String;\r\n    property style: TJSCSSStyleDeclaration read FStyle;\r\n  end;\r\n  \r\n  TJSCSSRuleList = Class external name 'CSSRuleList'  (TJSObject)\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  Public\r\n    function item(index : NativeInt) : TJSCSSRule;\r\n    property length : NativeInt Read FLength;\r\n    Property items[aIndex : NativeInt] : TJSCSSRule read item; default;\r\n  end;\r\n  \r\n  \r\n  TJSCSSStyleSheet = class external name 'CSSStyleSheet' (TJSStyleSheet)\r\n  Private\r\n    FCSSRules : TJSCSSRuleList; external name 'cssRules';\r\n  Public\r\n    procedure deleteRule(aIndex : NativeInt);\r\n    function insertRule(aRule : String; aIndex : NativeInt) : NativeInt;\r\n    Property cssRules : TJSCSSRuleList read FCSSRules;\r\n  end;\r\n\r\n  TJSStyleSheetList = Class external name 'StyleSheetList'  (TJSObject)\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  Public\r\n    function item(index : NativeInt) : TJSStyleSheet;\r\n    property length : NativeInt Read FLength;\r\n    Property items[aIndex : NativeInt] : TJSStyleSheet read item; default;\r\n  end;\r\n\r\n  { TJSDocumentFragment }\r\n\r\n  TJSDocumentFragment = Class external name 'DocumentFragment' (TJSNode)\r\n  private\r\n    FchildElementCount: Integer; external name 'childElementCount';\r\n    Fchildren: TJSHTMLCollection; external name 'children';\r\n    FfirstElementChild: TJSElement; external name 'firstElementChild';\r\n    FlastElementChild: TJSElement; external name 'lastElementChild';\r\n  public\r\n    constructor new;\r\n    function querySelector(aSelector : String) : TJSElement;\r\n    function querySelectorAll(aSelector : String) : TJSNodeList;\r\n    property childElementCount : Integer read FchildElementCount;\r\n    property children : TJSHTMLCollection read Fchildren;\r\n    property firstElementChild : TJSElement read FfirstElementChild;\r\n    property lastElementChild : TJSElement read FlastElementChild;\r\n  end;\r\n\r\n  TJSEventInit = record\r\n    bubbles : boolean;\r\n    cancelable : boolean;\r\n    scoped : boolean;\r\n    composed : boolean;\r\n  end;\r\n\r\n  TJSEvent = class external name 'Event'  (TJSObject)\r\n  Private\r\n    FBubbles : Boolean; external name 'bubbles';\r\n    FCancelable : Boolean; external name 'cancelable';\r\n    FComposed : Boolean; external name 'composed';\r\n    FCurrentTarget : TJSEventTarget; external name 'currentTarget';\r\n    FCurrentTargetElement : TJSElement; external name 'currentTarget';\r\n    FdefaultPrevented : Boolean; external name 'defaultPrevented';\r\n    FEventPhase : NativeInt; external name 'eventPhase';\r\n    FTarget : TJSEventTarget; external name 'target';\r\n    FTargetElement : TJSElement; external name 'target';\r\n    FTimeStamp : NativeInt; external name 'timestamp';\r\n    FType : String; external name 'type';\r\n    FIsTrusted : Boolean; external name 'isTrusted';\r\n  Public\r\n    Const\r\n      NONE = 0;\r\n      CAPTURING_PHASE = 1;\r\n      AT_TARGET  = 2;\r\n      BUBBLING_PHASE = 3;\r\n  public    \r\n    cancelBubble : Boolean;\r\n    constructor new (aType : String; const aInit : TJSEventInit); overload;\r\n    constructor new (aType : String); overload;\r\n    procedure preventDefault;\r\n    procedure stopImmediatePropagation;\r\n    procedure stopPropagation;\r\n    Property bubbles : Boolean Read FBubbles;\r\n    Property cancelable : Boolean Read FCancelable;\r\n    Property composed : Boolean Read FComposed;\r\n    property currentTarget : TJSEventTarget Read FCurrentTarget;\r\n    property currentTargetElement : TJSElement Read FCurrentTargetElement;\r\n    property defaultPrevented : Boolean Read FdefaultPrevented;\r\n    property eventPhase : NativeInt Read FEventPhase;\r\n    property target : TJSEventTarget Read FTarget;\r\n    property targetElement : TJSElement Read FTargetElement;\r\n    Property timestamp : NativeInt Read FTimeStamp;\r\n    property _type : string read FType;\r\n    property isTrusted : Boolean Read FIsTrusted;\r\n  end;\r\n\r\n\r\n  TJSXPathExpression = class external name 'XPathExpression'  (TJSObject)\r\n  Public\r\n    function evaluate(contextNode : TJSNode; aType : NativeInt; aResult : TJSXPathResult) : TJSXPathResult;\r\n    function evaluateWithContext(contextNode : TJSNode; aPosition, aSize, aType : NativeInt; aResult : TJSXPathResult) : TJSXPathResult;\r\n  end;\r\n\r\n  TJSXPathNSResolver = class external name 'XPathNSResolver'  (TJSObject)\r\n  Public\r\n    function lookupNamespaceURI(prefix : string) : string;\r\n  end;\r\n\r\n  { TJSCharacterData }\r\n\r\n  TJSCharacterData = class external name 'CharacterData' (TJSNode)\r\n  private\r\n    FnextElementSibling: TJSElement; external name 'nextElementSibling';\r\n    FpreviousElementSibling: TJSElement; external name 'previousElementSibling';\r\n  public\r\n    property nextElementSibling : TJSElement read FnextElementSibling;\r\n    property previousElementSibling : TJSElement read FpreviousElementSibling;\r\n  end;\r\n\r\n\r\n  TJSProcessingInstruction = class external name 'ProcessingInstruction' (TJSCharacterData);\r\n\r\n  { TJSRange }\r\n\r\n  TJSRange = class external name 'Range'  (TJSObject)\r\n  private\r\n    FCollapsed: boolean; external name 'collapsed';\r\n    FcommonAncestorContainer: TJSNode; external name 'commonAncestorContainer';\r\n    FendContainer: TJSNode; external name 'endContainer';\r\n    FEndOffset: NativeInt; external name 'endOffset';\r\n    FstartContainer: TJSNode; external name 'startContainer';\r\n    FstartOffset: NativeInt; external name 'startOffset';\r\n  Public\r\n    const\r\n      END_TO_END     = 0;\r\n      END_TO_START   = 1;\r\n      START_TO_END   = 2;\r\n      START_TO_START = 3;\r\n  Public\r\n    constructor new;\r\n    function cloneContents : TJSDocumentFragment;\r\n    function cloneRange : TJSRange;\r\n    procedure collapse;\r\n    function compareBoundaryPoints(aHow : NativeInt) : NativeInt;\r\n    function createContextualFragment(aTagstring : String) : TJSDocumentFragment;\r\n    procedure deleteContents;\r\n    procedure detach;\r\n    function extractContents : TJSDocumentFragment;\r\n    procedure insertNode(aNode : TJSNode);\r\n    procedure selectNode(aNode : TJSNode);\r\n    procedure selectNodeContents(aNode : TJSNode);\r\n    procedure setEnd(aEndNode : TJSNode; aEndOffset : NativeInt); \r\n    procedure setEndAfter(aEndNode : TJSNode);\r\n    procedure setEndBefore(aEndNode : TJSNode);\r\n    procedure setStart(aStartNode : TJSNode; aStartOffset : NativeInt); \r\n    procedure setStartAfter(aStartNode : TJSNode);\r\n    procedure setStartBefore(aStartNode : TJSNode);\r\n    procedure surroundContents(aNode : TJSNode);\r\n    property collapsed : boolean read FCollapsed;\r\n    property commonAncestorContainer : TJSNode read FcommonAncestorContainer ;\r\n    property endContainer : TJSNode read FendContainer;\r\n    property endOffset : NativeInt Read FEndOffset;\r\n    property startContainer : TJSNode read FstartContainer;\r\n    property startOffset : NativeInt Read FstartOffset;\r\n  end;\r\n\r\n\r\n  { TJSTreeWalker }\r\n\r\n  TJSTreeWalker = class external name 'TreeWalker' (TJSObject)\r\n  private\r\n    FCurrentNode: TJSNode; external name 'currentNode';\r\n    FexpandEntityReference: Boolean; external name 'expandEntityReference';\r\n    FFilter: TJSNodeFilter; external name 'filter';\r\n    FRoot: TJSNode; external name 'root';\r\n    FWhatToShow: NativeInt; external name 'whatToShow';\r\n  Public\r\n    function firstChild : TJSNode;\r\n    function lastChild : TJSNode;\r\n    function nextNode : TJSNode;\r\n    function nextSibling : TJSNode;\r\n    function parentNode : TJSNode;\r\n    function previousNode : TJSNode;\r\n    function previousSibling : TJSNode;\r\n\r\n    property root : TJSNode read FRoot;\r\n    property whatToShow : NativeInt read FWhatToShow;\r\n    property filter : TJSNodeFilter Read FFilter;\r\n    property expandEntityReference : Boolean Read FexpandEntityReference;\r\n    property currentNode : TJSNode Read FCurrentNode;\r\n  end;\r\n\r\n  TJSNodeFilter = class external name 'NodeFilter'  (TJSObject)\r\n    const\r\n      SHOW_ALL                    = -1;\r\n      SHOW_ATTRIBUTE              = 2;\r\n      SHOW_CDATA_SECTION          = 8;\r\n      SHOW_COMMENT                = 128;\r\n      SHOW_DOCUMENT               = 256;\r\n      SHOW_DOCUMENT_FRAGMENT      = 1024;\r\n      SHOW_DOCUMENT_TYPE          = 512;\r\n      SHOW_ELEMENT                = 1;\r\n      SHOW_ENTITY                 = 32;\r\n      SHOW_ENTITY_REFERENCE       = 16;\r\n      SHOW_NOTATION               = 2048;\r\n      SHOW_PROCESSING_INSTRUCTION = 64;\r\n      SHOW_TEXT                   = 4;\r\n    function acceptNode (aNode : TJSNode) : NativeInt;\r\n  end;\r\n\r\n  TJSXPathResult = class external name 'XPathResult'  (TJSObject)\r\n  private\r\n    FBooleanValue : Boolean; external name 'booleanValue';\r\n    FNumberValue : Double; external name 'numberValue';\r\n    FResultType : NativeInt; external name 'resultType';\r\n    FSingleNodeValue : TJSNode;  external name 'singleNodeValue';\r\n    FSnaphotLength : NativeInt; external name 'snapshotLength';\r\n    FStringValue : String; external name 'stringValue';\r\n  public  \r\n    Function iterateNext : TJSNode;\r\n    Function snapshotItem(Index: NativeInt) : TJSNode;\r\n    Property booleanValue : Boolean Read FBooleanValue;\r\n    Property numberValue : Double Read FNumberValue;\r\n    property resultType : NativeInt Read FResultType;\r\n    Property singleNodeValue : TJSNode Read FSingleNodeValue;\r\n    property snapshotLength : NativeInt read FSnaphotLength;\r\n    property stringValue : String Read FStringValue;\r\n  end;\r\n\r\n  TJSSelection = class external name 'Selection'  (TJSObject)\r\n  Private\r\n    FanchorNode : TJSNode ; external name 'anchorNode';\r\n    FanchorOffset : NativeInt ; external name 'anchorOffset';\r\n    FfocusNode : TJSNode ; external name 'focusNode';\r\n    FfocusOffset : NativeInt ; external name 'focusOffset';\r\n    FisCollapsed : Boolean ; external name 'isCollapsed';\r\n    FrangeCount : NativeInt ; external name 'rangeCount';\r\n    Ftype : String ; external name 'type';\r\n  Public\r\n    function getRangeAt(aIndex : NativeInt) : TJSRange;\r\n    procedure collapse(aParentNode : TJSNode; Offset : NativeInt);\r\n    procedure extend(aParentNode : TJSNode; Offset : NativeInt);\r\n    procedure collapseToStart;\r\n    procedure collapseToEnd;\r\n    procedure selectAllChildren(aParentNode : TJSNode);\r\n    procedure addRange(aRange : TJSRange);\r\n    procedure removeRange(aRange : TJSRange);\r\n    procedure removeAllRanges;\r\n    procedure deleteFromDocument;\r\n    function containsNode(aNode : TJSNode; aPartlyContained : Boolean) : Boolean;\r\n    procedure setBaseAndExtent(aAnchorNode : TJSNode; aAnchorOffset : NativeInt; aFocusNode : TJSNode; aFocusOffset : NativeInt);\r\n    property anchorNode : TJSNode read FAnchorNode;\r\n    property anchorOffset : NativeInt read FAnchorOffset;\r\n    property focusNode : TJSNode read FFocusNode;\r\n    property focusOffset : NativeInt read FFocusOffset;\r\n    property isCollapsed : Boolean read FIsCollapsed;\r\n    property rangeCount : NativeInt read FRangeCount;\r\n    property _type : String Read FType;\r\n  end;\r\n  TJSNameSpaceMapperCallback = function (aNameSpace : string ) : String;\r\n\r\n  TJSHTMLFile = class;\r\n  TJSHTMLFileList = Class;\r\n\r\n  { TJSDataTransferItem }\r\n\r\n  TJSDataTransferItemCallBack = reference to Procedure(aData : String); safecall;\r\n\r\n  TJSDataTransferItem = class external name 'DataTransferItem'  (TJSObject)\r\n  private\r\n    FKind: String; external name 'kind';\r\n    FType: string; external name 'type';\r\n  Public\r\n    function getAsFile : TJSHTMLFile;\r\n    Procedure getAsString(aCallBack : TJSDataTransferItemCallBack);\r\n    property Kind : String read FKind;\r\n    property _Type : string read FType;\r\n  end;\r\n\r\n  TJSDataTransferItemList = class external name 'DataTransferItemList'  (TJSObject)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSDataTransferItem ; external name '[]';\r\n  Public\r\n    Function add(aData : string; AType: string) : TJSDataTransferItem; overload;\r\n    Function add(aFile : TJSHTMLFile) : TJSDataTransferItem; overload;\r\n    Procedure clear;\r\n    procedure remove(aIndex : integer);\r\n    property length : NativeInt read FLength;\r\n    property Items[aIndex : NativeInt] : TJSDataTransferItem Read getitem; default;\r\n  end;\r\n\r\n  { TJSDataTransfer }\r\n\r\n  TJSDataTransfer = class external name 'DataTransfer'  (TJSObject)\r\n  private\r\n    FFiles: TJSHTMLFileList; external name 'files';\r\n    FItems: TJSDataTransferItemList; external name 'items';\r\n    FTypes: TJSStringDynArray; external name 'types';\r\n  Public\r\n    dropEffect : string;\r\n    effectAllowed : string;\r\n    Procedure clearData; overload;\r\n    Procedure clearData(aFormat : string); overload;\r\n    function getData(aFormat : string) : String;\r\n    procedure setData(aFormat : String; aData : String);\r\n    procedure setDragImage(aImage: TJSElement; xOffset,yOffset : integer);\r\n    property files : TJSHTMLFileList Read FFiles;\r\n    property items : TJSDataTransferItemList read FItems;\r\n    property types : TJSStringDynArray read FTypes;\r\n  end;\r\n\r\n  { TJSDragEvent }\r\n\r\n  TJSDragEvent = class external name 'DragEvent' (TJSEvent)\r\n  Private\r\n    FDataTransfer: TJSDataTransfer; external name 'dataTransfer';\r\n    FrelatedTarget : TJSEventTarget external name 'relatedTarget';\r\n    FscreenX : NativeInt external name 'screenX';\r\n    FscreenY : NativeInt external name 'screenY';\r\n    FclientX : NativeInt external name 'clientX';\r\n    FclientY : NativeInt external name 'clientY';\r\n    Fbutton : NativeInt external name 'button';\r\n    Fbuttons : NativeInt external name 'buttons';\r\n    FctrlKey : Boolean external name 'ctrlKey';\r\n    FshiftKey : Boolean external name 'shiftKey';\r\n    FaltKey  : Boolean external name 'altKey';\r\n    FmetaKey  : Boolean external name 'metaKey';\r\n  Public\r\n    Property relatedTarget : TJSEventTarget Read FRelatedTarget;\r\n    Property screenX : NativeInt Read FScreenX;\r\n    Property screenY : NativeInt Read FScreenY;\r\n    Property clientX : NativeInt Read FClientX;\r\n    Property clientY : NativeInt Read FClientY;\r\n    Property button : NativeInt Read FButton;\r\n    Property buttons : NativeInt Read FButtons;\r\n    Property ctrlKey : Boolean Read FctrlKey;\r\n    Property shiftKey : Boolean Read FshiftKey;\r\n    Property altKey  : Boolean Read FaltKey;\r\n    Property metaKey  : Boolean Read FmetaKey;\r\n    property dataTransfer : TJSDataTransfer Read FDataTransfer;\r\n  end;\r\n  TJSDragDropEventHandler = reference to function(aEvent: TJSDragEvent) : Boolean; safecall;\r\n  THTMLClickEventHandler = reference to function(aEvent : TJSMouseEvent) : boolean; safecall;\r\n\r\n  TJSClipBoardEvent = Class external name 'ClipboardEvent' (TJSEvent)\r\n  Private\r\n    FClipboardData: TJSDataTransfer external name 'clipboardData';\r\n  Public\r\n    Property ClipBoardData : TJSDataTransfer Read FClipBoardData;\r\n  end;\r\n\r\n  { Various events }\r\n\r\n  TJSFocusEvent = Class(TJSEvent)\r\n  private\r\n    FrelatedTarget : TJSElement external name 'relatedTarget';\r\n  public\r\n    property relatedTarget : TJSElement Read FrelatedTarget;\r\n  end;\r\n\r\n  TJSAnimationEvent = Class(TJSEvent);\r\n  TJSLoadEvent = Class(TJSEvent);\r\n\r\n  TJSErrorEvent = class external name 'ErrorEvent' (TJSEvent)\r\n  Private\r\n    Fmessage : String external name 'message';\r\n    Ffilename : string external name 'filename';\r\n    Flineno : integer external name 'lineno';\r\n    Fcolno : integer external name 'colno';\r\n    Ferror : TJSObject external name 'error';\r\n  Public\r\n    Property message : String read FMessage;\r\n    property filename : string Read FFileName;\r\n    property lineno : integer read FLineNo;\r\n    Property colno : integer read FColNo;\r\n    Property error : TJSObject read FError;\r\n  end;\r\n\r\n  TJSPageTransitionEvent = class(TJSEvent)\r\n  end;\r\n\r\n  TJSHashChangeEvent = class external name 'HashChangeEvent' (TJSEvent)\r\n  Private\r\n    FnewURL : String external name 'newURL';\r\n    FoldURL : String external name 'oldURL';\r\n  public\r\n    property newURL : String Read FNewURL;\r\n    property oldURL : String Read FOldURL;\r\n  end;\r\n\r\n  TJSPopStateEvent = class external name 'PopStateEvent'  (TJSEvent)\r\n  Private\r\n    FState : JSValue; external name 'state';\r\n  Public\r\n    property state : JSValue read FState;\r\n  end;\r\n\r\n  TJSStorageEvent = class external name 'StorageEvent' (TJSEvent)\r\n  private\r\n    Fkey : String external name 'key';\r\n    FoldValue : String external name 'oldValue';\r\n    FnewValue : String external name 'newValue';\r\n    Furl : String external name 'url';\r\n    FstorageArea : String external name 'storageArea';\r\n  public\r\n    Property key : String Read FKey;\r\n    Property oldValue : String Read FOldValue;\r\n    Property newValue : String Read FNewValue;\r\n    Property url : String Read FURL;\r\n    Property storageArea : String Read FstorageArea;\r\n  end;\r\n\r\n  { TJSProgressEvent }\r\n\r\n  TJSProgressEvent = class external name 'ProgressEvent' (TJSEvent)\r\n  Private\r\n    FlengthComputable : Boolean external name 'lengthComputable';\r\n    Floaded : NativeUINT external name 'loaded';\r\n    FTotal : NativeUINT external name 'Total';\r\n  Public\r\n    property lengthComputable : Boolean Read FlengthComputable;\r\n    property loaded : NativeUINT Read FLoaded;\r\n    property Total : NativeUINT Read FTotal;\r\n  end;\r\n\r\n  TJSCloseEvent = class external name 'CloseEvent' (TJSEvent)\r\n  private\r\n    fcode: Word; external name 'code';\r\n    freason: TJSDOMString; external name 'reason';\r\n    fwasClean: Boolean; external name 'wasClean';\r\n  public\r\n    property code: Word read fcode;\r\n    property reason: TJSDOMString read freason;\r\n    property wasClean: Boolean read fwasClean;\r\n  end; \r\n\r\n  TJSPageTransitionEventHandler = reference to function(aEvent : TJsPageTransitionEvent) : boolean; safecall;\r\n  TJSHashChangeEventhandler = reference to function(aEvent : TJSHashChangeEvent) : boolean; safecall;\r\n  TJSMouseWheelEventHandler = reference to function(aEvent : TJSWheelEvent) : boolean; safecall;\r\n  TJSMouseEventHandler = reference to function(aEvent : TJSMouseEvent) : boolean; safecall;\r\n  THTMLAnimationEventHandler = reference to function(aEvent : TJSAnimationEvent) : boolean; safecall;\r\n  TJSErrorEventHandler = reference to function(aEvent : TJSErrorEvent) : boolean; safecall;\r\n  TJSFocusEventHandler = reference to function(aEvent : TJSFocusEvent) : boolean; safecall;\r\n  TJSKeyEventhandler = reference to function (aEvent : TJSKeyBoardEvent) : boolean; safecall;\r\n  TJSLoadEventhandler = reference to function (aEvent : TJSLoadEvent) : boolean; safecall;\r\n  TJSPointerEventHandler = reference to function(aEvent : TJSPointerEvent) : boolean; safecall;\r\n  TJSUIEventHandler = reference to function(aEvent : TJSUIEvent) : Boolean; safecall;\r\n  TJSPopStateEventHandler = reference to function(aEvent : TJSPopStateEvent) : Boolean; safecall;\r\n  TJSStorageEventHandler = reference to function(aEvent : TJSStorageEvent) : Boolean; safecall;\r\n  TJSProgressEventhandler =  reference to function(aEvent : TJSProgressEvent) : Boolean; safecall;\r\n  TJSTouchEventHandler = reference to function(aEvent : TJSTouchEvent) : boolean; safecall;\r\n\r\n  TJSDocument = class external name 'Document' (TJSNode)\r\n  Private\r\n    fActiveElement : TJSElement; external name 'activeElement';\r\n    FCharacterSet: String; external name 'characterSet';\r\n    FChildElementCount: NativeInt; external name 'childElementCount';\r\n    FCompatMode: String; external name 'compatMode';\r\n    FCurrentScript: TJSElement; external name 'currentScript';\r\n    FDefaultView: TJSWindow; external name 'defaultView';\r\n    FDocType: TJSDocumentType; external name 'docrype';\r\n    FDocumentElement: TJSElement; external name 'documentElement';\r\n    FDocumentURI: String; external name 'documentURI';\r\n    FEmbeds: TJSHTMLCollection; external name 'embeds';\r\n    FFirstElementChild : TJSElement; external name 'firstElementChild';\r\n    FForms: TJSHTMLCollection; external name 'forms';\r\n    FFullScreenElement: TJSElement; external name 'fullscreenElement';\r\n    FFullscreenEnabled: Boolean; external name 'fullscreenEnabled';\r\n    FHead: TJSElement; external name 'head';\r\n    FHidden: Boolean; external name 'hidden';\r\n    FImages: TJSHTMLCollection; external name 'images';\r\n    FImplementation: TJSDOMImplementation; external name 'implementation';\r\n    FLastElementChild : TJSElement; external name 'lastElementChild';\r\n    FLastModified: String; external name 'lastModified';\r\n    FLastStyleSheetSet: String; external name 'lastStyleSheetSet';\r\n    FLinks: TJSHTMLCollection; external name 'links';\r\n    FLocation: TJSLocation; external name 'location';\r\n    FLocationString: String; external name 'location';\r\n    FPlugins: TJSHTMLCollection; external name 'plugins';\r\n    FPointerLockElement: TJSElement; external name 'pointerLockElement';\r\n    FPreferredStyleSheetSet: String; external name 'preferredStyleSheetSet';\r\n    FReadyState: String; external name 'readyState';\r\n    FReferrer: String; external name 'referrer';\r\n    FScripts: TJSHTMLCollection; external name 'scripts';\r\n    FStyleSheets: TJSStyleSheetList; external name 'styleSheets';\r\n    FStyleSheetSets: TJSValueDynArray; external name 'styleSheetSets';\r\n    FURL: String; external name 'URL';\r\n    FVisibilityState: string; external name 'visibilityState';\r\n  Public\r\n    function adoptNode(aExternalNode : TJSNode) : TJSNode;\r\n    procedure close;\r\n    function createAttribute(aName : string) : TJSAttr;\r\n    function createCDATASection(S : String) : TJSNode;\r\n    function createComment(S : String) : TJSNode;\r\n    function createDocumentFragment : TJSDocumentFragment;\r\n    function createElement(tagName : string) : TJSElement; overload;\r\n    function createElement(tagName : string; const options : TJSElementCreationOptions) : TJSElement; overload;\r\n    function createElementNS(aNameSpace,tagName : string) : TJSElement; overload;\r\n    function createElementNS(aNameSpace,tagName : string; const options : TJSElementCreationOptions) : TJSElement; overload;\r\n    function createEvent(aType : string) : TJSEvent;\r\n    function createExpression(xPathText : String; aNameSpaceMapper: TJSNameSpaceMapperCallback) : TJSXPathExpression;\r\n    function createNSResolver(aNode : TJSNode) : TJSXPathNSResolver;\r\n    function createProcessingInstruction(target, data : String) : TJSProcessingInstruction;\r\n    function createRange : TJSRange;\r\n    function createTextNode(S : String) : TJSNode;\r\n    function createTreeWalker(root : TJSNode; whatToShow : NativeInt; filter : TJSNodeFilter) : TJSTreeWalker;\r\n    function elementFromPoint(x,y : integer) : TJSElement;\r\n    procedure enableStyleSheetsForSet(aSet : String);\r\n    function evaluate(xpathExpression : String; ContextNode : TJSNode; NameSpaceResolver : TJSNamespaceMapperCallBack; resultType : NativeInt; aResult : TJSXPathResult) : TJSXPathResult;\r\n    function execCommand(aCommandName : String; aShowDefaultUI : Boolean; AValueArgument : String) : boolean; overload;\r\n    function execCommand(aCommandName : String; aShowDefaultUI : Boolean) : boolean; overload;\r\n    Procedure exitFullScreen;\r\n    function getElementById(aID : String) : TJSElement;\r\n    function getHTMLElementById(aID : String) : TJSHTMLElement; external name 'getElementById';\r\n    function getElementsByClassName(aNames : string) : TJSHTMLCollection;\r\n    function getElementsByName(aName : String) : TJSNodeList;\r\n    function getElementsByTagName(aName : String) : TJSHTMLCollection;\r\n    function getElementsByTagNameNS(aNameSpace,aName : String) : TJSHTMLCollection;\r\n    function getSelection : TJSSelection;\r\n    function hasFocus : boolean;\r\n    function importNode(aExternalNode : TJSNode; Deep: boolean) : TJSNode;\r\n    function querySelector(aSelectors : String) : TJSElement;\r\n    function querySelectorAll(aSelectors : String) : TJSNodeList;\r\n    procedure open;\r\n    procedure releaseCapture;\r\n    procedure write(aLine : string);\r\n    procedure writeln(aLine : String);\r\n  Public\r\n    body : TJSElement;\r\n    cookie: TJSString;\r\n    designMode : string;\r\n    dir : string;\r\n    domain : string;\r\n    selectedStyleSheetSet : string;\r\n    title : string;\r\n    onabort : TJSEventHandler;\r\n    onblur : TJSEventHandler;\r\n    oncancel : TJSEventHandler;\r\n    oncanplay : TJSEventHandler;\r\n    oncanplaythrough : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onclick: THTMLClickEventHandler;\r\n    onclose : TJSEventHandler;\r\n    oncontextmenu : TJSEventHandler;\r\n    oncuechange : TJSEventHandler;\r\n    ondblclick : THTMLClickEventHandler;\r\n    ondrag : TJSDragDropEventHandler;\r\n    ondragend : TJSDragDropEventHandler;\r\n    ondragenter : TJSDragDropEventHandler;\r\n    ondragexit : TJSDragDropEventHandler;\r\n    ondragover : TJSDragDropEventHandler;\r\n    ondragleave : TJSDragDropEventHandler;\r\n    ondragstart: TJSDragDropEventHandler;\r\n    ondrop : TJSDragDropEventHandler;\r\n    ondurationchange : TJSEventHandler;\r\n    onemptied : TJSEventHandler;\r\n    onended : TJSEventHandler;\r\n    onerror : TJSErrorEventHandler;\r\n    onfocus : TJSFocusEventhandler;\r\n    ongotpointercapture : TJSPointerEventHandler;\r\n    oninput : TJSEventhandler;\r\n    oninvalid : TJSEventhandler;\r\n    onkeydown : TJSKeyEventhandler;\r\n    onkeypress : TJSKeyEventhandler;\r\n    onkeyup : TJSKeyEventhandler;\r\n    onload : TJSEventhandler;\r\n    onloadeddata : TJSEventhandler;\r\n    onloadedmetadata : TJSEventhandler;\r\n    onloadend : TJSProgressEventhandler;\r\n    onloadstart : TJSProgressEventhandler;\r\n    onlostpointercapture : TJSPointerEventHandler;\r\n    onmessage : TJSEventHandler;\r\n    onmousedown : TJSMouseEventHandler;\r\n    onmouseenter : TJSMouseEventHandler;\r\n    onmouseleave : TJSMouseEventHandler;\r\n    onmousemove : TJSMouseEventHandler;\r\n    onmouseout : TJSMouseEventHandler;\r\n    onmouseover : TJSMouseEventHandler;\r\n    onmouseup : TJSMouseEventHandler;\r\n    onmousewheel : TJSMouseEventHandler;\r\n    onpause : TJSEventHandler;\r\n    onplay : TJSEventHandler;\r\n    onplaying : TJSEventHandler;\r\n    onpointercancel : TJSPointerEventHandler;\r\n    onpointerdown : TJSPointerEventHandler;\r\n    onpointerenter : TJSPointerEventHandler;\r\n    onpointerleave : TJSPointerEventHandler;\r\n    onpointermove : TJSPointerEventHandler;\r\n    onpointerout : TJSPointerEventHandler;\r\n    onpointerover : TJSPointerEventHandler;\r\n    onpointerup : TJSPointerEventHandler;\r\n    onpointerlockchange : TJSPointerEventHandler;\r\n    onprogress : TJSProgressEventhandler;\r\n    onreset : TJSUIEventHandler;\r\n    onratechange : TJSEventHandler;\r\n    onscroll : TJSUIEventHandler;\r\n    onseekend : TJSEventHandler;\r\n    onseeking : TJSEventHandler;\r\n    onselect : TJSEventHandler;\r\n    onselectionchange : TJSEventHandler;\r\n    onsshow : TJSEventHandler;\r\n    onsubmit : TJSEventHandler;\r\n    onunload : TJSUIEventHandler;\r\n    onwaiting : TJSEventHandler;\r\n    touchstart : TJSTouchEventHandler;\r\n    touchend : TJSTouchEventHandler;\r\n    touchmove : TJSTouchEventHandler;\r\n    touchcancel : TJSTouchEventHandler;\r\n    Property activeElement : TJSElement Read FActiveElement;\r\n    Property characterSet : String Read FCharacterSet;\r\n    property childElementCount : NativeInt Read FChildElementCount;\r\n    property compatMode : String Read FCompatMode;\r\n    property currentScript : TJSElement Read FCurrentScript;\r\n    property defaultView : TJSWindow Read FDefaultView;\r\n    property doctype : TJSDocumentType read FDocType;\r\n    property documentElement : TJSElement read FDocumentElement;\r\n    property documentURI : String Read FDocumentURI;\r\n    property embeds : TJSHTMLCollection Read FEmbeds;\r\n    property firstElementChild : TJSElement Read FFirstElementChild;\r\n    property lastElementChild : TJSElement Read FLastElementChild;\r\n    property Forms : TJSHTMLCollection Read FForms;\r\n    property fullscreenElement : TJSElement Read FFullScreenElement;\r\n    property fullscreenEnabled : Boolean Read FFullscreenEnabled;\r\n    property head : TJSElement read FHead;\r\n    Property hidden : Boolean read FHidden;\r\n    property images : TJSHTMLCollection Read FImages;\r\n    property _implementation : TJSDOMImplementation Read FImplementation;\r\n    property lastModified : String Read FLastModified;\r\n    property lastStyleSheetSet : String read FLastStyleSheetSet;\r\n    property links : TJSHTMLCollection Read FLinks;\r\n    property location : TJSLocation read FLocation;\r\n    Property LocationString : String Read FURL Write FLocationString; // On purpose\r\n    property plugins : TJSHTMLCollection Read FPlugins;\r\n    property pointerLockElement : TJSElement Read FPointerLockElement;\r\n    property preferredStyleSheetSet : String Read FPreferredStyleSheetSet;\r\n    Property readyState : String Read FReadyState;\r\n    Property referrer : String Read FReferrer;\r\n    property scripts : TJSHTMLCollection Read FScripts;\r\n    property styleSheets : TJSStyleSheetList Read FStyleSheets;\r\n    property styleSheetSets : TJSValueDynArray Read FStyleSheetSets; // No type documented ?\r\n    Property URL : String Read FURL;\r\n    property visibilityState : string read FVisibilityState;\r\n  end;\r\n\r\n  TJSConsole = class external name 'Console'  (TJSObject)\r\n  Public\r\n    procedure assert(anAssertion : string; Obj1 : JSValue); varargs;\r\n    Procedure clear;  \r\n    procedure count; overload;\r\n    procedure count(aCounter : String);\r\n    procedure debug(Obj1 : JSValue); varargs of JSValue;\r\n    procedure error(Obj1 : JSValue); varargs of JSValue;\r\n    procedure group; overload;\r\n    procedure group(aLabel : String); overload;\r\n    procedure groupCollapsed; overload;\r\n    procedure groupCollapsed(aLabel : String);overload;\r\n    procedure groupEnd;\r\n    procedure info(Obj1 : JSValue); varargs of JSValue;\r\n    procedure log(Obj1 : JSValue); varargs of JSValue;\r\n    procedure table(args: array of JSValue); overload;\r\n    procedure table(args: array of JSValue; Columns : Array of string);\r\n    procedure table(args: TJSObject); overload;\r\n    procedure table(args: TJSObject; Columns : Array of string); overload;\r\n    procedure time(aName : string);\r\n    procedure timeEnd(aName : string);\r\n    procedure trace;\r\n    procedure warn(Obj1 : JSValue); varargs of JSValue;\r\n  end;\r\n\r\n//  TJSBufferSource = class external name 'BufferSource' end;\r\n//  TJSTypedArray = class external name 'TypedArray' end;\r\n\r\n  // Forward class definitions\r\n  TJSCryptoKey = Class;\r\n  TJSSubtleCrypto = Class;\r\n  KeyType = String;\r\n  KeyUsage = String;\r\n  NamedCurve = String;\r\n  BigInteger = TJSUint8Array;\r\n  KeyFormat = String;\r\n  // Union of object, DOMString\r\n  AlgorithmIdentifier = JSValue; \r\n  \r\n  { --------------------------------------------------------------------\r\n    Algorithm\r\n    --------------------------------------------------------------------}\r\n  \r\n  Algorithm = record\r\n    name : String;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    AesCbcParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  AesCbcParams = record\r\n    iv : TJSBufferSource;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    AesCtrParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  AesCtrParams = record\r\n    counter : TJSBufferSource;\r\n    length_ : Byte;external name 'length';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    AesGcmParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  AesGcmParams = record\r\n    iv : TJSBufferSource;\r\n    additionalData : TJSBufferSource;\r\n    tagLength : Byte;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    HmacImportParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  HmacImportParams = record\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    Pbkdf2Params\r\n    --------------------------------------------------------------------}\r\n  \r\n  Pbkdf2Params = record\r\n    salt : TJSBufferSource;\r\n    iterations : NativeInt;\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    RsaHashedImportParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  RsaHashedImportParams = record\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    AesKeyGenParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  AesKeyGenParams = record\r\n    length_ : Integer;external name 'length';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    HmacKeyGenParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  HmacKeyGenParams = record\r\n    hash : AlgorithmIdentifier;\r\n    length_ : Integer;external name 'length';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    RsaHashedKeyGenParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  RsaHashedKeyGenParams = record\r\n    modulusLength : Integer;\r\n    publicExponent : BigInteger;\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    RsaOaepParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  RsaOaepParams = record\r\n    label_ : TJSBufferSource;external name 'label';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    RsaPssParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  RsaPssParams = record\r\n    saltLength : Integer;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    DhKeyGenParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  DhKeyGenParams = record\r\n    prime : BigInteger;\r\n    generator : BigInteger;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    EcKeyGenParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  EcKeyGenParams = record\r\n    _namedCurve : NamedCurve;external name 'namedCurve';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    AesDerivedKeyParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  AesDerivedKeyParams = record\r\n    length_ : Integer;external name 'length';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    HmacDerivedKeyParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  HmacDerivedKeyParams = record\r\n    length_ : Integer;external name 'length';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    EcdhKeyDeriveParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  EcdhKeyDeriveParams = record\r\n    public_ : TJSCryptoKey; external name 'public';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    DhKeyDeriveParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  DhKeyDeriveParams = record\r\n    public_ : TJSCryptoKey;  external name 'public';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    DhImportKeyParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  DhImportKeyParams = record\r\n    prime : BigInteger;\r\n    generator : BigInteger;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    EcdsaParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  EcdsaParams = record\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    EcKeyImportParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  EcKeyImportParams = record\r\n    _namedCurve : NamedCurve;external name 'namedCurve';\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    HkdfParams\r\n    --------------------------------------------------------------------}\r\n  \r\n  HkdfParams = record\r\n    hash : AlgorithmIdentifier;\r\n    salt : TJSBufferSource;\r\n    info : TJSBufferSource;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    RsaOtherPrimesInfo\r\n    --------------------------------------------------------------------}\r\n  \r\n  RsaOtherPrimesInfo = record\r\n    r : String;\r\n    d : String;\r\n    t : String;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    JsonWebKey\r\n    --------------------------------------------------------------------}\r\n  \r\n  TRsaOtherPrimesInfoDynArray = Array of RsaOtherPrimesInfo;\r\n  JsonWebKey = record\r\n    kty : String;\r\n    use : String;\r\n    key_ops : TStringDynArray;\r\n    alg : String;\r\n    ext : boolean;\r\n    crv : String;\r\n    x : String;\r\n    y : String;\r\n    d : String;\r\n    n : String;\r\n    e : String;\r\n    p : String;\r\n    q : String;\r\n    dp : String;\r\n    dq : String;\r\n    qi : String;\r\n    oth : TRsaOtherPrimesInfoDynArray;\r\n    k : String;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    CryptoKeyPair\r\n    --------------------------------------------------------------------}\r\n  \r\n  CryptoKeyPair = record\r\n    publicKey : TJSCryptoKey;\r\n    privateKey : TJSCryptoKey;\r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    TJSCryptoKey\r\n    --------------------------------------------------------------------}\r\n  \r\n  TKeyUsageDynArray = Array of KeyUsage;\r\n  TJSCryptoKey = class external name 'CryptoKey' \r\n  Private\r\n    Ftype_ : KeyType; external name 'type'; \r\n    Fextractable : boolean; external name 'extractable'; \r\n    Falgorithm : TJSObject; external name 'algorithm'; \r\n    Fusages : TKeyUsageDynArray; external name 'usages'; \r\n  Public\r\n    \r\n    Property type_ : KeyType Read Ftype_; \r\n    Property extractable : boolean Read Fextractable; \r\n    Property algorithm : TJSObject Read Falgorithm; \r\n    Property usages : TKeyUsageDynArray Read Fusages; \r\n  end;\r\n  \r\n  { --------------------------------------------------------------------\r\n    TJSSubtleCrypto\r\n    --------------------------------------------------------------------}\r\n  \r\n  TJSSubtleCrypto = class external name 'SubtleCrypto' \r\n  Private\r\n  Public\r\n    function encrypt(algorithm : AlgorithmIdentifier; key : TJSCryptoKey; data : TJSBufferSource): TJSPromise;\r\n    function decrypt(algorithm : AlgorithmIdentifier; key : TJSCryptoKey; data : TJSBufferSource): TJSPromise;\r\n    function sign(algorithm : AlgorithmIdentifier; key : TJSCryptoKey; data : TJSBufferSource): TJSPromise;\r\n    function verify(algorithm : AlgorithmIdentifier; key : TJSCryptoKey; signature : TJSBufferSource; data : TJSBufferSource): TJSPromise;\r\n    function digest(algorithm : AlgorithmIdentifier; data : TJSBufferSource): TJSPromise;\r\n    function generateKey(algorithm : AlgorithmIdentifier; extractable : boolean; keyUsages : TKeyUsageDynArray): TJSPromise;\r\n    function deriveKey(algorithm : AlgorithmIdentifier; baseKey : TJSCryptoKey; derivedKeyType : AlgorithmIdentifier; extractable : boolean; keyUsages : TKeyUsageDynArray): TJSPromise;\r\n    function deriveBits(algorithm : AlgorithmIdentifier; baseKey : TJSCryptoKey; length_ : NativeInt): TJSPromise;\r\n    function importKey(format : KeyFormat; keyData : TJSObject; algorithm : AlgorithmIdentifier; extractable : boolean; keyUsages : TKeyUsageDynArray): TJSPromise;\r\n    function exportKey(format : KeyFormat; key : TJSCryptoKey): TJSPromise;\r\n    function wrapKey(format : KeyFormat; key : TJSCryptoKey; wrappingKey : TJSCryptoKey; wrapAlgorithm : AlgorithmIdentifier): TJSPromise;\r\n    function unwrapKey(format : KeyFormat; wrappedKey : TJSBufferSource; unwrappingKey : TJSCryptoKey; unwrapAlgorithm : AlgorithmIdentifier; unwrappedKeyAlgorithm : AlgorithmIdentifier; extractable : boolean; keyUsages : TKeyUsageDynArray): TJSPromise;\r\n  end;\r\n  { TJSCrypto }\r\n\r\n  TJSCrypto = class external name 'Crypto'  (TJSObject)\r\n  private\r\n    Fsubtle: TJSSubtleCrypto; external name 'subtle';\r\n  Public\r\n    procedure getRandomValues (anArray : TJSTypedArray);\r\n    property subtle : TJSSubtleCrypto Read Fsubtle;\r\n  end;\r\n  \r\n  { TJSHistory }\r\n\r\n  TJSHistory = class external name 'History'  (TJSObject)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n{$IFDEF FIREFOX}\r\n    FState : JSValue; external name 'state';\r\n{$ENDIF}\r\n  Public\r\n    procedure back;\r\n    procedure forward;\r\n    procedure go(aIndex : NativeInt);\r\n    procedure go;\r\n    procedure pushState(aState : jsValue; aTitle : String; AURL : String);\r\n    procedure pushState(aState : jsValue; aTitle : String);\r\n    procedure replaceState(aState : jsValue; aTitle : String; AURL : String);\r\n    procedure replaceState(aState : jsValue; aTitle : String);\r\n    procedure replaceState(aState : jsValue);\r\n{$IFDEF FIREFOX}\r\n    property state : JSValue read FState;\r\n{$ENDIF}\r\n    property length: NativeInt read FLength;\r\n  end;\r\n\r\n  TJSIDBTransactionMode = class\r\n  const\r\n    readonly = 'readonly';\r\n    readwrite = 'readwrite';\r\n    versionchange = 'versionchange';\r\n  end;\r\n\r\n\r\n  { TJSIDBTransaction }\r\n\r\n  TJSIDBTransaction = class external name 'IDBTransaction'  (TJSEventTarget)\r\n  private\r\n    FDB : TIDBDatabase; external name 'db';\r\n    FError: JSValue; external name 'error';\r\n    FMode: String; external name 'mode';\r\n    FObjectStoreNames: TStringDynArray; external name 'objectStoreNames';\r\n  public\r\n    procedure abort;\r\n    function objectStore(aName : String) : TJSIDBObjectStore;\r\n    property db : TIDBDatabase read FDB;\r\n    property mode : String read FMode;\r\n    property objectStoreNames : TStringDynArray read FObjectStoreNames;\r\n    property error : JSValue read FError;\r\n  end;\r\n\r\n\r\n  { TJSIDBKeyRange }\r\n\r\n  TJSIDBKeyRange = class external name 'IDBKeyRange'  (TJSObject)\r\n  private\r\n    FLower: JSValue;\r\n    FLowerOpen: Boolean;\r\n    FUpper: JSValue;\r\n    FUpperOpen: Boolean;\r\n  Public\r\n    Class Function bound(aLower,aUpper : JSValue) : TJSIDBKeyRange; overload;\r\n    Class Function bound(aLower,aUpper : JSValue; aLowerOpen : Boolean) : TJSIDBKeyRange; overload;\r\n    Class Function bound(aLower,aUpper : JSValue; aLowerOpen,aUpperOpen : Boolean) : TJSIDBKeyRange; overload;\r\n    Class Function lowerBound(aLower : JSValue) : TJSIDBKeyRange; overload;\r\n    Class Function lowerBound(aLower : JSValue; aOpen: Boolean) : TJSIDBKeyRange; overload;\r\n    Class Function only(aValue : JSValue) : TJSIDBKeyRange;\r\n    Class Function upperBound(aUpper : JSValue) : TJSIDBKeyRange; overload;\r\n    Class Function upperBound(aUpper : JSValue; aOpen: Boolean) : TJSIDBKeyRange; overload;\r\n    function includes (aValue : JSValue) : Boolean;\r\n    property lower : JSValue read FLower;\r\n    property lowerOpen : Boolean read FLowerOpen;\r\n    property upper : JSValue read FUpper;\r\n    property upperOpen : Boolean read FUpperOpen;\r\n  end;\r\n\r\n  TJSIDBIndexParameters = record\r\n    unique : boolean;\r\n    multiEntry : boolean;\r\n    locale : string;\r\n  end;\r\n\r\n\r\n  { TJSIDBIndex }\r\n\r\n  TJSIDBIndex = class external name 'IDBIndex'  (TJSObject)\r\n  private\r\n    FKeyPath: JSValue; external name 'keyPath';\r\n    FMultiEntry: Boolean; external name 'multiEntry';\r\n    FObjectStore: TJSIDBObjectStore; external name 'objectStore';\r\n    FUnique: boolean; external name 'unique';\r\n  public\r\n    name : string;\r\n    function count : TJSIDBRequest;\r\n    function get(aKey : jsValue) : TJSIDBRequest; overload;\r\n    function get(aKey : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll(aKey : jsValue) : TJSIDBRequest; overload;\r\n    function getAll(aKey : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll(aKey : jsValue; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getAll(aKey : TJSIDBKeyRange; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : jsValue) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : jsValue; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : TJSIDBKeyRange; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getKey(aKey : jsValue) : TJSIDBRequest;\r\n    function openCursor : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange; ADirection : String) : TJSIDBRequest;overload;\r\n    function openKeyCursor : TJSIDBRequest;overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest;overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange; ADirection : String) : TJSIDBRequest;overload;\r\n    Property keyPath : JSValue Read FKeyPath;\r\n    property multiEntry : Boolean read FMultiEntry;\r\n    property objectStore : TJSIDBObjectStore read FObjectStore;\r\n    property unique : boolean read FUnique;\r\n  end;\r\n\r\n  TJSIDBCursorDirection = class external name 'IDBCursorDirection'  (TJSObject)\r\n  Const\r\n    next = 'next';\r\n    nextUnique = 'nextUnique';\r\n    prev = 'prev';\r\n    prevUnique = 'prevUnique';\r\n  end;\r\n\r\n\r\n  { TJSIDBCursor }\r\n\r\n  TJSIDBCursor = class external name 'IDBCursor'  (TJSObject)\r\n  private\r\n    FDirection: string; external name 'direction';\r\n    FKey: JSValue; external name 'key';\r\n    FValue : JSValue; external name 'value';\r\n    FPrimaryKey: JSValue; external name 'primaryKey';\r\n    FSource: JSValue; external name 'source';\r\n    FSourceAsIndex: TJSIDBIndex; external name 'source';\r\n    FSourceAsStore: TJSIDBObjectStore; external name 'source';\r\n  Public\r\n    procedure advance(aCount : NativeInt); overload;\r\n    procedure advance(aKey : JSValue); overload;\r\n    procedure continue(aKey : JSValue); overload;\r\n    procedure continue; overload;\r\n    procedure continuePrimaryKey(aKey : JSValue); overload;\r\n    procedure continuePrimaryKey(aKey,aPrimaryKey : JSValue); overload;\r\n    procedure delete;\r\n    procedure update(aValue : JSValue);\r\n    property source : JSValue read FSource;\r\n    property sourceAsStore : TJSIDBObjectStore read FSourceAsStore;\r\n    property sourceAsIndex : TJSIDBIndex read FSourceAsIndex;\r\n    property key : JSValue read FKey;\r\n    Property Value : JSValue Read FValue;\r\n    property primaryKey : JSValue read FPrimaryKey;\r\n    property direction : string read FDirection;\r\n  end;\r\n\r\n  TJSIDBObjectStore = class external name 'IDBObjectStore'  (TJSEventTarget)\r\n  public\r\n    function add(aValue : JSValue; aKey : String) : TJSIDBRequest;\r\n    function add(aValue : JSValue) : TJSIDBRequest;\r\n    function clear : TJSIDBRequest;\r\n    function delete(aKey : string) : TJSIDBRequest;\r\n    function delete(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest;\r\n    function get(aKey : string) : TJSIDBRequest; overload;\r\n    function get(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getKey(aKey : string) : TJSIDBRequest; overload;\r\n    function getKey(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll : TJSIDBRequest; overload;\r\n    function getAll(aKey : String) : TJSIDBRequest; overload;\r\n    function getAll(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll(aKey : String; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function getAll(aKeyRange : TJSIDBKeyRange; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : String) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : String; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKeyRange : TJSIDBKeyRange; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function createIndex (aIndexName : String; KeyPath : String)  : TJSIDBIndex; overload;\r\n    function createIndex (aIndexName : String; KeyPath : String; Options : TJSIDBIndexParameters)  : TJSIDBIndex; overload;\r\n    function createIndex (aIndexName : String; KeyPath : Array of String)  : TJSIDBIndex; overload;\r\n    function createIndex (aIndexName : String; KeyPath : Array of String; Options : TJSIDBIndexParameters)  : TJSIDBIndex; overload;\r\n    Procedure deleteIndex (aIndexName : String);\r\n    function index (aIndexName : String)  : TJSIDBIndex;\r\n    function put(aValue : JSValue; aKey : String) : TJSIDBRequest; overload;\r\n    function put(aValue : JSValue) : TJSIDBRequest; overload;\r\n    function openCursor : TJSIDBRequest; overload;\r\n    function openCursor(aKey : String) : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function openCursor(aKey : String; aDirection : string) : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange; aDirection : string) : TJSIDBRequest; overload;\r\n    function openKeyCursor : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKey : String) : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKey : String; aDirection : string) : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange; aDirection : string) : TJSIDBRequest; overload;\r\n    function count : TJSIDBRequest; overload;\r\n    function count(aKey : String) : TJSIDBRequest; overload;\r\n    function count(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    property Indexes [aIndexName : String] : TJSIDBIndex read index;\r\n  end;\r\n\r\n  { TJSIDBRequest }\r\n\r\n  TJSIDBRequest = class external name 'IDBRequest'  (TJSEventTarget)\r\n  private\r\n    Ferror : JSValue; external name 'error'; // standards are not quite clear on this one\r\n    FReadyState: string; external name 'readyState';\r\n    FResult: JSValue; external name 'result';\r\n    FResultDatabase: TIDBDatabase; external name 'result';\r\n    FResultIndex: TJSIDBIndex; external name 'result';\r\n    FResultObjectStore : TJSIDBObjectStore; external name 'result';\r\n    FResultCursor : TJSIDBCursor; external name 'result';\r\n    FSourceDatabase: TIDBDatabase; external name 'source';\r\n    FSourceIndex: TJSIDBIndex; external name 'source';\r\n    FSourceObjectStore : TJSIDBObjectStore; external name 'source';\r\n    FSourceCursor : TJSIDBCursor; external name 'source';\r\n    FSource: JSValue; external name 'source';\r\n    FTransaction: TJSIDBTransaction; external name 'transaction';\r\n  Public\r\n    onerror : TJSEventHandler;\r\n    onsuccess : TJSEventHandler;\r\n    Property error : JSValue read FError;\r\n    property readyState : string read FReadyState;\r\n\r\n    property result : JSValue read FResult;\r\n    property resultAsObjectStore : TJSIDBObjectStore read FResultObjectStore;\r\n    property resultAsCursor : TJSIDBCursor read FResultCursor;\r\n    property resultAsIndex : TJSIDBIndex read FResultIndex;\r\n    property resultAsDatabase : TIDBDatabase read FResultDatabase;\r\n\r\n    property source : JSValue read FSource;\r\n    property sourceAsObjectStore : TJSIDBObjectStore read FSourceObjectStore;\r\n    property sourceAsCursor : TJSIDBCursor read FSourceCursor;\r\n    property sourceAsIndex : TJSIDBIndex read FSourceIndex;\r\n    property sourceAsDatabase : TIDBDatabase read FSourceDatabase;\r\n\r\n    property transaction : TJSIDBTransaction read FTransaction;\r\n  end;\r\n\r\n  TJSIDBOpenDBRequest = class external name 'IDBOpenDBRequest' (TJSIDBRequest)\r\n  Public\r\n    onblocked : TJSEventHandler;\r\n    onupgradeneeded : TJSEventHandler;\r\n  end;\r\n\r\n  TJSCreateObjectStoreOptions = record\r\n    keyPath : jsValue;\r\n    autoIncrement : boolean;\r\n  end;\r\n\r\n  { TIDBDatabase }\r\n\r\n  TIDBDatabase = class external name 'IDBDatabase' (TJSEventTarget)\r\n  private\r\n    FName: string; external name 'name';\r\n    FobjectStoreNames: TStringDynArray; external name 'objectStoreNames';\r\n    FVersion: integer; external name 'version';\r\n  public\r\n    procedure close;\r\n    function createObjectStore(aName : string) : TJSIDBObjectStore; overload;\r\n    function createObjectStore(aName : string; Options: TJSCreateObjectStoreOptions) : TJSIDBObjectStore; overload;\r\n    procedure deleteObjectStore(aName : string);\r\n    function transaction(aStoreNames : array of string) : TJSIDBTransaction; overload;\r\n    function transaction(aStoreNames : array of string; aMode : string) : TJSIDBTransaction; overload;\r\n    property name : string read FName;\r\n    property version : integer read FVersion;\r\n    property objectStoreNames : TStringDynArray read FobjectStoreNames;\r\n  end;\r\n\r\n  TJSIDBFactory = class external name 'IDBFactory' (TJSEventTarget)\r\n  public\r\n    function open(aName : string) : TJSIDBOpenDBRequest;\r\n    function open(aName : string; aVersion : Integer) : TJSIDBOpenDBRequest;\r\n    function deleteDatabase(aName : string) : TJSIDBOpenDBRequest;\r\n    function cmp (a,b : jsValue) : NativeInt;\r\n  end;\r\n  \r\n  { TJSStorage }\r\n\r\n  TJSStorage = class external name 'Storage' (TJSEventTarget)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n  public\r\n    function key(aIndex : Integer) : String;\r\n    function getItem(aKeyName : string) : string;\r\n    procedure setItem(aKeyName : string; aValue : string);\r\n    procedure removeItem(aKeyName : string);\r\n    procedure clear;\r\n    property Keys[AIndex : Integer] : String read key;\r\n    property Items[aKeyName: String] : String read getItem write setItem; default;\r\n    property length : NativeInt Read FLength;\r\n  end;\r\n\r\n  // Fake object, used for objects whose visible can be checked\r\n  TJSVisibleItem = class external name 'IVisible'  (TJSObject)\r\n  Private\r\n    FVisible : boolean; external name 'visible';\r\n  Public\r\n    Property visible : boolean read FVisible;\r\n  end;\r\n  \r\n  TJSLocationBar = class external name 'LocationBar' (TJSVisibleItem);\r\n  TJSMenuBar = class external name 'MenuBar' (TJSVisibleItem);\r\n  TJSToolBar = class external name 'ToolBar' (TJSVisibleItem);\r\n  TJSPersonalBar = class external name 'PersonalBar' (TJSVisibleItem);\r\n  TJSScrollBars = class external name 'ScrollBars' (TJSVisibleItem);\r\n\r\n  TJSPositionError = record\r\n    code : integer;\r\n    message : string;\r\n  end;\r\n\r\n  TJSPositionOptions = record\r\n    enableHighAccuracy : boolean;\r\n    timeout : integer;\r\n    maximumAge : integer;\r\n  end;\r\n\r\n  TJSCoordinates = record\r\n    latitude : double;\r\n    longitude : double;\r\n    altitude : double;\r\n    accuracy : double;\r\n    altitudeAccuracy : double;\r\n    heading : double;\r\n    speed : double;\r\n  end;\r\n\r\n  TJSPosition = record\r\n    coords : TJSCoordinates;\r\n    timestamp : String;\r\n  end;\r\n\r\n  TJSGeoLocationCallback = procedure (aPosition : TJSPosition);\r\n  TJSGeoLocationEvent = procedure (aPosition : TJSPosition) of object;\r\n  TJSGeoLocationErrorCallback = procedure (aValue : TJSPositionError);\r\n  TJSGeoLocationErrorEvent = procedure (aValue : TJSPositionError) of object;\r\n\r\n  TJSGeoLocation  = class external name 'GeoLocation'  (TJSObject)\r\n  Public\r\n    Procedure getCurrentPosition(ASuccess : TJSGeoLocationCallback); overload;\r\n    Procedure getCurrentPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback); overload;\r\n    Procedure getCurrentPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback; AOptions : TJSPositionOptions); overload;\r\n    Function watchPosition(ASuccess : TJSGeoLocationCallback) : NativeInt; overload;\r\n    Function watchPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback) : NativeInt; overload;\r\n    Function watchPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback; AOptions : TJSPositionOptions) : NativeInt; overload;\r\n    procedure clearWatch(AID : NativeInt);\r\n  end;\r\n\r\n  TJSMediaStreamTrack = class external name 'MediaStreamTrack' (TJSEventTarget)\r\n  end;\r\n\r\n  TJSMediaDevices = class external name 'MediaDevices' (TJSEventTarget)\r\n  end;\r\n\r\n  TJSWorker = class external name 'Worker' (TJSEventTarget)\r\n  public\r\n    constructor new(aURL : string);\r\n    procedure postMessage(aValue : JSValue);\r\n    procedure postMessage(aValue : JSValue; aList : TJSValueDynArray);\r\n  end;\r\n\r\n  TJSMessagePort = class external name 'MessagePort' (TJSEventTarget)\r\n  Public\r\n    procedure close;\r\n    procedure postMessage(aValue : JSValue);\r\n    procedure postMessage(aValue : JSValue; aList : TJSValueDynArray);\r\n    procedure start;\r\n  end;\r\n  TJSMessagePortDynArray = Array of TJSMessagePort;\r\n\r\n  { TJSSharedWorker }\r\n\r\n  TJSSharedWorker = class external name 'SharedWorker' (TJSEventTarget)\r\n  private\r\n    FPort: TJSMessagePort; external name 'port';\r\n  Public\r\n    constructor new(aURL : String); overload;\r\n    constructor new(aURL : String; aName : string); overload;\r\n    property port : TJSMessagePort Read FPort;\r\n  end;\r\n\r\n  TJSExtendableEvent = class external name 'ExtendableEvent' (TJSEvent)\r\n    Procedure waitUntil(aPromise : TJSPromise);\r\n  end;\r\n\r\n  { TJSExtendableMessageEvent }\r\n\r\n  TJSExtendableMessageEvent = class external name 'ExtendableMessageEvent' (TJSExtendableEvent)\r\n  private\r\n    FData: JSValue; external name 'data';\r\n    FLastEventID: String; external name 'lastEventId';\r\n    FOrigin: String; external name 'origin';\r\n    FPorts: TJSMessagePortDynArray; external name 'ports';\r\n    FSource: TJSObject; external name 'source';\r\n    FSourceClient: TJSClient; external name 'source';\r\n    FSourcePort: TJSMessagePort; external name 'source';\r\n    FSourceServiceWorker: TJSServiceWorker; external name 'source';\r\n  Public\r\n    Property Data : JSValue Read FData;\r\n    Property LastEventID : String Read FLastEventID;\r\n    Property Origin : String Read FOrigin;\r\n    Property Ports : TJSMessagePortDynArray Read FPorts;\r\n    Property Source : TJSObject Read FSource;\r\n    // Possible types for Source\r\n    Property SourceServiceWorker : TJSServiceWorker Read FSourceServiceWorker;\r\n    Property SourcePort : TJSMessagePort Read FSourcePort;\r\n    Property SourceClient : TJSClient Read FSourceClient;\r\n  end;\r\n\r\n  { TJSFetchEvent }\r\n\r\n  TJSFetchEvent = class external name 'FetchEvent' (TJSExtendableEvent)\r\n  private\r\n    FClientID: String; external name 'clientId';\r\n    FReplacesClientID: String; external name 'replacesClientId';\r\n    FRequest: TJSRequest; external name 'request';\r\n    FResultingClientID: String; external name 'resultingClientId';\r\n    FPreloadResponse: TJSPromise; external name 'preloadResponse';\r\n  Public\r\n    Procedure respondWith(aPromise : TJSPromise);\r\n    Procedure respondWith(aResponse : TJSResponse);\r\n    Property ClientId : String Read FClientID;\r\n    Property PreloadResponse : TJSPromise Read FPreloadResponse;\r\n    Property ReplacesClientID : String Read FReplacesClientID;\r\n    Property ResultingClientID : String Read FResultingClientID;\r\n    Property request : TJSRequest Read FRequest;\r\n  end;\r\n\r\n  { TJSClient }\r\n\r\n  TJSClient = class external name 'Client' (TJSObject)\r\n  private\r\n    FFrameType: String; external name 'frameType';\r\n    FID: String; external name 'id';\r\n    FType: String; external name 'type';\r\n    FURL: String; external name 'url';\r\n  Public\r\n    procedure postMessage(aValue : JSValue);\r\n    procedure postMessage(aValue : JSValue; aList : TJSValueDynArray);\r\n    Property Id : String Read FID;\r\n    Property Type_ : String Read FType;\r\n    Property FrameType : String Read FFrameType;\r\n    Property URL : String Read FURL;\r\n  end;\r\n\r\n  { TJSServiceWorker }\r\n\r\n  TJSServiceWorker = class external name 'ServiceWorker' (TJSWorker)\r\n  private\r\n    FRegistration: TJSServiceWorkerRegistration; external name 'registration';\r\n    FScriptURL: String;  external name 'scriptURL';\r\n    FState: string;  external name 'state';\r\n  Public\r\n    property State : string read FState;\r\n    property ScriptURL : String Read FscriptURL;\r\n    property Registration: TJSServiceWorkerRegistration read FRegistration;\r\n  end;\r\n\r\n  { TJSNavigationPreloadState }\r\n\r\n  TJSNavigationPreloadState = class external name 'navigationPreloadState'\r\n  public\r\n    enabled: boolean;\r\n    headerValue: string;\r\n  end;\r\n\r\n  { TJSNavigationPreload }\r\n\r\n  TJSNavigationPreload = class external name 'navigationPreload' (TJSObject)\r\n  public\r\n    function enable: boolean; async;\r\n    function disable: boolean; async;\r\n    function setHeaderValue(Value: string): TJSPromise;\r\n    function getState: TJSNavigationPreloadState; async;\r\n  end;\r\n\r\n  { TJSServiceWorkerRegistration }\r\n\r\n  TJSServiceWorkerRegistration = class external name 'ServiceWorkerRegistration'  (TJSObject)\r\n  private\r\n    FActive: TJSServiceWorker; external name 'active';\r\n    FInstalling: TJSServiceWorker; external name 'installing';\r\n    FScope: string; external name 'scope';\r\n    FWaiting: TJSServiceWorker; external name 'waiting';\r\n    FNavigationPreload: TJSNavigationPreload; external name 'navigationPreload';\r\n  public\r\n    function unregister : TJSPromise;\r\n    procedure update;\r\n    property Active : TJSServiceWorker read FActive;\r\n    property Scope : string read FScope;\r\n    property Waiting : TJSServiceWorker read FWaiting;\r\n    property Installing : TJSServiceWorker read FInstalling;\r\n    property NavigationPreload: TJSNavigationPreload read FNavigationPreload;\r\n  end;\r\n\r\n  TJSServiceWorkerContainerOptions = record\r\n    scope : string;\r\n  end;\r\n\r\n  { TJSServiceWorkerContainer }\r\n\r\n  TJSServiceWorkerContainer = class external name 'ServiceWorkerContainer'  (TJSObject)\r\n  private\r\n    FController: TJSServiceWorker; external name 'controller';\r\n    FReady: TJSPromise; external name 'ready';\r\n  Public\r\n    function register(aURL : String) : TJSPromise; overload;\r\n    function register(aURL : String; aOptions : TJSServiceWorkerContainerOptions) : TJSPromise; overload;\r\n    function getRegistration(aURL : String) : TJSPromise; overload;\r\n    function getRegistration : TJSPromise; overload;\r\n    function getRegistrations : TJSPromise;\r\n    property controller : TJSServiceWorker read FController;\r\n    property ready : TJSPromise read FReady;\r\n  end;\r\n\r\n  TJSClipboardItemOptions = Class external name 'Object' (TJSObject)\r\n    presentationStyle : String;\r\n  end;\r\n\r\n  TJSClipBoardItem = Class external name 'ClipboardItem' (TJSObject)\r\n    constructor new(aData : TJSObject; aOptions : TJSOBject); overload;\r\n    constructor new(aData : TJSObject; aOptions : TJSClipboardItemOptions); overload;\r\n    constructor new(aData : TJSObject); overload;\r\n  end;\r\n\r\n  TJSClipBoard = class external name 'Clipboard' (TJSEventTarget)\r\n    Function read : TJSPromise;\r\n    Function readText : TJSPromise;\r\n    Function write(Data : Array of TJSClipBoardItem) : TJSPromise;\r\n    Function writeText(aText : String) : TJSPromise;\r\n  end;\r\n\r\n  { TJSNavigator }\r\n\r\n  TJSNavigator = class external name 'Navigator'  (TJSObject)\r\n{$IFDEF FIREFOX}\r\n    FbuildID : String ; external name 'buildID';\r\n    FOSCPU : String ; external name 'oscpu';\r\n    FproductSub : string; external name 'productSub';\r\n    FVendor : string; external name 'vendor';\r\n{$ENDIF}\r\n  private\r\n    FCookieEnabled: Boolean; external name 'cookieEnabled';\r\n    FGeoLocation: TJSGeoLocation; external name 'geolocation';\r\n    FLanguage: String; external name 'language';\r\n    FMaxTouchPoints: NativeInt; external name 'maxTouchPoints';\r\n    FMediaDevices: TJSMediaDevices; external name 'mediaDevices';\r\n    FOnline: boolean; external name 'onLine';\r\n    FPlatform: string; external name 'platform';\r\n    FServiceWorker: TJSServiceWorkerContainer; external name 'serviceWorker';\r\n    FUserAgent: string; external name 'userAgent';\r\n    fClipBoard : TJSClipBoard; external name 'clipboard';\r\n    FPermissions: TJSPermissions; external name 'permissions';\r\n  public\r\n    function getBattery : TJSPromise;\r\n    function requestMediaKeySystemAccess(aKeySystem : String; supportedConfigurations : TJSValueDynArray) : TJSPromise;\r\n    Procedure registerContentHandler(aMimeType,aURI,aTitle : string);\r\n    Procedure registerProtocolHandler(aProtocol,aURI,aTitle : string);\r\n    Procedure vibrate(aPattern : NativeInt);\r\n    Procedure vibrate(aPattern : Array of NativeInt);\r\n{$IFDEF FIREFOX}\r\n    property buildID : String read FBuildID;\r\n    property oscpu : string read FOSCPU;\r\n    property productSub: string read FproductSub;\r\n    property vendor : string read Fvendor;\r\n{$ENDIF}\r\n    property cookieEnabled : Boolean read FCookieEnabled;\r\n    property geoLocation : TJSGeoLocation Read FGeoLocation;\r\n    property language : String read FLanguage;\r\n    property maxTouchPoints : NativeInt read FMaxTouchPoints;\r\n    property mediaDevices : TJSMediaDevices read FMediaDevices;\r\n    property onLine : boolean read FOnline;\r\n    property platform : string read FPlatform;\r\n    property userAgent : string read FUserAgent;\r\n    property serviceWorker : TJSServiceWorkerContainer read FServiceWorker;\r\n    property ClipBoard : TJSClipBoard Read FCLipboard;\r\n    property permissions: TJSPermissions read FPermissions;\r\n  end;\r\n\r\n  { TJSTouchEvent }\r\n  TTouchCoord = longint;\r\n\r\n  TJSTouch = class external name 'Touch'  (TJSObject)\r\n  private\r\n    FClientX: TTouchCoord; external name 'clientX';\r\n    FClientY: TTouchCoord; external name 'clientY';\r\n    FIDentifier: longint; external name 'identifier';\r\n    FPageX: TTouchCoord; external name 'pageX';\r\n    FPageY: TTouchCoord; external name 'pageY';\r\n    FScreenX: TTouchCoord; external name 'screenX';\r\n    FScreenY: TTouchCoord; external name 'screenY';\r\n    FTarget: TJSElement; external name 'target';\r\n  Public\r\n    Property identifier : longint read FIDentifier;\r\n    Property ScreenX : TTouchCoord Read FScreenX;\r\n    Property ScreenY : TTouchCoord Read FScreenY;\r\n    Property ClientX : TTouchCoord Read FClientX;\r\n    Property ClientY : TTouchCoord Read FClientY;\r\n    Property PageX : TTouchCoord Read FPageX;\r\n    Property PageY : TTouchCoord Read FPageY;\r\n    Property Target : TJSElement Read FTarget;\r\n  end;\r\n\r\n  { TJSTouchList }\r\n\r\n  TJSTouchList = class external name 'TouchList' (TJSObject)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n  Public\r\n    function item (aIndex : Integer) : TJSTouch;\r\n    property length : NativeInt Read FLength;\r\n    Property Touches[AIndex : Integer] : TJSTouch Read item; default;\r\n  end;\r\n\r\n\r\n  TJSPerformance = class external name 'Performance' (TJSObject);\r\n\r\n  TJSScreen = class external name 'Screen' (TJSObject)\r\n  private\r\n    FavailHeight: Integer; external name 'availHeight';\r\n    FavailWidth: Integer; external name 'availWidth';\r\n    FcolorDepth: Integer; external name 'colorDepth';\r\n    FPixelDepth: Integer; external name 'pixelDepth';\r\n    Fheight: Integer; external name 'height';\r\n    Fwidth: Integer; external name 'width';\r\n  public\r\n  { Properties declarations }\r\n    property availHeight: Integer read FavailHeight;\r\n    property availWidth: Integer read FavailWidth;\r\n    property colorDepth: Integer read FcolorDepth;\r\n    property pixelDepth: Integer read FPixelDepth;\r\n    property height: Integer read Fheight;\r\n    property width: Integer read Fwidth;\r\n  end;\r\n\r\n\r\n  TJSParamEnumCallBack = reference to procedure (const aKey,aValue : string);\r\n  TJSURLSearchParams = class external name 'URLSearchParams' (TJSObject)\r\n  Public\r\n    constructor new(aQuery : String);\r\n    Procedure append(const aName,aValue : string);\r\n    Procedure delete(const aName : string);\r\n    Function entries : TJSIterator;\r\n    Procedure foreach(aEnumCallBack : TJSParamEnumCallBack);\r\n    function get(const aName : string) : JSValue;\r\n    // If you're sure the value exists...\r\n    function getString(const aName : string) : string; external name 'get';\r\n    function getAll(const aName : string) : TStringDynArray;\r\n    function has(const aName : string) : Boolean;\r\n    Function keys : TJSIterator; reintroduce;\r\n    Procedure set_(const aName,aValue : string); external name 'set';\r\n    Procedure sort;\r\n    Function values : TJSIterator; reintroduce;\r\n  end;\r\n\r\n  TJSURL = class external name 'URL' (TJSObject)\r\n  Private\r\n    FOrigin : String; external name 'origin';\r\n    FSearchParams : TJSURLSearchParams; external name 'searchParams';\r\n  public\r\n    hash : string;\r\n    host : string;\r\n    hostname : string;\r\n    href : string;\r\n    password : string;\r\n    pathname : string;\r\n    port : string;\r\n    protocol : string;\r\n    search : string;\r\n    username : string;\r\n    constructor new(aURL : String);\r\n    constructor new(aURL,aBase : String);\r\n    class function createObjectURL(const v: JSValue): string;\r\n    class function revokeObjectURL(const S : String): string;\r\n    function toJSON : String;\r\n    Property Origin : String Read FOrigin;\r\n    property SearchParams : TJSURLSearchParams read FSearchParams;\r\n  end;\r\n  TJSURLDynArray = array of TJSURL;\r\n\r\n  TJSTimerCallBack = reference to procedure; safecall;\r\n  Theader = Array [0..1] of String;\r\n  THeaderArray = Array of Theader;\r\n\r\n  TJSHTMLHeaders = Class external name 'Headers' (TJSObject)\r\n  Public\r\n    constructor new(values : THeaderArray); overload;\r\n    procedure append(aName, aValue : String);\r\n    procedure delete(aName : String);\r\n    function entries : TJSIterator;\r\n    Function get(aName: String): string;\r\n    Function has(aName: String): Boolean;\r\n    function keys : TJSIterator; reintroduce;\r\n    function values : TJSIterator; reintroduce;\r\n    procedure set_(aName, aValue : String);\r\n    Property Headers[aName : string] : string Read Get Write Set_;\r\n  end;\r\n\r\n\r\n  { TJSMediaQueryList }\r\n\r\n  TJSMediaQueryList = class external name 'MediaQueryList' (TJSObject)\r\n  private\r\n    FMatches: Boolean; external name 'matches';\r\n    FMedia: String; external name 'media';\r\n  Public\r\n    Property matches : Boolean Read FMatches;\r\n    Property media : String Read FMedia;\r\n  end;\r\n\r\n  TJSReadableStream = class external name 'ReadableStream' (TJSObject)\r\n  private\r\n    flocked: Boolean; external name 'locked';\r\n  public\r\n    property locked: Boolean read flocked;\r\n    constructor new(underlyingSource: TJSObject);\r\n    constructor new(underlyingSource, queueingStrategy: TJSObject);\r\n    function cancel(reason: TJSDOMString): TJSPromise;\r\n    function getReader(): TJSObject; overload;\r\n    function getReader(mode: TJSObject): TJSObject; overload;\r\n    function pipeThrough(transformStream: TJSObject): TJSReadableStream; overload;\r\n    function pipeThrough(transformStream, options: TJSObject): TJSReadableStream; overload;\r\n    function pipeTo(destination: TJSObject): TJSPromise; overload;\r\n    function pipeTo(destination, options: TJSObject): TJSPromise; overload;\r\n    function tee(): TJSArray; // array containing two TJSReadableStream instances\r\n  end;\r\n\r\n  TJSWritableStream = class external name 'WritableStream' (TJSObject)\r\n  private\r\n    FLocked: Boolean; external name 'locked';\r\n  public\r\n    function abort(reason: String): TJSPromise;\r\n    function close: TJSPromise;\r\n    function getWriter: TJSObject;\r\n    property locked: Boolean read FLocked;\r\n  end;\r\n\r\n  TJSBody = class external name 'Body' (TJSObject)\r\n  private\r\n    fbody: TJSReadableStream; external name 'body';\r\n    fbodyUsed: Boolean; external name 'bodyUsed';\r\n  public\r\n    property body: TJSReadableStream read fbody;\r\n    property bodyUsed: Boolean read fbodyUsed;\r\n    function arrayBuffer(): TJSPromise; // resolves to TJSArrayBuffer\r\n    //function blob(): TJSPromise; // resolves to TJSBlob\r\n    function blob: TJSBlob; {$IFNDEF SkipAsync}async;{$ENDIF}\r\n    function json(): TJSPromise; // resolves to JSON / TJSValue\r\n    //function text(): TJSPromise; // resolves to USVString, always decoded using UTF-8\r\n    function text(): string; {$IFNDEF SkipAsync}async;{$ENDIF}\r\n  end;\r\n\r\n  TJSResponse = class external name 'Response' (TJSBody)\r\n  private\r\n    fheaders: TJSObject;external name 'headers';\r\n    fok: Boolean; external name 'ok';\r\n    fredirected: Boolean; external name 'redirected';\r\n    fstatus: NativeInt; external name 'status';\r\n    fstatusText: String; external name 'statusText';\r\n    ftype: String; external name 'type';\r\n    furl: String; external name 'url';\r\n    fuseFinalUrl: Boolean; external name 'useFinalUrl';\r\n  public\r\n    property headers: TJSObject read fheaders; //\r\n    property ok: Boolean read fok;\r\n    property redirected: Boolean read fredirected;\r\n    property status: NativeInt read fstatus;\r\n    property statusText: String read fstatusText; //\r\n    property type_: String read ftype; //\r\n    property url: String read furl; //\r\n    property useFinalUrl: Boolean read fuseFinalUrl write fuseFinalUrl;\r\n    constructor new(body: TJSObject; init: TJSObject); overload; varargs; external name 'new';\r\n    constructor new(Msg: string; init: TJSObject); overload; varargs; external name 'new';\r\n    function clone(): TJSResponse;\r\n    function error(): TJSResponse;\r\n    function redirect(url: String; Status: NativeInt): TJSResponse;\r\n  end;\r\n\r\n  TJSDOMHighResTimeStamp = Double;\r\n  TFrameRequestCallback = reference to procedure (aTime: TJSDOMHighResTimeStamp);\r\n\r\n  TJSPostMessageOptions = class external name 'Object' (TJSObject)\r\n    targetOrigin : string;\r\n    transfer : TJSValueDynArray;\r\n  end;\r\n\r\n  TJSIdleCallbackOptions = class\r\n  public\r\n    timeout: Cardinal;\r\n  end;\r\n\r\n  TJSIdleDeadline = class external name 'IdleDeadline'\r\n  private\r\n    FDidTimeout: Boolean; external name 'didTimeout';\r\n  public\r\n    function timeRemaining: TJSDOMHighResTimeStamp;\r\n\r\n    property didTimeout: Boolean read FDidTimeout;\r\n  end;\r\n\r\n  TJSCacheDeleteOptions = class external name 'Object' (TJSObject)\r\n    ignoreSearch : Boolean;\r\n    ignoreMethod : Boolean;\r\n    ignoreVary : Boolean;\r\n    cacheName : string;\r\n  end;\r\n\r\n  { TJSRequest }\r\n\r\n  TJSRequest = class external name 'Request' (TJSObject)\r\n  private\r\n    FBody: TJSReadableStream; external name 'body';\r\n    FBodyUsed: Boolean; external name 'bodyUsed';\r\n    FCache: String; external name 'cache';\r\n    FCredentials: TJSObject; external name 'credentials';\r\n    FDestination: String; external name 'destination';\r\n    FHeaders: TJSObject; external name 'headers';\r\n    FIntegrity: String; external name 'integrity';\r\n    FMethod: String; external name 'method';\r\n    FMode: String; external name 'mode';\r\n    FReferrer: string; external name 'referrer';\r\n    FReferrerPolicy: string; external name 'referrerPolicy';\r\n    FURL: String;external name 'url';\r\n  Public\r\n    Property body : TJSReadableStream Read FBody;\r\n    property bodyUsed : Boolean Read FBodyUsed;\r\n    Property Cache : String Read FCache;\r\n    Property Credentials : TJSObject Read FCredentials;\r\n    Property Destination : String Read FDestination;\r\n    // TODO : actually Headers object\r\n    Property Headers : TJSObject Read FHeaders;\r\n    Property Integrity : String Read FIntegrity;\r\n    Property Method : String Read FMethod;\r\n    Property Mode : String Read FMode;\r\n    Property Referrer : string Read FReferrer;\r\n    Property ReferrerPolicy : string Read FReferrerPolicy;\r\n    Property URL : String Read FURL;\r\n  end;\r\n  TJSRequestDynArray = array of TJSRequest;\r\n\r\n  TJSCache = class external name 'Cache' (TJSObject)\r\n  Public\r\n    Function add(aRequest : String) : TJSPromise;\r\n    Function add(aRequest : TJSURL) : TJSPromise;\r\n    Function addAll(aRequests : TJSStringDynArray) : TJSPromise;\r\n    Function addAll(aRequests : TJSURLDynArray) : TJSPromise;\r\n    Function addAll(aRequests : TJSValueDynArray) : TJSPromise;\r\n    Function put(aRequest : String; aResponse : TJSResponse) : TJSPromise;\r\n    Function put(aRequest : TJSRequest; aResponse : TJSResponse) : TJSPromise;\r\n    Function delete(aRequest : String) : TJSPromise;\r\n    Function delete(aRequest : TJSRequest) : TJSPromise;\r\n    Function delete(aRequest : String; aOptions : TJSObject) : TJSPromise;\r\n    Function delete(aRequest : TJSRequest; aOptions : TJSObject) : TJSPromise;\r\n    Function delete(aRequest : String; aOptions : TJSCacheDeleteOptions) : TJSPromise;\r\n    Function delete(aRequest : TJSRequest; aOptions : TJSCacheDeleteOptions) : TJSPromise;\r\n    Function keys : TJSPromise; reintroduce;\r\n    Function match(aRequest : String): TJSPromise;\r\n    Function match(aRequest : TJSRequest): TJSPromise;\r\n    Function matchAll(aRequest : TJSStringDynArray): TJSPromise;\r\n    Function matchAll(aRequest : TJSRequestDynArray): TJSPromise;\r\n    Function matchAll(aRequests : TJSValueDynArray) : TJSPromise;\r\n  end;\r\n\r\n  TJSCacheStorage = class external name 'CacheStorage' (TJSObject)\r\n  Public\r\n    function delete(aName : string) : TJSPromise; // resolves to boolean\r\n    function has(aName : string) : TJSPromise;\r\n    Function keys : TJSPromise; reintroduce;\r\n    Function match(aRequest : String): TJSPromise;\r\n    Function match(aRequest : TJSRequest): TJSPromise;\r\n    function open(aName : string) : TJSPromise;\r\n  end;\r\n\r\n  TJSWindowArray = Array of TJSWindow;\r\n  TIdleCallbackProc = reference to procedure(idleDeadline: TJSIdleDeadline);\r\n\r\n  { TJSWindow }\r\n\r\n  TJSWindow = class external name 'Window' (TJSObject)\r\n  Private\r\n    FClosed: boolean; external name 'closed';\r\n    FConsole : TJSConsole;  external name 'console';\r\n    FCrypto: TJSCrypto; external name 'crypto';\r\n    FDevicePixelRatio: Double; external name 'devicePixelRatio';\r\n    FDocument: TJSDocument; external name 'document';\r\n    FFrameElement: TJSElement; external name 'frameElement';\r\n    FFrames: TJSWindowArray; external name 'frames';\r\n    FHistory: TJSHistory; external name 'history';\r\n    FIndexedDB: TJSIDBFactory; external name 'indexedDB';\r\n    FInnerheight: NativeInt; external name 'innerHeight';\r\n    FInnerWidth: NativeInt; external name 'innerWidth';\r\n    FLength: NativeInt; external name 'length';\r\n    FLocalStorage: TJSStorage; external name 'localStorage';\r\n    FLocation: TJSLocation; external name 'location';\r\n    FLocationBar: TJSLocationBar; external name 'locationbar';\r\n    FLocationString: string; external name 'location';\r\n    FMenuBar: TJSMenuBar; external name 'menubar';\r\n    FNavigator: TJSNavigator; external name 'navigator';\r\n    FOpener: TJSWindow; external name 'opener';\r\n    FOuterheight: NativeInt; external name 'outerHeight';\r\n    FOuterWidth: NativeInt; external name 'outerWidth';\r\n    FParent: TJSWindow; external name 'parent';\r\n    FPerformance: TJSPerformance; external name 'Performance';\r\n    FPersonalBar: TJSPersonalBar; external name 'personalbar';\r\n    FScreen: TJSScreen; external name 'screen';\r\n    FScreenX: NativeInt; external name 'screenX';\r\n    FScreenY: NativeInt; external name 'screenY';\r\n    FScrollbar: TJSScrollBars; external name 'scrollbar';\r\n    FScrollX: NativeInt; external name 'scrollX';\r\n    FScrollY: NativeInt; external name 'scrollY';\r\n    FSelf: TJSWindow; external name 'self';\r\n    FSessionStorage: TJSStorage; external name 'sessionStorage';\r\n    FToolBar: TJSToolBar; external name 'toolbar';\r\n    FTop: TJSWindow; external name 'top';\r\n    FURL: TJSURL; external name 'URL';\r\n  Public\r\n    fullSreen : Boolean;   \r\n    name : string;\r\n    status : string;\r\n    onabort : TJSEventHandler;\r\n    onafterprint : TJSEventHandler;\r\n    onbeforeprint : TJSEventHandler;\r\n    onbeforeinstallprompt : TJSEventHandler;\r\n    onbeforeunloadprompt : TJSEventHandler;\r\n    onblur : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onclick: THTMLClickEventHandler;\r\n    onclose : TJSEventHandler;\r\n    oncontextmenu : TJSEventHandler;\r\n    ondblclick : THTMLClickEventHandler;\r\n    onerror : TJSErrorEventHandler;\r\n    onfocus : TJSFocusEventhandler;\r\n    onhashchange : TJSHashChangeEventhandler;\r\n    oninput : TJSEventhandler;\r\n    onkeydown : TJSKeyEventhandler;\r\n    onkeypress : TJSKeyEventhandler;\r\n    onkeyup : TJSKeyEventhandler;\r\n    onlanguagechange : TJSEventhandler;\r\n    onload : TJSEventhandler;\r\n    onloadend : TJSLoadEventhandler;\r\n    onloadstart : TJSLoadEventhandler;\r\n    onmessage : TJSEventHandler;\r\n    onmousedown : TJSMouseEventHandler;\r\n    onmouseenter : TJSMouseEventHandler;\r\n    onmouseleave : TJSMouseEventHandler;\r\n    onmousemove : TJSMouseEventHandler;\r\n    onmouseout : TJSMouseEventHandler;\r\n    onmouseover : TJSMouseEventHandler;\r\n    onmouseup : TJSMouseEventHandler;\r\n    onmousewheel : TJSMouseEventHandler;\r\n    onoffline : TJSEventHandler;\r\n    ononline : TJSEventHandler;\r\n    onpagehide : TJSPageTransitionEventHandler;\r\n    onpageshow : TJSPageTransitionEventHandler;\r\n    onpaint : TJSEventHandler;\r\n    onpointercancel : TJSPointerEventHandler;\r\n    onpointerdown : TJSPointerEventHandler;\r\n    onpointerenter : TJSPointerEventHandler;\r\n    onpointerleave : TJSPointerEventHandler;\r\n    onpointermove : TJSPointerEventHandler;\r\n    onpointerout : TJSPointerEventHandler;\r\n    onpointerover : TJSPointerEventHandler;\r\n    onpointerup : TJSPointerEventHandler;\r\n    onpointerlockchange : TJSPointerEventHandler;\r\n    onprogress : TJSProgressEventhandler;\r\n    onpopstate : TJSPopStateEventHandler;\r\n    onreset : TJSUIEventHandler;\r\n    onresize : TJSUIEventHandler;\r\n    onscroll : TJSUIEventHandler;\r\n    onselect : TJSEventHandler;\r\n    onselectionchange : TJSEventHandler;\r\n    onstorage : TJSStorageEventHandler;\r\n    onsubmit : TJSEventHandler;\r\n    onunload : TJSUIEventHandler;\r\n    touchstart : TJSTouchEventHandler;\r\n    touchend : TJSTouchEventHandler;\r\n    touchmove : TJSTouchEventHandler;\r\n    touchcancel : TJSTouchEventHandler;\r\n    procedure addEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure addEventListener(aname : string; aListener : TJSRawEventHandler);\r\n    procedure addEventListener(aname : string; aListener : JSValue);\r\n    Procedure alert(Const Msg : String);\r\n    Function atob(Const aValue : string) : string;\r\n    procedure blur;\r\n    Procedure clearInterval(aID: NativeInt);\r\n    Procedure clearTimeout(aID: NativeInt);\r\n    Function btoa(Const aValue : string) : string;\r\n    procedure cancelAnimationFrame(aHandle: Integer);\r\n    Procedure close;\r\n    Function confirm(Const aMsg : String) :  boolean;\r\n    function fetch(resource: String; init: TJSObject): TJSPromise; overload; external name 'fetch';\r\n    //function fetch(resource: String): TJSPromise; overload; external name 'fetch';\r\n    function fetch(resource: String): TJSResponse; {$IFNDEF SkipAsync}async;{$ENDIF} overload; external name 'fetch';\r\n    function fetch(resource: TJSObject; init: TJSObject): TJSPromise; overload; external name 'fetch';\r\n    function fetch(resource: TJSObject): TJSPromise; overload; external name 'fetch';\r\n    function asyncfetch(resource: String): TJSResponse; {$IFNDEF SkipAsync}async;{$ENDIF} overload; external name 'fetch';\r\n    function asyncfetch(resource: TJSObject; init: TJSObject): TJSResponse; {$IFNDEF SkipAsync} async;{$ENDIF} overload; external name 'fetch';\r\n    function asyncfetch(resource: TJSObject): TJSResponse;  {$IFNDEF SkipAsync}async;{$ENDIF}  overload;external name 'fetch';\r\n    procedure focus;\r\n    Function getComputedStyle(aElement : TJSElement) : TJSCSSStyleDeclaration; overload;\r\n    Function getComputedStyle(aElement,aPseudoElement : TJSElement) : TJSCSSStyleDeclaration; overload;\r\n    function matchMedia(aQuery : String) : TJSMediaQueryList;\r\n    procedure moveBy(x,y : NativeInt);\r\n    procedure moveTo(x,y : NativeInt);\r\n    function open : TJSWindow;\r\n    function open(Const aURL : String) : TJSWindow; overload;\r\n    function open(Const aURL,aTarget : String) : TJSWindow; overload;\r\n    function open(Const aURL,aTarget : String; AOptions : TJSObject) : TJSWindow; overload;\r\n    procedure postMessage(aMessage : JSValue);\r\n    procedure postMessage(aMessage : JSValue; aOptions : TJSPostMessageOptions);\r\n    procedure postMessage(aMessage : JSValue; aTransfer : TJSValueDynArray);\r\n    procedure postMessage(aMessage : JSValue; aTarget : string);\r\n    procedure postMessage(aMessage : JSValue; aTarget : string; aTransfer : TJSValueDynArray);\r\n    procedure print;\r\n    function prompt(const aMessage : String) : String; overload;\r\n    function prompt(const aMessage,aDefault : String) : String; overload;\r\n    procedure removeEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure removeEventListener(aname : string; aListener : JSValue);\r\n    function requestAnimationFrame(aCallback: TFrameRequestCallback): Integer;\r\n    procedure resizeBy(aWidth,aHeight : NativeInt);\r\n    procedure resizeTo(aWidth,aHeight : NativeInt);\r\n    procedure scrollBy(x,y : NativeInt);\r\n    procedure scrollTo(x,y : NativeInt);\r\n    Function setInterval(ahandler : TJSTimerCallBack; aInterval : NativeUInt) : NativeInt; varargs;\r\n    Function setTimeout(ahandler : TJSTimerCallBack; aTimeout : NativeUInt) : NativeInt; varargs;\r\n    Function setTimeout(ahandler : TJSTimerCallBack) : NativeInt;\r\n    procedure stop;\r\n    procedure cancelIdleCallback(handle: NativeInt);\r\n    function requestIdleCallback(handler: TIdleCallbackProc): NativeInt; overload;\r\n    function requestIdleCallback(handler: TIdleCallbackProc; options: TJSIdleCallbackOptions): NativeInt; overload;\r\n    function showOpenFilePicker: TJSFileSystemFileHandleArray; async; overload;\r\n    function showOpenFilePicker(options: TJSShowOpenFilePickerOptions): TJSFileSystemFileHandleArray; async; overload;\r\n    function showSaveFilePicker: TJSFileSystemFileHandle; async; overload;\r\n    function showSaveFilePicker(options: TJSShowSaveFilePickerOptions): TJSFileSystemFileHandle; async; overload;\r\n    function FileSystemDirectoryHandle: TJSFileSystemDirectoryHandleArray; async;\r\n    { public properties }\r\n    property console : TJSConsole Read FConsole;\r\n    property closed : boolean read FClosed;\r\n    property crypto : TJSCrypto Read FCrypto;\r\n    property devicePixelRatio : Double read FDevicePixelRatio;\r\n    property document : TJSDocument read FDocument;\r\n    property frameElement : TJSElement Read FFrameElement;\r\n    Property frames  : TJSWindowArray read FFrames;\r\n    Property history : TJSHistory read FHistory;\r\n    Property indexedDB : TJSIDBFactory read FIndexedDB;\r\n    Property innerHeight : NativeInt Read FInnerheight;\r\n    Property innerWidth : NativeInt Read FInnerWidth;\r\n    Property length : NativeInt Read FLength;\r\n    Property localStorage : TJSStorage Read FLocalStorage;\r\n    property location : TJSLocation Read FLocation;\r\n    Property locationString : String read FLocationString write FLocationString;\r\n    property locationbar : TJSLocationBar Read FLocationBar;\r\n    property menubar : TJSMenuBar Read FMenuBar;\r\n    property navigator : TJSNavigator Read FNavigator;\r\n    property opener : TJSWindow read FOpener;\r\n    Property outerHeight : NativeInt Read FOuterheight;\r\n    Property outerWidth : NativeInt Read FOuterWidth;\r\n    Property parent : TJSWindow Read FParent;\r\n    Property Performance : TJSPerformance Read FPerformance;\r\n    property personalbar : TJSPersonalBar Read FPersonalBar;\r\n    property screen : TJSScreen read FScreen;\r\n    property screenX : NativeInt read FScreenX;\r\n    Property screenY : NativeInt read FScreenY;\r\n    Property scrollbar : TJSScrollBars Read FScrollbar;\r\n    property scrollX : NativeInt read FScrollX;\r\n    Property scrollY : NativeInt read FScrollY;\r\n    Property _Self : TJSWindow read FSelf;\r\n    Property sessionStorage : TJSStorage Read FSessionStorage;\r\n    property toolbar : TJSToolBar Read FToolBar;\r\n    property top : TJSWindow Read FTop;\r\n    property URL : TJSURL Read FURL;\r\n  end;\r\n\r\n  { TJSCSSStyleDeclaration }\r\n\r\n  TJSCSSStyleDeclaration = class external name 'CSSStyleDeclaration'  (TJSObject)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    FParentRule: TJSCSSRule; external name 'parentRule';\r\n  public\r\n    cssText : string;\r\n    function item(aIndex : Integer) : string;\r\n    function removeProperty(const aProperty : String) : string;\r\n    function getPropertyPriority(const aProperty : String) : string;\r\n    function getPropertyValue(const aProperty : String) : string;\r\n    procedure setProperty(const aProperty,aValue : String);overload;\r\n    procedure setProperty(const aProperty,aValue,aPriority : string); overload;\r\n    property length : NativeInt read FLength;\r\n    property parentRule : TJSCSSRule read FParentRule;\r\n  end;\r\n\r\n  TJSScrollIntoViewOptions = class external name 'Object'  (TJSObject)\r\n    behaviour : string;\r\n    block : string;\r\n    inline_ : string; external name 'inline';\r\n  end;\r\n\r\n\r\n  { TJSHTMLElement }\r\n\r\n  TJSHTMLElement = class external name 'HTMLElement' (TJSElement)\r\n  private\r\n    FDataset: TJSObject ; external name 'dataset';\r\n    FIsContentEditable: Boolean ; external name 'isContentEditable';\r\n    FOffsetHeight: Double; external name 'offsetHeight';\r\n    FOffsetLeft: Double; external name 'offsetLeft';\r\n    FOffsetParent: TJSElement; external name 'offsetParent';\r\n    FOffsetTop: Double; external name 'offsetTop';\r\n    FOffsetWidth: Double; external name 'offsetWidth';\r\n  Public\r\n    accessKey : string;\r\n    contentEditable : string;\r\n    dir : string;\r\n    draggable : boolean;\r\n    hidden : boolean;\r\n    lang : string;\r\n    spellcheck : boolean;\r\n    style : TJSCSSStyleDeclaration;\r\n    tabIndex : Integer;\r\n    title: string;\r\n    onabort : TJSEventHandler;\r\n    onanimationcancel: THTMLAnimationEventHandler;\r\n    onanimationend: THTMLAnimationEventHandler;\r\n    onblur : TJSEventHandler;\r\n    oncancel : TJSEventHandler;\r\n    oncanplay : TJSEventHandler;\r\n    oncanplaythrough : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onclick: THTMLClickEventHandler;\r\n    onclose : TJSEventHandler;\r\n    oncontextmenu : TJSEventHandler;\r\n    ondblclick : THTMLClickEventHandler;\r\n    ondrag : TJSDragDropEventHandler;\r\n    ondragend : TJSDragDropEventHandler;\r\n    ondragenter : TJSDragDropEventHandler;\r\n    ondragexit : TJSDragDropEventHandler;\r\n    ondragover : TJSDragDropEventHandler;\r\n    ondragleave : TJSDragDropEventHandler;\r\n    ondragstart: TJSDragDropEventHandler;\r\n    ondrop : TJSDragDropEventHandler;\r\n    onerror : TJSErrorEventHandler;\r\n    onfocus : TJSFocusEventhandler;\r\n    ondurationchange : TJSEventHandler;\r\n    onemptied : TJSEventHandler;\r\n    onended : TJSEventHandler;\r\n    ongotpointercapture : TJSPointerEventHandler;\r\n    oninput : TJSEventhandler;\r\n    oninvalid : TJSEventhandler;\r\n    onkeydown : TJSKeyEventhandler;\r\n    onkeypress : TJSKeyEventhandler;\r\n    onkeyup : TJSKeyEventhandler;\r\n    onload : TJSEventhandler;\r\n    onloadeddata : TJSEventhandler;\r\n    onloadedmetadata : TJSEventhandler;\r\n    onloadend : TJSLoadEventhandler;\r\n    onloadstart : TJSLoadEventhandler;\r\n    onlostpointercapture : TJSPointerEventHandler;\r\n    onmousedown : TJSMouseEventHandler;\r\n    onmouseenter : TJSMouseEventHandler;\r\n    onmouseleave : TJSMouseEventHandler;\r\n    onmousemove : TJSMouseEventHandler;\r\n    onmouseout : TJSMouseEventHandler;\r\n    onmouseover : TJSMouseEventHandler;\r\n    onmouseup : TJSMouseEventHandler;\r\n    onmousewheel : TJSMouseEventHandler;\r\n    onpause : TJSPointerEventHandler;\r\n    onplay : TJSPointerEventHandler;\r\n    onplaying : TJSPointerEventHandler;\r\n    onpointercancel : TJSPointerEventHandler;\r\n    onpointerdown : TJSPointerEventHandler;\r\n    onpointerenter : TJSPointerEventHandler;\r\n    onpointerleave : TJSPointerEventHandler;\r\n    onpointermove : TJSPointerEventHandler;\r\n    onpointerout : TJSPointerEventHandler;\r\n    onpointerover : TJSPointerEventHandler;\r\n    onpointerup : TJSPointerEventHandler;\r\n    onpointerlockchange : TJSPointerEventHandler;\r\n    onprogress : TJSProgressEventhandler;\r\n    onseeked : TJSEventHandler;\r\n    onseeking : TJSEventHandler;\r\n    onreset : TJSUIEventHandler;\r\n    onscroll : TJSUIEventHandler;\r\n    onselect : TJSEventHandler;\r\n    onselectstart : TJSEventHandler;\r\n    onselectionchange : TJSEventHandler;\r\n    onshow : TJSEventHandler;\r\n    onstalled : TJSEventHandler;\r\n    ontimeupdate : TJSEventHandler;\r\n    ontransitioncancel : TJSEventHandler;\r\n    ontransitionend : TJSEventHandler;\r\n    onvolumechange : TJSEventHandler;\r\n    onsubmit : TJSEventHandler;\r\n    onwheel : TJSMouseWheelEventHandler;\r\n    onwaiting : TJSEventHandler;\r\n    touchstart : TJSTouchEventHandler;\r\n    touchend : TJSTouchEventHandler;\r\n    touchmove : TJSTouchEventHandler;\r\n    touchcancel : TJSTouchEventHandler;\r\n    Procedure blur;\r\n    Procedure focus;\r\n    Procedure click;\r\n    procedure scrollIntoView; overload;\r\n    procedure scrollIntoView(alignToTop : Boolean);\r\n    procedure scrollIntoView(aObj : TJSObject);\r\n    procedure scrollIntoView(Opts: TJSScrollIntoViewOptions);\r\n    property dataset : TJSObject read FDataset;\r\n    property isContentEditable : Boolean read FIsContentEditable;\r\n    property offsetHeight : Double Read FOffsetHeight;\r\n    property offsetLeft : Double Read FOffsetLeft;\r\n    property offsetTop : Double Read FOffsetTop;\r\n    property offsetWidth : Double Read FOffsetWidth;\r\n    property offsetParent : TJSElement Read FOffsetParent;\r\n  end;\r\n  TJSHTMLElementArray = Array of TJSHTMLElement;\r\n\r\n  TJSHTMLDivElement = class external name 'HTMLDivElement' (TJSHTMLElement)\r\n  end;\r\n\r\n  TJSHTMLFormControlsCollection = class external name 'HTMLFormControlsCollection' (TJSHTMLCollection)\r\n  Public\r\n    function namedItem(S : String) : TJSElement; reintroduce; external name 'namedItem';\r\n    property Items[S : String] : TJSElement read namedItem; default;\r\n  end;\r\n\r\n  { TJSHTMLFormElement }\r\n\r\n  TJSHTMLFormElement = class external name 'HTMLFormElement' (TJSHTMLElement)\r\n  private\r\n    FElements: TJSHTMLFormControlsCollection; external name 'elements';\r\n    FLength: NativeInt; external name 'length';\r\n  Public\r\n    Procedure reset;\r\n    function reportValidity : Boolean;\r\n    function checkValidity : Boolean;\r\n    procedure submit;\r\n    method : string;\r\n    target : string;\r\n    action : string;\r\n    encoding : string;\r\n    enctype : string;\r\n    acceptCharset :  string;\r\n    autocomplete : string;\r\n    noValidate : boolean;\r\n    property elements : TJSHTMLFormControlsCollection read FElements;\r\n    Property length : NativeInt Read FLength;\r\n  end;\r\n\r\n  { TJSValidityState }\r\n\r\n  TJSValidityState = class external name 'ValidityState'  (TJSObject)\r\n  private\r\n    FBadInput: Boolean; external name 'badInput';\r\n    FCustomError: Boolean; external name 'customError';\r\n    FPatternMismatch: Boolean; external name 'patternMisMatch';\r\n    FRangeOverflow: Boolean; external name 'rangeOverflow';\r\n    FRangeUnderflow: Boolean; external name 'rangeUnderflow';\r\n    FStepMismatch: Boolean; external name 'stepMismatch';\r\n    FTooLong: Boolean; external name 'tooLong';\r\n    FTooShort: Boolean; external name 'tooShort';\r\n    FTypeMismatch: Boolean; external name 'typeMisMatch';\r\n    FValid: Boolean; external name 'valid';\r\n    FValueMissing: Boolean; external name 'valueMissing';\r\n  public\r\n    property badInput : Boolean read FBadInput;\r\n    property customError : Boolean read FCustomError;\r\n    property patternMisMatch : Boolean read FPatternMismatch;\r\n    property rangeOverflow : Boolean read FRangeOverflow;\r\n    property rangeUnderflow : Boolean read FRangeUnderflow;\r\n    property stepMismatch : Boolean read FStepMismatch;\r\n    property tooLong : Boolean read FTooLong;\r\n    property tooShort : Boolean read FTooShort;\r\n    property typeMisMatch : Boolean read FTypeMismatch;\r\n    property valid : Boolean Read FValid;\r\n    property valueMissing : Boolean read FValueMissing;\r\n  end;\r\n\r\n  { TJSBlob }\r\n\r\n  TJSBlob = class external name 'Blob' (TJSEventTarget)\r\n  private\r\n    FSize: NativeInt; external name 'size';\r\n    FType: string; external name  'type';\r\n  Public\r\n    procedure close;\r\n    function slice : TJSBlob; overload;\r\n    function slice(aStart : NativeInt) : TJSBlob; overload;\r\n    function slice(aStart,aEnd : NativeInt) : TJSBlob; overload;\r\n    function slice(aStart,aEnd : NativeInt; AContentType : String) : TJSBlob; overload;\r\n    function arrayBuffer : TJSPromise;\r\n    property size : NativeInt read FSize;\r\n    property _type : string read FType; deprecated;\r\n    property type_ : string read FType;\r\n  end;\r\n\r\n  { TJSHTMLFile }\r\n\r\n  TJSHTMLFile = class external name 'File' (TJSBlob)\r\n  private\r\n    FLastModified: NativeInt; external name 'lastModified';\r\n    FLastModifiedDate: TJSDate; external name 'lastModifiedDate';\r\n    FName: string; external name 'name';\r\n  public\r\n    property lastModified: NativeInt read FLastModified;\r\n    property lastModifiedDate : TJSDate read FLastModifiedDate; deprecated;\r\n    property name: String read FName;\r\n  end;\r\n\r\n  { TJSHTMLFileList }\r\n\r\n  TJSHTMLFileList = class external name 'FileList' (TJSEventTarget)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n  Public\r\n    function item(aIndex : NativeInt) : TJSHTMLFile;\r\n    property length : NativeInt read FLength;\r\n    property Files[aIndex : NativeInt] : TJSHTMLFile Read item; default;\r\n  end;\r\n\r\n   { TJSHTMLInputElement }\r\n  // https://html.spec.whatwg.org/multipage/forms.html#the-input-element\r\n\r\n  TJSHTMLInputElement = class external name 'HTMLInputElement' (TJSHTMLElement)\r\n  private\r\n    FFiles: TJSHTMLFileList; external name 'files';\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FLabels: TJSNodeList; external name 'labels';\r\n    FList: TJSHTMLElement; external name 'list';\r\n    FValidationmMessage: string; external name 'validationMessage';\r\n    FValidity: TJSValidityState; external name 'validity';\r\n    FWillValidate: boolean; external name 'willValidate';\r\n  Public\r\n    procedure select;\r\n    procedure setCustomValidity(aText : string);\r\n    procedure stepUp; overload;\r\n    procedure stepUp(n : Integer); overload;\r\n    function checkValidity : Boolean;\r\n    function reportValidity : Boolean;\r\n    procedure setSelectionRange(selectionStart, selectionEnd: NativeInt) ; overload;\r\n    procedure setSelectionRange(selectionStart, selectionEnd: NativeInt; Direction : string) ; overload;\r\n    procedure setRangeText(aText : string; selectionStart, selectionEnd: NativeInt) ; overload;\r\n    procedure setRangeText(aText : string; selectionStart, selectionEnd: NativeInt; Direction : string) ; overload;\r\n  Public\r\n    accept : string;\r\n    allowDirs : boolean;\r\n    align : string;\r\n    alt : string;\r\n    autofocus : boolean;\r\n    autocapitalize : string;\r\n    autocomplete : string;\r\n    defaultValue : string;\r\n    defaultChecked : string;\r\n    checked : boolean;\r\n    dirName : string;\r\n    disabled : boolean;\r\n    formAction : string;\r\n    formEncType : string;\r\n    formMethod : string;\r\n    formNoValidate : Boolean;\r\n    formTarget : string;\r\n    height : string;\r\n    indeterminate : boolean;\r\n    inputMode : string;\r\n    max : string;\r\n    maxLength : NativeInt;\r\n    min : string;\r\n    minLength : NativeInt;\r\n    multiple : boolean;\r\n    pattern : string;\r\n    placeholder : string;\r\n    readOnly : boolean;\r\n    required : boolean;\r\n    size : NativeInt;\r\n    src : string;\r\n    step : string;\r\n    _type : string; external name 'type';\r\n    selectionStart : NativeInt;\r\n    selectionEnd : NativeInt;\r\n    selectionDirection : string;\r\n    useMap : string;\r\n    value : string;\r\n    width : string;\r\n    property files : TJSHTMLFileList Read FFiles;\r\n    property form : TJSHTMLFormElement read FForm;\r\n    property labels : TJSNodeList read FLabels;\r\n    property list : TJSHTMLElement Read FList;\r\n    property validationMessage : string read FValidationmMessage;\r\n    property willValidate : boolean read FWillValidate;\r\n    property validity : TJSValidityState read FValidity;\r\n  end;\r\n\r\n  TJSDOMSettableTokenList = class external name 'DOMSettableTokenList' (TJSDOMTokenList)\r\n  private\r\n    fvalue: TJSDOMString; external name 'value';\r\n  public\r\n    property value: TJSDOMString read fvalue; // readonly\r\n  end;\r\n\r\n  TJSHTMLOutputElement = class external name 'HTMLOutputElement' (TJSHTMLElement)\r\n  private\r\n    flabels: TJSNodeList; external name 'labels';\r\n    fform: TJSHTMLFormElement; external name 'form';\r\n    ftype: TJSDOMString; external name 'type';\r\n    fdefaultValue: TJSDOMString; external name 'defaultValue';\r\n    fvalue: TJSDOMString; external name 'value';\r\n    fwillValidate: Boolean; external name 'willValidate';\r\n    fvalidity: TJSValidityState; external name 'validity';\r\n    fvalidationMessage: TJSDOMString; external name 'validationMessage';\r\n  public\r\n    htmlFor: TJSDOMSettableTokenList;\r\n    function checkValidity: Boolean;\r\n    function reportValidity: Boolean;\r\n    procedure setCustomValidity(error: TJSDOMString);\r\n  public\r\n    property labels: TJSNodeList read flabels;\r\n    property form: TJSHTMLFormElement read fform;\r\n    property type_: TJSDOMString read ftype;\r\n    property defaultValue: TJSDOMString read fdefaultValue;\r\n    property value: TJSDOMString read fvalue write fvalue;\r\n    property willValidate: Boolean read fwillValidate;\r\n    property validity: TJSValidityState read fvalidity;\r\n    property validationMessage: TJSDOMString read fvalidationMessage;\r\n  end;\r\n\r\n  { TJSHTMLImageElement }\r\n\r\n  TJSHTMLImageElement = class external name 'Image' (TJSHTMLElement)\r\n  Private\r\n    FComplete: boolean; external name 'complete';\r\n    FCurrentSrc: String; external name 'currentSrc';\r\n    FNaturalHeight: NativeUInt; external name 'naturalHeight';\r\n    FNaturalWidth: NativeUInt; external name 'naturalWidth';\r\n    FX: NativeInt; external name 'x';\r\n    FY: NativeInt; external name 'y';\r\n  Public\r\n    constructor New(x,y : Cardinal); overload;\r\n    alt: String;\r\n    crossOrigin: String;\r\n    decoding: String;\r\n    height: NativeUInt;\r\n    isMap: boolean;\r\n    referrerPolicy: String;\r\n    src: String;\r\n    sizes: String;\r\n    srcset: String;\r\n    useMap: String;\r\n    width: NativeUInt;\r\n    function decode : TJSPromise;\r\n    property complete: boolean read FComplete;\r\n    property currentSrc: String read FCurrentSrc;\r\n    property naturalHeight: NativeUInt read FNaturalHeight;\r\n    property naturalWidth: NativeUInt read FNaturalWidth;\r\n    property x: NativeInt read FX;\r\n    property y: NativeInt read FY;\r\n  end;\r\n\r\n  TJSHTMLLinkElement = class external name 'HTMLLinkElement'(TJSHTMLElement)\r\n  Private\r\n    frelList: TJSDOMTokenList; external name 'relList';\r\n    fsizes: TJSDOMSettableTokenList {TJSDOMTokenList}; external name 'sizes';\r\n  Public\r\n    href: string;\r\n    crossOrigin: string;\r\n    rel: string;\r\n    as_: string; external name 'as';\r\n    media: string;\r\n    integrity: string;\r\n    hreflang: string;\r\n    type_: string external name 'type';\r\n    imageSrcset: string;\r\n    imageSizes: string;\r\n    referrerPolicy: string;\r\n    disabled: string;\r\n    charset: string deprecated; // obsolete\r\n    rev: string deprecated; // obsolete property\r\n    target: string deprecated; // obsolete property\r\n    Property relList: TJSDOMTokenList read frelList;\r\n    Property sizes: TJSDOMSettableTokenList{TJSDOMTokenList} read fsizes;\r\n  end;\r\n\r\n  { TJSHTMLAnchorElement }\r\n\r\n  TJSHTMLAnchorElement = class external name 'HTMLAnchorElement' (TJSHTMLElement)\r\n  Private\r\n    FOrigin: string;external name 'origin';\r\n    frelList: TJSDOMTokenList; external name 'relList';\r\n  Public\r\n    href: string;\r\n    download: string;\r\n    hash: string;\r\n    host: string;\r\n    hostname: string;\r\n    hreflang: string;\r\n    media: string ;\r\n    password: string;\r\n    Protocol: string;\r\n    referrerPolicy : string;\r\n    rel: string ;\r\n    rev: string deprecated; // obsolete property\r\n    target: string ;\r\n    text : string;\r\n    type_ : string external name 'type';\r\n    username : string;\r\n    Property relList: TJSDOMTokenList read frelList;\r\n    Property origin: string Read FOrigin;\r\n  end;\r\n\r\n  { TJSHTMLMenuElement }\r\n\r\n  TJSHTMLMenuElement = class external name 'HTMLMenuElement' (TJSHTMLElement) //  uhm... should it be declared? it is experimental at Mozilla docs...\r\n  end;\r\n\r\n  { TJSHTMLButtonElement }\r\n\r\n  TJSHTMLButtonElement = class external name 'HTMLButtonElement' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FLabels: TJSNodeList; external name 'labels';\r\n    FValidationmMessage: String; external name 'validationMessage';\r\n    FValidity: TJSValidityState; external name 'validity';\r\n    FWillValidate: boolean; external name 'willValidate';\r\n  Public\r\n    autofocus : boolean;\r\n    disabled : boolean;\r\n    formAction : String;\r\n    formEnctype : String;\r\n    formMethod : String;\r\n    formNoValidate : Boolean;\r\n    formTarget : String;\r\n    menu: TJSHTMLMenuElement;\r\n    _type : String; external name 'type';\r\n    value : string;\r\n  Public\r\n    property form : TJSHTMLFormElement Read FForm;\r\n    property labels : TJSNodeList Read FLabels;\r\n    property validationMessage : String Read FValidationmMessage;\r\n    property validity : TJSValidityState Read FValidity;\r\n    property willValidate : boolean read FWillValidate;\r\n  end;\r\n\r\n  TJSHTMLLabelElement = class external name 'HTMLLabelElement' (TJSHTMLElement)\r\n  Private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FControl : TJSHTMLElement; external name 'control';\r\n  Public\r\n    For_ : String; external name 'htmlFor';\r\n    property Control : TJSHTMLElement Read FControl;\r\n    property Form : TJSHTMLFormElement read FForm;\r\n  end;\r\n\r\n  { TJSHTMLTextAreaElement }\r\n\r\n  TJSHTMLTextAreaElement = class external name 'HTMLTextAreaElement' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FTextLength: NativeInt; external name 'textKength';\r\n    FType: String; external name 'type';\r\n    FValidationMessage: String; external name 'validationMessage';\r\n    FValidity: TJSValidityState;  external name 'validity';\r\n    FWillValidate: boolean; external name 'willValidate';\r\n  Public\r\n    defaultValue : string;\r\n    value : string;\r\n    rows : cardinal;\r\n    cols : cardinal;\r\n    autofocus : boolean;\r\n    disabled : boolean;\r\n    maxLength : nativeInt;\r\n    readOnly : Boolean;\r\n    required : Boolean;\r\n    selectionStart : Cardinal;\r\n    selectionEnd : Cardinal;\r\n    selectionDirection : String;\r\n    wrap : string;\r\n    Property Form : TJSHTMLFormElement Read FForm;\r\n    Property Type_: String Read FType;\r\n    Property textLength : NativeInt Read FTextLength;\r\n    Property validity : TJSValidityState Read FValidity;\r\n    property willValidate : boolean read FWillValidate;\r\n    property validationMessage : String Read FValidationMessage;\r\n  end;\r\n\r\n  { TJSHTMLEmbedElement }\r\n\r\n  TJSHTMLEmbedElement = class external name 'HTMLEmbedElement' (TJSHTMLElement)\r\n  Public\r\n    height: String;\r\n    src: String;\r\n    _type : String; external name 'type';\r\n    width: String;\r\n  end;\r\n\r\n  { TJSHTMLOptionElement }\r\n\r\n  TJSHTMLOptionElement = class external name 'Option' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FIndex: NativeInt; external name 'index';\r\n  Public\r\n    Constructor New; overload;\r\n    Constructor New(aText : String); overload;\r\n    Constructor New(aText,aValue : String); overload;\r\n    Constructor New(aText,aValue : String; aDefaultSelected : Boolean); overload;\r\n    Constructor New(aText,aValue : String; aDefaultSelected,Selected : Boolean); overload;\r\n  Public\r\n    defaultSelected : boolean;\r\n    disabled : boolean;\r\n    _label : string ; external name 'label';\r\n    selected : boolean;\r\n    text : string;\r\n    value : string;\r\n    property index : NativeInt Read FIndex;\r\n    property form : TJSHTMLFormElement Read FForm;\r\n  end;\r\n\r\n  TJSHTMLOptGroupElement = class external name 'HTMLOptGroupElement' (TJSHTMLElement)\r\n  end;\r\n\r\n  TJSHTMLOptionsCollection = class external name 'HTMLOptionsCollection' (TJSHTMLCollection)\r\n  end;\r\n\r\n  { TJSHTMLSelectElement }\r\n\r\n  TJSHTMLSelectElement = Class external name 'HTMLSelectElement' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FLabels: TJSNodeList; external name 'labels';\r\n    FLength: NativeInt; external name 'length';\r\n    FOptions: TJSHTMLOptionsCollection; external name 'options';\r\n    FSelectedOptions: TJSHTMLCollection; external name 'selectedOptions';\r\n    FType: String; external name 'type';\r\n    FValidationMessage: string; external name 'validationMessage';\r\n    FValidity: TJSValidityState; external name 'validity';\r\n    fwillValidate: Boolean; external name 'willValidate';\r\n  Public\r\n    Procedure add(anItem : TJSHTMLOptionElement); overload;\r\n    Procedure add(anItem, before : TJSHTMLOptionElement); overload;\r\n    function item(aIndex : NativeInt): TJSHTMLOptionElement;\r\n    function namedItem(aName : String): TJSHTMLOptionElement;\r\n    procedure remove(aIndex : NativeInt); overload;\r\n    procedure checkValidity;\r\n    procedure setCustomValidity(aMessage : String);\r\n  Public\r\n    autofocus : Boolean;\r\n    disabled : Boolean;\r\n    multiple : boolean;\r\n    required: boolean;\r\n    selectedIndex : NativeInt;\r\n    size : NativeInt;\r\n    value : string;\r\n    property length : NativeInt read FLength;\r\n    Property options : TJSHTMLOptionsCollection read FOptions;\r\n    Property selectedOptions : TJSHTMLCollection read FSelectedOptions;\r\n    Property form : TJSHTMLFormElement read FForm;\r\n    property labels : TJSNodeList Read FLabels;\r\n    property _type : String Read FType;\r\n    property validity : TJSValidityState Read FValidity;\r\n    property validationMessage : string Read FValidationMessage;\r\n    property willValidate : Boolean read fwillValidate;\r\n  end;\r\n\r\n  { TJSHTMLTableElement }\r\n\r\n  TJSHTMLTableSectionElement = class;\r\n  TJSHTMLTableRowElement = class;\r\n\r\n  TJSHTMLTableElement = Class external name 'HTMLTableElement'(TJSHTMLElement)\r\n  private\r\n    FAlign: String; external name 'align';\r\n    FBGColor: String; external name 'bgColor';\r\n    FBorder: String; external name 'border';\r\n    FCaption: TJSHTMLElement; external name 'caption';\r\n    FCellPadding: String; external name 'cellPadding';\r\n    FCellSpacing: String; external name 'cellSpacing';\r\n    FFrame: String; external name 'frame';\r\n    FRows: TJSHTMLCollection; external name 'rows';\r\n    FRules: String; external name 'rules';\r\n    FSummary: String; external name 'summary';\r\n    FTBodies: TJSHTMLCollection; external name 'tBodies';\r\n    FTfoot: TJSHTMLTableSectionElement; external name 'tfoot';\r\n    FTHead: TJSHTMLTableSectionElement; external name 'tHead';\r\n    FWidth: String; external name 'width';\r\n  public\r\n  { Methods }\r\n    function createCaption: TJSHTMLElement;\r\n    function createTFoot: TJSHTMLTableSectionElement;\r\n    function createTHead: TJSHTMLTableSectionElement;\r\n    function createTBody: TJSHTMLTableSectionElement;\r\n    procedure deleteCaption;\r\n    procedure deleteRow(index: Integer);\r\n    procedure deleteTFoot;\r\n    procedure deleteTHead;\r\n    function insertRow(index: Integer): TJSHTMLTableRowElement;\r\n  { Properties }\r\n    property align: String read FAlign write FAlign;\r\n    property bgColor: String read FBGColor write FBGColor;\r\n    property border: String read FBorder write FBorder;\r\n    property caption: TJSHTMLElement read FCaption;\r\n    property cellPadding: String read FCellPadding write FCellPadding;\r\n    property cellSpacing: String read FCellSpacing write FCellSpacing;\r\n    property frame: String read FFrame write FFrame;\r\n    property rows: TJSHTMLCollection read FRows;\r\n    property rules: String read FRules write FRules;\r\n    property summary: String read FSummary write FSummary;\r\n    property tBodies: TJSHTMLCollection read FTBodies;\r\n    property tfoot: TJSHTMLTableSectionElement read FTfoot;\r\n    property tHead: TJSHTMLTableSectionElement read FTHead;\r\n    property width: String read FWidth write FWidth;\r\n  end;\r\n\r\n  { TJSHTMLTableSectionElement }\r\n\r\n  TJSHTMLTableSectionElement = Class external name 'HTMLTableSectionElement' (TJSHTMLElement)\r\n  private\r\n    Falign: String; external name 'align';\r\n    Frows: TJSHTMLCollection external name 'rows';\r\n    Fch: String; external name 'ch';\r\n    FchOff: String; external name 'chOff';\r\n    FvAlign: String; external name 'vAlign';\r\n  public\r\n  { Methods }\r\n    procedure deleteRow(index: Integer);\r\n    function insertRow(index: Integer): TJSHTMLTableRowElement;\r\n  { Properties }\r\n    property align: String read Falign write Falign;\r\n    property rows: TJSHTMLCollection read Frows;\r\n    property ch: String read Fch write Fch;\r\n    property chOff: String read FchOff write FchOff;\r\n    property vAlign: String read FvAlign write FvAlign;\r\n  end;\r\n\r\n  { TJSHTMLTableCellElement }\r\n\r\n  TJSHTMLTableCellElement = Class external name 'HTMLTableCellElement' (TJSHTMLElement)\r\n  private\r\n    Fabbr: String; external name 'abbr';\r\n    Falign: String; external name 'align';\r\n    Faxis: String; external name 'axis';\r\n    FbgColor: String; external name 'bgColor';\r\n    FcellIndex: Integer; external name 'cellIndex';\r\n    Fch: String; external name 'ch';\r\n    FchOff: String; external name 'chOff';\r\n    FcolSpan: Integer; external name 'colSpan';\r\n    Fheaders: String; external name 'headers';\r\n    Fheight: String; external name 'height';\r\n    FnoWrap: Boolean; external name 'noWrap';\r\n    FrowSpan: Integer; external name 'rowSpan';\r\n    Fscope: String; external name 'scope';\r\n    FvAlign: String; external name 'vAlign';\r\n    Fwidth: String; external name 'width';\r\n  public\r\n  { Properties }\r\n    property abbr: String read Fabbr write Fabbr;\r\n    property align: String read Falign write Falign;\r\n    property axis: String read Faxis write Faxis;\r\n    property bgColor: String read FbgColor write FbgColor;\r\n    property cellIndex: Integer read FcellIndex;\r\n    property ch: String read Fch write Fch;\r\n    property chOff: String read FchOff write FchOff;\r\n    property colSpan: Integer read FcolSpan write FcolSpan;\r\n    property headers: String read Fheaders;\r\n    property height: String read Fheight write Fheight;\r\n    property noWrap: Boolean read FnoWrap write FnoWrap;\r\n    property rowSpan: Integer read FrowSpan write FrowSpan;\r\n    property scope: String read Fscope write Fscope;\r\n    property vAlign: String read FvAlign write FvAlign;\r\n    property width: String read Fwidth write Fwidth;\r\n  end;\r\n\r\n  { TJSHTMLTableRowElement }\r\n\r\n  TJSHTMLTableRowElement = Class external name 'HTMLTableRowElement' (TJSHTMLElement)\r\n  private\r\n    Falign: String; external name 'align';\r\n    FbgColor: String; external name 'bgColor';\r\n    Fcells: TJSHTMLCollection; external name 'cells';\r\n    Fch: String; external name 'ch';\r\n    FchOff: String; external name 'chOff';\r\n    FrowIndex: Integer; external name 'rowIndex';\r\n    FsectionRowIndex: Integer; external name 'sectionRowIndex';\r\n    FvAlign: String; external name 'vAlign';\r\n  public\r\n  { Methods }\r\n    procedure deleteCell(index: Integer);\r\n    function insertCell(index: Integer): TJSHTMLTableCellElement;\r\n  { Properties }\r\n    property align: String read Falign write Falign;\r\n    property bgColor: String read FbgColor write FbgColor;\r\n    property cells: TJSHTMLCollection read Fcells;\r\n    property ch: String read Fch write Fch;\r\n    property chOff: String read FchOff write FchOff;\r\n    property rowIndex: Integer read FrowIndex;\r\n    property sectionRowIndex: Integer read FsectionRowIndex;\r\n    property vAlign: String read FvAlign write FvAlign;\r\n  end;\r\n\r\n  { TJSHTMLTableDataCellElement }\r\n\r\n  TJSHTMLTableDataCellElement = Class external name 'HTMLTableDataCellElement' (TJSHTMLElement)\r\n  private\r\n    Fabbr: String; external name 'abbr';\r\n  public\r\n  { Properties }\r\n    property abbr: String read Fabbr write Fabbr;\r\n  end;\r\n\r\n\r\n  TJSCanvasRenderingContext2D = Class;\r\n\r\n  THTMLCanvasToBlobCallback = Reference to function (aBlob : TJSBlob) : boolean; safecall;\r\n\r\n  TJSHTMLCanvasElement = Class external name 'HTMLCanvasElement' (TJSHTMLElement)\r\n  Public\r\n    height : integer;\r\n    width : integer;\r\n    Function getContext(contextType : string) : TJSObject;\r\n    Function getContext(contextType : string; contextAttributes : TJSObject) : TJSObject;\r\n    Function getContextAs2DContext(contextType : string; contextAttributes : TJSObject) : TJSCanvasRenderingContext2D; external name 'getContext';\r\n    Function getContextAs2DContext(contextType : string) : TJSCanvasRenderingContext2D; external name 'getContext';\r\n    Procedure toBlob (aCallBack : THTMLCanvasToBlobCallback; aMimeType : String); overload;\r\n    Procedure toBlob (aCallBack : THTMLCanvasToBlobCallback; aMimeType : String; aQuality : Double); overload;\r\n    Function toDataURL : String; overload;\r\n    Function toDataURL(aMimeType : String) : String; overload;\r\n    Function toDataURL(aMimeType : String; aQuality : Double) : String; overload;\r\n  end;\r\n\r\n  TJSHTMLProgressElement = class external name 'HTMLProgressElement' (TJSHTMLElement)\r\n  private\r\n    Fposition: Double; external name 'position';\r\n    Flabels: TJSNodeList; external name 'labels';\r\n  public\r\n    max: Double;\r\n    value: Double;\r\n    property position: Double read Fposition;\r\n    property labels: TJSNodeList read Flabels;\r\n  end;\r\n  Type\r\n\r\n  { TJSDOMException }\r\n\r\n  TJSDOMException = class external name 'DOMException' (TJSObject)\r\n  private\r\n    FCode: Integer; external name 'code';\r\n    FMessage: String; external name 'message';\r\n    FName: string; external name 'name';\r\n  Public\r\n    Property code : Integer Read FCode;\r\n    Property Message : String Read FMessage;\r\n    Property name : string Read FName;\r\n  end;\r\n\r\n  { TJSFileReader }\r\n\r\n  TJSFileReader = class external name 'FileReader' (TJSEventTarget)\r\n  private\r\n    FError: TJSDOMException; external name 'error';\r\n    fReadyState: Integer; external name 'readyState';\r\n    FResult: JSValue; external name 'result';\r\n  Public\r\n    Const EMPTY : Integer;\r\n    Const LOADING : Integer;\r\n    Const DONE : Integer;\r\n  Public\r\n    onabort : TJSEventHandler;\r\n    onerror : TJSEventHandler;\r\n    onload : TJSEventHandler;\r\n    onloadstart : TJSEventHandler;\r\n    onloadend : TJSEventHandler;\r\n    onprogress : TJSEventHandler;\r\n  Public\r\n    constructor new;\r\n    Procedure abort;\r\n    procedure readAsArrayBuffer(Blob: TJSBlob);\r\n    procedure readAsBinaryString(Blob: TJSBlob);\r\n    procedure readAsDataURL(Blob: TJSBlob);\r\n    procedure readAsText(Blob: TJSBlob; encoding : string);\r\n    procedure readAsText(Blob: TJSBlob);\r\n    property Error : TJSDOMException read FError;\r\n    Property readyState : Integer Read fReadyState;\r\n    property Result : JSValue Read FResult;\r\n  end;\r\n\r\n  TCanvasCoordType = double; // Is in fact a number.\r\n\r\n  // Opaque objects\r\n  TJSCanvasGradient = class external name 'CanvasGradient'  (TJSObject)\r\n  end;\r\n\r\n  TJSCanvasPattern = class external name 'CanvasPattern'  (TJSObject)\r\n  end;\r\n\r\n  TJSPath2D = class external name 'Path2D'  (TJSObject)\r\n  Public\r\n    constructor new; overload;\r\n    constructor new(aPath : TJSPath2D); overload;\r\n    constructor new(SVGPath : String); overload;\r\n    Procedure addPath(aPath : TJSPath2D);\r\n    procedure arc(x,y, radius,startAngle,endAngle : TCanvasCoordType); overload;\r\n    procedure arc(x,y, radius,startAngle,endAngle : TCanvasCoordType; antiClockWise : boolean); overload;\r\n    procedure arcTo(x1,y1,x2,y2,radius : TCanvasCoordType); overload;\r\n    procedure bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y : TCanvasCoordType); overload;\r\n    Procedure closePath;\r\n    procedure ellipse(x, y, radiusX, radiusY : TCanvasCoordType; rotation, startAngle, endAngle : Double); overload;\r\n    procedure ellipse(x, y, radiusX, radiusY : TCanvasCoordType; rotation, startAngle, endAngle : Double; anticlockwise : Boolean); overload;\r\n    Procedure lineTo(X,Y : TCanvasCoordType);\r\n    Procedure moveTo(X,Y : TCanvasCoordType);\r\n    procedure quadraticCurveTo(cpx,cpy,x,y : TCanvasCoordType);\r\n    procedure rect(x,y,awidth,aheight: TCanvasCoordType); overload;\r\n  end;\r\n\r\n  { TJSImageData }\r\n\r\n  TJSImageData = class external name 'ImageData'  (TJSObject)\r\n  private\r\n    FData: TJSUint8ClampedArray; external name 'data';\r\n    FHeight: Integer; external name 'height';\r\n    FWidth: Integer; external name 'width';\r\n  Public\r\n    constructor new(awidth,aheight : integer); overload;\r\n    constructor new(anArray :TJSUint8ClampedArray; awidth,aheight : integer); overload;\r\n    property data : TJSUint8ClampedArray read FData;\r\n    property height : Integer Read FHeight;\r\n    property width : Integer Read FWidth;\r\n  end;\r\n\r\n\r\n  TJSTextMetrics = class external name 'TextMetrics' (TJSObject)\r\n    width : TCanvasCoordType;\r\n    actualBoundingBoxLeft : TCanvasCoordType;\r\n    actualBoundingBoxRight : TCanvasCoordType;\r\n    fontBoundingBoxAscent : TCanvasCoordType;\r\n    fontBoundingBoxDescent : TCanvasCoordType;\r\n    actualBoundingBoxAscent : TCanvasCoordType;\r\n    actualBoundingBoxDescent : TCanvasCoordType;\r\n    emHeightAscent : TCanvasCoordType;\r\n    emHeightDescent : TCanvasCoordType;\r\n    hangingBaseline : TCanvasCoordType;\r\n    alphabeticBaseline : TCanvasCoordType;\r\n    ideographicBaseline : TCanvasCoordType;\r\n  end;\r\n\r\n  { TJSCanvasRenderingContext2D }\r\n  TJSCanvasRenderingContext2D = class external name 'CanvasRenderingContext2D'  (TJSObject)\r\n  private\r\n    FCanvas: TJSHTMLCanvasElement; external name 'canvas';\r\n    FfillStyleColor: String; external name 'fillStyle';\r\n    FfillStyleGradient: TJSCanvasGradient; external name 'fillStyle';\r\n    FfillStylePattern: TJSCanvasPattern; external name 'fillStyle';\r\n    FimageSmoothingEnabled: Boolean; external name 'imageSmoothingEnabled';\r\n    FstrokeStyleColor: String; external name 'strokeStyle';\r\n    FstrokeStyleGradient: TJSCanvasGradient; external name 'strokeStyle';\r\n    FstrokeStylePattern: TJSCanvasPattern; external name 'strokeStyle';\r\n  Public\r\n    fillStyle : JSValue;\r\n    font : string;\r\n    globalAlpha : double;\r\n    globalCompositeOperation : String;\r\n    lineCap : string;\r\n    lineDashOffset : Double;\r\n    lineJoin : String;\r\n    lineWidth : Double;\r\n    miterLimit : Double;\r\n    shadowBlur : Double;\r\n    shadowColor : String;\r\n    shadowOffsetX : Double;\r\n    shadowOffsetY : Double;\r\n    strokeStyle : JSValue;\r\n    textAlign : String;\r\n    textBaseline : String;\r\n    procedure arc(x,y, radius,startAngle,endAngle : TCanvasCoordType); overload;\r\n    procedure arc(x,y, radius,startAngle,endAngle : TCanvasCoordType; antiClockWise : boolean); overload;\r\n    procedure arcTo(x1,y1,x2,y2,radius : TCanvasCoordType); overload;\r\n    procedure beginPath;\r\n    procedure bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y : TCanvasCoordType); overload;\r\n    procedure clearRect(x,y,width,height : TCanvasCoordType);\r\n    procedure clip; overload;\r\n    procedure clip(aFillRule : String); overload;\r\n    procedure clip(aPath : TJSPath2D); overload;\r\n    procedure closePath;\r\n    function createImageData(aWidth,aHeight : Integer) : TJSImageData; overload;\r\n    function createImageData(aImage : TJSImageData) : TJSImageData; overload;\r\n    function createLinearGradient(x0,y0,x1,y1 : TCanvasCoordType) : TJSCanvasGradient;\r\n    function createPattern(aImage : TJSObject; repetition : string) : TJSCanvasPattern;\r\n    function createRadialGradient(x0,y0,r0,x1,y1,r1 : TCanvasCoordType) : TJSCanvasGradient;\r\n    procedure drawFocusIfNeeded(aElement : TJSElement); overload;\r\n    procedure drawFocusIfNeeded(aPath : TJSPath2D; aElement : TJSElement); overload;\r\n    procedure drawImage(image : TJSObject; dx,dy : TCanvasCoordType); overload;\r\n    procedure drawImage(image : TJSObject; dx,dy,dwidth,dheight : TCanvasCoordType); overload;\r\n    procedure drawImage(image : TJSObject; sx,sy,sWidth,sHeight,dx,dy,dwidth,dheight : TCanvasCoordType); overload;\r\n    procedure ellipse(x, y, radiusX, radiusY : TCanvasCoordType; rotation, startAngle, endAngle : Double); overload;\r\n    procedure ellipse(x, y, radiusX, radiusY : TCanvasCoordType; rotation, startAngle, endAngle : Double; anticlockwise : Boolean); overload;\r\n    procedure fill; overload;\r\n    procedure fill(aRule : String); overload;\r\n    procedure fill(aPath : TJSPath2D); overload;\r\n    procedure fill(aPath : TJSPath2D;aRule : String); overload;\r\n    procedure fillRect(x,y,awidth,aheight: TCanvasCoordType); overload;\r\n    procedure fillText(aText : string; x,y : TCanvasCoordType); overload;\r\n    procedure fillText(aText : string; x,y, aMaxWidth : TCanvasCoordType); overload;\r\n    function getImageData(x,y,awidth,aheight: TCanvasCoordType) : TJSImageData; overload;\r\n    function getLineDash : TJSArray;\r\n    function isPointInPath(x,y : TCanvasCoordType) : Boolean; overload;\r\n    function isPointInPath(x,y : TCanvasCoordType; aFillRule : String) : Boolean; overload;\r\n    function isPointInPath(aPath : TJSPath2D; x,y : TCanvasCoordType) : Boolean; overload;\r\n    function isPointInPath(aPath : TJSPath2D; x,y : TCanvasCoordType; aFillRule : String) : Boolean; overload;\r\n    function isPointInStroke(x,y : TCanvasCoordType) : Boolean; overload;\r\n    function isPointInStroke(aPath : TJSPath2D; x,y : TCanvasCoordType) : Boolean; overload;\r\n    procedure lineTo(x,y : TCanvasCoordType);\r\n    function measureText(S : String) : TJSTextMetrics;\r\n    procedure moveTo(x,y : TCanvasCoordType);\r\n    procedure putImageData(aData : TJSImageData; x,y: TCanvasCoordType) ; overload;\r\n    procedure putImageData(aData : TJSImageData; x,y,dityX,dirtyY,dirtyWidth,dirtyHeight: TCanvasCoordType) ; overload;\r\n    procedure quadraticCurveTo(cpx,cpy,x,y : TCanvasCoordType);\r\n    procedure rect(x,y,awidth,aheight: TCanvasCoordType); overload;\r\n    procedure restore;\r\n    procedure rotate(anAngle : double);\r\n    procedure save;\r\n    procedure scale(x,y : double);\r\n    procedure setLineDash(segments : TJSArray); overload;\r\n    procedure setLineDash(segments : array of integer); overload;\r\n    procedure setTransform(a,b,c,d,e,f : double);\r\n    procedure stroke; overload;\r\n    procedure stroke(aPath : TJSPath2D); overload;\r\n    procedure strokeRect(x,y,awidth,aheight: TCanvasCoordType);\r\n    procedure strokeText(aText : string; x,y : TCanvasCoordType); overload;\r\n    procedure strokeText(aText : string; x,y, aMaxWidth : TCanvasCoordType); overload;\r\n    procedure transform(a,b,c,d,e,f : double);\r\n    procedure translate(x,y : TCanvasCoordType);\r\n\r\n    property canvas : TJSHTMLCanvasElement Read FCanvas;\r\n    property fillStyleAsColor : String Read FfillStyleColor Write FfillStyleColor;\r\n    property fillStyleAsGradient : TJSCanvasGradient Read FfillStyleGradient Write FfillStyleGradient;\r\n    property fillStyleAsPattern : TJSCanvasPattern Read FfillStylePattern Write FfillStylePattern;\r\n    property imageSmoothingEnabled : Boolean Read FimageSmoothingEnabled Write FimageSmoothingEnabled;\r\n    property strokeStyleAsColor : String Read FstrokeStyleColor Write FstrokeStyleColor;\r\n    property strokeStyleAsGradient : TJSCanvasGradient Read FstrokeStyleGradient Write FstrokeStyleGradient;\r\n    property strokeStyleAsPattern : TJSCanvasPattern Read FstrokeStylePattern Write FstrokeStylePattern;\r\n  end;\r\n\r\n  { TJSHTMLIFrameElement }\r\n\r\n  TJSHTMLIFrameElement = Class external name 'HTMLIFrameElement' (TJSHTMLElement)\r\n  private\r\n    FAllowPaymentRequest: Boolean; external name 'allowPaymentRequest';\r\n    FContentDocument: TJSDocument; external name 'contentDocument';\r\n    FContentWindow: TJSWindow; external name 'contentWindow';\r\n    FSandbox: string; external name 'sandbox';\r\n  Public\r\n    height : string;\r\n    src : string;\r\n    srcdoc : string;\r\n    width : string;\r\n    Property allowPaymentRequest : Boolean Read FAllowPaymentRequest;\r\n    property contentWindow : TJSWindow Read FContentWindow;\r\n    property contentDocument : TJSDocument Read FContentDocument;\r\n    property sandbox : string read FSandbox;\r\n  end;\r\n\r\n  TJSHTMLScriptElement = Class external name 'HTMLScriptElement' (TJSHTMLElement)\r\n  Public\r\n    type_ : String external name 'type';\r\n    src : String;\r\n    charset : string;\r\n    integrity : string;\r\n    async : boolean;\r\n    defer : boolean;\r\n    text : string;\r\n    crossOrigin : string;\r\n    referrerPolicy : string;\r\n    noModule : boolean;\r\n  end;\r\n\r\n\r\n\r\n\r\n  TJSXMLHttpRequestEventTarget = class external name 'XMLHttpRequestEventTarget' (TJSEventTarget)\r\n  end;\r\n\r\n  TJSXMLHttpRequestUpload = class external name 'XMLHttpRequestUpload' (TJSXMLHttpRequestEventTarget)\r\n  end;\r\n\r\n  { TJSXMLHttpRequest }\r\n  TJSOnReadyStateChangeHandler = reference to procedure; safecall;\r\n\r\n  TJSXMLHttpRequest = class external name 'XMLHttpRequest' (TJSXMLHttpRequestEventTarget)\r\n  private\r\n    FReadyState: NativeInt; external name 'readyState';\r\n    FResponse: JSValue; external name 'response';\r\n    FResponseText: string; external name 'responseText';\r\n    FResponseType: string; external name 'responseType';\r\n    FresponseURL: string; external name 'responseURL';\r\n    FresponseXML: TJSDocument; external name 'responseXML';\r\n    FUpload: TJSXMLHttpRequestUpload; external name 'upload';\r\n    FStatus : integer; external name 'status';\r\n    FStatusText : string; external name 'statusText';\r\n  public\r\n    const\r\n      UNSENT           = 0;\r\n      OPENED           = 1;\r\n      HEADERS_RECEIVED = 2;\r\n      LOADING          = 3;\r\n      DONE             = 4;\r\n  public\r\n    timeout : LongWord;\r\n    withCredentials : Boolean;\r\n    onreadystatechange : TJSOnReadyStateChangeHandler;\r\n    constructor new;\r\n    procedure abort;\r\n    function getResponseHeader(aName : string) : String;\r\n    function getAllResponseHeaders : String;\r\n    procedure open(aMethod,aURL : String); overload;\r\n    procedure open(aMethod,aURL : String; Async : Boolean); overload;\r\n    procedure open(aMethod,aURL : String; Async : Boolean; AUserame : String); overload;\r\n    procedure open(aMethod,aURL : String; Async : Boolean; AUserame,APassword : String); overload;\r\n    procedure overrideMimeType(aType : String);\r\n    procedure send(aBody : jsValue);overload;\r\n    procedure send;overload;\r\n    procedure setRequestHeader(aName, AValue : string);\r\n\r\n    property readyState : NativeInt read FReadyState;\r\n    property ResponseHeaders[aName : string] : string Read getResponseHeader;\r\n    property responseXML : TJSDocument read FresponseXML;\r\n    property responseURL : string read FresponseURL;\r\n    property responseType : string read FResponseType Write FResponseType;\r\n    property response : JSValue Read FResponse;\r\n    property responseText : string read FResponseText;\r\n    property Status : integer read FStatus;\r\n    property StatusText : string read FStatusText;\r\n    property upload : TJSXMLHttpRequestUpload read FUpload;\r\n\r\n  end;\r\n\r\n  { TJSUIEvent }\r\n\r\n  TJSUIEvent = class external name 'UIEvent' (TJSEvent)\r\n  private\r\n    FDetail: NativeInt; external name 'detail';\r\n    FView: TJSWindow; external name 'view';\r\n  Public\r\n    property detail : NativeInt read FDetail;\r\n    property view : TJSWindow read FView;\r\n  end;\r\n\r\n  { TJSMouseEvent }\r\n\r\n  TJSMouseEvent = class external name 'MouseEvent' (TJSUIevent)\r\n  private\r\n    FAltKey: Boolean; external name 'altKey';\r\n    FBUtton: NativeInt; external name 'button';\r\n    FBUttons: NativeInt; external name 'buttons';\r\n    FClientX: Double; external name 'clientX';\r\n    FClientY: Double; external name 'clientY';\r\n    FCtrlKey: Boolean; external name 'ctrlKey';\r\n    FMetaKey: Boolean; external name 'metaKey';\r\n    FmovementX: Double; external name 'movementX';\r\n    FmovementY: Double; external name 'movementY';\r\n    FoffsetX: Double; external name 'offsetX';\r\n    FoffsetY: Double; external name 'offsetY';\r\n    FRegion: String; external name 'region';\r\n    FRelatedTarget: TJSEventTarget; external name 'relatedTarget';\r\n    FscreenX: Double; external name 'screenX';\r\n    FscreenY: Double; external name 'screenY';\r\n    FShiftKey: Boolean; external name 'shiftKey';\r\n  Public\r\n    function getModifierState(keyArg: String): boolean;\r\n    Property altKey : Boolean read FAltKey;\r\n    Property button: NativeInt read FBUtton;\r\n    Property buttons: NativeInt read FBUttons;\r\n    property clientX : Double read FClientX;\r\n    property clientY : Double read FClientY;\r\n    property ctrlKey : Boolean read FCtrlKey;\r\n    property metaKey : Boolean read FMetaKey;\r\n    property movementX : Double read FmovementX;\r\n    property movementY : Double read FmovementY;\r\n    property offsetX : Double read FoffsetX;\r\n    property offsetY : Double read FoffsetY;\r\n{$IFDEF FIREFOX}\r\n    property pageX : Double read FpageX;\r\n    property pageY : Double read FpageY;\r\n{$ENDIF}\r\n    property region : String read FRegion;\r\n    property relatedTarget : TJSEventTarget read FRelatedTarget;\r\n    property screenX : Double read FscreenX;\r\n    property screenY : Double read FscreenY;\r\n    property shiftKey : Boolean read FShiftKey;\r\n    property x : Double read FClientX;\r\n    property y : Double read FClientY;\r\n  end;\r\n\r\n  { TJSWheelEvent }\r\n  TJSWheelEventInit = record\r\n    deltaX : Double;\r\n    deltaY : Double;\r\n    deltaZ : Double;\r\n    deltaMode : NativeInt;\r\n  end;\r\n\r\n  TJSWheelEvent = class external name 'WheelEvent' (TJSMouseEvent)\r\n  private\r\n    FDeltaMode: NativeInt; external name 'deltaMode';\r\n    FDeltaX: Double; external name 'deltaX';\r\n    FDeltaY: Double; external name 'deltaY';\r\n    FDeltaZ: Double; external name 'deltaZ';\r\n  Public\r\n    constructor new(atype : String); overload;\r\n    constructor new(atype : String; aInit : TJSWheelEventInit); overload;\r\n    Property deltaX : Double Read FDeltaX;\r\n    Property deltaY : Double Read FDeltaY;\r\n    Property deltaZ : Double Read FDeltaZ;\r\n    Property deltaMode : NativeInt Read FDeltaMode;\r\n  end;\r\n\r\n  TJSPointerEvent = Class external name 'PointerEvent' (TJSMouseEvent);\r\n\r\n  TJSTouchEvent = Class external name 'TouchEvent'(TJSUIEvent)\r\n  private\r\n    FAltKey: Boolean; external name 'altKey';\r\n    FChangedTouches: TJSTouchList; external name 'changedTouches';\r\n    FCtrlKey: Boolean; external name 'ctrlKey';\r\n    FMetaKey: Boolean; external name 'metaKey';\r\n    FShiftKey: Boolean; external name 'shiftKey';\r\n    FTargetTouches: TJSTouchList; external name 'targetTouches';\r\n    FTouches: TJSTouchList; external name 'touches';\r\n  Public\r\n    Property altKey : Boolean Read FAltKey;\r\n    Property ctrlKey : Boolean Read FCtrlKey;\r\n    Property metaKey : Boolean Read FMetaKey;\r\n    Property shiftKey : Boolean Read FShiftKey;\r\n    property changedTouches : TJSTouchList Read FChangedTouches;\r\n    property touches : TJSTouchList Read FTouches;\r\n    property targetTouches : TJSTouchList Read FTargetTouches;\r\n  end;\r\n\r\n\r\n  // Namespace for standard key names.\r\n  // See list at https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values\r\n  TJSKeyNames = Class\r\n  Const\r\n    Alt = 'Alt';\r\n    AltGraph = 'AltGraph';\r\n    CapsLock = 'CapsLock';\r\n    Control = 'Control';\r\n    Fn = 'Fn';\r\n    FnLock = 'FnLock';\r\n    Hyper = 'Hyper';\r\n    Meta = 'Meta';\r\n    NumLock = 'NumLock';\r\n    ScrollLock = 'ScrollLock';\r\n    Shift = 'Shift';\r\n    Super = 'Super';\r\n    Symbol = 'Symbol';\r\n    SymbolLock = 'SymbolLock';\r\n    Enter = 'Enter';\r\n    Tab = 'Tab';\r\n    Space = 'Space';\r\n    ArrowDown = 'ArrowDown';\r\n    ArrowLeft = 'ArrowLeft';\r\n    ArrowRight = 'ArrowRight';\r\n    ArrowUp = 'ArrowUp';\r\n    _End = 'End';\r\n    Home = 'Home';\r\n    PageDown = 'PageDown';\r\n    PageUp = 'PageUp';\r\n    BackSpace = 'Backspace';\r\n    Clear = 'Clear';\r\n    Copy = 'Copy';\r\n    CrSel = 'CrSel';\r\n    Cut = 'Cut';\r\n    Delete = 'Delete';\r\n    EraseEof = 'EraseEof';\r\n    ExSel = 'ExSel';\r\n    Insert = 'Insert';\r\n    Paste = 'Paste';\r\n    Redo = 'Redo';\r\n    Undo = 'Undo';\r\n    Accept = 'Accept';\r\n    Again = 'Again';\r\n    Attn = 'Attn';\r\n    Cancel = 'Cancel';\r\n    ContextMenu = 'Contextmenu';\r\n    Escape = 'Escape';\r\n    Execute = 'Execute';\r\n    Find = 'Find';\r\n    Finish = 'Finish';\r\n    Help = 'Help';\r\n    Pause = 'Pause';\r\n    Play = 'Play';\r\n    Props = 'Props';\r\n    Select = 'Select';\r\n    ZoomIn = 'ZoomIn';\r\n    ZoomOut = 'ZoomOut';\r\n    BrightnessDown = 'BrightnessDown';\r\n    BrightnessUp = 'BrightnessUp';\r\n    Eject = 'Eject';\r\n    LogOff = 'LogOff';\r\n    Power = 'Power';\r\n    PowerOff = 'PowerOff';\r\n    PrintScreen = 'PrintScreen';\r\n    Hibernate = 'Hibernate';\r\n    Standby = 'Standby';\r\n    WakeUp = 'WakeUp';\r\n    AllCandidates = 'AllCandidates';\r\n    Alphanumeric =  'Alphanumeric';\r\n    CodeInput = 'CodeInput';\r\n    Compose = 'Compose';\r\n    Convert = 'Convert';\r\n    Dead = 'Dead';\r\n    FinalMode = 'FinalMode';\r\n    GroupFirst = 'GroupFirst';\r\n    GroupLast = 'GroupLast';\r\n    GroupNext = 'GroupNext';\r\n    GroupPrevious = 'GroupPrevious';\r\n    ModelChange = 'ModelChange';\r\n    NextCandidate = 'NextCandidate';\r\n    NonConvert = 'NonConvert';\r\n    PreviousCandidate = 'PreviousCandidate';\r\n    Process = 'Process';\r\n    SingleCandidate = 'SingleCandidate';\r\n    HangulMode = 'HangulMode';\r\n    HanjaMode = 'HanjaMode';\r\n    JunjaMode = 'JunjaMode';\r\n    Eisu = 'Eisu';\r\n    Hankaku = 'Hankaku';\r\n    Hiranga = 'Hiranga';\r\n    HirangaKatakana = 'HirangaKatakana';\r\n    KanaMode = 'KanaMode';\r\n    Katakana = 'Katakana';\r\n    Romaji = 'Romaji';\r\n    Zenkaku = 'Zenkaku';\r\n    ZenkakuHanaku = 'ZenkakuHanaku';\r\n    F1 = 'F1';\r\n    F2 = 'F2';\r\n    F3 = 'F3';\r\n    F4 = 'F4';\r\n    F5 = 'F5';\r\n    F6 = 'F6';\r\n    F7 = 'F7';\r\n    F8 = 'F8';\r\n    F9 = 'F9';\r\n    F10 = 'F10';\r\n    F11 = 'F11';\r\n    F12 = 'F12';\r\n    F13 = 'F13';\r\n    F14 = 'F14';\r\n    F15 = 'F15';\r\n    F16 = 'F16';\r\n    F17 = 'F17';\r\n    F18 = 'F18';\r\n    F19 = 'F19';\r\n    F20 = 'F20';\r\n    Soft1 = 'Soft1';\r\n    Soft2 = 'Soft2';\r\n    Soft3 = 'Soft3';\r\n    Soft4 = 'Soft4';\r\n    Decimal = 'Decimal';\r\n    Key11 = 'Key11';\r\n    Key12 = 'Key12';\r\n    Multiply = 'Multiply';\r\n    Add = 'Add';\r\n    NumClear = 'Clear';\r\n    Divide = 'Divide';\r\n    Subtract = 'Subtract';\r\n    Separator = 'Separator';\r\n    AppSwitch = 'AppSwitch';\r\n    Call = 'Call';\r\n    Camera = 'Camera';\r\n    CameraFocus = 'CameraFocus';\r\n    EndCall = 'EndCall';\r\n    GoBack = 'GoBack';\r\n    GoHome = 'GoHome';\r\n    HeadsetHook = 'HeadsetHook';\r\n    LastNumberRedial = 'LastNumberRedial';\r\n    Notification = 'Notification';\r\n    MannerMode = 'MannerMode';\r\n    VoiceDial = 'VoiceDial';\r\n    // TODO : Multimedia keys\r\n    // TODO : Audio control keys\r\n    // TODO : TV control keys\r\n    // TODO : Media controller keys\r\n    // TODO : Speech recognition keys\r\n    // TODO : Document keys\r\n    // TODO : Application selector keys\r\n    // TODO : Browser Control keys\r\n  end;\r\n\r\n\r\n  { TJSKeyboardEvent }\r\n\r\n  TJSKeyboardEvent = class external name 'KeyboardEvent' (TJSUIEvent)\r\n  private\r\n    FAltKey: Boolean; external name 'altKey';\r\n    FCode: string; external name 'code';\r\n    FCtrlKey: Boolean; external name 'ctrlKey';\r\n    FIsComposing: Boolean;  external name 'isComposing';\r\n    FKey: String; external name 'key';\r\n    FLocale: string; external name 'locale';\r\n    FLocation: NativeInt; external name 'location';\r\n    FMetaKey: Boolean; external name 'metaKey';\r\n    FRepeat: Boolean; external name 'repeat';\r\n    FShiftKey: Boolean; external name 'shiftKey';\r\n  Public\r\n    function getModifierState(aKey : string) : Boolean;\r\n    property code : string read FCode;\r\n    Property altKey : Boolean read FAltKey;\r\n    property ctrlKey : Boolean read FCtrlKey;\r\n    property isComposing : Boolean read FIsComposing;\r\n    property Key : String read FKey;\r\n    property locale : string read FLocale;\r\n    property location : NativeInt read FLocation;\r\n    property metaKey : Boolean read FMetaKey;\r\n    property _repeat : Boolean read FRepeat;\r\n    property shiftKey : Boolean read FShiftKey;\r\n  end;\r\n\r\n  { MutationObserver }\r\n\r\n  TJSMutationObserver = Class;\r\n\r\n  TJSMutationRecord = record\r\n    type_ : string;\r\n    target : TJSNode;\r\n    addedNodes : TJSNodeList;\r\n    removedNodes : TJSNodeList;\r\n    previousSibling : TJSNode;\r\n    nextSibling : TJSNode;\r\n    attributeName : String;\r\n    attributeNamespace : String;\r\n    oldValue : String;\r\n  end;\r\n\r\n  TJSMutationRecordArray = array of TJSMutationRecord;\r\n  TJSMutationCallback = reference to procedure(mutations: TJSMutationRecordArray; observer: TJSMutationObserver); safecall;\r\n\r\n  TJSMutationObserverInit = record\r\n    attributes: boolean;\r\n    attributeOldValue: boolean;\r\n    characterData: boolean;\r\n    characterDataOldValue: boolean;\r\n    childList: boolean;\r\n    subTree: boolean;\r\n    attributeFilter: TJSArray;\r\n  end;\r\n\r\n  TJSMutationObserver = class external name 'MutationObserver' (TJSObject)\r\n  public\r\n    { constructor }\r\n    constructor new(mutationCallback: TJSMutationCallback); overload;\r\n    { public methods }\r\n    procedure observe(target: TJSNode); overload;\r\n    procedure observe(target: TJSNode; options: TJSMutationObserverInit); overload;\r\n    procedure observe(target: TJSNode; options: TJSObject); overload;\r\n    procedure disconnect;\r\n    function takeRecords: TJSMutationRecordArray;\r\n  end;\r\n\r\n  { --------------------------------------------------------------------\r\n    TJSWebSocket\r\n    --------------------------------------------------------------------}\r\n\r\n  TJSMessagePortArray = Array of TJSMessagePort;\r\n\r\n  { TJSInputEvent }\r\n\r\n  TJSInputEvent = class external name 'InputEvent' (TJSUIEvent)\r\n  private\r\n    FData: TJSDOMString; external name 'data';\r\n    FDataTransfer: TJSObject; external name 'dataTransfer';\r\n    FInputType: TJSDOMString; external name 'inputType';\r\n    FIsComposing: Boolean; external name 'isComposing';\r\n  public\r\n    property data: TJSDOMString read FData;\r\n    property dataTransfer: TJSObject read FDataTransfer;\r\n    property inputType: TJSDOMString read FInputType;\r\n    property isComposing: Boolean read FIsComposing;\r\n  end;\r\n\r\n  { TJSMessageEvent }\r\n\r\n  TJSMessageEvent = class external name 'MessageEvent' (TEventListenerEvent)\r\n  private\r\n    FData: JSValue; external name 'data';\r\n    FLastEventID: String; external name 'lastEventID';\r\n    FOrigin: String;  external name 'origin';\r\n    FPorts: TJSMessagePortArray; external name 'ports';\r\n  Public\r\n    Property Data : JSValue Read FData;\r\n    Property LastEventID : String Read FLastEventID;\r\n    Property Origin : String Read FOrigin;\r\n    Property Ports : TJSMessagePortArray Read FPorts;\r\n  end;\r\n\r\n  TJSWebSocket = class external name 'WebSocket'  (TJSEventTarget)\r\n  Private\r\n    Furl : String; external name 'url';\r\n    FreadyState : Cardinal; external name 'readyState';\r\n    FbufferedAmount : NativeInt; external name 'bufferedAmount';\r\n    Fextensions : String; external name 'extensions';\r\n    Fprotocol : String; external name 'protocol';\r\n  Public\r\n    Const\r\n      CONNECTING = 0;\r\n      OPEN = 1;\r\n      CLOSING = 2;\r\n      CLOSED = 3;\r\n  Public\r\n    onopen : TJSEventHandler;\r\n    onerror : TJSEventHandler;\r\n    onclose : TJSEventHandler;\r\n    onmessage : TJSEventHandler;\r\n    binaryType : String;\r\n    constructor new(url : String); overload;\r\n    constructor new(url : String; protocol: String); overload;\r\n    constructor new(url : String; protocols: array of String); overload;\r\n    Procedure close; overload;\r\n    Procedure close(code : Cardinal); overload;\r\n    Procedure close(code : Cardinal; reason : String); overload;\r\n    Procedure send(data : String);\r\n    Procedure send(data : TJSBlob);\r\n    Procedure send(data : TJSArrayBuffer);\r\n    Procedure send(data : TJSTypedArray);\r\n    Property url : String Read Furl;\r\n    Property readyState : Cardinal Read FreadyState;\r\n    Property bufferedAmount : NativeInt Read FbufferedAmount;\r\n    Property extensions : String Read Fextensions;\r\n    Property protocol : String Read Fprotocol;\r\n  end;\r\n\r\n  TJSHTMLAudioTrack = class external name 'AudioTrack' (TJSObject)\r\n  end;\r\n\r\n  TJSHTMLAudioTrackList = class external name 'AudioTrackList' (TJSObject)\r\n    FLength : Integer; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSHTMLAudioTrack ; external name '[]';\r\n  Public\r\n    onaddtrack : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onremovetrack : TJSEventHandler;\r\n    Property Length : Integer Read FLength;\r\n    Property tracks [aIndex : NativeInt] : TJSHTMLAudioTrack read Getitem;\r\n  end;\r\n\r\n  TJSHTMLVideoTrack = class external name 'VideoTrack' (TJSObject)\r\n  end;\r\n\r\n  TJSHTMLVideoTrackList = class external name 'VideoTrackList' (TJSObject)\r\n    FLength : Integer; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSHTMLVideoTrack ; external name '[]';\r\n  Public\r\n    onaddtrack : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onremovetrack : TJSEventHandler;\r\n    Property Length : Integer Read FLength;\r\n    Property tracks [aIndex : NativeInt] : TJSHTMLVideoTrack read Getitem;\r\n  end;\r\n\r\n  TJSHTMLTextTrack = class external name 'TextTrack' (TJSObject)\r\n  end;\r\n\r\n  TJSHTMLTextTrackList = class external name 'TextTrackList' (TJSObject)\r\n    FLength : Integer; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSHTMLTextTrack ; external name '[]';\r\n  Public\r\n    onaddtrack : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onremovetrack : TJSEventHandler;\r\n    Property Length : Integer Read FLength;\r\n    Property tracks [aIndex : NativeInt] : TJSHTMLTextTrack read Getitem;\r\n  end;\r\n\r\n\r\n  { TJSHTMLMediaElement }\r\n  TJSMEdiaError = class external name 'MediaError' (TJSObject)\r\n    code : NativeInt;\r\n    message : string;\r\n  end;\r\n\r\n  TJSHTMLMediaStream = class external name 'MediaStream' (TJSObject);\r\n\r\n  TJSHTMLMediaController = class external name 'MediaController' (TJSObject);\r\n\r\n  TJSHTMLMediaElement = Class external name 'HTMLMediaElement' (TJSHTMLElement)\r\n  private\r\n    FAudioTracks: TJSHTMLAudioTrackList; external name 'audioTracks';\r\n    FVideoTracks: TJSHTMLVideoTrackList; external name 'videoTracks';\r\n    FTextTracks: TJSHTMLTextTrackList; external name 'textTracks';\r\n    FControlsList: TJSDOMTokenList; external name 'controlslist';\r\n    FCurrentSrc: String; external name 'currentSrc';\r\n    FDuration: Double; external name 'duration';\r\n    FEnded: Boolean;external name 'ended';\r\n    FError: TJSMEdiaError; external name 'error';\r\n    FNetworkState: NativeInt; external name 'networkState';\r\n    FPaused: boolean; external name 'paused';\r\n    FReadyState: NativeInt; external name 'readyState';\r\n    FSeeking: boolean; external name 'seeking';\r\n    FSinkID: string; external name 'sinkId';\r\n  Public\r\n    autoplay : Boolean;\r\n    buffered : Boolean;\r\n    controls : Boolean;\r\n    controller : TJSHTMLMediaController;\r\n    crossOrigin : String;\r\n    currentTime : Double;\r\n    defaultMuted : boolean;\r\n    defaultPlaybackRate : Double;\r\n    disableRemotePlayback : Boolean;\r\n    loop : boolean;\r\n    mediaGroup : string;\r\n    muted : boolean;\r\n    preload : string;\r\n    preservesPitch : boolean;\r\n    src : string;\r\n    srcObject : TJSHTMLMediaStream;\r\n    volume : double;\r\n    onencrypted : TJSEventHandler;\r\n    onwaitingforkey : TJSEventHandler;\r\n    function canPlayType(aType : String) : String;\r\n    Function captureStream : TJSHTMLMediaStream;\r\n    Procedure play;\r\n    Procedure load;\r\n    Procedure pause;\r\n\r\n    Property AudioTracks : TJSHTMLAudioTrackList Read FAudioTracks;\r\n    Property Controlslist : TJSDOMTokenList Read FControlsList;\r\n    Property CurrentSrc : String Read FCurrentSrc;\r\n    Property Duration : Double read FDuration;\r\n    Property Ended : Boolean read FEnded;\r\n    Property Error : TJSMEdiaError read FError;\r\n    property networkState : NativeInt read FNetworkState;\r\n    property paused : boolean read FPaused;\r\n    property readyState : NativeInt read FReadyState;\r\n    property seeking : boolean read FSeeking;\r\n    property sinkID : string read FSinkID;\r\n    Property TextTracks : TJSHTMLTextTrackList Read FTextTracks;\r\n    Property VideoTracks : TJSHTMLVideoTrackList Read FVideoTracks;\r\n  end;\r\n\r\n  TJSHTMLAudioElement = Class external name 'HTMLAudioElement' (TJSHTMLMediaElement)\r\n\r\n  end;\r\n\r\n  TJSHTMLVideoElement = Class external name 'HTMLVideoElement' (TJSHTMLMediaElement)\r\n  end;\r\n\r\n  { TJSHTMLStyleElement }\r\n\r\n  TJSHTMLStyleElement = class external name 'HTMLStyleElement' (TJSHTMLElement)\r\n  private\r\n    FSheet: TJSStyleSheet; external name 'sheet';\r\n  public\r\n    media : string;\r\n    type_ : string; external name 'style';\r\n    disabled : boolean;\r\n    property sheet : TJSStyleSheet read FSheet;\r\n  end;\r\n\r\n\r\n  TJSHTMLDetailsElement = class external name 'HTMLDetailsElement' (TJSHTMLElement)\r\n  strict private\r\n    FOpen: Boolean; external name 'open';\r\n  public\r\n    property Open: Boolean read FOpen write FOpen;\r\n  end;\r\n  \r\n  TJSFormDataEntryValue = String;\r\n  TJSFormDataEntryValueArray = Array of TJSFormDataEntryValue;\r\n\r\n  TJSFormData = Class external name 'FormData' (TJSObject)\r\n    constructor new;\r\n    constructor new(aForm : TJSHTMLElement);\r\n    Procedure append(const aName,aValue : String);\r\n    Procedure append(const aName : String; aBlob : TJSBlob);\r\n    Procedure delete(const aName : String);\r\n    Function entries : TJSFormDataEntryValueArray;\r\n    Function get(const aName : String): TJSFormDataEntryValue;\r\n    function has(const aName : String): Boolean;\r\n    Function keys : TStringDynArray; reintroduce;\r\n    Procedure set_(const aName,aValue : String); external name 'set';\r\n    Procedure set_(const aName : String; aBlob : TJSBlob); external name 'set';\r\n    Function getAll(const aName : String) : TJSFormDataEntryValueArray;\r\n    Function values : TJSValueDynArray; reintroduce;\r\n    Property Entry[const aIndex : String] : TJSFormDataEntryValue read Get;\r\n  end;\r\n\r\n  TJSHTMLTemplateElement = class external name 'HTMLTemplateElement' (TJSHTMLElement)\r\n    content : TJSHTMLElement;\r\n  end;\r\n\r\n    TJSHTMLOrXMLDocument = Class external name 'Document' (TJSDocument)\r\n  end;\r\n\r\n  TJSHTMLDocument = Class external name 'HTMLDocument' (TJSHTMLOrXMLDocument)\r\n  end;\r\n\r\n  TJSXMLDocument = Class external name 'HTMLDocument' (TJSHTMLOrXMLDocument)\r\n  end;\r\n\r\n  TDOMParser = Class external name 'DOMParser' (TJSObject)\r\n  Public\r\n    Function parseFromString (aString,aMimetype : String): TJSHTMLOrXMLDocument;\r\n  end;\r\n\r\n\r\n  TOnChangeProcedure = reference to procedure;\r\n\r\n  TJSPermissionDescriptor = class external name 'Object' (TJSObject)\r\n  public\r\n    name: String;\r\n    userVisibleOnly: Boolean;\r\n    sysex: Boolean;\r\n  end;\r\n\r\n  TJSPermissionStatus = class external name 'PermissionStatus' (TJSObject)\r\n  private\r\n    FState: String; external name 'state';\r\n  public\r\n    onchange: TOnChangeProcedure;\r\n    property state: String read FState;\r\n  end;\r\n\r\n  TJSPermissions = class external name 'Permissions' (TJSObject)\r\n  public\r\n    function query(descriptor: TJSPermissionDescriptor): TJSPermissionStatus; async;\r\n  end;\r\n\r\n  TJSFileSystemHandlePermissionDescriptor = class external name 'Object' (TJSObject)\r\n  public\r\n    mode: String;\r\n  end;\r\n\r\n  TJSFileSystemCreateWritableOptions = class external name 'Object' (TJSObject)\r\n  public\r\n    keepExistingData: Boolean;\r\n  end;\r\n\r\n  TJSFileSystemWritableFileStream = class;\r\n\r\n  TJSFileSystemHandle = class external name 'FileSystemHandle' (TJSObject)\r\n  private\r\n    FKind: String; external name 'kind';\r\n    FName: String; external name 'name';\r\n  public\r\n    function isSameEntry(const Handle: TJSFileSystemHandle): Boolean;\r\n    function queryPermission(descriptor: TJSFileSystemHandlePermissionDescriptor): String;\r\n    function requestPermission(descriptor: TJSFileSystemHandlePermissionDescriptor): String;\r\n\r\n    property kind: String read FKind;\r\n    property name: String read FName;\r\n  end;\r\n\r\n  TJSFileSystemFileHandle = class external name 'FileSystemFileHandle' (TJSFileSystemHandle)\r\n  public\r\n    function getFile: TJSHTMLFile; async;\r\n    function createWritable: TJSFileSystemWritableFileStream; overload;\r\n    function createWritable(options: TJSFileSystemCreateWritableOptions): TJSFileSystemWritableFileStream; overload;\r\n  end;\r\n\r\n  TJSGetFileHandleOptions = class external name 'Object'\r\n  public\r\n    create: Boolean;\r\n\r\n    constructor new;\r\n  end;\r\n\r\n  TJSRemoveEntryOptions = class external name 'Object' (TJSObject)\r\n    recursive: Boolean;\r\n  end;\r\n\r\n  TJSFileSystemDirectoryHandle = class external name 'FileSystemDirectoryHandle' (TJSFileSystemHandle)\r\n  public\r\n    function entries: TJSObject;\r\n    function getDirectoryHandle(name: String): TJSFileSystemDirectoryHandle; async; overload;\r\n    function getDirectoryHandle(name: String; options: TJSGetFileHandleOptions): TJSFileSystemDirectoryHandle; async; overload;\r\n    function getFileHandle(name: String): TJSFileSystemFileHandle; async; overload;\r\n    function getFileHandle(name: String; options: TJSGetFileHandleOptions): TJSFileSystemFileHandle; async; overload;\r\n    function keys: TJSFileSystemDirectoryHandleArray; reintroduce;\r\n    function removeEntry(name: String): TJSPromise;\r\n    function removeEntry(name: String; options: TJSRemoveEntryOptions): TJSPromise;\r\n    function resolve(possibleDescendant: String): TStringDynArray; async;\r\n    function values(possibleDescendant: String): TJSFileSystemDirectoryHandleArray; reintroduce; async;\r\n  end;\r\n\r\n  TJSFileSystemWritableFileStream = class external name 'FileSystemWritableFileStream' (TJSWritableStream)\r\n  public\r\n    function seek(position: NativeInt): TJSPromise;\r\n    function write(data: JSValue): TJSPromise;\r\n    function truncate(size: NativeInt): TJSPromise;\r\n  end;\r\n\r\n  TJSShowOpenFilePickerTypeOptions = class external name 'Object' (TJSObject)\r\n  public\r\n    description: String;\r\n    accept: TJSObject;\r\n  end;\r\n\r\n  TJSShowOpenFilePickerOptions = class external name 'Object' (TJSObject)\r\n  public\r\n    multiple: Boolean;\r\n    excludeAcceptAllOption: Boolean;\r\n    types: array of TJSShowOpenFilePickerTypeOptions;\r\n  end;\r\n\r\n  TJSShowSaveFilePickerOptionsAccept = class external name 'Object' (TJSObject)\r\n  public\r\n    description: String;\r\n    accept: TStringDynArray;\r\n  end;\r\n\r\n  TJSShowSaveFilePickerOptions = class external name 'Object' (TJSObject)\r\n  public\r\n    excludeAcceptAllOption: Boolean;\r\n    accept: array of TJSShowSaveFilePickerOptionsAccept;\r\n  end;\r\n\r\nvar\r\n  document : TJSDocument; external name 'document';\r\n  window : TJSWindow; external name 'window';\r\n  console : TJSConsole; external name 'window.console';\r\n  caches : TJSCacheStorage; external name 'caches';\r\n  serviceWorker : TJSServiceWorker; external name 'self';\r\n\r\nFunction HasServiceWorker : Boolean;\r\n\r\nimplementation\r\n\r\nFunction HasServiceWorker : Boolean;\r\nbegin\r\n  if jsvalue(window.navigator.serviceWorker) then\r\n    exit(true)\r\n  else\r\n    exit(false);\r\nend;\r\n\r\nend.\r\n","unit p2jsres;\r\n\r\n{$mode objfpc}\r\n{$h+}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses types;\r\n\r\nType\r\n  TResourceSource = (rsJS,rsHTML);\r\n  TResourceInfo = record\r\n    name : string;\r\n    encoding : string;\r\n    resourceunit : string;\r\n    format : string;\r\n    data : string;\r\n  end;\r\n  TResourceEnumCallBack = Reference to function(const resName : string) : boolean;\r\n  TResourcesLoadedEnumCallBack = Reference to Procedure(const LoadedResources : Array of String);\r\n  TResourcesLoadErrorCallBack = Reference to Procedure(const aError : string);\r\n\r\nFunction SetResourceSource(aSource : TResourceSource) : TResourceSource;\r\n\r\nFunction GetResourceNames : TStringDynArray;\r\nFunction GetResourceNames(aSource : TResourceSource) : TStringDynArray;\r\n\r\nFunction EnumResources(aCallback : TResourceEnumCallBack) : Integer;\r\nFunction EnumResources(aSource : TResourceSource; aCallback : TResourceEnumCallBack) : Integer;\r\n\r\nFunction GetResourceInfo(Const aName : String; var aInfo : TResourceInfo) : Boolean;\r\nFunction GetResourceInfo(aSource : TResourceSource; Const aName : String; var aInfo : TResourceInfo) : Boolean;\r\n\r\nProcedure LoadHTMLLinkResources(const aURL : String; OnLoad : TResourcesLoadedEnumCallBack = Nil; OnError : TResourcesLoadErrorCallBack = Nil);\r\n\r\nimplementation\r\n\r\nuses sysutils, js, web;\r\n\r\nvar\r\n  gMode: TResourceSource;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Global entry points\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction SeTResourceSource(aSource : TResourceSource) : TResourceSource;\r\nbegin\r\n  Result:=gMode;\r\n  gMode:=aSource;\r\nend;\r\n\r\nFunction GetResourceNames : TStringDynArray;\r\nbegin\r\n  Result:=GetResourceNames(gMode);\r\nend;\r\n\r\nFunction EnumResources(aCallback : TResourceEnumCallBack) : Integer;\r\n\r\nbegin\r\n  Result:=EnumResources(gMode,aCallback);\r\nend;\r\n\r\nFunction GetResourceInfo(Const aName : String; var aInfo : TResourceInfo) : Boolean;\r\n\r\nbegin\r\n  Result:=GetResourceInfo(gMode,aName,aInfo);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  JS resources\r\n  ---------------------------------------------------------------------}\r\n\r\nType\r\n  TRTLResourceInfo = class external name 'Object' (TJSObject)\r\n    name : string;\r\n    encoding : string;\r\n    resourceunit : string; external name 'unit';\r\n    format : string;\r\n    data : string;\r\n  end;\r\n\r\nfunction rtlGetResourceList : TStringDynArray; external name 'rtl.getResourceList';\r\nfunction rtlGetResource(const aName : string) : TRTLResourceInfo; external name 'rtl.getResource';\r\n\r\nFunction GetRTLResourceInfo(Const aName : String; var aInfo : TResourceInfo) : Boolean;\r\n\r\nVar\r\n  RTLInfo : TRTLResourceInfo;\r\n\r\nbegin\r\n  RTLInfo:=rtlGetResource(lowercase(aName));\r\n  Result:=Assigned(RTLInfo);\r\n  if Result then\r\n    begin\r\n    aInfo.name:=RTLinfo.name;\r\n    aInfo.encoding:=RTLinfo.encoding;\r\n    aInfo.format:=RTLinfo.format;\r\n    aInfo.resourceunit:=RTLinfo.resourceunit;\r\n    aInfo.data:=RTLinfo.data;\r\n    end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  HTML resources\r\n  ---------------------------------------------------------------------}\r\n\r\nConst\r\n  IDPrefix = 'resource-';\r\n\r\nFunction IsResourceLink(L : TJSHTMLLinkElement) : Boolean;\r\n\r\nbegin\r\n  Result:=(Copy(L.id,1,Length(IDPrefix))=IDPrefix) and (isDefined(L.Dataset['unit'])) and (Copy(L.href,1,4)='data')\r\nend;\r\n\r\nFunction GetHTMLResources : TStringDynArray;\r\n\r\n\r\nVar\r\n  LC : TJSHTMLCollection;\r\n  L : TJSHTMLLinkElement;\r\n  I : Integer;\r\n  ID : String;\r\n\r\nbegin\r\n  SetLength(Result,0);\r\n  if not isDefined(document) then // If called in Node...\r\n    exit;\r\n  // No cache, we do this dynamically: it's possible to add link nodes at runtime.\r\n  LC:=document.getElementsByTagName('link');\r\n  For I:=0 to LC.length-1 do\r\n    begin\r\n    L:=TJSHTMLLinkElement(LC[i]);\r\n    ID:=L.ID;\r\n    if IsResourceLink(L) then\r\n      begin\r\n      Delete(ID,1,Length(IDPrefix));\r\n      if (ID<>'') then\r\n        TJSArray(Result).Push(ID);\r\n      end;\r\n    end;\r\nend;\r\n\r\nFunction GetHTMLResourceInfo(Const aName : String; var aInfo : TResourceInfo) : Boolean;\r\n\r\nVar\r\n  el : TJSElement;\r\n  L : TJSHTMLLinkElement absolute el;\r\n  S : String;\r\n  I : Integer;\r\n\r\nbegin\r\n  Result:=False;\r\n  if not isDefined(document) then // If called in Node...\r\n    exit;\r\n  El:=document.getElementByID(IDPrefix+lowercase(aName));\r\n  Result:=assigned(el) and SameText(el.tagName,'link');\r\n  if not Result then\r\n    exit;\r\n  ainfo.name:=lowercase(aName);\r\n  ainfo.Resourceunit:=String(L.Dataset['unit']);\r\n  S:=L.href;\r\n  S:=Copy(S,6,Length(S)-5); // strip data;\r\n  I:=Pos(',',S);\r\n  aInfo.data:=Copy(S,I+1,Length(S)-1);\r\n  S:=copy(S,1,I-1);\r\n  I:=Pos(';',S);\r\n  if I=0 then\r\n    aInfo.encoding:=''\r\n  else\r\n    begin\r\n    aInfo.encoding:=Copy(S,I+1,Length(S)-1);\r\n    S:=Copy(S,1,I-1);\r\n    end;\r\n  aInfo.Format:=S;\r\nend;\r\n\r\nFunction HasTemplate : Boolean;\r\n\r\nbegin\r\n  asm\r\n    return ('content' in document.createElement('template'))\r\n  end;\r\n  Result:=false;\r\nend;\r\n\r\n\r\nProcedure LoadHTMLLinkResources(const aURL : String; OnLoad : TResourcesLoadedEnumCallBack = Nil; OnError : TResourcesLoadErrorCallBack = Nil);\r\n\r\n  function FetchOK(Res : JSValue) : JSValue;\r\n  var\r\n    Response : TJSResponse absolute res;\r\n  begin\r\n    Result:=Nil;\r\n    if not Response.ok then\r\n      begin\r\n      if Assigned(OnError) then\r\n        Raise TJSError.New('HTTP Error for URL aURL, status = '+IntToStr(Response.status)+' : '+Response.statusText)\r\n      end\r\n    else\r\n      Result:=Response.Text();\r\n  end;\r\n\r\n  function BlobOK(Res : JSValue) : JSValue;\r\n\r\n  Var\r\n    aText : String absolute res;\r\n    ID : String;\r\n    Tmpl : TJSHTMLTemplateElement;\r\n    El : TJSHTMLElement;\r\n    L : TJSHTMLLinkElement absolute El;\r\n    Arr : TStringDynArray;\r\n    aParent : TJSHTMLElement;\r\n\r\n  begin\r\n    Result:=Nil;\r\n    aParent:=TJSHTMLElement(document.head);\r\n    if aParent=Nil then\r\n      aParent:=TJSHTMLElement(document.body);\r\n    SetLength(Arr,0);\r\n    Tmpl:=TJSHTMLTemplateElement(Document.createElement('template'));\r\n    Tmpl.innerhtml:=TJSString(aText).trim;\r\n    el:=TJSHTMLElement(Tmpl.Content.firstElementChild);\r\n    While El<>Nil do\r\n      begin\r\n      if SameText(El.tagName,'link') and IsResourceLink(L) then\r\n        begin\r\n        aParent.Append(TJSHTMLElement(document.importNode(l,true)));\r\n        ID:=L.ID;\r\n        Delete(ID,1,Length(IDPrefix));\r\n        if (ID<>'') then\r\n          TJSArray(Arr).Push(ID);\r\n        end;\r\n      el:=TJSHTMLElement(el.nextElementSibling);\r\n      end;\r\n    if Assigned(OnLoad) then\r\n      OnLoad(Arr);\r\n  end;\r\n\r\n  function DoError (aValue : JSValue) : JSValue;\r\n\r\n  Var\r\n    aErr : TJSError absolute aValue;\r\n\r\n  begin\r\n    Result:=Nil;\r\n    if Assigned(OnError) then\r\n      if aErr=Nil then\r\n        OnError('Error: ' + aErr.message)\r\n  end;\r\n\r\nbegin\r\n  if not HasTemplate then\r\n    begin\r\n    if Assigned(OnError) then\r\n      OnError('No template support in this browser')\r\n    end\r\n  else\r\n    window.fetch(aURL)._then(@FetchOK)._then(@BlobOK).catch(@doError);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n  Global entries, specifying resource mode\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction GetResourceNames(aSource : TResourceSource) : TStringDynArray;\r\n\r\nbegin\r\n  case aSource of\r\n    rsJS : Result:=rtlGetResourceList;\r\n    rsHTML : Result:=GetHTMLResources;\r\n  end;\r\nend;\r\n\r\nFunction EnumResources(aSource : TResourceSource; aCallback : TResourceEnumCallBack) : Integer;\r\n\r\nVar\r\n  RL : TStringDynArray;\r\n  I : Integer;\r\n  ContinueEnum : Boolean;\r\n\r\nbegin\r\n  Result:=0;\r\n  RL:=GetResourceNames(aSource);\r\n  I:=0;\r\n  Result:=Length(RL);\r\n  ContinueEnum:=True;\r\n  While (I<Result) and ContinueEnum do\r\n    begin\r\n    ContinueEnum:=aCallBack(RL[i]);\r\n    Inc(I);\r\n    end;\r\nend;\r\n\r\n\r\nFunction GetResourceInfo(aSource : TResourceSource; Const aName : String; var aInfo : TResourceInfo) : Boolean;\r\n\r\nbegin\r\n  case aSource of\r\n    rsJS : Result:=GetRTLResourceInfo(aName,aInfo);\r\n    rsHTML : Result:=GetHTMLResourceInfo(aName,aInfo);\r\n  end;\r\nend;\r\n\r\n\r\nend.\r\n","unit simplelinkedlist;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\nType\r\n  TLinkedListItem = Class\r\n  Public\r\n    Next : TLinkedListItem;\r\n  end;\r\n  TLinkedListItemClass = Class of TLinkedListItem;\r\n\r\n  { TLinkedListVisitor }\r\n\r\n  TLinkedListVisitor = Class\r\n    Function Visit(Item : TLinkedListItem) : Boolean; virtual; abstract;\r\n  end;\r\n  { TLinkedList }\r\n\r\n  TLinkedList = Class\r\n  private\r\n    FItemClass: TLinkedListItemClass;\r\n    FRoot: TLinkedListItem;\r\n    function GetCount: Integer;\r\n  Public\r\n    Constructor Create(AnItemClass : TLinkedListItemClass); virtual;\r\n    Destructor Destroy; override;\r\n    Procedure Clear;\r\n    Function Add : TLinkedListItem;\r\n    Procedure ForEach(Visitor: TLinkedListVisitor);\r\n    Procedure RemoveItem(Item : TLinkedListItem; FreeItem : Boolean = False);\r\n    Property Root : TLinkedListItem Read FRoot;\r\n    Property ItemClass : TLinkedListItemClass Read FItemClass;\r\n    Property Count : Integer Read GetCount;\r\n  end;\r\n\r\nimplementation\r\n\r\nuses sysutils;\r\n\r\n{ TLinkedList }\r\n\r\nfunction TLinkedList.GetCount: Integer;\r\n\r\nVar\r\n  I : TLinkedListItem;\r\n\r\nbegin\r\n  I:=FRoot;\r\n  Result:=0;\r\n  While I<>Nil do\r\n    begin\r\n    I:=I.Next;\r\n    Inc(Result);\r\n    end;\r\nend;\r\n\r\nconstructor TLinkedList.Create(AnItemClass: TLinkedListItemClass);\r\nbegin\r\n  FItemClass:=AnItemClass;\r\nend;\r\n\r\ndestructor TLinkedList.Destroy;\r\nbegin\r\n  Clear;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TLinkedList.Clear;\r\n\r\nVar\r\n   I : TLinkedListItem;\r\n\r\nbegin\r\n  // Can't use visitor, because it'd kill the next pointer...\r\n  I:=FRoot;\r\n  While I<>Nil do\r\n    begin\r\n    FRoot:=I;\r\n    I:=I.Next;\r\n    FRoot.Next:=Nil;\r\n    FreeAndNil(FRoot);\r\n    end;\r\nend;\r\n\r\nfunction TLinkedList.Add: TLinkedListItem;\r\nbegin\r\n  Result:=FItemClass.Create;\r\n  Result.Next:=FRoot;\r\n  FRoot:=Result;\r\nend;\r\n\r\nprocedure TLinkedList.ForEach(Visitor : TLinkedListVisitor);\r\n\r\nVar\r\n  I : TLinkedListItem;\r\n\r\nbegin\r\n  I:=FRoot;\r\n  While (I<>Nil) and Visitor.Visit(I) do\r\n    I:=I.Next;\r\nend;\r\n\r\nprocedure TLinkedList.RemoveItem(Item: TLinkedListItem; FreeItem : Boolean = False);\r\n\r\nVar\r\n  I : TLinkedListItem;\r\n\r\nbegin\r\n  If (Item<>Nil) and (FRoot<>Nil) then\r\n    begin\r\n    If (Item=FRoot) then\r\n      FRoot:=Item.Next\r\n    else\r\n      begin\r\n      I:=FRoot;\r\n      While (I.Next<>Nil) and (I.Next<>Item) do\r\n        I:=I.Next;\r\n      If (I.Next=Item) then\r\n        I.Next:=Item.Next;\r\n      end;\r\n    If FreeItem Then\r\n      Item.Free;\r\n    end;\r\nend;\r\n\r\n\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit Classes;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\nuses\r\n  RTLConsts, Types, SysUtils, JS, TypInfo, p2jsres;\r\n\r\ntype\r\n  TNotifyEvent = procedure(Sender: TObject) of object;\r\n  TNotifyEventRef = reference to procedure(Sender: TObject);\r\n  TStringNotifyEventRef = Reference to Procedure(Sender: TObject; Const aString : String);\r\n\r\n  // Notification operations :\r\n  // Observer has changed, is freed, item added to/deleted from list, custom event.\r\n  TFPObservedOperation = (ooChange,ooFree,ooAddItem,ooDeleteItem,ooCustom);\r\n\r\n  EStreamError = class(Exception);\r\n  EFCreateError = class(EStreamError);\r\n  EFOpenError = class(EStreamError);\r\n  EFilerError = class(EStreamError);\r\n  EReadError = class(EFilerError);\r\n  EWriteError = class(EFilerError);\r\n  EClassNotFound = class(EFilerError);\r\n  EMethodNotFound = class(EFilerError);\r\n  EInvalidImage = class(EFilerError);\r\n  EResNotFound = class(Exception);\r\n  EListError = class(Exception);\r\n  EBitsError = class(Exception);\r\n  EStringListError = class(EListError);\r\n  EComponentError = class(Exception);\r\n  EParserError = class(Exception);\r\n  EOutOfResources = class(EOutOfMemory);\r\n  EInvalidOperation = class(Exception);\r\n\r\n  TListAssignOp = (laCopy, laAnd, laOr, laXor, laSrcUnique, laDestUnique);\r\n  TListSortCompare = function(Item1, Item2: JSValue): Integer;\r\n  TListSortCompareFunc = reference to function (Item1, Item2: JSValue): Integer;\r\n  TListCallback = Types.TListCallback;\r\n  TListStaticCallback = Types.TListStaticCallback;\r\n  TAlignment = (taLeftJustify, taRightJustify, taCenter);\r\n\r\n  // Forward class definitions\r\n  TFPList = Class;\r\n  TReader = Class;\r\n  TWriter = Class;\r\n  TFiler = Class;\r\n\r\n  { TFPListEnumerator }\r\n  TFPListEnumerator = class\r\n  private\r\n    FList: TFPList;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(AList: TFPList); reintroduce;\r\n    function GetCurrent: JSValue;\r\n    function MoveNext: Boolean;\r\n    property Current: JSValue read GetCurrent;\r\n  end;\r\n\r\n  { TFPList }\r\n\r\n  TFPList = class(TObject)\r\n  private\r\n    FList: TJSValueDynArray;\r\n    FCount: Integer;\r\n    FCapacity: Integer;\r\n    procedure CopyMove(aList: TFPList);\r\n    procedure MergeMove(aList: TFPList);\r\n    procedure DoCopy(ListA, ListB: TFPList);\r\n    procedure DoSrcUnique(ListA, ListB: TFPList);\r\n    procedure DoAnd(ListA, ListB: TFPList);\r\n    procedure DoDestUnique(ListA, ListB: TFPList);\r\n    procedure DoOr(ListA, ListB: TFPList);\r\n    procedure DoXOr(ListA, ListB: TFPList);\r\n  protected\r\n    function Get(Index: Integer): JSValue; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    procedure Put(Index: Integer; Item: JSValue); {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    procedure SetCapacity(NewCapacity: Integer);\r\n    procedure SetCount(NewCount: Integer);\r\n    Procedure RaiseIndexError(Index: Integer);\r\n  public\r\n    //Type\r\n    //  TDirection = (FromBeginning, FromEnd);\r\n    destructor Destroy; override;\r\n    procedure AddList(AList: TFPList);\r\n    function Add(Item: JSValue): Integer; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    procedure Clear;\r\n    procedure Delete(Index: Integer); {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    class procedure Error(const Msg: string; const Data: String);\r\n    procedure Exchange(Index1, Index2: Integer);\r\n    function Expand: TFPList; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    function Extract(Item: JSValue): JSValue;\r\n    function First: JSValue;\r\n    function GetEnumerator: TFPListEnumerator;\r\n    function IndexOf(Item: JSValue): Integer;\r\n    function IndexOfItem(Item: JSValue; Direction: TDirection): Integer;\r\n    procedure Insert(Index: Integer; Item: JSValue); {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    function Last: JSValue;\r\n    procedure Move(CurIndex, NewIndex: Integer);\r\n    procedure Assign (ListA: TFPList; AOperator: TListAssignOp=laCopy; ListB: TFPList=nil);\r\n    function Remove(Item: JSValue): Integer;\r\n    procedure Pack;\r\n    procedure Sort(const Compare: TListSortCompare);\r\n    procedure SortList(const Compare: TListSortCompareFunc);\r\n    procedure ForEachCall(const proc2call: TListCallback; const arg: JSValue);\r\n    procedure ForEachCall(const proc2call: TListStaticCallback; const arg: JSValue);\r\n    property Capacity: Integer read FCapacity write SetCapacity;\r\n    property Count: Integer read FCount write SetCount;\r\n    property Items[Index: Integer]: JSValue read Get write Put; default;\r\n    property List: TJSValueDynArray read FList;\r\n  end;\r\n\r\n  TListNotification = (lnAdded, lnExtracted, lnDeleted);\r\n  TList = class;\r\n\r\n  { TListEnumerator }\r\n\r\n  TListEnumerator = class\r\n  private\r\n    FList: TList;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(AList: TList); reintroduce;\r\n    function GetCurrent: JSValue;\r\n    function MoveNext: Boolean;\r\n    property Current: JSValue read GetCurrent;\r\n  end;\r\n\r\n  { TList }\r\n\r\n  TList = class(TObject)\r\n  private\r\n    FList: TFPList;\r\n    procedure CopyMove (aList : TList);\r\n    procedure MergeMove (aList : TList);\r\n    procedure DoCopy(ListA, ListB : TList);\r\n    procedure DoSrcUnique(ListA, ListB : TList);\r\n    procedure DoAnd(ListA, ListB : TList);\r\n    procedure DoDestUnique(ListA, ListB : TList);\r\n    procedure DoOr(ListA, ListB : TList);\r\n    procedure DoXOr(ListA, ListB : TList);\r\n  protected\r\n    function Get(Index: Integer): JSValue;\r\n    procedure Put(Index: Integer; Item: JSValue);\r\n    procedure Notify(aValue: JSValue; Action: TListNotification); virtual;\r\n    procedure SetCapacity(NewCapacity: Integer);\r\n    function GetCapacity: integer;\r\n    procedure SetCount(NewCount: Integer);\r\n    function GetCount: integer;\r\n    function GetList: TJSValueDynArray;\r\n    property FPList : TFPList Read FList;\r\n  public\r\n    constructor Create; reintroduce;\r\n    destructor Destroy; override;\r\n    Procedure AddList(AList : TList);\r\n    function Add(Item: JSValue): Integer;\r\n    procedure Clear; virtual;\r\n    procedure Delete(Index: Integer);\r\n    class procedure Error(const Msg: string; Data: String); virtual;\r\n    procedure Exchange(Index1, Index2: Integer);\r\n    function Expand: TList;\r\n    function Extract(Item: JSValue): JSValue;\r\n    function First: JSValue;\r\n    function GetEnumerator: TListEnumerator;\r\n    function IndexOf(Item: JSValue): Integer;\r\n    procedure Insert(Index: Integer; Item: JSValue);\r\n    function Last: JSValue;\r\n    procedure Move(CurIndex, NewIndex: Integer);\r\n    procedure Assign (ListA: TList; AOperator: TListAssignOp=laCopy; ListB: TList=nil);\r\n    function Remove(Item: JSValue): Integer;\r\n    procedure Pack;\r\n    procedure Sort(const Compare: TListSortCompare);\r\n    procedure SortList(const Compare: TListSortCompareFunc);\r\n    property Capacity: Integer read GetCapacity write SetCapacity;\r\n    property Count: Integer read GetCount write SetCount;\r\n    property Items[Index: Integer]: JSValue read Get write Put; default;\r\n    property List: TJSValueDynArray read GetList;\r\n  end;\r\n\r\n  { TPersistent }\r\n  \r\n{$M+}\r\n\r\n  TPersistent = class(TObject)\r\n  private\r\n    //FObservers : TFPList;\r\n    procedure AssignError(Source: TPersistent);\r\n  protected\r\n    procedure DefineProperties(Filer: TFiler); virtual;\r\n    procedure AssignTo(Dest: TPersistent); virtual;\r\n    function GetOwner: TPersistent; virtual;\r\n  public\r\n    procedure Assign(Source: TPersistent); virtual;\r\n    //procedure FPOAttachObserver(AObserver : TObject);\r\n    //procedure FPODetachObserver(AObserver : TObject);\r\n    //procedure FPONotifyObservers(ASender : TObject; AOperation: TFPObservedOperation; Data: TObject);\r\n    function GetNamePath: string; virtual;\r\n    procedure SetEvent(const ALookupRoot: TPersistent; const APropName, AMethodName: string); overload;\r\n    procedure SetEvent(const AInstance: TPersistent; const ALookupRoot: TPersistent; const APropName, AMethodName: string); overload;\r\n  end;\r\n  TPersistentClass = Class of TPersistent;\r\n\r\n  { TInterfacedPersistent }\r\n\r\n  TInterfacedPersistent = class(TPersistent, IInterface)\r\n  private\r\n    FOwnerInterface: IInterface;\r\n  protected\r\n    function _AddRef: Integer; {$IFDEF MAKESTUB}stdcall;{$ENDIF}\r\n    function _Release: Integer; {$IFDEF MAKESTUB}stdcall;{$ENDIF}\r\n  public\r\n    function QueryInterface(const IID: TGUID; out Obj): HRESULT; virtual;{$IFDEF MAKESTUB} stdcall;{$ENDIF}\r\n    procedure AfterConstruction; override;\r\n  end;\r\n\r\n\r\n  TStrings = Class;\r\n  { TStringsEnumerator class }\r\n\r\n  TStringsEnumerator = class\r\n  private\r\n    FStrings: TStrings;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(AStrings: TStrings); reintroduce;\r\n    function GetCurrent: String;\r\n    function MoveNext: Boolean;\r\n    property Current: String read GetCurrent;\r\n  end;\r\n\r\n\r\n  { TStrings class }\r\n  TStrings = class(TPersistent)\r\n  private\r\n    FSpecialCharsInited : boolean;\r\n    FAlwaysQuote: Boolean;\r\n    FQuoteChar : Char;\r\n    FDelimiter : Char;\r\n    FNameValueSeparator : Char;\r\n    FUpdateCount: Integer;\r\n    FLBS : TTextLineBreakStyle;\r\n    FSkipLastLineBreak : Boolean;\r\n    FStrictDelimiter : Boolean;\r\n    FLineBreak : String;\r\n    function GetCommaText: string;\r\n    function GetName(Index: Integer): string;\r\n    function GetValue(const Name: string): string;\r\n    Function GetLBS : TTextLineBreakStyle;\r\n    Procedure SetLBS (AValue : TTextLineBreakStyle);\r\n    procedure SetCommaText(const Value: string);\r\n    procedure SetValue(const Name : String; Const Value: string);\r\n    procedure SetDelimiter(c:Char);\r\n    procedure SetQuoteChar(c:Char);\r\n    procedure SetNameValueSeparator(c:Char);\r\n    procedure DoSetTextStr(const Value: string; DoClear : Boolean);\r\n    Function GetDelimiter : Char;\r\n    Function GetNameValueSeparator : Char;\r\n    Function GetQuoteChar: Char;\r\n    Function GetLineBreak : String;\r\n    procedure SetLineBreak(const S : String);\r\n    Function GetSkipLastLineBreak : Boolean;\r\n    procedure SetSkipLastLineBreak(const AValue : Boolean);\r\n    procedure ReadData(Reader: TReader);\r\n    procedure WriteData(Writer: TWriter);\r\n  protected\r\n    procedure DefineProperties(Filer: TFiler); override;\r\n    procedure Error(const Msg: string; Data: Integer);\r\n    function Get(Index: Integer): string; virtual; abstract;\r\n    function GetCapacity: Integer; virtual;\r\n    function GetCount: Integer; virtual; abstract;\r\n    function GetObject(Index: Integer): TObject; virtual;\r\n    function GetTextStr: string; virtual;\r\n    procedure Put(Index: Integer; const S: string); virtual;\r\n    procedure PutObject(Index: Integer; AObject: TObject); virtual;\r\n    procedure SetCapacity(NewCapacity: Integer); virtual;\r\n    procedure SetTextStr(const Value: string); virtual;\r\n    procedure SetUpdateState(Updating: Boolean); virtual;\r\n    property UpdateCount: Integer read FUpdateCount;\r\n    Function DoCompareText(const s1,s2 : string) : PtrInt; virtual;\r\n    Function GetDelimitedText: string;\r\n    Procedure SetDelimitedText(Const AValue: string);\r\n    Function GetValueFromIndex(Index: Integer): string;\r\n    Procedure SetValueFromIndex(Index: Integer; const Value: string);\r\n    Procedure CheckSpecialChars;\r\n//    Class Function GetNextLine (Const Value : String; Var S : String; Var P : Integer) : Boolean;\r\n    Function GetNextLinebreak (Const Value : String; Out S : String; Var P : Integer) : Boolean;\r\n  public\r\n    constructor Create; reintroduce;\r\n    destructor Destroy; override;\r\n    function ToObjectArray: TObjectDynArray; overload;\r\n    function ToObjectArray(aStart,aEnd : Integer): TObjectDynArray; overload;\r\n    function ToStringArray: TStringDynArray; overload;\r\n    function ToStringArray(aStart,aEnd : Integer): TStringDynArray; overload;\r\n    function Add(const S: string): Integer; virtual; overload;\r\n    function Add(const Fmt : string; const Args : Array of const): Integer; overload;\r\n    function AddFmt(const Fmt : string; const Args : Array of const): Integer;\r\n    function AddObject(const S: string; AObject: TObject): Integer; virtual; overload;\r\n    function AddObject(const Fmt: string; Args : Array of const; AObject: TObject): Integer; overload;\r\n    procedure Append(const S: string);\r\n    procedure AddStrings(TheStrings: TStrings); overload; virtual;\r\n    procedure AddStrings(TheStrings: TStrings; ClearFirst : Boolean); overload;\r\n    procedure AddStrings(const TheStrings: array of string); overload; virtual;\r\n    procedure AddStrings(const TheStrings: array of string; ClearFirst : Boolean); overload;\r\n    function AddPair(const AName, AValue: string): TStrings; overload;\r\n    function AddPair(const AName, AValue: string; AObject: TObject): TStrings; overload;\r\n    Procedure AddText(Const S : String); virtual;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure BeginUpdate;\r\n    procedure Clear; virtual; abstract;\r\n    procedure Delete(Index: Integer); virtual; abstract;\r\n    procedure EndUpdate;\r\n    function Equals(Obj: TObject): Boolean; override; overload;\r\n    function Equals(TheStrings: TStrings): Boolean; overload;\r\n    procedure Exchange(Index1, Index2: Integer); virtual;\r\n    function GetEnumerator: TStringsEnumerator;\r\n    function IndexOf(const S: string): Integer; virtual;\r\n    function IndexOfName(const Name: string): Integer; virtual;\r\n    function IndexOfObject(AObject: TObject): Integer; virtual;\r\n    procedure Insert(Index: Integer; const S: string); virtual; abstract;\r\n    procedure InsertObject(Index: Integer; const S: string; AObject: TObject);\r\n    procedure Move(CurIndex, NewIndex: Integer); virtual;\r\n    procedure GetNameValue(Index : Integer; Out AName,AValue : String);\r\n    Procedure LoadFromURL(Const aURL : String; Async : Boolean = True; OnLoaded : TNotifyEventRef = Nil; OnError: TStringNotifyEventRef = Nil); virtual;\r\n    // Delphi compatibility. Must be an URL\r\n    Procedure LoadFromFile(Const aFileName : String); overload;\r\n    Procedure LoadFromFile(Const aFileName : String; const OnLoaded: TProc; const AError: TProcString); overload;\r\n    function LoadFromFileAsync(const aFileName: string): TJSPromise;\r\n    function  ExtractName(Const S:String):String;\r\n    procedure SaveToFile(const FileName: string); overload; virtual;\r\n    Property TextLineBreakStyle : TTextLineBreakStyle Read GetLBS Write SetLBS;\r\n    property Delimiter: Char read GetDelimiter write SetDelimiter;\r\n    property DelimitedText: string read GetDelimitedText write SetDelimitedText;\r\n    property LineBreak : string Read GetLineBreak write SetLineBreak;\r\n    Property StrictDelimiter : Boolean Read FStrictDelimiter Write FStrictDelimiter;\r\n    property AlwaysQuote: Boolean read FAlwaysQuote write FAlwaysQuote;\r\n    property QuoteChar: Char read GetQuoteChar write SetQuoteChar;\r\n    Property NameValueSeparator : Char Read GetNameValueSeparator Write SetNameValueSeparator;\r\n    property ValueFromIndex[Index: Integer]: string read GetValueFromIndex write SetValueFromIndex;\r\n    property Capacity: Integer read GetCapacity write SetCapacity;\r\n    property CommaText: string read GetCommaText write SetCommaText;\r\n    property Count: Integer read GetCount;\r\n    property Names[Index: Integer]: string read GetName;\r\n    property Objects[Index: Integer]: TObject read GetObject write PutObject;\r\n    property Values[const Name: string]: string read GetValue write SetValue;\r\n    property Strings[Index: Integer]: string read Get write Put; default;\r\n    property Text: string read GetTextStr write SetTextStr;\r\n    Property SkipLastLineBreak : Boolean Read GetSkipLastLineBreak Write SetSkipLastLineBreak;\r\n  end;\r\n\r\n  { TStringList}\r\n  TStringItem = record\r\n     FString: string;\r\n     FObject: TObject;\r\n   end;\r\n\r\n  TStringItemArray = Array of TStringItem;\r\n\r\n  TStringList = class;\r\n  TStringListSortCompare = function(List: TStringList; Index1, Index2: Integer): Integer;\r\n\r\n  TStringsSortStyle = (sslNone,sslUser,sslAuto);\r\n  TStringsSortStyles = Set of TStringsSortStyle;\r\n\r\n  TStringList = class(TStrings)\r\n  private\r\n    FList: TStringItemArray;\r\n    FCount: Integer;\r\n    FOnChange: TNotifyEvent;\r\n    FOnChanging: TNotifyEvent;\r\n    FDuplicates: TDuplicates;\r\n    FCaseSensitive : Boolean;\r\n    FForceSort : Boolean;\r\n    FOwnsObjects : Boolean;\r\n    FSortStyle: TStringsSortStyle;\r\n    procedure ExchangeItemsInt(Index1, Index2: Integer);\r\n    function GetSorted: Boolean;\r\n    procedure Grow;\r\n    procedure InternalClear(FromIndex : Integer = 0; ClearOnly : Boolean = False);\r\n    procedure QuickSort(L, R: Integer; CompareFn: TStringListSortCompare);\r\n    procedure SetSorted(Value: Boolean);\r\n    procedure SetCaseSensitive(b : boolean);\r\n    procedure SetSortStyle(AValue: TStringsSortStyle);\r\n  protected\r\n    Procedure CheckIndex(AIndex : Integer);\r\n    procedure ExchangeItems(Index1, Index2: Integer); virtual;\r\n    procedure Changed; virtual;\r\n    procedure Changing; virtual;\r\n    function Get(Index: Integer): string; override;\r\n    function GetCapacity: Integer; override;\r\n    function GetCount: Integer; override;\r\n    function GetObject(Index: Integer): TObject; override;\r\n    procedure Put(Index: Integer; const S: string); override;\r\n    procedure PutObject(Index: Integer; AObject: TObject); override;\r\n    procedure SetCapacity(NewCapacity: Integer); override;\r\n    procedure SetUpdateState(Updating: Boolean); override;\r\n    procedure InsertItem(Index: Integer; const S: string); virtual;\r\n    procedure InsertItem(Index: Integer; const S: string; O: TObject); virtual;\r\n    Function DoCompareText(const s1,s2 : string) : PtrInt; override;\r\n    function CompareStrings(const s1,s2 : string) : Integer; virtual;\r\n  public\r\n    destructor Destroy; override;\r\n    function Add(const S: string): Integer; override;\r\n    procedure Clear; override;\r\n    procedure Delete(Index: Integer); override;\r\n    procedure Exchange(Index1, Index2: Integer); override;\r\n    function Find(const S: string; Out Index: Integer): Boolean; virtual;\r\n    function IndexOf(const S: string): Integer; override;\r\n    procedure Insert(Index: Integer; const S: string); override;\r\n    procedure Sort; virtual;\r\n    procedure CustomSort(CompareFn: TStringListSortCompare); virtual;\r\n    property Duplicates: TDuplicates read FDuplicates write FDuplicates;\r\n    property Sorted: Boolean read GetSorted write SetSorted;\r\n    property CaseSensitive: Boolean read FCaseSensitive write SetCaseSensitive;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnChanging: TNotifyEvent read FOnChanging write FOnChanging;\r\n    property OwnsObjects : boolean read FOwnsObjects write FOwnsObjects;\r\n    Property SortStyle : TStringsSortStyle Read FSortStyle Write SetSortStyle;\r\n  end;\r\n\r\n  TCollection = class;\r\n\r\n  { TCollectionItem }\r\n\r\n  TCollectionItem = class(TPersistent)\r\n  private\r\n    FCollection: TCollection;\r\n    FID: Integer;\r\n    FUpdateCount: Integer;\r\n    function GetIndex: Integer;\r\n  protected\r\n    procedure SetCollection(Value: TCollection);virtual;\r\n    procedure Changed(AllItems: Boolean);\r\n    function GetOwner: TPersistent; override;\r\n    function GetDisplayName: string; virtual;\r\n    procedure SetIndex(Value: Integer); virtual;\r\n    procedure SetDisplayName(const Value: string); virtual;\r\n    property UpdateCount: Integer read FUpdateCount;\r\n  public\r\n    constructor Create(ACollection: TCollection); virtual; reintroduce;\r\n    destructor Destroy; override;\r\n    function GetNamePath: string; override;\r\n    property Collection: TCollection read FCollection write SetCollection;\r\n    property ID: Integer read FID;\r\n    property Index: Integer read GetIndex write SetIndex;\r\n    property DisplayName: string read GetDisplayName write SetDisplayName;\r\n  end;\r\n\r\n  TCollectionEnumerator = class\r\n  private\r\n    FCollection: TCollection;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(ACollection: TCollection); reintroduce;\r\n    function GetCurrent: TCollectionItem;\r\n    function MoveNext: Boolean;\r\n    property Current: TCollectionItem read GetCurrent;\r\n  end;\r\n\r\n  TCollectionItemClass = class of TCollectionItem;\r\n  TCollectionNotification = (cnAdded, cnExtracting, cnDeleting);\r\n  TCollectionSortCompare = function (Item1, Item2: TCollectionItem): Integer;\r\n  TCollectionSortCompareFunc = reference to function (Item1, Item2: TCollectionItem): Integer;\r\n\r\n  TCollection = class(TPersistent)\r\n  private\r\n    FItemClass: TCollectionItemClass;\r\n    FItems: TFpList;\r\n    FUpdateCount: Integer;\r\n    FNextID: Integer;\r\n    FPropName: string;\r\n    function GetCount: Integer;\r\n    function GetPropName: string;\r\n    procedure InsertItem(Item: TCollectionItem);\r\n    procedure RemoveItem(Item: TCollectionItem);\r\n    procedure DoClear;\r\n  protected\r\n    { Design-time editor support }\r\n    function GetAttrCount: Integer; virtual;\r\n    function GetAttr(Index: Integer): string; virtual;\r\n    function GetItemAttr(Index, ItemIndex: Integer): string; virtual;\r\n    procedure Changed;\r\n    function GetItem(Index: Integer): TCollectionItem;\r\n    procedure SetItem(Index: Integer; Value: TCollectionItem);\r\n    procedure SetItemName(Item: TCollectionItem); virtual;\r\n    procedure SetPropName; virtual;\r\n    procedure Update(Item: TCollectionItem); virtual;\r\n    procedure Notify(Item: TCollectionItem;Action: TCollectionNotification); virtual;\r\n    property PropName: string read GetPropName write FPropName;\r\n    property UpdateCount: Integer read FUpdateCount;\r\n    property FPList : TFPList Read FItems;\r\n  public\r\n    constructor Create(AItemClass: TCollectionItemClass); reintroduce;\r\n    destructor Destroy; override;\r\n    function Owner: TPersistent;\r\n    function Add: TCollectionItem;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure BeginUpdate; virtual;\r\n    procedure Clear;\r\n    procedure EndUpdate; virtual;\r\n    procedure Delete(Index: Integer);\r\n    function GetEnumerator: TCollectionEnumerator;\r\n    function GetNamePath: string; override;\r\n    function Insert(Index: Integer): TCollectionItem;\r\n    function FindItemID(ID: Integer): TCollectionItem;\r\n    procedure Exchange(Const Index1, index2: integer);\r\n    procedure Sort(Const Compare : TCollectionSortCompare);\r\n    procedure SortList(Const Compare : TCollectionSortCompareFunc);\r\n    property Count: Integer read GetCount;\r\n    property ItemClass: TCollectionItemClass read FItemClass;\r\n    property Items[Index: Integer]: TCollectionItem read GetItem write SetItem;\r\n  end;\r\n\r\n  TOwnedCollection = class(TCollection)\r\n  private\r\n    FOwner: TPersistent;\r\n  protected\r\n    Function GetOwner: TPersistent; override;\r\n  public\r\n    Constructor Create(AOwner: TPersistent; AItemClass: TCollectionItemClass); reintroduce;\r\n  end;\r\n\r\n  TComponent = Class;\r\n\r\n  TOperation = (opInsert, opRemove);\r\n\r\n  TComponentStateItem = ( csLoading, csReading, csWriting,  csDestroying,\r\n    csDesigning, csAncestor, csUpdating, csFixups, csFreeNotification,\r\n    csInline, csDesignInstance);\r\n  TComponentState = set of TComponentStateItem;\r\n  TComponentStyleItem = (csInheritable, csCheckPropAvail, csSubComponent, csTransient);\r\n  TComponentStyle = set of TComponentStyleItem;\r\n\r\n  TGetChildProc = procedure (Child: TComponent) of object;\r\n\r\n  TComponentName = string;\r\n\r\n  { TComponentEnumerator }\r\n\r\n  TComponentEnumerator = class\r\n  private\r\n    FComponent: TComponent;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(AComponent: TComponent); reintroduce;\r\n    function GetCurrent: TComponent;\r\n    function MoveNext: Boolean;\r\n    property Current: TComponent read GetCurrent;\r\n  end;\r\n\r\n  TComponent = class(TPersistent, IInterface)\r\n  private\r\n    FOwner: TComponent;\r\n    FName: TComponentName;\r\n    FTag: Ptrint;\r\n    FComponents: TFpList;\r\n    FFreeNotifies: TFpList;\r\n    FDesignInfo: Longint;\r\n    FComponentState: TComponentState;\r\n    function GetComponent(AIndex: Integer): TComponent;\r\n    function GetComponentCount: Integer;\r\n    function GetComponentIndex: Integer;\r\n    procedure Insert(AComponent: TComponent);\r\n    procedure ReadLeft(AReader: TReader);\r\n    procedure ReadTop(AReader: TReader);\r\n    procedure Remove(AComponent: TComponent);\r\n    procedure RemoveNotification(AComponent: TComponent);\r\n    procedure SetComponentIndex(Value: Integer);\r\n    procedure SetReference(Enable: Boolean);\r\n    procedure WriteLeft(AWriter: TWriter);\r\n    procedure WriteTop(AWriter: TWriter);\r\n  protected\r\n    FComponentStyle: TComponentStyle;\r\n    procedure ChangeName(const NewName: TComponentName);\r\n    procedure DefineProperties(Filer: TFiler); override;\r\n    procedure GetChildren(Proc: TGetChildProc; Root: TComponent); virtual;\r\n    function GetChildOwner: TComponent; virtual;\r\n    function GetChildParent: TComponent; virtual;\r\n    function GetOwner: TPersistent; override;\r\n    procedure Loaded; virtual;\r\n    procedure Loading; virtual;\r\n    procedure SetWriting(Value: Boolean); virtual;\r\n    procedure SetReading(Value: Boolean); virtual;\r\n    procedure Notification(AComponent: TComponent;  Operation: TOperation); virtual;\r\n    procedure PaletteCreated; virtual;\r\n    procedure ReadState(Reader: TReader); virtual;\r\n    procedure SetAncestor(Value: Boolean);\r\n    procedure SetDesigning(Value: Boolean; SetChildren : Boolean = True);\r\n    procedure SetDesignInstance(Value: Boolean);\r\n    procedure SetInline(Value: Boolean);\r\n    procedure SetName(const NewName: TComponentName); virtual;\r\n    procedure SetChildOrder(Child: TComponent; Order: Integer); virtual;\r\n    procedure SetParentComponent(Value: TComponent); virtual;\r\n    procedure Updating; virtual;\r\n    procedure Updated; virtual;\r\n    procedure ValidateRename(AComponent: TComponent;  const CurName, NewName: string); virtual;\r\n    procedure ValidateContainer(AComponent: TComponent); virtual;\r\n    procedure ValidateInsert(AComponent: TComponent); virtual;\r\n  protected\r\n    function _AddRef: Integer; {$IFDEF MAKESTUB}stdcall;{$ENDIF}\r\n    FLeft: Integer;\r\n    FTop: Integer;\r\n    function GetLeft: Integer; virtual;\r\n    function GetTop: Integer; virtual;\r\n    procedure SetLeft(AValue: Integer); virtual;\r\n    procedure SetTop(AValue: Integer); virtual;\r\n    function _Release: Integer;  {$IFDEF MAKESTUB}stdcall;{$ENDIF}\r\n  public\r\n    constructor Create(AOwner: TComponent); virtual; reintroduce;\r\n    destructor Destroy; override;\r\n    procedure BeforeDestruction; override;\r\n    procedure DestroyComponents;\r\n    procedure Destroying;\r\n    function QueryInterface(const IID: TGUID; out Obj): HRESULT; virtual;  {$IFDEF MAKESTUB} stdcall;{$ENDIF}\r\n    procedure AfterLoadDFMValues; virtual;\r\n    procedure BeforeLoadDFMValues; virtual;\r\n    procedure BeginUpdate; virtual;\r\n    procedure EndUpdate; virtual;\r\n    procedure WriteState(Writer: TWriter); virtual;\r\n//    function ExecuteAction(Action: TBasicAction): Boolean; virtual;\r\n    function FindComponent(const AName: string): TComponent;\r\n    procedure FreeNotification(AComponent: TComponent);\r\n    procedure RemoveFreeNotification(AComponent: TComponent);\r\n    function GetNamePath: string; override;\r\n    function GetParentComponent: TComponent; virtual;\r\n    function HasParent: Boolean; virtual;\r\n    procedure InsertComponent(AComponent: TComponent);\r\n    procedure RemoveComponent(AComponent: TComponent);\r\n    procedure SetSubComponent(ASubComponent: Boolean);\r\n    function GetEnumerator: TComponentEnumerator;\r\n//    function UpdateAction(Action: TBasicAction): Boolean; dynamic;\r\n    property Components[Index: Integer]: TComponent read GetComponent;\r\n    property ComponentCount: Integer read GetComponentCount;\r\n    property ComponentIndex: Integer read GetComponentIndex write SetComponentIndex;\r\n    property ComponentState: TComponentState read FComponentState;\r\n    property ComponentStyle: TComponentStyle read FComponentStyle;\r\n    property DesignInfo: Longint read FDesignInfo write FDesignInfo;\r\n    property Left: Integer read GetLeft write SetLeft;\r\n    property Owner: TComponent read FOwner;\r\n    property Top: Integer read GetTop write SetTop;\r\n  published\r\n    property Name: TComponentName read FName write SetName stored False;\r\n    property Tag: PtrInt read FTag write FTag default 0;\r\n  end;\r\n  TComponentClass = Class of TComponent;\r\n\r\n  TSeekOrigin = (soBeginning, soCurrent, soEnd);\r\n\r\n  { TStream }\r\n\r\n  TStream = class(TObject)\r\n  private\r\n    FEndian: TEndian;\r\n    function MakeInt(B: TBytes; aSize: Integer; Signed: Boolean): NativeInt;\r\n    function MakeBytes(B: NativeInt; aSize: Integer; Signed: Boolean): TBytes;\r\n  protected\r\n    procedure InvalidSeek; virtual;\r\n    procedure Discard(const Count: NativeInt);\r\n    procedure DiscardLarge(Count: NativeInt; const MaxBufferSize: Longint);\r\n    procedure FakeSeekForward(Offset: NativeInt; const Origin: TSeekOrigin; const Pos: NativeInt);\r\n    function  GetPosition: NativeInt; virtual;\r\n    procedure SetPosition(const Pos: NativeInt); virtual;\r\n    function  GetSize: NativeInt; virtual;\r\n    procedure SetSize(const NewSize: NativeInt); virtual;\r\n    procedure SetSize64(const NewSize: NativeInt); virtual;\r\n    procedure ReadNotImplemented;\r\n    procedure WriteNotImplemented;\r\n    function ReadMaxSizeData(Buffer : TBytes; aSize,aCount : NativeInt) : NativeInt;\r\n    Procedure ReadExactSizeData(Buffer : TBytes; aSize,aCount : NativeInt);\r\n    function WriteMaxSizeData(Const Buffer : TBytes; aSize,aCount : NativeInt) : NativeInt;\r\n    Procedure WriteExactSizeData(Const Buffer : TBytes; aSize,aCount : NativeInt);\r\n  public\r\n    function Read(var Buffer: TBytes; Count: Longint): Longint; overload;\r\n    function Read(Buffer : TBytes; aOffset, Count: Longint): Longint; virtual; abstract; overload;\r\n\r\n    function Write(const Buffer: TBytes; Count: Longint): Longint; virtual; overload;\r\n    function Write(const Buffer: TBytes; Offset, Count: Longint): Longint; virtual; abstract; overload;\r\n\r\n    function Seek(const Offset: NativeInt; Origin: TSeekOrigin): NativeInt; virtual; abstract; overload;\r\n\r\n    function ReadData(Buffer: TBytes; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: Boolean): NativeInt; overload;\r\n    function ReadData(var Buffer: Boolean; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: WideChar): NativeInt; overload;\r\n    function ReadData(var Buffer: WideChar; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: Int8): NativeInt; overload;\r\n    function ReadData(var Buffer: Int8; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: UInt8): NativeInt; overload;\r\n    function ReadData(var Buffer: UInt8; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: Int16): NativeInt; overload;\r\n    function ReadData(var Buffer: Int16; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: UInt16): NativeInt; overload;\r\n    function ReadData(var Buffer: UInt16; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: Int32): NativeInt; overload;\r\n    function ReadData(var Buffer: Int32; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: UInt32): NativeInt; overload;\r\n    function ReadData(var Buffer: UInt32; Count: NativeInt): NativeInt; overload;\r\n    // NativeLargeint. Stored as a float64, Read as float64.\r\n    function ReadData(var Buffer: NativeLargeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: NativeLargeInt; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: NativeLargeUInt): NativeInt; overload;\r\n    function ReadData(var Buffer: NativeLargeUInt; Count: NativeInt): NativeInt; overload;\r\n    // Note: a ReadData with Int64 would be Delphi/FPC incompatible\r\n    function ReadData(var Buffer: Double): NativeInt; overload;\r\n    function ReadData(var Buffer: Double; Count: NativeInt): NativeInt; overload;\r\n    procedure ReadBuffer(var Buffer: TBytes; Count: NativeInt); overload;\r\n    procedure ReadBuffer(var Buffer: TBytes; Offset, Count: NativeInt); overload;\r\n\r\n    procedure ReadBufferData(var Buffer: Boolean); overload;\r\n    procedure ReadBufferData(var Buffer: Boolean; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: WideChar); overload;\r\n    procedure ReadBufferData(var Buffer: WideChar; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: Int8); overload;\r\n    procedure ReadBufferData(var Buffer: Int8; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: UInt8); overload;\r\n    procedure ReadBufferData(var Buffer: UInt8; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: Int16); overload;\r\n    procedure ReadBufferData(var Buffer: Int16; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: UInt16); overload;\r\n    procedure ReadBufferData(var Buffer: UInt16; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: Int32); overload;\r\n    procedure ReadBufferData(var Buffer: Int32; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: UInt32); overload;\r\n    procedure ReadBufferData(var Buffer: UInt32; Count: NativeInt); overload;\r\n    // NativeLargeint. Stored as a float64, Read as float64.\r\n    procedure ReadBufferData(var Buffer: NativeLargeInt); overload;\r\n    procedure ReadBufferData(var Buffer: NativeLargeInt; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: NativeLargeUInt); overload;\r\n    procedure ReadBufferData(var Buffer: NativeLargeUInt; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: Double); overload;\r\n    procedure ReadBufferData(var Buffer: Double; Count: NativeInt); overload;\r\n    procedure WriteBuffer(const Buffer: TBytes; Count: NativeInt); overload;\r\n    procedure WriteBuffer(const Buffer: TBytes; Offset, Count: NativeInt); overload;\r\n\r\n    function WriteData(const Buffer: TBytes; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: Boolean): NativeInt; overload;\r\n    function WriteData(const Buffer: Boolean; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: WideChar): NativeInt; overload;\r\n    function WriteData(const Buffer: WideChar; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: Int8): NativeInt; overload;\r\n    function WriteData(const Buffer: Int8; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: UInt8): NativeInt; overload;\r\n    function WriteData(const Buffer: UInt8; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: Int16): NativeInt; overload;\r\n    function WriteData(const Buffer: Int16; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: UInt16): NativeInt; overload;\r\n    function WriteData(const Buffer: UInt16; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: Int32): NativeInt; overload;\r\n    function WriteData(const Buffer: Int32; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: UInt32): NativeInt; overload;\r\n    function WriteData(const Buffer: UInt32; Count: NativeInt): NativeInt; overload;\r\n    // NativeLargeint. Stored as a float64, Read as float64.\r\n    function WriteData(const Buffer: NativeLargeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: NativeLargeInt; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: NativeLargeUInt): NativeInt; overload;\r\n    function WriteData(const Buffer: NativeLargeUInt; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: Double): NativeInt; overload;\r\n    function WriteData(const Buffer: Double; Count: NativeInt): NativeInt; overload;\r\n{$IFDEF FPC_HAS_TYPE_EXTENDED}\r\n    function WriteData(const Buffer: Extended): NativeInt; overload;\r\n    function WriteData(const Buffer: Extended; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: TExtended80Rec): NativeInt; overload;\r\n    function WriteData(const Buffer: TExtended80Rec; Count: NativeInt): NativeInt; overload;\r\n{$ENDIF}\r\n    procedure WriteBufferData(Buffer: Int32); overload;\r\n    procedure WriteBufferData(Buffer: Int32; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: Boolean); overload;\r\n    procedure WriteBufferData(Buffer: Boolean; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: WideChar); overload;\r\n    procedure WriteBufferData(Buffer: WideChar; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: Int8); overload;\r\n    procedure WriteBufferData(Buffer: Int8; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: UInt8); overload;\r\n    procedure WriteBufferData(Buffer: UInt8; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: Int16); overload;\r\n    procedure WriteBufferData(Buffer: Int16; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: UInt16); overload;\r\n    procedure WriteBufferData(Buffer: UInt16; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: UInt32); overload;\r\n    procedure WriteBufferData(Buffer: UInt32; Count: NativeInt); overload;\r\n    // NativeLargeint. Stored as a float64, Read as float64.\r\n    procedure WriteBufferData(Buffer: NativeLargeInt); overload;\r\n    procedure WriteBufferData(Buffer: NativeLargeInt; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: NativeLargeUInt); overload;\r\n    procedure WriteBufferData(Buffer: NativeLargeUInt; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: Double); overload;\r\n    procedure WriteBufferData(Buffer: Double; Count: NativeInt); overload;\r\n    function CopyFrom(Source: TStream; Count: NativeInt): NativeInt;\r\n    function ReadComponent(Instance: TComponent): TComponent;\r\n    function ReadComponentRes(Instance: TComponent): TComponent;\r\n    procedure WriteComponent(Instance: TComponent);\r\n    procedure WriteComponentRes(const ResName: string; Instance: TComponent);\r\n    procedure WriteDescendent(Instance, Ancestor: TComponent);\r\n    procedure WriteDescendentRes(const ResName: string; Instance, Ancestor: TComponent);\r\n    procedure WriteResourceHeader(const ResName: string; {!!!:out} var FixupInfo: Longint);\r\n    procedure FixupResourceHeader(FixupInfo: Longint);\r\n    procedure ReadResHeader;\r\n    function ReadByte : Byte;\r\n    function ReadWord : Word;\r\n    function ReadDWord : Cardinal;\r\n    function ReadQWord : NativeLargeUInt;\r\n    procedure WriteByte(b : Byte);\r\n    procedure WriteWord(w : Word);\r\n    procedure WriteDWord(d : Cardinal);\r\n    procedure WriteQWord(q : NativeLargeUInt);\r\n    property Position: NativeInt read GetPosition write SetPosition;\r\n    property Size: NativeInt read GetSize write SetSize64;\r\n    Property Endian: TEndian Read FEndian Write FEndian;\r\n  end;\r\n\r\n  { TCustomMemoryStream abstract class }\r\n\r\n  TCustomMemoryStream = class(TStream)\r\n  private\r\n    FMemory: TJSArrayBuffer;\r\n    FDataView : TJSDataView;\r\n    FDataArray : TJSUint8Array;\r\n    FSize, FPosition: PtrInt;\r\n    FSizeBoundsSeek : Boolean;\r\n    function GetDataArray: TJSUint8Array;\r\n    function GetDataView: TJSDataview;\r\n  protected\r\n    Function GetSize : NativeInt; Override;\r\n    function GetPosition: NativeInt; Override;\r\n    procedure SetPointer(Ptr: TJSArrayBuffer; ASize: PtrInt);\r\n    Property DataView : TJSDataview Read GetDataView;\r\n    Property DataArray : TJSUint8Array Read GetDataArray;\r\n  public\r\n    Class Function MemoryToBytes(Mem : TJSArrayBuffer) : TBytes; overload;\r\n    Class Function MemoryToBytes(Mem : TJSUint8Array) : TBytes; overload;\r\n    Class Function BytesToMemory(aBytes : TBytes) : TJSArrayBuffer;\r\n    function Read(Buffer : TBytes; Offset, Count: LongInt): LongInt; override;\r\n    function Seek(const Offset: NativeInt; Origin: TSeekOrigin): NativeInt; override;\r\n    procedure SaveToStream(Stream: TStream);\r\n    Procedure LoadFromURL(Const aURL : String; Async : Boolean = True; OnLoaded : TNotifyEventRef = Nil; OnError: TStringNotifyEventRef = Nil); virtual;\r\n    // Delphi compatibility. Must be an URL\r\n    Procedure LoadFromFile(Const aFileName : String; const OnLoaded : TProc = Nil; const AError: TProcString = Nil);\r\n    property Memory: TJSArrayBuffer read FMemory;\r\n    Property SizeBoundsSeek : Boolean Read FSizeBoundsSeek Write FSizeBoundsSeek;\r\n  end;\r\n\r\n  { TMemoryStream }\r\n\r\n  TMemoryStream = class(TCustomMemoryStream)\r\n  private\r\n    FCapacity: PtrInt;\r\n    procedure SetCapacity(NewCapacity: PtrInt);\r\n  protected\r\n    function Realloc(var NewCapacity: PtrInt): TJSArrayBuffer; virtual;\r\n    property Capacity: PtrInt read FCapacity write SetCapacity;\r\n  public\r\n    destructor Destroy; override;\r\n    procedure Clear;\r\n    procedure LoadFromStream(Stream: TStream);\r\n    procedure SetSize(const NewSize: NativeInt); override;\r\n    function Write(const Buffer: TBytes; Offset, Count: LongInt): LongInt; override;\r\n    function Write(const Buffer: TBytes; Count: LongInt): LongInt; override;\r\n  end;\r\n\r\n{ TBytesStream }\r\n\r\n  TBytesStream = class(TMemoryStream)\r\n  private\r\n    function GetBytes: TBytes;\r\n  public\r\n    constructor Create(const ABytes: TBytes); virtual; overload;\r\n    property Bytes: TBytes read GetBytes;\r\n  end;\r\n\r\n  { TStringStream }\r\n\r\n  TEncoding = class;\r\n\r\n  TStringStream = class(TMemoryStream)\r\n  private\r\n    FEncoding: TEncoding;\r\n    FOwnsEncoding: Boolean;\r\n    function GetDataString : String;\r\n  public\r\n    constructor Create; reintroduce; overload;\r\n    constructor Create(const aString: String); virtual; overload;\r\n    constructor Create(const AString: string; AEncoding: TEncoding; AOwnsEncoding: Boolean = True); overload;\r\n    destructor Destroy; override;\r\n    function ReadString(Count: Integer): string;\r\n    procedure WriteString(const AString: string);\r\n    property DataString: String read GetDataString;\r\n    property Encoding: TEncoding read FEncoding;\r\n  end;\r\n\r\n  TFPResourceHMODULE = THandle;\r\n\r\n  { TResourceStream }\r\n\r\n  TResourceStream = class(TCustomMemoryStream)\r\n  private\r\n    procedure Initialize(aInfo : TResourceInfo);\r\n    procedure Initialize(Instance{%H-}: TFPResourceHMODULE; Name, ResType{%H-}: String);\r\n  public\r\n    constructor Create(aInfo: TResourceInfo);\r\n    constructor Create(Instance: TFPResourceHMODULE; const ResName, ResType : String);\r\n    constructor CreateFromID(Instance: TFPResourceHMODULE; ResID: Integer; ResType: String);\r\n    function Write(const Buffer{%H-}: TBytes; Offset{%H-}, Count{%H-}: LongInt): LongInt; override;\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n\r\n  TFilerFlag = (ffInherited, ffChildPos, ffInline);\r\n  TFilerFlags = set of TFilerFlag;\r\n\r\n  TReaderProc = procedure(Reader: TReader) of object;\r\n  TWriterProc = procedure(Writer: TWriter) of object;\r\n  TStreamProc = procedure(Stream: TStream) of object;\r\n\r\n  TFiler = class(TObject)\r\n  private\r\n    FRoot: TComponent;\r\n    FLookupRoot: TComponent;\r\n    FAncestor: TPersistent;\r\n    FIgnoreChildren: Boolean;\r\n  protected\r\n    procedure SetRoot(ARoot: TComponent); virtual;\r\n  public\r\n    procedure DefineProperty(const Name: string;\r\n      ReadData: TReaderProc; WriteData: TWriterProc;\r\n      HasData: Boolean); virtual; abstract;\r\n    procedure DefineBinaryProperty(const Name: string;\r\n      ReadData, WriteData: TStreamProc;\r\n      HasData: Boolean); virtual; abstract;\r\n    Procedure FlushBuffer; virtual; abstract;\r\n    property Root: TComponent read FRoot write SetRoot;\r\n    property LookupRoot: TComponent read FLookupRoot;\r\n    property Ancestor: TPersistent read FAncestor write FAncestor;\r\n    property IgnoreChildren: Boolean read FIgnoreChildren write FIgnoreChildren;\r\n  end;\r\n\r\n\r\n  TValueType = (\r\n      vaNull, vaList, vaInt8, vaInt16, vaInt32, vaDouble,\r\n      vaString, vaIdent, vaFalse, vaTrue, vaBinary, vaSet,\r\n      vaNil, vaCollection, vaCurrency, vaDate, vaNativeInt\r\n      );\r\n\r\n  { TAbstractObjectReader }\r\n\r\n  TAbstractObjectReader = class\r\n  public\r\n    Procedure FlushBuffer; virtual;\r\n    function NextValue: TValueType; virtual; abstract;\r\n    function ReadValue: TValueType; virtual; abstract;\r\n    procedure BeginRootComponent; virtual; abstract;\r\n    procedure BeginComponent(var Flags: TFilerFlags; var AChildPos: Integer;\r\n      var CompClassName, CompName: String); virtual; abstract;\r\n    function BeginProperty: String; virtual; abstract;\r\n\r\n    //Please don't use read, better use ReadBinary whenever possible\r\n    procedure Read(var Buffer : TBytes; Count: Longint); virtual;abstract;\r\n\r\n    { All ReadXXX methods are called _after_ the value type has been read! }\r\n    procedure ReadBinary(const DestData: TMemoryStream); virtual; abstract;\r\n    function ReadFloat: Extended; virtual; abstract;\r\n    function ReadCurrency: Currency; virtual; abstract;\r\n    function ReadIdent(ValueType: TValueType): String; virtual; abstract;\r\n    function ReadInt8: ShortInt; virtual; abstract;\r\n    function ReadInt16: SmallInt; virtual; abstract;\r\n    function ReadInt32: LongInt; virtual; abstract;\r\n    function ReadNativeInt: NativeInt; virtual; abstract;\r\n    function ReadSet(EnumType: TTypeInfoEnum): Integer; virtual; abstract;\r\n    procedure ReadSignature; virtual; abstract;\r\n    function ReadStr: String; virtual; abstract;\r\n    function ReadString(StringType: TValueType): String; virtual; abstract;\r\n    function ReadWideString: WideString;virtual;abstract;\r\n    function ReadUnicodeString: UnicodeString;virtual;abstract;\r\n    procedure SkipComponent(SkipComponentInfos: Boolean); virtual; abstract;\r\n    procedure SkipValue; virtual; abstract;\r\n  end;\r\n\r\n  { TBinaryObjectReader }\r\n\r\n  TBinaryObjectReader = class(TAbstractObjectReader)\r\n  protected\r\n    FStream: TStream;\r\n    function ReadWord : word;\r\n    function ReadDWord : longword;\r\n    procedure SkipProperty;\r\n    procedure SkipSetBody;\r\n  public\r\n    constructor Create(Stream: TStream);\r\n    function NextValue: TValueType; override;\r\n    function ReadValue: TValueType; override;\r\n    procedure BeginRootComponent; override;\r\n    procedure BeginComponent(var Flags: TFilerFlags; var AChildPos: Integer;\r\n      var CompClassName, CompName: String); override;\r\n    function BeginProperty: String; override;\r\n    //Please don't use read, better use ReadBinary whenever possible\r\n    procedure Read(var Buffer : TBytes; Count: Longint); override;\r\n    procedure ReadBinary(const DestData: TMemoryStream); override;\r\n    function ReadFloat: Extended; override;\r\n    function ReadCurrency: Currency; override;\r\n    function ReadIdent(ValueType: TValueType): String; override;\r\n    function ReadInt8: ShortInt; override;\r\n    function ReadInt16: SmallInt; override;\r\n    function ReadInt32: LongInt; override;\r\n    function ReadNativeInt: NativeInt; override;\r\n    function ReadSet(EnumType: TTypeInfoEnum): Integer; override;\r\n    procedure ReadSignature; override;\r\n    function ReadStr: String; override;\r\n    function ReadString(StringType: TValueType): String; override;\r\n    function ReadWideString: WideString;override;\r\n    function ReadUnicodeString: UnicodeString;override;\r\n    procedure SkipComponent(SkipComponentInfos: Boolean); override;\r\n    procedure SkipValue; override;\r\n  end;\r\n\r\n\r\n  TFindMethodEvent = procedure(Reader: TReader; const MethodName: string;  var Address: CodePointer; var Error: Boolean) of object;\r\n  TSetNameEvent = procedure(Reader: TReader; Component: TComponent;  var Name: string) of object;\r\n  TReferenceNameEvent = procedure(Reader: TReader; var Name: string) of object;\r\n  TAncestorNotFoundEvent = procedure(Reader: TReader; const ComponentName: string; ComponentClass: TPersistentClass; var Component: TComponent) of object;\r\n  TReadComponentsProc = procedure(Component: TComponent) of object;\r\n  TReaderError = procedure(Reader: TReader; const Message: string; var Handled: Boolean) of object;\r\n  TPropertyNotFoundEvent = procedure(Reader: TReader; Instance: TPersistent; var PropName: string; IsPath: boolean; var Handled, Skip: Boolean) of object;\r\n  TFindComponentClassEvent = procedure(Reader: TReader; const ClassName: string; var ComponentClass: TComponentClass) of object;\r\n  TCreateComponentEvent = procedure(Reader: TReader; ComponentClass: TComponentClass; var Component: TComponent) of object;\r\n\r\n  TSetMethodPropertyEvent = procedure(Reader: TReader; Instance: TPersistent; PropInfo: TTypeMemberProperty; const TheMethodName: string;\r\n    var Handled: boolean) of object;\r\n  TReadWriteStringPropertyEvent = procedure(Sender:TObject; const Instance: TPersistent; PropInfo: TTypeMemberProperty; var Content:string) of object;\r\n\r\n\r\n  { TReader }\r\n\r\n  TReader = class(TFiler)\r\n  private\r\n    FDriver: TAbstractObjectReader;\r\n    FOwner: TComponent;\r\n    FParent: TComponent;\r\n    FFixups: TObject;\r\n    FLoaded: TFpList;\r\n    FOnFindMethod: TFindMethodEvent;\r\n    FOnSetMethodProperty: TSetMethodPropertyEvent;\r\n    FOnSetName: TSetNameEvent;\r\n    FOnReferenceName: TReferenceNameEvent;\r\n    FOnAncestorNotFound: TAncestorNotFoundEvent;\r\n    FOnError: TReaderError;\r\n    FOnPropertyNotFound: TPropertyNotFoundEvent;\r\n    FOnFindComponentClass: TFindComponentClassEvent;\r\n    FOnCreateComponent: TCreateComponentEvent;\r\n    FPropName: string;\r\n    FCanHandleExcepts: Boolean;\r\n    FOnReadStringProperty:TReadWriteStringPropertyEvent;\r\n    procedure DoFixupReferences;\r\n    function FindComponentClass(const AClassName: string): TComponentClass;\r\n  protected\r\n    function Error(const Message: string): Boolean; virtual;\r\n    function FindMethod(ARoot: TComponent; const AMethodName: string): CodePointer; virtual;\r\n    procedure ReadProperty(AInstance: TPersistent);\r\n    procedure ReadPropValue(Instance: TPersistent; PropInfo: TTypeMemberProperty);\r\n    procedure PropertyError;\r\n    procedure ReadData(Instance: TComponent);\r\n    property PropName: string read FPropName;\r\n    property CanHandleExceptions: Boolean read FCanHandleExcepts;\r\n    function CreateDriver(Stream: TStream): TAbstractObjectReader; virtual;\r\n  public\r\n    constructor Create(Stream: TStream);\r\n    destructor Destroy; override;\r\n    Procedure FlushBuffer; override;\r\n    procedure BeginReferences;\r\n    procedure CheckValue(Value: TValueType);\r\n    procedure DefineProperty(const Name: string;\r\n      AReadData: TReaderProc; WriteData: TWriterProc;\r\n      HasData: Boolean); override;\r\n    procedure DefineBinaryProperty(const Name: string;\r\n      AReadData, WriteData: TStreamProc;\r\n      HasData: Boolean); override;\r\n    function EndOfList: Boolean;\r\n    procedure EndReferences;\r\n    procedure FixupReferences;\r\n    function NextValue: TValueType;\r\n    //Please don't use read, better use ReadBinary whenever possible\r\n    //uuups, ReadBinary is protected ..\r\n    procedure Read(var Buffer : TBytes; Count: LongInt); virtual;\r\n\r\n    function ReadBoolean: Boolean;\r\n    function ReadChar: Char;\r\n    function ReadWideChar: WideChar;\r\n    function ReadUnicodeChar: UnicodeChar;\r\n    procedure ReadCollection(Collection: TCollection);\r\n    function ReadComponent(Component: TComponent): TComponent;\r\n    procedure ReadComponents(AOwner, AParent: TComponent;\r\n      Proc: TReadComponentsProc);\r\n    function ReadFloat: Extended;\r\n    function ReadCurrency: Currency;\r\n    function ReadIdent: string;\r\n    function ReadInteger: Longint;\r\n    function ReadNativeInt: NativeInt;\r\n    function ReadSet(EnumType: Pointer): Integer;\r\n    procedure ReadListBegin;\r\n    procedure ReadListEnd;\r\n    function ReadRootComponent(ARoot: TComponent): TComponent;\r\n    function ReadVariant: JSValue;\r\n    procedure ReadSignature;\r\n    function ReadString: string;\r\n    function ReadWideString: WideString;\r\n    function ReadUnicodeString: UnicodeString;\r\n    function ReadValue: TValueType;\r\n    procedure CopyValue(Writer: TWriter);\r\n    property Driver: TAbstractObjectReader read FDriver;\r\n    property Owner: TComponent read FOwner write FOwner;\r\n    property Parent: TComponent read FParent write FParent;\r\n    property OnError: TReaderError read FOnError write FOnError;\r\n    property OnPropertyNotFound: TPropertyNotFoundEvent read FOnPropertyNotFound write FOnPropertyNotFound;\r\n    property OnFindMethod: TFindMethodEvent read FOnFindMethod write FOnFindMethod;\r\n    property OnSetMethodProperty: TSetMethodPropertyEvent read FOnSetMethodProperty write FOnSetMethodProperty;\r\n    property OnSetName: TSetNameEvent read FOnSetName write FOnSetName;\r\n    property OnReferenceName: TReferenceNameEvent read FOnReferenceName write FOnReferenceName;\r\n    property OnAncestorNotFound: TAncestorNotFoundEvent read FOnAncestorNotFound write FOnAncestorNotFound;\r\n    property OnCreateComponent: TCreateComponentEvent read FOnCreateComponent write FOnCreateComponent;\r\n    property OnFindComponentClass: TFindComponentClassEvent read FOnFindComponentClass write FOnFindComponentClass;\r\n    property OnReadStringProperty: TReadWriteStringPropertyEvent read FOnReadStringProperty write FOnReadStringProperty;\r\n  end;\r\n\r\n\r\n  { TAbstractObjectWriter }\r\n\r\n  TAbstractObjectWriter = class\r\n  public\r\n    { Begin/End markers. Those ones who don't have an end indicator, use\r\n      \"EndList\", after the occurrence named in the comment. Note that this\r\n      only counts for \"EndList\" calls on the same level; each BeginXXX call\r\n      increases the current level. }\r\n    procedure BeginCollection; virtual; abstract;  { Ends with the next \"EndList\" }\r\n    procedure BeginComponent(Component: TComponent; Flags: TFilerFlags;\r\n      ChildPos: Integer); virtual; abstract;  { Ends after the second \"EndList\" }\r\n    procedure WriteSignature; virtual; abstract;\r\n    procedure BeginList; virtual; abstract;\r\n    procedure EndList; virtual; abstract;\r\n    procedure BeginProperty(const PropName: String); virtual; abstract;\r\n    procedure EndProperty; virtual; abstract;\r\n    //Please don't use write, better use WriteBinary whenever possible\r\n    procedure Write(const Buffer : TBytes; Count: Longint); virtual;abstract;\r\n    Procedure FlushBuffer; virtual; abstract;\r\n\r\n    procedure WriteBinary(const Buffer : TBytes; Count: Longint); virtual; abstract;\r\n    procedure WriteBoolean(Value: Boolean); virtual; abstract;\r\n    // procedure WriteChar(Value: Char);\r\n    procedure WriteFloat(const Value: Extended); virtual; abstract;\r\n    procedure WriteCurrency(const Value: Currency); virtual; abstract;\r\n    procedure WriteIdent(const Ident: string); virtual; abstract;\r\n    procedure WriteInteger(Value: NativeInt); virtual; abstract;\r\n    procedure WriteNativeInt(Value: NativeInt); virtual; abstract;\r\n    procedure WriteVariant(const Value: JSValue); virtual; abstract;\r\n    procedure WriteMethodName(const Name: String); virtual; abstract;\r\n    procedure WriteSet(Value: LongInt; SetType: Pointer); virtual; abstract;\r\n    procedure WriteString(const Value: String); virtual; abstract;\r\n    procedure WriteWideString(const Value: WideString);virtual;abstract;\r\n    procedure WriteUnicodeString(const Value: UnicodeString);virtual;abstract;\r\n  end;\r\n\r\n  { TBinaryObjectWriter }\r\n\r\n  TBinaryObjectWriter = class(TAbstractObjectWriter)\r\n  protected\r\n    FStream: TStream;\r\n    FBuffer: Pointer;\r\n    FBufSize: Integer;\r\n    FBufPos: Integer;\r\n    FBufEnd: Integer;\r\n    procedure WriteWord(w : word);\r\n    procedure WriteDWord(lw : longword);\r\n    procedure WriteValue(Value: TValueType);\r\n  public\r\n    constructor Create(Stream: TStream);\r\n    procedure WriteSignature; override;\r\n    procedure BeginCollection; override;\r\n    procedure BeginComponent(Component: TComponent; Flags: TFilerFlags;\r\n      ChildPos: Integer); override;\r\n    procedure BeginList; override;\r\n    procedure EndList; override;\r\n    procedure BeginProperty(const PropName: String); override;\r\n    procedure EndProperty; override;\r\n    Procedure FlushBuffer; override;\r\n\r\n    //Please don't use write, better use WriteBinary whenever possible\r\n    procedure Write(const Buffer : TBytes; Count: Longint); override;\r\n    procedure WriteBinary(const Buffer : TBytes; Count: LongInt); override;\r\n    procedure WriteBoolean(Value: Boolean); override;\r\n    procedure WriteFloat(const Value: Extended); override;\r\n    procedure WriteCurrency(const Value: Currency); override;\r\n    procedure WriteIdent(const Ident: string); override;\r\n    procedure WriteInteger(Value: NativeInt); override;\r\n    procedure WriteNativeInt(Value: NativeInt); override;\r\n    procedure WriteMethodName(const Name: String); override;\r\n    procedure WriteSet(Value: LongInt; SetType: Pointer); override;\r\n    procedure WriteStr(const Value: String);\r\n    procedure WriteString(const Value: String); override;\r\n    procedure WriteWideString(const Value: WideString); override;\r\n    procedure WriteUnicodeString(const Value: UnicodeString); override;\r\n    procedure WriteVariant(const VarValue: JSValue);override;\r\n  end;\r\n\r\n  TFindAncestorEvent = procedure (Writer: TWriter; Component: TComponent;\r\n    const Name: string; var Ancestor, RootAncestor: TComponent) of object;\r\n  TWriteMethodPropertyEvent = procedure (Writer: TWriter; Instance: TPersistent;\r\n    PropInfo: TTypeMemberProperty;\r\n    const MethodValue, DefMethodValue: TMethod;\r\n    var Handled: boolean) of object;\r\n\r\n  { TWriter }\r\n\r\n  TWriter = class(TFiler)\r\n  private\r\n    FDriver: TAbstractObjectWriter;\r\n    FDestroyDriver: Boolean;\r\n    FRootAncestor: TComponent;\r\n    FPropPath: String;\r\n    FAncestors: TStringList;\r\n    FAncestorPos: Integer;\r\n    FCurrentPos: Integer;\r\n    FOnFindAncestor: TFindAncestorEvent;\r\n    FOnWriteMethodProperty: TWriteMethodPropertyEvent;\r\n    FOnWriteStringProperty:TReadWriteStringPropertyEvent;\r\n    procedure AddToAncestorList(Component: TComponent);\r\n    procedure WriteComponentData(Instance: TComponent);\r\n    Procedure DetermineAncestor(Component: TComponent);\r\n    procedure DoFindAncestor(Component : TComponent);\r\n  protected\r\n    procedure SetRoot(ARoot: TComponent); override;\r\n    procedure WriteBinary(AWriteData: TStreamProc);\r\n    procedure WriteProperty(Instance: TPersistent; PropInfo: TTypeMemberProperty);\r\n    procedure WriteProperties(Instance: TPersistent);\r\n    procedure WriteChildren(Component: TComponent);\r\n    function CreateDriver(Stream: TStream): TAbstractObjectWriter; virtual;\r\n  public\r\n    constructor Create(ADriver: TAbstractObjectWriter);\r\n    constructor Create(Stream: TStream);\r\n    destructor Destroy; override;\r\n    procedure DefineProperty(const Name: string;\r\n      ReadData: TReaderProc; AWriteData: TWriterProc;\r\n      HasData: Boolean); override;\r\n    procedure DefineBinaryProperty(const Name: string;\r\n      ReadData, AWriteData: TStreamProc;\r\n      HasData: Boolean); override;\r\n    Procedure FlushBuffer; override;\r\n    procedure Write(const Buffer : TBytes; Count: Longint); virtual;\r\n    procedure WriteBoolean(Value: Boolean);\r\n    procedure WriteCollection(Value: TCollection);\r\n    procedure WriteComponent(Component: TComponent);\r\n    procedure WriteChar(Value: Char);\r\n    procedure WriteWideChar(Value: WideChar);\r\n    procedure WriteDescendent(ARoot: TComponent; AAncestor: TComponent);\r\n    procedure WriteFloat(const Value: Extended);\r\n    procedure WriteCurrency(const Value: Currency);\r\n    procedure WriteIdent(const Ident: string);\r\n    procedure WriteInteger(Value: Longint); overload;\r\n    procedure WriteInteger(Value: NativeInt); overload;\r\n    procedure WriteSet(Value: LongInt; SetType: Pointer);\r\n    procedure WriteListBegin;\r\n    procedure WriteListEnd;\r\n    Procedure WriteSignature;\r\n    procedure WriteRootComponent(ARoot: TComponent);\r\n    procedure WriteString(const Value: string);\r\n    procedure WriteWideString(const Value: WideString);\r\n    procedure WriteUnicodeString(const Value: UnicodeString);\r\n    procedure WriteVariant(const VarValue: JSValue);\r\n    property RootAncestor: TComponent read FRootAncestor write FRootAncestor;\r\n    property OnFindAncestor: TFindAncestorEvent read FOnFindAncestor write FOnFindAncestor;\r\n    property OnWriteMethodProperty: TWriteMethodPropertyEvent read FOnWriteMethodProperty write FOnWriteMethodProperty;\r\n    property OnWriteStringProperty: TReadWriteStringPropertyEvent read FOnWriteStringProperty write FOnWriteStringProperty;\r\n\r\n    property Driver: TAbstractObjectWriter read FDriver;\r\n    property PropertyPath: string read FPropPath;\r\n  end;\r\n\r\n  TParserToken = (toUnknown,  // everything else\r\n                  toEOF,      // EOF\r\n                  toSymbol,   // Symbol (identifier)\r\n                  toString,   // ''string''\r\n                  toInteger,  // 123\r\n                  toFloat,    // 12.3\r\n                  toMinus,    // -\r\n                  toSetStart, // [\r\n                  toListStart, // (\r\n                  toCollectionStart, // <\r\n                  toBinaryStart, // {\r\n                  toSetEnd, // ]\r\n                  toListEnd, // )\r\n                  toCollectionEnd, // >\r\n                  toBinaryEnd, // }\r\n                  toComma, // ,\r\n                  toDot, // .\r\n                  toEqual, // =\r\n                  toColon, // :\r\n                  toPlus // +\r\n                  );\r\n\r\n  TParser = class(TObject)\r\n  private\r\n    fStream : TStream;\r\n    fBuf : Array of Char;\r\n    FBufLen : integer;\r\n    fPos : integer;\r\n    fDeltaPos : integer;\r\n    fFloatType : char;\r\n    fSourceLine : integer;\r\n    fToken : TParserToken;\r\n    fEofReached : boolean;\r\n    fLastTokenStr : string;\r\n    function GetTokenName(aTok : TParserToken) : string;\r\n    procedure LoadBuffer;\r\n    procedure CheckLoadBuffer; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    procedure ProcessChar; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    function IsNumber : boolean; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    function IsHexNum : boolean; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    function IsAlpha : boolean; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    function IsAlphaNum : boolean; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    function GetHexValue(c : char) : byte; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    function GetAlphaNum : string;\r\n    procedure HandleNewLine;\r\n    procedure SkipBOM;\r\n    procedure SkipSpaces;\r\n    procedure SkipWhitespace;\r\n    procedure HandleEof;\r\n    procedure HandleAlphaNum;\r\n    procedure HandleNumber;\r\n    procedure HandleHexNumber;\r\n    function HandleQuotedString : string;\r\n    Function HandleDecimalCharacter: char;\r\n    procedure HandleString;\r\n    procedure HandleMinus;\r\n    procedure HandleUnknown;\r\n    procedure GotoToNextChar;\r\n  public\r\n    // Input stream is expected to be UTF16 !\r\n    constructor Create(Stream: TStream);\r\n    destructor Destroy; override;\r\n    procedure CheckToken(T: TParserToken);\r\n    procedure CheckTokenSymbol(const S: string);\r\n    procedure Error(const Ident: string);\r\n    procedure ErrorFmt(const Ident: string; const Args: array of const);\r\n    procedure ErrorStr(const Message: string);\r\n    procedure HexToBinary(Stream: TStream);\r\n    function NextToken: TParserToken;\r\n    function SourcePos: Longint;\r\n    function TokenComponentIdent: string;\r\n    function TokenFloat: Double;\r\n    function TokenInt: NativeInt;\r\n    function TokenString: string;\r\n    function TokenSymbolIs(const S: string): Boolean;\r\n    property FloatType: Char read fFloatType;\r\n    property SourceLine: Integer read fSourceLine;\r\n    property Token: TParserToken read fToken;\r\n  end;\r\n\r\n\r\n  { TObjectStreamConverter }\r\n\r\n  TObjectTextEncoding = (oteDFM,oteLFM);\r\n\r\n  TObjectStreamConverter = Class\r\n  private\r\n     FIndent: String;\r\n     FInput : TStream;\r\n     FOutput : TStream;\r\n     FEncoding : TObjectTextEncoding;\r\n  Private\r\n    FPlainStrings: Boolean;\r\n     // Low level writing\r\n     procedure Outchars(S : String); virtual;\r\n     procedure OutLn(s: String); virtual;\r\n     procedure OutStr(s: String); virtual;\r\n     procedure OutString(s: String); virtual;\r\n     // Low level reading\r\n     function ReadWord: word;\r\n     function ReadDWord: longword;\r\n     function ReadDouble: Double;\r\n     function ReadInt(ValueType: TValueType): NativeInt;\r\n     function ReadInt: NativeInt;\r\n     function ReadNativeInt: NativeInt;\r\n     function ReadStr: String;\r\n     function ReadString(StringType: TValueType): String; virtual;\r\n     // High-level\r\n     procedure ProcessBinary; virtual;\r\n     procedure ProcessValue(ValueType: TValueType; Indent: String); virtual;\r\n     procedure ReadObject(indent: String); virtual;\r\n     procedure ReadPropList(indent: String); virtual;\r\n   Public\r\n     procedure ObjectBinaryToText(aInput, aOutput: TStream);\r\n     procedure ObjectBinaryToText(aInput, aOutput: TStream; aEncoding: TObjectTextEncoding);\r\n     Procedure Execute;\r\n     // use this to get previous streaming behavour: strings written as-is\r\n     Property PlainStrings : Boolean Read FPlainStrings Write FPlainStrings;\r\n     Property Input : TStream Read FInput Write FInput;\r\n     Property Output : TStream Read Foutput Write FOutput;\r\n     Property Encoding : TObjectTextEncoding Read FEncoding Write FEncoding;\r\n     Property Indent : String Read FIndent Write Findent;\r\n   end;\r\n\r\n  { TObjectTextConverter }\r\n\r\n  TObjectTextConverter = Class\r\n  private\r\n    FParser: TParser;\r\n  private\r\n    FInput: TStream;\r\n    Foutput: TStream;\r\n    procedure WriteDouble(e: double);\r\n    procedure WriteDWord(lw: longword);\r\n    procedure WriteInteger(value: nativeInt);\r\n    //procedure WriteLString(const s: String);\r\n    procedure WriteQWord(q: nativeint);\r\n    procedure WriteString(s: String);\r\n    procedure WriteWord(w: word);\r\n    procedure WriteWString(const s: WideString);\r\n    procedure ProcessObject; virtual;\r\n    procedure ProcessProperty; virtual;\r\n    procedure ProcessValue; virtual;\r\n    procedure ProcessWideString(const left: string);\r\n    Property Parser : TParser Read FParser;\r\n  Public\r\n    // Input stream must be UTF16 !\r\n    procedure ObjectTextToBinary(aInput, aOutput: TStream);\r\n    Procedure Execute; virtual;\r\n    Property Input : TStream Read FInput Write FInput;\r\n    Property Output: TStream Read Foutput Write Foutput;\r\n  end;\r\n\r\n  TLoadHelper = Class (TObject)\r\n  Public\r\n  Type\r\n    TTextLoadedCallBack = reference to procedure (const aText : String);\r\n    TBytesLoadedCallBack = reference to procedure (const aBuffer : TJSArrayBuffer);\r\n    TErrorCallBack = reference to procedure (const aError : String);\r\n    Class Procedure LoadText(aURL : String; aSync : Boolean; OnLoaded : TTextLoadedCallBack; OnError : TErrorCallBack); virtual; abstract;\r\n    Class Procedure LoadBytes(aURL : String; aSync : Boolean; OnLoaded : TBytesLoadedCallBack; OnError : TErrorCallBack); virtual; abstract;\r\n  end;\r\n\r\n  TLoadHelperClass = Class of TLoadHelper;\r\n\r\n  { ---------------------------------------------------------------------\r\n      TDatamodule support\r\n    ---------------------------------------------------------------------}\r\n\r\n    { TDataModule }\r\n\r\n    TDataModule = class(TComponent)\r\n    private\r\n      FDPos: TPoint;\r\n      FDSize: TPoint;\r\n      FDPPI: Integer;\r\n      FOnCreate: TNotifyEvent;\r\n      FOnDestroy: TNotifyEvent;\r\n      FOldOrder : Boolean;\r\n      Procedure ReadP(Reader: TReader);\r\n      Procedure WriteP(Writer: TWriter);\r\n      Procedure ReadT(Reader: TReader);\r\n      Procedure WriteT(Writer: TWriter);\r\n      Procedure ReadL(Reader: TReader);\r\n      Procedure WriteL(Writer: TWriter);\r\n      Procedure ReadW(Reader: TReader);\r\n      Procedure WriteW(Writer: TWriter);\r\n      Procedure ReadH(Reader: TReader);\r\n      Procedure WriteH(Writer: TWriter);\r\n    protected\r\n      Procedure DoCreate; virtual;\r\n      Procedure DoDestroy; virtual;\r\n      Procedure DefineProperties(Filer: TFiler); override;\r\n      Procedure GetChildren(Proc: TGetChildProc; Root: TComponent); override;\r\n      Function HandleCreateException: Boolean; virtual;\r\n      Procedure ReadState(Reader: TReader); override;\r\n    public\r\n      constructor Create(AOwner: TComponent); override;\r\n      Constructor CreateNew(AOwner: TComponent);\r\n      Constructor CreateNew(AOwner: TComponent; CreateMode: Integer); virtual;\r\n      class constructor ClassCreate;\r\n      destructor Destroy; override;\r\n      Procedure AfterConstruction; override;\r\n      Procedure BeforeDestruction; override;\r\n      property DesignOffset: TPoint read FDPos write FDPos;\r\n      property DesignSize: TPoint read FDSize write FDSize;\r\n      property DesignPPI: Integer read FDPPI write FDPPI;\r\n    published\r\n      property OnCreate: TNotifyEvent read FOnCreate write FOnCreate;\r\n      property OnDestroy: TNotifyEvent read FOnDestroy write FOnDestroy;\r\n      property OldCreateOrder: Boolean read FOldOrder write FOldOrder;\r\n    end;\r\n    TDataModuleClass = Class of TDataModule;\r\n\r\n\r\ntype\r\n  TIdentMapEntry = record\r\n    Value: Integer;\r\n    Name: String;\r\n  end;\r\n\r\n  TIdentToInt = function(const Ident: string; var Int: Longint): Boolean;\r\n  TIntToIdent = function(Int: Longint; var Ident: string): Boolean;\r\n  TFindGlobalComponent = function(const Name: string): TComponent;\r\n  TInitComponentHandler = function(Instance: TComponent; RootAncestor : TClass): boolean;\r\n\r\n// Start TMS extension----------------------------------------------------------\r\n\r\n  TEncoding = class(TObject)\r\n  strict private class var\r\n    FANSI: TEncoding;\r\n    FUnicode: TEncoding;\r\n    FUTF7: TEncoding;\r\n    FUTF8: TEncoding;\r\n    FASCII: TEncoding;\r\n  protected\r\n    function GetEncoding: string; virtual;\r\n    class function GetANSI: TEncoding;\r\n    class function GetASCII: TEncoding;\r\n    class function GetUTF7: TEncoding;\r\n    class function GetUTF8: TEncoding;\r\n    class function GetUnicode: TEncoding;\r\n  public\r\n    property Encoding: string read GetEncoding;\r\n    class property ANSI: TEncoding read GetANSI;\r\n    class property ASCII: TEncoding read GetASCII;\r\n    class property UTF7: TEncoding read GetUTF7;\r\n    class property UTF8: TEncoding read GetUTF8;\r\n    class property Unicode: TEncoding read GetUnicode;\r\n  end;\r\n\r\n  TStringsHelper = class helper for TStrings\r\n  public\r\n    procedure LoadFromStream(Stream: TStream); overload;\r\n    procedure LoadFromStream(Stream: TStream; Encoding: TEncoding); overload;\r\n    procedure SaveToStream(Stream: TStream); overload;\r\n    procedure SaveToStream(Stream: TStream; Encoding: TEncoding); overload;\r\n  end;\r\n\r\n  TANSIEncoding = class(TEncoding)\r\n  protected\r\n    function GetEncoding: string; override;\r\n  end;\r\n\r\n  TASCIIEncoding = class(TEncoding)\r\n  protected\r\n    function GetEncoding: string; override;\r\n  end;\r\n\r\n  TUTF7Encoding = class(TEncoding)\r\n  protected\r\n    function GetEncoding: string; override;\r\n  end;\r\n\r\n  TUTF8Encoding = class(TEncoding)\r\n  protected\r\n    function GetEncoding: string; override;\r\n  end;\r\n\r\n  TUnicodeEncoding = class(TEncoding)\r\n  protected\r\n    function GetEncoding: string; override;\r\n  end;\r\n\r\n  TPlatformIds = UInt32;\r\n\r\nconst\r\n    TMSPlatformsWeb = 1;\r\n\r\ntype\r\n  ComponentPlatformsAttribute = class(TCustomAttribute)\r\n  private\r\n    FPlatforms: TPlatformIds;\r\n  public\r\n    constructor Create(const Platforms: TPlatformIds);\r\n    property Platforms: TPlatformIds read FPlatforms write FPlatforms;\r\n  end;\r\n\r\n  TShiftState = set of (ssShift, ssAlt, ssCtrl,\r\n    ssLeft, ssRight, ssMIDdle, ssDouble, ssTouch, ssPen, ssCommand);\r\n\r\n// End TMS extension------------------------------------------------------------\r\n\r\n\r\nprocedure RegisterInitComponentHandler(ComponentClass: TComponentClass;   Handler: TInitComponentHandler);\r\nProcedure RegisterClass(AClass : TPersistentClass);\r\nProcedure RegisterClasses(AClasses : specialize TArray<TPersistentClass>);\r\nFunction GetClass(AClassName : string) : TPersistentClass;\r\nprocedure RegisterFindGlobalComponentProc(AFindGlobalComponent: TFindGlobalComponent);\r\nprocedure UnregisterFindGlobalComponentProc(AFindGlobalComponent: TFindGlobalComponent);\r\nfunction FindGlobalComponent(const Name: string): TComponent;\r\nFunction FindNestedComponent(Root : TComponent; APath : String; CStyle : Boolean = True) : TComponent;\r\nfunction InitInheritedComponent(Instance: TComponent; RootAncestor: TClass): Boolean;\r\n\r\nprocedure RedirectFixupReferences(Root: TComponent; const OldRootName, NewRootName: string);\r\nprocedure RemoveFixupReferences(Root: TComponent; const RootName: string);\r\nprocedure RegisterIntegerConsts(IntegerType: Pointer; IdentToIntFn: TIdentToInt;  IntToIdentFn: TIntToIdent);\r\nfunction ExtractStrings(Separators, WhiteSpace: TSysCharSet; Content: String; Strings: TStrings; AddEmptyStrings : Boolean = False): Integer;\r\nfunction IdentToInt(const Ident: string; out Int: Longint; const Map: array of TIdentMapEntry): Boolean;\r\nfunction IntToIdent(Int: Longint; var Ident: string; const Map: array of TIdentMapEntry): Boolean;\r\nfunction FindIntToIdent(AIntegerType: Pointer): TIntToIdent;\r\nfunction FindIdentToInt(AIntegerType: Pointer): TIdentToInt;\r\nfunction FindClass(const AClassName: string): TPersistentClass;\r\nfunction CollectionsEqual(C1, C2: TCollection): Boolean;\r\nfunction CollectionsEqual(C1, C2: TCollection; Owner1, Owner2: TComponent): Boolean;\r\nprocedure GetFixupReferenceNames(Root: TComponent; Names: TStrings);\r\nprocedure GetFixupInstanceNames(Root: TComponent; const ReferenceRootName: string; Names: TStrings);\r\nprocedure ObjectBinaryToText(aInput, aOutput: TStream);\r\nprocedure ObjectBinaryToText(aInput, aOutput: TStream; aEncoding: TObjectTextEncoding);\r\nprocedure ObjectTextToBinary(aInput, aOutput: TStream);\r\nFunction SetLoadHelperClass(aClass : TLoadHelperClass) : TLoadHelperClass;\r\n// Create buffer from string. aLen in bytes, not in characters\r\nFunction StringToBuffer(aString : String; aLen : Integer) : TJSArrayBuffer;\r\nFunction StringToBuffer(aString : String; aLen : Integer; AEncoding: TEncoding) : TJSArrayBuffer;\r\n// Create buffer from string. aPos,aLen are in bytes, not in characters.\r\nFunction BufferToString(aBuffer : TJSArrayBuffer; aPos,aLen : Integer) : String;\r\nFunction BufferToString(aBuffer : TJSArrayBuffer; aPos,aLen : Integer; AEncoding: TEncoding) : String;\r\n\r\nprocedure BeginGlobalLoading;\r\nprocedure NotifyGlobalLoading;\r\nprocedure EndGlobalLoading;\r\n\r\nType\r\n  TDataModuleNotifyEvent = procedure (DataModule: TDataModule) of object;\r\n  TExceptionNotifyEvent = procedure (E: Exception) of object;\r\n\r\nvar\r\n  // IDE hooks for TDatamodule support.\r\n  AddDataModule              : TDataModuleNotifyEvent;\r\n  RemoveDataModule           : TDataModuleNotifyEvent;\r\n  ApplicationHandleException : TNotifyEvent;\r\n  ApplicationShowException   : TExceptionNotifyEvent;\r\n  FormResourceIsText : Boolean = True;\r\n\r\nConst\r\n  // Some aliases\r\n  vaSingle = vaDouble;\r\n  vaExtended = vaDouble;\r\n  vaLString = vaString;\r\n  vaUTF8String = vaString;\r\n  vaUString = vaString;\r\n  vaWString = vaString;\r\n  vaQWord = vaNativeInt;\r\n  vaInt64 = vaNativeInt;\r\n  toWString = toString;\r\n\r\nimplementation\r\n\r\nuses web, simplelinkedlist;\r\n\r\ntype\r\n  TReqLoadProc = reference to procedure(AResponse: string);\r\n  TReqErrorProc = reference to procedure;\r\n\r\nvar\r\n  GlobalLoaded,\r\n  IntConstList: TFPList;\r\n  GlobalLoadHelper : TLoadHelperClass;\r\n\r\nprocedure BeginGlobalLoading;\r\nbegin\r\n  GlobalLoaded := TFPList.Create;\r\nend;\r\n\r\nprocedure NotifyGlobalLoading;\r\nvar\r\n  I: Integer;\r\n  G: TFPList;\r\nbegin\r\n  G := GlobalLoaded;\r\n  for I := 0 to G.Count - 1 do\r\n    TComponent(G[I]).Loaded;\r\nend;\r\n\r\nprocedure EndGlobalLoading;\r\nbegin\r\n  GlobalLoaded.Free;\r\nend;\r\n\r\nFunction SetLoadHelperClass(aClass : TLoadHelperClass) : TLoadHelperClass;\r\n\r\nbegin\r\n  Result:=GlobalLoadHelper;\r\n  GlobalLoadHelper:=aClass;\r\nend;\r\n\r\nProcedure CheckLoadHelper;\r\n\r\nbegin\r\n  If (GlobalLoadHelper=Nil) then\r\n    Raise EInOutError.Create('No support for loading URLS. Include Rtl.BrowserLoadHelper in your project uses clause');\r\nend;\r\n\r\nFunction StringToBuffer(aString : String; aLen : Integer) : TJSArrayBuffer;\r\nbegin\r\n  Result := StringToBuffer(aString, aLen, TEncoding.UTF8);\r\nend;\r\n\r\nFunction StringToBuffer(aString : String; aLen : Integer; AEncoding: TEncoding) : TJSArrayBuffer;\r\n\r\nvar\r\n   I : Integer;\r\n\r\nbegin\r\n  if AEncoding = TEncoding.Unicode then\r\n  begin\r\n    Result:=TJSArrayBuffer.new(aLen*2);// 2 bytes for each char\r\n\r\n    With TJSUint16Array.new(Result) do\r\n      for i:=0 to aLen-1 do\r\n        values[i] := TJSString(aString).charCodeAt(i);\r\n  end\r\n  else\r\n  begin\r\n    Result:=TJSArrayBuffer.new(aLen);// 1 bytes for each char\r\n\r\n    With TJSUint8Array.new(Result) do\r\n      for i:=0 to aLen-1 do\r\n        values[i] := TJSString(aString).charCodeAt(i);\r\n  end;\r\nend;\r\n\r\nfunction BufferToString(aBuffer: TJSArrayBuffer; aPos, aLen: Integer): String;\r\nbegin\r\n  Result := BufferToString(aBuffer, aPos, aLen, TEncoding.UTF8);\r\nend;\r\n\r\nfunction BufferToString(aBuffer: TJSArrayBuffer; aPos, aLen: Integer; AEncoding: TEncoding): String;\r\nvar\r\n  ua16 : TJSUint16Array;\r\n  ua8: TJSUint8Array;\r\n\r\nbegin\r\n  Result:=''; // Silence warning\r\n  if AEncoding = TEncoding.Unicode then\r\n  begin\r\n    ua16:=TJSUint16Array.New(aBuffer.slice(aPos,aLen));\r\n    if ua16<>nil then\r\n      Result:=String(TJSFunction(@TJSString.fromCharCode).apply(nil,TJSValueDynArray(JSValue(ua16))));\r\n  end\r\n  else\r\n  begin\r\n    ua8:=TJSUint8Array.New(aBuffer.slice(aPos,aLen));\r\n    if ua8<>nil then\r\n      Result:=String(TJSFunction(@TJSString.fromCharCode).apply(nil,TJSValueDynArray(JSValue(ua8))));\r\n  end;\r\n\r\nend;\r\n\r\nfunction CreateComponentfromRes(const res : string; Inst : THandle; var Component : TComponent) : Boolean;\r\n\r\nvar\r\n  ResStream : TResourceStream;\r\n\r\n  Src : TStream;\r\n  aInfo : TResourceInfo;\r\n\r\nbegin\r\n  if Inst=0 then ;\r\n  result:=GetResourceInfo(Res,aInfo);\r\n  if Result then\r\n    begin\r\n    ResStream:=TResourceStream.Create(aInfo);\r\n    try\r\n      if Not FormResourceIsText then\r\n        Src:=ResStream\r\n      else\r\n        begin\r\n        Src:=TMemoryStream.Create;\r\n        ObjectTextToBinary(ResStream,Src);\r\n        Src.Position:=0;\r\n        end;\r\n      Component:=Src.ReadComponent(Component);\r\n    finally\r\n      if Src<>ResStream then\r\n        Src.Free;\r\n      ResStream.Free;\r\n    end;\r\n    end;\r\nend;\r\n\r\nfunction DefaultInitHandler(Instance: TComponent; RootAncestor: TClass): Boolean;\r\n\r\n  function doinit(_class : TClass) : boolean;\r\n    begin\r\n      result:=false;\r\n      if (_class.ClassType=TComponent) or (_class.ClassType=RootAncestor) then\r\n        exit;\r\n      result:=doinit(_class.ClassParent);\r\n      // Resources are written with their unit name\r\n      result:=CreateComponentfromRes(_class.UnitName,0,Instance) or result;\r\n    end;\r\n\r\nbegin\r\n  result:=doinit(Instance.ClassType);\r\nend;\r\n\r\n{ TResourceStream }\r\n\r\n// We need a polyfill for nodejs.\r\nFunction atob (s : String) : string; external name 'atob';\r\n\r\nprocedure TResourceStream.Initialize(aInfo: TResourceInfo);\r\n\r\nvar\r\n  Ptr : TJSArrayBuffer;\r\n  S : String;\r\n\r\nbegin\r\n  if aInfo.encoding='base64' then\r\n    S:=atob(aInfo.Data)\r\n  else if (aInfo.Encoding='text') then\r\n    s:=aInfo.Data\r\n  else\r\n    Raise ENotSupportedException.CreateFmt(SErrResourceNotBase64,[aInfo.name]);\r\n  Ptr:=StringToBuffer(S, length(S));\r\n  SetPointer(Ptr,Ptr.byteLength);\r\nend;\r\n\r\nprocedure TResourceStream.Initialize(Instance: TFPResourceHMODULE; Name, ResType: String);\r\n\r\nVar\r\n  aInfo : TResourceInfo;\r\n\r\nbegin\r\n  if not GetResourceInfo(Name, aInfo) then\r\n    raise EResNotFound.CreateFmt(SResNotFound,[Name]);\r\n  Initialize(aInfo);\r\nend;\r\n\r\nconstructor TResourceStream.Create(aInfo: TResourceInfo);\r\nbegin\r\n  inherited create;\r\n  Initialize(aInfo);\r\nend;\r\n\r\nconstructor TResourceStream.Create(Instance: TFPResourceHMODULE; const ResName, ResType: String);\r\nbegin\r\n  inherited create;\r\n  Initialize(Instance,ResName,ResType);\r\nend;\r\n\r\nconstructor TResourceStream.CreateFromID(Instance: TFPResourceHMODULE;\r\n  ResID: Integer; ResType: String);\r\nbegin\r\n  inherited create;\r\n  Initialize(Instance,IntToStr(ResID),ResType);\r\nend;\r\n\r\nfunction TResourceStream.Write(const Buffer: TBytes; Offset, Count: LongInt\r\n  ): LongInt;\r\nbegin\r\n  Raise ENotSupportedException.Create(SErrResourceStreamNoWrite);\r\n  Result:=0;\r\nend;\r\n\r\ndestructor TResourceStream.Destroy;\r\nbegin\r\n  inherited Destroy;\r\nend;\r\n\r\n{ TStringStream }\r\n\r\nfunction TStringStream.GetDataString: String;\r\nconst\r\n  Chunk = 8*1024;\r\nvar\r\n  ua16 : TJSUint16Array;\r\n  ua8: TJSUint8Array;\r\n  Len,I : Integer;\r\n\r\nbegin\r\n  Result:=''; // Silence warning\r\n  if FEncoding = TEncoding.Unicode then\r\n  begin\r\n    ua16:=TJSUint16Array.New(Memory.slice(0,Size));\r\n    if ua16<>nil then\r\n    begin\r\n      Len := (ua16.length div chunk);\r\n      for I := 0 to Len do\r\n      begin\r\n        asm\r\n          Result+=String.fromCharCode.apply(null,ua16.slice(I * Chunk, (I + 1) * Chunk));\r\n        end;\r\n      end;\r\n      // Result=String.fromCharCode.apply(null, ua16);\r\n      end;\r\n   end\r\n   else\r\n   begin\r\n    ua8:=TJSUint8Array.New(Memory.slice(0,Size));\r\n    if ua8<>nil then\r\n      asm\r\n        return ua8.reduce(function (data, byte) {\r\n            return data + String.fromCharCode(byte);\r\n            }, '');\r\n      end;\r\n   end;\r\nend;\r\n\r\nconstructor TStringStream.Create(const AString: string; AEncoding: TEncoding; AOwnsEncoding: Boolean = True); overload;\r\nvar\r\n  Len : Integer;\r\n\r\nbegin\r\n  inherited Create;\r\n  FEncoding := AEncoding;\r\n  Len:=Length(aString);\r\n  if FEncoding = TEncoding.Unicode then\r\n  begin\r\n    SetPointer(StringToBuffer(aString,Len, FEncoding),Len*2);\r\n    FCapacity:=Len*2;\r\n  end\r\n  else\r\n  begin\r\n    SetPointer(StringToBuffer(aString,Len, FEncoding),Len);\r\n    FCapacity:=Len;\r\n  end;\r\nend;\r\n\r\nconstructor TStringStream.Create;\r\nbegin\r\n  Create('', TEncoding.Unicode);\r\nend;\r\n\r\nconstructor TStringStream.Create(const aString: String);\r\nbegin\r\n  Create(aString, TEncoding.Unicode);\r\nend;\r\n\r\ndestructor TStringStream.Destroy;\r\nbegin\r\n  if FOwnsEncoding then\r\n    FEncoding.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TStringStream.ReadString(Count: Integer): string;\r\n\r\n\r\nVar\r\n  B : TBytes;\r\n  Buf : TJSArrayBuffer;\r\n  BytesLeft : Integer;\r\n\r\nbegin\r\n  // Top off\r\n  BytesLeft:=(Size-Position);\r\n  if FEncoding = TEncoding.Unicode then\r\n  begin\r\n    if BytesLeft<Count*2 then\r\n      Count:=BytesLeft;\r\n\r\n    SetLength(B,Count*2);\r\n    ReadBuffer(B,0,Count*2);\r\n    Buf:=BytesToMemory(B);\r\n    Result:=BufferToString(Buf,0,Count*2, FEncoding);\r\n  end\r\n  else\r\n  begin\r\n    if BytesLeft<Count then\r\n      Count:=BytesLeft;\r\n\r\n    SetLength(B,Count);\r\n    ReadBuffer(B,0,Count);\r\n    Buf:=BytesToMemory(B);\r\n    Result:=BufferToString(Buf,0,Count, FEncoding);\r\n  end;\r\nend;\r\n\r\nprocedure TStringStream.WriteString(const AString: string);\r\n\r\nVar\r\n  Buf : TJSArrayBuffer;\r\n  B : TBytes;\r\n\r\nbegin\r\n  Buf:=StringToBuffer(aString,Length(aString), FEncoding);\r\n  B:=MemoryToBytes(Buf);\r\n  WriteBuffer(B,Length(B));\r\nend;\r\n\r\ntype\r\n  TIntConst = class\r\n  Private\r\n    IntegerType: PTypeInfo;             // The integer type RTTI pointer\r\n    IdentToIntFn: TIdentToInt;          // Identifier to Integer conversion\r\n    IntToIdentFn: TIntToIdent;          // Integer to Identifier conversion\r\n  Public\r\n    constructor Create(AIntegerType: PTypeInfo; AIdentToInt: TIdentToInt;\r\n      AIntToIdent: TIntToIdent);\r\n  end;\r\n\r\nconstructor TIntConst.Create(AIntegerType: PTypeInfo; AIdentToInt: TIdentToInt;\r\n  AIntToIdent: TIntToIdent);\r\nbegin\r\n  IntegerType := AIntegerType;\r\n  IdentToIntFn := AIdentToInt;\r\n  IntToIdentFn := AIntToIdent;\r\nend;\r\n\r\nprocedure RegisterIntegerConsts(IntegerType: Pointer; IdentToIntFn: TIdentToInt;\r\n  IntToIdentFn: TIntToIdent);\r\nbegin\r\n  if Not Assigned(IntConstList) then\r\n    IntConstList:=TFPList.Create;\r\n  IntConstList.Add(TIntConst.Create(IntegerType, IdentToIntFn, IntToIdentFn));\r\nend;\r\n\r\nfunction ExtractStrings(Separators, WhiteSpace: TSysCharSet; Content: String; Strings: TStrings; AddEmptyStrings : Boolean = False): Integer;\r\nvar\r\n  b,c : integer;\r\n\r\n  procedure SkipWhitespace;\r\n    begin\r\n      while (Content[c] in Whitespace) do\r\n        inc (C);\r\n    end;\r\n\r\n  procedure AddString;\r\n    var\r\n      l : integer;\r\n\r\n    begin\r\n      l := c-b;\r\n      if (l > 0) or AddEmptyStrings then\r\n        begin\r\n          if assigned(Strings) then\r\n            begin\r\n            if l>0 then\r\n              Strings.Add (Copy(Content,B,L))\r\n            else\r\n              Strings.Add('');\r\n            end;\r\n          inc (result);\r\n        end;\r\n    end;\r\n\r\nvar\r\n  cc,quoted : char;\r\n  aLen : Integer;\r\nbegin\r\n  result := 0;\r\n  c := 1;\r\n  Quoted := #0;\r\n  Separators := Separators + [#13, #10] - ['''','\"'];\r\n  SkipWhitespace;\r\n  b := c;\r\n  aLen:=Length(Content);\r\n  while C<=aLen do\r\n    begin\r\n      CC:=Content[c];\r\n      if (CC = Quoted) then\r\n        begin\r\n          if (C<aLen) and (Content[C+1] = Quoted) then\r\n            inc (c)\r\n          else\r\n            Quoted := #0\r\n        end\r\n      else if (Quoted = #0) and (CC in ['''','\"']) then\r\n        Quoted := CC;\r\n      if (Quoted = #0) and (CC in Separators) then\r\n        begin\r\n          AddString;\r\n          inc (c);\r\n          SkipWhitespace;\r\n          b := c;\r\n        end\r\n      else\r\n        inc (c);\r\n    end;\r\n  if (c <> b) then\r\n    AddString;\r\nend;\r\n\r\n\r\nfunction FindIntToIdent(AIntegerType: Pointer): TIntToIdent;\r\n\r\nvar\r\n  i: Integer;\r\n\r\nbegin\r\n  Result := nil;\r\n  if Not Assigned(IntConstList) then\r\n    exit;\r\n  with IntConstList do\r\n    for i := 0 to Count - 1 do\r\n      if TIntConst(Items[i]).IntegerType = AIntegerType then\r\n        exit(TIntConst(Items[i]).IntToIdentFn);\r\nend;\r\n\r\nfunction FindIdentToInt(AIntegerType: Pointer): TIdentToInt;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  Result := nil;\r\n  if Not Assigned(IntConstList) then\r\n    exit;\r\n  with IntConstList do\r\n    for i := 0 to Count - 1 do\r\n      with TIntConst(Items[I]) do\r\n        if TIntConst(Items[I]).IntegerType = AIntegerType then\r\n          exit(IdentToIntFn);\r\nend;\r\n\r\nfunction IdentToInt(const Ident: String; out Int: LongInt;\r\n  const Map: array of TIdentMapEntry): Boolean;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  for i := Low(Map) to High(Map) do\r\n    if CompareText(Map[i].Name, Ident) = 0 then\r\n    begin\r\n      Int := Map[i].Value;\r\n      exit(True);\r\n    end;\r\n  Result := False;\r\nend;\r\n\r\nfunction IntToIdent(Int: LongInt; var Ident: String;\r\n  const Map: array of TIdentMapEntry): Boolean;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  for i := Low(Map) to High(Map) do\r\n    if Map[i].Value = Int then\r\n      begin\r\n      Ident := Map[i].Name;\r\n      exit(True);\r\n      end;\r\n  Result := False;\r\nend;\r\n\r\nfunction GlobalIdentToInt(const Ident: String; var Int: LongInt):boolean;\r\nvar\r\n  i : Integer;\r\nbegin\r\n  Result := false;\r\n  if Not Assigned(IntConstList) then\r\n    exit;\r\n  with IntConstList do\r\n    for i := 0 to Count - 1 do\r\n      if TIntConst(Items[I]).IdentToIntFn(Ident, Int) then\r\n        Exit(True);\r\nend;\r\n\r\nfunction FindClass(const AClassName: string): TPersistentClass;\r\n\r\nbegin\r\n  Result := GetClass(AClassName);\r\n  if not Assigned(Result) then\r\n    raise EClassNotFound.CreateFmt(SClassNotFound, [AClassName]);\r\nend;\r\n\r\n\r\nfunction CollectionsEqual(C1, C2: TCollection): Boolean;\r\n\r\nVar\r\n  Comp1,Comp2 : TComponent;\r\n\r\nbegin\r\n  Comp2:=Nil;\r\n  Comp1:=TComponent.Create;\r\n  try\r\n    Result:=CollectionsEqual(C1,C2,Comp1,Comp2);\r\n  finally\r\n    Comp1.Free;\r\n    Comp2.Free;\r\n  end;\r\nend;\r\n\r\nfunction CollectionsEqual(C1, C2: TCollection; Owner1, Owner2: TComponent): Boolean;\r\n\r\n  procedure stream_collection(s : tstream;c : tcollection;o : tcomponent);\r\n    var\r\n      w : twriter;\r\n    begin\r\n      w:=twriter.create(s);\r\n      try\r\n        w.root:=o;\r\n        w.flookuproot:=o;\r\n        w.writecollection(c);\r\n      finally\r\n        w.free;\r\n      end;\r\n    end;\r\n\r\n  var\r\n    s1,s2 : tbytesstream;\r\n    b1,b2 : TBytes;\r\n    I,Len : Integer;\r\n  begin\r\n    result:=false;\r\n    if (c1.classtype<>c2.classtype) or\r\n      (c1.count<>c2.count) then\r\n      exit;\r\n    if c1.count = 0 then\r\n      begin\r\n      result:= true;\r\n      exit;\r\n      end;\r\n    s2:=Nil;\r\n    s1:=tbytesstream.create;\r\n    try\r\n      s2:=tbytesstream.create;\r\n      stream_collection(s1,c1,owner1);\r\n      stream_collection(s2,c2,owner2);\r\n      result:=(s1.size=s2.size);\r\n      if Result then\r\n        begin\r\n        b1:=S1.Bytes;\r\n        b2:=S2.Bytes;\r\n        I:=0;\r\n        Len:=S1.Size; // Not length of B\r\n        While Result and (I<Len) do\r\n           begin\r\n           Result:=b1[I]=b2[i];\r\n           Inc(i);\r\n           end;\r\n        end;\r\n    finally\r\n      s2.free;\r\n      s1.free;\r\n    end;\r\n  end;\r\n\r\n\r\n\r\n\r\n{ TInterfacedPersistent }\r\n\r\nfunction TInterfacedPersistent._AddRef: Integer;\r\nbegin\r\n  Result:=-1;\r\n  if Assigned(FOwnerInterface) then\r\n    Result:=FOwnerInterface._AddRef;\r\nend;\r\n\r\nfunction TInterfacedPersistent._Release: Integer;\r\n\r\nbegin\r\n  Result:=-1;\r\n  if Assigned(FOwnerInterface) then\r\n    Result:=FOwnerInterface._Release;\r\nend;\r\n\r\nfunction TInterfacedPersistent.QueryInterface(const IID: TGUID; out Obj): HRESULT;\r\nbegin\r\n  Result:=E_NOINTERFACE;\r\n  if GetInterface(IID, Obj)  then\r\n    Result:=0;\r\nend;\r\n\r\nprocedure TInterfacedPersistent.AfterConstruction;\r\nbegin\r\n  inherited AfterConstruction;\r\n  if (GetOwner<>nil) then\r\n    GetOwner.GetInterface(IInterface, FOwnerInterface);\r\nend;\r\n\r\n{ TComponentEnumerator }\r\n\r\nconstructor TComponentEnumerator.Create(AComponent: TComponent);\r\nbegin\r\n  inherited Create;\r\n  FComponent := AComponent;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TComponentEnumerator.GetCurrent: TComponent;\r\nbegin\r\n  Result := FComponent.Components[FPosition];\r\nend;\r\n\r\nfunction TComponentEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FComponent.ComponentCount;\r\nend;\r\n\r\n{ TListEnumerator }\r\n\r\nconstructor TListEnumerator.Create(AList: TList);\r\nbegin\r\n  inherited Create;\r\n  FList := AList;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TListEnumerator.GetCurrent: JSValue;\r\nbegin\r\n  Result := FList[FPosition];\r\nend;\r\n\r\nfunction TListEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FList.Count;\r\nend;\r\n\r\n{ TFPListEnumerator }\r\n\r\nconstructor TFPListEnumerator.Create(AList: TFPList);\r\nbegin\r\n  inherited Create;\r\n  FList := AList;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TFPListEnumerator.GetCurrent: JSValue;\r\nbegin\r\n  Result := FList[FPosition];\r\nend;\r\n\r\nfunction TFPListEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FList.Count;\r\nend;\r\n\r\n{ TFPList }\r\n\r\nprocedure TFPList.CopyMove(aList: TFPList);\r\nvar r : integer;\r\nbegin\r\n  Clear;\r\n  for r := 0 to aList.count-1 do\r\n    Add(aList[r]);\r\nend;\r\n\r\nprocedure TFPList.MergeMove(aList: TFPList);\r\nvar r : integer;\r\nbegin\r\n  For r := 0 to aList.count-1 do\r\n    if IndexOf(aList[r]) < 0 then\r\n      Add(aList[r]);\r\nend;\r\n\r\nprocedure TFPList.DoCopy(ListA, ListB: TFPList);\r\nbegin\r\n  if Assigned(ListB) then\r\n    CopyMove(ListB)\r\n  else\r\n    CopyMove(ListA);\r\nend;\r\n\r\nprocedure TFPList.DoSrcUnique(ListA, ListB: TFPList);\r\nvar r : integer;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) < 0 then\r\n        Add(ListA[r]);\r\n    end\r\n  else\r\n    begin\r\n    for r := Count-1 downto 0 do\r\n      if ListA.IndexOf(Self[r]) >= 0 then\r\n        Delete(r);\r\n    end;\r\nend;\r\n\r\nprocedure TFPList.DoAnd(ListA, ListB: TFPList);\r\nvar r : integer;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.count-1 do\r\n      if ListB.IndexOf(ListA[r]) >= 0 then\r\n        Add(ListA[r]);\r\n    end\r\n  else\r\n    begin\r\n    for r := Count-1 downto 0 do\r\n      if ListA.IndexOf(Self[r]) < 0 then\r\n        Delete(r);\r\n    end;\r\nend;\r\n\r\nprocedure TFPList.DoDestUnique(ListA, ListB: TFPList);\r\n\r\n  procedure MoveElements(Src, Dest: TFPList);\r\n  var r : integer;\r\n  begin\r\n    Clear;\r\n    for r := 0 to Src.count-1 do\r\n      if Dest.IndexOf(Src[r]) < 0 then\r\n        self.Add(Src[r]);\r\n  end;\r\n\r\nvar Dest : TFPList;\r\nbegin\r\n  if Assigned(ListB) then\r\n    MoveElements(ListB, ListA)\r\n  else\r\n    Dest := TFPList.Create;\r\n    try\r\n      Dest.CopyMove(Self);\r\n      MoveElements(ListA, Dest)\r\n    finally\r\n      Dest.Destroy;\r\n    end;\r\nend;\r\n\r\nprocedure TFPList.DoOr(ListA, ListB: TFPList);\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    CopyMove(ListA);\r\n    MergeMove(ListB);\r\n    end\r\n  else\r\n    MergeMove(ListA);\r\nend;\r\n\r\nprocedure TFPList.DoXOr(ListA, ListB: TFPList);\r\nvar\r\n  r : integer;\r\n  l : TFPList;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) < 0 then\r\n        Add(ListA[r]);\r\n    for r := 0 to ListB.Count-1 do\r\n      if ListA.IndexOf(ListB[r]) < 0 then\r\n        Add(ListB[r]);\r\n    end\r\n  else\r\n    begin\r\n    l := TFPList.Create;\r\n    try\r\n      l.CopyMove(Self);\r\n      for r := Count-1 downto 0 do\r\n        if listA.IndexOf(Self[r]) >= 0 then\r\n          Delete(r);\r\n      for r := 0 to ListA.Count-1 do\r\n        if l.IndexOf(ListA[r]) < 0 then\r\n          Add(ListA[r]);\r\n    finally\r\n      l.Destroy;\r\n    end;\r\n    end;\r\nend;\r\n\r\nfunction TFPList.Get(Index: Integer): JSValue;\r\nbegin\r\n  If (Index < 0) or (Index >= FCount) then\r\n    RaiseIndexError(Index);\r\n  Result:=FList[Index];\r\nend;\r\n\r\nprocedure TFPList.Put(Index: Integer; Item: JSValue);\r\nbegin\r\n  if (Index < 0) or (Index >= FCount) then\r\n    RaiseIndexError(Index);\r\n  FList[Index] := Item;\r\nend;\r\n\r\nprocedure TFPList.SetCapacity(NewCapacity: Integer);\r\nbegin\r\n  If (NewCapacity < FCount) then\r\n     Error (SListCapacityError, str(NewCapacity));\r\n  if NewCapacity = FCapacity then\r\n    exit;\r\n  SetLength(FList,NewCapacity);\r\n  FCapacity := NewCapacity;\r\nend;\r\n\r\nprocedure TFPList.SetCount(NewCount: Integer);\r\nbegin\r\n  if (NewCount < 0) then\r\n    Error(SListCountError, str(NewCount));\r\n  If NewCount > FCount then\r\n    begin\r\n    If NewCount > FCapacity then\r\n      SetCapacity(NewCount);\r\n    end;\r\n  FCount := NewCount;\r\nend;\r\n\r\nprocedure TFPList.RaiseIndexError(Index: Integer);\r\nbegin\r\n  Error(SListIndexError, str(Index));\r\nend;\r\n\r\ndestructor TFPList.Destroy;\r\nbegin\r\n  Clear;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TFPList.AddList(AList: TFPList);\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  If (Capacity<Count+AList.Count) then\r\n    Capacity:=Count+AList.Count;\r\n  For I:=0 to AList.Count-1 do\r\n    Add(AList[i]);\r\nend;\r\n\r\nfunction TFPList.Add(Item: JSValue): Integer;\r\nbegin\r\n  if FCount = FCapacity then\r\n    Expand;\r\n  FList[FCount] := Item;\r\n  Result := FCount;\r\n  Inc(FCount);\r\nend;\r\n\r\nprocedure TFPList.Clear;\r\nbegin\r\n  if Assigned(FList) then\r\n  begin\r\n    SetCount(0);\r\n    SetCapacity(0);\r\n  end;\r\nend;\r\n\r\nprocedure TFPList.Delete(Index: Integer);\r\nbegin\r\n  If (Index<0) or (Index>=FCount) then\r\n    Error (SListIndexError, str(Index));\r\n  FCount := FCount-1;\r\n  System.Delete(FList,Index,1);\r\n  Dec(FCapacity);\r\nend;\r\n\r\nclass procedure TFPList.Error(const Msg: string; const Data: String);\r\nbegin\r\n  Raise EListError.CreateFmt(Msg,[Data]);\r\nend;\r\n\r\nprocedure TFPList.Exchange(Index1, Index2: Integer);\r\nvar\r\n  Temp : JSValue;\r\nbegin\r\n  If (Index1 >= FCount) or (Index1 < 0) then\r\n    Error(SListIndexError, str(Index1));\r\n  If (Index2 >= FCount) or (Index2 < 0) then\r\n    Error(SListIndexError, str(Index2));\r\n  Temp := FList[Index1];\r\n  FList[Index1] := FList[Index2];\r\n  FList[Index2] := Temp;\r\nend;\r\n\r\nfunction TFPList.Expand: TFPList;\r\nvar\r\n  IncSize : Integer;\r\nbegin\r\n  if FCount < FCapacity then exit(self);\r\n  IncSize := 4;\r\n  if FCapacity > 3 then IncSize := IncSize + 4;\r\n  if FCapacity > 8 then IncSize := IncSize+8;\r\n  if FCapacity > 127 then Inc(IncSize, FCapacity shr 2);\r\n  SetCapacity(FCapacity + IncSize);\r\n  Result := Self;\r\nend;\r\n\r\nfunction TFPList.Extract(Item: JSValue): JSValue;\r\nvar\r\n  i : Integer;\r\nbegin\r\n  i := IndexOf(Item);\r\n  if i >= 0 then\r\n  begin\r\n    Result := Item;\r\n    Delete(i);\r\n  end\r\n  else\r\n    Result := nil;\r\nend;\r\n\r\nfunction TFPList.First: JSValue;\r\nbegin\r\n  If FCount = 0 then\r\n    Result := Nil\r\n  else\r\n    Result := Items[0];\r\nend;\r\n\r\nfunction TFPList.GetEnumerator: TFPListEnumerator;\r\nbegin\r\n  Result:=TFPListEnumerator.Create(Self);\r\nend;\r\n\r\nfunction TFPList.IndexOf(Item: JSValue): Integer;\r\n\r\nVar\r\n  C : Integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  C:=Count;\r\n  while (Result<C) and (FList[Result]<>Item) do\r\n    Inc(Result);\r\n  If Result>=C then\r\n    Result:=-1;\r\n\r\nend;\r\n\r\nfunction TFPList.IndexOfItem(Item: JSValue; Direction: TDirection): Integer;\r\n\r\nbegin\r\n  if Direction=fromBeginning then\r\n    Result:=IndexOf(Item)\r\n  else\r\n    begin\r\n    Result:=Count-1;\r\n    while (Result >=0) and (Flist[Result]<>Item) do\r\n      Result:=Result - 1;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TFPList.Insert(Index: Integer; Item: JSValue);\r\nbegin\r\n  if (Index < 0) or (Index > FCount )then\r\n    Error(SlistIndexError, str(Index));\r\n  TJSArray(FList).splice(Index, 0, Item);\r\n  inc(FCapacity);\r\n  inc(FCount);\r\nend;\r\n\r\nfunction TFPList.Last: JSValue;\r\nbegin\r\n  If FCount = 0 then\r\n    Result := nil\r\n  else\r\n    Result := Items[FCount - 1];\r\nend;\r\n\r\nprocedure TFPList.Move(CurIndex, NewIndex: Integer);\r\nvar\r\n  Temp: JSValue;\r\nbegin\r\n  if (CurIndex < 0) or (CurIndex > Count - 1) then\r\n    Error(SListIndexError, str(CurIndex));\r\n  if (NewIndex < 0) or (NewIndex > Count -1) then\r\n    Error(SlistIndexError, str(NewIndex));\r\n  if CurIndex=NewIndex then exit;\r\n  Temp:=FList[CurIndex];\r\n  // ToDo: use TJSArray.copyWithin if available\r\n  TJSArray(FList).splice(CurIndex,1);\r\n  TJSArray(FList).splice(NewIndex,0,Temp);\r\nend;\r\n\r\nprocedure TFPList.Assign(ListA: TFPList; AOperator: TListAssignOp;\r\n  ListB: TFPList);\r\nbegin\r\n  case AOperator of\r\n    laCopy      : DoCopy (ListA, ListB);      // replace dest with src\r\n    laSrcUnique : DoSrcUnique (ListA, ListB); // replace dest with src that are not in dest\r\n    laAnd       : DoAnd (ListA, ListB);       // remove from dest that are not in src\r\n    laDestUnique: DoDestUnique (ListA, ListB);// remove from dest that are in src\r\n    laOr        : DoOr (ListA, ListB);        // add to dest from src and not in dest\r\n    laXOr       : DoXOr (ListA, ListB);       // add to dest from src and not in dest, remove from dest that are in src\r\n  end;\r\nend;\r\n\r\nfunction TFPList.Remove(Item: JSValue): Integer;\r\nbegin\r\n  Result := IndexOf(Item);\r\n  If Result <> -1 then\r\n    Delete(Result);\r\nend;\r\n\r\nprocedure TFPList.Pack;\r\nvar\r\n  Dst, i: Integer;\r\n  V: JSValue;\r\nbegin\r\n  Dst:=0;\r\n  for i:=0 to Count-1 do\r\n    begin\r\n    V:=FList[i];\r\n    if not Assigned(V) then continue;\r\n    FList[Dst]:=V;\r\n    inc(Dst);\r\n    end;\r\nend;\r\n\r\n// Needed by Sort method.\r\n\r\nProcedure QuickSort(aList: TJSValueDynArray; L, R : Longint;\r\n                    const Compare: TListSortCompareFunc\r\n                    );\r\nvar\r\n  I, J, PivotIdx : SizeUInt;\r\n  P, Q : JSValue;\r\nbegin\r\n repeat\r\n   I := L;\r\n   J := R;\r\n   PivotIdx := L + ((R - L) shr 1); { same as ((L + R) div 2), but without the possibility of overflow }\r\n   P := aList[PivotIdx];\r\n   repeat\r\n     while (I < PivotIdx) and (Compare(P, aList[i]) > 0) do\r\n       Inc(I);\r\n     while (J > PivotIdx) and (Compare(P, aList[J]) < 0) do\r\n       Dec(J);\r\n     if I < J then\r\n     begin\r\n       Q := aList[I];\r\n       aList[I] := aList[J];\r\n       aList[J] := Q;\r\n       if PivotIdx = I then\r\n       begin\r\n         PivotIdx := J;\r\n         Inc(I);\r\n       end\r\n       else if PivotIdx = J then\r\n       begin\r\n         PivotIdx := I;\r\n         Dec(J);\r\n       end\r\n       else\r\n       begin\r\n         Inc(I);\r\n         Dec(J);\r\n       end;\r\n     end;\r\n   until I >= J;\r\n   // sort the smaller range recursively\r\n   // sort the bigger range via the loop\r\n   // Reasons: memory usage is O(log(n)) instead of O(n) and loop is faster than recursion\r\n   if (PivotIdx - L) < (R - PivotIdx) then\r\n   begin\r\n     if (L + 1) < PivotIdx then\r\n       QuickSort(aList, L, PivotIdx - 1, Compare);\r\n     L := PivotIdx + 1;\r\n   end\r\n   else\r\n   begin\r\n     if (PivotIdx + 1) < R then\r\n       QuickSort(aList, PivotIdx + 1, R, Compare);\r\n     if (L + 1) < PivotIdx then\r\n       R := PivotIdx - 1\r\n     else\r\n       exit;\r\n   end;\r\n until L >= R;\r\nend;\r\n\r\n(*\r\nProcedure QuickSort(aList: TJSValueDynArray; L, R : Longint;\r\n                    const Compare: TListSortCompareFunc);\r\nvar\r\n  I, J : Longint;\r\n  P, Q : JSValue;\r\nbegin\r\n  repeat\r\n    I := L;\r\n    J := R;\r\n    P := aList[ (L + R) div 2 ];\r\n    repeat\r\n      while Compare(P, aList[i]) > 0 do\r\n        I := I + 1;\r\n      while Compare(P, aList[J]) < 0 do\r\n        J := J - 1;\r\n      If I <= J then\r\n      begin\r\n        Q := aList[I];\r\n        aList[I] := aList[J];\r\n        aList[J] := Q;\r\n        I := I + 1;\r\n        J := J - 1;\r\n      end;\r\n    until I > J;\r\n    // sort the smaller range recursively\r\n    // sort the bigger range via the loop\r\n    // Reasons: memory usage is O(log(n)) instead of O(n) and loop is faster than recursion\r\n    if J - L < R - I then\r\n    begin\r\n      if L < J then\r\n        QuickSort(aList, L, J, Compare);\r\n      L := I;\r\n    end\r\n    else\r\n    begin\r\n      if I < R then\r\n        QuickSort(aList, I, R, Compare);\r\n      R := J;\r\n    end;\r\n  until L >= R;\r\nend;\r\n*)\r\n\r\nprocedure TFPList.Sort(const Compare: TListSortCompare);\r\nbegin\r\n  if Not Assigned(FList) or (FCount < 2) then exit;\r\n  QuickSort(Flist, 0, FCount-1,\r\n    function(Item1, Item2: JSValue): Integer\r\n    begin\r\n      Result := Compare(Item1, Item2);\r\n    end);\r\nend;\r\n\r\nprocedure TFPList.SortList(const Compare: TListSortCompareFunc);\r\nbegin\r\n  if Not Assigned(FList) or (FCount < 2) then exit;\r\n  QuickSort(Flist, 0, FCount-1, Compare);\r\nend;\r\n\r\nprocedure TFPList.ForEachCall(const proc2call: TListCallback; const arg: JSValue\r\n  );\r\nvar\r\n  i : integer;\r\n  v : JSValue;\r\nbegin\r\n  For I:=0 To Count-1 Do\r\n    begin\r\n      v:=FList[i];\r\n      if Assigned(v) then\r\n        proc2call(v,arg);\r\n    end;\r\nend;\r\n\r\nprocedure TFPList.ForEachCall(const proc2call: TListStaticCallback;\r\n  const arg: JSValue);\r\nvar\r\n  i : integer;\r\n  v : JSValue;\r\nbegin\r\n  For I:=0 To Count-1 Do\r\n    begin\r\n      v:=FList[i];\r\n      if Assigned(v) then\r\n        proc2call(v,arg);\r\n    end;\r\nend;\r\n\r\n{ TList }\r\n\r\nprocedure TList.CopyMove(aList: TList);\r\nvar\r\n  r : integer;\r\nbegin\r\n  Clear;\r\n  for r := 0 to aList.count-1 do\r\n    Add(aList[r]);\r\nend;\r\n\r\nprocedure TList.MergeMove(aList: TList);\r\nvar r : integer;\r\nbegin\r\n  For r := 0 to aList.count-1 do\r\n    if IndexOf(aList[r]) < 0 then\r\n      Add(aList[r]);\r\nend;\r\n\r\nprocedure TList.DoCopy(ListA, ListB: TList);\r\nbegin\r\n  if Assigned(ListB) then\r\n    CopyMove(ListB)\r\n  else\r\n    CopyMove(ListA);\r\nend;\r\n\r\nprocedure TList.DoSrcUnique(ListA, ListB: TList);\r\nvar r : integer;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) < 0 then\r\n        Add(ListA[r]);\r\n    end\r\n  else\r\n    begin\r\n    for r := Count-1 downto 0 do\r\n      if ListA.IndexOf(Self[r]) >= 0 then\r\n        Delete(r);\r\n    end;\r\nend;\r\n\r\nprocedure TList.DoAnd(ListA, ListB: TList);\r\nvar r : integer;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) >= 0 then\r\n        Add(ListA[r]);\r\n    end\r\n  else\r\n    begin\r\n    for r := Count-1 downto 0 do\r\n      if ListA.IndexOf(Self[r]) < 0 then\r\n        Delete(r);\r\n    end;\r\nend;\r\n\r\nprocedure TList.DoDestUnique(ListA, ListB: TList);\r\n\r\n  procedure MoveElements(Src, Dest : TList);\r\n  var r : integer;\r\n  begin\r\n    Clear;\r\n    for r := 0 to Src.Count-1 do\r\n      if Dest.IndexOf(Src[r]) < 0 then\r\n        Add(Src[r]);\r\n  end;\r\n\r\nvar Dest : TList;\r\nbegin\r\n  if Assigned(ListB) then\r\n    MoveElements(ListB, ListA)\r\n  else\r\n    try\r\n      Dest := TList.Create;\r\n      Dest.CopyMove(Self);\r\n      MoveElements(ListA, Dest)\r\n    finally\r\n      Dest.Destroy;\r\n    end;\r\nend;\r\n\r\nprocedure TList.DoOr(ListA, ListB: TList);\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    CopyMove(ListA);\r\n    MergeMove(ListB);\r\n    end\r\n  else\r\n    MergeMove(ListA);\r\nend;\r\n\r\nprocedure TList.DoXOr(ListA, ListB: TList);\r\nvar\r\n  r : integer;\r\n  l : TList;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) < 0 then\r\n        Add(ListA[r]);\r\n    for r := 0 to ListB.Count-1 do\r\n      if ListA.IndexOf(ListB[r]) < 0 then\r\n        Add(ListB[r]);\r\n    end\r\n  else\r\n    try\r\n      l := TList.Create;\r\n      l.CopyMove (Self);\r\n      for r := Count-1 downto 0 do\r\n        if listA.IndexOf(Self[r]) >= 0 then\r\n          Delete(r);\r\n      for r := 0 to ListA.Count-1 do\r\n        if l.IndexOf(ListA[r]) < 0 then\r\n          Add(ListA[r]);\r\n    finally\r\n      l.Destroy;\r\n    end;\r\nend;\r\n\r\nfunction TList.Get(Index: Integer): JSValue;\r\nbegin\r\n  Result := FList.Get(Index);\r\nend;\r\n\r\nprocedure TList.Put(Index: Integer; Item: JSValue);\r\nvar V : JSValue;\r\nbegin\r\n  V := Get(Index);\r\n  FList.Put(Index, Item);\r\n  if Assigned(V) then\r\n    Notify(V, lnDeleted);\r\n  if Assigned(Item) then\r\n    Notify(Item, lnAdded);\r\nend;\r\n\r\nprocedure TList.Notify(aValue: JSValue; Action: TListNotification);\r\nbegin\r\n  if Assigned(aValue) then ;\r\n  if Action=lnExtracted then ;\r\nend;\r\n\r\nprocedure TList.SetCapacity(NewCapacity: Integer);\r\nbegin\r\n  FList.SetCapacity(NewCapacity);\r\nend;\r\n\r\nfunction TList.GetCapacity: integer;\r\nbegin\r\n  Result := FList.Capacity;\r\nend;\r\n\r\nprocedure TList.SetCount(NewCount: Integer);\r\nbegin\r\n  if NewCount < FList.Count then\r\n    while FList.Count > NewCount do\r\n      Delete(FList.Count - 1)\r\n  else\r\n    FList.SetCount(NewCount);\r\nend;\r\n\r\nfunction TList.GetCount: integer;\r\nbegin\r\n  Result := FList.Count;\r\nend;\r\n\r\nfunction TList.GetList: TJSValueDynArray;\r\nbegin\r\n  Result := FList.List;\r\nend;\r\n\r\nconstructor TList.Create;\r\nbegin\r\n  inherited Create;\r\n  FList := TFPList.Create;\r\nend;\r\n\r\ndestructor TList.Destroy;\r\nbegin\r\n  if Assigned(FList) then\r\n    Clear;\r\n  FreeAndNil(FList);\r\nend;\r\n\r\nprocedure TList.AddList(AList: TList);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  { this only does FList.AddList(AList.FList), avoiding notifications }\r\n  FList.AddList(AList.FList);\r\n\r\n  { make lnAdded notifications }\r\n  for I := 0 to AList.Count - 1 do\r\n    if Assigned(AList[I]) then\r\n      Notify(AList[I], lnAdded);\r\nend;\r\n\r\nfunction TList.Add(Item: JSValue): Integer;\r\nbegin\r\n  Result := FList.Add(Item);\r\n  if Assigned(Item) then\r\n    Notify(Item, lnAdded);\r\nend;\r\n\r\nprocedure TList.Clear;\r\nbegin\r\n  While (FList.Count>0) do\r\n    Delete(Count-1);\r\nend;\r\n\r\nprocedure TList.Delete(Index: Integer);\r\n\r\nvar V : JSValue;\r\n\r\nbegin\r\n  V:=FList.Get(Index);\r\n  FList.Delete(Index);\r\n  if assigned(V) then\r\n    Notify(V, lnDeleted);\r\nend;\r\n\r\nclass procedure TList.Error(const Msg: string; Data: String);\r\nbegin\r\n  Raise EListError.CreateFmt(Msg,[Data]);\r\nend;\r\n\r\nprocedure TList.Exchange(Index1, Index2: Integer);\r\nbegin\r\n  FList.Exchange(Index1, Index2);\r\nend;\r\n\r\nfunction TList.Expand: TList;\r\nbegin\r\n  FList.Expand;\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TList.Extract(Item: JSValue): JSValue;\r\nvar c : integer;\r\nbegin\r\n  c := FList.Count;\r\n  Result := FList.Extract(Item);\r\n  if c <> FList.Count then\r\n    Notify (Result, lnExtracted);\r\nend;\r\n\r\nfunction TList.First: JSValue;\r\nbegin\r\n  Result := FList.First;\r\nend;\r\n\r\nfunction TList.GetEnumerator: TListEnumerator;\r\nbegin\r\n  Result:=TListEnumerator.Create(Self);\r\nend;\r\n\r\nfunction TList.IndexOf(Item: JSValue): Integer;\r\nbegin\r\n  Result := FList.IndexOf(Item);\r\nend;\r\n\r\nprocedure TList.Insert(Index: Integer; Item: JSValue);\r\nbegin\r\n  FList.Insert(Index, Item);\r\n  if Assigned(Item) then\r\n    Notify(Item,lnAdded);\r\nend;\r\n\r\nfunction TList.Last: JSValue;\r\nbegin\r\n  Result := FList.Last;\r\nend;\r\n\r\nprocedure TList.Move(CurIndex, NewIndex: Integer);\r\nbegin\r\n  FList.Move(CurIndex, NewIndex);\r\nend;\r\n\r\nprocedure TList.Assign(ListA: TList; AOperator: TListAssignOp; ListB: TList);\r\nbegin\r\n  case AOperator of\r\n    laCopy      : DoCopy (ListA, ListB);      // replace dest with src\r\n    laSrcUnique : DoSrcUnique (ListA, ListB); // replace dest with src that are not in dest\r\n    laAnd       : DoAnd (ListA, ListB);       // remove from dest that are not in src\r\n    laDestUnique: DoDestUnique (ListA, ListB);// remove from dest that are in src\r\n    laOr        : DoOr (ListA, ListB);        // add to dest from src and not in dest\r\n    laXOr       : DoXOr (ListA, ListB);       // add to dest from src and not in dest, remove from dest that are in src\r\n  end;\r\nend;\r\n\r\nfunction TList.Remove(Item: JSValue): Integer;\r\nbegin\r\n  Result := IndexOf(Item);\r\n  if Result <> -1 then\r\n    Self.Delete(Result);\r\nend;\r\n\r\nprocedure TList.Pack;\r\nbegin\r\n  FList.Pack;\r\nend;\r\n\r\nprocedure TList.Sort(const Compare: TListSortCompare);\r\nbegin\r\n  FList.Sort(Compare);\r\nend;\r\n\r\nprocedure TList.SortList(const Compare: TListSortCompareFunc);\r\nbegin\r\n  FList.SortList(Compare);\r\nend;\r\n\r\n{ TPersistent }\r\n\r\nprocedure TPersistent.AssignError(Source: TPersistent);\r\nvar\r\n  SourceName: String;\r\nbegin\r\n  if Source<>Nil then\r\n    SourceName:=Source.ClassName\r\n  else\r\n    SourceName:='Nil';\r\n  raise EConvertError.Create('Cannot assign a '+SourceName+' to a '+ClassName+'.');\r\nend;\r\n\r\nprocedure TPersistent.DefineProperties(Filer: TFiler);\r\nbegin\r\n  if Filer=Nil then exit;\r\n  // Do nothing\r\nend;\r\n\r\nprocedure TPersistent.AssignTo(Dest: TPersistent);\r\nbegin\r\n  Dest.AssignError(Self);\r\nend;\r\n\r\nfunction TPersistent.GetOwner: TPersistent;\r\nbegin\r\n  Result:=nil;\r\nend;\r\n\r\nprocedure TPersistent.Assign(Source: TPersistent);\r\nbegin\r\n  If Source<>Nil then\r\n    Source.AssignTo(Self)\r\n  else\r\n    AssignError(Nil);\r\nend;\r\n\r\nfunction TPersistent.GetNamePath: string;\r\nvar\r\n  OwnerName: String;\r\n  TheOwner: TPersistent;\r\nbegin\r\n  Result:=ClassName;\r\n  TheOwner:=GetOwner;\r\n  if TheOwner<>Nil then\r\n  begin\r\n    OwnerName:=TheOwner.GetNamePath;\r\n    if OwnerName<>'' then Result:=OwnerName+'.'+Result;\r\n  end;\r\nend;\r\n\r\nprocedure TPersistent.SetEvent(const ALookupRoot: TPersistent; const APropName, AMethodName: string);\r\nbegin\r\n  SetEvent(Self, ALookupRoot, APropName, AMethodName);\r\nend;\r\n\r\nprocedure TPersistent.SetEvent(const AInstance, ALookupRoot: TPersistent; const APropName, AMethodName: string);\r\nvar\r\n  lMethod: TMethod;\r\nbegin\r\n  lMethod.Code := ALookupRoot.MethodAddress(AMethodName);\r\n  if lMethod.Code = nil then\r\n    raise Exception.Create(ALookupRoot.ClassName +' has no published method \"'+ AMethodName + '\"');\r\n   lMethod.Data := ALookupRoot;\r\n  SetMethodProp(AInstance, APropName, lMethod);\r\nend;\r\n\r\n{\r\n    This file is part of the Free Component Library (FCL)\r\n    Copyright (c) 1999-2000 by the Free Pascal development team\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\n{****************************************************************************}\r\n{*                        TStringsEnumerator                                *}\r\n{****************************************************************************}\r\n\r\nconstructor TStringsEnumerator.Create(AStrings: TStrings);\r\nbegin\r\n  inherited Create;\r\n  FStrings := AStrings;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TStringsEnumerator.GetCurrent: String;\r\nbegin\r\n  Result := FStrings[FPosition];\r\nend;\r\n\r\nfunction TStringsEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FStrings.Count;\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                             TStrings                                     *}\r\n{****************************************************************************}\r\n\r\n// Function to quote text. Should move maybe to sysutils !!\r\n// Also, it is not clear at this point what exactly should be done.\r\n\r\n{ //!! is used to mark unsupported things. }\r\n\r\n{\r\n  For compatibility we can't add a Constructor to TSTrings to initialize\r\n  the special characters. Therefore we add a routine which is called whenever\r\n  the special chars are needed.\r\n}\r\n\r\nprocedure TStrings.CheckSpecialChars;\r\n\r\nbegin\r\n  If Not FSpecialCharsInited then\r\n    begin\r\n    FQuoteChar:='\"';\r\n    FDelimiter:=',';\r\n    FNameValueSeparator:='=';\r\n    FLBS:=DefaultTextLineBreakStyle;\r\n    FSpecialCharsInited:=true;\r\n    FLineBreak:=sLineBreak;\r\n    end;\r\nend;\r\n\r\nfunction TStrings.GetSkipLastLineBreak: Boolean;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FSkipLastLineBreak;\r\nend;\r\n\r\nprocedure TStrings.SetSkipLastLineBreak(const AValue : Boolean);\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  FSkipLastLineBreak:=AValue;\r\nend;\r\n\r\nprocedure TStrings.ReadData(Reader: TReader);\r\nbegin\r\n  Reader.ReadListBegin;\r\n  BeginUpdate;\r\n  try\r\n    Clear;\r\n    while not Reader.EndOfList do\r\n      Add(Reader.ReadString);\r\n  finally\r\n    EndUpdate;\r\n  end;\r\n  Reader.ReadListEnd;\r\nend;\r\n\r\nprocedure TStrings.WriteData(Writer: TWriter);\r\nvar\r\n  i: Integer;\r\nbegin\r\n  Writer.WriteListBegin;\r\n  for i := 0 to Count - 1 do\r\n    Writer.WriteString(Strings[i]);\r\n  Writer.WriteListEnd;\r\nend;\r\n\r\nprocedure TStrings.DefineProperties(Filer: TFiler);\r\nvar\r\n  HasData: Boolean;\r\nbegin\r\n  if Assigned(Filer.Ancestor) then\r\n    // Only serialize if string list is different from ancestor\r\n    if Filer.Ancestor.InheritsFrom(TStrings) then\r\n      HasData := not Equals(TStrings(Filer.Ancestor))\r\n    else\r\n      HasData := True\r\n  else\r\n    HasData := Count > 0;\r\n  Filer.DefineProperty('Strings', @ReadData, @WriteData, HasData);\r\nend;\r\n\r\nfunction TStrings.GetLBS: TTextLineBreakStyle;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FLBS;\r\nend;\r\n\r\nprocedure TStrings.SetLBS(AValue: TTextLineBreakStyle);\r\nbegin\r\n  CheckSpecialChars;\r\n  FLBS:=AValue;\r\nend;\r\n\r\nprocedure TStrings.SetDelimiter(c:Char);\r\nbegin\r\n  CheckSpecialChars;\r\n  FDelimiter:=c;\r\nend;\r\n\r\nfunction TStrings.GetDelimiter: Char;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FDelimiter;\r\nend;\r\n\r\nprocedure TStrings.SetLineBreak(const S: String);\r\nbegin\r\n  CheckSpecialChars;\r\n  FLineBreak:=S;\r\nend;\r\n\r\nfunction TStrings.GetLineBreak: String;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FLineBreak;\r\nend;\r\n\r\n\r\nprocedure TStrings.SetQuoteChar(c:Char);\r\nbegin\r\n  CheckSpecialChars;\r\n  FQuoteChar:=c;\r\nend;\r\n\r\nfunction TStrings.GetQuoteChar: Char;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FQuoteChar;\r\nend;\r\n\r\nprocedure TStrings.SetNameValueSeparator(c:Char);\r\nbegin\r\n  CheckSpecialChars;\r\n  FNameValueSeparator:=c;\r\nend;\r\n\r\nfunction TStrings.GetNameValueSeparator: Char;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FNameValueSeparator;\r\nend;\r\n\r\n\r\nfunction TStrings.GetCommaText: string;\r\n\r\nVar\r\n  C1,C2 : Char;\r\n  FSD : Boolean;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  FSD:=StrictDelimiter;\r\n  C1:=Delimiter;\r\n  C2:=QuoteChar;\r\n  Delimiter:=',';\r\n  QuoteChar:='\"';\r\n  StrictDelimiter:=False;\r\n  Try\r\n    Result:=GetDelimitedText;\r\n  Finally\r\n    Delimiter:=C1;\r\n    QuoteChar:=C2;\r\n    StrictDelimiter:=FSD;\r\n  end;\r\nend;\r\n\r\n\r\nfunction TStrings.GetDelimitedText: string;\r\n\r\nVar\r\n  I: integer;\r\n  RE : string;\r\n  S : String;\r\n  doQuote : Boolean;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  result:='';\r\n  RE:=QuoteChar+'|'+Delimiter;\r\n  if not StrictDelimiter then\r\n    RE:=' |'+RE;\r\n  RE:='/'+RE+'/';\r\n  // Check for break characters and quote if required.\r\n  For i:=0 to count-1 do\r\n    begin\r\n    S:=Strings[i];\r\n    doQuote:=FAlwaysQuote or (TJSString(s).search(RE)<>-1);\r\n    if DoQuote then\r\n      Result:=Result+QuoteString(S,QuoteChar)\r\n    else\r\n      Result:=Result+S;\r\n    if I<Count-1 then\r\n      Result:=Result+Delimiter;\r\n    end;\r\n  // Quote empty string:\r\n  If (Length(Result)=0) and (Count=1) then\r\n    Result:=QuoteChar+QuoteChar;\r\nend;\r\n\r\nprocedure TStrings.GetNameValue(Index: Integer; out AName, AValue: String);\r\n\r\nVar L : longint;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  AValue:=Strings[Index];\r\n  L:=Pos(FNameValueSeparator,AValue);\r\n  If L<>0 then\r\n    begin\r\n    AName:=Copy(AValue,1,L-1);\r\n    //    System.Delete(AValue,1,L);\r\n    AValue:=Copy(AValue,L+1,length(AValue)-L);\r\n    end\r\n  else\r\n    AName:='';\r\nend;\r\n\r\nprocedure TStrings.LoadFromURL(const aURL: String; Async: Boolean; OnLoaded: TNotifyEventRef; OnError: TStringNotifyEventRef);\r\n\r\n  procedure DoLoaded(const aString : String);\r\n  begin\r\n    Text:=aString;\r\n    if Assigned(OnLoaded) then\r\n      OnLoaded(Self);\r\n  end;\r\n\r\n  procedure DoError(const AError : String);\r\n  begin\r\n    if Assigned(OnError) then\r\n      OnError(Self,aError)\r\n    else\r\n      Raise EInOutError.Create('Failed to load from URL:'+aError);\r\n  end;\r\n\r\nbegin\r\n  CheckLoadHelper;\r\n  GlobalLoadHelper.LoadText(aURL,aSync,@DoLoaded,@DoError);\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction URLToArrayOfString(URL: string): TJSStringDynArray;\r\nvar\r\n  a: TJSStringDynArray;\r\n  cors_api_url: string;\r\nbegin\r\n  cors_api_url := '';//'https://cors-anywhere.herokuapp.com/';\r\n  asm\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open(\"GET\", cors_api_url + URL, false);\r\n    xhr.send();\r\n\r\n    if (xhr.status==200)\r\n    {\r\n      var obj = xhr.responseText.split(/\\r\\n|\\n/);\r\n      for (var i = 0; i < obj.length; i++) {\r\n        a.push(obj[i]);\r\n      }\r\n    }\r\n  end;\r\n\r\n  Result := a;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TStrings.LoadFromFile(const aFileName: String);\r\nvar\r\n  a: TJSStringDynArray;\r\nbegin\r\n  a := URLToArrayOfString(aFileName);\r\n  AddStrings(a, True);\r\nend;\r\n\r\nprocedure TStrings.LoadFromFile(const aFileName: String; const OnLoaded: TProc; const AError: TProcString);\r\n\r\nbegin\r\n  LoadFromURL(aFileName,False,\r\n  Procedure (Sender : TObject)\r\n  begin\r\n    If Assigned(OnLoaded) then\r\n     OnLoaded\r\n  end,\r\n  Procedure (Sender : TObject; Const ErrorMsg : String)\r\n  begin\r\n    if Assigned(aError) then\r\n      aError(ErrorMsg)\r\n  end);\r\nend;\r\n\r\nprocedure ReqAsync(AURL: string; LoadProc: TReqLoadProc; ErrorProc: TReqErrorProc);\r\nvar\r\n  req: TJSXMLHttpRequest;\r\n\r\n  function HandleResponse(Event: TEventListenerEvent): boolean;\r\n  var\r\n    s:string;\r\n    status: integer;\r\n  begin\r\n    asm\r\n      status = Event.target.status;\r\n      s = Event.target.responseText;\r\n    end;\r\n\r\n    if status div 100 = 2 then\r\n      LoadProc(s)\r\n    else\r\n      ErrorProc();\r\n    Result := true;\r\n  end;\r\n\r\n  function HandleError(Event: TEventListenerEvent): boolean;\r\n  begin\r\n    ErrorProc();\r\n    Result := true;\r\n  end;\r\n\r\nbegin\r\n  req := TJSXMLHttpRequest.new;\r\n  req.addEventListener('load', @HandleResponse);\r\n  req.addEventListener('abort',@HandleError);\r\n  req.addEventListener('timeout',@HandleError);\r\n  req.addEventListener('error',@HandleError);\r\n  req.open('GET', AURL);\r\n  req.send;\r\nend;\r\n\r\nfunction TStrings.LoadFromFileAsync(const aFileName: string): TJSPromise;\r\nbegin\r\n  Result := TJSPromise.new(\r\n    procedure(ASuccess, AFailed: TJSPromiseResolver)\r\n    begin\r\n      ReqAsync(aFileName,\r\n        procedure(AResponse: string)\r\n        begin\r\n          ASuccess(True);\r\n          Text := AResponse;\r\n        end,\r\n        procedure()\r\n        begin\r\n          ASuccess(False);\r\n        end);\r\n    end);\r\n\r\nend;\r\n\r\nfunction TStrings.ExtractName(const S: String): String;\r\nvar\r\n  L: Longint;\r\nbegin\r\n  CheckSpecialChars;\r\n  L:=Pos(FNameValueSeparator,S);\r\n  If L<>0 then\r\n    Result:=Copy(S,1,L-1)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nfunction TStrings.GetName(Index: Integer): string;\r\n\r\nVar\r\n  V : String;\r\n\r\nbegin\r\n  GetNameValue(Index,Result,V);\r\nend;\r\n\r\nfunction TStrings.GetValue(const Name: string): string;\r\n\r\nVar\r\n  L : longint;\r\n  N : String;\r\n\r\nbegin\r\n  Result:='';\r\n  L:=IndexOfName(Name);\r\n  If L<>-1 then\r\n    GetNameValue(L,N,Result);\r\nend;\r\n\r\nfunction TStrings.GetValueFromIndex(Index: Integer): string;\r\n\r\nVar\r\n  N : String;\r\n\r\nbegin\r\n  GetNameValue(Index,N,Result);\r\nend;\r\n\r\nprocedure TStrings.SetValueFromIndex(Index: Integer; const Value: string);\r\n\r\nbegin\r\n  If (Value='') then\r\n    Delete(Index)\r\n  else\r\n    begin\r\n    If (Index<0) then\r\n      Index:=Add('');\r\n    CheckSpecialChars;\r\n    Strings[Index]:=GetName(Index)+FNameValueSeparator+Value;\r\n    end;\r\nend;\r\n\r\nprocedure TStrings.SetDelimitedText(const AValue: string);\r\nvar i,j:integer;\r\n    aNotFirst:boolean;\r\nbegin\r\n CheckSpecialChars;\r\n BeginUpdate;\r\n\r\n i:=1;\r\n j:=1;\r\n aNotFirst:=false;\r\n\r\n { Paraphrased from Delphi XE2 help:\r\n Strings must be separated by Delimiter characters or spaces.\r\n They may be enclosed in QuoteChars.\r\n QuoteChars in the string must be repeated to distinguish them from the QuoteChars enclosing the string.\r\n }\r\n try\r\n  Clear;\r\n  If StrictDelimiter then\r\n    begin\r\n    while i<=length(AValue) do begin\r\n     // skip delimiter\r\n     if aNotFirst and (i<=length(AValue)) and (AValue[i]=FDelimiter) then inc(i);\r\n\r\n     // read next string\r\n     if i<=length(AValue) then begin\r\n      if AValue[i]=FQuoteChar then begin\r\n       // next string is quoted\r\n       j:=i+1;\r\n       while (j<=length(AValue)) and\r\n             ( (AValue[j]<>FQuoteChar) or\r\n               ( (j+1<=length(AValue)) and (AValue[j+1]=FQuoteChar) ) ) do begin\r\n        if (j<=length(AValue)) and (AValue[j]=FQuoteChar) then inc(j,2)\r\n                                                          else inc(j);\r\n       end;\r\n       // j is position of closing quote\r\n       Add( StringReplace (Copy(AValue,i+1,j-i-1),\r\n                           FQuoteChar+FQuoteChar,FQuoteChar, [rfReplaceAll]));\r\n       i:=j+1;\r\n      end else begin\r\n       // next string is not quoted; read until delimiter\r\n       j:=i;\r\n       while (j<=length(AValue)) and\r\n             (AValue[j]<>FDelimiter) do inc(j);\r\n       Add( Copy(AValue,i,j-i));\r\n       i:=j;\r\n      end;\r\n     end else begin\r\n      if aNotFirst then Add('');\r\n     end;\r\n\r\n     aNotFirst:=true;\r\n    end;\r\n    end\r\n  else\r\n    begin\r\n    while i<=length(AValue) do begin\r\n     // skip delimiter\r\n     if aNotFirst and (i<=length(AValue)) and (AValue[i]=FDelimiter) then inc(i);\r\n\r\n     // skip spaces\r\n     while (i<=length(AValue)) and (Ord(AValue[i])<=Ord(' ')) do inc(i);\r\n\r\n     // read next string\r\n     if i<=length(AValue) then begin\r\n      if AValue[i]=FQuoteChar then begin\r\n       // next string is quoted\r\n       j:=i+1;\r\n       while (j<=length(AValue)) and\r\n             ( (AValue[j]<>FQuoteChar) or\r\n               ( (j+1<=length(AValue)) and (AValue[j+1]=FQuoteChar) ) ) do begin\r\n        if (j<=length(AValue)) and (AValue[j]=FQuoteChar) then inc(j,2)\r\n                                                          else inc(j);\r\n       end;\r\n       // j is position of closing quote\r\n       Add( StringReplace (Copy(AValue,i+1,j-i-1),\r\n                           FQuoteChar+FQuoteChar,FQuoteChar, [rfReplaceAll]));\r\n       i:=j+1;\r\n      end else begin\r\n       // next string is not quoted; read until control character/space/delimiter\r\n       j:=i;\r\n       while (j<=length(AValue)) and\r\n             (Ord(AValue[j])>Ord(' ')) and\r\n             (AValue[j]<>FDelimiter) do inc(j);\r\n       Add( Copy(AValue,i,j-i));\r\n       i:=j;\r\n      end;\r\n     end else begin\r\n      if aNotFirst then Add('');\r\n     end;\r\n\r\n     // skip spaces\r\n     while (i<=length(AValue)) and (Ord(AValue[i])<=Ord(' ')) do inc(i);\r\n\r\n     aNotFirst:=true;\r\n    end;\r\n    end;\r\n finally\r\n   EndUpdate;\r\n end;\r\nend;\r\n\r\nprocedure TStrings.SetCommaText(const Value: string);\r\n\r\nVar\r\n  C1,C2 : Char;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  C1:=Delimiter;\r\n  C2:=QuoteChar;\r\n  Delimiter:=',';\r\n  QuoteChar:='\"';\r\n  Try\r\n    SetDelimitedText(Value);\r\n  Finally\r\n    Delimiter:=C1;\r\n    QuoteChar:=C2;\r\n  end;\r\nend;\r\n\r\nprocedure TStrings.SetValue(const Name: String; const Value: string);\r\n\r\nVar L : longint;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  L:=IndexOfName(Name);\r\n  if L=-1 then\r\n   Add (Name+FNameValueSeparator+Value)\r\n  else\r\n   Strings[L]:=Name+FNameValueSeparator+value;\r\nend;\r\n\r\n\r\nprocedure TStrings.Error(const Msg: string; Data: Integer);\r\nbegin\r\n  Raise EStringListError.CreateFmt(Msg,[IntToStr(Data)]);\r\nend;\r\n\r\nfunction TStrings.GetCapacity: Integer;\r\n\r\nbegin\r\n  Result:=Count;\r\nend;\r\n\r\n\r\n\r\nfunction TStrings.GetObject(Index: Integer): TObject;\r\n\r\nbegin\r\n  if Index=0 then ;\r\n  Result:=Nil;\r\nend;\r\n\r\nfunction TStrings.GetTextStr: string;\r\n\r\nVar\r\n  I : Longint;\r\n  S,NL : String;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  // Determine needed place\r\n  if FLineBreak<>sLineBreak then\r\n    NL:=FLineBreak\r\n  else\r\n    Case FLBS of\r\n      tlbsLF   : NL:=#10;\r\n      tlbsCRLF : NL:=#13#10;\r\n      tlbsCR   : NL:=#13;\r\n    end;\r\n  Result:='';\r\n  For i:=0 To count-1 do\r\n    begin\r\n    S:=Strings[I];\r\n    Result:=Result+S;\r\n    if (I<Count-1) or Not SkipLastLineBreak then\r\n      Result:=Result+NL;\r\n    end;\r\nend;\r\n\r\n\r\n\r\nprocedure TStrings.Put(Index: Integer; const S: string);\r\n\r\nVar Obj : TObject;\r\n\r\nbegin\r\n  Obj:=Objects[Index];\r\n  Delete(Index);\r\n  InsertObject(Index,S,Obj);\r\nend;\r\n\r\n\r\n\r\nprocedure TStrings.PutObject(Index: Integer; AObject: TObject);\r\n\r\nbegin\r\n  // Empty.\r\n  if Index=0 then exit;\r\n  if AObject=nil then exit;\r\nend;\r\n\r\n\r\n\r\nprocedure TStrings.SetCapacity(NewCapacity: Integer);\r\n\r\nbegin\r\n  // Empty.\r\n  if NewCapacity=0 then ;\r\nend;\r\n\r\nfunction TStrings.GetNextLinebreak(const Value: String; out S: String; var P: Integer): Boolean;\r\n\r\nvar\r\n  PPLF,PPCR,PP,PL: Integer;\r\n\r\nbegin\r\n  S:='';\r\n  Result:=False;\r\n  If ((Length(Value)-P)<0) then\r\n    Exit;\r\n  PPLF:=TJSString(Value).IndexOf(#10,P-1)+1;\r\n  PPCR:=TJSString(Value).IndexOf(#13,P-1)+1;\r\n  PL:=1;\r\n  if (PPLF>0) and (PPCR>0) then\r\n    begin\r\n    if (PPLF-PPCR)=1 then \r\n      PL:=2;\r\n    if PPLF<PPCR then\r\n      PP:=PPLF\r\n    else\r\n      PP:=PPCR;\r\n    end\r\n  else if (PPLF>0) and (PPCR<1) then\r\n    PP:=PPLF\r\n  else if (PPCR > 0) and (PPLF<1) then\r\n    PP:=PPCR\r\n  else \r\n    PP:=Length(Value)+1;\r\n  S:=Copy(Value,P,PP-P);\r\n  P:=PP+PL;\r\n  Result:=True;\r\nend;\r\n\r\nprocedure TStrings.DoSetTextStr(const Value: string; DoClear: Boolean);\r\n\r\nVar\r\n  S : String;\r\n  P : Integer;\r\n\r\nbegin\r\n  Try\r\n    BeginUpdate;\r\n    if DoClear then\r\n      Clear;\r\n    P:=1;\r\n    While GetNextLineBreak (Value,S,P) do\r\n      Add(S);\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\nprocedure TStrings.SetTextStr(const Value: string);\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  DoSetTextStr(Value,True);\r\nend;\r\n\r\nprocedure TStrings.AddText(const S: String);\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  DoSetTextStr(S,False);\r\nend;\r\n\r\nprocedure TStrings.SetUpdateState(Updating: Boolean);\r\n\r\nbegin\r\n  // FPONotifyObservers(Self,ooChange,Nil);\r\n  if Updating then ;\r\nend;\r\n\r\ndestructor TStrings.Destroy;\r\n\r\nbegin\r\n  inherited destroy;\r\nend;\r\n\r\nconstructor TStrings.Create;\r\nbegin\r\n  inherited Create;\r\n  FAlwaysQuote:=False;\r\nend;\r\n\r\nfunction TStrings.ToObjectArray: TObjectDynArray;\r\n\r\nbegin\r\n  Result:=ToObjectArray(0,Count-1);\r\nend;\r\n\r\nfunction TStrings.ToObjectArray(aStart,aEnd : Integer): TObjectDynArray;\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  Result:=Nil;\r\n  if aStart>aEnd then exit;\r\n  SetLength(Result,aEnd-aStart+1);\r\n  For I:=aStart to aEnd do\r\n    Result[i-aStart]:=Objects[i];\r\nend;\r\n\r\nfunction TStrings.ToStringArray: TStringDynArray;\r\n\r\nbegin\r\n  Result:=ToStringArray(0,Count-1);\r\nend;\r\n\r\nfunction TStrings.ToStringArray(aStart,aEnd : Integer): TStringDynArray;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  Result:=Nil;\r\n  if aStart>aEnd then exit;\r\n  SetLength(Result,aEnd-aStart+1);\r\n  For I:=aStart to aEnd do\r\n    Result[i-aStart]:=Strings[i];\r\nend;\r\n\r\nfunction TStrings.Add(const S: string): Integer;\r\n\r\nbegin\r\n  Result:=Count;\r\n  Insert (Count,S);\r\nend;\r\n\r\n\r\nfunction TStrings.Add(const Fmt: string; const Args: array of const): Integer;\r\n\r\nbegin\r\n  Result:=Add(Format(Fmt,Args));\r\nend;\r\n\r\nfunction TStrings.AddFmt(const Fmt: string; const Args: array of const): Integer;\r\n\r\nbegin\r\n  Result:=Add(Format(Fmt,Args));\r\nend;\r\n\r\n\r\nfunction TStrings.AddObject(const S: string; AObject: TObject): Integer;\r\n\r\nbegin\r\n  Result:=Add(S);\r\n  Objects[result]:=AObject;\r\nend;\r\n\r\nfunction TStrings.AddObject(const Fmt: string; Args: array of const; AObject: TObject): Integer;\r\n\r\nbegin\r\n  Result:=AddObject(Format(Fmt,Args),AObject);\r\nend;\r\n\r\nprocedure TStrings.Append(const S: string);\r\n\r\nbegin\r\n  Add (S);\r\nend;\r\n\r\n\r\n\r\nprocedure TStrings.AddStrings(TheStrings: TStrings; ClearFirst: Boolean);\r\n\r\n\r\nbegin\r\n  beginupdate;\r\n  try\r\n    if ClearFirst then\r\n      Clear;\r\n    AddStrings(TheStrings);\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\nprocedure TStrings.AddStrings(TheStrings: TStrings);\r\n\r\nVar Runner : longint;\r\nbegin\r\n  For Runner:=0 to TheStrings.Count-1 do\r\n    self.AddObject (Thestrings[Runner],TheStrings.Objects[Runner]);\r\nend;\r\n\r\nprocedure TStrings.AddStrings(const TheStrings: array of string);\r\n\r\nVar Runner : longint;\r\nbegin\r\n  if Count + High(TheStrings)+1 > Capacity then\r\n    Capacity := Count + High(TheStrings)+1;\r\n  For Runner:=Low(TheStrings) to High(TheStrings) do\r\n    self.Add(Thestrings[Runner]);\r\nend;\r\n\r\n\r\nprocedure TStrings.AddStrings(const TheStrings: array of string; ClearFirst: Boolean);\r\n\r\nbegin\r\n  beginupdate;\r\n  try\r\n    if ClearFirst then\r\n      Clear;\r\n    AddStrings(TheStrings);\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\n\r\nfunction TStrings.AddPair(const AName, AValue: string): TStrings;\r\n\r\nbegin\r\n  Result:=AddPair(AName,AValue,Nil);\r\nend;\r\n\r\nfunction TStrings.AddPair(const AName, AValue: string; AObject: TObject): TStrings;\r\n\r\nbegin\r\n  Result := Self;\r\n  AddObject(AName+NameValueSeparator+AValue, AObject);\r\nend;\r\n\r\n\r\nprocedure TStrings.Assign(Source: TPersistent);\r\n\r\nVar\r\n  S : TStrings;\r\n\r\nbegin\r\n  If Source is TStrings then\r\n    begin\r\n    S:=TStrings(Source);\r\n    BeginUpdate;\r\n    Try\r\n      clear;\r\n      FSpecialCharsInited:=S.FSpecialCharsInited;\r\n      FQuoteChar:=S.FQuoteChar;\r\n      FDelimiter:=S.FDelimiter;\r\n      FNameValueSeparator:=S.FNameValueSeparator;\r\n      FLBS:=S.FLBS;\r\n      FLineBreak:=S.FLineBreak;\r\n      AddStrings(S);\r\n    finally\r\n      EndUpdate;\r\n    end;\r\n    end\r\n  else\r\n    Inherited Assign(Source);\r\nend;\r\n\r\n\r\n\r\nprocedure TStrings.BeginUpdate;\r\n\r\nbegin\r\n   if FUpdateCount = 0 then SetUpdateState(true);\r\n   inc(FUpdateCount);\r\nend;\r\n\r\n\r\n\r\nprocedure TStrings.EndUpdate;\r\n\r\nbegin\r\n  If FUpdateCount>0 then\r\n     Dec(FUpdateCount);\r\n  if FUpdateCount=0 then\r\n    SetUpdateState(False);\r\nend;\r\n\r\n\r\n\r\nfunction TStrings.Equals(Obj: TObject): Boolean;\r\n\r\nbegin\r\n  if Obj is TStrings then\r\n    Result := Equals(TStrings(Obj))\r\n  else\r\n    Result := inherited Equals(Obj);\r\nend;\r\n\r\n\r\n\r\nfunction TStrings.Equals(TheStrings: TStrings): Boolean;\r\n\r\nVar Runner,Nr : Longint;\r\n\r\nbegin\r\n  Result:=False;\r\n  Nr:=Self.Count;\r\n  if Nr<>TheStrings.Count then exit;\r\n  For Runner:=0 to Nr-1 do\r\n    If Strings[Runner]<>TheStrings[Runner] then exit;\r\n  Result:=True;\r\nend;\r\n\r\n\r\n\r\nprocedure TStrings.Exchange(Index1, Index2: Integer);\r\n\r\nVar\r\n  Obj : TObject;\r\n  Str : String;\r\n\r\nbegin\r\n  beginUpdate;\r\n  Try\r\n    Obj:=Objects[Index1];\r\n    Str:=Strings[Index1];\r\n    Objects[Index1]:=Objects[Index2];\r\n    Strings[Index1]:=Strings[Index2];\r\n    Objects[Index2]:=Obj;\r\n    Strings[Index2]:=Str;\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\n\r\nfunction TStrings.GetEnumerator: TStringsEnumerator;\r\nbegin\r\n  Result:=TStringsEnumerator.Create(Self);\r\nend;\r\n\r\n\r\nfunction TStrings.DoCompareText(const s1, s2: string): PtrInt;\r\nbegin\r\n  result:=CompareText(s1,s2);\r\nend;\r\n\r\n\r\nfunction TStrings.IndexOf(const S: string): Integer;\r\nbegin\r\n  Result:=0;\r\n  While (Result<Count) and (DoCompareText(Strings[Result],S)<>0) do Result:=Result+1;\r\n  if Result=Count then Result:=-1;\r\nend;\r\n\r\n\r\nfunction TStrings.IndexOfName(const Name: string): Integer;\r\nVar\r\n  len : longint;\r\n  S : String;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=0;\r\n  while (Result<Count) do\r\n    begin\r\n    S:=Strings[Result];\r\n    len:=pos(FNameValueSeparator,S)-1;\r\n    if (len>=0) and (DoCompareText(Name,Copy(S,1,Len))=0) then\r\n      exit;\r\n    inc(result);\r\n    end;\r\n  result:=-1;\r\nend;\r\n\r\n\r\nfunction TStrings.IndexOfObject(AObject: TObject): Integer;\r\nbegin\r\n  Result:=0;\r\n  While (Result<count) and (Objects[Result]<>AObject) do Result:=Result+1;\r\n  If Result=Count then Result:=-1;\r\nend;\r\n\r\n\r\nprocedure TStrings.InsertObject(Index: Integer; const S: string; AObject: TObject);\r\n\r\nbegin\r\n  Insert (Index,S);\r\n  Objects[Index]:=AObject;\r\nend;\r\n\r\nprocedure TStrings.Move(CurIndex, NewIndex: Integer);\r\nVar\r\n  Obj : TObject;\r\n  Str : String;\r\nbegin\r\n  BeginUpdate;\r\n  Try\r\n    Obj:=Objects[CurIndex];\r\n    Str:=Strings[CurIndex];\r\n    Objects[CurIndex]:=Nil; // Prevent Delete from freeing.\r\n    Delete(Curindex);\r\n    InsertObject(NewIndex,Str,Obj);\r\n  finally\r\n    EndUpdate;\r\n    end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TStrings.SaveToFile(const FileName: string);\r\nvar\r\n  AText: string;\r\nbegin\r\n  AText := self.Text;\r\n  asm\r\n    var element = document.createElement('a');\r\n    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(AText));\r\n    if (FileName != ''){\r\n      element.setAttribute('download', FileName);\r\n    }\r\n    element.style.display = 'none';\r\n    document.body.appendChild(element);\r\n    element.click();\r\n    document.body.removeChild(element);\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TStringList                                  *}\r\n{****************************************************************************}\r\n\r\n\r\nprocedure TStringList.ExchangeItemsInt(Index1, Index2: Integer);\r\n\r\nVar\r\n  S : String;\r\n  O : TObject;\r\n\r\nbegin\r\n  S:=Flist[Index1].FString;\r\n  O:=Flist[Index1].FObject;\r\n  Flist[Index1].Fstring:=Flist[Index2].Fstring;\r\n  Flist[Index1].FObject:=Flist[Index2].FObject;\r\n  Flist[Index2].Fstring:=S;\r\n  Flist[Index2].FObject:=O;\r\nend;\r\n\r\nfunction TStringList.GetSorted: Boolean;\r\nbegin\r\n  Result:=FSortStyle in [sslUser,sslAuto];\r\nend;\r\n\r\n\r\nprocedure TStringList.ExchangeItems(Index1, Index2: Integer);\r\nbegin\r\n  ExchangeItemsInt(Index1, Index2);\r\nend;\r\n\r\n\r\nprocedure TStringList.Grow;\r\n\r\nVar\r\n  NC : Integer;\r\n\r\nbegin\r\n  NC:=Capacity;\r\n  If NC>=256 then\r\n    NC:=NC+(NC Div 4)\r\n  else if NC=0 then\r\n    NC:=4\r\n  else\r\n    NC:=NC*4;\r\n  SetCapacity(NC);\r\nend;\r\n\r\nprocedure TStringList.InternalClear(FromIndex: Integer; ClearOnly: Boolean);\r\n\r\nVar\r\n  I: Integer;\r\n\r\nbegin\r\n  if FromIndex < FCount then\r\n    begin\r\n      if FOwnsObjects then\r\n        begin\r\n          For I:=FromIndex to FCount-1 do\r\n            begin\r\n              Flist[I].FString:='';\r\n              freeandnil(Flist[i].FObject);\r\n            end;\r\n        end\r\n      else\r\n        begin\r\n          For I:=FromIndex to FCount-1 do\r\n            Flist[I].FString:='';\r\n        end;\r\n      FCount:=FromIndex;\r\n    end;\r\n  if Not ClearOnly then\r\n    SetCapacity(0);\r\nend;\r\n\r\n\r\nprocedure TStringList.QuickSort(L, R: Integer; CompareFn: TStringListSortCompare\r\n  );\r\n\r\n\r\nvar\r\n  Pivot, vL, vR: Integer;\r\n\r\nbegin\r\n  //if ExchangeItems is override call that, else call (faster) ExchangeItemsInt\r\n\r\n  if R - L <= 1 then begin // a little bit of time saver\r\n    if L < R then\r\n      if CompareFn(Self, L, R) > 0 then\r\n        ExchangeItems(L, R);\r\n\r\n    Exit;\r\n  end;\r\n\r\n  vL := L;\r\n  vR := R;\r\n\r\n  Pivot := L + Random(R - L); // they say random is best\r\n\r\n  while vL < vR do begin\r\n    while (vL < Pivot) and (CompareFn(Self, vL, Pivot) <= 0) do\r\n      Inc(vL);\r\n\r\n    while (vR > Pivot) and (CompareFn(Self, vR, Pivot) > 0) do\r\n      Dec(vR);\r\n\r\n    ExchangeItems(vL, vR);\r\n\r\n    if Pivot = vL then // swap pivot if we just hit it from one side\r\n      Pivot := vR\r\n    else if Pivot = vR then\r\n      Pivot := vL;\r\n  end;\r\n\r\n  if Pivot - 1 >= L then\r\n    QuickSort(L, Pivot - 1, CompareFn);\r\n  if Pivot + 1 <= R then\r\n    QuickSort(Pivot + 1, R, CompareFn);\r\nend;\r\n\r\n\r\nprocedure TStringList.InsertItem(Index: Integer; const S: string);\r\nbegin\r\n  InsertItem(Index, S, nil);\r\nend;\r\n\r\n\r\nprocedure TStringList.InsertItem(Index: Integer; const S: string; O: TObject);\r\n\r\nVar\r\n  It : TStringItem;\r\n  \r\nbegin\r\n  Changing;\r\n  If FCount=Capacity then Grow;\r\n  it.FString:=S;\r\n  it.FObject:=O;\r\n  TJSArray(FList).Splice(Index,0,It);\r\n  Inc(FCount);\r\n  Changed;\r\nend;\r\n\r\n\r\nprocedure TStringList.SetSorted(Value: Boolean);\r\n\r\nbegin\r\n  If Value then\r\n    SortStyle:=sslAuto\r\n  else\r\n    SortStyle:=sslNone\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.Changed;\r\n\r\nbegin\r\n  If (FUpdateCount=0) Then\r\n   begin\r\n   If Assigned(FOnChange) then\r\n     FOnchange(Self);\r\n   end;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.Changing;\r\n\r\nbegin\r\n  If FUpdateCount=0 then\r\n    if Assigned(FOnChanging) then\r\n      FOnchanging(Self);\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.Get(Index: Integer): string;\r\n\r\nbegin\r\n  CheckIndex(Index);\r\n  Result:=Flist[Index].FString;\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.GetCapacity: Integer;\r\n\r\nbegin\r\n  Result:=Length(FList);\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.GetCount: Integer;\r\n\r\nbegin\r\n  Result:=FCount;\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.GetObject(Index: Integer): TObject;\r\n\r\nbegin\r\n  CheckIndex(Index);\r\n  Result:=Flist[Index].FObject;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.Put(Index: Integer; const S: string);\r\n\r\nbegin\r\n  If Sorted then\r\n    Error(SSortedListError,0);\r\n  CheckIndex(Index);\r\n  Changing;\r\n  Flist[Index].FString:=S;\r\n  Changed;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.PutObject(Index: Integer; AObject: TObject);\r\n\r\nbegin\r\n  CheckIndex(Index);\r\n  Changing;\r\n  Flist[Index].FObject:=AObject;\r\n  Changed;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.SetCapacity(NewCapacity: Integer);\r\n\r\nbegin\r\n  If (NewCapacity<0) then\r\n     Error (SListCapacityError,NewCapacity);\r\n  If NewCapacity<>Capacity then\r\n    SetLength(FList,NewCapacity)\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.SetUpdateState(Updating: Boolean);\r\n\r\nbegin\r\n  If Updating then\r\n    Changing\r\n  else\r\n    Changed\r\nend;\r\n\r\n\r\n\r\ndestructor TStringList.Destroy;\r\n\r\nbegin\r\n  InternalClear;\r\n  Inherited destroy;\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.Add(const S: string): Integer;\r\n\r\nbegin\r\n  If Not (SortStyle=sslAuto) then\r\n    Result:=FCount\r\n  else\r\n    If Find (S,Result) then\r\n      Case DUplicates of\r\n        DupIgnore : Exit;\r\n        DupError : Error(SDuplicateString,0)\r\n      end;\r\n   InsertItem (Result,S);\r\nend;\r\n\r\nprocedure TStringList.Clear;\r\n\r\nbegin\r\n  if FCount = 0 then Exit;\r\n  Changing;\r\n  InternalClear;\r\n  Changed;\r\nend;\r\n\r\nprocedure TStringList.Delete(Index: Integer);\r\n\r\nbegin\r\n  CheckIndex(Index);\r\n  Changing;\r\n  if FOwnsObjects then\r\n    FreeAndNil(Flist[Index].FObject);\r\n  TJSArray(FList).splice(Index,1);  \r\n  FList[Count-1].FString:='';\r\n  Flist[Count-1].FObject:=Nil;\r\n  Dec(FCount);\r\n  Changed;\r\nend;\r\n\r\nprocedure TStringList.Exchange(Index1, Index2: Integer);\r\n\r\nbegin\r\n  CheckIndex(Index1);\r\n  CheckIndex(Index2);\r\n  Changing;\r\n  ExchangeItemsInt(Index1,Index2);\r\n  changed;\r\nend;\r\n\r\nprocedure TStringList.SetCaseSensitive(b : boolean);\r\nbegin\r\n  if b=FCaseSensitive then\r\n    Exit;\r\n  FCaseSensitive:=b;\r\n  if FSortStyle=sslAuto then\r\n    begin\r\n    FForceSort:=True;\r\n    try\r\n      Sort;\r\n    finally\r\n      FForceSort:=False;\r\n    end;\r\n    end;\r\nend;\r\n\r\nprocedure TStringList.SetSortStyle(AValue: TStringsSortStyle);\r\nbegin\r\n  if FSortStyle=AValue then Exit;\r\n  if (AValue=sslAuto) then\r\n    Sort;\r\n  FSortStyle:=AValue;\r\nend;\r\n\r\nprocedure TStringList.CheckIndex(AIndex: Integer);\r\nbegin\r\n  If (AIndex<0) or (AIndex>=FCount) then\r\n    Error(SListIndexError,AIndex);\r\nend;\r\n\r\n\r\nfunction TStringList.DoCompareText(const s1, s2: string): PtrInt;\r\nbegin\r\n  if FCaseSensitive then\r\n    result:=CompareStr(s1,s2)\r\n  else\r\n    result:=CompareText(s1,s2);\r\nend;\r\n\r\n\r\nfunction TStringList.CompareStrings(const s1,s2 : string) : Integer;\r\nbegin\r\n  Result := DoCompareText(s1, s2);\r\nend;\r\n\r\n\r\nfunction TStringList.Find(const S: string; out Index: Integer): Boolean;\r\n\r\nvar\r\n  L, R, I: Integer;\r\n  CompareRes: PtrInt;\r\nbegin\r\n  Result := false;\r\n  Index:=-1;\r\n  if Not Sorted then\r\n    Raise EListError.Create(SErrFindNeedsSortedList);\r\n  // Use binary search.\r\n  L := 0;\r\n  R := Count - 1;\r\n  while (L<=R) do\r\n  begin\r\n    I := L + (R - L) div 2;\r\n    CompareRes := DoCompareText(S, Flist[I].FString);\r\n    if (CompareRes>0) then\r\n      L := I+1\r\n    else begin\r\n      R := I-1;\r\n      if (CompareRes=0) then begin\r\n         Result := true;\r\n         if (Duplicates<>dupAccept) then\r\n            L := I; // forces end of while loop\r\n      end;\r\n    end;\r\n  end;\r\n  Index := L;\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.IndexOf(const S: string): Integer;\r\n\r\nbegin\r\n  If Not Sorted then\r\n    Result:=Inherited indexOf(S)\r\n  else\r\n    // faster using binary search...\r\n    If Not Find (S,Result) then\r\n      Result:=-1;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.Insert(Index: Integer; const S: string);\r\n\r\nbegin\r\n  If SortStyle=sslAuto then\r\n    Error (SSortedListError,0)\r\n  else\r\n    begin\r\n    If (Index<0) or (Index>FCount) then\r\n      Error(SListIndexError,Index); // Cannot use CheckIndex, because there >= FCount...\r\n    InsertItem (Index,S);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TStringList.CustomSort(CompareFn: TStringListSortCompare);\r\n\r\nbegin\r\n  If (FForceSort or (Not (FSortStyle=sslAuto))) and (FCount>1) then\r\n    begin\r\n    Changing;\r\n    QuickSort(0,FCount-1, CompareFn);\r\n    Changed;\r\n    end;\r\nend;\r\n\r\nfunction StringListAnsiCompare(List: TStringList; Index1, Index: Integer): Integer;\r\n\r\nbegin\r\n  Result := List.DoCompareText(List.FList[Index1].FString,\r\n                               List.FList[Index].FString);\r\nend;\r\n\r\nprocedure TStringList.Sort;\r\n\r\nbegin\r\n  CustomSort(@StringListAnsiCompare);\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                             TCollectionItem                              *}\r\n{****************************************************************************}\r\n\r\n\r\nfunction TCollectionItem.GetIndex: Integer;\r\n\r\nbegin\r\n  if Assigned(FCollection) then\r\n    Result:=FCollection.FItems.IndexOf(Self)\r\n  else\r\n    Result:=-1;\r\nend;\r\n\r\n\r\n\r\nprocedure TCollectionItem.SetCollection(Value: TCollection);\r\n\r\nbegin\r\n  IF Value<>FCollection then\r\n    begin\r\n    if Assigned(FCollection) then FCollection.RemoveItem(Self);\r\n    if Assigned(Value) then Value.InsertItem(Self);\r\n    end;\r\nend;\r\n\r\n\r\n\r\nprocedure TCollectionItem.Changed(AllItems: Boolean);\r\n\r\nbegin\r\n If (FCollection<>Nil) and (FCollection.UpdateCount=0) then\r\n  begin\r\n  If AllItems then\r\n    FCollection.Update(Nil)\r\n  else\r\n    FCollection.Update(Self);\r\n  end;\r\nend;\r\n\r\n\r\n\r\nfunction TCollectionItem.GetNamePath: string;\r\n\r\nbegin\r\n  If FCollection<>Nil then\r\n    Result:=FCollection.GetNamePath+'['+IntToStr(Index)+']'\r\n  else\r\n    Result:=ClassName;\r\nend;\r\n\r\n\r\nfunction TCollectionItem.GetOwner: TPersistent;\r\n\r\nbegin\r\n  Result:=FCollection;\r\nend;\r\n\r\n\r\n\r\nfunction TCollectionItem.GetDisplayName: string;\r\n\r\nbegin\r\n  Result:=ClassName;\r\nend;\r\n\r\n\r\n\r\nprocedure TCollectionItem.SetIndex(Value: Integer);\r\n\r\nVar Temp : Longint;\r\n\r\nbegin\r\n  Temp:=GetIndex;\r\n  If (Temp>-1) and (Temp<>Value) then\r\n    begin\r\n    FCollection.FItems.Move(Temp,Value);\r\n    Changed(True);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TCollectionItem.SetDisplayName(const Value: string);\r\n\r\nbegin\r\n  Changed(False);\r\n  if Value='' then ;\r\nend;\r\n\r\n\r\n\r\nconstructor TCollectionItem.Create(ACollection: TCollection);\r\n\r\nbegin\r\n  Inherited Create;\r\n  SetCollection(ACollection);\r\nend;\r\n\r\n\r\n\r\ndestructor TCollectionItem.Destroy;\r\n\r\nbegin\r\n  SetCollection(Nil);\r\n  Inherited Destroy;\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                          TCollectionEnumerator                           *}\r\n{****************************************************************************}\r\n\r\nconstructor TCollectionEnumerator.Create(ACollection: TCollection);\r\nbegin\r\n  inherited Create;\r\n  FCollection := ACollection;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TCollectionEnumerator.GetCurrent: TCollectionItem;\r\nbegin\r\n  Result := FCollection.Items[FPosition];\r\nend;\r\n\r\nfunction TCollectionEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FCollection.Count;\r\nend;\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TCollection                                  *}\r\n{****************************************************************************}\r\n\r\nfunction TCollection.Owner: TPersistent;\r\nbegin\r\n  result:=getowner;\r\nend;\r\n\r\n\r\nfunction TCollection.GetCount: Integer;\r\n\r\nbegin\r\n  Result:=FItems.Count;\r\nend;\r\n\r\n\r\nProcedure TCollection.SetPropName;\r\n\r\n{\r\nVar\r\n  TheOwner : TPersistent;\r\n  PropList : PPropList;\r\n  I, PropCount : Integer;\r\n}\r\nbegin\r\n  FPropName:='';\r\n{\r\n  TheOwner:=GetOwner;\r\n  // TODO: This needs to wait till Mattias finishes typeinfo.\r\n  // It's normally only used in the designer so should not be a problem currently.\r\n  if (TheOwner=Nil) Or (TheOwner.Classinfo=Nil) Then Exit;\r\n  // get information from the owner RTTI\r\n  PropCount:=GetPropList(TheOwner, PropList);\r\n  Try\r\n    For I:=0 To PropCount-1 Do\r\n      If (PropList^[i]^.PropType^.Kind=tkClass) And\r\n         (GetObjectProp(TheOwner, PropList^[i], ClassType)=Self) Then\r\n        Begin\r\n          FPropName:=PropList^[i]^.Name;\r\n          Exit;\r\n        End;\r\n  Finally\r\n    FreeMem(PropList);\r\n  End;\r\n}\r\nend;\r\n\r\n\r\nfunction TCollection.GetPropName: string;\r\n\r\n{Var\r\n  TheOwner : TPersistent;}\r\n\r\nbegin\r\n  Result:=FPropNAme;\r\n//  TheOwner:=GetOwner;\r\n//  If (Result<>'') or (TheOwner=Nil) Or (TheOwner.Classinfo=Nil) then exit;\r\n  SetPropName;\r\n  Result:=FPropName;\r\nend;\r\n\r\n\r\nprocedure TCollection.InsertItem(Item: TCollectionItem);\r\nbegin\r\n  If Not(Item Is FitemClass) then\r\n    exit;\r\n  FItems.add(Item);\r\n  Item.FCollection:=Self;\r\n  Item.FID:=FNextID;\r\n  inc(FNextID);\r\n  SetItemName(Item);\r\n  Notify(Item,cnAdded);\r\n  Changed;\r\nend;\r\n\r\n\r\nprocedure TCollection.RemoveItem(Item: TCollectionItem);\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  Notify(Item,cnExtracting);\r\n  I:=FItems.IndexOfItem(Item,fromEnd);\r\n  If (I<>-1) then\r\n    FItems.Delete(I);\r\n  Item.FCollection:=Nil;\r\n  Changed;\r\nend;\r\n\r\n\r\nfunction TCollection.GetAttrCount: Integer;\r\nbegin\r\n  Result:=0;\r\nend;\r\n\r\n\r\nfunction TCollection.GetAttr(Index: Integer): string;\r\nbegin\r\n  Result:='';\r\n  if Index=0 then ;\r\nend;\r\n\r\n\r\nfunction TCollection.GetItemAttr(Index, ItemIndex: Integer): string;\r\nbegin\r\n  Result:=TCollectionItem(FItems.Items[ItemIndex]).DisplayName;\r\n  if Index=0 then ;\r\nend;\r\n\r\n\r\nfunction TCollection.GetEnumerator: TCollectionEnumerator;\r\nbegin\r\n  Result := TCollectionEnumerator.Create(Self);\r\nend;\r\n\r\n\r\nfunction TCollection.GetNamePath: string;\r\nvar o : TPersistent;\r\nbegin\r\n  o:=getowner;\r\n  if assigned(o) and (propname<>'') then\r\n     result:=o.getnamepath+'.'+propname\r\n   else\r\n     result:=classname;\r\nend;\r\n\r\n\r\nprocedure TCollection.Changed;\r\nbegin\r\n  if FUpdateCount=0 then\r\n    Update(Nil);\r\nend;\r\n\r\n\r\nfunction TCollection.GetItem(Index: Integer): TCollectionItem;\r\nbegin\r\n  Result:=TCollectionItem(FItems.Items[Index]);\r\nend;\r\n\r\n\r\nprocedure TCollection.SetItem(Index: Integer; Value: TCollectionItem);\r\nbegin\r\n  TCollectionItem(FItems.items[Index]).Assign(Value);\r\nend;\r\n\r\n\r\nprocedure TCollection.SetItemName(Item: TCollectionItem);\r\nbegin\r\n  if Item=nil then ;\r\nend;\r\n\r\nprocedure TCollection.Update(Item: TCollectionItem);\r\nbegin\r\n  if Item=nil then ;\r\nend;\r\n\r\n\r\nconstructor TCollection.Create(AItemClass: TCollectionItemClass);\r\nbegin\r\n  inherited create;\r\n  FItemClass:=AItemClass;\r\n  FItems:=TFpList.Create;\r\nend;\r\n\r\n\r\ndestructor TCollection.Destroy;\r\nbegin\r\n  FUpdateCount:=1; // Prevent OnChange\r\n  try\r\n    DoClear;\r\n  Finally\r\n    FUpdateCount:=0;\r\n  end;\r\n  if assigned(FItems) then\r\n    FItems.Destroy;\r\n  Inherited Destroy;\r\nend;\r\n\r\n\r\nfunction TCollection.Add: TCollectionItem;\r\nbegin\r\n  Result:=FItemClass.Create(Self);\r\nend;\r\n\r\n\r\nprocedure TCollection.Assign(Source: TPersistent);\r\nVar I : Longint;\r\nbegin\r\n  If Source is TCollection then\r\n    begin\r\n    Clear;\r\n    For I:=0 To TCollection(Source).Count-1 do\r\n     Add.Assign(TCollection(Source).Items[I]);\r\n    exit;\r\n    end\r\n  else\r\n    Inherited Assign(Source);\r\nend;\r\n\r\n\r\nprocedure TCollection.BeginUpdate;\r\nbegin\r\n  inc(FUpdateCount);\r\nend;\r\n\r\n\r\nprocedure TCollection.Clear;\r\nbegin\r\n  if FItems.Count=0 then\r\n    exit; // Prevent Changed\r\n  BeginUpdate;\r\n  try\r\n    DoClear;\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TCollection.DoClear;\r\nvar\r\n  Item: TCollectionItem;\r\nbegin\r\n  While FItems.Count>0 do\r\n    begin\r\n    Item:=TCollectionItem(FItems.Last);\r\n    if Assigned(Item) then\r\n      Item.Destroy;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TCollection.EndUpdate;\r\nbegin\r\n  if FUpdateCount>0 then\r\n    dec(FUpdateCount);\r\n  if FUpdateCount=0 then\r\n    Changed;\r\nend;\r\n\r\n\r\nfunction TCollection.FindItemID(ID: Integer): TCollectionItem;\r\nVar\r\n          I : Longint;\r\nbegin\r\n  For I:=0 to Fitems.Count-1 do\r\n   begin\r\n     Result:=TCollectionItem(FItems.items[I]);\r\n     If Result.Id=Id then\r\n       exit;\r\n   end;\r\n  Result:=Nil;\r\nend;\r\n\r\n\r\nprocedure TCollection.Delete(Index: Integer);\r\nVar\r\n  Item : TCollectionItem;\r\nbegin\r\n  Item:=TCollectionItem(FItems[Index]);\r\n  Notify(Item,cnDeleting);\r\n  If assigned(Item) then\r\n    Item.Destroy;\r\nend;\r\n\r\n\r\nfunction TCollection.Insert(Index: Integer): TCollectionItem;\r\nbegin\r\n  Result:=Add;\r\n  Result.Index:=Index;\r\nend;\r\n\r\n\r\nprocedure TCollection.Notify(Item: TCollectionItem;Action: TCollectionNotification);\r\nbegin\r\n  if Item=nil then ;\r\n  if Action=cnAdded then ;\r\nend;\r\n\r\nprocedure TCollection.Sort(Const Compare : TCollectionSortCompare);\r\n\r\nbegin\r\n  BeginUpdate;\r\n  try\r\n    FItems.Sort(TListSortCompare(Compare));\r\n  Finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\nprocedure TCollection.SortList(const Compare: TCollectionSortCompareFunc);\r\n\r\nbegin\r\n  BeginUpdate;\r\n  try\r\n    FItems.SortList(TListSortCompareFunc(Compare));\r\n  Finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\nprocedure TCollection.Exchange(Const Index1, index2: integer);\r\n\r\nbegin\r\n  FItems.Exchange(Index1,Index2);\r\nend;\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TOwnedCollection                             *}\r\n{****************************************************************************}\r\n\r\n\r\n\r\nConstructor TOwnedCollection.Create(AOwner: TPersistent; AItemClass: TCollectionItemClass);\r\n\r\nBegin\r\n  FOwner := AOwner;\r\n  inherited Create(AItemClass);\r\nend;\r\n\r\nFunction TOwnedCollection.GetOwner: TPersistent;\r\n\r\nbegin\r\n  Result:=FOwner;\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                             TComponent                                   *}\r\n{****************************************************************************}\r\n\r\n\r\nfunction TComponent.GetComponent(AIndex: Integer): TComponent;\r\n\r\nbegin\r\n  If not assigned(FComponents) then\r\n    Result:=Nil\r\n  else\r\n    Result:=TComponent(FComponents.Items[Aindex]);\r\nend;\r\n\r\nfunction TComponent.GetComponentCount: Integer;\r\n\r\nbegin\r\n  If not assigned(FComponents) then\r\n    result:=0\r\n  else\r\n    Result:=FComponents.Count;\r\nend;\r\n\r\n\r\nfunction TComponent.GetComponentIndex: Integer;\r\n\r\nbegin\r\n  If Assigned(FOwner) and Assigned(FOwner.FComponents) then\r\n    Result:=FOWner.FComponents.IndexOf(Self)\r\n  else\r\n    Result:=-1;\r\nend;\r\n\r\n\r\nprocedure TComponent.Insert(AComponent: TComponent);\r\n\r\nbegin\r\n  If not assigned(FComponents) then\r\n    FComponents:=TFpList.Create;\r\n  FComponents.Add(AComponent);\r\n  AComponent.FOwner:=Self;\r\nend;\r\n\r\n\r\nprocedure TComponent.ReadLeft(AReader: TReader);\r\n\r\nbegin\r\n  FDesignInfo := (FDesignInfo and $ffff0000) or (AReader.ReadInteger and $ffff);\r\nend;\r\n\r\n\r\nprocedure TComponent.ReadTop(AReader: TReader);\r\n\r\nbegin\r\n  FDesignInfo := ((AReader.ReadInteger and $ffff) shl 16) or (FDesignInfo and $ffff);\r\nend;\r\n\r\n\r\nprocedure TComponent.Remove(AComponent: TComponent);\r\n\r\nbegin\r\n  AComponent.FOwner:=Nil;\r\n  If assigned(FCOmponents) then\r\n    begin\r\n    FComponents.Remove(AComponent);\r\n    IF FComponents.Count=0 then\r\n      begin\r\n      FComponents.Destroy;\r\n      FComponents:=Nil;\r\n      end;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.RemoveNotification(AComponent: TComponent);\r\n\r\nbegin\r\n  if FFreeNotifies<>nil then\r\n    begin\r\n    FFreeNotifies.Remove(AComponent);\r\n    if FFreeNotifies.Count=0 then\r\n      begin\r\n      FFreeNotifies.Destroy;\r\n      FFreeNotifies:=nil;\r\n      Exclude(FComponentState,csFreeNotification);\r\n      end;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.SetComponentIndex(Value: Integer);\r\n\r\nVar Temp,Count : longint;\r\n\r\nbegin\r\n  If Not assigned(Fowner) then exit;\r\n  Temp:=getcomponentindex;\r\n  If temp<0 then exit;\r\n  If value<0 then value:=0;\r\n  Count:=Fowner.FComponents.Count;\r\n  If Value>=Count then value:=count-1;\r\n  If Value<>Temp then\r\n    begin\r\n    FOWner.FComponents.Delete(Temp);\r\n    FOwner.FComponents.Insert(Value,Self);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.ChangeName(const NewName: TComponentName);\r\n\r\nbegin\r\n  FName:=NewName;\r\nend;\r\n\r\n\r\nprocedure TComponent.DefineProperties(Filer: TFiler);\r\n\r\nvar\r\n  Temp: LongInt;\r\n  Ancestor: TComponent;\r\nbegin\r\n  Ancestor := TComponent(Filer.Ancestor);\r\n  if Assigned(Ancestor) then\r\n    Temp := Ancestor.FDesignInfo\r\n  else\r\n    Temp := 0;\r\n  Filer.DefineProperty('Left', @ReadLeft, @WriteLeft, (FDesignInfo and $ffff) <> (Temp and $ffff));\r\n  Filer.DefineProperty('Top', @ReadTop, @WriteTop, (FDesignInfo and $ffff0000) <> (Temp and $ffff0000));\r\nend;\r\n\r\n\r\nprocedure TComponent.GetChildren(Proc: TGetChildProc; Root: TComponent);\r\n\r\nbegin\r\n  // Does nothing.\r\n  if Proc=nil then ;\r\n  if Root=nil then ;\r\nend;\r\n\r\n\r\nfunction TComponent.GetChildOwner: TComponent;\r\n\r\nbegin\r\n Result:=Nil;\r\nend;\r\n\r\n\r\nfunction TComponent.GetChildParent: TComponent;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\n\r\nfunction TComponent.GetNamePath: string;\r\n\r\nbegin\r\n  Result:=FName;\r\nend;\r\n\r\n\r\nfunction TComponent.GetOwner: TPersistent;\r\n\r\nbegin\r\n  Result:=FOwner;\r\nend;\r\n\r\n\r\nprocedure TComponent.Loaded;\r\n\r\nbegin\r\n  Exclude(FComponentState,csLoading);\r\nend;\r\n\r\nprocedure TComponent.Loading;\r\n\r\nbegin\r\n  Include(FComponentState,csLoading);\r\nend;\r\n\r\nprocedure TComponent.SetWriting(Value: Boolean);\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csWriting)\r\n  else\r\n    Exclude(FComponentState,csWriting);\r\nend;\r\n\r\nprocedure TComponent.SetReading(Value: Boolean);\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csReading)\r\n  else\r\n    Exclude(FComponentState,csReading);\r\nend;\r\n\r\n\r\nprocedure TComponent.Notification(AComponent: TComponent; Operation: TOperation);\r\n\r\nVar\r\n  C : Longint;\r\n\r\nbegin\r\n  If (Operation=opRemove) then\r\n    RemoveFreeNotification(AComponent);\r\n  If Not assigned(FComponents) then\r\n    exit;\r\n  C:=FComponents.Count-1;\r\n  While (C>=0) do\r\n    begin\r\n    TComponent(FComponents.Items[C]).Notification(AComponent,Operation);\r\n    Dec(C);\r\n    if C>=FComponents.Count then\r\n      C:=FComponents.Count-1;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.PaletteCreated;\r\nbegin\r\nend;\r\n\r\nprocedure TComponent.ReadState(Reader: TReader);\r\n\r\nbegin\r\n  Reader.ReadData(Self);\r\nend;\r\n\r\n\r\nprocedure TComponent.SetAncestor(Value: Boolean);\r\n\r\nVar Runner : Longint;\r\n\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csAncestor)\r\n  else\r\n    Exclude(FCOmponentState,csAncestor);\r\n  if Assigned(FComponents) then\r\n    For Runner:=0 To FComponents.Count-1 do\r\n      TComponent(FComponents.Items[Runner]).SetAncestor(Value);\r\nend;\r\n\r\n\r\nprocedure TComponent.SetDesigning(Value: Boolean; SetChildren: Boolean);\r\n\r\nVar Runner : Longint;\r\n\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csDesigning)\r\n  else\r\n    Exclude(FComponentState,csDesigning);\r\n  if Assigned(FComponents) and SetChildren then\r\n    For Runner:=0 To FComponents.Count - 1 do\r\n      TComponent(FComponents.items[Runner]).SetDesigning(Value);\r\nend;\r\n\r\nprocedure TComponent.SetDesignInstance(Value: Boolean);\r\n\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csDesignInstance)\r\n  else\r\n    Exclude(FComponentState,csDesignInstance);\r\nend;\r\n\r\nprocedure TComponent.SetInline(Value: Boolean);\r\n\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csInline)\r\n  else\r\n    Exclude(FComponentState,csInline);\r\nend;\r\n\r\n\r\nprocedure TComponent.SetName(const NewName: TComponentName);\r\n\r\nbegin\r\n  If FName=NewName then exit;\r\n  If (NewName<>'') and not IsValidIdent(NewName) then\r\n    Raise EComponentError.CreateFmt(SInvalidName,[NewName]);\r\n  If Assigned(FOwner) Then\r\n    FOwner.ValidateRename(Self,FName,NewName)\r\n  else\r\n    ValidateRename(Nil,FName,NewName);\r\n  SetReference(False);\r\n  ChangeName(NewName);\r\n  SetReference(True);\r\nend;\r\n\r\n\r\nprocedure TComponent.SetChildOrder(Child: TComponent; Order: Integer);\r\n\r\nbegin\r\n  // does nothing\r\n  if Child=nil then ;\r\n  if Order=0 then ;\r\nend;\r\n\r\n\r\nprocedure TComponent.SetParentComponent(Value: TComponent);\r\n\r\nbegin\r\n  // Does nothing\r\n  if Value=nil then ;\r\nend;\r\n\r\n\r\nprocedure TComponent.Updating;\r\n\r\nbegin\r\n  Include (FComponentState,csUpdating);\r\nend;\r\n\r\n\r\nprocedure TComponent.Updated;\r\n\r\nbegin\r\n  Exclude(FComponentState,csUpdating);\r\nend;\r\n\r\n\r\nprocedure TComponent.ValidateRename(AComponent: TComponent; const CurName, NewName: string);\r\n\r\nbegin\r\n//!! This contradicts the Delphi manual.\r\n  If (AComponent<>Nil) and (CompareText(CurName,NewName)<>0) and (AComponent.Owner = Self) and\r\n     (FindComponent(NewName)<>Nil) then\r\n      raise EComponentError.Createfmt(SDuplicateName,[newname]);\r\n  If (csDesigning in FComponentState) and (FOwner<>Nil) then\r\n    FOwner.ValidateRename(AComponent,Curname,Newname);\r\nend;\r\n\r\nProcedure TComponent.SetReference(Enable: Boolean);\r\n\r\nvar\r\n  aField, aValue, aOwner : Pointer;\r\n\r\nbegin\r\n  if Name='' then\r\n    exit;\r\n  if Assigned(Owner) then\r\n  begin\r\n    aOwner:=Owner; // so as not to depend on low-level names\r\n    aField := Owner.FieldAddress(Name);\r\n    if Assigned(aField) then\r\n      begin\r\n      if Enable then\r\n        aValue:= Self\r\n      else\r\n        aValue := nil;\r\n      TJSObject(aOwner)[String(TJSObject(aField)['name'])]:=aValue;\r\n      end;\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TComponent.WriteLeft(AWriter: TWriter);\r\n\r\nbegin\r\n  AWriter.WriteInteger(FDesignInfo and $ffff);\r\nend;\r\n\r\n\r\nprocedure TComponent.WriteTop(AWriter: TWriter);\r\n\r\nbegin\r\n  AWriter.WriteInteger((FDesignInfo shr 16) and $ffff);\r\nend;\r\n\r\n\r\nprocedure TComponent.ValidateContainer(AComponent: TComponent);\r\n\r\nbegin\r\n  AComponent.ValidateInsert(Self);\r\nend;\r\n\r\n\r\nprocedure TComponent.ValidateInsert(AComponent: TComponent);\r\n\r\nbegin\r\n  // Does nothing.\r\n  if AComponent=nil then ;\r\nend;\r\n\r\nfunction TComponent._AddRef: Integer;\r\nbegin\r\n  Result:=-1;\r\nend;\r\n\r\nfunction TComponent._Release: Integer;\r\nbegin\r\n  Result:=-1;\r\nend;\r\n\r\n\r\nconstructor TComponent.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  FComponentStyle:=[csInheritable];\r\n  If Assigned(AOwner) then AOwner.InsertComponent(Self);\r\nend;\r\n\r\n\r\ndestructor TComponent.Destroy;\r\n\r\nVar\r\n  I : Integer;\r\n  C : TComponent;\r\n\r\nbegin\r\n  Destroying;\r\n  If Assigned(FFreeNotifies) then\r\n    begin\r\n    I:=FFreeNotifies.Count-1;\r\n    While (I>=0) do\r\n      begin\r\n      C:=TComponent(FFreeNotifies.Items[I]);\r\n      // Delete, so one component is not notified twice, if it is owned.\r\n      FFreeNotifies.Delete(I);\r\n      C.Notification (self,opRemove);\r\n      If (FFreeNotifies=Nil) then\r\n        I:=0\r\n      else if (I>FFreeNotifies.Count) then\r\n        I:=FFreeNotifies.Count;\r\n      dec(i);\r\n      end;\r\n    FreeAndNil(FFreeNotifies);\r\n    end;\r\n  DestroyComponents;\r\n  If FOwner<>Nil Then FOwner.RemoveComponent(Self);\r\n  inherited destroy;\r\nend;\r\n\r\nprocedure TComponent.AfterLoadDFMValues;\r\nbegin\r\n  EndUpdate;\r\n  Loaded;\r\nend;\r\n\r\n\r\nprocedure TComponent.BeforeDestruction;\r\nbegin\r\n  if not(csDestroying in FComponentstate) then\r\n    Destroying;\r\nend;\r\n\r\nprocedure TComponent.BeforeLoadDFMValues;\r\nbegin\r\n  if not(csDesigning in ComponentState) then\r\n    Loading;\r\n  BeginUpdate;\r\nend;\r\n\r\nprocedure TComponent.BeginUpdate;\r\nbegin\r\nend;\r\n\r\nprocedure TComponent.DestroyComponents;\r\n\r\nVar acomponent: TComponent;\r\n\r\nbegin\r\n  While assigned(FComponents) do\r\n    begin\r\n    aComponent:=TComponent(FComponents.Last);\r\n    Remove(aComponent);\r\n    Acomponent.Destroy;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.Destroying;\r\n\r\nVar Runner : longint;\r\n\r\nbegin\r\n  If csDestroying in FComponentstate Then Exit;\r\n  include (FComponentState,csDestroying);\r\n  If Assigned(FComponents) then\r\n    for Runner:=0 to FComponents.Count-1 do\r\n      TComponent(FComponents.Items[Runner]).Destroying;\r\nend;\r\n\r\nprocedure TComponent.EndUpdate;\r\nbegin\r\nend;\r\n\r\nfunction TComponent.QueryInterface(const IID: TGUID; out Obj): HRESULT;\r\nbegin\r\n  if GetInterface(IID, Obj) then\r\n    Result := S_OK\r\n  else\r\n    Result := E_NOINTERFACE;\r\n\r\nend;\r\n\r\nprocedure TComponent.WriteState(Writer: TWriter);\r\nbegin\r\n  Writer.WriteComponentData(Self);\r\nend;\r\n\r\n\r\nfunction TComponent.FindComponent(const AName: string): TComponent;\r\n\r\nVar I : longint;\r\n\r\nbegin\r\n  Result:=Nil;\r\n  If (AName='') or Not assigned(FComponents) then exit;\r\n  For i:=0 to FComponents.Count-1 do\r\n    if (CompareText(TComponent(FComponents[I]).Name,AName)=0) then\r\n      begin\r\n      Result:=TComponent(FComponents.Items[I]);\r\n      exit;\r\n      end;\r\nend;\r\n\r\n\r\nprocedure TComponent.FreeNotification(AComponent: TComponent);\r\n\r\nbegin\r\n  If (Owner<>Nil) and (AComponent=Owner) then exit;\r\n  If not (Assigned(FFreeNotifies)) then\r\n    FFreeNotifies:=TFpList.Create;\r\n  If FFreeNotifies.IndexOf(AComponent)=-1 then\r\n    begin\r\n    FFreeNotifies.Add(AComponent);\r\n    AComponent.FreeNotification (self);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.RemoveFreeNotification(AComponent: TComponent);\r\nbegin\r\n  RemoveNotification(AComponent);\r\n  AComponent.RemoveNotification (self);\r\nend;\r\n\r\n\r\nfunction TComponent.GetParentComponent: TComponent;\r\n\r\nbegin\r\n  Result:=Nil;\r\nend;\r\n\r\n\r\nfunction TComponent.HasParent: Boolean;\r\n\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\n\r\nprocedure TComponent.InsertComponent(AComponent: TComponent);\r\n\r\nbegin\r\n  AComponent.ValidateContainer(Self);\r\n  ValidateRename(AComponent,'',AComponent.FName);\r\n  if AComponent.FOwner <> nil then\r\n    AComponent.FOwner.RemoveComponent(AComponent);\r\n  Insert(AComponent);\r\n  If csDesigning in FComponentState then\r\n    AComponent.SetDesigning(true);\r\n  Notification(AComponent,opInsert);\r\nend;\r\n\r\n\r\nprocedure TComponent.RemoveComponent(AComponent: TComponent);\r\n\r\nbegin\r\n  Notification(AComponent,opRemove);\r\n  Remove(AComponent);\r\n  Acomponent.Setdesigning(False);\r\n  ValidateRename(AComponent,AComponent.FName,'');\r\nend;\r\n\r\nprocedure TComponent.SetSubComponent(ASubComponent: Boolean);\r\nbegin\r\n  if ASubComponent then\r\n    Include(FComponentStyle, csSubComponent)\r\n  else\r\n    Exclude(FComponentStyle, csSubComponent);\r\nend;\r\n\r\nfunction TComponent.GetEnumerator: TComponentEnumerator;\r\nbegin\r\n  Result:=TComponentEnumerator.Create(Self);\r\nend;\r\n\r\nfunction TComponent.GetLeft: Integer;\r\nbegin\r\n  Result := FLeft;\r\nend;\r\n\r\nfunction TComponent.GetTop: Integer;\r\nbegin\r\n  Result := FTop;\r\nend;\r\n\r\nprocedure TComponent.SetLeft(AValue: Integer);\r\nbegin\r\n  FLeft := AValue;\r\nend;\r\n\r\nprocedure TComponent.SetTop(AValue: Integer);\r\nbegin\r\n  FTop := AValue;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TStream\r\n  ---------------------------------------------------------------------}\r\n\r\nResourcestring\r\n  SStreamInvalidSeek = 'Seek is not implemented for class %s';\r\n  SStreamNoReading = 'Stream reading is not implemented for class %s';\r\n  SStreamNoWriting = 'Stream writing is not implemented for class %s';\r\n  SReadError = 'Could not read data from stream';\r\n  SWriteError = 'Could not write data to stream';\r\n  SMemoryStreamError = 'Could not allocate memory';\r\n  SerrInvalidStreamSize = 'Invalid Stream size';\r\n\r\nprocedure TStream.ReadNotImplemented;\r\nbegin\r\n  raise EStreamError.CreateFmt(SStreamNoReading, [ClassName]);\r\nend;\r\n\r\nprocedure TStream.WriteNotImplemented;\r\nbegin\r\n  raise EStreamError.CreateFmt(SStreamNoWriting, [ClassName]);\r\nend;\r\n\r\nfunction TStream.Read(var Buffer: TBytes; Count: Longint): Longint;\r\nbegin\r\n  Result:=Read(Buffer,0,Count);\r\nend;\r\n\r\n\r\n\r\nfunction TStream.Write(const Buffer: TBytes; Count: Longint): Longint;\r\nbegin\r\n  Result:=Self.Write(Buffer,0,Count);\r\nend;\r\n\r\n\r\n\r\nfunction TStream.GetPosition: NativeInt;\r\n\r\nbegin\r\n   Result:=Seek(0,soCurrent);\r\nend;\r\n\r\nprocedure TStream.SetPosition(const Pos: NativeInt);\r\n\r\nbegin\r\n   Seek(pos,soBeginning);\r\nend;\r\n\r\nprocedure TStream.SetSize64(const NewSize: NativeInt);\r\n\r\nbegin\r\n  // Required because can't use overloaded functions in properties\r\n  SetSize(NewSize);\r\nend;\r\n\r\nfunction TStream.GetSize: NativeInt;\r\n\r\nvar\r\n   p : NativeInt;\r\n\r\nbegin\r\n   p:=Seek(0,soCurrent);\r\n   GetSize:=Seek(0,soEnd);\r\n   Seek(p,soBeginning);\r\nend;\r\n\r\nprocedure TStream.SetSize(const NewSize: NativeInt);\r\n\r\nbegin\r\n  if NewSize<0 then\r\n    Raise EStreamError.Create(SerrInvalidStreamSize);\r\nend;\r\n\r\nprocedure TStream.Discard(const Count: NativeInt);\r\n\r\nconst\r\n  CSmallSize      =255;\r\n  CLargeMaxBuffer =32*1024; // 32 KiB\r\n\r\nvar\r\n  Buffer: TBytes;\r\n\r\nbegin\r\n  if Count=0 then\r\n    Exit;\r\n  if (Count<=CSmallSize) then\r\n    begin\r\n    SetLength(Buffer,CSmallSize);\r\n    ReadBuffer(Buffer,Count)\r\n    end\r\n  else\r\n    DiscardLarge(Count,CLargeMaxBuffer);\r\nend;\r\n\r\nprocedure TStream.DiscardLarge(Count: NativeInt; const MaxBufferSize: Longint);\r\n\r\nvar\r\n  Buffer: TBytes;\r\n\r\nbegin\r\n  if Count=0 then\r\n     Exit;\r\n  if Count>MaxBufferSize then\r\n    SetLength(Buffer,MaxBufferSize)\r\n  else\r\n    SetLength(Buffer,Count);\r\n  while (Count>=Length(Buffer)) do\r\n    begin\r\n    ReadBuffer(Buffer,Length(Buffer));\r\n    Dec(Count,Length(Buffer));\r\n    end;\r\n  if Count>0 then\r\n    ReadBuffer(Buffer,Count);\r\nend;\r\n\r\nprocedure TStream.InvalidSeek;\r\n\r\nbegin\r\n  raise EStreamError.CreateFmt(SStreamInvalidSeek, [ClassName]);\r\nend;\r\n\r\nprocedure TStream.FakeSeekForward(Offset: NativeInt;  const Origin: TSeekOrigin; const Pos: NativeInt);\r\n\r\nbegin\r\n  if Origin=soBeginning then\r\n     Dec(Offset,Pos);\r\n  if (Offset<0) or (Origin=soEnd) then\r\n    InvalidSeek;\r\n  if Offset>0 then\r\n    Discard(Offset);\r\n end;\r\n\r\nfunction TStream.ReadData({var} Buffer: TBytes; Count: NativeInt): NativeInt;\r\nbegin\r\n Result:=Read(Buffer,0,Count);\r\nend;\r\n\r\n\r\nfunction TStream.ReadMaxSizeData(Buffer : TBytes; aSize,aCount : NativeInt) : NativeInt;\r\n\r\nVar\r\n  CP : NativeInt;\r\n\r\nbegin\r\n  if aCount<=aSize then\r\n    Result:=read(Buffer,aCount)\r\n  else\r\n    begin\r\n    Result:=Read(Buffer,aSize);\r\n    CP:=Position;\r\n    Result:=Result+Seek(aCount-aSize,soCurrent)-CP;\r\n    end\r\nend;\r\n\r\nfunction TStream.WriteMaxSizeData(const Buffer : TBytes; aSize,aCount : NativeInt) : NativeInt;\r\nVar\r\n  CP : NativeInt;\r\n\r\nbegin\r\n  if aCount<=aSize then\r\n    Result:=Self.Write(Buffer,aCount)\r\n  else\r\n    begin\r\n    Result:=Self.Write(Buffer,aSize);\r\n    CP:=Position;\r\n    Result:=Result+Seek(aCount-aSize,soCurrent)-CP;\r\n    end\r\nend;\r\n\r\nprocedure TStream.WriteExactSizeData(const Buffer : TBytes; aSize, aCount: NativeInt);\r\nbegin\r\n  // Embarcadero docs mentions no exception. Does not seem very logical\r\n  WriteMaxSizeData(Buffer,aSize,ACount);\r\nend;\r\n\r\nprocedure TStream.ReadExactSizeData(Buffer : TBytes; aSize, aCount: NativeInt);\r\nbegin\r\n  if ReadMaxSizeData(Buffer,aSize,ACount)<>aCount then\r\n     Raise EReadError.Create(SReadError);\r\nend;\r\n\r\n\r\nfunction TStream.ReadData(var Buffer: Boolean): NativeInt;\r\n\r\nVar\r\n  B : Byte;\r\n\r\nbegin\r\n  Result:=ReadData(B,1);\r\n  if Result=1 then\r\n    Buffer:=B<>0;\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Boolean; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : TBytes;\r\n\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,1,Count);\r\n  if Result>0 then\r\n    Buffer:=B[0]<>0\r\nend;\r\n\r\n\r\nfunction TStream.ReadData(var Buffer: WideChar): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,2);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: WideChar; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  W : Word;\r\n\r\nbegin\r\n  Result:=ReadData(W,Count);\r\n  if Result=2 then\r\n    Buffer:=WideChar(W);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Int8): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,1);\r\nend;\r\n\r\nFunction TStream.MakeInt(B : TBytes; aSize : Integer; Signed : Boolean) : NativeInt;\r\n\r\nVar\r\n  Mem : TJSArrayBuffer;\r\n  A : TJSUInt8Array;\r\n  D : TJSDataView;\r\n  isLittle : Boolean;\r\n\r\nbegin\r\n  IsLittle:=(Endian=TEndian.Little);\r\n  Mem:=TJSArrayBuffer.New(Length(B));\r\n  A:=TJSUInt8Array.new(Mem);\r\n  A._set(B);\r\n  D:=TJSDataView.New(Mem);\r\n  if Signed then\r\n    case aSize of\r\n      1 : Result:=D.getInt8(0);\r\n      2 : Result:=D.getInt16(0,IsLittle);\r\n      4 : Result:=D.getInt32(0,IsLittle);\r\n      // Todo : fix sign\r\n      8 : Result:=Round(D.getFloat64(0,IsLittle));\r\n    end\r\n  else\r\n    case aSize of\r\n      1 : Result:=D.getUInt8(0);\r\n      2 : Result:=D.getUInt16(0,IsLittle);\r\n      4 : Result:=D.getUInt32(0,IsLittle);\r\n      8 : Result:=Round(D.getFloat64(0,IsLittle));\r\n    end\r\nend;\r\n\r\nfunction TStream.MakeBytes(B: NativeInt; aSize: Integer; Signed: Boolean): TBytes;\r\n\r\n\r\nVar\r\n  Mem : TJSArrayBuffer;\r\n  A : TJSUInt8Array;\r\n  D : TJSDataView;\r\n  isLittle : Boolean;\r\n\r\nbegin\r\n  IsLittle:=(Endian=TEndian.Little);\r\n  Mem:=TJSArrayBuffer.New(aSize);\r\n  D:=TJSDataView.New(Mem);\r\n  if Signed then\r\n    case aSize of\r\n      1 : D.setInt8(0,B);\r\n      2 : D.setInt16(0,B,IsLittle);\r\n      4 : D.setInt32(0,B,IsLittle);\r\n      8 : D.setFloat64(0,B,IsLittle);\r\n    end\r\n  else\r\n    case aSize of\r\n      1 : D.SetUInt8(0,B);\r\n      2 : D.SetUInt16(0,B,IsLittle);\r\n      4 : D.SetUInt32(0,B,IsLittle);\r\n      8 : D.setFloat64(0,B,IsLittle);\r\n    end;\r\n  SetLength(Result,aSize);\r\n  A:=TJSUInt8Array.new(Mem);\r\n  Result:=TMemoryStream.MemoryToBytes(A);\r\nend;\r\n\r\n\r\nfunction TStream.ReadData(var Buffer: Int8; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : TBytes;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,1,Count);\r\n  if Result>=1 then\r\n    Buffer:=MakeInt(B,1,True);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: UInt8): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,1);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: UInt8; Count: NativeInt): NativeInt;\r\nVar\r\n  B : TBytes;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,1,Count);\r\n  if Result>=1 then\r\n    Buffer:=MakeInt(B,1,False);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Int16): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,2);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Int16; Count: NativeInt): NativeInt;\r\nVar\r\n  B : TBytes;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,2,Count);\r\n  if Result>=2 then\r\n    Buffer:=MakeInt(B,2,True);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: UInt16): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,2);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: UInt16; Count: NativeInt): NativeInt;\r\nVar\r\n  B : TBytes;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,2,Count);\r\n  if Result>=2 then\r\n    Buffer:=MakeInt(B,2,False);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Int32): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,4);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Int32; Count: NativeInt): NativeInt;\r\nVar\r\n  B : TBytes;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,4,Count);\r\n  if Result>=4 then\r\n    Buffer:=MakeInt(B,4,True);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: UInt32): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,4);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: UInt32; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : TBytes;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,4,Count);\r\n  if Result>=4 then\r\n    Buffer:=MakeInt(B,4,False);\r\nend;\r\n\r\n\r\nfunction TStream.ReadData(var Buffer: NativeInt): NativeInt;\r\n\r\nbegin\r\n  Result:=ReadData(Buffer,8);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: NativeInt; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : TBytes;\r\n\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,8,8);\r\n  if Result>=8 then\r\n    Buffer:=MakeInt(B,8,True);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: NativeLargeUInt): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,8);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: NativeLargeUInt; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : TBytes;\r\n  B1 : Integer;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,4,4);\r\n  if Result>=4 then\r\n    begin\r\n    B1:=MakeInt(B,4,False);\r\n    Result:=Result+ReadMaxSizeData(B,4,4);\r\n    Buffer:=MakeInt(B,4,False);\r\n    Buffer:=(Buffer shl 32) or B1;\r\n    end;\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Double): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,8);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Double; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : TBytes;\r\n  Mem : TJSArrayBuffer;\r\n  A : TJSUInt8Array;\r\n  D : TJSDataView;\r\n\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,8,Count);\r\n  if Result>=8 then\r\n    begin\r\n    Mem:=TJSArrayBuffer.New(8);\r\n    A:=TJSUInt8Array.new(Mem);\r\n    A._set(B);\r\n    D:=TJSDataView.New(Mem);\r\n    Buffer:=D.getFloat64(0);\r\n    end;\r\nend;\r\n\r\nprocedure TStream.ReadBuffer(var Buffer: TBytes; Count: NativeInt);\r\nbegin\r\n  ReadBuffer(Buffer,0,Count);\r\nend;\r\n\r\nprocedure TStream.ReadBuffer(var Buffer: TBytes; Offset, Count: NativeInt);\r\nbegin\r\n  if Read(Buffer,OffSet,Count)<>Count then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Boolean);\r\nbegin\r\n  ReadBufferData(Buffer,1);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Boolean; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: WideChar);\r\nbegin\r\n  ReadBufferData(Buffer,2);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: WideChar; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Int8);\r\nbegin\r\n  ReadBufferData(Buffer,1);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Int8; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: UInt8);\r\nbegin\r\n  ReadBufferData(Buffer,1);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: UInt8; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Int16);\r\nbegin\r\n  ReadBufferData(Buffer,2);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Int16; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: UInt16);\r\nbegin\r\n  ReadBufferData(Buffer,2);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: UInt16; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Int32);\r\nbegin\r\n  ReadBufferData(Buffer,4);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Int32; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: UInt32);\r\nbegin\r\n  ReadBufferData(Buffer,4);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: UInt32; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: NativeLargeInt);\r\nbegin\r\n  ReadBufferData(Buffer,8)\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: NativeLargeInt; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: NativeLargeUInt);\r\nbegin\r\n  ReadBufferData(Buffer,8);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: NativeLargeUInt; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Double);\r\nbegin\r\n  ReadBufferData(Buffer,8);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Double; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.WriteBuffer(const Buffer: TBytes; Count: NativeInt);\r\nbegin\r\n  WriteBuffer(Buffer,0,Count);\r\nend;\r\n\r\nprocedure TStream.WriteBuffer(const Buffer: TBytes; Offset, Count: NativeInt);\r\nbegin\r\n  if Self.Write(Buffer,Offset,Count)<>Count then\r\n     Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: TBytes; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=Self.Write(Buffer, 0, Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Boolean): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,1);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Boolean; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : Int8;\r\n\r\nbegin\r\n  B:=Ord(Buffer);\r\n  Result:=WriteData(B,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: WideChar): NativeInt;\r\n\r\nbegin\r\n  Result:=WriteData(Buffer,2);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: WideChar; Count: NativeInt): NativeInt;\r\nVar\r\n  U : UInt16;\r\nbegin\r\n  U:=Ord(Buffer);\r\n  Result:=WriteData(U,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Int8): NativeInt;\r\n\r\nbegin\r\n  Result:=WriteData(Buffer,1);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Int8; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,1,True),1,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: UInt8): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,1);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: UInt8; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,1,False),1,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Int16): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,2);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Int16; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,2,True),2,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: UInt16): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,2);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: UInt16; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,2,True),2,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Int32): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,4);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Int32; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,4,True),4,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: UInt32): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,4);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: UInt32; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,4,False),4,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: NativeLargeInt): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,8);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: NativeLargeInt; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,8,True),8,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: NativeLargeUInt): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,8);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: NativeLargeUInt; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,8,False),8,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Double): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,8);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Double; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  Mem : TJSArrayBuffer;\r\n  A : TJSUint8array;\r\n  D : TJSDataview;\r\n  B : TBytes;\r\n  I : Integer;\r\n\r\nbegin\r\n  Mem:=TJSArrayBuffer.New(8);\r\n  D:=TJSDataView.new(Mem);\r\n  D.setFloat64(0,Buffer);\r\n  SetLength(B,8);\r\n  A:=TJSUint8array.New(Mem);\r\n  For I:=0 to 7 do\r\n    B[i]:=A[i];\r\n  Result:=WriteMaxSizeData(B,8,Count);\r\nend;\r\n\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Int32);\r\nbegin\r\n  WriteBufferData(Buffer,4);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Int32; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Boolean);\r\nbegin\r\n  WriteBufferData(Buffer,1);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Boolean; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: WideChar);\r\nbegin\r\n  WriteBufferData(Buffer,2);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: WideChar; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Int8);\r\nbegin\r\n  WriteBufferData(Buffer,1);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Int8; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: UInt8);\r\nbegin\r\n  WriteBufferData(Buffer,1);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: UInt8; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Int16);\r\nbegin\r\n  WriteBufferData(Buffer,2);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Int16; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: UInt16);\r\nbegin\r\n  WriteBufferData(Buffer,2);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: UInt16; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: UInt32);\r\nbegin\r\n  WriteBufferData(Buffer,4);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: UInt32; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: NativeInt);\r\nbegin\r\n  WriteBufferData(Buffer,8);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: NativeInt; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: NativeLargeUInt);\r\nbegin\r\n  WriteBufferData(Buffer,8);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: NativeLargeUInt; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Double);\r\nbegin\r\n  WriteBufferData(Buffer,8);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Double; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\n\r\n\r\nfunction TStream.CopyFrom(Source: TStream; Count: NativeInt): NativeInt;\r\n\r\nvar\r\n   Buffer: TBytes;\r\n   BufferSize, i: LongInt;\r\n\r\nconst\r\n   MaxSize = $20000;\r\nbegin\r\n   Result:=0;\r\n   if Count=0 then\r\n     Source.Position:=0;   // This WILL fail for non-seekable streams...\r\n   BufferSize:=MaxSize;\r\n   if (Count>0) and (Count<BufferSize) then\r\n     BufferSize:=Count;    // do not allocate more than needed\r\n   SetLength(Buffer,BufferSize);\r\n   if Count=0 then\r\n     repeat\r\n       i:=Source.Read(Buffer,BufferSize);\r\n       if i>0 then\r\n         WriteBuffer(Buffer,i);\r\n       Inc(Result,i);\r\n     until i<BufferSize\r\n   else\r\n     while Count>0 do\r\n       begin\r\n       if Count>BufferSize then\r\n         i:=BufferSize\r\n       else\r\n         i:=Count;\r\n       Source.ReadBuffer(Buffer,i);\r\n       WriteBuffer(Buffer,i);\r\n       Dec(count,i);\r\n       Inc(Result,i);\r\n       end;\r\nend;\r\n\r\nfunction TStream.ReadComponent(Instance: TComponent): TComponent;\r\n\r\nvar\r\n  Reader: TReader;\r\n\r\nbegin\r\n  Reader := TReader.Create(Self);\r\n  try\r\n    Result := Reader.ReadRootComponent(Instance);\r\n  finally\r\n    Reader.Free;\r\n  end;\r\nend;\r\n\r\nfunction TStream.ReadComponentRes(Instance: TComponent): TComponent;\r\n\r\nbegin\r\n  ReadResHeader;\r\n  Result := ReadComponent(Instance);\r\nend;\r\n\r\nprocedure TStream.WriteComponent(Instance: TComponent);\r\n\r\nbegin\r\n  WriteDescendent(Instance, nil);\r\nend;\r\n\r\nprocedure TStream.WriteComponentRes(const ResName: string; Instance: TComponent);\r\n\r\nbegin\r\n  WriteDescendentRes(ResName, Instance, nil);\r\nend;\r\n\r\nprocedure TStream.WriteDescendent(Instance, Ancestor: TComponent);\r\n\r\nvar\r\n  Driver : TAbstractObjectWriter;\r\n  Writer : TWriter;\r\n\r\nbegin\r\n  Driver := TBinaryObjectWriter.Create(Self);\r\n  Try\r\n    Writer := TWriter.Create(Driver);\r\n    Try\r\n      Writer.WriteDescendent(Instance, Ancestor);\r\n    Finally\r\n      Writer.Destroy;\r\n    end;\r\n  Finally\r\n    Driver.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TStream.WriteDescendentRes(const ResName: string; Instance, Ancestor: TComponent);\r\n\r\nvar\r\n  FixupInfo: Longint;\r\n\r\nbegin\r\n  { Write a resource header }\r\n  WriteResourceHeader(ResName, FixupInfo);\r\n  { Write the instance itself }\r\n  WriteDescendent(Instance, Ancestor);\r\n  { Insert the correct resource size into the resource header }\r\n  FixupResourceHeader(FixupInfo);\r\nend;\r\n\r\n\r\nprocedure TStream.WriteResourceHeader(const ResName: string; {!!!: out} var FixupInfo: Longint);\r\n  var\r\n    ResType, Flags : word;\r\n    B : Byte;\r\n    I : Integer;\r\n\r\n  begin\r\n     ResType:=Word($000A);\r\n     Flags:=Word($1030);\r\n     { Note: This is a Windows 16 bit resource }\r\n     { Numeric resource type }\r\n     WriteByte($ff);\r\n     { Application defined data }\r\n     WriteWord(ResType);\r\n     { write the name as asciiz }\r\n     For I:=1 to Length(ResName) do\r\n        begin\r\n        B:=Ord(ResName[i]);\r\n        WriteByte(B);\r\n        end;\r\n     WriteByte(0);\r\n     { Movable, Pure and Discardable }\r\n     WriteWord(Flags);\r\n     { Placeholder for the resource size }\r\n     WriteDWord(0);\r\n     { Return current stream position so that the resource size can be\r\n       inserted later }\r\n     FixupInfo := Position;\r\n  end;\r\n\r\nprocedure TStream.FixupResourceHeader(FixupInfo: Longint);\r\n\r\nvar\r\n   ResSize,TmpResSize : Longint;\r\n\r\nbegin\r\n\r\n  ResSize := Position - FixupInfo;\r\n  TmpResSize := longword(ResSize);\r\n\r\n  { Insert the correct resource size into the placeholder written by\r\n    WriteResourceHeader }\r\n  Position := FixupInfo - 4;\r\n  WriteDWord(TmpResSize);\r\n  { Seek back to the end of the resource }\r\n  Position := FixupInfo + ResSize;\r\n\r\nend;\r\n\r\nprocedure TStream.ReadResHeader;\r\n  var\r\n    ResType, Flags : word;\r\n  begin\r\n     try\r\n       { Note: This is a Windows 16 bit resource }\r\n       { application specific resource ? }\r\n       if ReadByte<>$ff then\r\n         raise EInvalidImage.Create(SInvalidImage);\r\n       ResType:=ReadWord;\r\n       if ResType<>$000a then\r\n         raise EInvalidImage.Create(SInvalidImage);\r\n       { read name }\r\n       while ReadByte<>0 do\r\n         ;\r\n       { check the access specifier }\r\n       Flags:=ReadWord;\r\n       if Flags<>$1030 then\r\n         raise EInvalidImage.Create(SInvalidImage);\r\n       { ignore the size }\r\n       ReadDWord;\r\n     except\r\n       on EInvalidImage do\r\n         raise;\r\n       else\r\n         raise EInvalidImage.create(SInvalidImage);\r\n     end;\r\n  end;\r\n\r\n\r\nfunction TStream.ReadByte : Byte;\r\n\r\nbegin\r\n  ReadBufferData(Result,1);\r\nend;\r\n\r\nfunction TStream.ReadWord : Word;\r\n\r\nbegin\r\n  ReadBufferData(Result,2);\r\nend;\r\n\r\nfunction TStream.ReadDWord : Cardinal;\r\n\r\nbegin\r\n  ReadBufferData(Result,4);\r\nend;\r\n\r\nfunction TStream.ReadQWord: NativeLargeUInt;\r\n\r\nbegin\r\n  ReadBufferData(Result,8);\r\nend;\r\n\r\n\r\nprocedure TStream.WriteByte(b : Byte);\r\n\r\nbegin\r\n  WriteBufferData(b,1);\r\nend;\r\n\r\nprocedure TStream.WriteWord(w : Word);\r\n\r\nbegin\r\n  WriteBufferData(W,2);\r\nend;\r\n\r\nprocedure TStream.WriteDWord(d : Cardinal);\r\n\r\nbegin\r\n  WriteBufferData(d,4);\r\nend;\r\n\r\nprocedure TStream.WriteQWord(q: NativeLargeUInt);\r\nbegin\r\n  WriteBufferData(q,8);\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                             TCustomMemoryStream                          *}\r\n{****************************************************************************}\r\n\r\nprocedure TCustomMemoryStream.SetPointer(Ptr: TJSArrayBuffer; ASize: PtrInt);\r\n\r\nbegin\r\n  FMemory:=Ptr;\r\n  FSize:=ASize;\r\n  FDataView:=Nil;\r\n  FDataArray:=Nil;\r\nend;\r\n\r\n\r\nclass function TCustomMemoryStream.MemoryToBytes(Mem: TJSArrayBuffer): TBytes;\r\n\r\nbegin\r\n  Result:=MemoryToBytes(TJSUint8Array.New(Mem));\r\nend;\r\n\r\nclass function TCustomMemoryStream.MemoryToBytes(Mem: TJSUint8Array): TBytes;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  // This must be improved, but needs some asm or TJSFunction.call() to implement answers in\r\n  // https://stackoverflow.com/questions/29676635/convert-uint8array-to-array-in-javascript\r\n  for i:=0 to mem.length-1 do\r\n    Result[i]:=Mem[i];\r\nend;\r\n\r\nclass function TCustomMemoryStream.BytesToMemory(aBytes: TBytes): TJSArrayBuffer;\r\n\r\nVar\r\n  a : TJSUint8Array;\r\n\r\nbegin\r\n  Result:=TJSArrayBuffer.new(Length(aBytes));\r\n  A:=TJSUint8Array.New(Result);\r\n  A._set(aBytes);\r\nend;\r\n\r\nfunction TCustomMemoryStream.GetDataArray: TJSUint8Array;\r\nbegin\r\n  if FDataArray=Nil then\r\n    FDataArray:=TJSUint8Array.new(Memory);\r\n  Result:=FDataArray;\r\nend;\r\n\r\nfunction TCustomMemoryStream.GetDataView: TJSDataview;\r\nbegin\r\n  if FDataView=Nil then\r\n    FDataView:=TJSDataView.New(Memory);\r\n  Result:=FDataView;\r\nend;\r\n\r\nfunction TCustomMemoryStream.GetSize: NativeInt;\r\n\r\nbegin\r\n  Result:=FSize;\r\nend;\r\n\r\nfunction TCustomMemoryStream.GetPosition: NativeInt;\r\nbegin\r\n  Result:=FPosition;\r\nend;\r\n\r\n\r\nfunction TCustomMemoryStream.Read(Buffer: TBytes; Offset, Count: LongInt): LongInt;\r\n\r\nVar\r\n  I,Src,Dest : Integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  If (FSize>0) and (FPosition<Fsize) and (FPosition>=0) then\r\n    begin\r\n    Result:=Count;\r\n    If (Result>(FSize-FPosition)) then\r\n      Result:=(FSize-FPosition);\r\n    Src:=FPosition;\r\n    Dest:=Offset;\r\n    I:=0;\r\n    While I<Result do\r\n      begin\r\n      Buffer[Dest]:=DataView.getUint8(Src);\r\n      inc(Src);\r\n      inc(Dest);\r\n      inc(I);\r\n      end;\r\n    FPosition:=Fposition+Result;\r\n    end;\r\nend;\r\n\r\n\r\nfunction TCustomMemoryStream.Seek(const Offset: NativeInt; Origin: TSeekOrigin): NativeInt;\r\n\r\nbegin\r\n  Case Origin of\r\n    soBeginning : FPosition:=Offset;\r\n    soEnd       : FPosition:=FSize+Offset;\r\n    soCurrent   : FPosition:=FPosition+Offset;\r\n  end;\r\n  if SizeBoundsSeek and (FPosition>FSize) then\r\n    FPosition:=FSize;\r\n  Result:=FPosition;\r\n  {$IFDEF DEBUG}\r\n  if Result < 0 then\r\n    raise Exception.Create('TCustomMemoryStream');\r\n  {$ENDIF}\r\nend;\r\n\r\n\r\nprocedure TCustomMemoryStream.SaveToStream(Stream: TStream);\r\n\r\nbegin\r\n  if FSize>0 then\r\n    Stream.WriteBuffer(TMemoryStream.MemoryToBytes(Memory),FSize);\r\nend;\r\n\r\nprocedure TCustomMemoryStream.LoadFromURL(const aURL: String; Async: Boolean; OnLoaded: TNotifyEventRef; OnError: TStringNotifyEventRef = Nil);\r\n\r\n  procedure DoLoaded(const abytes : TJSArrayBuffer);\r\n  begin\r\n    SetPointer(aBytes,aBytes.byteLength);\r\n    if Assigned(OnLoaded) then\r\n      OnLoaded(Self);\r\n  end;\r\n\r\n  procedure DoError(const AError : String);\r\n  begin\r\n    if Assigned(OnError) then\r\n      OnError(Self,aError)\r\n    else\r\n      Raise EInOutError.Create('Failed to load from URL:'+aError);\r\n  end;\r\n\r\nbegin\r\n  CheckLoadHelper;\r\n  GlobalLoadHelper.LoadBytes(aURL,aSync,@DoLoaded,@DoError);\r\nend;\r\n\r\nprocedure TCustomMemoryStream.LoadFromFile(const aFileName: String; const OnLoaded: TProc; const AError: TProcString);\r\n\r\nbegin\r\n  LoadFromURL(aFileName,False,\r\n    Procedure (Sender : TObject)\r\n    begin\r\n      If Assigned(OnLoaded) then\r\n       OnLoaded\r\n    end,\r\n    Procedure (Sender : TObject; Const ErrorMsg : String)\r\n    begin\r\n      if Assigned(aError) then\r\n        aError(ErrorMsg)\r\n    end);\r\nend;\r\n\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TMemoryStream                                *}\r\n{****************************************************************************}\r\n\r\n\r\nConst TMSGrow = 4096; { Use 4k blocks. }\r\n\r\nprocedure TMemoryStream.SetCapacity(NewCapacity: PtrInt);\r\n\r\nbegin\r\n  SetPointer (Realloc(NewCapacity),Fsize);\r\n  FCapacity:=NewCapacity;\r\nend;\r\n\r\n\r\nfunction TMemoryStream.Realloc(var NewCapacity: PtrInt): TJSArrayBuffer;\r\n\r\nVar\r\n  GC : PtrInt;\r\n  DestView : TJSUInt8array;\r\n\r\nbegin\r\n  If NewCapacity<0 Then\r\n    NewCapacity:=0\r\n  else\r\n    begin\r\n      GC:=FCapacity + (FCapacity div 4);\r\n      // if growing, grow at least a quarter\r\n      if (NewCapacity>FCapacity) and (NewCapacity < GC) then\r\n        NewCapacity := GC;\r\n      // round off to block size.\r\n      NewCapacity := (NewCapacity + (TMSGrow-1)) and not (TMSGROW-1);\r\n    end;\r\n  // Only now check !\r\n  If NewCapacity=FCapacity then\r\n    Result:=FMemory\r\n  else if NewCapacity=0 then\r\n    Result:=Nil\r\n  else\r\n    begin\r\n    // New buffer\r\n    Result:=TJSArrayBuffer.New(NewCapacity);\r\n    If (Result=Nil)  then\r\n      Raise EStreamError.Create(SMemoryStreamError);\r\n    // Transfer\r\n    DestView:=TJSUInt8array.New(Result);\r\n    Destview._Set(Self.DataArray);\r\n    end;\r\nend;\r\n\r\n\r\ndestructor TMemoryStream.Destroy;\r\n\r\nbegin\r\n  Clear;\r\n  Inherited Destroy;\r\nend;\r\n\r\n\r\nprocedure TMemoryStream.Clear;\r\n\r\nbegin\r\n  FSize:=0;\r\n  FPosition:=0;\r\n  SetCapacity (0);\r\nend;\r\n\r\n\r\nprocedure TMemoryStream.LoadFromStream(Stream: TStream);\r\n\r\nbegin\r\n  Position:=0;\r\n  Stream.Position:=0;\r\n  SetSize(Stream.Size);\r\n  If (Size>0) then\r\n    CopyFrom(Stream,0);\r\nend;\r\n\r\nprocedure TMemoryStream.SetSize(const NewSize: NativeInt);\r\n\r\nbegin\r\n  SetCapacity (NewSize);\r\n  FSize:=NewSize;\r\n  IF FPosition>FSize then\r\n    FPosition:=FSize;\r\nend;\r\n\r\nfunction TMemoryStream.Write(Const Buffer : TBytes; Count: LongInt): LongInt;\r\nbegin\r\n  Result := Write(Buffer, 0, Count);\r\nend;\r\n\r\nfunction TMemoryStream.Write(Const Buffer : TBytes; OffSet, Count: LongInt): LongInt;\r\n\r\nVar NewPos : PtrInt;\r\n\r\nbegin\r\n  If (Count=0) or (FPosition<0) then\r\n    exit(0);\r\n  NewPos:=FPosition+Count;\r\n  If NewPos>Fsize then\r\n    begin\r\n    IF NewPos>FCapacity then\r\n      SetCapacity (NewPos);\r\n    FSize:=Newpos;\r\n    end;\r\n  DataArray._set(Copy(Buffer,Offset,Count),FPosition);\r\n  FPosition:=NewPos;\r\n  Result:=Count;\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                              TBytesStream                                *}\r\n{****************************************************************************}\r\n\r\nconstructor TBytesStream.Create(const ABytes: TBytes);\r\nbegin\r\n  inherited Create;\r\n  SetPointer(TMemoryStream.BytesToMemory(aBytes),Length(ABytes));\r\n  FCapacity:=Length(ABytes);\r\nend;\r\n\r\nfunction TBytesStream.GetBytes: TBytes;\r\nbegin\r\n  Result:=TMemoryStream.MemoryToBytes(Memory);\r\nend;\r\n\r\n{ *********************************************************************\r\n  *                         TFiler                                    *\r\n  *********************************************************************}\r\n\r\nprocedure TFiler.SetRoot(ARoot: TComponent);\r\nbegin\r\n  FRoot := ARoot;\r\nend;\r\n\r\n\r\n{\r\n    This file is part of the Free Component Library (FCL)\r\n    Copyright (c) 1999-2000 by the Free Pascal development team\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\n{****************************************************************************}\r\n{*                       TBinaryObjectReader                                *}\r\n{****************************************************************************}\r\n\r\n\r\nfunction TBinaryObjectReader.ReadWord : word;\r\nbegin\r\n  FStream.ReadBufferData(Result);\r\nend;\r\n\r\nfunction TBinaryObjectReader.ReadDWord : longword;\r\nbegin\r\n  FStream.ReadBufferData(Result);\r\nend;\r\n\r\n\r\nconstructor TBinaryObjectReader.Create(Stream: TStream);\r\nbegin\r\n  inherited Create;\r\n  If (Stream=Nil) then\r\n    Raise EReadError.Create(SEmptyStreamIllegalReader);\r\n  FStream := Stream;\r\nend;\r\n\r\nfunction TBinaryObjectReader.ReadValue: TValueType;\r\nvar\r\n  b: byte;\r\nbegin\r\n  FStream.ReadBufferData(b);\r\n  Result := TValueType(b);\r\nend;\r\n\r\nfunction TBinaryObjectReader.NextValue: TValueType;\r\nbegin\r\n  Result := ReadValue;\r\n  { We only 'peek' at the next value, so seek back to unget the read value: }\r\n  FStream.Seek(-1,soCurrent);\r\nend;\r\n\r\nprocedure TBinaryObjectReader.BeginRootComponent;\r\nbegin\r\n  { Read filer signature }\r\n  ReadSignature;\r\nend;\r\n\r\nprocedure TBinaryObjectReader.BeginComponent(var Flags: TFilerFlags;\r\n  var AChildPos: Integer; var CompClassName, CompName: String);\r\nvar\r\n  Prefix: Byte;\r\n  ValueType: TValueType;\r\nbegin\r\n  { Every component can start with a special prefix: }\r\n  Flags := [];\r\n  if (Byte(NextValue) and $f0) = $f0 then\r\n  begin\r\n    Prefix := Byte(ReadValue);\r\n    Flags:=[];\r\n    if (Prefix and $01)<>0 then\r\n      Include(Flags,ffInherited);\r\n    if (Prefix and $02)<>0 then\r\n      Include(Flags,ffChildPos);\r\n    if (Prefix and $04)<>0 then\r\n      Include(Flags,ffInline);\r\n    if ffChildPos in Flags then\r\n    begin\r\n      ValueType := ReadValue;\r\n      case ValueType of\r\n        vaInt8:\r\n          AChildPos := ReadInt8;\r\n        vaInt16:\r\n          AChildPos := ReadInt16;\r\n        vaInt32:\r\n          AChildPos := ReadInt32;\r\n        vaNativeInt:\r\n          AChildPos := ReadNativeInt;\r\n        else\r\n          raise EReadError.Create(SInvalidPropertyValue);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  CompClassName := ReadStr;\r\n  CompName := ReadStr;\r\nend;\r\n\r\nfunction TBinaryObjectReader.BeginProperty: String;\r\nbegin\r\n  Result := ReadStr;\r\nend;\r\n\r\nprocedure TBinaryObjectReader.Read(var Buffer: TBytes; Count: Longint);\r\nbegin\r\n  FStream.Read(Buffer,Count);\r\nend;\r\n\r\nprocedure TBinaryObjectReader.ReadBinary(const DestData: TMemoryStream);\r\nvar\r\n  BinSize: LongInt;\r\nbegin\r\n  BinSize:=LongInt(ReadDWord);\r\n  DestData.Size := BinSize;\r\n  DestData.CopyFrom(FStream,BinSize);\r\nend;\r\n\r\nfunction TBinaryObjectReader.ReadFloat: Extended;\r\nbegin\r\n  FStream.ReadBufferData(Result);\r\nend;\r\n\r\nfunction TBinaryObjectReader.ReadCurrency: Currency;\r\n\r\nbegin\r\n  Result:=ReadFloat;\r\nend;\r\n\r\nfunction TBinaryObjectReader.ReadIdent(ValueType: TValueType): String;\r\nvar\r\n  i: Byte;\r\n  c : Char;\r\nbegin\r\n  case ValueType of\r\n    vaIdent:\r\n      begin\r\n        FStream.ReadBufferData(i);\r\n        SetLength(Result,i);\r\n        For I:=1 to Length(Result) do\r\n          begin\r\n          FStream.ReadBufferData(C);\r\n          Result[I]:=C;\r\n          end;\r\n      end;\r\n    vaNil:\r\n      Result := 'nil';\r\n    vaFalse:\r\n      Result := 'False';\r\n    vaTrue:\r\n      Result := 'True';\r\n    vaNull:\r\n      Result := 'Null';\r\n  end;\r\nend;\r\n\r\nfunction TBinaryObjectReader.ReadInt8: ShortInt;\r\nbegin\r\n  FStream.ReadBufferData(Result);\r\nend;\r\n\r\nfunction TBinaryObjectReader.ReadInt16: SmallInt;\r\nbegin\r\n  FStream.ReadBufferData(Result);\r\nend;\r\n\r\nfunction TBinaryObjectReader.ReadInt32: LongInt;\r\nbegin\r\n  FStream.ReadBufferData(Result);\r\nend;\r\n\r\nfunction TBinaryObjectReader.ReadNativeInt : NativeInt;\r\nbegin\r\n  FStream.ReadBufferData(Result);\r\nend;\r\n\r\n\r\nfunction TBinaryObjectReader.ReadSet(EnumType: TTypeInfoEnum): Integer;\r\n\r\nvar\r\n  Name: String;\r\n  Value: Integer;\r\n\r\nbegin\r\n  try\r\n    Result := 0;\r\n    while True do\r\n      begin\r\n      Name := ReadStr;\r\n      if Length(Name) = 0 then\r\n        break;\r\n      Value:=EnumType.EnumType.NameToInt[Name];\r\n      if Value=-1 then\r\n        raise EReadError.Create(SInvalidPropertyValue);\r\n      Result:=Result or (1 shl Value);\r\n      end;\r\n  except\r\n    SkipSetBody;\r\n    raise;\r\n  end;\r\nend;\r\n\r\n\r\nConst\r\n  // Integer version of 4 chars 'TPF0'\r\n  FilerSignatureInt = 809914452;\r\n\r\nprocedure TBinaryObjectReader.ReadSignature;\r\n\r\nvar\r\n  Signature: LongInt;\r\n\r\nbegin\r\n  FStream.ReadBufferData(Signature);\r\n  if Signature <> FilerSignatureInt then\r\n    raise EReadError.Create(SInvalidImage);\r\nend;\r\n\r\nfunction TBinaryObjectReader.ReadStr: String;\r\nvar\r\n  l,i: Byte;\r\n  c : Char;\r\nbegin\r\n  FStream.ReadBufferData(L);\r\n  SetLength(Result,L);\r\n  For I:=1 to L do\r\n    begin\r\n    FStream.ReadBufferData(C);\r\n    Result[i]:=C;\r\n    end;\r\nend;\r\n\r\nfunction TBinaryObjectReader.ReadString(StringType: TValueType): String;\r\nvar\r\n  i: Integer;\r\n  C : Char;\r\n\r\nbegin\r\n  Result:='';\r\n  if StringType<>vaString then\r\n    Raise EFilerError.Create('Invalid string type passed to ReadString');\r\n  i:=ReadDWord;\r\n  SetLength(Result, i);\r\n  for I:=1 to Length(Result) do\r\n    begin\r\n    FStream.ReadbufferData(C);\r\n    Result[i]:=C;\r\n    end;\r\nend;\r\n\r\n\r\nfunction TBinaryObjectReader.ReadWideString: WideString;\r\nbegin\r\n  Result:=ReadString(vaWString);\r\nend;\r\n\r\nfunction TBinaryObjectReader.ReadUnicodeString: UnicodeString;\r\n\r\nbegin\r\n  Result:=ReadString(vaWString);\r\nend;\r\n\r\nprocedure TBinaryObjectReader.SkipComponent(SkipComponentInfos: Boolean);\r\nvar\r\n  Flags: TFilerFlags;\r\n  Dummy: Integer;\r\n  CompClassName, CompName: String;\r\nbegin\r\n  if SkipComponentInfos then\r\n    { Skip prefix, component class name and component object name }\r\n    BeginComponent(Flags, Dummy, CompClassName, CompName);\r\n\r\n  { Skip properties }\r\n  while NextValue <> vaNull do\r\n    SkipProperty;\r\n  ReadValue;\r\n\r\n  { Skip children }\r\n  while NextValue <> vaNull do\r\n    SkipComponent(True);\r\n  ReadValue;\r\nend;\r\n\r\nprocedure TBinaryObjectReader.SkipValue;\r\n\r\n  procedure SkipBytes(Count: LongInt);\r\n  var\r\n    Dummy: TBytes;\r\n    SkipNow: Integer;\r\n  begin\r\n    while Count > 0 do\r\n    begin\r\n      if Count > 1024 then\r\n        SkipNow := 1024\r\n      else\r\n        SkipNow := Count;\r\n      SetLength(Dummy,SkipNow);\r\n      Read(Dummy, SkipNow);\r\n      Dec(Count, SkipNow);\r\n    end;\r\n  end;\r\n\r\nvar\r\n  Count: LongInt;\r\nbegin\r\n  case ReadValue of\r\n    vaNull, vaFalse, vaTrue, vaNil: ;\r\n    vaList:\r\n      begin\r\n        while NextValue <> vaNull do\r\n          SkipValue;\r\n        ReadValue;\r\n      end;\r\n    vaInt8:\r\n      SkipBytes(1);\r\n    vaInt16:\r\n      SkipBytes(2);\r\n    vaInt32:\r\n      SkipBytes(4);\r\n    vaInt64,\r\n    vaDouble:\r\n      SkipBytes(8);\r\n    vaIdent:\r\n      ReadStr;\r\n    vaString:\r\n      ReadString(vaString);\r\n    vaBinary:\r\n      begin\r\n        Count:=LongInt(ReadDWord);\r\n        SkipBytes(Count);\r\n      end;\r\n    vaSet:\r\n      SkipSetBody;\r\n    vaCollection:\r\n      begin\r\n        while NextValue <> vaNull do\r\n        begin\r\n          { Skip the order value if present }\r\n          if NextValue in [vaInt8, vaInt16, vaInt32] then\r\n            SkipValue;\r\n          SkipBytes(1);\r\n          while NextValue <> vaNull do\r\n            SkipProperty;\r\n          ReadValue;\r\n        end;\r\n        ReadValue;\r\n      end;\r\n  end;\r\nend;\r\n\r\n{ private methods }\r\n\r\n\r\nprocedure TBinaryObjectReader.SkipProperty;\r\nbegin\r\n  { Skip property name, then the property value }\r\n  ReadStr;\r\n  SkipValue;\r\nend;\r\n\r\nprocedure TBinaryObjectReader.SkipSetBody;\r\nbegin\r\n  while Length(ReadStr) > 0 do;\r\nend;\r\n\r\n\r\n  // Quadruple representing an unresolved component property.\r\nType\r\n  { TUnresolvedReference }\r\n\r\n  TUnresolvedReference = class(TlinkedListItem)\r\n  Private\r\n    FRoot: TComponent;     // Root component when streaming\r\n    FPropInfo: TTypeMemberProperty;  // Property to set.\r\n    FGlobal,               // Global component.\r\n    FRelative : string;    // Path relative to global component.\r\n    Function Resolve(Instance : TPersistent) : Boolean; // Resolve this reference\r\n    Function RootMatches(ARoot : TComponent) : Boolean; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE} // True if Froot matches or ARoot is nil.\r\n    Function NextRef : TUnresolvedReference; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n  end;\r\n\r\n  TLocalUnResolvedReference = class(TUnresolvedReference)\r\n    Finstance : TPersistent;\r\n  end;\r\n\r\n  // Linked list of TPersistent items that have unresolved properties.\r\n\r\n  { TUnResolvedInstance }\r\n\r\n  TUnResolvedInstance = Class(TLinkedListItem)\r\n  Public\r\n    Instance : TPersistent; // Instance we're handling unresolveds for\r\n    FUnresolved : TLinkedList; // The list\r\n    Destructor Destroy; override;\r\n    Function AddReference(ARoot : TComponent; APropInfo : TTypeMemberProperty; AGlobal,ARelative : String) : TUnresolvedReference;\r\n    Function RootUnresolved : TUnresolvedReference; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE} // Return root element in list.\r\n    Function ResolveReferences : Boolean; // Return true if all unresolveds were resolved.\r\n  end;\r\n\r\n  // Builds a list of TUnResolvedInstances, removes them from global list on free.\r\n  TBuildListVisitor = Class(TLinkedListVisitor)\r\n  Private\r\n    List : TFPList;\r\n  Public\r\n    Procedure Add(Item : TlinkedListItem); // Add TUnResolvedInstance item to list. Create list if needed\r\n    Destructor Destroy; override; // All elements in list (if any) are removed from the global list.\r\n  end;\r\n\r\n  // Visitor used to try and resolve instances in the global list\r\n  TResolveReferenceVisitor = Class(TBuildListVisitor)\r\n    Function Visit(Item : TLinkedListItem) : Boolean; override;\r\n  end;\r\n\r\n  // Visitor used to remove all references to a certain component.\r\n  TRemoveReferenceVisitor = Class(TBuildListVisitor)\r\n  Private\r\n    FRef : String;\r\n    FRoot : TComponent;\r\n  Public\r\n    Constructor Create(ARoot : TComponent;Const ARef : String);\r\n    Function Visit(Item : TLinkedListItem) : Boolean; override;\r\n  end;\r\n\r\n  // Visitor used to collect reference names.\r\n  TReferenceNamesVisitor = Class(TLinkedListVisitor)\r\n  Private\r\n    FList : TStrings;\r\n    FRoot : TComponent;\r\n  Public\r\n    Function Visit(Item : TLinkedListItem) : Boolean; override;\r\n    Constructor Create(ARoot : TComponent;AList : TStrings);\r\n  end;\r\n\r\n  // Visitor used to collect instance names.\r\n  TReferenceInstancesVisitor = Class(TLinkedListVisitor)\r\n  Private\r\n    FList : TStrings;\r\n    FRef  : String;\r\n    FRoot : TComponent;\r\n  Public\r\n    Function Visit(Item : TLinkedListItem) : Boolean; override;\r\n    Constructor Create(ARoot : TComponent;Const ARef : String; AList : TStrings);\r\n  end;\r\n\r\n  // Visitor used to redirect links to another root component.\r\n  TRedirectReferenceVisitor = Class(TLinkedListVisitor)\r\n  Private\r\n    FOld,\r\n    FNew : String;\r\n    FRoot : TComponent;\r\n  Public\r\n    Function Visit(Item : TLinkedListItem) : Boolean; override;\r\n    Constructor Create(ARoot : TComponent;Const AOld,ANew : String);\r\n  end;\r\n\r\nvar\r\n  NeedResolving : TLinkedList;\r\n\r\n// Add an instance to the global list of instances which need resolving.\r\nFunction FindUnresolvedInstance(AInstance: TPersistent) : TUnResolvedInstance;\r\n\r\nbegin\r\n  Result:=Nil;\r\n{$ifdef FPC_HAS_FEATURE_THREADING}\r\n  EnterCriticalSection(ResolveSection);\r\n  Try\r\n{$endif}\r\n    If Assigned(NeedResolving) then\r\n      begin\r\n      Result:=TUnResolvedInstance(NeedResolving.Root);\r\n      While (Result<>Nil) and (Result.Instance<>AInstance) do\r\n        Result:=TUnResolvedInstance(Result.Next);\r\n      end;\r\n{$ifdef FPC_HAS_FEATURE_THREADING}\r\n  finally\r\n    LeaveCriticalSection(ResolveSection);\r\n  end;\r\n{$endif}\r\nend;\r\n\r\nFunction AddtoResolveList(AInstance: TPersistent) : TUnResolvedInstance;\r\n\r\nbegin\r\n  Result:=FindUnresolvedInstance(AInstance);\r\n  If (Result=Nil) then\r\n    begin\r\n{$ifdef FPC_HAS_FEATURE_THREADING}\r\n    EnterCriticalSection(ResolveSection);\r\n    Try\r\n{$endif}\r\n      If not Assigned(NeedResolving) then\r\n        NeedResolving:=TLinkedList.Create(TUnResolvedInstance);\r\n      Result:=NeedResolving.Add as TUnResolvedInstance;\r\n      Result.Instance:=AInstance;\r\n{$ifdef FPC_HAS_FEATURE_THREADING}\r\n    finally\r\n      LeaveCriticalSection(ResolveSection);\r\n    end;\r\n{$endif}\r\n    end;\r\nend;\r\n\r\n// Walk through the global list of instances to be resolved.\r\n\r\nProcedure VisitResolveList(V : TLinkedListVisitor);\r\n\r\nbegin\r\n{$ifdef FPC_HAS_FEATURE_THREADING}\r\n  EnterCriticalSection(ResolveSection);\r\n  Try\r\n{$endif}\r\n    try\r\n      NeedResolving.Foreach(V);\r\n    Finally\r\n      FreeAndNil(V);\r\n    end;\r\n{$ifdef FPC_HAS_FEATURE_THREADING}\r\n  Finally\r\n    LeaveCriticalSection(ResolveSection);\r\n  end;\r\n{$endif}\r\nend;\r\n\r\nprocedure GlobalFixupReferences;\r\n\r\nbegin\r\n  If (NeedResolving=Nil) then\r\n    Exit;\r\n{$ifdef FPC_HAS_FEATURE_THREADING}\r\n  GlobalNameSpace.BeginWrite;\r\n  try\r\n{$endif}\r\n    VisitResolveList(TResolveReferenceVisitor.Create);\r\n{$ifdef FPC_HAS_FEATURE_THREADING}\r\n  finally\r\n    GlobalNameSpace.EndWrite;\r\n  end;\r\n{$endif}\r\nend;\r\n\r\n\r\nprocedure GetFixupReferenceNames(Root: TComponent; Names: TStrings);\r\n\r\nbegin\r\n  If (NeedResolving=Nil) then\r\n    Exit;\r\n  VisitResolveList(TReferenceNamesVisitor.Create(Root,Names));\r\nend;\r\n\r\nprocedure GetFixupInstanceNames(Root: TComponent; const ReferenceRootName: string; Names: TStrings);\r\n\r\nbegin\r\n  If (NeedResolving=Nil) then\r\n    Exit;\r\n  VisitResolveList(TReferenceInstancesVisitor.Create(Root,ReferenceRootName,Names));\r\nend;\r\n\r\nprocedure ObjectBinaryToText(aInput, aOutput: TStream);\r\nbegin\r\n  ObjectBinaryToText(aInput,aOutput,oteLFM);\r\nend;\r\n\r\nprocedure ObjectBinaryToText(aInput, aOutput: TStream; aEncoding: TObjectTextEncoding);\r\n\r\nvar\r\n  Conv : TObjectStreamConverter;\r\n\r\nbegin\r\n  Conv:=TObjectStreamConverter.Create;\r\n  try\r\n    Conv.ObjectBinaryToText(aInput,aOutput,aEncoding);\r\n  finally\r\n    Conv.Free;\r\n  end;\r\nend;\r\n\r\nprocedure RedirectFixupReferences(Root: TComponent; const OldRootName, NewRootName: string);\r\n\r\nbegin\r\n  If (NeedResolving=Nil) then\r\n      Exit;\r\n  VisitResolveList(TRedirectReferenceVisitor.Create(Root,OldRootName,NewRootName));\r\nend;\r\n\r\nprocedure RemoveFixupReferences(Root: TComponent; const RootName: string);\r\n\r\nbegin\r\n  If (NeedResolving=Nil) then\r\n      Exit;\r\n  VisitResolveList(TRemoveReferenceVisitor.Create(Root,RootName));\r\nend;\r\n\r\n\r\n{ TUnresolvedReference }\r\n\r\nFunction TUnresolvedReference.Resolve(Instance : TPersistent) : Boolean;\r\n\r\nVar\r\n  C : TComponent;\r\n\r\nbegin\r\n  C:=FindGlobalComponent(FGlobal);\r\n  Result:=(C<>Nil);\r\n  If Result then\r\n    begin\r\n    C:=FindNestedComponent(C,FRelative);\r\n    Result:=C<>Nil;\r\n    If Result then\r\n      SetObjectProp(Instance, FPropInfo,C);\r\n    end;\r\nend;\r\n\r\nFunction TUnresolvedReference.RootMatches(ARoot : TComponent) : Boolean; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n\r\nbegin\r\n  Result:=(ARoot=Nil) or (ARoot=FRoot);\r\nend;\r\n\r\nFunction TUnResolvedReference.NextRef : TUnresolvedReference;\r\n\r\nbegin\r\n  Result:=TUnresolvedReference(Next);\r\nend;\r\n\r\n{ TUnResolvedInstance }\r\n\r\ndestructor TUnResolvedInstance.Destroy;\r\nbegin\r\n  FUnresolved.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TUnResolvedInstance.AddReference(ARoot: TComponent; APropInfo : TTypeMemberProperty; AGlobal, ARelative: String): TUnresolvedReference;\r\nbegin\r\n  If (FUnResolved=Nil) then\r\n    FUnResolved:=TLinkedList.Create(TUnresolvedReference);\r\n  Result:=FUnResolved.Add as TUnresolvedReference;\r\n  Result.FGlobal:=AGLobal;\r\n  Result.FRelative:=ARelative;\r\n  Result.FPropInfo:=APropInfo;\r\n  Result.FRoot:=ARoot;\r\nend;\r\n\r\nFunction TUnResolvedInstance.RootUnresolved : TUnresolvedReference;\r\n\r\nbegin\r\n  Result:=Nil;\r\n  If Assigned(FUnResolved) then\r\n    Result:=TUnresolvedReference(FUnResolved.Root);\r\nend;\r\n\r\nFunction TUnResolvedInstance.ResolveReferences:Boolean;\r\n\r\nVar\r\n  R,RN : TUnresolvedReference;\r\n\r\nbegin\r\n  R:=RootUnResolved;\r\n  While (R<>Nil) do\r\n    begin\r\n    RN:=R.NextRef;\r\n    If R.Resolve(Self.Instance) then\r\n      FUnresolved.RemoveItem(R,True);\r\n    R:=RN;\r\n    end;\r\n  Result:=RootUnResolved=Nil;\r\nend;\r\n\r\n{ TReferenceNamesVisitor }\r\n\r\nConstructor TReferenceNamesVisitor.Create(ARoot : TComponent;AList : TStrings);\r\n\r\nbegin\r\n  FRoot:=ARoot;\r\n  FList:=AList;\r\nend;\r\n\r\nFunction TReferenceNamesVisitor.Visit(Item : TLinkedListItem) : Boolean;\r\n\r\nVar\r\n  R : TUnresolvedReference;\r\n\r\nbegin\r\n  R:=TUnResolvedInstance(Item).RootUnresolved;\r\n  While (R<>Nil) do\r\n    begin\r\n    If R.RootMatches(FRoot) then\r\n      If (FList.IndexOf(R.FGlobal)=-1) then\r\n        FList.Add(R.FGlobal);\r\n    R:=R.NextRef;\r\n    end;\r\n  Result:=True;\r\nend;\r\n\r\n{ TReferenceInstancesVisitor }\r\n\r\nConstructor TReferenceInstancesVisitor.Create(ARoot : TComponent; Const ARef : String;AList : TStrings);\r\n\r\nbegin\r\n  FRoot:=ARoot;\r\n  FRef:=UpperCase(ARef);\r\n  FList:=AList;\r\nend;\r\n\r\nFunction TReferenceInstancesVisitor.Visit(Item : TLinkedListItem) : Boolean;\r\n\r\nVar\r\n  R : TUnresolvedReference;\r\n\r\nbegin\r\n  R:=TUnResolvedInstance(Item).RootUnresolved;\r\n  While (R<>Nil) do\r\n    begin\r\n    If (FRoot=R.FRoot) and (FRef=UpperCase(R.FGLobal)) Then\r\n      If Flist.IndexOf(R.FRelative)=-1 then\r\n        Flist.Add(R.FRelative);\r\n    R:=R.NextRef;\r\n    end;\r\n  Result:=True;\r\nend;\r\n\r\n{ TRedirectReferenceVisitor }\r\n\r\nConstructor TRedirectReferenceVisitor.Create(ARoot : TComponent; Const AOld,ANew  : String);\r\n\r\nbegin\r\n  FRoot:=ARoot;\r\n  FOld:=UpperCase(AOld);\r\n  FNew:=ANew;\r\nend;\r\n\r\nFunction TRedirectReferenceVisitor.Visit(Item : TLinkedListItem) : Boolean;\r\n\r\nVar\r\n  R : TUnresolvedReference;\r\n\r\nbegin\r\n  R:=TUnResolvedInstance(Item).RootUnresolved;\r\n  While (R<>Nil) do\r\n    begin\r\n    If R.RootMatches(FRoot) and (FOld=UpperCase(R.FGLobal)) Then\r\n      R.FGlobal:=FNew;\r\n    R:=R.NextRef;\r\n    end;\r\n  Result:=True;\r\nend;\r\n\r\n{ TRemoveReferenceVisitor }\r\n\r\nConstructor TRemoveReferenceVisitor.Create(ARoot : TComponent; Const ARef  : String);\r\n\r\nbegin\r\n  FRoot:=ARoot;\r\n  FRef:=UpperCase(ARef);\r\nend;\r\n\r\nFunction TRemoveReferenceVisitor.Visit(Item : TLinkedListItem) : Boolean;\r\n\r\nVar\r\n  I : Integer;\r\n  UI : TUnResolvedInstance;\r\n  R : TUnresolvedReference;\r\n  L : TFPList;\r\n\r\nbegin\r\n  UI:=TUnResolvedInstance(Item);\r\n  R:=UI.RootUnresolved;\r\n  L:=Nil;\r\n  Try\r\n    // Collect all matches.\r\n    While (R<>Nil) do\r\n      begin\r\n      If R.RootMatches(FRoot) and ((FRef = '') or (FRef=UpperCase(R.FGLobal))) Then\r\n        begin\r\n        If Not Assigned(L) then\r\n          L:=TFPList.Create;\r\n        L.Add(R);\r\n        end;\r\n      R:=R.NextRef;\r\n      end;\r\n    // Remove all matches.\r\n    IF Assigned(L) then\r\n      begin\r\n      For I:=0 to L.Count-1 do\r\n        UI.FUnresolved.RemoveItem(TLinkedListitem(L[i]),True);\r\n      end;\r\n    // If any references are left, leave them.\r\n    If UI.FUnResolved.Root=Nil then\r\n      begin\r\n      If List=Nil then\r\n        List:=TFPList.Create;\r\n      List.Add(UI);\r\n      end;\r\n  Finally\r\n    L.Free;\r\n  end;\r\n  Result:=True;\r\nend;\r\n\r\n{ TBuildListVisitor }\r\n\r\nProcedure TBuildListVisitor.Add(Item : TlinkedListItem);\r\n\r\nbegin\r\n  If (List=Nil) then\r\n    List:=TFPList.Create;\r\n  List.Add(Item);\r\nend;\r\n\r\nDestructor TBuildListVisitor.Destroy;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  If Assigned(List) then\r\n    For I:=0 to List.Count-1 do\r\n      NeedResolving.RemoveItem(TLinkedListItem(List[I]),True);\r\n  FreeAndNil(List);\r\n  Inherited;\r\nend;\r\n\r\n{ TResolveReferenceVisitor }\r\n\r\nFunction TResolveReferenceVisitor.Visit(Item : TLinkedListItem) : Boolean;\r\n\r\nbegin\r\n  If TUnResolvedInstance(Item).ResolveReferences then\r\n    Add(Item);\r\n  Result:=True;\r\nend;\r\n\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TREADER                                      *}\r\n{****************************************************************************}\r\n\r\n\r\nconstructor TReader.Create(Stream: TStream);\r\nbegin\r\n  inherited Create;\r\n  If (Stream=Nil) then\r\n    Raise EReadError.Create(SEmptyStreamIllegalReader);\r\n  FDriver := CreateDriver(Stream);\r\nend;\r\n\r\ndestructor TReader.Destroy;\r\nbegin\r\n  FDriver.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\n\r\nprocedure TReader.FlushBuffer;\r\nbegin\r\n  Driver.FlushBuffer;\r\nend;\r\n\r\nfunction TReader.CreateDriver(Stream: TStream): TAbstractObjectReader;\r\nbegin\r\n  Result := TBinaryObjectReader.Create(Stream);\r\nend;\r\n\r\nprocedure TReader.BeginReferences;\r\nbegin\r\n  FLoaded := TFpList.Create;\r\nend;\r\n\r\nprocedure TReader.CheckValue(Value: TValueType);\r\nbegin\r\n  if FDriver.NextValue <> Value then\r\n    raise EReadError.Create(SInvalidPropertyValue)\r\n  else\r\n    FDriver.ReadValue;\r\nend;\r\n\r\nprocedure TReader.DefineProperty(const Name: String; AReadData: TReaderProc;\r\n  WriteData: TWriterProc; HasData: Boolean);\r\nbegin\r\n  if Assigned(AReadData) and SameText(Name,FPropName) then\r\n  begin\r\n    AReadData(Self);\r\n    SetLength(FPropName, 0);\r\n  end else if assigned(WriteData) and HasData then\r\n    ;\r\nend;\r\n\r\nprocedure TReader.DefineBinaryProperty(const Name: String;\r\n  AReadData, WriteData: TStreamProc; HasData: Boolean);\r\nvar\r\n  MemBuffer: TMemoryStream;\r\nbegin\r\n  if Assigned(AReadData) and SameText(Name,FPropName) then\r\n  begin\r\n    { Check if the next property really is a binary property}\r\n    if FDriver.NextValue <> vaBinary then\r\n    begin\r\n      FDriver.SkipValue;\r\n      FCanHandleExcepts := True;\r\n      raise EReadError.Create(SInvalidPropertyValue);\r\n    end else\r\n      FDriver.ReadValue;\r\n\r\n    MemBuffer := TMemoryStream.Create;\r\n    try\r\n      FDriver.ReadBinary(MemBuffer);\r\n      FCanHandleExcepts := True;\r\n      AReadData(MemBuffer);\r\n    finally\r\n      MemBuffer.Free;\r\n    end;\r\n    SetLength(FPropName, 0);\r\n  end else if assigned(WriteData) and HasData then ;\r\nend;\r\n\r\nfunction TReader.EndOfList: Boolean;\r\nbegin\r\n  Result := FDriver.NextValue = vaNull;\r\nend;\r\n\r\nprocedure TReader.EndReferences;\r\nbegin\r\n  FLoaded.Free;\r\n  FLoaded := nil;\r\nend;\r\n\r\nfunction TReader.Error(const Message: String): Boolean;\r\nbegin\r\n  Result := False;\r\n  if Assigned(FOnError) then\r\n    FOnError(Self, Message, Result);\r\nend;\r\n\r\nfunction TReader.FindMethod(ARoot: TComponent; const AMethodName: String): CodePointer;\r\nvar\r\n  ErrorResult: Boolean;\r\nbegin\r\n  Result:=nil;\r\n  if (ARoot=Nil) or (aMethodName='') then\r\n    exit;\r\n  Result := ARoot.MethodAddress(AMethodName);\r\n  ErrorResult := Result = nil;\r\n\r\n  { always give the OnFindMethod callback a chance to locate the method }\r\n  if Assigned(FOnFindMethod) then\r\n    FOnFindMethod(Self, AMethodName, Result, ErrorResult);\r\n\r\n  if ErrorResult then\r\n    raise EReadError.Create(SInvalidPropertyValue);\r\nend;\r\n\r\nprocedure TReader.DoFixupReferences;\r\n\r\nVar\r\n  R,RN : TLocalUnresolvedReference;\r\n  G : TUnresolvedInstance;\r\n  Ref : String;\r\n  C : TComponent;\r\n  P : integer;\r\n  L : TLinkedList;\r\n\r\nbegin\r\n  If Assigned(FFixups) then\r\n    begin\r\n    L:=TLinkedList(FFixups);\r\n    R:=TLocalUnresolvedReference(L.Root);\r\n    While (R<>Nil) do\r\n      begin\r\n      RN:=TLocalUnresolvedReference(R.Next);\r\n      Ref:=R.FRelative;\r\n      If Assigned(FOnReferenceName) then\r\n        FOnReferenceName(Self,Ref);\r\n      C:=FindNestedComponent(R.FRoot,Ref);\r\n      If Assigned(C) then\r\n        if R.FPropInfo.TypeInfo.Kind = tkInterface then\r\n          SetInterfaceProp(R.FInstance,R.FPropInfo,C)\r\n        else\r\n          SetObjectProp(R.FInstance,R.FPropInfo,C)\r\n      else\r\n        begin\r\n        P:=Pos('.',R.FRelative);\r\n        If (P<>0) then\r\n          begin\r\n          G:=AddToResolveList(R.FInstance);\r\n          G.Addreference(R.FRoot,R.FPropInfo,Copy(R.FRelative,1,P-1),Copy(R.FRelative,P+1,Length(R.FRelative)-P));\r\n          end;\r\n        end;\r\n      L.RemoveItem(R,True);\r\n      R:=RN;\r\n      end;\r\n    FreeAndNil(FFixups);\r\n    end;\r\nend;\r\n\r\nprocedure TReader.FixupReferences;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  DoFixupReferences;\r\n  GlobalFixupReferences;\r\n  for i := 0 to FLoaded.Count - 1 do\r\n    TComponent(FLoaded[I]).Loaded;\r\nend;\r\n\r\n\r\nfunction TReader.NextValue: TValueType;\r\nbegin\r\n  Result := FDriver.NextValue;\r\nend;\r\n\r\nprocedure TReader.Read(var Buffer : TBytes; Count: LongInt);\r\nbegin\r\n  //This should give an exception if read is not implemented (i.e. TTextObjectReader)\r\n  //but should work with TBinaryObjectReader.\r\n  Driver.Read(Buffer, Count);\r\nend;\r\n\r\nprocedure TReader.PropertyError;\r\nbegin\r\n  FDriver.SkipValue;\r\n  raise EReadError.CreateFmt(SUnknownProperty,[FPropName]);\r\nend;\r\n\r\nfunction TReader.ReadBoolean: Boolean;\r\nvar\r\n  ValueType: TValueType;\r\nbegin\r\n  ValueType := FDriver.ReadValue;\r\n  if ValueType = vaTrue then\r\n    Result := True\r\n  else if ValueType = vaFalse then\r\n    Result := False\r\n  else\r\n    raise EReadError.Create(SInvalidPropertyValue);\r\nend;\r\n\r\nfunction TReader.ReadChar: Char;\r\nvar\r\n  s: String;\r\nbegin\r\n  s := ReadString;\r\n  if Length(s) = 1 then\r\n    Result := s[1]\r\n  else\r\n    raise EReadError.Create(SInvalidPropertyValue);\r\nend;\r\n\r\nfunction TReader.ReadWideChar: WideChar;\r\n\r\nvar\r\n  W: WideString;\r\n\r\nbegin\r\n  W := ReadWideString;\r\n  if Length(W) = 1 then\r\n    Result := W[1]\r\n  else\r\n    raise EReadError.Create(SInvalidPropertyValue);\r\nend;\r\n\r\nfunction TReader.ReadUnicodeChar: UnicodeChar;\r\n\r\nvar\r\n  U: UnicodeString;\r\n\r\nbegin\r\n  U := ReadUnicodeString;\r\n  if Length(U) = 1 then\r\n    Result := U[1]\r\n  else\r\n    raise EReadError.Create(SInvalidPropertyValue);\r\nend;\r\n\r\nprocedure TReader.ReadCollection(Collection: TCollection);\r\nvar\r\n  Item: TCollectionItem;\r\nbegin\r\n  Collection.BeginUpdate;\r\n  if not EndOfList then\r\n    Collection.Clear;\r\n  while not EndOfList do begin\r\n    ReadListBegin;\r\n    Item := Collection.Add;\r\n    while NextValue<>vaNull do\r\n      ReadProperty(Item);\r\n    ReadListEnd;\r\n  end;\r\n  Collection.EndUpdate;\r\n  ReadListEnd;\r\nend;\r\n\r\nfunction TReader.ReadComponent(Component: TComponent): TComponent;\r\nvar\r\n  Flags: TFilerFlags;\r\n\r\n  function Recover(E : Exception; var aComponent: TComponent): Boolean;\r\n  begin\r\n    Result := False;\r\n    if not ((ffInherited in Flags) or Assigned(Component)) then\r\n      aComponent.Free;\r\n    aComponent := nil;\r\n    FDriver.SkipComponent(False);\r\n    Result := Error(E.Message);\r\n  end;\r\n\r\nvar\r\n  CompClassName, Name: String;\r\n  n, ChildPos: Integer;\r\n  SavedParent, SavedLookupRoot: TComponent;\r\n  ComponentClass: TComponentClass;\r\n  C, NewComponent: TComponent;\r\n  SubComponents: TList;\r\nbegin\r\n  FDriver.BeginComponent(Flags, ChildPos, CompClassName, Name);\r\n  SavedParent := Parent;\r\n  SavedLookupRoot := FLookupRoot;\r\n  SubComponents := nil;\r\n  try\r\n    Result := Component;\r\n    if not Assigned(Result) then\r\n      try\r\n        if ffInherited in Flags then\r\n        begin\r\n          { Try to locate the existing ancestor component }\r\n\r\n          if Assigned(FLookupRoot) then\r\n            Result := FLookupRoot.FindComponent(Name)\r\n          else\r\n            Result := nil;\r\n\r\n          if not Assigned(Result) then\r\n          begin\r\n            if Assigned(FOnAncestorNotFound) then\r\n              FOnAncestorNotFound(Self, Name,\r\n                FindComponentClass(CompClassName), Result);\r\n            if not Assigned(Result) then\r\n              raise EReadError.CreateFmt(SAncestorNotFound, [Name]);\r\n          end;\r\n\r\n          Parent := Result.GetParentComponent;\r\n          if not Assigned(Parent) then\r\n            Parent := Root;\r\n        end else\r\n        begin\r\n          Result := nil;\r\n          ComponentClass := FindComponentClass(CompClassName);\r\n          if Assigned(FOnCreateComponent) then\r\n            FOnCreateComponent(Self, ComponentClass, Result);\r\n          if not Assigned(Result) then\r\n          begin\r\n           asm\r\n           NewComponent = Object.create(ComponentClass);\r\n           NewComponent.$init();\r\n           end;\r\n            if ffInline in Flags then\r\n              NewComponent.FComponentState :=\r\n                NewComponent.FComponentState + [csLoading, csInline];\r\n            NewComponent.Create(Owner);\r\n            NewComponent.AfterConstruction;\r\n\r\n            { Don't set Result earlier because else we would come in trouble\r\n              with the exception recover mechanism! (Result should be NIL if\r\n              an error occurred) }\r\n            Result := NewComponent;\r\n          end;\r\n          Include(Result.FComponentState, csLoading);\r\n        end;\r\n      except\r\n        On E: Exception do\r\n          if not Recover(E,Result) then\r\n            raise;\r\n      end;\r\n\r\n    if Assigned(Result) then\r\n      try\r\n        Include(Result.FComponentState, csLoading);\r\n\r\n        { create list of subcomponents and set loading}\r\n        SubComponents := TList.Create;\r\n        for n := 0 to Result.ComponentCount - 1 do\r\n        begin\r\n          C := Result.Components[n];\r\n          if csSubcomponent in C.ComponentStyle\r\n          then begin\r\n            SubComponents.Add(C);\r\n            Include(C.FComponentState, csLoading);\r\n          end;\r\n        end;\r\n\r\n        if not (ffInherited in Flags) then\r\n          try\r\n            Result.SetParentComponent(Parent);\r\n            if Assigned(FOnSetName) then\r\n              FOnSetName(Self, Result, Name);\r\n            Result.Name := Name;\r\n            if FindGlobalComponent(Name) = Result then\r\n              Include(Result.FComponentState, csInline);\r\n          except\r\n            On E : Exception do\r\n              if not Recover(E,Result) then\r\n                raise;\r\n          end;\r\n        if not Assigned(Result) then\r\n          exit;\r\n        if csInline in Result.ComponentState then\r\n          FLookupRoot := Result;\r\n\r\n        { Read the component state }\r\n        Include(Result.FComponentState, csReading);\r\n        for n := 0 to Subcomponents.Count - 1 do\r\n          Include(TComponent(Subcomponents[n]).FComponentState, csReading);\r\n\r\n        Result.ReadState(Self);\r\n\r\n        Exclude(Result.FComponentState, csReading);\r\n        for n := 0 to Subcomponents.Count - 1 do\r\n          Exclude(TComponent(Subcomponents[n]).FComponentState, csReading);\r\n\r\n        if ffChildPos in Flags then\r\n          Parent.SetChildOrder(Result, ChildPos);\r\n\r\n        { Add component to list of loaded components, if necessary }\r\n        if (not ((ffInherited in Flags) or (csInline in Result.ComponentState))) or\r\n          (FLoaded.IndexOf(Result) < 0)\r\n          then begin\r\n            for n := 0 to Subcomponents.Count - 1 do\r\n              FLoaded.Add(Subcomponents[n]);\r\n            FLoaded.Add(Result);\r\n          end;\r\n      except\r\n        if ((ffInherited in Flags) or Assigned(Component)) then\r\n          Result.Free;\r\n        raise;\r\n      end;\r\n  finally\r\n    Parent := SavedParent;\r\n    FLookupRoot := SavedLookupRoot;\r\n    Subcomponents.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TReader.ReadData(Instance: TComponent);\r\nvar\r\n  SavedOwner, SavedParent: TComponent;\r\n\r\nbegin\r\n  { Read properties }\r\n  while not EndOfList do\r\n    ReadProperty(Instance);\r\n  ReadListEnd;\r\n\r\n  { Read children }\r\n  SavedOwner := Owner;\r\n  SavedParent := Parent;\r\n  try\r\n    Owner := Instance.GetChildOwner;\r\n    if not Assigned(Owner) then\r\n      Owner := Root;\r\n    Parent := Instance.GetChildParent;\r\n\r\n    while not EndOfList do\r\n      ReadComponent(nil);\r\n    ReadListEnd;\r\n  finally\r\n    Owner := SavedOwner;\r\n    Parent := SavedParent;\r\n  end;\r\n\r\n  { Fixup references if necessary (normally only if this is the root) }\r\n  If (Instance=FRoot) then\r\n    DoFixupReferences;\r\nend;\r\n\r\nfunction TReader.ReadFloat: Extended;\r\nbegin\r\n  if FDriver.NextValue = vaExtended then\r\n  begin\r\n    ReadValue;\r\n    Result := FDriver.ReadFloat\r\n  end else\r\n    Result := ReadNativeInt;\r\nend;\r\n\r\nprocedure TReader.ReadSignature;\r\nbegin\r\n  FDriver.ReadSignature;\r\nend;\r\n\r\n\r\nfunction TReader.ReadCurrency: Currency;\r\nbegin\r\n  if FDriver.NextValue = vaCurrency then\r\n  begin\r\n    FDriver.ReadValue;\r\n    Result := FDriver.ReadCurrency;\r\n  end else\r\n    Result := ReadInteger;\r\nend;\r\n\r\n\r\nfunction TReader.ReadIdent: String;\r\nvar\r\n  ValueType: TValueType;\r\nbegin\r\n  ValueType := FDriver.ReadValue;\r\n  if ValueType in [vaIdent, vaNil, vaFalse, vaTrue, vaNull] then\r\n    Result := FDriver.ReadIdent(ValueType)\r\n  else\r\n    raise EReadError.Create(SInvalidPropertyValue);\r\nend;\r\n\r\n\r\nfunction TReader.ReadInteger: LongInt;\r\nbegin\r\n  case FDriver.ReadValue of\r\n    vaInt8:\r\n      Result := FDriver.ReadInt8;\r\n    vaInt16:\r\n      Result := FDriver.ReadInt16;\r\n    vaInt32:\r\n      Result := FDriver.ReadInt32;\r\n  else\r\n    raise EReadError.Create(SInvalidPropertyValue);\r\n  end;\r\nend;\r\n\r\nfunction TReader.ReadNativeInt: NativeInt;\r\nbegin\r\n  if FDriver.NextValue = vaInt64 then\r\n  begin\r\n    FDriver.ReadValue;\r\n    Result := FDriver.ReadNativeInt;\r\n  end else\r\n    Result := ReadInteger;\r\nend;\r\n\r\nfunction TReader.ReadSet(EnumType: Pointer): Integer;\r\nbegin\r\n  if FDriver.NextValue = vaSet then\r\n    begin\r\n      FDriver.ReadValue;\r\n      Result := FDriver.ReadSet(enumtype);\r\n    end\r\n  else\r\n    Result := ReadInteger;\r\nend;\r\n\r\nprocedure TReader.ReadListBegin;\r\nbegin\r\n  CheckValue(vaList);\r\nend;\r\n\r\nprocedure TReader.ReadListEnd;\r\nbegin\r\n  CheckValue(vaNull);\r\nend;\r\n\r\nfunction TReader.ReadVariant: JSValue;\r\nvar\r\n  nv: TValueType;\r\nbegin\r\n  nv:=NextValue;\r\n  case nv of\r\n    vaNil:\r\n      begin\r\n        Result:=Undefined;\r\n        readvalue;\r\n      end;\r\n    vaNull:\r\n      begin\r\n        Result:=Nil;\r\n        readvalue;\r\n      end;\r\n    { all integer sizes must be split for big endian systems }\r\n    vaInt8,vaInt16,vaInt32:\r\n      begin\r\n        Result:=ReadInteger;\r\n      end;\r\n    vaInt64:\r\n      begin\r\n        Result:=ReadNativeInt;\r\n      end;\r\n{\r\n    vaQWord:\r\n      begin\r\n        Result:=QWord(ReadInt64);\r\n      end;\r\n}    vaFalse,vaTrue:\r\n      begin\r\n        Result:=(nv<>vaFalse);\r\n        readValue;\r\n      end;\r\n    vaCurrency:\r\n      begin\r\n        Result:=ReadCurrency;\r\n      end;\r\n    vaDouble:\r\n      begin\r\n        Result:=ReadFloat;\r\n      end;\r\n    vaString:\r\n      begin\r\n        Result:=ReadString;\r\n      end;\r\n    else\r\n      raise EReadError.CreateFmt(SUnsupportedPropertyVariantType, [Ord(nv)]);\r\n  end;\r\nend;\r\n\r\nprocedure TReader.ReadProperty(AInstance: TPersistent);\r\nvar\r\n  Path: String;\r\n  Instance: TPersistent;\r\n  PropInfo: TTypeMemberProperty;\r\n  Obj: TObject;\r\n  Name: String;\r\n  Skip: Boolean;\r\n  Handled: Boolean;\r\n  OldPropName: String;\r\n  DotPos : String;\r\n  NextPos: Integer;\r\n\r\n  function HandleMissingProperty(IsPath: Boolean): boolean;\r\n  begin\r\n    Result:=true;\r\n    if Assigned(OnPropertyNotFound) then begin\r\n      // user defined property error handling\r\n      OldPropName:=FPropName;\r\n      Handled:=false;\r\n      Skip:=false;\r\n      OnPropertyNotFound(Self,Instance,FPropName,IsPath,Handled,Skip);\r\n      if Handled and (not Skip) and (OldPropName<>FPropName) then\r\n        // try alias property\r\n        PropInfo := GetPropInfo(Instance.ClassType, FPropName);\r\n      if Skip then begin\r\n        FDriver.SkipValue;\r\n        Result:=false;\r\n        exit;\r\n      end;\r\n    end;\r\n  end;\r\n\r\nbegin\r\n  try\r\n    Path := FDriver.BeginProperty;\r\n    try\r\n      Instance := AInstance;\r\n      FCanHandleExcepts := True;\r\n      DotPos := Path;\r\n      while True do\r\n      begin\r\n        NextPos := Pos('.',DotPos);\r\n        if NextPos>0 then\r\n          FPropName := Copy(DotPos, 1, NextPos-1)\r\n        else\r\n        begin\r\n          FPropName := DotPos;\r\n          break;\r\n        end;\r\n        Delete(DotPos,1,NextPos);\r\n\r\n        PropInfo := GetPropInfo(Instance.ClassType, FPropName);\r\n        if not Assigned(PropInfo) then begin\r\n          if not HandleMissingProperty(true) then exit;\r\n          if not Assigned(PropInfo) then\r\n            PropertyError;\r\n        end;\r\n\r\n        if PropInfo.TypeInfo.Kind = tkClass then\r\n          Obj := TObject(GetObjectProp(Instance, PropInfo))\r\n        //else if PropInfo^.PropType^.Kind = tkInterface then\r\n        //  Obj := TObject(GetInterfaceProp(Instance, PropInfo))\r\n        else\r\n          Obj := nil;\r\n\r\n        if not (Obj is TPersistent) then\r\n        begin\r\n          { All path elements must be persistent objects! }\r\n          FDriver.SkipValue;\r\n          raise EReadError.Create(SInvalidPropertyPath);\r\n        end;\r\n        Instance := TPersistent(Obj);\r\n      end;\r\n\r\n      PropInfo := GetPropInfo(Instance.ClassType, FPropName);\r\n      if Assigned(PropInfo) then\r\n        ReadPropValue(Instance, PropInfo)\r\n      else\r\n      begin\r\n        FCanHandleExcepts := False;\r\n        Instance.DefineProperties(Self);\r\n        FCanHandleExcepts := True;\r\n        if Length(FPropName) > 0 then begin\r\n          if not HandleMissingProperty(false) then exit;\r\n          if not Assigned(PropInfo) then\r\n            PropertyError;\r\n        end;\r\n      end;\r\n    except\r\n      on e: Exception do\r\n      begin\r\n        SetLength(Name, 0);\r\n        if AInstance.InheritsFrom(TComponent) then\r\n          Name := TComponent(AInstance).Name;\r\n        if Length(Name) = 0 then\r\n          Name := AInstance.ClassName;\r\n        raise EReadError.CreateFmt(SPropertyException, [Name, '.', Path, e.Message]);\r\n      end;\r\n    end;\r\n  except\r\n    on e: Exception do\r\n      if not FCanHandleExcepts or not Error(E.Message) then\r\n        raise;\r\n  end;\r\nend;\r\n\r\nprocedure TReader.ReadPropValue(Instance: TPersistent; PropInfo: TTypeMemberProperty);\r\nconst\r\n  NullMethod: TMethod = (Code: nil; Data: nil);\r\nvar\r\n  PropType: TTypeInfo;\r\n  Value: LongInt;\r\n{  IdentToIntFn: TIdentToInt; }\r\n  Ident: String;\r\n  Method: TMethod;\r\n  Handled: Boolean;\r\n  TmpStr: String;\r\nbegin\r\n  if (PropInfo.Setter='') then\r\n    raise EReadError.Create(SReadOnlyProperty);\r\n\r\n  PropType := PropInfo.TypeInfo;\r\n  case PropType.Kind of\r\n    tkInteger:\r\n      case FDriver.NextValue of\r\n        vaIdent :\r\n          begin\r\n          Ident := ReadIdent;\r\n          if GlobalIdentToInt(Ident,Value) then\r\n            SetOrdProp(Instance, PropInfo, Value)\r\n          else\r\n            raise EReadError.Create(SInvalidPropertyValue);\r\n          end;\r\n        vaNativeInt :\r\n          SetOrdProp(Instance, PropInfo, ReadNativeInt);\r\n        vaCurrency:\r\n          SetFloatProp(Instance, PropInfo, ReadCurrency);\r\n      else\r\n        SetOrdProp(Instance, PropInfo, ReadInteger);\r\n      end;\r\n    tkBool:\r\n      SetBoolProp(Instance, PropInfo, ReadBoolean);\r\n    tkChar:\r\n      SetOrdProp(Instance, PropInfo, Ord(ReadChar));\r\n    tkEnumeration:\r\n      begin\r\n        Value := GetEnumValue(TTypeInfoEnum(PropType), ReadIdent);\r\n        if Value = -1 then\r\n          raise EReadError.Create(SInvalidPropertyValue);\r\n        SetOrdProp(Instance, PropInfo, Value);\r\n      end;\r\n{$ifndef FPUNONE}\r\n    tkFloat:\r\n      SetFloatProp(Instance, PropInfo, ReadFloat);\r\n{$endif}\r\n    tkSet:\r\n      begin\r\n        CheckValue(vaSet);\r\n        if TTypeInfoSet(PropType).CompType.Kind=tkEnumeration then\r\n          SetOrdProp(Instance, PropInfo, FDriver.ReadSet(TTypeInfoEnum(TTypeInfoSet(PropType).CompType)));\r\n      end;\r\n    tkMethod, tkRefToProcVar:\r\n      if FDriver.NextValue = vaNil then\r\n      begin\r\n        FDriver.ReadValue;\r\n        SetMethodProp(Instance, PropInfo, NullMethod);\r\n      end else\r\n      begin\r\n        Handled:=false;\r\n        Ident:=ReadIdent;\r\n        if Assigned(OnSetMethodProperty) then\r\n          OnSetMethodProperty(Self,Instance,PropInfo,Ident,Handled);\r\n        if not Handled then begin\r\n          Method.Code := FindMethod(Root, Ident);\r\n          Method.Data := Root;\r\n          if Assigned(Method.Code) then\r\n            SetMethodProp(Instance, PropInfo, Method);\r\n        end;\r\n      end;\r\n    tkString:\r\n      begin\r\n        TmpStr:=ReadString;\r\n        if Assigned(FOnReadStringProperty) then\r\n          FOnReadStringProperty(Self,Instance,PropInfo,TmpStr);\r\n        SetStrProp(Instance, PropInfo, TmpStr);\r\n      end;\r\n    tkJSValue:\r\n      begin\r\n        SetJSValueProp(Instance,PropInfo,ReadVariant);\r\n      end;\r\n    tkClass, tkInterface:\r\n      case FDriver.NextValue of\r\n        vaNil:\r\n          begin\r\n            FDriver.ReadValue;\r\n            SetOrdProp(Instance, PropInfo, 0)\r\n          end;\r\n        vaCollection:\r\n          begin\r\n            FDriver.ReadValue;\r\n            ReadCollection(TCollection(GetObjectProp(Instance, PropInfo)));\r\n          end\r\n        else\r\n          begin\r\n          If Not Assigned(FFixups) then\r\n            FFixups:=TLinkedList.Create(TLocalUnresolvedReference);\r\n          With TLocalUnresolvedReference(TLinkedList(FFixups).Add) do\r\n            begin\r\n            FInstance:=Instance;\r\n            FRoot:=Root;\r\n            FPropInfo:=PropInfo;\r\n            FRelative:=ReadIdent;\r\n            end;\r\n          end;\r\n      end;\r\n    {tkint64:\r\n      SetInt64Prop(Instance, PropInfo, ReadInt64);}\r\n    else\r\n      raise EReadError.CreateFmt(SUnknownPropertyType, [Str(PropType.Kind)]);\r\n  end;\r\nend;\r\n\r\nfunction TReader.ReadRootComponent(ARoot: TComponent): TComponent;\r\nvar\r\n  Dummy, i: Integer;\r\n  Flags: TFilerFlags;\r\n  CompClassName, CompName, ResultName: String;\r\nbegin\r\n  FDriver.BeginRootComponent;\r\n  Result := nil;\r\n  {!!!: GlobalNameSpace.BeginWrite;  // Loading from stream adds to name space\r\n  try}\r\n    try\r\n      FDriver.BeginComponent(Flags, Dummy, CompClassName, CompName);\r\n      if not Assigned(ARoot) then\r\n      begin\r\n        { Read the class name and the object name and create a new object: }\r\n        Result := TComponentClass(FindClass(CompClassName)).Create(nil);\r\n        Result.Name := CompName;\r\n      end else\r\n      begin\r\n        Result := ARoot;\r\n\r\n        if not (csDesigning in Result.ComponentState) then\r\n        begin\r\n          Result.FComponentState :=\r\n            Result.FComponentState + [csLoading, csReading];\r\n\r\n          { We need an unique name }\r\n          i := 0;\r\n          { Don't use Result.Name directly, as this would influence\r\n            FindGlobalComponent in successive loop runs }\r\n          ResultName := CompName;\r\n            while Assigned(FindGlobalComponent(ResultName)) do\r\n            begin\r\n              Inc(i);\r\n              ResultName := CompName + '_' + IntToStr(i);\r\n            end;\r\n            Result.Name := ResultName;\r\n        end;\r\n      end;\r\n\r\n      FRoot := Result;\r\n      FLookupRoot := Result;\r\n      if Assigned(GlobalLoaded) then\r\n        FLoaded := GlobalLoaded\r\n      else\r\n        FLoaded := TFpList.Create;\r\n\r\n      try\r\n        if FLoaded.IndexOf(FRoot) < 0 then\r\n          FLoaded.Add(FRoot);\r\n        FOwner := FRoot;\r\n        FRoot.FComponentState := FRoot.FComponentState + [csLoading, csReading];\r\n        FRoot.ReadState(Self);\r\n        Exclude(FRoot.FComponentState, csReading);\r\n\r\n        if not Assigned(GlobalLoaded) then\r\n          for i := 0 to FLoaded.Count - 1 do\r\n            TComponent(FLoaded[i]).Loaded;\r\n\r\n      finally\r\n        if not Assigned(GlobalLoaded) then\r\n          FLoaded.Free;\r\n        FLoaded := nil;\r\n      end;\r\n      GlobalFixupReferences;\r\n    except\r\n      RemoveFixupReferences(ARoot, '');\r\n      if not Assigned(ARoot) then\r\n        Result.Free;\r\n      raise;\r\n    end;\r\n  {finally\r\n    GlobalNameSpace.EndWrite;\r\n  end;}\r\nend;\r\n\r\nprocedure TReader.ReadComponents(AOwner, AParent: TComponent;\r\n  Proc: TReadComponentsProc);\r\nvar\r\n  Component: TComponent;\r\nbegin\r\n  Root := AOwner;\r\n  Owner := AOwner;\r\n  Parent := AParent;\r\n  BeginReferences;\r\n  try\r\n    while not EndOfList do\r\n    begin\r\n      FDriver.BeginRootComponent;\r\n      Component := ReadComponent(nil);\r\n      if Assigned(Proc) then\r\n        Proc(Component);\r\n    end;\r\n    ReadListEnd;\r\n    FixupReferences;\r\n  finally\r\n    EndReferences;\r\n  end;\r\nend;\r\n\r\n\r\nfunction TReader.ReadString: String;\r\nvar\r\n  StringType: TValueType;\r\nbegin\r\n  StringType := FDriver.ReadValue;\r\n  if StringType=vaString then\r\n    Result := FDriver.ReadString(StringType)\r\n  else\r\n    raise EReadError.Create(SInvalidPropertyValue);\r\nend;\r\n\r\n\r\nfunction TReader.ReadWideString: WideString;\r\n\r\nbegin\r\n  Result:=ReadString;\r\nend;\r\n\r\nfunction TReader.ReadUnicodeString: UnicodeString;\r\n\r\nbegin\r\n  Result:=ReadString;\r\nend;\r\n\r\nfunction TReader.ReadValue: TValueType;\r\nbegin\r\n  Result := FDriver.ReadValue;\r\nend;\r\n\r\nprocedure TReader.CopyValue(Writer: TWriter);\r\n\r\n(*\r\nprocedure CopyBytes(Count: Integer);\r\n{  var\r\n    Buffer: array[0..1023] of Byte; }\r\n  begin\r\n{!!!:    while Count > 1024 do\r\n    begin\r\n      FDriver.Read(Buffer, 1024);\r\n      Writer.Driver.Write(Buffer, 1024);\r\n      Dec(Count, 1024);\r\n    end;\r\n    if Count > 0 then\r\n    begin\r\n      FDriver.Read(Buffer, Count);\r\n      Writer.Driver.Write(Buffer, Count);\r\n    end;}\r\n  end;\r\n*)\r\n\r\n{var\r\n  s: String;\r\n  Count: LongInt; }\r\nbegin\r\n  case FDriver.NextValue of\r\n    vaNull:\r\n      Writer.WriteIdent('NULL');\r\n    vaFalse:\r\n      Writer.WriteIdent('FALSE');\r\n    vaTrue:\r\n      Writer.WriteIdent('TRUE');\r\n    vaNil:\r\n      Writer.WriteIdent('NIL');\r\n    {!!!: vaList, vaCollection:\r\n      begin\r\n        Writer.WriteValue(FDriver.ReadValue);\r\n        while not EndOfList do\r\n          CopyValue(Writer);\r\n        ReadListEnd;\r\n        Writer.WriteListEnd;\r\n      end;}\r\n    vaInt8, vaInt16, vaInt32:\r\n      Writer.WriteInteger(ReadInteger);\r\n{$ifndef FPUNONE}\r\n    vaExtended:\r\n      Writer.WriteFloat(ReadFloat);\r\n{$endif}\r\n    vaString:\r\n      Writer.WriteString(ReadString);\r\n    vaIdent:\r\n      Writer.WriteIdent(ReadIdent);\r\n    {!!!: vaBinary, vaLString, vaWString:\r\n      begin\r\n        Writer.WriteValue(FDriver.ReadValue);\r\n        FDriver.Read(Count, SizeOf(Count));\r\n        Writer.Driver.Write(Count, SizeOf(Count));\r\n        CopyBytes(Count);\r\n      end;}\r\n    {!!!: vaSet:\r\n      Writer.WriteSet(ReadSet);}\r\n    {!!!: vaCurrency:\r\n      Writer.WriteCurrency(ReadCurrency);}\r\n    vaInt64:\r\n      Writer.WriteInteger(ReadNativeInt);\r\n  end;\r\nend;\r\n\r\nfunction TReader.FindComponentClass(const AClassName: String): TComponentClass;\r\n\r\nvar\r\n  PersistentClass: TPersistentClass;\r\n\r\n  function FindClassInFieldTable(Instance: TComponent): TComponentClass;\r\n  var\r\n    aClass: TClass;\r\n    i: longint;\r\n    ClassTI, MemberClassTI: TTypeInfoClass;\r\n    MemberTI: TTypeInfo;\r\n  begin\r\n    aClass:=Instance.ClassType;\r\n    while aClass<>nil do\r\n      begin\r\n      ClassTI:=typeinfo(aClass);\r\n      for i:=0 to ClassTI.FieldCount-1 do\r\n        begin\r\n        MemberTI:=ClassTI.GetField(i).TypeInfo;\r\n        if MemberTI.Kind=tkClass then\r\n          begin\r\n          MemberClassTI:=TTypeInfoClass(MemberTI);\r\n          if SameText(MemberClassTI.Name,aClassName)\r\n              and (MemberClassTI.ClassType is TComponent) then\r\n            exit(TComponentClass(MemberClassTI.ClassType));\r\n          end;\r\n        end;\r\n      aClass:=aClass.ClassParent;\r\n      end;\r\n  end;\r\n\r\nbegin\r\n  Result := nil;\r\n  Result:=FindClassInFieldTable(Root);\r\n\r\n  if (Result=nil) and assigned(LookupRoot) and (LookupRoot<>Root) then\r\n    Result:=FindClassInFieldTable(LookupRoot);\r\n\r\n  if (Result=nil) then begin\r\n    PersistentClass := GetClass(AClassName);\r\n    if Assigned(PersistentClass) and PersistentClass.InheritsFrom(TComponent) then\r\n      Result := TComponentClass(PersistentClass);\r\n  end;\r\n\r\n  if (Result=nil) and assigned(OnFindComponentClass) then\r\n    OnFindComponentClass(Self, AClassName, Result);\r\n\r\n  if (Result=nil) or (not Result.InheritsFrom(TComponent)) then\r\n    raise EClassNotFound.CreateFmt(SClassNotFound, [AClassName]);\r\nend;\r\n\r\n\r\n{ TAbstractObjectReader }\r\n\r\nprocedure TAbstractObjectReader.FlushBuffer;\r\nbegin\r\n  // Do nothing\r\nend;\r\n\r\n\r\n{\r\n    This file is part of the Free Component Library (FCL)\r\n    Copyright (c) 1999-2000 by the Free Pascal development team\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\n\r\n{****************************************************************************}\r\n{*                         TBinaryObjectWriter                              *}\r\n{****************************************************************************}\r\n\r\n\r\nprocedure TBinaryObjectWriter.WriteWord(w : word);\r\nbegin\r\n  FStream.WriteBufferData(w);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteDWord(lw : longword);\r\nbegin\r\n  FStream.WriteBufferData(lw);\r\nend;\r\n\r\nconstructor TBinaryObjectWriter.Create(Stream: TStream);\r\nbegin\r\n  inherited Create;\r\n  If (Stream=Nil) then\r\n    Raise EWriteError.Create(SEmptyStreamIllegalWriter);\r\n  FStream := Stream;\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.BeginCollection;\r\nbegin\r\n  WriteValue(vaCollection);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteSignature;\r\n\r\nbegin\r\n  FStream.WriteBufferData(FilerSignatureInt);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.BeginComponent(Component: TComponent;\r\n  Flags: TFilerFlags; ChildPos: Integer);\r\nvar\r\n  Prefix: Byte;\r\nbegin\r\n\r\n  { Only write the flags if they are needed! }\r\n  if Flags <> [] then\r\n  begin\r\n    Prefix:=0;\r\n    if ffInherited in Flags then\r\n     Prefix:=Prefix or $01;\r\n    if ffChildPos in Flags then\r\n     Prefix:=Prefix or $02;\r\n    if ffInline in Flags then\r\n     Prefix:=Prefix or $04;\r\n    Prefix := Prefix  or $f0;\r\n    FStream.WriteBufferData(Prefix);\r\n    if ffChildPos in Flags then\r\n      WriteInteger(ChildPos);\r\n  end;\r\n\r\n  WriteStr(Component.ClassName);\r\n  WriteStr(Component.Name);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.BeginList;\r\nbegin\r\n  WriteValue(vaList);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.EndList;\r\nbegin\r\n  WriteValue(vaNull);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.BeginProperty(const PropName: String);\r\nbegin\r\n  WriteStr(PropName);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.EndProperty;\r\nbegin\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.FlushBuffer;\r\nbegin\r\n  // Do nothing;\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteBinary(const Buffer : TBytes; Count: LongInt);\r\nbegin\r\n  WriteValue(vaBinary);\r\n  WriteDWord(longword(Count));\r\n  FStream.Write(Buffer, Count);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteBoolean(Value: Boolean);\r\nbegin\r\n  if Value then\r\n    WriteValue(vaTrue)\r\n  else\r\n    WriteValue(vaFalse);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteFloat(const Value: Extended);\r\nbegin\r\n  WriteValue(vaDouble);\r\n  FStream.WriteBufferData(Value);\r\nend;\r\n\r\n\r\nprocedure TBinaryObjectWriter.WriteCurrency(const Value: Currency);\r\n\r\nVar\r\n  F : Double;\r\nbegin\r\n  WriteValue(vaCurrency);\r\n  F:=Value;\r\n  FStream.WriteBufferData(F);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteIdent(const Ident: string);\r\nbegin\r\n  { Check if Ident is a special identifier before trying to just write\r\n    Ident directly }\r\n  if UpperCase(Ident) = 'NIL' then\r\n    WriteValue(vaNil)\r\n  else if UpperCase(Ident) = 'FALSE' then\r\n    WriteValue(vaFalse)\r\n  else if UpperCase(Ident) = 'TRUE' then\r\n    WriteValue(vaTrue)\r\n  else if UpperCase(Ident) = 'NULL' then\r\n    WriteValue(vaNull) else\r\n  begin\r\n    WriteValue(vaIdent);\r\n    WriteStr(Ident);\r\n  end;\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteInteger(Value: NativeInt);\r\nvar\r\n  s: ShortInt;\r\n  i: SmallInt;\r\n  l: Longint;\r\nbegin\r\n  { Use the smallest possible integer type for the given value: }\r\n  if (Value >= -128) and (Value <= 127) then\r\n  begin\r\n    WriteValue(vaInt8);\r\n    s := Value;\r\n    FStream.WriteBufferData(s);\r\n  end else if (Value >= -32768) and (Value <= 32767) then\r\n  begin\r\n    WriteValue(vaInt16);\r\n    i := Value;\r\n    WriteWord(word(i));\r\n  end else if (Value >= -$80000000) and (Value <= $7fffffff) then\r\n  begin\r\n    WriteValue(vaInt32);\r\n    l := Value;\r\n    WriteDWord(longword(l));\r\n  end else\r\n  begin\r\n    WriteValue(vaInt64);\r\n    FStream.WriteBufferData(Value);\r\n  end;\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteNativeInt(Value: NativeInt);\r\nvar\r\n  s: Int8;\r\n  i: Int16;\r\n  l: Int32;\r\nbegin\r\n  { Use the smallest possible integer type for the given value: }\r\n  if (Value <= 127) then\r\n  begin\r\n    WriteValue(vaInt8);\r\n    s := Value;\r\n    FStream.WriteBufferData(s);\r\n  end else if (Value <= 32767) then\r\n  begin\r\n    WriteValue(vaInt16);\r\n    i := Value;\r\n    WriteWord(word(i));\r\n  end else if (Value <= $7fffffff) then\r\n  begin\r\n    WriteValue(vaInt32);\r\n    l := Value;\r\n    WriteDWord(longword(l));\r\n  end else\r\n  begin\r\n    WriteValue(vaQWord);\r\n    FStream.WriteBufferData(Value);\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TBinaryObjectWriter.WriteMethodName(const Name: String);\r\nbegin\r\n  if Length(Name) > 0 then\r\n  begin\r\n    WriteValue(vaIdent);\r\n    WriteStr(Name);\r\n  end else\r\n    WriteValue(vaNil);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteSet(Value: LongInt; SetType: Pointer);\r\nvar\r\n  i: Integer;\r\n  b : Integer;\r\nbegin\r\n  WriteValue(vaSet);\r\n  B:=1;\r\n  for i:=0 to 31 do\r\n    begin\r\n    if (Value and b) <>0 then\r\n      begin\r\n      WriteStr(GetEnumName(PTypeInfo(SetType), i));\r\n      end;\r\n    b:=b shl 1;\r\n    end;\r\n  WriteStr('');\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteString(const Value: String);\r\n\r\nvar\r\n  i, len: Integer;\r\nbegin\r\n  len := Length(Value);\r\n  WriteValue(vaString);\r\n  WriteDWord(len);\r\n  For I:=1 to len do\r\n    FStream.WriteBufferData(Value[i]);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteWideString(const Value: WideString);\r\n\r\nbegin\r\n  WriteString(Value);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteUnicodeString(const Value: UnicodeString);\r\n\r\nbegin\r\n  WriteString(Value);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteVariant(const VarValue: JSValue);\r\nbegin\r\n  if isUndefined(varValue) then\r\n    WriteValue(vaNil)\r\n  else if IsNull(VarValue) then\r\n    WriteValue(vaNull)\r\n  else if IsNumber(VarValue) then\r\n    begin\r\n    if Frac(Double(varValue))=0 then\r\n      WriteInteger(NativeInt(VarValue))\r\n     else\r\n      WriteFloat(Double(varValue))\r\n    end\r\n  else if isBoolean(varValue) then\r\n    WriteBoolean(Boolean(VarValue))\r\n  else if isString(varValue) then\r\n    WriteString(String(VarValue))\r\n  else\r\n    raise EWriteError.Create(SUnsupportedPropertyVariantType);\r\nend;\r\n\r\n\r\nprocedure TBinaryObjectWriter.Write(const Buffer : TBytes; Count: LongInt);\r\n\r\nbegin\r\n  FStream.Write(Buffer,Count);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteValue(Value: TValueType);\r\nvar\r\n  b: uint8;\r\nbegin\r\n  b := uint8(Value);\r\n  FStream.WriteBufferData(b);\r\nend;\r\n\r\nprocedure TBinaryObjectWriter.WriteStr(const Value: String);\r\nvar\r\n  len,i: integer;\r\n  b: uint8;\r\nbegin\r\n  len:= Length(Value);\r\n  if len > 255 then\r\n    len := 255;\r\n  b := len;\r\n  FStream.WriteBufferData(b);\r\n  For I:=1 to len do\r\n    FStream.WriteBufferData(Value[i]);\r\nend;\r\n\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TWriter                                      *}\r\n{****************************************************************************}\r\n\r\n\r\nconstructor TWriter.Create(ADriver: TAbstractObjectWriter);\r\nbegin\r\n  inherited Create;\r\n  FDriver := ADriver;\r\nend;\r\n\r\nconstructor TWriter.Create(Stream: TStream);\r\nbegin\r\n  inherited Create;\r\n  If (Stream=Nil) then\r\n    Raise EWriteError.Create(SEmptyStreamIllegalWriter);\r\n  FDriver := CreateDriver(Stream);\r\n  FDestroyDriver := True;\r\nend;\r\n\r\ndestructor TWriter.Destroy;\r\nbegin\r\n  if FDestroyDriver then\r\n    FDriver.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TWriter.CreateDriver(Stream: TStream): TAbstractObjectWriter;\r\nbegin\r\n  Result := TBinaryObjectWriter.Create(Stream);\r\nend;\r\n\r\nType\r\n  TPosComponent = Class(TObject)\r\n  Private\r\n    FPos : Integer;\r\n    FComponent : TComponent;\r\n  Public\r\n    Constructor Create(APos : Integer; AComponent : TComponent);\r\n  end;\r\n\r\nConstructor TPosComponent.Create(APos : Integer; AComponent : TComponent);\r\n\r\nbegin\r\n  FPos:=APos;\r\n  FComponent:=AComponent;\r\nend;\r\n\r\n// Used as argument for calls to TComponent.GetChildren:\r\nprocedure TWriter.AddToAncestorList(Component: TComponent);\r\nbegin\r\n  FAncestors.AddObject(Component.Name,TPosComponent.Create(FAncestors.Count,Component));\r\nend;\r\n\r\nprocedure TWriter.DefineProperty(const Name: String;\r\n  ReadData: TReaderProc; AWriteData: TWriterProc; HasData: Boolean);\r\nbegin\r\n  if HasData and Assigned(AWriteData) then\r\n  begin\r\n    // Write the property name and then the data itself\r\n    Driver.BeginProperty(FPropPath + Name);\r\n    AWriteData(Self);\r\n    Driver.EndProperty;\r\n  end else if assigned(ReadData) then ;\r\nend;\r\n\r\nprocedure TWriter.DefineBinaryProperty(const Name: String;\r\n  ReadData, AWriteData: TStreamProc; HasData: Boolean);\r\nbegin\r\n  if HasData and Assigned(AWriteData) then\r\n  begin\r\n    // Write the property name and then the data itself\r\n    Driver.BeginProperty(FPropPath + Name);\r\n    WriteBinary(AWriteData);\r\n    Driver.EndProperty;\r\n  end else if assigned(ReadData) then ;\r\nend;\r\n\r\nprocedure TWriter.FlushBuffer;\r\nbegin\r\n  Driver.FlushBuffer;\r\nend;\r\n\r\nprocedure TWriter.Write(const Buffer : TBytes; Count: Longint);\r\nbegin\r\n  //This should give an exception if write is not implemented (i.e. TTextObjectWriter)\r\n  //but should work with TBinaryObjectWriter.\r\n  Driver.Write(Buffer, Count);\r\nend;\r\n\r\nprocedure TWriter.SetRoot(ARoot: TComponent);\r\nbegin\r\n  inherited SetRoot(ARoot);\r\n  // Use the new root as lookup root too\r\n  FLookupRoot := ARoot;\r\nend;\r\n\r\nprocedure TWriter.WriteSignature;\r\n\r\nbegin\r\n  FDriver.WriteSignature;\r\nend;\r\n\r\nprocedure TWriter.WriteBinary(AWriteData: TStreamProc);\r\nvar\r\n  MemBuffer: TBytesStream;\r\nbegin\r\n  { First write the binary data into a memory stream, then copy this buffered\r\n    stream into the writing destination. This is necessary as we have to know\r\n    the size of the binary data in advance (we're assuming that seeking within\r\n    the writer stream is not possible) }\r\n  MemBuffer := TBytesStream.Create;\r\n  try\r\n    AWriteData(MemBuffer);\r\n    Driver.WriteBinary(MemBuffer.Bytes, MemBuffer.Size);\r\n  finally\r\n    MemBuffer.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TWriter.WriteBoolean(Value: Boolean);\r\nbegin\r\n  Driver.WriteBoolean(Value);\r\nend;\r\n\r\nprocedure TWriter.WriteChar(Value: Char);\r\nbegin\r\n  WriteString(Value);\r\nend;\r\n\r\nprocedure TWriter.WriteWideChar(Value: WideChar);\r\nbegin\r\n  WriteWideString(Value);\r\nend;\r\n\r\nprocedure TWriter.WriteCollection(Value: TCollection);\r\nvar\r\n  i: Integer;\r\nbegin\r\n  Driver.BeginCollection;\r\n  if Assigned(Value) then\r\n    for i := 0 to Value.Count - 1 do\r\n    begin\r\n      { Each collection item needs its own ListBegin/ListEnd tag, or else the\r\n        reader wouldn't be able to know where an item ends and where the next\r\n        one starts }\r\n      WriteListBegin;\r\n      WriteProperties(Value.Items[i]);\r\n      WriteListEnd;\r\n    end;\r\n  WriteListEnd;\r\nend;\r\n\r\nprocedure TWriter.DetermineAncestor(Component : TComponent);\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  // Should be set only when we write an inherited with children.\r\n  if Not Assigned(FAncestors) then\r\n    exit;\r\n  I:=FAncestors.IndexOf(Component.Name);\r\n  If (I=-1) then\r\n    begin\r\n    FAncestor:=Nil;\r\n    FAncestorPos:=-1;\r\n    end\r\n  else\r\n    With TPosComponent(FAncestors.Objects[i]) do\r\n      begin\r\n      FAncestor:=FComponent;\r\n      FAncestorPos:=FPos;\r\n      end;\r\nend;\r\n\r\nprocedure TWriter.DoFindAncestor(Component : TComponent);\r\n\r\nVar\r\n  C : TComponent;\r\n\r\nbegin\r\n  if Assigned(FOnFindAncestor) then\r\n    if (Ancestor=Nil) or (Ancestor is TComponent) then\r\n      begin\r\n      C:=TComponent(Ancestor);\r\n      FOnFindAncestor(Self,Component,Component.Name,C,FRootAncestor);\r\n      Ancestor:=C;\r\n      end;\r\nend;\r\n\r\nprocedure TWriter.WriteComponent(Component: TComponent);\r\n\r\nvar\r\n  SA : TPersistent;\r\n  SR, SRA : TComponent;\r\nbegin\r\n  SR:=FRoot;\r\n  SA:=FAncestor;\r\n  SRA:=FRootAncestor;\r\n  Try\r\n    Component.FComponentState:=Component.FComponentState+[csWriting];\r\n    Try\r\n      // Possibly set ancestor.\r\n      DetermineAncestor(Component);\r\n      DoFindAncestor(Component); // Mainly for IDE when a parent form had an ancestor renamed...\r\n      // Will call WriteComponentData.\r\n      Component.WriteState(Self);\r\n      FDriver.EndList;\r\n    Finally\r\n      Component.FComponentState:=Component.FComponentState-[csWriting];\r\n    end;\r\n  Finally\r\n    FAncestor:=SA;\r\n    FRoot:=SR;\r\n    FRootAncestor:=SRA;\r\n  end;\r\nend;\r\n\r\nprocedure TWriter.WriteChildren(Component : TComponent);\r\n\r\nVar\r\n  SRoot, SRootA : TComponent;\r\n  SList : TStringList;\r\n  SPos, I , SAncestorPos: Integer;\r\n  O : TObject;\r\n\r\nbegin\r\n  // Write children list.\r\n  // While writing children, the ancestor environment must be saved\r\n  // This is recursive...\r\n  SRoot:=FRoot;\r\n  SRootA:=FRootAncestor;\r\n  SList:=FAncestors;\r\n  SPos:=FCurrentPos;\r\n  SAncestorPos:=FAncestorPos;\r\n  try\r\n    FAncestors:=Nil;\r\n    FCurrentPos:=0;\r\n    FAncestorPos:=-1;\r\n    if csInline in Component.ComponentState then\r\n       FRoot:=Component;\r\n    if (FAncestor is TComponent) then\r\n       begin\r\n       FAncestors:=TStringList.Create;\r\n       if csInline in TComponent(FAncestor).ComponentState then\r\n         FRootAncestor := TComponent(FAncestor);\r\n       TComponent(FAncestor).GetChildren(@AddToAncestorList,FRootAncestor);\r\n       FAncestors.Sorted:=True;\r\n       end;\r\n    try\r\n      Component.GetChildren(@WriteComponent, FRoot);\r\n    Finally\r\n      If Assigned(Fancestors) then\r\n        For I:=0 to FAncestors.Count-1 do\r\n          begin\r\n          O:=FAncestors.Objects[i];\r\n          FAncestors.Objects[i]:=Nil;\r\n          O.Free;\r\n          end;\r\n      FreeAndNil(FAncestors);\r\n    end;\r\n  finally\r\n    FAncestors:=Slist;\r\n    FRoot:=SRoot;\r\n    FRootAncestor:=SRootA;\r\n    FCurrentPos:=SPos;\r\n    FAncestorPos:=SAncestorPos;\r\n  end;\r\nend;\r\n\r\nprocedure TWriter.WriteComponentData(Instance: TComponent);\r\nvar\r\n  Flags: TFilerFlags;\r\nbegin\r\n  Flags := [];\r\n  If (Assigned(FAncestor)) and  //has ancestor\r\n     (not (csInline in Instance.ComponentState) or // no inline component\r\n      // .. or the inline component is inherited\r\n      (csAncestor in Instance.Componentstate) and (FAncestors <> nil)) then\r\n    Flags:=[ffInherited]\r\n  else If csInline in Instance.ComponentState then\r\n    Flags:=[ffInline];\r\n  If (FAncestors<>Nil) and ((FCurrentPos<>FAncestorPos) or (FAncestor=Nil)) then\r\n    Include(Flags,ffChildPos);\r\n  FDriver.BeginComponent(Instance,Flags,FCurrentPos);\r\n  If (FAncestors<>Nil) then\r\n    Inc(FCurrentPos);\r\n  WriteProperties(Instance);\r\n  WriteListEnd;\r\n  // Needs special handling of ancestor.\r\n  If not IgnoreChildren then\r\n    WriteChildren(Instance);\r\nend;\r\n\r\nprocedure TWriter.WriteDescendent(ARoot: TComponent; AAncestor: TComponent);\r\nbegin\r\n  FRoot := ARoot;\r\n  FAncestor := AAncestor;\r\n  FRootAncestor := AAncestor;\r\n  FLookupRoot := ARoot;\r\n  WriteSignature;\r\n  WriteComponent(ARoot);\r\nend;\r\n\r\nprocedure TWriter.WriteFloat(const Value: Extended);\r\nbegin\r\n  Driver.WriteFloat(Value);\r\nend;\r\n\r\n\r\nprocedure TWriter.WriteCurrency(const Value: Currency);\r\nbegin\r\n  Driver.WriteCurrency(Value);\r\nend;\r\n\r\n\r\nprocedure TWriter.WriteIdent(const Ident: string);\r\nbegin\r\n  Driver.WriteIdent(Ident);\r\nend;\r\n\r\nprocedure TWriter.WriteInteger(Value: LongInt);\r\nbegin\r\n  Driver.WriteInteger(Value);\r\nend;\r\n\r\nprocedure TWriter.WriteInteger(Value: NativeInt);\r\nbegin\r\n  Driver.WriteInteger(Value);\r\nend;\r\n\r\nprocedure TWriter.WriteSet(Value: LongInt; SetType: Pointer);\r\n\r\nbegin\r\n  Driver.WriteSet(Value,SetType);\r\nend;\r\n\r\nprocedure TWriter.WriteVariant(const VarValue: JSValue);\r\nbegin\r\n  Driver.WriteVariant(VarValue);\r\nend;\r\n\r\nprocedure TWriter.WriteListBegin;\r\nbegin\r\n  Driver.BeginList;\r\nend;\r\n\r\nprocedure TWriter.WriteListEnd;\r\nbegin\r\n  Driver.EndList;\r\nend;\r\n\r\nprocedure TWriter.WriteProperties(Instance: TPersistent);\r\n\r\nvar\r\n  PropCount,i : integer;\r\n  PropList  : TTypeMemberPropertyDynArray;\r\n\r\nbegin\r\n  PropList:=GetPropList(Instance);\r\n  PropCount:=Length(PropList);\r\n  if PropCount>0 then\r\n    for i := 0 to PropCount-1 do\r\n      if IsStoredProp(Instance,PropList[i]) then\r\n        WriteProperty(Instance,PropList[i]);\r\n  Instance.DefineProperties(Self);\r\nend;\r\n\r\n\r\nprocedure TWriter.WriteProperty(Instance: TPersistent; PropInfo: TTypeMemberProperty);\r\nvar\r\n  HasAncestor: Boolean;\r\n  PropType: TTypeInfo;\r\n  N,Value, DefValue: LongInt;\r\n  Ident: String;\r\n  IntToIdentFn: TIntToIdent;\r\n{$ifndef FPUNONE}\r\n  FloatValue, DefFloatValue: Extended;\r\n{$endif}\r\n  MethodValue: TMethod;\r\n  DefMethodValue: TMethod;\r\n  StrValue, DefStrValue: String;\r\n  AncestorObj: TObject;\r\n  C,Component: TComponent;\r\n  ObjValue: TObject;\r\n  SavedAncestor: TPersistent;\r\n  Key, SavedPropPath, Name, lMethodName: String;\r\n  VarValue, DefVarValue : JSValue;\r\n  BoolValue, DefBoolValue: boolean;\r\n  Handled: Boolean;\r\n  O : TJSObject;\r\nbegin\r\n  // do not stream properties without getter\r\n  if PropInfo.Getter='' then\r\n    exit;\r\n  // properties without setter are only allowed, if they are subcomponents\r\n  PropType := PropInfo.TypeInfo;\r\n  if (PropInfo.Setter='') then\r\n    begin\r\n    if PropType.Kind<>tkClass then\r\n      exit;\r\n    ObjValue := TObject(GetObjectProp(Instance, PropInfo));\r\n    if not ObjValue.InheritsFrom(TComponent) or\r\n       not (csSubComponent in TComponent(ObjValue).ComponentStyle) then\r\n      exit;\r\n    end;\r\n\r\n  { Check if the ancestor can be used }\r\n  HasAncestor := Assigned(Ancestor) and ((Instance = Root) or\r\n    (Instance.ClassType = Ancestor.ClassType));\r\n  //writeln('TWriter.WriteProperty Name=',PropType^.Name,' Kind=',GetEnumName(TypeInfo(TTypeKind),ord(PropType^.Kind)),' HasAncestor=',HasAncestor);\r\n\r\n  case PropType.Kind of\r\n    tkInteger, tkChar, tkEnumeration, tkSet:\r\n      begin\r\n        Value := GetOrdProp(Instance, PropInfo);\r\n        if HasAncestor then\r\n          DefValue := GetOrdProp(Ancestor, PropInfo)\r\n        else\r\n          begin\r\n          if PropType.Kind<>tkSet then\r\n            DefValue := Longint(PropInfo.Default)\r\n          else\r\n            begin\r\n            o:=TJSObject(PropInfo.Default);\r\n            DefValue:=0;\r\n            for Key in o do\r\n              begin\r\n              n:=parseInt(Key,10);\r\n              if n<32 then\r\n                DefValue:=DefValue+(1 shl n);\r\n              end;\r\n            end;\r\n          end;\r\n        // writeln(PPropInfo(PropInfo)^.Name, ', HasAncestor=', ord(HasAncestor), ', Value=', Value, ', Default=', DefValue);\r\n        if (Value <> DefValue) or (DefValue=longint($80000000)) then\r\n        begin\r\n          Driver.BeginProperty(FPropPath + PropInfo.Name);\r\n          case PropType.Kind of\r\n            tkInteger:\r\n              begin\r\n                // Check if this integer has a string identifier\r\n                IntToIdentFn := FindIntToIdent(PropInfo.TypeInfo);\r\n                if Assigned(IntToIdentFn) and IntToIdentFn(Value, Ident) then\r\n                  // Integer can be written a human-readable identifier\r\n                  WriteIdent(Ident)\r\n                else\r\n                  // Integer has to be written just as number\r\n                  WriteInteger(Value);\r\n              end;\r\n            tkChar:\r\n              WriteChar(Chr(Value));\r\n            tkSet:\r\n              begin\r\n              Driver.WriteSet(Value, TTypeInfoSet(PropType).CompType);\r\n              end;\r\n            tkEnumeration:\r\n              WriteIdent(GetEnumName(TTypeInfoEnum(PropType), Value));\r\n          end;\r\n          Driver.EndProperty;\r\n        end;\r\n      end;\r\n{$ifndef FPUNONE}\r\n    tkFloat:\r\n      begin\r\n        FloatValue := GetFloatProp(Instance, PropInfo);\r\n        if HasAncestor then\r\n          DefFloatValue := GetFloatProp(Ancestor, PropInfo)\r\n        else\r\n          begin\r\n          // This is really ugly..\r\n          DefFloatValue:=Double(PropInfo.Default);\r\n          end;\r\n        if (FloatValue<>DefFloatValue) or (not HasAncestor and (int(DefFloatValue)=longint($80000000))) then\r\n        begin\r\n          Driver.BeginProperty(FPropPath + PropInfo.Name);\r\n          WriteFloat(FloatValue);\r\n          Driver.EndProperty;\r\n        end;\r\n      end;\r\n{$endif}\r\n    tkMethod:\r\n      begin\r\n        MethodValue := GetMethodProp(Instance, PropInfo);\r\n        if HasAncestor then\r\n          DefMethodValue := GetMethodProp(Ancestor, PropInfo)\r\n        else begin\r\n          DefMethodValue.Data := nil;\r\n          DefMethodValue.Code := nil;\r\n        end;\r\n\r\n        Handled:=false;\r\n        if Assigned(OnWriteMethodProperty) then\r\n          OnWriteMethodProperty(Self,Instance,PropInfo,MethodValue,\r\n            DefMethodValue,Handled);\r\n        if isString(MethodValue.Code) then\r\n          lMethodName:=String(MethodValue.Code)\r\n        else\r\n          lMethodName:=FLookupRoot.MethodName(MethodValue.Code);\r\n        //Writeln('Writeln A: ',lMethodName);\r\n        if (not Handled) and\r\n          (MethodValue.Code <> DefMethodValue.Code) and\r\n          ((not Assigned(MethodValue.Code)) or\r\n          ((Length(lMethodName) > 0))) then\r\n        begin\r\n          //Writeln('Writeln B',FPropPath + PropInfo.Name);\r\n          Driver.BeginProperty(FPropPath + PropInfo.Name);\r\n          if Assigned(MethodValue.Code) then\r\n            Driver.WriteMethodName(lMethodName)\r\n          else\r\n            Driver.WriteMethodName('');\r\n          Driver.EndProperty;\r\n        end;\r\n      end;\r\n    tkString: // tkSString, tkLString, tkAString are not supported\r\n      begin\r\n        StrValue := GetStrProp(Instance, PropInfo);\r\n        if HasAncestor then\r\n          DefStrValue := GetStrProp(Ancestor, PropInfo)\r\n        else\r\n        begin\r\n          DefValue :=Longint(PropInfo.Default);\r\n          SetLength(DefStrValue, 0);\r\n        end;\r\n\r\n        if (StrValue<>DefStrValue) or (not HasAncestor and (DefValue=longint($80000000))) then\r\n        begin\r\n          Driver.BeginProperty(FPropPath + PropInfo.Name);\r\n          if Assigned(FOnWriteStringProperty) then\r\n            FOnWriteStringProperty(Self,Instance,PropInfo,StrValue);\r\n          WriteString(StrValue);\r\n          Driver.EndProperty;\r\n        end;\r\n      end;\r\n    tkJSValue:\r\n      begin\r\n        { Ensure that a Variant manager is installed }\r\n        VarValue := GetJSValueProp(Instance, PropInfo);\r\n        if HasAncestor then\r\n          DefVarValue := GetJSValueProp(Ancestor, PropInfo)\r\n        else\r\n          DefVarValue:=null;\r\n\r\n        if (VarValue<>DefVarValue) then\r\n          begin\r\n            Driver.BeginProperty(FPropPath + PropInfo.Name);\r\n            { can't use variant() typecast, pulls in variants unit }\r\n            WriteVariant(VarValue);\r\n            Driver.EndProperty;\r\n          end;\r\n      end;\r\n    tkClass:\r\n      begin\r\n        ObjValue := TObject(GetObjectProp(Instance, PropInfo));\r\n        if HasAncestor then\r\n        begin\r\n          AncestorObj := TObject(GetObjectProp(Ancestor, PropInfo));\r\n          if (AncestorObj is TComponent) and\r\n             (ObjValue is TComponent) then\r\n          begin\r\n            //writeln('TWriter.WriteProperty AncestorObj=',TComponent(AncestorObj).Name,' OwnerFit=',TComponent(AncestorObj).Owner = FRootAncestor,' ',TComponent(ObjValue).Name,' OwnerFit=',TComponent(ObjValue).Owner = Root);\r\n            if (AncestorObj<> ObjValue) and\r\n             (TComponent(AncestorObj).Owner = FRootAncestor) and\r\n             (TComponent(ObjValue).Owner = Root) and\r\n             (UpperCase(TComponent(AncestorObj).Name) = UpperCase(TComponent(ObjValue).Name)) then\r\n            begin\r\n              // different components, but with the same name\r\n              // treat it like an override\r\n              AncestorObj := ObjValue;\r\n            end;\r\n          end;\r\n        end else\r\n          AncestorObj := nil;\r\n\r\n        if not Assigned(ObjValue) then\r\n          begin\r\n          if ObjValue <> AncestorObj then\r\n            begin\r\n            Driver.BeginProperty(FPropPath + PropInfo.Name);\r\n            Driver.WriteIdent('NIL');\r\n            Driver.EndProperty;\r\n            end\r\n          end\r\n        else if ObjValue.InheritsFrom(TPersistent) then\r\n          begin\r\n          { Subcomponents are streamed the same way as persistents }\r\n          if ObjValue.InheritsFrom(TComponent)\r\n            and ((not (csSubComponent in TComponent(ObjValue).ComponentStyle))\r\n                 or ((TComponent(ObjValue).Owner<>Instance) and (TComponent(ObjValue).Owner<>Nil))) then\r\n            begin\r\n            Component := TComponent(ObjValue);\r\n            if (ObjValue <> AncestorObj)\r\n                and not (csTransient in Component.ComponentStyle) then\r\n              begin\r\n              Name:= '';\r\n              C:= Component;\r\n              While (C<>Nil) and (C.Name<>'') do\r\n                begin\r\n                If (Name<>'') Then\r\n                  Name:='.'+Name;\r\n                if C.Owner = LookupRoot then\r\n                  begin\r\n                  Name := C.Name+Name;\r\n                  break;\r\n                  end\r\n                else if C = LookupRoot then\r\n                  begin\r\n                  Name := 'Owner' + Name;\r\n                  break;\r\n                  end;\r\n                Name:=C.Name + Name;\r\n                C:= C.Owner;\r\n                end;\r\n              if (C=nil) and (Component.Owner=nil) then\r\n                if (Name<>'') then              //foreign root\r\n                  Name:=Name+'.Owner';\r\n              if Length(Name) > 0 then\r\n                begin\r\n                Driver.BeginProperty(FPropPath + PropInfo.Name);\r\n                WriteIdent(Name);\r\n                Driver.EndProperty;\r\n                end;  // length Name>0\r\n              end; //(ObjValue <> AncestorObj)\r\n            end // ObjValue.InheritsFrom(TComponent)\r\n          else\r\n            begin\r\n            SavedAncestor := Ancestor;\r\n            SavedPropPath := FPropPath;\r\n            try\r\n              FPropPath := FPropPath + PropInfo.Name + '.';\r\n              if HasAncestor then\r\n                Ancestor := TPersistent(GetObjectProp(Ancestor, PropInfo));\r\n              WriteProperties(TPersistent(ObjValue));\r\n            finally\r\n              Ancestor := SavedAncestor;\r\n              FPropPath := SavedPropPath;\r\n            end;\r\n            if ObjValue.InheritsFrom(TCollection) then\r\n              begin\r\n              if (not HasAncestor) or (not CollectionsEqual(TCollection(ObjValue),\r\n                TCollection(GetObjectProp(Ancestor, PropInfo)),root,rootancestor)) then\r\n                begin\r\n                Driver.BeginProperty(FPropPath + PropInfo.Name);\r\n                SavedPropPath := FPropPath;\r\n                try\r\n                  SetLength(FPropPath, 0);\r\n                  WriteCollection(TCollection(ObjValue));\r\n                finally\r\n                  FPropPath := SavedPropPath;\r\n                  Driver.EndProperty;\r\n                end;\r\n                end;\r\n              end // Tcollection\r\n            end;\r\n          end; // Inheritsfrom(TPersistent)\r\n      end;\r\n{    tkInt64, tkQWord:\r\n      begin\r\n        Int64Value := GetInt64Prop(Instance, PropInfo);\r\n        if HasAncestor then\r\n          DefInt64Value := GetInt64Prop(Ancestor, PropInfo)\r\n        else\r\n          DefInt64Value := 0;\r\n        if Int64Value <> DefInt64Value then\r\n        begin\r\n          Driver.BeginProperty(FPropPath + PPropInfo(PropInfo)^.Name);\r\n          WriteInteger(Int64Value);\r\n          Driver.EndProperty;\r\n        end;\r\n      end;}\r\n    tkBool:\r\n      begin\r\n        BoolValue := GetOrdProp(Instance, PropInfo)<>0;\r\n        if HasAncestor then\r\n          DefBoolValue := GetOrdProp(Ancestor, PropInfo)<>0\r\n        else\r\n          begin\r\n          DefBoolValue := PropInfo.Default<>0;\r\n          DefValue:=Longint(PropInfo.Default);\r\n          end;\r\n        // writeln(PropInfo.Name, ', HasAncestor=', ord(HasAncestor), ', Value=', Value, ', Default=', DefBoolValue);\r\n        if (BoolValue<>DefBoolValue) or (DefValue=longint($80000000)) then\r\n          begin\r\n          Driver.BeginProperty(FPropPath + PropInfo.Name);\r\n          WriteBoolean(BoolValue);\r\n          Driver.EndProperty;\r\n          end;\r\n      end;\r\n    tkInterface:\r\n      begin\r\n{        IntfValue := GetInterfaceProp(Instance, PropInfo);\r\n      if Assigned(IntfValue) and Supports(IntfValue, IInterfaceComponentReference, CompRef) then\r\n          begin\r\n          Component := CompRef.GetComponent;\r\n          if HasAncestor then\r\n          begin\r\n            AncestorObj := TObject(GetObjectProp(Ancestor, PropInfo));\r\n            if (AncestorObj is TComponent) then\r\n            begin\r\n              //writeln('TWriter.WriteProperty AncestorObj=',TComponent(AncestorObj).Name,' OwnerFit=',TComponent(AncestorObj).Owner = FRootAncestor,' ',TComponent(ObjValue).Name,' OwnerFit=',TComponent(ObjValue).Owner = Root);\r\n              if (AncestorObj<> Component) and\r\n               (TComponent(AncestorObj).Owner = FRootAncestor) and\r\n               (Component.Owner = Root) and\r\n               (UpperCase(TComponent(AncestorObj).Name) = UpperCase(Component.Name)) then\r\n              begin\r\n                // different components, but with the same name\r\n                // treat it like an override\r\n                AncestorObj := Component;\r\n              end;\r\n            end;\r\n          end else\r\n            AncestorObj := nil;\r\n\r\n          if not Assigned(Component) then\r\n            begin\r\n            if Component <> AncestorObj then\r\n              begin\r\n              Driver.BeginProperty(FPropPath + PropInfo.Name);\r\n              Driver.WriteIdent('NIL');\r\n              Driver.EndProperty;\r\n              end\r\n            end\r\n          else if ((not (csSubComponent in Component.ComponentStyle))\r\n                 or ((Component.Owner<>Instance) and (Component.Owner<>Nil))) then\r\n            begin\r\n            if (Component <> AncestorObj)\r\n                and not (csTransient in Component.ComponentStyle) then\r\n              begin\r\n              Name:= '';\r\n              C:= Component;\r\n              While (C<>Nil) and (C.Name<>'') do\r\n                begin\r\n                If (Name<>'') Then\r\n                  Name:='.'+Name;\r\n                if C.Owner = LookupRoot then\r\n                  begin\r\n                  Name := C.Name+Name;\r\n                  break;\r\n                  end\r\n                else if C = LookupRoot then\r\n                  begin\r\n                  Name := 'Owner' + Name;\r\n                  break;\r\n                  end;\r\n                Name:=C.Name + Name;\r\n                C:= C.Owner;\r\n                end;\r\n              if (C=nil) and (Component.Owner=nil) then\r\n                if (Name<>'') then              //foreign root\r\n                  Name:=Name+'.Owner';\r\n              if Length(Name) > 0 then\r\n                begin\r\n                Driver.BeginProperty(FPropPath + PropInfo.Name);\r\n                WriteIdent(Name);\r\n                Driver.EndProperty;\r\n                end;  // length Name>0\r\n              end; //(Component <> AncestorObj)\r\n            end;\r\n          end; //Assigned(IntfValue) and Supports(IntfValue,..\r\n               //else write NIL ?\r\n}      end;\r\n  end;\r\nend;\r\n\r\nprocedure TWriter.WriteRootComponent(ARoot: TComponent);\r\nbegin\r\n  WriteDescendent(ARoot, nil);\r\nend;\r\n\r\nprocedure TWriter.WriteString(const Value: String);\r\nbegin\r\n  Driver.WriteString(Value);\r\nend;\r\n\r\nprocedure TWriter.WriteWideString(const Value: WideString);\r\nbegin\r\n  Driver.WriteWideString(Value);\r\nend;\r\n\r\nprocedure TWriter.WriteUnicodeString(const Value: UnicodeString);\r\nbegin\r\n  Driver.WriteUnicodeString(Value);\r\nend;\r\n\r\n{ TAbstractObjectWriter }\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n  Global routines\r\n  ---------------------------------------------------------------------}\r\nType\r\n  TInitHandler = Class(TObject)\r\n    AHandler : TInitComponentHandler;\r\n    AClass : TComponentClass;\r\n  end;\r\n\r\nvar\r\n  ClassList : TJSObject;\r\n  InitHandlerList : TList;\r\n  FindGlobalComponentList : TFPList;\r\n\r\nProcedure RegisterClass(AClass : TPersistentClass);\r\n\r\nbegin\r\n  ClassList[AClass.ClassName]:=AClass;\r\nend;\r\n\r\nProcedure RegisterClasses(AClasses : specialize TArray<TPersistentClass>);\r\nvar\r\n  AClass : TPersistentClass;\r\n\r\nbegin\r\n  for AClass in AClasses do\r\n    RegisterClass(AClass);\r\nend;\r\n\r\nFunction GetClass(AClassName : string) : TPersistentClass;\r\n\r\nbegin\r\n  Result:=nil;\r\n  if AClassName='' then exit;\r\n  if not ClassList.hasOwnProperty(AClassName) then exit;\r\n  Result:=TPersistentClass(ClassList[AClassName]);\r\nend;\r\n\r\n\r\nprocedure RegisterFindGlobalComponentProc(AFindGlobalComponent: TFindGlobalComponent);\r\n  begin\r\n    if not(assigned(FindGlobalComponentList)) then\r\n      FindGlobalComponentList:=TFPList.Create;\r\n    if FindGlobalComponentList.IndexOf(CodePointer(AFindGlobalComponent))<0 then\r\n      FindGlobalComponentList.Add(CodePointer(AFindGlobalComponent));\r\n  end;\r\n\r\n\r\nprocedure UnregisterFindGlobalComponentProc(AFindGlobalComponent: TFindGlobalComponent);\r\n  begin\r\n    if assigned(FindGlobalComponentList) then\r\n      FindGlobalComponentList.Remove(CodePointer(AFindGlobalComponent));\r\n  end;\r\n\r\n\r\nfunction FindGlobalComponent(const Name: string): TComponent;\r\n\r\nvar\r\n      i : sizeint;\r\nbegin\r\n  Result:=nil;\r\n  if assigned(FindGlobalComponentList) then\r\n    begin\r\n      for i:=FindGlobalComponentList.Count-1 downto 0 do\r\n      \tbegin\r\n      \t  FindGlobalComponent:=TFindGlobalComponent(FindGlobalComponentList[i])(name);\r\n      \t  if assigned(Result) then\r\n      \t    break;\r\n      \tend;\r\n    end;\r\nend;\r\n\r\nFunction FindNestedComponent(Root : TComponent; APath : String; CStyle : Boolean = True) : TComponent;\r\n\r\n  Function GetNextName : String; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n\r\n  Var\r\n    P : Integer;\r\n    CM : Boolean;\r\n\r\n  begin\r\n    P:=Pos('.',APath);\r\n    CM:=False;\r\n    If (P=0) then\r\n      begin\r\n      If CStyle then\r\n        begin\r\n        P:=Pos('->',APath);\r\n        CM:=P<>0;\r\n        end;\r\n      If (P=0) Then\r\n        P:=Length(APath)+1;\r\n      end;\r\n    Result:=Copy(APath,1,P-1);\r\n    Delete(APath,1,P+Ord(CM));\r\n  end;\r\n\r\nVar\r\n  C : TComponent;\r\n  S : String;\r\nbegin\r\n  If (APath='') then\r\n    Result:=Nil\r\n  else\r\n    begin\r\n    Result:=Root;\r\n    While (APath<>'') And (Result<>Nil) do\r\n      begin\r\n      C:=Result;\r\n      S:=Uppercase(GetNextName);\r\n      Result:=C.FindComponent(S);\r\n      If (Result=Nil) And (S='OWNER') then\r\n        Result:=C;\r\n      end;\r\n    end;\r\nend;\r\n\r\nfunction InitInheritedComponent(Instance: TComponent; RootAncestor: TClass): Boolean;\r\nVar\r\n  I : Integer;\r\nbegin\r\n  I:=0;\r\n  if not Assigned(InitHandlerList) then begin\r\n    Result := True;\r\n    Exit;\r\n  end;\r\n  Result:=False;\r\n  With InitHandlerList do\r\n    begin\r\n    I:=0;\r\n    // Instance is the normally the lowest one, so that one should be used when searching.\r\n    While Not result and (I<Count) do\r\n      begin\r\n      If (Instance.InheritsFrom(TInitHandler(Items[i]).AClass)) then\r\n        Result:=TInitHandler(Items[i]).AHandler(Instance,RootAncestor);\r\n      Inc(I);\r\n      end;\r\n    end;\r\nend;\r\n\r\n\r\n\r\nprocedure RegisterInitComponentHandler(ComponentClass: TComponentClass;   Handler: TInitComponentHandler);\r\n\r\nVar\r\n  I : Integer;\r\n  H: TInitHandler;\r\nbegin\r\n  If (InitHandlerList=Nil) then\r\n    InitHandlerList:=TList.Create;\r\n  H:=TInitHandler.Create;\r\n  H.Aclass:=ComponentClass;\r\n  H.AHandler:=Handler;\r\n  try\r\n    With InitHandlerList do\r\n      begin\r\n        I:=0;\r\n        While (I<Count) and not H.AClass.InheritsFrom(TInitHandler(Items[I]).AClass) do\r\n          Inc(I);\r\n        { override? }\r\n        if (I<Count) and (TInitHandler(Items[I]).AClass=H.AClass) then\r\n          begin\r\n            TInitHandler(Items[I]).AHandler:=Handler;\r\n            H.Free;\r\n          end\r\n        else\r\n          InitHandlerList.Insert(I,H);\r\n      end;\r\n   except\r\n     H.Free;\r\n     raise;\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TObjectStreamConverter.OutStr(s: String);\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  For I:=1 to Length(S) do\r\n    Output.WriteBufferData(s[i]);\r\nend;\r\n\r\nprocedure TObjectStreamConverter.OutLn(s: String);\r\nbegin\r\n  OutStr(s + LineEnding);\r\nend;\r\n\r\n\r\nprocedure TObjectStreamConverter.Outchars(S: String);\r\n\r\nvar\r\n  res, NewStr: String;\r\n  i,len,w: Cardinal;\r\n  InString, NewInString: Boolean;\r\n  SObj : TJSString absolute s;\r\n\r\nbegin\r\n if S = '' then\r\n   res:= ''''''\r\n else\r\n   begin\r\n   res := '';\r\n   InString := False;\r\n   len:= Length(S);\r\n   i:=0;\r\n   while i < Len do\r\n     begin\r\n     NewInString := InString;\r\n     w := SObj.charCodeAt(i);\r\n     if w = ord('''') then\r\n       begin //quote char\r\n       if not InString then\r\n         NewInString := True;\r\n       NewStr := '''''';\r\n       end\r\n     else if (w >= 32) and (w < 127) then\r\n       begin //printable ascii or bytes\r\n       if not InString then\r\n         NewInString := True;\r\n       NewStr := TJSString.FromCharCode(w);\r\n       end\r\n    else\r\n       begin //ascii control chars, non ascii\r\n       if InString then\r\n         NewInString := False;\r\n       NewStr := '#' + IntToStr(w);\r\n       end;\r\n    if NewInString <> InString then\r\n      begin\r\n      NewStr := '''' + NewStr;\r\n      InString := NewInString;\r\n      end;\r\n    res := res + NewStr;\r\n    Inc(i);\r\n    end;\r\n  if InString then\r\n    res := res + '''';\r\n  end;\r\n OutStr(res);\r\nend;\r\n\r\n\r\nprocedure TObjectStreamConverter.OutString(s: String);\r\nbegin\r\n  OutChars(S);\r\nend;\r\n\r\n\r\n(*\r\nprocedure TObjectStreamConverter.OutUtf8Str(s: String);\r\nbegin\r\n  if Encoding=oteLFM then\r\n    OutChars(Pointer(S),PChar(S)+Length(S),@CharToOrd)\r\n  else\r\n    OutChars(Pointer(S),PChar(S)+Length(S),@Utf8ToOrd);\r\nend;\r\n*)\r\n\r\nfunction TObjectStreamConverter.ReadWord : word; {$ifdef CLASSESINLINE}inline;{$endif CLASSESINLINE}\r\nbegin\r\n  Input.ReadBufferData(Result);\r\nend;\r\n\r\nfunction TObjectStreamConverter.ReadDWord : longword; {$ifdef CLASSESINLINE}inline;{$endif CLASSESINLINE}\r\nbegin\r\n  Input.ReadBufferData(Result);\r\nend;\r\n\r\nfunction TObjectStreamConverter.ReadNativeInt : NativeInt; {$ifdef CLASSESINLINE}inline;{$endif CLASSESINLINE}\r\nbegin\r\n  Input.ReadBufferData(Result);\r\nend;\r\n\r\nfunction TObjectStreamConverter.ReadInt(ValueType: TValueType): NativeInt;\r\nbegin\r\n  case ValueType of\r\n    vaInt8: Result := ShortInt(Input.ReadByte);\r\n    vaInt16: Result := SmallInt(ReadWord);\r\n    vaInt32: Result := LongInt(ReadDWord);\r\n    vaNativeInt: Result := ReadNativeInt;\r\n  end;\r\nend;\r\n\r\nfunction TObjectStreamConverter.ReadInt: NativeInt;\r\nbegin\r\n  Result := ReadInt(TValueType(Input.ReadByte));\r\nend;\r\n\r\n\r\nfunction TObjectStreamConverter.ReadDouble : Double;\r\n\r\nbegin\r\n  Input.ReadBufferData(Result);\r\nend;\r\n\r\nfunction TObjectStreamConverter.ReadStr: String;\r\n\r\nvar\r\n  l,i: Byte;\r\n  c : Char;\r\n\r\nbegin\r\n  Input.ReadBufferData(L);\r\n  SetLength(Result,L);\r\n  For I:=1 to L do\r\n    begin\r\n    Input.ReadBufferData(C);\r\n    Result[i]:=C;\r\n    end;\r\nend;\r\n\r\nfunction TObjectStreamConverter.ReadString(StringType: TValueType): String;\r\n\r\nvar\r\n  i: Integer;\r\n  C : Char;\r\n\r\nbegin\r\n  Result:='';\r\n  if StringType<>vaString then\r\n    Raise EFilerError.Create('Invalid string type passed to ReadString');\r\n  i:=ReadDWord;\r\n  SetLength(Result, i);\r\n  for I:=1 to Length(Result) do\r\n    begin\r\n    Input.ReadbufferData(C);\r\n    Result[i]:=C;\r\n    end;\r\nend;\r\n\r\nprocedure TObjectStreamConverter.ProcessBinary;\r\n\r\nvar\r\n  ToDo, DoNow, i: LongInt;\r\n  lbuf: TBytes;\r\n  s: String;\r\n\r\nbegin\r\n  ToDo := ReadDWord;\r\n  SetLength(lBuf,32);\r\n  OutLn('{');\r\n  while ToDo > 0 do\r\n    begin\r\n    DoNow := ToDo;\r\n    if DoNow > 32 then\r\n      DoNow := 32;\r\n    Dec(ToDo, DoNow);\r\n    s := Indent + '  ';\r\n    Input.ReadBuffer(lbuf, DoNow);\r\n    for i := 0 to DoNow - 1 do\r\n      s := s + IntToHex(lbuf[i], 2);\r\n    OutLn(s);\r\n  end;\r\n  OutLn(indent + '}');\r\nend;\r\n\r\nprocedure TObjectStreamConverter.ProcessValue(ValueType: TValueType; Indent: String);\r\n\r\n\r\nvar\r\n  s: String;\r\n{      len: LongInt; }\r\n  IsFirst: Boolean;\r\n{$ifndef FPUNONE}\r\n  ext: Extended;\r\n{$endif}\r\n\r\nbegin\r\n  case ValueType of\r\n    vaList: begin\r\n        OutStr('(');\r\n        IsFirst := True;\r\n        while True do begin\r\n          ValueType := TValueType(Input.ReadByte);\r\n          if ValueType = vaNull then break;\r\n          if IsFirst then begin\r\n            OutLn('');\r\n            IsFirst := False;\r\n          end;\r\n          OutStr(Indent + '  ');\r\n          ProcessValue(ValueType, Indent + '  ');\r\n        end;\r\n        OutLn(Indent + ')');\r\n      end;\r\n    vaInt8: OutLn(IntToStr(ShortInt(Input.ReadByte)));\r\n    vaInt16: OutLn( IntToStr(SmallInt(ReadWord)));\r\n    vaInt32: OutLn(IntToStr(LongInt(ReadDWord)));\r\n    vaNativeInt: OutLn(IntToStr(ReadNativeInt));\r\n    vaDouble: begin\r\n        ext:=ReadDouble;\r\n        Str(ext,S);// Do not use localized strings.\r\n        OutLn(S);\r\n      end;\r\n    vaString: begin\r\n        if PlainStrings then\r\n          OutStr( ''''+StringReplace(ReadString(vaString),'''','''''',[rfReplaceAll])+'''')\r\n        else\r\n          OutString(ReadString(vaString) {''''+StringReplace(ReadString(vaString),'''','''''',[rfReplaceAll])+''''});\r\n        OutLn('');\r\n      end;\r\n    vaIdent: OutLn(ReadStr);\r\n    vaFalse: OutLn('False');\r\n    vaTrue: OutLn('True');\r\n    vaBinary: ProcessBinary;\r\n    vaSet: begin\r\n        OutStr('[');\r\n        IsFirst := True;\r\n        while True do begin\r\n          s := ReadStr;\r\n          if Length(s) = 0 then break;\r\n          if not IsFirst then OutStr(', ');\r\n          IsFirst := False;\r\n          OutStr(s);\r\n        end;\r\n        OutLn(']');\r\n      end;\r\n    vaNil:\r\n      OutLn('nil');\r\n    vaCollection: begin\r\n        OutStr('<');\r\n        while Input.ReadByte <> 0 do begin\r\n          OutLn(Indent);\r\n          Input.Seek(-1, soCurrent);\r\n          OutStr(indent + '  item');\r\n          ValueType := TValueType(Input.ReadByte);\r\n          if ValueType <> vaList then\r\n            OutStr('[' + IntToStr(ReadInt(ValueType)) + ']');\r\n          OutLn('');\r\n          ReadPropList(indent + '    ');\r\n          OutStr(indent + '  end');\r\n        end;\r\n        OutLn('>');\r\n      end;\r\n    {vaSingle: begin OutLn('!!Single!!'); exit end;\r\n    vaCurrency: begin OutLn('!!Currency!!'); exit end;\r\n    vaDate: begin OutLn('!!Date!!'); exit end;}\r\n    else\r\n      Raise EReadError.CreateFmt(SErrInvalidPropertyType,[Ord(ValueType)]);\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TObjectStreamConverter.ReadPropList(indent: String);\r\n\r\n\r\nbegin\r\n  while Input.ReadByte <> 0 do begin\r\n    Input.Seek(-1, soCurrent);\r\n    OutStr(indent + ReadStr + ' = ');\r\n    ProcessValue(TValueType(Input.ReadByte), Indent);\r\n  end;\r\nend;\r\n\r\nprocedure TObjectStreamConverter.ReadObject(indent: String);\r\n\r\nvar\r\n  b: Byte;\r\n  ObjClassName, ObjName: String;\r\n  ChildPos: LongInt;\r\n\r\nbegin\r\n  // Check for FilerFlags\r\n  b := Input.ReadByte;\r\n  if (b and $f0) = $f0 then begin\r\n    if (b and 2) <> 0 then ChildPos := ReadInt;\r\n  end else begin\r\n    b := 0;\r\n    Input.Seek(-1, soCurrent);\r\n  end;\r\n\r\n  ObjClassName := ReadStr;\r\n  ObjName := ReadStr;\r\n\r\n  OutStr(Indent);\r\n  if (b and 1) <> 0 then OutStr('inherited')\r\n  else\r\n   if (b and 4) <> 0 then OutStr('inline')\r\n   else OutStr('object');\r\n  OutStr(' ');\r\n  if ObjName <> '' then\r\n    OutStr(ObjName + ': ');\r\n  OutStr(ObjClassName);\r\n  if (b and 2) <> 0 then OutStr('[' + IntToStr(ChildPos) + ']');\r\n  OutLn('');\r\n\r\n  ReadPropList(indent + '  ');\r\n\r\n  while Input.ReadByte <> 0 do begin\r\n    Input.Seek(-1, soCurrent);\r\n    ReadObject(indent + '  ');\r\n  end;\r\n  OutLn(indent + 'end');\r\nend;\r\n\r\nprocedure TObjectStreamConverter.ObjectBinaryToText(aInput, aOutput: TStream; aEncoding: TObjectTextEncoding);\r\n\r\nbegin\r\n  FInput:=aInput;\r\n  FOutput:=aOutput;\r\n  FEncoding:=aEncoding;\r\n  Execute;\r\nend;\r\n\r\nprocedure TObjectStreamConverter.Execute;\r\n\r\nvar\r\n  Signature: LongInt;\r\n\r\nbegin\r\n  if FIndent = '' then FInDent:='  ';\r\n  If Not Assigned(Input) then\r\n    raise EReadError.Create('Missing input stream');\r\n  If Not Assigned(Output) then\r\n    raise EReadError.Create('Missing output stream');\r\n  FInput.ReadBufferData(Signature);\r\n  if Signature <> FilerSignatureInt then\r\n    raise EReadError.Create(SInvalidImage);\r\n  ReadObject('');\r\nend;\r\n\r\nprocedure TObjectStreamConverter.ObjectBinaryToText(aInput, aOutput: TStream);\r\nbegin\r\n  ObjectBinaryToText(aInput,aOutput,oteDFM);\r\nend;\r\n\r\n{\r\n    This file is part of the Free Component Library (FCL)\r\n    Copyright (c) 1999-2007 by the Free Pascal development team\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\n{****************************************************************************}\r\n{*                             TParser                                      *}\r\n{****************************************************************************}\r\n\r\nconst\r\n{$ifdef CPU16}\r\n  { Avoid too big local stack use for\r\n    MSDOS tiny memory model that uses less than 4096\r\n    bytes for total stack by default. }\r\n  ParseBufSize     = 512;\r\n{$else not CPU16}\r\n  ParseBufSize     = 4096;\r\n{$endif not CPU16}\r\n\r\n  TokNames : array[TParserToken] of string = (\r\n    '?',\r\n    'EOF',\r\n    'Symbol',\r\n    'String',\r\n    'Integer',\r\n    'Float',\r\n    '-',\r\n    '[',\r\n    '(',\r\n    '<',\r\n    '{',\r\n    ']',\r\n    ')',\r\n    '>',\r\n    '}',\r\n    ',',\r\n    '.',\r\n    '=',\r\n    ':',\r\n    '+'\r\n  );\r\n\r\nfunction TParser.GetTokenName(aTok: TParserToken): string;\r\nbegin\r\n  Result:=TokNames[aTok]\r\nend;\r\n\r\nprocedure TParser.LoadBuffer;\r\n\r\nvar\r\n  CharsRead,i: integer;\r\n\r\nbegin\r\n  CharsRead:=0;\r\n  for I:=0 to ParseBufSize-1 do\r\n  begin\r\n    if FStream.ReadData(FBuf[i])<>2 then\r\n      Break;\r\n    Inc(CharsRead);\r\n  end;\r\n  Inc(FDeltaPos, CharsRead);\r\n  FPos := 0;\r\n  FBufLen := CharsRead;\r\n  FEofReached:=CharsRead = 0;\r\nend;\r\n\r\nprocedure TParser.CheckLoadBuffer; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\nbegin\r\n  if fPos>=FBufLen then\r\n    LoadBuffer;\r\nend;\r\n\r\nprocedure TParser.ProcessChar; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\nbegin\r\n  fLastTokenStr:=fLastTokenStr+fBuf[fPos];\r\n\r\n  GotoToNextChar;\r\nend;\r\n\r\nfunction TParser.IsNumber: boolean; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\nbegin\r\n  Result:=fBuf[fPos] in ['0'..'9'];\r\nend;\r\n\r\nfunction TParser.IsHexNum: boolean; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\nbegin\r\n  Result:=fBuf[fPos] in ['0'..'9','A'..'F','a'..'f'];\r\nend;\r\n\r\nfunction TParser.IsAlpha: boolean; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\nbegin\r\n  Result:=fBuf[fPos] in ['_','A'..'Z','a'..'z'];\r\nend;\r\n\r\nfunction TParser.IsAlphaNum: boolean; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\nbegin\r\n  Result:=IsAlpha or IsNumber;\r\nend;\r\n\r\nfunction TParser.GetHexValue(c: char): byte; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\nbegin\r\n  case c of\r\n    '0'..'9' : Result:=ord(c)-$30;\r\n    'A'..'F' : Result:=ord(c)-$37; //-$41+$0A\r\n    'a'..'f' : Result:=ord(c)-$57; //-$61+$0A\r\n  end;\r\nend;\r\n\r\nfunction TParser.GetAlphaNum: string;\r\nbegin\r\n  if not IsAlpha then\r\n    ErrorFmt(SParserExpected,[GetTokenName(toSymbol)]);\r\n  Result:='';\r\n  while (not fEofReached) and IsAlphaNum do\r\n  begin\r\n    Result:=Result+fBuf[fPos];\r\n    GotoToNextChar;\r\n  end;\r\nend;\r\n\r\nprocedure TParser.HandleNewLine;\r\nbegin\r\n  if fBuf[fPos]=#13 then //CR\r\n    GotoToNextChar;\r\n\r\n  if (not fEOFReached) and (fBuf[fPos]=#10) then //LF\r\n    GotoToNextChar;\r\n\r\n  inc(fSourceLine);\r\n  fDeltaPos:=-(fPos-1);\r\nend;\r\n\r\nprocedure TParser.SkipBOM;\r\n\r\nbegin\r\n  // No BOM support\r\nend;\r\n\r\nprocedure TParser.SkipSpaces;\r\nbegin\r\n  while not FEofReached and (fBuf[fPos] in [' ',#9]) do GotoToNextChar;\r\nend;\r\n\r\nprocedure TParser.SkipWhitespace;\r\nbegin\r\n  while not FEofReached do\r\n  begin\r\n    case fBuf[fPos] of\r\n      ' ',#9  : SkipSpaces;\r\n      #10,#13 : HandleNewLine\r\n      else break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TParser.HandleEof;\r\nbegin\r\n  fToken:=toEOF;\r\n  fLastTokenStr:='';\r\nend;\r\n\r\nprocedure TParser.HandleAlphaNum;\r\nbegin\r\n  fLastTokenStr:=GetAlphaNum;\r\n  fToken:=toSymbol;\r\nend;\r\n\r\nprocedure TParser.HandleNumber;\r\ntype\r\n  floatPunct = (fpDot,fpE);\r\n  floatPuncts = set of floatPunct;\r\nvar\r\n  allowed : floatPuncts;\r\nbegin\r\n  fLastTokenStr:='';\r\n  while IsNumber do\r\n    ProcessChar;\r\n  fToken:=toInteger;\r\n  if (fBuf[fPos] in ['.','e','E']) then\r\n  begin\r\n    fToken:=toFloat;\r\n    allowed:=[fpDot,fpE];\r\n    while (fBuf[fPos] in ['.','e','E','0'..'9']) do\r\n    begin\r\n      case fBuf[fPos] of\r\n        '.'     : if fpDot in allowed then Exclude(allowed,fpDot) else break;\r\n        'E','e' : if fpE in allowed then\r\n                  begin\r\n                    allowed:=[];\r\n                    ProcessChar;\r\n                    if (fBuf[fPos] in ['+','-']) then ProcessChar;\r\n                    if not (fBuf[fPos] in ['0'..'9']) then\r\n                      ErrorFmt(SParserInvalidFloat,[fLastTokenStr+fBuf[fPos]]);\r\n                  end\r\n                  else break;\r\n      end;\r\n      ProcessChar;\r\n    end;\r\n  end;\r\n  if (fBuf[fPos] in ['s','S','d','D','c','C']) then //single, date, currency\r\n  begin\r\n    fFloatType:=fBuf[fPos];\r\n\r\n    GotoToNextChar;\r\n\r\n    fToken:=toFloat;\r\n  end\r\n  else fFloatType:=#0;\r\nend;\r\n\r\nprocedure TParser.HandleHexNumber;\r\nvar valid : boolean;\r\nbegin\r\n  fLastTokenStr:='$';\r\n  GotoToNextChar;\r\n  valid:=false;\r\n  while IsHexNum do\r\n  begin\r\n    valid:=true;\r\n    ProcessChar;\r\n  end;\r\n  if not valid then\r\n    ErrorFmt(SParserInvalidInteger,[fLastTokenStr]);\r\n  fToken:=toInteger;\r\nend;\r\n\r\nfunction TParser.HandleQuotedString: string;\r\nbegin\r\n  Result:='';\r\n  GotoToNextChar;\r\n\r\n  while true do\r\n  begin\r\n    case fBuf[fPos] of\r\n      #0     : ErrorStr(SParserUnterminatedString);\r\n      #13,#10 : ErrorStr(SParserUnterminatedString);\r\n      ''''   : begin\r\n                 GotoToNextChar;\r\n                 if fBuf[fPos]<>'''' then exit;\r\n               end;\r\n    end;\r\n    Result:=Result+fBuf[fPos];\r\n    GotoToNextChar;\r\n  end;\r\nend;\r\n\r\nFunction TParser.HandleDecimalCharacter : Char;\r\n\r\nvar\r\n   i : integer;\r\n\r\nbegin\r\n  GotoToNextChar;\r\n  // read a word number\r\n  i:=0;\r\n  while IsNumber and (i<high(word)) do\r\n    begin\r\n    i:=i*10+Ord(fBuf[fPos])-ord('0');\r\n    GotoToNextChar;\r\n    end;\r\n  if i>high(word) then i:=0;\r\n  Result:=Char(i);\r\nend;\r\n\r\nprocedure TParser.HandleString;\r\n\r\nvar\r\n  s: string;\r\n\r\nbegin\r\n  fLastTokenStr:='';\r\n  while true do\r\n  begin\r\n    case fBuf[fPos] of\r\n      '''' :\r\n        begin\r\n          s:=HandleQuotedString;\r\n          fLastTokenStr:=fLastTokenStr+s;\r\n        end;\r\n      '#'  :\r\n        begin\r\n          fLastTokenStr:=fLastTokenStr+HandleDecimalCharacter;\r\n        end;\r\n      else break;\r\n    end;\r\n  end;\r\n  fToken:=Classes.toString\r\nend;\r\n\r\nprocedure TParser.HandleMinus;\r\nbegin\r\n  GotoToNextChar;\r\n  if IsNumber then\r\n  begin\r\n    HandleNumber;\r\n    fLastTokenStr:='-'+fLastTokenStr;\r\n  end\r\n  else\r\n  begin\r\n    fToken:=toMinus;\r\n    fLastTokenStr:='-';\r\n  end;\r\nend;\r\n\r\nprocedure TParser.HandleUnknown;\r\nbegin\r\n  fToken:=toUnknown;\r\n  fLastTokenStr:=fBuf[fPos];\r\n  GotoToNextChar;\r\nend;\r\n\r\nconstructor TParser.Create(Stream: TStream);\r\nbegin\r\n  fStream:=Stream;\r\n  SetLength(fBuf,ParseBufSize);\r\n  fBufLen:=0;\r\n  fPos:=0;\r\n  fDeltaPos:=1;\r\n  fSourceLine:=1;\r\n  fEofReached:=false;\r\n  fLastTokenStr:='';\r\n  fFloatType:=#0;\r\n  fToken:=toEOF;\r\n  LoadBuffer;\r\n  SkipBom;\r\n  NextToken;\r\nend;\r\n\r\nprocedure TParser.GotoToNextChar;\r\nbegin\r\n  Inc(FPos);\r\n\r\n  CheckLoadBuffer;\r\nend;\r\n\r\ndestructor TParser.Destroy;\r\n\r\nVar\r\n  aCount : Integer;\r\n\r\nbegin\r\n  aCount:=Length(fLastTokenStr)*2;\r\n  fStream.Position:=SourcePos-aCount;\r\nend;\r\n\r\nprocedure TParser.CheckToken(T: tParserToken);\r\nbegin\r\n  if fToken<>T then\r\n    ErrorFmt(SParserWrongTokenType,[GetTokenName(T),GetTokenName(fToken)]);\r\nend;\r\n\r\nprocedure TParser.CheckTokenSymbol(const S: string);\r\nbegin\r\n  CheckToken(toSymbol);\r\n  if CompareText(fLastTokenStr,S)<>0 then\r\n    ErrorFmt(SParserWrongTokenSymbol,[s,fLastTokenStr]);\r\nend;\r\n\r\nprocedure TParser.Error(const Ident: string);\r\nbegin\r\n  ErrorStr(Ident);\r\nend;\r\n\r\nprocedure TParser.ErrorFmt(const Ident: string; const Args: array of const);\r\nbegin\r\n  ErrorStr(Format(Ident,Args));\r\nend;\r\n\r\nprocedure TParser.ErrorStr(const Message: string);\r\nbegin\r\n  raise EParserError.CreateFmt(Message+SParserLocInfo,[SourceLine,fPos+fDeltaPos,SourcePos]);\r\nend;\r\n\r\nprocedure TParser.HexToBinary(Stream: TStream);\r\n\r\nvar\r\n  outbuf : TBytes;\r\n  b : byte;\r\n  i : integer;\r\n\r\nbegin\r\n  SetLength(OutBuf,ParseBufSize);\r\n  i:=0;\r\n  SkipWhitespace;\r\n  while IsHexNum do\r\n  begin\r\n    b:=(GetHexValue(fBuf[fPos]) shl 4);\r\n    GotoToNextChar;\r\n    if not IsHexNum then\r\n      Error(SParserUnterminatedBinValue);\r\n    b:=b or GetHexValue(fBuf[fPos]);\r\n    GotoToNextChar;\r\n    outbuf[i]:=b;\r\n    inc(i);\r\n    if i>=ParseBufSize then\r\n    begin\r\n      Stream.WriteBuffer(outbuf,i);\r\n      i:=0;\r\n    end;\r\n    SkipWhitespace;\r\n  end;\r\n  if i>0 then\r\n    Stream.WriteBuffer(outbuf,i);\r\n  NextToken;\r\nend;\r\n\r\nfunction TParser.NextToken: TParserToken;\r\n\r\n  Procedure SetToken(aToken : TParserToken);\r\n  begin\r\n    FToken:=aToken;\r\n    GotoToNextChar;\r\n  end;\r\n\r\nbegin\r\n  SkipWhiteSpace;\r\n  if fEofReached then\r\n    HandleEof\r\n  else\r\n    case fBuf[fPos] of\r\n      '_','A'..'Z','a'..'z' : HandleAlphaNum;\r\n      '$'                   : HandleHexNumber;\r\n      '-'                   : HandleMinus;\r\n      '0'..'9'              : HandleNumber;\r\n      '''','#'              : HandleString;\r\n      '[' : SetToken(toSetStart);\r\n      '(' : SetToken(toListStart);\r\n      '<' : SetToken(toCollectionStart);\r\n      '{' : SetToken(toBinaryStart);\r\n      ']' : SetToken(toSetEnd);\r\n      ')' : SetToken(toListEnd);\r\n      '>' : SetToken(toCollectionEnd);\r\n      '}' : SetToken(toBinaryEnd);\r\n      ',' : SetToken(toComma);\r\n      '.' : SetToken(toDot);\r\n      '=' : SetToken(toEqual);\r\n      ':' : SetToken(toColon);\r\n      '+' : SetToken(toPlus);\r\n      else\r\n        HandleUnknown;\r\n    end;\r\n  Result:=fToken;\r\nend;\r\n\r\nfunction TParser.SourcePos: Longint;\r\nbegin\r\n  Result:=fStream.Position-fBufLen+fPos;\r\nend;\r\n\r\nfunction TParser.TokenComponentIdent: string;\r\nbegin\r\n  if fToken<>toSymbol then\r\n    ErrorFmt(SParserExpected,[GetTokenName(toSymbol)]);\r\n  CheckLoadBuffer;\r\n  while fBuf[fPos]='.' do\r\n  begin\r\n    ProcessChar;\r\n    fLastTokenStr:=fLastTokenStr+GetAlphaNum;\r\n  end;\r\n  Result:=fLastTokenStr;\r\nend;\r\n\r\nFunction TParser.TokenFloat: double;\r\n\r\nvar\r\n  errcode : integer;\r\n\r\nbegin\r\n  Val(fLastTokenStr,Result,errcode);\r\n  if errcode<>0 then\r\n    ErrorFmt(SParserInvalidFloat,[fLastTokenStr]);\r\nend;\r\n\r\nFunction TParser.TokenInt: NativeInt;\r\nbegin\r\n  if not TryStrToInt64(fLastTokenStr,Result) then\r\n    Result:=StrToQWord(fLastTokenStr); //second chance for malformed files\r\nend;\r\n\r\nfunction TParser.TokenString: string;\r\nbegin\r\n  case fToken of\r\n    toFloat : if fFloatType<>#0 then\r\n                Result:=fLastTokenStr+fFloatType\r\n              else Result:=fLastTokenStr;\r\n    else\r\n      Result:=fLastTokenStr;\r\n  end;\r\nend;\r\n\r\n\r\nfunction TParser.TokenSymbolIs(const S: string): Boolean;\r\nbegin\r\n  Result:=(fToken=toSymbol) and (CompareText(fLastTokenStr,S)=0);\r\nend;\r\n\r\n\r\nprocedure TObjectTextConverter.WriteWord(w : word); {$ifdef CLASSESINLINE}inline;{$endif CLASSESINLINE}\r\nbegin\r\n  Output.WriteBufferData(w);\r\nend;\r\n\r\nprocedure TObjectTextConverter.WriteDWord(lw : longword); {$ifdef CLASSESINLINE}inline;{$endif CLASSESINLINE}\r\nbegin\r\n  Output.WriteBufferData(lw);\r\nend;\r\n\r\nprocedure TObjectTextConverter.WriteQWord(q : NativeInt); {$ifdef CLASSESINLINE}inline;{$endif CLASSESINLINE}\r\nbegin\r\n  Output.WriteBufferData(q);\r\nend;\r\n\r\nprocedure TObjectTextConverter.WriteDouble(e : double);\r\nbegin\r\n  Output.WriteBufferData(e);\r\nend;\r\n\r\nprocedure TObjectTextConverter.WriteString(s: String);\r\n\r\nvar\r\n  i,size : byte;\r\n\r\nbegin\r\n  if length(s)>255 then\r\n    size:=255\r\n  else\r\n    size:=length(s);\r\n  Output.WriteByte(size);\r\n  For I:=1 to Length(S) do\r\n     Output.WriteBufferData(s[i]);\r\nend;\r\n\r\nprocedure TObjectTextConverter.WriteWString(Const s: WideString);\r\n\r\nvar\r\n  i : Integer;\r\nbegin\r\n  WriteDWord(Length(s));\r\n  For I:=1 to Length(S) do\r\n    Output.WriteBufferData(s[i]);\r\nend;\r\n\r\nprocedure TObjectTextConverter.WriteInteger(value: NativeInt);\r\n\r\nbegin\r\n  if (value >= -128) and (value <= 127) then begin\r\n    Output.WriteByte(Ord(vaInt8));\r\n    Output.WriteByte(byte(value));\r\n  end else if (value >= -32768) and (value <= 32767) then begin\r\n    Output.WriteByte(Ord(vaInt16));\r\n    WriteWord(word(value));\r\n  end else if (value >= -2147483648) and (value <= 2147483647) then begin\r\n    Output.WriteByte(Ord(vaInt32));\r\n    WriteDWord(longword(value));\r\n  end else begin\r\n    Output.WriteByte(ord(vaInt64));\r\n    WriteQWord(NativeUInt(value));\r\n  end;\r\nend;\r\n\r\nprocedure TObjectTextConverter.ProcessWideString(const left : string);\r\n\r\nvar\r\n   ws : string;\r\nbegin\r\n  ws:=left+parser.TokenString;\r\n  while parser.NextToken = toPlus do\r\n    begin\r\n    parser.NextToken;   // Get next string fragment\r\n    if not (parser.Token=Classes.toString) then\r\n      parser.CheckToken(Classes.toString);\r\n    ws:=ws+parser.TokenString;\r\n    end;\r\n  Output.WriteByte(Ord(vaWstring));\r\n  WriteWString(ws);\r\nend;\r\n\r\n\r\nprocedure TObjectTextConverter.ProcessValue;\r\nvar\r\n  flt: double;\r\n  stream: TBytesStream;\r\nbegin\r\n  case parser.Token of\r\n    toInteger:\r\n      begin\r\n        WriteInteger(parser.TokenInt);\r\n        parser.NextToken;\r\n      end;\r\n    toFloat:\r\n      begin\r\n        Output.WriteByte(Ord(vaExtended));\r\n        flt := Parser.TokenFloat;\r\n        WriteDouble(flt);\r\n        parser.NextToken;\r\n      end;\r\n    classes.toString:\r\n      ProcessWideString('');\r\n    toSymbol:\r\n      begin\r\n        if CompareText(parser.TokenString, 'True') = 0 then\r\n          Output.WriteByte(Ord(vaTrue))\r\n        else if CompareText(parser.TokenString, 'False') = 0 then\r\n          Output.WriteByte(Ord(vaFalse))\r\n        else if CompareText(parser.TokenString, 'nil') = 0 then\r\n          Output.WriteByte(Ord(vaNil))\r\n        else\r\n        begin\r\n          Output.WriteByte(Ord(vaIdent));\r\n          WriteString(parser.TokenComponentIdent);\r\n        end;\r\n        Parser.NextToken;\r\n      end;\r\n    // Set\r\n    toSetStart:\r\n      begin\r\n        parser.NextToken;\r\n        Output.WriteByte(Ord(vaSet));\r\n        if parser.Token <> toSetEnd then\r\n          while True do\r\n          begin\r\n            parser.CheckToken(toSymbol);\r\n            WriteString(parser.TokenString);\r\n            parser.NextToken;\r\n            if parser.Token = toSetEnd then\r\n              break;\r\n            parser.CheckToken(toComma);\r\n            parser.NextToken;\r\n          end;\r\n        Output.WriteByte(0);\r\n        parser.NextToken;\r\n      end;\r\n    // List\r\n    toListStart:\r\n      begin\r\n        parser.NextToken;\r\n        Output.WriteByte(Ord(vaList));\r\n        while parser.Token <> toListEnd do\r\n          ProcessValue;\r\n        Output.WriteByte(0);\r\n        parser.NextToken;\r\n      end;\r\n    // Collection\r\n    toCollectionStart:\r\n      begin\r\n        parser.NextToken;\r\n        Output.WriteByte(Ord(vaCollection));\r\n        while parser.Token <> toCollectionEnd do\r\n        begin\r\n          parser.CheckTokenSymbol('item');\r\n          parser.NextToken;\r\n          // ConvertOrder\r\n          Output.WriteByte(Ord(vaList));\r\n          while not parser.TokenSymbolIs('end') do\r\n            ProcessProperty;\r\n          parser.NextToken;   // Skip 'end'\r\n          Output.WriteByte(0);\r\n        end;\r\n        Output.WriteByte(0);\r\n        parser.NextToken;\r\n      end;\r\n    // Binary data\r\n    toBinaryStart:\r\n      begin\r\n        Output.WriteByte(Ord(vaBinary));\r\n        stream := TBytesStream.Create;\r\n        try\r\n          parser.HexToBinary(stream);\r\n          WriteDWord(stream.Size);\r\n          Output.WriteBuffer(Stream.Bytes,Stream.Size);\r\n        finally\r\n          stream.Free;\r\n        end;\r\n        parser.NextToken;\r\n      end;\r\n    else\r\n      parser.Error(SParserInvalidProperty);\r\n  end;\r\nend;\r\n\r\nprocedure TObjectTextConverter.ProcessProperty;\r\nvar\r\n  name: String;\r\nbegin\r\n  // Get name of property\r\n  parser.CheckToken(toSymbol);\r\n  name := parser.TokenString;\r\n  while True do begin\r\n    parser.NextToken;\r\n    if parser.Token <> toDot then break;\r\n    parser.NextToken;\r\n    parser.CheckToken(toSymbol);\r\n    name := name + '.' + parser.TokenString;\r\n  end;\r\n  WriteString(name);\r\n  parser.CheckToken(toEqual);\r\n  parser.NextToken;\r\n  ProcessValue;\r\nend;\r\n\r\nprocedure TObjectTextConverter.ProcessObject;\r\nvar\r\n  Flags: Byte;\r\n  ObjectName, ObjectType: String;\r\n  ChildPos: Integer;\r\nbegin\r\n  if parser.TokenSymbolIs('OBJECT') then\r\n    Flags :=0  { IsInherited := False }\r\n  else begin\r\n    if parser.TokenSymbolIs('INHERITED') then\r\n      Flags := 1 { IsInherited := True; }\r\n    else begin\r\n      parser.CheckTokenSymbol('INLINE');\r\n      Flags := 4;\r\n    end;\r\n  end;\r\n  parser.NextToken;\r\n  parser.CheckToken(toSymbol);\r\n  ObjectName := '';\r\n  ObjectType := parser.TokenString;\r\n  parser.NextToken;\r\n  if parser.Token = toColon then begin\r\n    parser.NextToken;\r\n    parser.CheckToken(toSymbol);\r\n    ObjectName := ObjectType;\r\n    ObjectType := parser.TokenString;\r\n    parser.NextToken;\r\n    if parser.Token = toSetStart then begin\r\n      parser.NextToken;\r\n      ChildPos := parser.TokenInt;\r\n      parser.NextToken;\r\n      parser.CheckToken(toSetEnd);\r\n      parser.NextToken;\r\n      Flags := Flags or 2;\r\n    end;\r\n  end;\r\n  if Flags <> 0 then begin\r\n    Output.WriteByte($f0 or Flags);\r\n    if (Flags and 2) <> 0 then\r\n      WriteInteger(ChildPos);\r\n  end;\r\n  WriteString(ObjectType);\r\n  WriteString(ObjectName);\r\n\r\n  // Convert property list\r\n  while not (parser.TokenSymbolIs('END') or\r\n    parser.TokenSymbolIs('OBJECT') or\r\n    parser.TokenSymbolIs('INHERITED') or\r\n    parser.TokenSymbolIs('INLINE')) do\r\n    ProcessProperty;\r\n  Output.WriteByte(0);        // Terminate property list\r\n\r\n  // Convert child objects\r\n  while not parser.TokenSymbolIs('END') do ProcessObject;\r\n  parser.NextToken;           // Skip end token\r\n  Output.WriteByte(0);        // Terminate property list\r\nend;\r\n\r\nprocedure TObjectTextConverter.ObjectTextToBinary(aInput, aOutput: TStream);\r\n\r\nbegin\r\n  FinPut:=aInput;\r\n  FOutput:=aOutput;\r\n  Execute;\r\nend;\r\n\r\nprocedure TObjectTextConverter.Execute;\r\nbegin\r\n  If Not Assigned(Input) then\r\n    raise EReadError.Create('Missing input stream');\r\n  If Not Assigned(Output) then\r\n    raise EReadError.Create('Missing output stream');\r\n  FParser := TParser.Create(Input);\r\n  try\r\n    Output.WriteBufferData(FilerSignatureInt);\r\n    ProcessObject;\r\n  finally\r\n    FParser.Free;\r\n  end;\r\nend;\r\n\r\nprocedure ObjectTextToBinary(aInput, aOutput: TStream);\r\n\r\nvar\r\n  Conv : TObjectTextConverter;\r\n\r\nbegin\r\n  Conv:=TObjectTextConverter.Create;\r\n  try\r\n    Conv.ObjectTextToBinary(aInput, aOutput);\r\n  finally\r\n    Conv.free;\r\n  end;\r\nend;\r\n\r\n\r\n{ ----------------------------------------------------------------------\r\n  TDatamodule\r\n  ----------------------------------------------------------------------}\r\n\r\nconstructor TDataModule.Create(AOwner: TComponent);\r\nbegin\r\n  CreateNew(AOwner);\r\n  if (ClassType <> TDataModule) and\r\n     not (csDesigning in ComponentState) then\r\n    begin\r\n    if not InitInheritedComponent(Self, TDataModule) then\r\n      raise EStreamError.CreateFmt(SErrNoSTreaming, [ClassName]);\r\n    if OldCreateOrder then\r\n      DoCreate;\r\n    end;\r\nend;\r\n\r\nconstructor TDataModule.CreateNew(AOwner: TComponent);\r\n\r\nbegin\r\n  CreateNew(AOwner,0);\r\nend;\r\n\r\nconstructor TDataModule.CreateNew(AOwner: TComponent; CreateMode: Integer);\r\nbegin\r\n  inherited Create(AOwner);\r\n  FDPPI := 96;\r\n  if Assigned(AddDataModule) and (CreateMode>=0) then\r\n    AddDataModule(Self);\r\nend;\r\n\r\nclass constructor TDataModule.ClassCreate;\r\nbegin\r\n  RegisterInitComponentHandler(TDataModule,@DefaultInitHandler);\r\nend;\r\n\r\nprocedure TDataModule.AfterConstruction;\r\nbegin\r\n   If not OldCreateOrder then\r\n     DoCreate;\r\nend;\r\n\r\nprocedure TDataModule.BeforeDestruction;\r\nbegin\r\n  Destroying;\r\n  RemoveFixupReferences(Self, '');\r\n  if not OldCreateOrder then\r\n    DoDestroy;\r\nend;\r\n\r\ndestructor TDataModule.Destroy;\r\nbegin\r\n  if OldCreateOrder then\r\n    DoDestroy;\r\n  if Assigned(RemoveDataModule) then\r\n    RemoveDataModule(Self);\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TDataModule.DoCreate;\r\nbegin\r\n  if Assigned(FOnCreate) then\r\n    try\r\n      FOnCreate(Self);\r\n    except\r\n      if not HandleCreateException then\r\n        raise;\r\n    end;\r\nend;\r\n\r\nprocedure TDataModule.DoDestroy;\r\nbegin\r\n  if Assigned(FOnDestroy) then\r\n    try\r\n      FOnDestroy(Self);\r\n    except\r\n      if Assigned(ApplicationHandleException) then\r\n        ApplicationHandleException(Self);\r\n    end;\r\nend;\r\n\r\nprocedure TDataModule.DefineProperties(Filer: TFiler);\r\n\r\nvar\r\n  Ancestor : TDataModule;\r\n  HaveData,\r\n  HavePPIData: Boolean;\r\n\r\nbegin\r\n  inherited DefineProperties(Filer);\r\n  Ancestor := TDataModule(Filer.Ancestor);\r\n  HaveData:=(Ancestor=Nil) or\r\n            (FDSize.X<>Ancestor.FDSize.X) or\r\n            (FDSize.Y<>Ancestor.FDSize.Y) or\r\n            (FDPos.Y<>Ancestor.FDPos.Y) or\r\n            (FDPos.X<>Ancestor.FDPos.X);\r\n  HavePPIData:=(Assigned(Ancestor) and (FDPPI<>Ancestor.FDPPI)) or\r\n               (not Assigned(Ancestor) and (FDPPI<>96));\r\n  Filer.DefineProperty('Height', @ReadH, @WriteH, HaveData);\r\n  Filer.DefineProperty('HorizontalOffset', @ReadL, @WriteL, HaveData);\r\n  Filer.DefineProperty('VerticalOffset', @ReadT,@WriteT, HaveData);\r\n  Filer.DefineProperty('Width', @ReadW, @WriteW, HaveData);\r\n  Filer.DefineProperty('PPI', @ReadP, @WriteP,HavePPIData);\r\nend;\r\n\r\nprocedure TDataModule.GetChildren(Proc: TGetChildProc; Root: TComponent);\r\n\r\nvar\r\n  I : Integer;\r\n\r\nbegin\r\n  inherited GetChildren(Proc, Root);\r\n  if (Root=Self) then\r\n    for I:=0 to ComponentCount-1 do\r\n      If Not Components[I].HasParent then\r\n         Proc(Components[i]);\r\nend;\r\n\r\n\r\nfunction TDataModule.HandleCreateException: Boolean;\r\nbegin\r\n  Result:=Assigned(ApplicationHandleException);\r\n  if Result then\r\n    ApplicationHandleException(Self);\r\nend;\r\n\r\nprocedure TDataModule.ReadP(Reader: TReader);\r\nbegin\r\n  FDPPI := Reader.ReadInteger;\r\nend;\r\n\r\nprocedure TDataModule.ReadState(Reader: TReader);\r\nbegin\r\n  FOldOrder := false;\r\n  inherited ReadState(Reader);\r\nend;\r\n\r\nprocedure TDataModule.ReadT(Reader: TReader);\r\nbegin\r\n  FDPos.Y := Reader.ReadInteger;\r\nend;\r\n\r\nprocedure TDataModule.WriteT(Writer: TWriter);\r\nbegin\r\n  Writer.WriteInteger(FDPos.Y);\r\nend;\r\n\r\nprocedure TDataModule.ReadL(Reader: TReader);\r\nbegin\r\n  FDPos.X := Reader.ReadInteger;\r\nend;\r\n\r\nprocedure TDataModule.WriteL(Writer: TWriter);\r\nbegin\r\n  Writer.WriteInteger(FDPos.X);\r\nend;\r\n\r\nprocedure TDataModule.ReadW(Reader: TReader);\r\nbegin\r\n  FDSIze.X := Reader.ReadInteger;\r\nend;\r\n\r\nprocedure TDataModule.WriteP(Writer: TWriter);\r\nbegin\r\n  Writer.WriteInteger(FDPPI);\r\nend;\r\n\r\nprocedure TDataModule.WriteW(Writer: TWriter);\r\nbegin\r\n  Writer.WriteInteger(FDSIze.X);\r\nend;\r\n\r\nprocedure TDataModule.ReadH(Reader: TReader);\r\nbegin\r\n  FDSIze.Y := Reader.ReadInteger;\r\nend;\r\n\r\nprocedure TDataModule.WriteH(Writer: TWriter);\r\nbegin\r\n  Writer.WriteInteger(FDSIze.Y);\r\nend;\r\n\r\n{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            Copyright (c) 2019 - 2022                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\n{ TStringsHelper }\r\n\r\nprocedure TStringsHelper.LoadFromStream(Stream: TStream);\r\nbegin\r\n  LoadFromStream(Stream, TEncoding.UTF8);\r\nend;\r\n\r\n// possible encoding formats: https://encoding.spec.whatwg.org/\r\n{$HINTS OFF}\r\nprocedure TStringsHelper.LoadFromStream(Stream: TStream; Encoding: TEncoding);\r\nvar\r\n  arr: TJSArrayBuffer;\r\n  s: string;\r\n  buf: TBytes;\r\nbegin\r\n  Stream.Read(buf, Stream.Size);\r\n  arr := TMemoryStream.BytesToMemory(buf);\r\n\r\n  if Assigned(Encoding) and (Encoding <> Encoding.UTF8) then\r\n  begin\r\n    s := Encoding.GetEncoding;\r\n    asm\r\n      var enc = new TextDecoder(s);\r\n      s = enc.decode(arr);\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    asm\r\n      s =  String.fromCharCode.apply(null, new Uint16Array(arr));\r\n    end;\r\n  end;\r\n\r\n  (*\r\n  s := 'utf-8';\r\n  if Assigned(Encoding) then\r\n  begin\r\n    s := Encoding.GetEncoding;\r\n  end;\r\n\r\n  asm\r\n    var enc = new TextDecoder(s);\r\n    s = enc.decode(arr);\r\n  end;\r\n  *)\r\n\r\n  Text := s;\r\nend;\r\n\r\nprocedure TStringsHelper.SaveToStream(Stream: TStream);\r\nbegin\r\n  SaveToStream(Stream, TEncoding.UTF8);\r\nend;\r\n\r\nprocedure TStringsHelper.SaveToStream(Stream: TStream; Encoding: TEncoding);\r\nvar\r\n  s,txt: string;\r\n  arr: TJSArrayBuffer;\r\n  b: TBytes;\r\n  l: longint;\r\nbegin\r\n  s := 'utf-8';\r\n  if Assigned(Encoding) then\r\n  begin\r\n    s := Encoding.GetEncoding;\r\n  end;\r\n\r\n  txt := Text;\r\n\r\n  asm\r\n    var enc = new TextEncoder(s);\r\n    arr = enc.encode(txt);\r\n  end;\r\n\r\n  b := TMemoryStream.MemoryToBytes(arr);\r\n  l := arr.bytelength;\r\n\r\n  Stream.Write(b, l);\r\n  Stream.Position := 0;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\n// default encoding format\r\nfunction TEncoding.GetEncoding: string;\r\nbegin\r\n  Result := 'utf-8';\r\nend;\r\n\r\nclass function TEncoding.GetANSI: TEncoding;\r\nbegin\r\n  if not Assigned(FANSI) then\r\n    FANSI := TANSIEncoding.Create;\r\n\r\n  Result := FANSI;\r\nend;\r\n\r\nclass function TEncoding.GetASCII: TEncoding;\r\nbegin\r\n  if not Assigned(FASCII) then\r\n    FASCII := TASCIIEncoding.Create;\r\n\r\n  Result := FASCII;\r\nend;\r\n\r\nclass function TEncoding.GetUTF7: TEncoding;\r\nbegin\r\n  if not Assigned(FUTF7) then\r\n    FUTF7 := TUTF7Encoding.Create;\r\n\r\n  Result := FUTF7;\r\nend;\r\n\r\nclass function TEncoding.GetUTF8: TEncoding;\r\nbegin\r\n  if not Assigned(FUTF8) then\r\n    FUTF8 := TUTF8Encoding.Create;\r\n\r\n  Result := FUTF8;\r\nend;\r\n\r\nclass function TEncoding.GetUnicode: TEncoding;\r\nbegin\r\n  if not Assigned(FUnicode) then\r\n    FUnicode := TUnicodeEncoding.Create;\r\n\r\n  Result := FUnicode;\r\nend;\r\n\r\nfunction TUnicodeEncoding.GetEncoding: string;\r\nbegin\r\n  Result := 'unicode';\r\nend;\r\n\r\nfunction TUTF7Encoding.GetEncoding: string;\r\nbegin\r\n  Result := 'utf-7';\r\nend;\r\n\r\nfunction TUTF8Encoding.GetEncoding: string;\r\nbegin\r\n  Result := 'utf-8';\r\nend;\r\n\r\nfunction TANSIEncoding.GetEncoding: string;\r\nbegin\r\n  Result := 'windows-1252';\r\nend;\r\n\r\nfunction TASCIIEncoding.GetEncoding: string;\r\nbegin\r\n  Result := 'ISO-8859-2';\r\nend;\r\n\r\n{ ComponentPlatforms }\r\n\r\nconstructor ComponentPlatformsAttribute.Create(const Platforms: TPlatformIds);\r\nbegin\r\n  FPlatforms := Platforms;\r\nend;\r\n\r\n\r\ninitialization\r\n  ClassList:=TJSObject.New;\r\nend.\r\n\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2019 - 2022                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Menus;\r\n\r\n{$DEFINE NOPP}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, SysUtils, WEBLib.Controls, WEBLib.Graphics, Web;\r\n\r\ntype\r\n  TMainMenu = class;\r\n  TMenuItem = class;\r\n  TCustomMainMenu = class;\r\n\r\n  TMenuItemAutoFlag = (maAutomatic, maManual, maParent);\r\n  TMenuBreak = (mbNone, mbBreak, mbBarBreak);\r\n  THelpContext = -MaxLongint..MaxLongint;\r\n  //TShortCut = Low(Word)..High(Word);\r\n  TShortCut = type Word;\r\n  TMainMenuHamburgerMenuVisible = (hmAlways, hmNever, hmResponsive);\r\n\r\n  TMainMenuChangeEvent = procedure(Sender: TObject; Source: TMenuItem; Rebuild: boolean) of object;\r\n\r\n  TMenuItemList = class(TList)\r\n  private\r\n    function GetItem(Index: Integer): TMenuItem;\r\n    procedure PutItem(Index: Integer; const Value: TMenuItem);\r\n  public\r\n    property Items[Index: Integer]: TMenuItem read GetItem write PutItem; default;\r\n  end;\r\n\r\n  TMenuItem = class(TComponent)\r\n  private\r\n    FOwner: TMenuItem;\r\n    FCaption: string;\r\n    FItems: TMenuItemList;\r\n    FParentItem: TMenuItem;\r\n    FUpdateCount: integer;\r\n    FOnClick: TNotifyEvent;\r\n    FChecked: Boolean;\r\n    FEnabled: Boolean;\r\n    FDefault: Boolean;\r\n    FAutoCheck: Boolean;\r\n    FHint: string;\r\n    FAutoHotkeys: TMenuItemAutoFlag;\r\n    FRadioItem: Boolean;\r\n    FGroupIndex: Byte;\r\n    FVisible: Boolean;\r\n    FShortCut: TShortCut;\r\n    FBreak: TMenuBreak;\r\n    FImageIndex: Integer;\r\n    FAutoLineReduction: TMenuItemAutoFlag;\r\n    FHelpContext: THelpContext;\r\n    FElementClassName: TElementClassName;\r\n    FParentMenu: TComponent;\r\n    procedure SetChecked(const Value: Boolean);\r\n    procedure SetCaption(const Value: string);\r\n    procedure SetImageIndex(const Value: Integer);\r\n    procedure SetEnabled(const Value: Boolean);\r\n    //function HandleClick(Event: TJSEvent): Boolean; virtual;\r\n  protected\r\n    function GetCount: integer;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure BeginUpdate; virtual; reintroduce;\r\n    procedure EndUpdate; virtual; reintroduce;\r\n    procedure SetParentComponent(Value: TComponent); override;\r\n    procedure Add(Item: TMenuItem);\r\n    procedure Insert(Index: Integer; Item: TMenuItem); reintroduce;\r\n    function IsChild(Item: TMenuItem): boolean;\r\n    function GetOwner: TPersistent; override;\r\n    function GetParentMenu: TCustomMainMenu;\r\n    procedure GetChildren(Proc: TGetChildProc; Root: TComponent); override;\r\n    procedure SetChildOrder(Child: TComponent; Order: Integer); override;\r\n    procedure RemoveItem(AOwner, AItem: TComponent);\r\n    property Items: TMenuItemList read FItems write FItems;\r\n    property Count: Integer read GetCount;\r\n    property Parent: TMenuItem read FParentItem;\r\n    procedure Clear;\r\n    procedure Click;\r\n  published\r\n    property AutoCheck: Boolean read FAutoCheck write FAutoCheck default False;\r\n    property AutoHotkeys: TMenuItemAutoFlag read FAutoHotkeys write FAutoHotkeys default maParent;\r\n    property AutoLineReduction: TMenuItemAutoFlag read FAutoLineReduction write FAutoLineReduction default maParent;\r\n    property Break: TMenuBreak read FBreak write FBreak default mbNone;\r\n    property Caption: string read FCaption write SetCaption;\r\n    property Checked: Boolean read FChecked write SetChecked default False;\r\n    property Default: Boolean read FDefault write FDefault default False;\r\n    property Enabled: Boolean read FEnabled write SetEnabled default True;\r\n    property GroupIndex: Byte read FGroupIndex write FGroupIndex default 0;\r\n    property HelpContext: THelpContext read FHelpContext write FHelpContext default 0;\r\n    property Hint: string read FHint write FHint;\r\n    property ImageIndex: Integer read FImageIndex write SetImageIndex default -1;\r\n    property RadioItem: Boolean read FRadioItem write FRadioItem default False;\r\n    property ShortCut: TShortCut read FShortCut write FShortCut default 0;\r\n    property Visible: Boolean read FVisible write FVisible default True;\r\n    property ElementClassName: TElementClassName read FElementClassName write FElementClassName;\r\n    property OnClick: TNotifyEvent read FOnClick write FOnClick;\r\n  end;\r\n\r\n  TMainMenuAppearance = class;\r\n\r\n  THamburgerMenu = class(TPersistent)\r\n  private\r\n    FOwner: TMainMenuAppearance;\r\n    FVisible: TMainMenuHamburgerMenuVisible;\r\n    FCaption: string;\r\n    FBackgroundColor: TColor;\r\n    FCaptionColor: TColor;\r\n    FResponsiveMaxWidth: Integer;\r\n    procedure SetVisible(const Value: TMainMenuHamburgerMenuVisible);\r\n    procedure SetBackgroundColor(const Value: TColor);\r\n    procedure SetCaption(const Value: string);\r\n    procedure SetCaptionColor(const Value: TColor);\r\n    procedure SetResponsiveMaxWidth(const Value: Integer);\r\n  public\r\n    constructor Create(AOwner: TMainMenuAppearance); overload;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    function GetOwner: TPersistent; override;\r\n  published\r\n    property Caption: string read FCaption write SetCaption;\r\n    property CaptionColor: TColor read FCaptionColor write SetCaptionColor default clWhite;\r\n    property BackgroundColor: TColor read FBackgroundColor write SetBackgroundColor default clSilver;\r\n    property Visible: TMainMenuHamburgerMenuVisible read FVisible write SetVisible default hmResponsive;\r\n    property ResponsiveMaxWidth: Integer read FResponsiveMaxWidth write SetResponsiveMaxWidth default 768;\r\n  end;\r\n\r\n  TMainMenuAppearance = class(TPersistent)\r\n  private\r\n    FOwner: TMainMenu;\r\n    FBackgroundColor: TColor;\r\n    FHoverFontColor: TColor;\r\n    FHoverColor: TColor;\r\n    FImageURLs: TStringList;\r\n    FHamburgerMenu: THamburgerMenu;\r\n    FImageSize: Integer;\r\n    FSubmenuIndicator: string;\r\n    procedure SetBackgroundColor(const Value: TColor);\r\n    procedure SetHoverColor(const Value: TColor);\r\n    procedure SetHoverFontColor(const Value: TColor);\r\n    procedure SetImageURLs(const Value: TStringList);\r\n    procedure SetImageSize(const Value: Integer);\r\n    procedure SetSubmenuIndicator(const Value: string);\r\n  protected\r\n    procedure HandleImageURLsChanged(Sender: TObject);\r\n  public\r\n    constructor Create(AOwner: TMainMenu); overload;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    function GetOwner: TPersistent; override;\r\n  published\r\n    property BackgroundColor: TColor read FBackgroundColor write SetBackgroundColor default $F0F0F0;\r\n    property HamburgerMenu: THamburgerMenu read FHamburgerMenu write FHamburgerMenu;\r\n    property HoverColor: TColor read FHoverColor write SetHoverColor default clHighlight;\r\n    property HoverFontColor: TColor read FHoverFontColor write SetHoverFontColor default clHighlightText;\r\n    property ImageURLs: TStringList read FImageURLs write SetImageURLs;\r\n    property ImageSize: Integer read FImageSize write SetImageSize default 16;\r\n    property SubmenuIndicator: string read FSubmenuIndicator write SetSubmenuIndicator;\r\n  end;\r\n\r\n  TCustomMainMenu = class(TCustomControl)\r\n  private\r\n    FItems: TMenuItem;\r\n    FOnChange: TMainMenuChangeEvent;\r\n  protected\r\n    procedure Loaded; override;\r\n    procedure UpdateElement; override;\r\n    function GetUniqueName(AName: string): string;\r\n    procedure SetName(const NewName: TComponentName); override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure GetChildren(Proc: TGetChildProc; Root: TComponent); override;\r\n    procedure SetChildOrder(Child: TComponent; Order: Integer); override;\r\n  published\r\n    property Items: TMenuItem read FItems;\r\n    property OnChange: TMainMenuChangeEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TMainMenu = class(TCustomMainMenu)\r\n  private\r\n    FMenu: TJSHTMLElement;\r\n    FMainMenu: Boolean;\r\n    FMenuIndex: Integer;\r\n    FAppearance: TMainMenuAppearance;\r\n    FContainer: TControl;\r\n    FIsPopupMenu: Boolean;\r\n    FShowPopup: Boolean;\r\n    FAutoMerge: boolean;\r\n    function HandleChange(Event: TJSEvent): Boolean; virtual;\r\n  protected\r\n    procedure Loaded; override;\r\n    procedure UpdateElement; override;\r\n    function GetMenuSource(Item: TMenuItem): TJSHTMLElement;\r\n    function GetItemByName(AMenu: TMenuItem; Name: string): TMenuItem;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    function CreateElement: TJSElement; override;\r\n    destructor Destroy; override;\r\n    property AutoMerge: boolean read FAutoMerge write FAutoMerge;\r\n  published\r\n    property Appearance: TMainMenuAppearance read FAppearance write FAppearance;\r\n    property Container: TControl read FContainer write FContainer;\r\n  end;\r\n\r\n  TWebMainMenu = class(TMainMenu);\r\n\r\n  TPopupMenu = class(TMainMenu)\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure Popup(X, Y: Integer);\r\n  end;\r\n\r\n  TWebPopupMenu = class(TPopupMenu);\r\n\r\n  TWebCustomControl = class(TCustomControl)\r\n  private\r\n    FPopupMenu: TPopupMenu;\r\n  protected\r\n    function HandleDoContextMenu(Event: TJSMouseEvent): Boolean; override;\r\n    procedure Notification(AComponent: TComponent;  Operation: TOperation); override;\r\n    property PopupMenu: TPopupMenu read FPopupMenu write FPopupMenu;\r\n  end;\r\n\r\n  TWebGraphicControl = class(TGraphicControl)\r\n  private\r\n    FPopupMenu: TPopupMenu;\r\n  protected\r\n    function HandleDoContextMenu(Event: TJSMouseEvent): Boolean; override;\r\n    procedure Notification(AComponent: TComponent;  Operation: TOperation); override;\r\n    property PopupMenu: TPopupMenu read FPopupMenu write FPopupMenu;\r\n  end;\r\n\r\n\r\nimplementation\r\n\r\nuses\r\n  Types, WEBLib.Forms;\r\n\r\nfunction MakeValidName(s: string): string;\r\nconst\r\n  Alpha = ['A'..'Z', 'a'..'z', '_'];\r\n  AlphaNum = Alpha + ['0'..'9'];\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := '';\r\n\r\n  for i := 1 to Length(s) do\r\n  begin\r\n    if s[i] in AlphaNum then\r\n      Result := Result + s[i];\r\n  end;\r\nend;\r\n\r\n\r\n{ TCustomMainMenu }\r\n\r\nprocedure TCustomMainMenu.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FItems := TMenuItem.Create(Self);\r\n  FItems.FParentMenu := Self;\r\n  WidthStyle := ssAuto;\r\n  Height := 30;\r\nend;\r\n\r\ndestructor TCustomMainMenu.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomMainMenu.GetChildren(Proc: TGetChildProc; Root: TComponent);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if Assigned(FItems) and Assigned(FItems.Items) then\r\n  begin\r\n    for I := 0 to FItems.Items.Count - 1 do\r\n    begin\r\n      Proc(TMenuItem(FItems.Items[I]));\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomMainMenu.GetUniqueName(AName: string): string;\r\nvar\r\n  i,id: integer;\r\n  found: boolean;\r\nbegin\r\n  id := 1;\r\n\r\n  if AName = ''  then\r\n    AName := Name + 'item';\r\n\r\n  AName := MakeValidName(AName);\r\n\r\n  repeat\r\n    Result := AName + inttostr(id);\r\n\r\n    found := true;\r\n\r\n    for i := 0 to Owner.ComponentCount - 1 do\r\n    begin\r\n      if Owner.Components[i].Name = Result then\r\n      begin\r\n        found := false;\r\n        inc(id);\r\n        break;\r\n      end;\r\n    end;\r\n\r\n  until found;\r\nend;\r\n\r\nprocedure TCustomMainMenu.Loaded;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n    UpdateElement;\r\nend;\r\n\r\nprocedure TCustomMainMenu.SetChildOrder(Child: TComponent; Order: Integer);\r\nvar\r\n  idx: integer;\r\nbegin\r\n  idx := FItems.Items.IndexOf(Child);\r\n  if (idx >= 0) and (Order < FItems.Items.Count) then\r\n  begin\r\n    FItems.Items.Move(idx, Order);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMainMenu.SetName(const NewName: TComponentName);\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n  if (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomMainMenu.UpdateElement;\r\nbegin\r\n  inherited;\r\n  if IsUpdating then\r\n    Exit;\r\nend;\r\n\r\n{ TMainMenu }\r\n\r\nfunction TMainMenu.GetMenuSource(Item: TMenuItem): TJSHTMLElement;\r\nvar\r\n  I: Integer;\r\n  it: TMenuItem;\r\n  MenuClass: string;\r\n  ElListItem, ElLabel, ElCheckBox, ElSymbol: TJSHTMLElement;\r\n  id: Integer;\r\n  caption: string;\r\nbegin\r\n  Result := nil;\r\n\r\n  if Assigned(Item.Items) and (Item.Items.Count > 0) then\r\n  begin\r\n    Result := TJSHTMLElement(document.createElement('UL'));\r\n    if FMainMenu then\r\n    begin\r\n      FMainMenu := False;\r\n      if FIsPopupMenu then\r\n        MenuClass := 'popup-menu'\r\n      else\r\n        MenuClass := 'main-menu';\r\n    end\r\n    else\r\n      MenuClass := 'sub-menu';\r\n\r\n    FMenuIndex := FMenuIndex + 1;\r\n\r\n    Result.setAttribute('class', MenuClass);\r\n\r\n    for I := 0 to Item.Items.Count - 1 do\r\n    begin\r\n      it := TMenuItem(Item.Items[I]);\r\n\r\n      id := id + 1;\r\n\r\n      if it.Name = '' then\r\n      begin\r\n        caption := StringReplace(it.Caption, ' ', '', [rfReplaceAll]);\r\n        caption := MakeValidName(caption);\r\n        if caption = '' then\r\n          caption := 'MenuItem' + IntToStr(id);\r\n        it.Name := caption + IntToStr(id);\r\n      end;\r\n\r\n      if it.Visible then\r\n      begin\r\n        ElListItem := TJSHTMLElement(document.createElement('LI'));\r\n\r\n        if it.Caption <> '-' then\r\n        begin\r\n          ElLabel := TJSHTMLElement(document.createElement('LABEL'));\r\n          ElLabel.setAttribute('class', 'drop-label');\r\n          ElLabel.setAttribute('title', it.Hint);\r\n          if (it.ImageIndex >= 0) and (Appearance.ImageURLs.Count > it.ImageIndex) then\r\n            ElLabel.innerHTML := '<img class=\"icon\" src=\"' + Appearance.ImageURLs[it.ImageIndex] + '\">'\r\n        else\r\n          if it.Checked then\r\n          begin\r\n            if it.RadioItem then\r\n              ElLabel.innerHTML := '<span class=\"checked\">&#9679;</span>'\r\n            else\r\n              ElLabel.innerHTML := '<span class=\"checked\">&#10004;</span>';\r\n          end;\r\n          ElLabel.innerHTML := ElLabel.innerHTML + it.Caption;\r\n        end\r\n        else\r\n        begin\r\n          ElLabel := TJSHTMLElement(document.createElement('SPAN'));\r\n          ElLabel.setAttribute('class', 'menu-separator');\r\n          ElLabel.innerHTML := '';\r\n        end;\r\n\r\n        if Assigned(it.Items) and (it.Items.Count > 0) then\r\n        begin\r\n          ElSymbol := TJSHTMLElement(document.createElement('SPAN'));\r\n          ElSymbol.setAttribute('class', 'drop-icon');\r\n//          ElSymbol.innerHTML := '&gt;';\r\n//          ElSymbol.innerHTML := '&#9658;';\r\n//          ElSymbol.innerHTML := '&#9660;';\r\n          ElSymbol.innerHTML := Appearance.SubmenuIndicator;\r\n\r\n          ElLabel.setAttribute('for', 'sm' + IntToStr(FMenuIndex));\r\n          ElLabel.appendChild(ElSymbol);\r\n\r\n          ElCheckBox := TJSHTMLElement(document.createElement('INPUT'));\r\n          ElCheckBox.setAttribute('type', 'checkbox');\r\n          ElCheckBox.setAttribute('id', 'sm' + IntToStr(FMenuIndex));\r\n\r\n          ElListItem.appendChild(ElLabel);\r\n          ElListItem.appendChild(ElCheckBox);\r\n          ElListItem.appendChild(GetMenuSource(it));\r\n        end\r\n        else\r\n        begin\r\n          ElLabel.setAttribute('for', 'tm');\r\n          ElLabel.setAttribute('id', it.Name);\r\n          if it.Enabled then\r\n          begin\r\n            if (MenuClass = 'sub-menu') then\r\n            begin\r\n              //Hide the sub-menu onclick and then revert to the initial state to\r\n              //make it re-appear when hovering\r\n              if it.Enabled then\r\n                ElLabel.setAttribute('onMouseUp', GetID + 'MenuClick(this);');\r\n            end;\r\n            ElLabel.addEventListener('click', @HandleChange);\r\n          end\r\n          else\r\n            ElLabel.style.setProperty('color', 'gray');\r\n\r\n          ElListItem.appendChild(ElLabel);\r\n        end;\r\n\r\n        Result.appendChild(ElListItem);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TMainMenu.GetItemByName(AMenu: TMenuItem; Name: string): TMenuItem;\r\nvar\r\n  I: Integer;\r\n  it: TMenuItem;\r\nbegin\r\n  Result := nil;\r\n\r\n  if Assigned(AMenu.Items) then\r\n  begin\r\n    for I := 0 to AMenu.Items.Count - 1 do\r\n    begin\r\n      it := TMenuItem(AMenu.Items.Items[I]);\r\n\r\n      if it.Name = Name then\r\n      begin\r\n        Result := it;\r\n        if Assigned(it.OnClick) then\r\n          Result.OnClick := it.OnClick;\r\n        Exit;\r\n      end;\r\n\r\n      if not Assigned(Result) then\r\n        Result := GetItemByName(it, Name);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TMainMenu.HandleChange(Event: TJSEvent): Boolean;\r\nvar\r\n  h: TJSHTMLElement;\r\n  it: TMenuItem;\r\nbegin\r\n  Result := True;\r\n\r\n  if FIsPopupMenu then\r\n  begin\r\n    FShowPopup := False;\r\n    UpdateElement;\r\n  end;\r\n\r\n  h := TJSHTMLElement(Event.target);\r\n\r\n  // click on child element in menu item\r\n  if not h.hasAttribute('id') then\r\n    h := TJSHTMLElement(h.parentElement);\r\n\r\n  it := GetItemByName(Items, h.id);\r\n\r\n  if Assigned(it) then\r\n  begin\r\n    if it.AutoCheck then\r\n      it.Checked := not it.Checked;\r\n\r\n    if Assigned(OnChange) then\r\n      OnChange(Self, it, False);\r\n\r\n    it.Click;\r\n  end;\r\nend;\r\n\r\nfunction TMainMenu.CreateElement: TJSElement;\r\nvar\r\n  LLabel: TJSHTMLElement;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Result := document.createElement('DIV');\r\n    LLabel := TJSHTMLElement(document.createElement('DIV'));\r\n    LLabel.innerHTML := 'TWebMainMenu';\r\n    BorderStyle := bsSingle;\r\n    LLabel['align'] := 'center';\r\n    LLabel.style.setProperty('border','1px solid gray');\r\n    LLabel.style.setProperty('vertical-align','middle');\r\n    LLabel.style.setProperty('display','table-cell');\r\n    Result.appendChild(LLabel);\r\n  end\r\n  else\r\n  begin\r\n    Result := document.createElement('DIV');\r\n    if FIsPopupMenu then\r\n      Result.setAttribute('onMouseLeave', GetID + 'MenuOut(this);');\r\n  end;\r\nend;\r\n\r\nprocedure TMainMenu.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FAppearance := TMainMenuAppearance.Create(Self);\r\n  FContainer := nil;\r\n  FMainMenu := True;\r\n  FMenuIndex := 0;\r\n  FIsPopupMenu := False;\r\n  FShowPopup := False;\r\n\r\n  Top := 0;\r\n  Left := 0;\r\n  Width := 100;\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    ElementPosition := epRelative;\r\n    WidthPercent := 100;\r\n    WidthStyle := ssPercent;\r\n  end;\r\nend;\r\n\r\ndestructor TMainMenu.Destroy;\r\nbegin\r\n  FAppearance.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TMainMenu.Loaded;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n    UpdateElement;\r\nend;\r\n\r\nprocedure TMainMenu.UpdateElement;\r\nvar\r\n  MenuStyle, MenuColorStyle, MenuResponsiveStyle, MenuImageSize, ShowPopup: string;\r\n  ElHandle, ElLabel, ElSpan, ElIcon, ElCheckBox, ElStyle, ElScript, ElItems: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if not Assigned(ElementHandle) and not Assigned(Container) then\r\n    Exit;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    ElHandle := Container.ElementHandle;\r\n    Visible := False;\r\n  end\r\n  else\r\n  begin\r\n    ElHandle := ElementHandle;\r\n    ElHandle.style.setProperty('top', IntToStr(Top)+'px');\r\n    ElHandle.style.setProperty('left', IntToStr(Left)+'px');\r\n    if (csDesigning in ComponentState) and not Assigned(Container) then\r\n      TJSHTMLElement(ElementHandle).style.setProperty('background-color','silver');\r\n  end;\r\n\r\n  FMenu := TJSHTMLElement(ElHandle.firstChild);\r\n  if Assigned(FMenu) then\r\n    FMenu.parentElement.removeChild(FMenu);\r\n\r\n  if (csDestroying in ComponentState) then\r\n    Exit;\r\n\r\n  FMenu := TJSHTMLElement(document.createElement('NAV'));\r\n  FMenu.setAttribute('id', GetID + 'menu');\r\n  FMenu.innerHTML := '';\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    FMenu.style.setProperty('top', '0');\r\n    FMenu.style.setProperty('left', '0');\r\n    FMenu.style.setProperty('position', 'absolute');\r\n    FMenu.style.setProperty('width', '100%');\r\n    FMenu.style.setProperty('z-index', '999997');\r\n  end;\r\n\r\n  ElHandle.innerHTML := '';\r\n  ElHandle.style.setProperty('overflow', 'visible');\r\n\r\n  if Appearance.HamburgerMenu.Visible <> hmAlways then\r\n  begin\r\n    if FShowPopup then\r\n      ShowPopup := 'block'\r\n    else\r\n      ShowPopup := 'none';\r\n\r\n    MenuResponsiveStyle :=\r\n      '  #' + GetID + 'menu .main-menu {'#13\r\n      + '    display: block;'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu #toggle-menu {'#13\r\n      + '    display: none;'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu ul span.drop-label {'#13\r\n      + '    display: inline-block;'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu li {'#13\r\n      + '    float: left;'#13\r\n      + '    border-width: 0 1px 0 0;'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu .popup-menu li, '#13\r\n      + '  #' + GetID + 'menu .sub-menu li {'#13\r\n      + '    float: none;'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu .sub-menu {'#13\r\n      + '    top: 100%;'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu .popup-menu { '#13\r\n      + '    top: 0;'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu .popup-menu, '#13\r\n      + '  #' + GetID + 'menu .sub-menu {'#13\r\n      + '    border-width: 0;'#13\r\n      + '    margin: 0;'#13\r\n      + '    position: absolute;'#13\r\n      + '    left: 0;'#13\r\n      + '    min-width: 12em;'#13\r\n      + '    z-index: 9999999;'#13\r\n      + '\t   white-space: nowrap;'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu .sub-menu {'#13\r\n      + '    top: 100%;'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu .popup-menu { '#13\r\n      + '    display: ' + ShowPopup + ';'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu .sub-menu,'#13\r\n      + '  #' + GetID + 'menu input[type=\"checkbox\"]:checked + .popup-menu,'#13\r\n      + '  #' + GetID + 'menu input[type=\"checkbox\"]:checked + .sub-menu {'#13\r\n      + '    display: none;'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu .popup-menu li, '#13\r\n      + '  #' + GetID + 'menu .sub-menu li {'#13\r\n      + '    border-width: 1px;'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu .popup-menu .sub-menu, '#13\r\n      + '  #' + GetID + 'menu .sub-menu .sub-menu {'#13\r\n      + '    top: 0;'#13\r\n      + '    left: 100%;'#13\r\n      + '  }'#13\r\n\r\n      + '  #' + GetID + 'menu li:hover > input[type=\"checkbox\"] + .popup-menu, '#13\r\n      + '  #' + GetID + 'menu li:hover > input[type=\"checkbox\"] + .sub-menu {'#13\r\n      + '    display: block;'#13\r\n      + '  }'#13;\r\n\r\n    if Appearance.HamburgerMenu.Visible = hmResponsive then\r\n    begin\r\n      MenuResponsiveStyle :=\r\n        '@media only screen and (min-width: ' + IntToStr(Appearance.HamburgerMenu.ResponsiveMaxWidth) + 'px) {'#13\r\n        + MenuResponsiveStyle\r\n        + '}';\r\n    end;\r\n  end;\r\n\r\n  if Appearance.ImageSize > 0 then\r\n  begin\r\n    MenuImageSize := '  width: ' + IntToStr(Appearance.ImageSize) + 'px;'#13\r\n      + '  height: ' + IntToStr(Appearance.ImageSize) + 'px;'#13\r\n    ;\r\n  end;\r\n\r\n  MenuStyle :=\r\n    '#' + GetID + 'menu ul {'#13\r\n    + '  margin: 0;'#13\r\n    + '  padding: 0;'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu .main-menu {'#13\r\n    + '  display: none;'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu .popup-menu {'#13\r\n    + '  display: block;'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu label img.icon,' +\r\n    '#' + GetID + 'menu label span.checked {'#13\r\n    + MenuImageSize\r\n    + '  margin-right: 10px;'#13\r\n    + '  pointer-events: none;'#13\r\n//    + '  float: left;'#13\r\n    + '}'#13\r\n\r\n    + '#tm:checked + .main-menu {'#13\r\n    + '  display: block;'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu input[type=\"checkbox\"],'#13\r\n    + '#' + GetID + 'menu ul span.drop-label {'#13\r\n    + '  display: none;'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu li,'#13\r\n    + '#' + GetID + 'menu #toggle-menu,'#13\r\n    + '#' + GetID + 'menu .popup-menu,'#13\r\n    + '#' + GetID + 'menu .sub-menu {'#13\r\n    + '  border-width: 1px;'#13\r\n    + '  border-style: solid;'#13\r\n    + '  border-color: rgba(0, 0, 0, .05);'#13\r\n    + '  border-bottom: 0px;'#13\r\n    + '  border-top: 0px;'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu li,'#13\r\n    + '#' + GetID + 'menu #toggle-menu {'#13\r\n    + '  border-width: 0 0 3px;'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu .popup-menu,'#13\r\n    + '#' + GetID + 'menu .sub-menu {'#13\r\n    + '  border-width: 1px 1px 0;'#13\r\n    + '  margin: 0 1em;'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu .popup-menu li:first-child,'#13\r\n    + '#' + GetID + 'menu .sub-menu li:first-child {'#13\r\n    + '  border-top: 1px solid;'#13\r\n    + '  border-color: rgba(0, 0, 0, .05);'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu .popup-menu li:last-child,'#13\r\n    + '#' + GetID + 'menu .sub-menu li:last-child {'#13\r\n    + '  border-bottom: 1px solid;'#13\r\n    + '  border-color: rgba(0, 0, 0, .05);'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu li,'#13\r\n    + '#' + GetID + 'menu #toggle-menu,'#13\r\n    + '#' + GetID + 'menu li label {'#13\r\n    + '  position: relative;'#13\r\n    + '  display: block;'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu #toggle-menu,'#13\r\n    + '#' + GetID + 'menu li label { '#13\r\n    + '  padding: 0.75em 1.5em;'#13\r\n    + '  text-decoration: none;'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu li span.menu-separator { '#13\r\n    + '  display: block;'#13\r\n    + '  width: 100%;'#13\r\n    + '  height: 1px;'#13\r\n    + '  background-color: rgba(0, 0, 0, .05);'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu .popup-menu, '#13\r\n    + '#' + GetID + 'menu .sub-menu {'#13\r\n    + '  display: none;'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu input[type=\"checkbox\"]:checked + .popup-menu,'#13\r\n    + '#' + GetID + 'menu input[type=\"checkbox\"]:checked + .sub-menu {'#13\r\n    + '  display: block;'#13\r\n    + '  z-index: 3000;'#13\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu span.drop-icon {'#13\r\n//    + '  float: right;'#13\r\n    + '  margin-left: 10px;'\r\n    + '}'#13\r\n\r\n    + '#' + GetID + 'menu span.hamburger-icon {'#13\r\n    + '  float: right;'#13\r\n    + '  padding: 0;'#13\r\n    + '  margin: 0;'#13\r\n    + '  font-weight: 900;'#13\r\n    + '}'#13\r\n\r\n    + '@media only screen and (max-width: 64em) and (min-width: 52.01em) {'#13\r\n    + '  #' + GetID + 'menu li {'#13\r\n    + '    width: auto;'#13\r\n    + '  }'#13\r\n\r\n    + '  #' + GetID + 'menu .sub-menu li {'#13\r\n    + '    width: auto;'#13\r\n    + '  }'#13\r\n    + '}'#13;\r\n\r\n  if ElementClassName = '' then\r\n  begin\r\n    MenuColorStyle := ''\r\n\r\n      + '#' + GetID + 'menu .popup-menu, '#13\r\n      + '#' + GetID + 'menu .sub-menu {'#13\r\n      + '  background-color: ' + ColorToHtml(Appearance.BackgroundColor) + ';'#13\r\n      + '}'#13\r\n\r\n      + '@media only screen and (max-width: 64em) and (min-width: 52.01em) {'#13\r\n      +   '#' + GetID + 'menu .sub-menu {'#13\r\n      +   '  background-color: ' + ColorToHtml(Appearance.HamburgerMenu.BackgroundColor) + ';'#13\r\n      +   '}'#13\r\n      + '}'#13\r\n\r\n      + '#' + GetID + 'menu li,'#13\r\n      + '#' + GetID + 'menu #toggle-menu,'#13\r\n      + '#' + GetID + 'menu li label {'#13\r\n      + '}'#13\r\n\r\n      + '#' + GetID + 'menu #toggle-menu {'#13\r\n      + '  background-color: ' + ColorToHtml(Appearance.HamburgerMenu.BackgroundColor) + ';'#13\r\n      + '  color: ' + ColorToHtml(Appearance.HamburgerMenu.CaptionColor) + ';'#13\r\n      + '}'#13\r\n\r\n      + '#' + GetID + 'menu .main-menu li label {'#13\r\n      + '  background-color: ' + ColorToHtml(Appearance.BackgroundColor) + ';'#13\r\n      + '}'#13\r\n\r\n      + '#' + GetID + 'menu li label:hover {'#13\r\n      + '  background-color: ' + ColorToHtml(Appearance.HoverColor) + ';'#13\r\n      + '  color: ' + ColorToHtml(Appearance.HoverFontColor) + ';'#13\r\n      + '}'#13\r\n\r\n      + '#' + GetID + 'menu .popup-menu label:hover, '#13\r\n      + '#' + GetID + 'menu .sub-menu label:hover {'#13\r\n      + '  background-color: ' + ColorToHtml(Appearance.HoverColor) + ';'#13\r\n      + '  color: ' + ColorToHtml(Appearance.HoverFontColor) + ';'#13\r\n      + '}'#13;\r\n  end;\r\n\r\n  MenuStyle := MenuStyle\r\n    + MenuColorStyle\r\n    + MenuResponsiveStyle\r\n    ;\r\n\r\n  FMainMenu := True;\r\n  FMenuIndex := 0;\r\n\r\n  ElStyle := TJSHTMLElement(document.createElement('STYLE'));\r\n  ElStyle.innerHTML := MenuStyle;\r\n\r\n  ElScript := TJSHTMLElement(document.createElement('SCRIPT'));\r\n  ElScript.innerHTML := 'function ' + GetID + 'MenuClick(ctrl){'\r\n    + '  el = ctrl.parentElement.parentElement;'\r\n    + '  el.style.display = \"none\";'\r\n    + '  setTimeout(function(){el.style.removeProperty(\"display\")}, 25);'\r\n    + '}'\r\n    + 'function ' + GetID + 'MenuOut(ctrl){'\r\n    + '  menuel = document.getElementById(\"' + GetID + '\");'\r\n    + '  if(menuel) { '\r\n    + '    popupel = menuel.getElementsByClassName(\"popup-menu\");'\r\n    + '    if(popupel) '\r\n    + '      setTimeout(function(){popupel[0].style.display = \"none\"}, 25);'\r\n    + '  }'\r\n    + '}';\r\n\r\n  ElLabel := TJSHTMLElement(document.createElement('LABEL'));\r\n  ElLabel.setAttribute('for', 'tm');\r\n  ElLabel.setAttribute('id', 'toggle-menu');\r\n  ElLabel.innerHTML := Appearance.HamburgerMenu.Caption;\r\n\r\n  ElSpan := TJSHTMLElement(document.createElement('SPAN'));\r\n  ElSpan.setAttribute('class', 'drop-label');\r\n  ElLabel.appendChild(ElSpan);\r\n\r\n  ElIcon := TJSHTMLElement(document.createElement('SPAN'));\r\n  ElIcon.setAttribute('class', 'hamburger-icon');\r\n//  ElIcon.innerHTML := '&gt;';\r\n  ElIcon.innerHTML := '&#9776;';\r\n//  ElIcon.innerHTML := '<svg height=\"32px\" id=\"Layer_1\" style=\"enable-background:new 0 0 32 32;\" version=\"1.1\" viewBox=\"0 0 32 32\" width=\"32px\" xml:space=\"preserve\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><path d=\"M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z\"/></svg>';\r\n  ElSpan.appendChild(ElIcon);\r\n\r\n  ElCheckBox := TJSHTMLElement(document.createElement('INPUT'));\r\n  ElCheckBox.setAttribute('type', 'checkbox');\r\n  ElCheckBox.setAttribute('id', 'tm');\r\n\r\n  FMenu.appendChild(ElStyle);\r\n  FMenu.appendChild(ElScript);\r\n  FMenu.appendChild(ElLabel);\r\n  FMenu.appendChild(ElCheckBox);\r\n\r\n  ElItems := GetMenuSource(Items);\r\n  if ElItems <> nil then\r\n    FMenu.appendChild(ElItems);\r\n  ElHandle.appendChild(FMenu);\r\nend;\r\n\r\n{ TMenuItem }\r\n\r\nprocedure TMenuItem.Assign(Source: TPersistent);\r\nvar\r\n  i: integer;\r\n  srcmenu,mnu: TMenuItem;\r\n  pm: TCustomMainMenu;\r\n\r\nbegin\r\n  if (Source is TMenuItem) then\r\n  begin\r\n    srcmenu := (Source as TMenuItem);\r\n\r\n    FAutoCheck := srcmenu.AutoCheck;\r\n    FAutoHotkeys := srcmenu.AutoHotkeys;\r\n    FAutoLineReduction:= srcmenu.AutoLineReduction;\r\n    FBreak := srcmenu.Break;\r\n    FCaption := srcmenu.Caption;\r\n    FChecked := srcmenu.Checked;\r\n    FDefault := srcmenu.Default;\r\n    FEnabled := srcmenu.Enabled;\r\n    FGroupIndex := srcmenu.GroupIndex;\r\n    FHelpContext := srcmenu.HelpContext;\r\n    FHint := srcmenu.Hint;\r\n    FImageIndex := srcmenu.ImageIndex;\r\n    FRadioItem := srcmenu.RadioItem;\r\n    FShortCut := srcmenu.ShortCut;\r\n    FVisible := srcmenu.Visible;\r\n    FElementClassName := srcmenu.ElementClassName;\r\n\r\n    pm := GetParentMenu;\r\n\r\n    if Assigned(Parent) then\r\n      Name := pm.GetUniqueName(srcmenu.Caption);\r\n\r\n    if Assigned(srcmenu.Items) then\r\n    begin\r\n      if Assigned(FItems) then\r\n      begin\r\n        for I := FItems.Count - 1 downto 0 do\r\n        begin\r\n          RemoveItem(GetParentMenu.Parent, TComponent(FItems[I]));\r\n        end;\r\n        FItems.Clear;\r\n      end\r\n      else\r\n        FItems := TMenuItemList.Create;\r\n\r\n      for i := 0 to srcmenu.Items.Count - 1 do\r\n      begin\r\n        // create with form owner\r\n        mnu := TMenuItem.Create(pm.Owner);\r\n        mnu.FParentMenu := pm;\r\n        mnu.FParentItem := Self;\r\n        mnu.Assign(TMenuItem(srcmenu.Items[i]));\r\n        FItems.Add(mnu);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TMenuItem.BeginUpdate;\r\nbegin\r\n  inc(FUpdateCount);\r\nend;\r\n\r\nprocedure TMenuItem.Clear;\r\nvar\r\n  i: integer;\r\n  mnu: TMenuItem;\r\nbegin\r\n  for i := Count - 1 downto 0 do\r\n  begin\r\n    mnu := TMenuItem(FItems[i]);\r\n    if Assigned(mnu.Items) then\r\n      mnu.Items.Clear;\r\n    mnu.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TMenuItem.Click;\r\nbegin\r\n  if Assigned(OnClick) then\r\n    OnClick(Self);\r\nend;\r\n\r\nconstructor TMenuItem.Create(AOwner: TComponent);\r\nbegin\r\n  FParentMenu := nil;\r\n\r\n  if AOwner is TMainMenu then\r\n    FParentMenu := AOwner;\r\n\r\n  inherited Create(AOwner);\r\n\r\n  FAutoHotkeys := maParent;\r\n  FAutoLineReduction := maParent;\r\n  FImageIndex := -1;\r\n  FHint := '';\r\n  FCaption := 'MenuItem';\r\n  FChecked := False;\r\n  FEnabled := True;\r\n  FDefault := False;\r\n  FRadioItem := False;\r\n  FVisible := True;\r\n  FOwner := TMenuItem(AOwner);\r\nend;\r\n\r\ndestructor TMenuItem.Destroy;\r\nvar\r\n  i: integer;\r\n  pm: TCustomMainMenu;\r\n  mnu: TMenuItem;\r\nbegin\r\n  pm := GetParentMenu;\r\n\r\n  // delete item from the parent item list\r\n  if Assigned(Parent) and Assigned(pm) then\r\n  begin\r\n    pm.BeginUpdate;\r\n\r\n    for i := TMenuItem(Parent).Items.Count - 1 downto 0 do\r\n    begin\r\n      if (TMenuItem(Parent).Items[i] = Self) then\r\n      begin\r\n        TMenuItem(Parent).Items.Delete(i);\r\n      end;\r\n    end;\r\n\r\n    pm.EndUpdate;\r\n  end;\r\n\r\n  // delete its childs\r\n  if Assigned(Items) then\r\n  begin\r\n    for i := Items.Count - 1 downto 0 do\r\n    begin\r\n      mnu := TMenuItem(Items[i]);\r\n      mnu.FParentItem := nil;\r\n      mnu.Free;\r\n      Items.Delete(i);\r\n    end;\r\n  end;\r\n\r\n  inherited;\r\nend;\r\n\r\nprocedure TMenuItem.EndUpdate;\r\nbegin\r\n  if (FUpdateCount > 0) then\r\n  begin\r\n    dec(FUpdateCount);\r\n\r\n    if FUpdateCount = 0 then\r\n      GetParentMenu.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMenuItem.GetChildren(Proc: TGetChildProc; Root: TComponent);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if Assigned(Items) then\r\n    for I := 0 to Items.Count - 1 do Proc(TMenuItem(Items[I]));\r\nend;\r\n\r\nfunction TMenuItem.GetCount: integer;\r\nbegin\r\n  if FItems = nil then\r\n    Result := 0\r\n  else\r\n    Result := FItems.Count;\r\nend;\r\n\r\nfunction TMenuItem.GetOwner: TPersistent;\r\nbegin\r\n  Result := FOwner;\r\nend;\r\n\r\nfunction TMenuItem.GetParentMenu: TCustomMainMenu;\r\nvar\r\n  AOwner: TComponent;\r\nbegin\r\n  Result := nil;\r\n\r\n  AOwner := FParentMenu;\r\n\r\n  while Assigned(AOwner) and (AOwner is TMenuItem) do\r\n  begin\r\n    AOwner := TMenuItem(AOwner).FParentMenu;\r\n  end;\r\n\r\n  if Assigned(AOwner) then\r\n    Result := TCustomMainMenu(AOwner);\r\nend;\r\n\r\nprocedure TMenuItem.Insert(Index: Integer; Item: TMenuItem);\r\nbegin\r\n  if FItems = nil then\r\n    FItems := TMenuItemList.Create;\r\n  FItems.Insert(Index, Item);\r\n  Item.FParentItem := Self;\r\n\r\n  if Assigned(Item.GetParentMenu) then\r\n    Item.GetParentMenu.UpdateElement;\r\nend;\r\n\r\nfunction TMenuItem.IsChild(Item: TMenuItem): boolean;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := false;\r\n  if not Assigned(Items) then\r\n    Exit;\r\n\r\n  for i := 0 to Items.Count - 1 do\r\n  begin\r\n    if (Items[i] = Item) then\r\n    begin\r\n      Result := true;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TMenuItem.RemoveItem(AOwner, AItem: TComponent);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if Assigned(TMenuItem(AItem).Items) then\r\n  begin\r\n    for I := TMenuItem(AItem).Items.Count - 1 downto 0 do\r\n      RemoveItem(AOwner, TComponent(TMenuItem(AItem).Items[I]));\r\n  end;\r\n  AOwner.RemoveComponent(AItem);\r\nend;\r\n\r\nprocedure TMenuItem.Add(Item: TMenuItem);\r\nbegin\r\n  Insert(GetCount, Item);\r\nend;\r\n\r\nprocedure TMenuItem.SetCaption(const Value: string);\r\nvar\r\n  pm: TCustomMainMenu;\r\nbegin\r\n  FCaption := Value;\r\n  pm := GetParentMenu;\r\n  if Assigned(pm) then\r\n    pm.UpdateElement;\r\nend;\r\n\r\nprocedure TMenuItem.SetChecked(const Value: Boolean);\r\nvar\r\n  pm: TCustomMainMenu;\r\n  Item, OtherItem: TMenuItem;\r\n  MenuOwner: TComponent;\r\n  I: Integer;\r\nbegin\r\n  if FChecked <> Value then\r\n  begin\r\n    FChecked := Value;\r\n    MenuOwner := FParentMenu;\r\n    if Assigned(MenuOwner) then\r\n    begin\r\n      if (MenuOwner is TMenuItem) and Value then\r\n      begin\r\n        Item := TMenuItem(MenuOwner);\r\n        for I := 0 to Item.Items.Count - 1 do\r\n        begin\r\n          OtherItem := TMenuItem(Item.Items[I]);\r\n          if (OtherItem.RadioItem) and (OtherItem <> Self) then\r\n            OtherItem.Checked := False;\r\n        end;\r\n      end;\r\n\r\n      while not (MenuOwner is TCustomMainMenu) and Assigned(MenuOwner) do\r\n      begin\r\n        MenuOwner := MenuOwner.Owner;\r\n      end;\r\n    end;\r\n\r\n    pm := GetParentMenu;\r\n    if Assigned(pm) then\r\n      pm.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMenuItem.SetChildOrder(Child: TComponent; Order: Integer);\r\nvar\r\n  idx: integer;\r\nbegin\r\n  idx := FItems.IndexOf(Child);\r\n  if (idx >= 0) and (Order < FItems.Count) then\r\n  begin\r\n    FItems.Move(idx, Order);\r\n  end;\r\nend;\r\n\r\nprocedure TMenuItem.SetEnabled(const Value: Boolean);\r\nbegin\r\n  if FEnabled <> Value then\r\n  begin\r\n    FEnabled := Value;\r\n    GetParentMenu.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMenuItem.SetImageIndex(const Value: Integer);\r\nvar\r\n  pm: TCustomMainMenu;\r\nbegin\r\n  FImageIndex := Value;\r\n  pm := GetParentMenu;\r\n  if Assigned(pm) then\r\n    pm.UpdateElement;\r\nend;\r\n\r\nprocedure TMenuItem.SetParentComponent(Value: TComponent);\r\nbegin\r\n  inherited;\r\n\r\n  FParentMenu := Value;\r\n\r\n  if (Value <> nil) then\r\n  begin\r\n    if Value is TCustomMainMenu then\r\n    begin\r\n      if not TCustomMainMenu(Value).Items.IsChild(Self) then\r\n        TCustomMainMenu(Value).Items.Add(Self)\r\n    end\r\n    else if Value is TMenuItem then\r\n    begin\r\n      if not TMenuItem(Value).IsChild(Self) then\r\n        TMenuItem(Value).Add(Self);\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TMainMenuAppearance }\r\n\r\nprocedure TMainMenuAppearance.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  if (Source is TMainMenu) then\r\n  begin\r\n    FBackgroundColor := (Source as TMainMenuAppearance).BackgroundColor;\r\n    FHoverColor := (Source as TMainMenuAppearance).HoverColor;\r\n    FHoverFontColor := (Source as TMainMenuAppearance).HoverFontColor;\r\n    FHamburgerMenu.Assign((Source as TMainMenuAppearance).HamburgerMenu);\r\n    FImageURLs.Assign((Source as TMainMenuAppearance).ImageURLs);\r\n    FImageSize := (Source as TMainMenuAppearance).ImageSize;\r\n    FSubmenuIndicator := (Source as TMainMenuAppearance).SubmenuIndicator;\r\n  end;\r\nend;\r\n\r\nconstructor TMainMenuAppearance.Create(AOwner: TMainMenu);\r\nbegin\r\n  FBackgroundColor := $F0F0F0;\r\n  FHoverColor := clHighlight;\r\n  FHoverFontColor := clHighlightText;\r\n  FHamburgerMenu := THamburgerMenu.Create(Self);\r\n  FImageURLs := TStringList.Create;\r\n  FImageURLs.SkipLastLinebreak := true;\r\n  FImageURLs.OnChange := HandleImageURLsChanged;\r\n  FImageSize := 16;\r\n  FSubmenuIndicator := '&#9658;';\r\n  FOwner := AOwner;\r\nend;\r\n\r\ndestructor TMainMenuAppearance.Destroy;\r\nbegin\r\n  FHamburgerMenu.Free;\r\n  FImageURLs.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TMainMenuAppearance.GetOwner: TPersistent;\r\nbegin\r\n  Result := FOwner;\r\nend;\r\n\r\nprocedure TMainMenuAppearance.HandleImageURLsChanged(Sender: TObject);\r\nbegin\r\n  FOwner.UpdateElement;\r\nend;\r\n\r\nprocedure TMainMenuAppearance.SetBackgroundColor(const Value: TColor);\r\nbegin\r\n  if FBackgroundColor <> Value then\r\n  begin\r\n    FBackgroundColor := Value;\r\n    FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMainMenuAppearance.SetHoverColor(const Value: TColor);\r\nbegin\r\n  if FHoverColor <> Value then\r\n  begin\r\n    FHoverColor := Value;\r\n    FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMainMenuAppearance.SetHoverFontColor(const Value: TColor);\r\nbegin\r\n  if FHoverFontColor <> Value then\r\n  begin\r\n    FHoverFontColor := Value;\r\n    FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMainMenuAppearance.SetImageSize(const Value: Integer);\r\nbegin\r\n  if FImageSize <> Value then\r\n  begin\r\n    FImageSize := Value;\r\n    FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMainMenuAppearance.SetImageURLs(const Value: TStringList);\r\nbegin\r\n  FImageURLs.Assign(Value);\r\nend;\r\n\r\nprocedure TMainMenuAppearance.SetSubmenuIndicator(const Value: string);\r\nbegin\r\n  if FSubmenuIndicator <> Value then\r\n  begin\r\n    FSubmenuIndicator := Value;\r\n    FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\n{ THamburgerMenu }\r\n\r\nprocedure THamburgerMenu.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  if (Source is THamburgerMenu) then\r\n  begin\r\n    FBackgroundColor := (Source as THamburgerMenu).BackgroundColor;\r\n    FCaption := (Source as THamburgerMenu).Caption;\r\n    FCaptionColor := (Source as THamburgerMenu).CaptionColor;\r\n    FVisible := (Source as THamburgerMenu).Visible;\r\n    FResponsiveMaxWidth := (Source as THamburgerMenu).ResponsiveMaxWidth;\r\n  end;\r\nend;\r\n\r\nconstructor THamburgerMenu.Create(AOwner: TMainMenuAppearance);\r\nbegin\r\n  FBackgroundColor := clSilver;\r\n  FCaption := 'Menu';\r\n  FCaptionColor := clWhite;\r\n  FVisible := hmResponsive;\r\n  FResponsiveMaxWidth := 768;\r\n  FOwner := AOwner;\r\nend;\r\n\r\ndestructor THamburgerMenu.Destroy;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nfunction THamburgerMenu.GetOwner: TPersistent;\r\nbegin\r\n  Result := FOwner;\r\nend;\r\n\r\nprocedure THamburgerMenu.SetBackgroundColor(const Value: TColor);\r\nbegin\r\n  if FBackgroundColor <> Value then\r\n  begin\r\n    FBackgroundColor := Value;\r\n    FOwner.FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure THamburgerMenu.SetCaption(const Value: string);\r\nbegin\r\n  if FCaption <> Value then\r\n  begin\r\n    FCaption := Value;\r\n    FOwner.FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure THamburgerMenu.SetCaptionColor(const Value: TColor);\r\nbegin\r\n  if FCaptionColor <> Value then\r\n  begin\r\n    FCaptionColor := Value;\r\n    FOwner.FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure THamburgerMenu.SetResponsiveMaxWidth(const Value: Integer);\r\nbegin\r\n  if FResponsiveMaxWidth <> Value then\r\n  begin\r\n    FResponsiveMaxWidth := Value;\r\n    FOwner.FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure THamburgerMenu.SetVisible(const Value: TMainMenuHamburgerMenuVisible);\r\nbegin\r\n  if FVisible <> Value then\r\n  begin\r\n    FVisible := Value;\r\n    FOwner.FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\n{ TMenuItemList }\r\n\r\nfunction TMenuItemList.GetItem(Index: Integer): TMenuItem;\r\nbegin\r\n  Result := TMenuItem(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TMenuItemList.PutItem(Index: Integer; const Value: TMenuItem);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TPopupMenu }\r\n\r\nprocedure TPopupMenu.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Appearance.HamburgerMenu.Visible := hmNever;\r\n  FIsPopupMenu := True;\r\nend;\r\n\r\nprocedure TPopupMenu.Popup(X, Y: Integer);\r\nbegin\r\n  Top := Y;\r\n  Left := X;\r\n  FShowPopup := True;\r\n  UpdateElement;\r\n  FShowPopup := False;\r\nend;\r\n\r\n{ TWebCustomControl }\r\n\r\nfunction TWebCustomControl.HandleDoContextMenu(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  pt: TPoint;\r\n  frm: TCustomForm;\r\n  r: TJSDOMRect;\r\nbegin\r\n  inherited;\r\n  if  Assigned(FPopupMenu) then\r\n  begin\r\n    Event.stopPropagation;\r\n    Event.preventDefault;\r\n    pt := Point(Round(Event.clientX), Round(Event.clientY));\r\n\r\n    frm := GetParentForm(Self);\r\n\r\n    if Assigned(frm) {and frm.Popup} and Assigned(frm.Container) then\r\n    begin\r\n      r := frm.Container.getBoundingClientRect;\r\n      pt.X := pt.X - Round(r.Left);\r\n      pt.Y := pt.Y - Round(r.Top);\r\n    end;\r\n\r\n    FPopupMenu.Popup(pt.X,pt.Y);\r\n    Result := true;\r\n  end;\r\nend;\r\n\r\nprocedure TWebCustomControl.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nbegin\r\n  inherited;\r\n  if (Operation = opRemove) and (AComponent = FPopupMenu) then\r\n    FPopupMenu := nil;\r\nend;\r\n\r\n{ TWebGraphicControl }\r\n\r\nfunction TWebGraphicControl.HandleDoContextMenu(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  pt: TPoint;\r\n  frm: TCustomForm;\r\n  r: TJSDOMRect;\r\nbegin\r\n  inherited;\r\n  if  Assigned(FPopupMenu) then\r\n  begin\r\n    Event.stopPropagation;\r\n    Event.preventDefault;\r\n    pt := Point(Round(Event.clientX), Round(Event.clientY));\r\n\r\n    frm := GetParentForm(Self);\r\n\r\n    if Assigned(frm) and (frm.Popup) and Assigned(frm.Container) then\r\n    begin\r\n      r := frm.Container.getBoundingClientRect;\r\n      pt.X := pt.X - Round(r.Left);\r\n      pt.Y := pt.Y - Round(r.Top);\r\n    end;\r\n\r\n    FPopupMenu.Popup(pt.X,pt.Y);\r\n    Result := true;\r\n  end;\r\nend;\r\n\r\nprocedure TWebGraphicControl.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nbegin\r\n  inherited;\r\n  if (Operation = opRemove) and (AComponent = FPopupMenu) then\r\n    FPopupMenu := nil;\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2022                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Controls;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Graphics, Types, SysUtils, Web, JS;\r\n\r\nconst\r\n  VK_CANCEL = 3;\r\n  VK_BACK = 8;\r\n  VK_TAB = 9;\r\n  VK_RETURN = 13;\r\n  VK_SHIFT = 16;\r\n  VK_CONTROL = 17;\r\n  VK_MENU = 18;\r\n  VK_PAUSE = 19;\r\n  VK_CAPITAL = 20;\r\n  VK_ESCAPE = 27;\r\n  VK_SPACE = 32;\r\n  VK_PRIOR = 33;\r\n  VK_NEXT = 34;\r\n  VK_END = 35;\r\n  VK_HOME = 36;\r\n  VK_LEFT = 37;\r\n  VK_UP = 38;\r\n  VK_RIGHT = 39;\r\n  VK_DOWN = 40;\r\n  VK_PRINT = 42;\r\n  VK_SNAPSHOT = 44;\r\n  VK_INSERT = 45;\r\n  VK_DELETE = 46;\r\n  VK_HELP = 47;\r\n  VK_LWIN = 91;\r\n  VK_RWIN = 92;\r\n  VK_NUMPAD0 = 96;\r\n  VK_NUMPAD1 = 97;\r\n  VK_NUMPAD2 = 98;\r\n  VK_NUMPAD3 = 99;\r\n  VK_NUMPAD4 = 100;\r\n  VK_NUMPAD5 = 101;\r\n  VK_NUMPAD6 = 102;\r\n  VK_NUMPAD7 = 103;\r\n  VK_NUMPAD8 = 104;\r\n  VK_NUMPAD9 = 105;\r\n  VK_MULTIPLY = 106;\r\n  VK_ADD = 107;\r\n  VK_SEPARATOR = 108;\r\n  VK_SUBTRACT = 109;\r\n  VK_DECIMAL = 110;\r\n  VK_DIVIDE = 111;\r\n  VK_F1 = 112;\r\n  VK_F2 = 113;\r\n  VK_F3 = 114;\r\n  VK_F4 = 115;\r\n  VK_F5 = 116;\r\n  VK_F6 = 117;\r\n  VK_F7 = 118;\r\n  VK_F8 = 119;\r\n  VK_F9 = 120;\r\n  VK_F10 = 121;\r\n  VK_F11 = 122;\r\n  VK_F12 = 123;\r\n  VK_F13 = 124;\r\n  VK_F14 = 125;\r\n  VK_F15 = 126;\r\n  VK_F16 = 127;\r\n  VK_F17 = 128;\r\n  VK_F18 = 129;\r\n  VK_F19 = 130;\r\n  VK_F20 = 131;\r\n  VK_F21 = 132;\r\n  VK_F22 = 133;\r\n  VK_F23 = 134;\r\n  VK_F24 = 135;\r\n  VK_NUMLOCK = 144;\r\n\r\n  WHEEL_DELTA = 120;\r\n\r\ntype\r\n  TCursor = type Integer;\r\n\r\nconst\r\n  crDefault     = 0;\r\n  crNone        = 1;\r\n  crArrow       = 2;\r\n  crCross       = 3;\r\n  crIBeam       = 4;\r\n  crSize        = 5;\r\n  crSizeNESW    = 6;\r\n  crSizeNS      = 7;\r\n  crSizeNWSE    = 8;\r\n  crSizeWE      = 9;\r\n  crUpArrow     = 10;\r\n  crHourGlass   = 11;\r\n  crDrag        = 12;\r\n  crNoDrop      = 13;\r\n  crHSplit      = 14;\r\n  crVSplit      = 15;\r\n  crMultIDrag   = 16;\r\n  crSQLWait     = 17;\r\n  crNo          = 18;\r\n  crAppStart    = 19;\r\n  crHelp        = 20;\r\n  crHandPoint   = 21;\r\n  crSizeAll     = 22;\r\n\r\n  CSSBackground = 'background-color';\r\n  CSSZIndex = 'z-index';\r\n\r\ntype\r\n  TCSSCodeManager = class;\r\n  Single = Double;\r\n  TDragState = (dsDragEnter, dsDragLeave, dsDragMove);\r\n  TDragMode = (dmManual, dmAutomatic);\r\n  TDragKind = (dkDrag, dkDock);\r\n  TDragObject = class(TObject);\r\n\r\n  TAlign = (alNone, alTop, alBottom, alLeft, alRight, alClient, alCustom);\r\n  TMouseButton = (mbLeft, mbRight, mbMiddle);\r\n  TBorderStyle = (bsNone, bsSingle);\r\n  TSizeStyle = (ssPercent, ssAbsolute, ssAuto);\r\n  TScrollStyle = (ssNone, ssHorizontal, ssVertical, ssBoth);\r\n  TStyleElements = set of (seFont, seClient, seBorder);\r\n\r\n  TAnchorKind = (akLeft, akTop, akRight, akBottom);\r\n  TAnchors = set of TAnchorKind;\r\n\r\n  TMaterialGlyph = string;\r\n\r\n  TElementClassName = type string;\r\n  TElementID = type string;\r\n  TElementFont = (efProperty, efCSS);\r\n  TElementPosition = (epAbsolute, epRelative, epIgnore);\r\n\r\n  TElementEvent = (eeClick, eeMouseDown, eeMouseUp, eeMouseMove, eeDblClick, eeKeyPress, eeKeyDown, eeKeyUp);\r\n  TEventPropagation = set of TElementEvent;\r\n\r\n  TTextDirection = (tdDefault, tdLeftToRight, tdRightToLeft, tdInherit);\r\n\r\n  TBevelCut = (bvNone, bvLowered, bvRaised, bvSpace);\r\n  TBevelEdge = (beLeft, beTop, beRight, beBottom);\r\n  TBevelEdges = set of TBevelEdge;\r\n  TBevelKind = (bkNone, bkTile, bkSoft, bkFlat);\r\n\r\n  TMaterialGlyphType = (mgNormal, mgOutlined, mgTwoTone, mgRound, mgSharp);\r\n\r\n  TJSXMLHttpRequestRecord = record\r\n    req: TJSXMLHttpRequest;\r\n  end;\r\n  TJSEventRecord = record\r\n    event: TEventListenerEvent;\r\n  end;\r\n\r\n  THTTPResponseEvent = procedure(Sender: TObject; AResponse: string) of object;\r\n  THTTPRequestResponseEvent = procedure(Sender: TObject; ARequest: TJSXMLHttpRequestRecord; AResponse: string) of object;\r\n  THTTPAbortEvent = procedure(Sender: TObject) of object;\r\n  THTTPErrorEvent = procedure(Sender: TObject; ARequest: TJSXMLHttpRequestRecord; Event: TJSEventRecord; var Handled: boolean) of object;\r\n\r\n  TJSHTMLElementRecord = record\r\n    element: TJSHTMLElement;\r\n  end;\r\n\r\n  TJSObjectRecord = record\r\n    jsobject: TJSObject;\r\n  end;\r\n\r\n  TJSArrayRecord = record\r\n    jsarray: TJSArray;\r\n  end;\r\n\r\n  TJSArrayBufferRecord = record\r\n    jsarraybuffer: TJSArrayBuffer;\r\n  end;\r\n\r\n  TDragSourceObject = class(TObject)\r\n  private\r\n    FJSEvent: TJSEvent;\r\n    FObject: TObject;\r\n  public\r\n    property Event: TJSEvent read FJSEvent write FJSEvent;\r\n    property &Object: TObject read FObject write FObject;\r\n  end;\r\n\r\n  TNotifyEvent = procedure(Sender: TObject) of object;\r\n  TMouseEvent = procedure(Sender: TObject; Button: TMouseButton; Shift: TShiftState; X,Y: Integer) of object;\r\n  TMouseWheelEvent = procedure(Sender: TObject; Shift: TShiftState; WheelDelta: Integer; MousePos: TPoint; var Handled: Boolean) of object;\r\n  TMouseWheelUpDownEvent = procedure(Sender: TObject; Shift: TShiftState;\r\n    MousePos: TPoint; var Handled: Boolean) of object;\r\n  TMouseMoveEvent = procedure(Sender: TObject; Shift: TShiftState; X,Y: Integer) of object;\r\n  TKeyEvent = procedure(Sender: TObject; var AKey: Word; Shift: TShiftState) of object;\r\n  TKeyPressEvent = procedure(Sender: TObject; var AChar: Char) of object;\r\n  TTouchEvent = procedure(Sender: TObject; X,Y: integer) of object;\r\n  TBiDiMode = (bdLeftToRight, bdRightToLeft, bdRightToLeftNoAlign, bdRightToLeftReadingOnly);\r\n\r\n  TDragOverEvent = procedure(Sender, Source: TObject; X, Y: Integer; State: TDragState; var Accept: Boolean) of object;\r\n  TDragDropEvent = procedure(Sender, Source: TObject; X, Y: Integer) of object;\r\n  TStartDragEvent = procedure(Sender: TObject; var DragObject: TDragObject) of object;\r\n  TEndDragEvent = procedure(Sender, Target: TObject; X, Y: Integer) of object;\r\n  TScreenshotEvent = procedure(Sender: TObject; ABitmap: TBitmap) of object;\r\n\r\n  TControlStyleValue = (csAcceptsControls, csSetCaption);\r\n  TControlStyle = set of TControlStyleValue;\r\n\r\n  TMargins = class(TPersistent)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    FLeft, FTop, FRight, FBottom: Integer;\r\n  protected\r\n    procedure SetLeft(const Value: integer);\r\n    procedure SetTop(const Value: integer);\r\n    procedure SetRight(const Value: integer);\r\n    procedure SetBottom(const Value: integer);\r\n    procedure DoChange; virtual;\r\n  public\r\n    constructor Create; reintroduce;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Left: Integer read FLeft write SetLeft default 3;\r\n    property Top: Integer read FTop write SetTop default 3;\r\n    property Right: Integer read FRight write SetRight default 3;\r\n    property Bottom: Integer read FBottom write SetBottom default 3;\r\n  end;\r\n\r\n  TPadding = class(TPersistent)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    FLeft, FTop, FRight, FBottom: Integer;\r\n  protected\r\n    procedure SetLeft(const Value: integer);\r\n    procedure SetTop(const Value: integer);\r\n    procedure SetRight(const Value: integer);\r\n    procedure SetBottom(const Value: integer);\r\n    procedure DoChange; virtual;\r\n  public\r\n    constructor Create; reintroduce;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Left: Integer read FLeft write SetLeft default 0;\r\n    property Top: Integer read FTop write SetTop default 0;\r\n    property Right: Integer read FRight write SetRight default 0;\r\n    property Bottom: Integer read FBottom write SetBottom default 0;\r\n  end;\r\n\r\n\r\n  TPercentSize = single;\r\n\r\n  TControl = class(TComponent)\r\n  private\r\n    FGotFocus: Boolean;\r\n    FAcceptDrag: Boolean;\r\n    FCaptureDown: Boolean;\r\n    FMouseInsideLayer: Boolean;\r\n    FLayer: TJSElement;\r\n    FCaptured: Boolean;\r\n    FControlCreated: Boolean;\r\n    FUpdateCount: integer;\r\n    FBlockUpdateElement: Boolean;\r\n    FElement: TJSElement;\r\n    FID: string;\r\n    FNew: Boolean;\r\n    FContainer: TJSElement;\r\n    FElementEvent, FLastElementEvent: TJSEvent;\r\n    FElementClassName: string;\r\n    FColor: TColor;\r\n    FFont: TFont;\r\n    FParent, FPrevParent: TControl;\r\n    FControls: array of TControl;\r\n    FOnDragOver: TDragOverEvent;\r\n    FOnDragDrop: TDragDropEvent;\r\n    FOnStartDrag: TStartDragEvent;\r\n    FonEndDrag: TEndDragEvent;\r\n    FOnClick: TNotifyEvent;\r\n    FOnDblClick: TNotifyEvent;\r\n    FOnMouseDown: TMouseEvent;\r\n    FOnMouseUp: TMouseEvent;\r\n    FOnMouseMove: TMouseMoveEvent;\r\n    FOnKeyDown: TKeyEvent;\r\n    FOnKeyUp: TKeyEvent;\r\n    FOnKeyPress: TKeyPressEvent;\r\n    FOnEnter: TNotifyEvent;\r\n    FOnExit: TNotifyEvent;\r\n    FEnabled: Boolean;\r\n    FHint: string;\r\n    FRole: string;\r\n    FShowHint: Boolean;\r\n    FTabOrder: Integer;\r\n    FTabStop: Boolean;\r\n    FVisible: Boolean;\r\n    FWidth: Integer;\r\n    FHeight: Integer;\r\n    FTag: Integer;\r\n    FAlign: TAlign;\r\n    FAnchors: TAnchors;\r\n    FAlignWithMargins: boolean;\r\n    FIsAligning: boolean;\r\n    FOnMouseEnter: TNotifyEvent;\r\n    FOnMouseLeave: TNotifyEvent;\r\n    FCursor: TCursor;\r\n    FDoubleBuffered: Boolean;\r\n    FControlStyle: TControlStyle;\r\n    FMargins: TMargins;\r\n    FOnMouseWheel: TMouseWheelEvent;\r\n    FParentDoubleBuffered: Boolean;\r\n    FParentColor: Boolean;\r\n    FParentFont: Boolean;\r\n    FParentBiDiMode: Boolean;\r\n    FOnTouchMove: TTouchEvent;\r\n    FOnTouchStart: TTouchEvent;\r\n    FOnTouchEnd: TTouchEvent;\r\n    FOnTouchCancel: TTouchEvent;\r\n    FLinkTouchEvents: Boolean;\r\n    FWidthStyle: TSizeStyle;\r\n    FHeightStyle: TSizeStyle;\r\n    FWidthPercent: TPercentSize;\r\n    FHeightPercent: TPercentSize;\r\n    FOrigRect: TRect;\r\n    FOrigParentRect: TRect;\r\n    FIsResizing: boolean;\r\n    FShowFocus: boolean;\r\n    FBorderWidth: integer;\r\n    FOrigTop: integer;\r\n    FOrigLeft: integer;\r\n    FUpdateTopLeft: boolean;\r\n    FEnablePropagation: Boolean;\r\n    FParentShowHint: Boolean;\r\n    FScriptLoaded: Boolean;\r\n    FControlScriptCount: Integer;\r\n    FControlScriptCountLoaded: Integer;\r\n    FRequiredScripts: TStringList;\r\n    FElementFont: TElementFont;\r\n    FElementPosition: TElementPosition;\r\n    FParentElement: TJSHTMLElement;\r\n    FTagObject: TObject;\r\n    FClipChildren: Boolean;\r\n    FTextDirection: TTextDirection;\r\n    FEventStopPropagation: TEventPropagation;\r\n    FParentElementID: string;\r\n    FOnResize: TNotifyEvent;\r\n    FMouseMovePtr: pointer;\r\n    FMouseDownPtr: pointer;\r\n    FMouseUpPtr: pointer;\r\n    FMouseEnterPtr: pointer;\r\n    FMouseLeavePtr: pointer;\r\n    FClickPtr: pointer;\r\n    FDblClickPtr: pointer;\r\n    FKeyDownPtr: pointer;\r\n    FKeyUpPtr: pointer;\r\n    FKeyPressPtr: pointer;\r\n    FInputPtr: pointer;\r\n    FTouchStartPtr: pointer;\r\n    FTouchEndPtr: pointer;\r\n    FTouchMovePtr: pointer;\r\n    FTouchCancelPtr: pointer;\r\n    FContextMenuPtr: pointer;\r\n    FExitPtr: pointer;\r\n    FEnterPtr: pointer;\r\n    FWheelPtr: pointer;\r\n    FLayerMouseEnterPtr: pointer;\r\n    FLayerMouseLeavePtr: pointer;\r\n    FScriptLoadedPtr: pointer;\r\n    FDragStartPtr: pointer;\r\n    FDragOverPtr: pointer;\r\n    FDragEnterPtr: pointer;\r\n    FDragLeavePtr: pointer;\r\n    FDragEndPtr: pointer;\r\n    FDragDropPtr: pointer;\r\n    FChildOrder: integer;\r\n    FAllowTouch: boolean;\r\n    FCtl3D: boolean;\r\n    FParentCtl3D: boolean;\r\n    FWheelAccumulator: integer;\r\n    FWheelMousePos: TPoint;\r\n    FBiDiMode: TBiDiMode;\r\n    FOnMouseWheelDown: TMouseWheelUpDownEvent;\r\n    FOnMouseWheelUp: TMouseWheelUpDownEvent;\r\n    FNoUserSelect: boolean;\r\n    FEventsBound: boolean;\r\n    FDragMode: TDragMode;\r\n    FToolTip: JSValue;\r\n    function GetControlsCount: Integer;\r\n    function GetControls(Index: Integer): TControl;\r\n    procedure SetVisible(AValue: Boolean);\r\n    procedure SetHint(AValue: string);\r\n    procedure SetShowHint(AValue: Boolean);\r\n    procedure SetTabOrder(AValue: Integer);\r\n    procedure SetTabStop(AValue: Boolean);\r\n    procedure SetAlign(const Value: TAlign);\r\n    procedure SetAlignWithMargins(const Value: boolean);\r\n    function GetBoundsRect: TRect;\r\n    procedure SetBoundsRect(const Value: TRect);\r\n    procedure SetID(const Value: string);\r\n    procedure SetMargins(const Value: TMargins);\r\n    procedure SetAnchors(const Value: TAnchors);\r\n    function GetElementEvent: TJSEvent;\r\n    function GetClientOrigin: TPoint;\r\n    procedure SetHeightStyle(const Value: TSizeStyle);\r\n    procedure SetWidthStyle(const Value: TSizeStyle);\r\n    procedure SetHeightPercent(const Value: TPercentSize);\r\n    procedure SetWidthPercent(const Value: TPercentSize);\r\n    procedure SetShowFocus(const Value: boolean);\r\n    procedure SetBorderWidth(const Value: integer); virtual;\r\n    function GetIsLinked: boolean;\r\n    procedure SetScriptLoaded(const Value: boolean);\r\n    procedure SetRequiredScripts(const Value: TStringList);\r\n    procedure SetElementFont(const Value: TElementFont);\r\n    procedure SetElementPosition(const Value: TElementPosition);\r\n    procedure SetParentElement(const Value: TJSHTMLElement);\r\n    procedure SetClipChildren(const Value: Boolean);\r\n    function GetClientHeight: Integer;\r\n    function GetClientWidth: Integer;\r\n    procedure SetClientHeight(const Value: Integer);\r\n    procedure SetClientWidth(const Value: Integer);\r\n    procedure SetParentElementID(const Value: string);\r\n    procedure SetChildOrderEx(const Value: integer);\r\n    function GetRole: string;\r\n    procedure SetRole(const Value: string);\r\n    function GetContainer: TJSElement; virtual;\r\n    function GetChildContainer: TJSElement; virtual;\r\n    procedure SetParentFont(const Value: boolean);\r\n    procedure SetParentColor(const Value: boolean);\r\n    procedure SetDragMode(const Value: TDragMode);\r\n  protected\r\n    procedure SetWidth(AValue: Integer); virtual;\r\n    procedure SetHeight(AValue: Integer); virtual;\r\n    procedure SetWidthInt(AValue: Integer); virtual;\r\n    procedure SetHeightInt(AValue: Integer); virtual;\r\n    procedure SetEnabled(Value: Boolean); virtual;\r\n    procedure RecreateCanvas; virtual;\r\n    procedure VisibleChanging; virtual;\r\n    procedure VisibleChanged; virtual;\r\n    procedure ColorChanging; virtual;\r\n    function GetWidth: Integer; virtual;\r\n    function GetHeight: Integer; virtual;\r\n    function GetOuterWidth: integer; virtual;\r\n    function GetOuterHeight: integer; virtual;\r\n    function GetDesignWidth: integer; virtual;\r\n    function GetDesignHeight: integer; virtual;\r\n    function GetDesignLeft: integer; virtual;\r\n    function GetDesignTop: integer; virtual;\r\n    function GetLeft: Integer; override;\r\n    function GetTop: Integer; override;\r\n    function HandleAllocated: Boolean; virtual;\r\n    function CreateElement: TJSElement; virtual;\r\n    procedure CreateChildElements(AContainer: TJSElement); virtual;\r\n    function ContainerElement: TJSElement; virtual;\r\n    function IsStructuralElement: boolean; virtual;\r\n    function IsEnabled: boolean; virtual;\r\n    function GetNewName: string; virtual;\r\n    function IsInputControl: Boolean; virtual;\r\n    procedure RecreateElement; virtual;\r\n    procedure BindElement; virtual;\r\n    procedure CreateInitialize; virtual;\r\n    procedure DestroyControls; virtual;\r\n    procedure ClearControls; virtual;\r\n    function GetElementStyle: TJSCSSStyleDeclaration; virtual;\r\n    procedure SetControlCursor(const Value: TCursor); virtual;\r\n    procedure SetBiDiMode(const Value: TBiDiMode); virtual;\r\n    function GetMouseEventButton(Event: TJSMouseEvent): TMouseButton; virtual;\r\n    function GetMouseEventShiftState(Event: TJSMouseEvent): TShiftState; virtual;\r\n    function GetKeyBoardEventShiftState(Event: TJSKeyBoardEvent): TShiftState; virtual;\r\n    function GetMouseWheelEventShiftState(Event: TJSWheelEvent): TShiftState; virtual;\r\n    function GetTouchEventShiftState(Event: TJSTouchEvent): TShiftState; virtual;\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoWheel(Event: TJSWheelEvent): Boolean; virtual;\r\n    function HandleDoDblClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseDown(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseUp(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseMove(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseLeave(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoContextMenu(Event: TJSMouseEvent): Boolean; virtual;\r\n    function LayerHandleDoMouseEnter(Event: TJSMouseEvent): Boolean; virtual;\r\n    function LayerHandleDoMouseLeave(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseEnter(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoKeyDown(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    function HandleDoKeyUp(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    function HandleDoKeyPress(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    function HandleDoInput(Event: TJSInputEvent): Boolean; virtual;\r\n    function HandleDoExit(Event: TEventListenerEvent): Boolean; virtual;\r\n    function HandleDoEnter(Event: TJSFocusEvent): Boolean; virtual;\r\n    function HandleDoTouchStart(Event: TJSTouchEvent): Boolean; virtual;\r\n    function HandleDoTouchMove(Event: TJSTouchEvent): Boolean; virtual;\r\n    function HandleDoTouchEnd(Event: TJSTouchEvent): Boolean; virtual;\r\n    function HandleDoTouchCancel(Event: TJSTouchEvent): Boolean; virtual;\r\n    function HandleDoDragStart(Event: TJSDragEvent): Boolean; virtual;\r\n    function HandleDoDragOver(Event: TJSDragEvent): Boolean; virtual;\r\n    function HandleDoDragEnter(Event: TJSDragEvent): Boolean; virtual;\r\n    function HandledoDragLeave(Event: TJSDragEvent): Boolean; virtual;\r\n    function HandleDoDragEnd(Event: TJSDragEvent): Boolean; virtual;\r\n    function HandleDoDragDrop(Event: TJSDragEvent): Boolean; virtual;\r\n    procedure HandleFontChanged(Sender: TObject); virtual;\r\n    procedure ParentFontChanged;\r\n    procedure DoExit; virtual;\r\n    procedure DoEnter; virtual;\r\n    procedure Click; virtual;\r\n    procedure UpdateElement; virtual;\r\n    procedure UpdateElementSize; virtual;\r\n    procedure UpdateElementVisual; virtual;\r\n    procedure UpdateElementData; virtual;\r\n    procedure UpdateParent; virtual;\r\n    procedure UpdateControlSize(AWidth, AHeight: integer); virtual;\r\n    procedure InternalUpdateParent; virtual;\r\n    procedure UpdateChildren(AControl: TControl); virtual;\r\n    procedure PersistinHTML; virtual;\r\n    procedure LoadFromHTML(const HTML: string); virtual;\r\n    procedure InitFromHTML; virtual;\r\n    function SaveState: string; virtual;\r\n    procedure LoadState(AState: string); virtual;\r\n    procedure DisableTab; virtual;\r\n    procedure EnableTab; virtual;\r\n\r\n    procedure SetElementClassName(AValue: string); virtual;\r\n    procedure SetColor(AValue: TColor); virtual;\r\n    procedure SetFont(AValue: TFont); virtual;\r\n    procedure SetParent(AValue: TControl); virtual;\r\n    procedure RegisterParent(AValue: TControl); virtual;\r\n    procedure UnRegisterParent(AValue: TControl); virtual;\r\n    function CanAcceptChild(AValue: TControl): TControl; virtual;\r\n\r\n    procedure SetLeft(AValue: Integer); override;\r\n    procedure SetTop(AValue: Integer); override;\r\n\r\n    procedure MouseUp(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); virtual;\r\n    procedure MouseDown(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); virtual;\r\n    procedure MouseMove(Shift: TShiftState; X,Y: Integer); virtual;\r\n\r\n    procedure TouchStart(X,Y: Integer); virtual;\r\n    procedure TouchMove(X,Y: Integer); virtual;\r\n    procedure TouchEnd(X,Y: Integer); virtual;\r\n    procedure TouchCancel(X,Y: Integer); virtual;\r\n\r\n    procedure DoMouseEnter; virtual;\r\n    procedure DoMouseLeave; virtual;\r\n    procedure MouseWheel(Shift: TShiftState; WheelDelta: Integer; var Handled: Boolean); virtual;\r\n    function DoMouseWheelDown(Shift: TShiftState; MousePos: TPoint): Boolean; virtual;\r\n    function DoMouseWheelUp(Shift: TShiftState; MousePos: TPoint): Boolean; virtual;\r\n    procedure DblClick; virtual;\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); virtual;\r\n    procedure KeyPress(var Key: Char); virtual;\r\n    procedure KeyUp(var Key: Word; Shift: TShiftState); virtual;\r\n    procedure SetFocus; virtual;\r\n    procedure DoMarginsChanged(Sender: TObject); virtual;\r\n    procedure DoRealign; virtual;\r\n    procedure DoBoundsChange; virtual;\r\n    procedure DoEndDrag(Target: TObject; X, Y: Integer); virtual;\r\n    procedure DoStartDrag(var DragObject: TDragObject); virtual;\r\n    procedure DragOver(Source: TObject; X, Y: Integer; State: TDragState;\r\n      var Accept: Boolean); virtual;\r\n    function IsFocused: Boolean; virtual;\r\n    function Focused: Boolean; virtual;\r\n    function GetID: string; virtual;\r\n    function GetElementHandle: TJSHTMLElement; virtual;\r\n    function GetElementBindHandle: TJSEventTarget; virtual;\r\n    function GetElement: TJSElement;\r\n    function GetKeyCode(AValue: string; IgnoreCase: boolean = true): Integer;\r\n    function GetKeyChar(AValue: string): Char;\r\n    function IsKeyCharacter(AValue: string): Boolean;\r\n    function GetClientRect: TRect; virtual;\r\n    property Container: TJSElement read GetContainer write FContainer;\r\n    property ChildContainer: TJSElement read GetChildContainer;\r\n    property ElementBindHandle: TJSEventTarget read GetElementBindHandle;\r\n    property Element: TJSElement read GetElement;\r\n\r\n    procedure CreateControl; virtual;\r\n    procedure ClearMethodPointers; virtual;\r\n    procedure GetMethodPointers; virtual;\r\n    function EventsBound: boolean;\r\n    procedure BindEvents; virtual;\r\n    procedure UnbindEvents; virtual;\r\n    procedure AlignControls(AControl: TControl; var ARect: TRect); virtual;\r\n    procedure AlignControl(AControl: TControl); virtual;\r\n    procedure InitAnchoring; virtual;\r\n    function AnchoringInitialized: boolean;\r\n    procedure InitScript; virtual;\r\n    procedure Realign; virtual;\r\n    procedure Loaded; override;\r\n    procedure InternalResize; virtual;\r\n    procedure FontChanged; virtual;\r\n    procedure DisposeOf;\r\n    procedure ClearChildElements; virtual;\r\n\r\n    property Color: TColor read FColor write SetColor;\r\n    property ControlCreated: boolean read FControlCreated;\r\n    property Font: TFont read FFont write SetFont;\r\n    property ClientOrigin: TPoint read GetClientOrigin;\r\n    property OrigRect: TRect read FOrigRect;\r\n    property DragMode: TDragMode read FDragMode write SetDragMode default dmManual;\r\n\r\n    property OnClick: TNotifyEvent read FOnClick write FOnClick;\r\n    property OnResize: TNotifyEvent read FOnResize write FOnResize;\r\n    property OnDblClick: TNotifyEvent read FOnDblClick write FOnDblClick;\r\n    property ControlStyle: TControlStyle read FControlStyle write FControlStyle;\r\n    procedure HookElement;\r\n    procedure SetElementColor(AElement: TJSHTMLElement; AColor: TColor);\r\n    procedure MoveElements(FromElement,ToElement: TJSElement); virtual;\r\n    procedure MoveElementsAndFree(FromElement,ToElement: TJSElement); virtual;\r\n    procedure CreateWithID(AID: string); virtual;\r\n    procedure AddInstanceStyle(const css: string); virtual; overload;\r\n    class procedure AddInstanceStyle(const id: string; const css: string); virtual; overload;\r\n    procedure AddControlStyle(const css: string); virtual;\r\n    procedure AddControlLink(const linkid, link: string); virtual;\r\n    procedure AddControlScriptLink(const link: string); virtual;\r\n    procedure AddControlScriptSource(const source: string); virtual;\r\n    function AddRequiredScripts: boolean;\r\n    procedure AddRequiredScript(const link: string); virtual;\r\n    procedure ResetAnchoring; virtual;\r\n    procedure UpdateSize; virtual;\r\n    procedure UpdateAnchoring; virtual;\r\n    procedure UpdateChildAnchoring; virtual;\r\n    procedure SetElementPointer(AElement: TJSHTMLElement; ACursor: TCursor);\r\n    function GetWebClassName: string; virtual;\r\n    function GetCSSManager: TCSSCodeManager; virtual;\r\n    function IsUpdating: boolean;\r\n    function CanShowFocus: boolean; virtual;\r\n    procedure RequiredScriptLoaded(Event: TJSEvent); virtual;\r\n    procedure InjectCSS; virtual;\r\n    procedure StartCapture; virtual;\r\n    property LinkTouchEvents: Boolean read FLinkTouchEvents write FLinkTouchEvents;\r\n    property OnTouchStart: TTouchEvent read FOnTouchStart write FOnTouchStart;\r\n    property OnTouchMove: TTouchEvent read FOnTouchMove write FOnTouchMove;\r\n    property OnTouchEnd: TTouchEvent read FOnTouchEnd write FOnTouchEnd;\r\n    property OnTouchCancel: TTouchEvent read FOnTouchCancel write FOnTouchCancel;\r\n    property ShowFocus: boolean read FShowFocus write SetShowFocus default false;\r\n    property BorderWidth: integer read FBorderWidth write SetBorderWidth default 0;\r\n    property ControlScriptCount: integer read FControlScriptCount write FControlScriptCount;\r\n    property ControlScriptCountLoaded: integer read FControlScriptCountLoaded write FControlScriptCountLoaded;\r\n    property RequiredScripts: TStringList read FRequiredScripts write SetRequiredScripts;\r\n    property Role: string read GetRole write SetRole;\r\n    property TextDirection: TTextDirection read FTextDirection write FTextDirection default tdDefault;\r\n    function RequiredBaseURL: string; virtual;\r\n    function GetStyle(css: string): string;\r\n    procedure SetBoundsInt(X, Y, AWidth, AHeight: Integer); virtual;\r\n    procedure MoveFirst(AControl: TControl); virtual;\r\n    procedure MoveLast(AControl: TControl); virtual;\r\n    property ParentElementHandle: TJSHTMLElement read FParentElement write FParentElement;\r\n    property NoUserSelect: boolean read FNoUserSelect write FNoUserSelect;\r\n    procedure EnableDrag; virtual;\r\n    procedure DisableDrag; virtual;\r\n    property OnDragOver: TDragOverEvent read FOnDragOver write FOnDragOver;\r\n    property OnDragDrop: TDragDropEvent read FOnDragDrop write FOnDragDrop;\r\n    property OnStartDrag: TStartDragEvent read FOnStartDrag write FOnStartDrag;\r\n    property OnEndDrag: TEndDragEvent read FOnEndDrag write FOnEndDrag;\r\n  public\r\n    constructor Create(ID: string); virtual; overload;\r\n    constructor Create(AOwner: TComponent); overload; override;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure DragDrop(Source: TObject; X, Y: Integer); virtual;\r\n    procedure Resize; virtual;\r\n    procedure Capture;\r\n    procedure ApplyName;\r\n    procedure ReleaseCapture;\r\n    procedure BringToFront;\r\n    procedure SendToBack;\r\n    procedure Show;\r\n    procedure Hide;\r\n    procedure PreventDefault;\r\n    procedure StopPropagation;\r\n    procedure BeginDrag;\r\n    procedure BeginUpdate; override;\r\n    procedure EndUpdate; override;\r\n    procedure Invalidate; virtual;\r\n    procedure SetParentComponent(Value: TComponent); override;\r\n    procedure SetBounds(X, Y, AWidth, AHeight: Integer); virtual;\r\n    procedure XYToClient(X,Y: single; var AClientX, AClientY: single); virtual;\r\n    procedure ClientToXY(AClientX, AClientY: single; var X,Y: single); virtual;\r\n    procedure GetChildren(Proc: TGetChildProc; Root: TComponent); override;\r\n    function Captured: Boolean; virtual;\r\n    function MakeScreenshot: TBitmap; virtual;\r\n    function ClientToScreen(const Point: TPoint): TPoint; virtual;\r\n    function ScreenToClient(const Point: TPoint): TPoint; virtual;\r\n    function CanFocus: Boolean; virtual;\r\n    function HasHorzScrollBar: Boolean; virtual;\r\n    function HasVertScrollBar: Boolean; virtual;\r\n    property BiDiMode: TBiDiMode read FBiDiMode write SetBiDiMode default bdLeftToRight;\r\n    property Ctl3D: boolean read FCtl3D write FCtl3D;\r\n    property ParentCtl3D: boolean read FParentCtl3D write FParentCtl3D;\r\n    property AllowTouch: boolean read FAllowTouch write FAllowTouch;\r\n    property EventStopPropagation: TEventPropagation read FEventStopPropagation write FEventStopPropagation;\r\n    property ChildOrder: integer read FChildOrder write SetChildOrderEx default 0;\r\n    property Controls[Index: Integer]: TControl read GetControls;\r\n    property ControlCount: Integer read GetControlsCount;\r\n    property Parent: TControl read FParent write SetParent;\r\n    property ParentElement: TJSHTMLElement read FParentElement write SetParentElement;\r\n    property ParentElementID: string read FParentElementID write  SetParentElementID;\r\n    property BoundsRect: TRect read GetBoundsRect write SetBoundsRect;\r\n    property DoubleBuffered: Boolean read FDoubleBuffered write FDoubleBuffered default false;\r\n    property ParentDoubleBuffered: Boolean read FParentDoubleBuffered write FParentDoubleBuffered default true;\r\n    property ParentColor: boolean read FParentColor write SetParentColor default false;\r\n    property ParentFont: boolean read FParentFont write SetParentFont default true;\r\n    property ParentBiDiMode: boolean read FParentBiDiMode write FParentBiDiMode default true;\r\n    property Align: TAlign read FAlign write SetAlign default alNone;\r\n    property AlignWithMargins: boolean read FAlignWithMargins write SetAlignWithMargins default false;\r\n    property ElementEvent: TJSEvent read GetElementEvent write FElementEvent;\r\n    property ElementHandle: TJSHTMLElement read GetElementHandle;\r\n    property ElementClassName: TElementClassName read FElementClassName write SetElementClassName;\r\n    property ElementFont: TElementFont read FElementFont write SetElementFont default efProperty;\r\n    property ElementPosition: TElementPosition read FElementPosition write SetElementPosition default epAbsolute;\r\n    property ElementID: TElementID read GetID write SetID;\r\n    property Margins: TMargins read FMargins write SetMargins;\r\n    property ClientRect: TRect read GetClientRect;\r\n    property EnablePropagation: Boolean read FEnablePropagation write FEnablePropagation default False;\r\n    property ScriptLoaded: boolean read FScriptLoaded write SetScriptLoaded;\r\n    property ClipChildren: Boolean read FClipChildren write SetClipChildren default True;\r\n\r\n    property Anchors: TAnchors read FAnchors write SetAnchors default [akLeft, akTop];\r\n    property Cursor: TCursor read FCursor write SetControlCursor default crDefault;\r\n    property Enabled: Boolean read FEnabled write SetEnabled default true;\r\n    property HeightStyle: TSizeStyle read FHeightStyle write SetHeightStyle default ssAbsolute;\r\n    property Height: Integer read GetHeight write SetHeight;\r\n    property HeightPercent: TPercentSize read FHeightPercent write SetHeightPercent default 100;\r\n    property Hint: string read FHint write SetHint;\r\n    property IsLinked: boolean read GetIsLinked;\r\n    property ShowHint: Boolean read FShowHint write SetShowHint default false;\r\n    property ParentShowHint: Boolean read FParentShowHint write FParentShowHint;\r\n    property TabOrder: Integer read FTabOrder write SetTabOrder;\r\n    property TabStop: Boolean read FTabStop write SetTabStop default true;\r\n    property Tag: Integer read FTag write FTag default 0;\r\n    property TagObject: TObject read FTagObject write FTagObject;\r\n    property Visible: Boolean read FVisible write SetVisible default true;\r\n    property WidthStyle: TSizeStyle read FWidthStyle write SetWidthStyle default ssAbsolute;\r\n    property ClientHeight: Integer read GetClientHeight write SetClientHeight;\r\n    property ClientWidth: Integer read GetClientWidth write SetClientWidth;\r\n    property Width: Integer read GetWidth write SetWidth;\r\n    property WidthPercent: TPercentSize read FWidthPercent write SetWidthPercent default 100;\r\n\r\n    property OnMouseWheel: TMouseWheelEvent read FOnMouseWheel write FOnMouseWheel;\r\n    property OnMouseWheelDown: TMouseWheelUpDownEvent read FOnMouseWheelDown write FOnMouseWheelDown;\r\n    property OnMouseWheelUp: TMouseWheelUpDownEvent read FOnMouseWheelUp write FOnMouseWheelUp;\r\n\r\n    property OnMouseDown: TMouseEvent read FOnMouseDown write FOnMouseDown;\r\n    property OnMouseUp: TMouseEvent read FOnMouseUp write FOnMouseUp;\r\n    property OnMouseMove: TMouseMoveEvent read FOnMouseMove write FOnMouseMove;\r\n    property OnMouseEnter: TNotifyEvent read FOnMouseEnter write FOnMouseEnter;\r\n    property OnMouseLeave: TNotifyEvent read FOnMouseLeave write FOnMouseLeave;\r\n    //Note: On Android the OnKeyUp and OnKeyDown events do not return the correct KeyCode.\r\n    //This is a known issue:\r\n    //https://bugs.chromium.org/p/chromium/issues/detail?id=118639\r\n    //https://stackoverflow.com/questions/36753548/keycode-on-android-is-always-229\r\n    //Workaround: Use the Char parameter of the OnKeyPress event instead\r\n    property OnKeyUp: TKeyEvent read FOnKeyUp write FOnKeyUp;\r\n    property OnKeyDown: TKeyEvent read FOnKeyDown write FOnKeyDown;\r\n    //\r\n    //Note: On Android the OnKeyPress event is not triggered.\r\n    //The OnInput event is used instead to trigger the OnKeyPress event.\r\n    property OnKeyPress: TKeyPressEvent read FOnKeyPress write FOnKeyPress;\r\n    //\r\n    property OnEnter: TNotifyEvent read FOnEnter write FOnEnter;\r\n    property OnExit: TNotifyEvent read FOnExit write FOnExit;\r\n  published\r\n//    property DesignSize: TPoint read FDesignSize write FDesignSize stored false;\r\n//    property ExplicitLeft: integer read FExplicitLeft write FExplicitLeft stored false;\r\n//    property ExplicitTop: integer read FExplicitTop write FExplicitTop stored false;\r\n//    property ExplicitWidth: integer read FExplicitWidth write FExplicitWidth stored false;\r\n//    property ExplicitHeight: integer read FExplicitHeight write FExplicitHeight stored false;\r\n  end;\r\n\r\n  TScrollBarKind = (sbHorizontal, sbVertical);\r\n\r\n  TControlScrollBar = class(TPersistent)\r\n  private\r\n    FKind: TScrollBarKind;\r\n    FControl: TControl;\r\n  public\r\n    constructor Create(AControl: TControl; AKind: TScrollBarKind);\r\n    property Kind: TScrollBarKind read FKind;\r\n    function IsScrollBarVisible: boolean;\r\n    function ScrollPos: integer;\r\n    function Range: integer;\r\n  end;\r\n\r\n\r\n  TWinControl = class(TControl)\r\n  published\r\n    property Cursor;\r\n    property ElementClassName;\r\n    property Enabled;\r\n    property Height;\r\n    property Hint;\r\n    property Left;\r\n    property ShowHint;\r\n    property Tag;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseEnter;\r\n    property OnMouseLeave;\r\n    property OnKeyUp;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TCustomControl = class(TWinControl)\r\n  private\r\n    FCaption: string;\r\n    FPixelRatio: Single;\r\n    FPainting: boolean;\r\n    FCanvas: TCanvas;\r\n    FElementCanvas: TJSHTMLCanvasElement;\r\n    FBorderStyle: TBorderStyle;\r\n    FBorderColor: TColor;\r\n    FCustomBorder: boolean;\r\n    FOnScreenShot: TScreenshotEvent;\r\n    FBevelOuter: TBevelCut;\r\n    FBevelWidth: Integer;\r\n    FBevelCut: TBevelCut;\r\n    FBevelEdges: TBevelEdges;\r\n    FBevelKind: TBevelKind;\r\n    function GetCanvas: TCanvas;\r\n  protected\r\n    procedure RenderDesigning(ACaption: string; AElement: TJSElement; AControl: TCustomControl; ADisplay: Boolean; AImage: string = '');\r\n    function GetPixelRatio: Single;\r\n    function GetContext: TJSCanvasRenderingContext2D; virtual;\r\n    procedure RecreateCanvas; override;\r\n    procedure SetBorderStyle(const AValue: TBorderStyle); virtual;\r\n    procedure SetBorderColor(const AValue: TColor); virtual;\r\n    procedure SetName(const NewName: TComponentName); override;\r\n    procedure SetCaption(const AValue: string); virtual;\r\n    procedure CreateControl; override;\r\n    procedure Loaded; override;\r\n    procedure UpdateElementVisual; override;\r\n    function CreateElement: TJSElement; override;\r\n    function GetCanvasHeightOffset: Integer; virtual;\r\n    function GetCanvasWidthOffset: Integer; virtual;\r\n    property BorderStyle: TBorderStyle read FBorderStyle write SetBorderStyle default bsSingle;\r\n    property BorderColor: TColor read FBorderColor write SetBorderColor default clSilver;\r\n    procedure BindElement; override;\r\n    procedure BindEvents; override;\r\n    procedure HandleScreenShot(Sender: TObject); virtual;\r\n    procedure Paint; virtual;\r\n    property CustomBorder: boolean read FCustomBorder write FCustomBorder;\r\n    property Caption: string read FCaption write SetCaption;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    function MakeScreenShot: TBitmap; override;\r\n    procedure Resize; override;\r\n    procedure Invalidate; override;\r\n    procedure SetFocus; override;\r\n    function Focused: boolean; override;\r\n    procedure EndUpdate; override;\r\n    property Canvas: TCanvas read GetCanvas;\r\n    property GraphicsContext:  TJSCanvasRenderingContext2D read GetContext;\r\n    property ElementCanvas: TJSHTMLCanvasElement read FElementCanvas;\r\n    property OnScreenshot: TScreenshotEvent read FOnScreenshot write FOnScreenshot;\r\n    //dummy properties for FNC\r\n    property BevelEdges: TBevelEdges read FBevelEdges write FBevelEdges;\r\n    property BevelInner: TBevelCut read FBevelCut write FBevelCut;\r\n    property BevelKind: TBevelKind read FBevelKind write FBevelKind;\r\n    property BevelOuter: TBevelCut read FBevelOuter write FBevelOuter;\r\n    property BevelWidth: Integer read FBevelWidth write FBevelWidth;\r\n  end;\r\n\r\n  TjQueryCustomControl = class(TWinControl)\r\n  private\r\n    FIsInitialized: boolean;\r\n    procedure InitJQueryOnce;\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure Loaded; override;\r\n    procedure SetParent(AValue: TControl); override;\r\n    function GetJQID: string;\r\n    procedure InitJQuery; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property ElementPosition;\r\n  end;\r\n\r\n  TGraphicControl = class(TCustomControl);\r\n\r\n  TScrollingGraphicControl = class(TCustomControl)\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n  public\r\n    procedure UpdateElement; override;\r\n  end;\r\n\r\n  TCustomHTMLDiv = class(TCustomControl)\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n  end;\r\n\r\n  TControlManager = class(TComponent)\r\n  private\r\n    FInstanceCount: integer;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    function GetInstanceNumber: integer;\r\n    procedure Reset;\r\n  end;\r\n\r\n  TCSSCodeFragment = class(TCollectionItem)\r\n  private\r\n    FControlClassname: string;\r\n    FCSS: TStringList;\r\n    procedure SetCSS(const Value: TStringList);\r\n  public\r\n    constructor Create(Collection: TCollection); override;\r\n    destructor Destroy; override;\r\n  published\r\n    property ControlClassname: string read FControlClassname write FControlClassname;\r\n    property CSS: TStringList read FCSS write SetCSS;\r\n  end;\r\n\r\n  TCSSCodeFragments = class(TOwnedCollection)\r\n  private\r\n    function GetItemEx(Index: integer): TCSSCodeFragment;\r\n    procedure SetItemEx(Index: integer; const Value: TCSSCodeFragment);\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Add: TCSSCodeFragment; reintroduce;\r\n    function Insert(Index: integer): TCSSCodeFragment; reintroduce;\r\n    property Items[Index: integer]: TCSSCodeFragment read GetItemEx write SetItemEx;\r\n  end;\r\n\r\n  TCSSCodeManager = class(TComponent)\r\n  private\r\n    FCSSFragments: TCSSCodeFragments;\r\n    procedure SetCSSFragments(const Value: TCSSCodeFragments);\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    function GetClassFragment(AClassname: string): TCSSCodeFragment;\r\n    function GetClassCSS(AClassname: string): string;\r\n  published\r\n    property CSSFragments: TCSSCodeFragments read FCSSFragments write SetCSSFragments;\r\n  end;\r\n\r\n  ITMSFNCDataBinderBase = interface\r\n    ['{778B63C9-34E3-4B65-A6B8-85E3EB1D17C3}']\r\n    procedure DataBeginUpdate;\r\n    procedure DataEndUpdate;\r\n  end;\r\n\r\n  ITMSFNCDataBinderGrid = interface(ITMSFNCDataBinderBase)\r\n    ['{D23BDEAA-49B1-451A-9401-0D0D11A9957A}']\r\n    procedure SetDataColumnCount(AValue: Integer);\r\n    procedure SetDataRowCount(AValue: Integer);\r\n    procedure ClearData;\r\n    function GetDataRowCount: Integer;\r\n    procedure SetDataValue(AColumn, ARow: Integer; AValue: string);\r\n    procedure SetDataHeader(AColumn: Integer; AValue: string);\r\n    procedure DataInsertRow(AInsertPosition: Integer);\r\n  end;\r\n\r\nfunction FindGlobalComponent(const Name: string): TComponent;\r\nfunction GetMousePos: TPoint;\r\nprocedure GetCursorPos(var pt: TPoint);\r\nfunction FindUniqueName(const Name: string): string;\r\nfunction GetScrollBarHeight: integer;\r\nfunction GetScrollBarWidth: integer;\r\nprocedure SetHTMLElementFont(AElement: TJSHTMLElement; AFont: TFont; UseCSS: boolean);\r\nprocedure SetHTMLElementColor(AElement: TJSHTMLElement; AColor: TColor; UseCSS: boolean);\r\nfunction GetHTMLCursorName(ACursor: TCursor): string;\r\nfunction GetHTMLElementAbsoluteRect(AElement: TJSHTMLElement): TRect;\r\n\r\nfunction CursorToString(ACursor: TCursor): string;\r\nfunction StringToCursor(const S: string): TCursor;\r\nfunction IsAndroid: Boolean;\r\nfunction GetMaterialClass(mg: TMaterialGlyphType): string;\r\n\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Dialogs, WEBLib.Forms, Math, TypInfo, WEBLib.WebTools, WEBLib.Utils;\r\n\r\nvar\r\n  ControlManager: TControlManager;\r\n  FMouseX, FMouseY: Integer;\r\n  FCursorX, FCursorY: Integer;\r\n  ScrollBW, ScrollBH: Integer;\r\n  DragObject: TObject;\r\n\r\n\r\nconst\r\n  cStyleBkgColor = 'background-color';\r\n\r\nfunction GetMaterialClass(mg: TMaterialGlyphType): string;\r\nbegin\r\n  Result := 'material-icons';\r\n  case mg of\r\n  mgOutlined: Result := 'material-icons-outlined';\r\n  mgTwoTone: Result := 'material-icons-two-tone';\r\n  mgRound: Result := 'material-icons-round';\r\n  mgSharp: Result := 'material-icons-sharp';\r\n  end;\r\nend;\r\n\r\nprocedure SetHTMLElementFont(AElement: TJSHTMLElement; AFont: TFont; UseCSS: boolean);\r\nvar\r\n  s: string;\r\nbegin\r\n  if UseCSS then\r\n  begin\r\n    AElement.style.removeProperty('font-family');\r\n    AElement.style.removeProperty('font-style');\r\n    AElement.style.removeProperty('font-weight');\r\n    AElement.style.removeProperty('font-size');\r\n    AElement.style.removeProperty('text-decoration');\r\n  end\r\n  else\r\n  begin\r\n    AElement.style.setProperty('font-family', AFont.Name);\r\n\r\n    AElement.style.setProperty('font-style', 'normal');\r\n\r\n    if fsBold in AFont.Style then\r\n      AElement.style.setProperty('font-weight', 'bold')\r\n    else\r\n      AElement.style.setProperty('font-weight', '');\r\n\r\n    if fsItalic in AFont.Style then\r\n       AElement.style.setProperty('font-style', 'italic');\r\n\r\n    s := '';\r\n\r\n    if fsUnderline in AFont.Style then\r\n      s := 'underline';\r\n\r\n    if fsStrikeOut in AFont.Style then\r\n    begin\r\n      if s <> ''  then\r\n         s := s + ' ';\r\n       s:= s + 'line-through';\r\n    end;\r\n\r\n    if (s <> '') then\r\n      AElement.style.setProperty('text-decoration', s)\r\n    else\r\n      AElement.style.removeProperty('text-decoration');\r\n\r\n    AElement.style.setProperty('font-size', IntToStr(AFont.Size) + 'pt');\r\n  end;\r\nend;\r\n\r\nprocedure SetHTMLElementColor(AElement: TJSHTMLElement; AColor: TColor; UseCSS: boolean);\r\nbegin\r\n  if UseCSS or (AColor = clNone) or (AColor = clWindow) then\r\n    AElement.style.removeProperty(cStyleBkgColor)\r\n  else\r\n    AElement.style.setProperty(cStyleBkgColor, ColorToHTML(AColor));\r\nend;\r\n\r\nfunction GetHTMLCursorName(ACursor: TCursor): string;\r\nbegin\r\n  Result := 'default';\r\n  case ACursor of\r\n    crDefault: Result :='default';\r\n    crArrow: Result :='auto';\r\n    crNone: Result :='none';\r\n    crCross: Result :='crosshair';\r\n    crIBeam: Result :='text';\r\n    crSizeNESW: Result :='nesw-resize';\r\n    crSizeNS: Result :='ns-resize';\r\n    crSizeNWSE: Result :='nwse-resize';\r\n    crSizeWE: Result :='ew-resize';\r\n    crUpArrow: Result :='n-resize';\r\n    crHourGlass: Result :='wait';\r\n    crDrag: Result :='copy';\r\n    crNoDrop: Result :='no-drop';\r\n    crHSplit: Result :='col-resize';\r\n    crVSplit: Result :='row-resize';\r\n    crMultiDrag: Result :='copy';\r\n    crSQLWait: Result :='progress';\r\n    crNo: Result :='not-allowed';\r\n    crAppStart: Result :='progress';\r\n    crHelp: Result :='help';\r\n    crHandPoint: Result :='pointer';\r\n    crSizeAll,crSize: Result :='move';\r\n  end;\r\nend;\r\n\r\nfunction CursorToString(ACursor: TCursor): string;\r\nbegin\r\n  Result := 'crDefault';\r\n  case ACursor of\r\n    crDefault: Result :='crDefault';\r\n    crArrow: Result :='crArrow';\r\n    crNone: Result :='crNone';\r\n    crCross: Result :='crCross';\r\n    crSize: Result := 'ctSize';\r\n    crIBeam: Result :='crIBeam';\r\n    crSizeNESW: Result :='crSizeNESW';\r\n    crSizeNS: Result :='crSizeNS';\r\n    crSizeNWSE: Result :='crSizeNWSE';\r\n    crSizeWE: Result :='crSizeWE';\r\n    crUpArrow: Result :='crUpArrow';\r\n    crHourGlass: Result :='crHourGlass';\r\n    crDrag: Result :='crDrag';\r\n    crNoDrop: Result :='crNoDrop';\r\n    crHSplit: Result :='crHSplit';\r\n    crVSplit: Result :='crVSplit';\r\n    crMultiDrag: Result :='crMultiDrag';\r\n    crSQLWait: Result :='crSQLWait';\r\n    crNo: Result :='crNo';\r\n    crAppStart: Result :='crAppStart';\r\n    crHelp: Result :='crHelp';\r\n    crHandPoint: Result :='crHandpoint';\r\n    crSizeAll: Result :='crSizeAll';\r\n  end;\r\nend;\r\n\r\nfunction StringToCursor(const S: string): TCursor;\r\nvar\r\n  us: string;\r\nbegin\r\n  Result := crDefault;\r\n  us := Uppercase(s);\r\n  if (us = 'CRDEFAULT') then Result := crDefault else\r\n  if (us = 'CRARROW') then Result := crArrow else\r\n  if (us = 'CRNONE') then Result := crNone else\r\n  if (us = 'CRCROSS') then Result := crCross else\r\n  if (us = 'CRSIZE') then Result := crSize else\r\n  if (us = 'CRIBEAM') then Result := crIBeam else\r\n  if (us = 'CRSIZENESW') then Result := crSizeNESW else\r\n  if (us = 'CRSIZENS') then Result := crSizeNS else\r\n  if (us = 'CRSIZENWSE') then Result := crSizeNWSE else\r\n  if (us = 'CRSIZEWE') then Result := crSizeWE else\r\n  if (us = 'CRUPARROW') then Result := crUpArrow else\r\n  if (us = 'CRHOURGLASS') then Result := crHourGlass else\r\n  if (us = 'CRDRAG') then Result := crDrag else\r\n  if (us = 'CRNODROP') then Result := crNoDrop else\r\n  if (us = 'CRHSPLIT') then Result := crHSplit else\r\n  if (us = 'CRVSPLIT') then Result := crVSplit else\r\n  if (us = 'CRMULTIDRAG') then Result := crMultiDrag else\r\n  if (us = 'CRSQLWAIT') then Result := crSQLWait else\r\n  if (us = 'CRNO') then Result := crNo else\r\n  if (us = 'CRAPPSTART') then Result := crAppStart else\r\n  if (us = 'CRHELP') then Result := crHelp else\r\n  if (us = 'CRHANDPOINT') then Result := crHandpoint else\r\n  if (us = 'CRSIZEALL') then Result := crSizeAll;\r\nend;\r\n\r\n\r\nfunction IsAndroid: Boolean;\r\nvar\r\n  sagent: string;\r\nbegin\r\n  {$IFDEF PAS2JS}\r\n  asm\r\n    sagent = navigator.userAgent;\r\n  end;\r\n  {$ENDIF}\r\n  Result := (pos('Android', sagent) > 0);\r\nend;\r\n\r\nfunction GetMousePos: TPoint;\r\nbegin\r\n  Result := Point(FMouseX, FMouseY);\r\nend;\r\n\r\nprocedure GetCursorPos(var pt: TPoint);\r\nbegin\r\n  pt.x := FCursorX;\r\n  pt.y := FCursorY;\r\nend;\r\n\r\nfunction GetHTMLElementAbsoluteRect(AElement: TJSHTMLElement): TRect;\r\nvar\r\n  s: string;\r\n\r\n  function GetInt(AValue: string): integer;\r\n  var\r\n    e: integer;\r\n  begin\r\n    AValue := StringReplace(AValue, 'px','', [rfReplaceAll]);\r\n    val(AValue, Result, e);\r\n  end;\r\n\r\nbegin\r\n  s := AElement.style.getPropertyValue('left');\r\n  Result.left := GetInt(s);\r\n  s := AElement.style.getPropertyValue('top');\r\n  Result.top := GetInt(s);\r\n  s := AElement.style.getPropertyValue('width');\r\n  Result.right := Result.Left + GetInt(s);\r\n  s := AElement.style.getPropertyValue('height');\r\n  Result.bottom := Result.top + GetInt(s);\r\nend;\r\n\r\nfunction GetScrollBarWidth: integer;\r\nvar\r\n  res: integer;\r\nbegin\r\n  res := ScrollBW;\r\n\r\n  if res = 0 then\r\n  begin\r\n    {$IFDEF PAS2JS}\r\n    asm\r\n      var outer = document.createElement(\"div\");\r\n      outer.style.visibility = \"hidden\";\r\n      outer.style.width = \"100px\";\r\n      outer.style.msOverflowStyle = \"scrollbar\"; // needed for WinJS apps\r\n\r\n      document.body.appendChild(outer);\r\n\r\n      var widthNoScroll = outer.offsetWidth;\r\n      // force scrollbars\r\n      outer.style.overflow = \"scroll\";\r\n\r\n      // add innerdiv\r\n      var inner = document.createElement(\"div\");\r\n      inner.style.width = \"100%\";\r\n      outer.appendChild(inner);\r\n\r\n      var widthWithScroll = inner.offsetWidth;\r\n\r\n      // remove divs\r\n      outer.parentNode.removeChild(outer);\r\n\r\n      res = widthNoScroll - widthWithScroll;\r\n    end;\r\n    {$ENDIF}\r\n    ScrollBW := res;\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction GetScrollBarHeight: integer;\r\nvar\r\n  res: integer;\r\nbegin\r\n  res := ScrollBH;\r\n\r\n  if res = 0 then\r\n  begin\r\n    {$IFDEF PAS2JS}\r\n    asm\r\n      var outer = document.createElement(\"div\");\r\n      outer.style.visibility = \"hidden\";\r\n      outer.style.height = \"100px\";\r\n      outer.style.msOverflowStyle = \"scrollbar\"; // needed for WinJS apps\r\n\r\n      document.body.appendChild(outer);\r\n\r\n      var HeightNoScroll = outer.offsetHeight;\r\n      // force scrollbars\r\n      outer.style.overflow = \"scroll\";\r\n\r\n      // add innerdiv\r\n      var inner = document.createElement(\"div\");\r\n      inner.style.height = \"100%\";\r\n      outer.appendChild(inner);\r\n\r\n      var HeightWithScroll = inner.offsetHeight;\r\n\r\n      // remove divs\r\n      outer.parentNode.removeChild(outer);\r\n\r\n      res = HeightNoScroll - HeightWithScroll;\r\n\r\n      res = 0;\r\n    end;\r\n    {$ENDIF}\r\n    ScrollBH := res;\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction FindGlobalComponent(const Name: string): TComponent;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nfunction FindUniqueName(const Name: string): string;\r\nbegin\r\n  Result := Name + IntToStr(ControlManager.GetInstanceNumber);\r\nend;\r\n\r\n{ TMargins }\r\n\r\nprocedure TMargins.SetLeft(const Value: integer);\r\nbegin\r\n  if (Value <> FLeft) then\r\n  begin\r\n    FLeft := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TMargins.SetTop(const Value: integer);\r\nbegin\r\n  if (Value <> FTop) then\r\n  begin\r\n    FTop := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TMargins.SetRight(const Value: integer);\r\nbegin\r\n  if (Value <> FRight) then\r\n  begin\r\n    FRight := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TMargins.SetBottom(const Value: integer);\r\nbegin\r\n  if (Value <> FBottom) then\r\n  begin\r\n    FBottom := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TMargins.DoChange; \r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\n{ TControl }\r\n\r\nfunction TControl.MakeScreenshot: TBitmap;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nprocedure TControl.MouseDown(Button: TMouseButton; Shift: TShiftState; X,\r\n  Y: Integer);\r\nbegin\r\n  if not Enabled then\r\n    Exit;\r\n\r\n  if Assigned(OnMouseDown) then\r\n   OnMouseDown(Self, Button, Shift, X, Y);\r\nend;\r\n\r\nprocedure TControl.MouseMove(Shift: TShiftState; X, Y: Integer);\r\nbegin\r\n  if not Enabled then\r\n    Exit;\r\n\r\n  if Assigned(OnMouseMove) then\r\n   OnMouseMove(Self, Shift, X, Y);\r\nend;\r\n\r\nprocedure TControl.MouseUp(Button: TMouseButton; Shift: TShiftState; X,\r\n  Y: Integer);\r\nbegin\r\n  if not Enabled then\r\n    Exit;\r\n\r\n  if Assigned(OnMouseUp) then\r\n   OnMouseUp(Self, Button, Shift, X, Y);\r\nend;\r\n\r\nprocedure TControl.MouseWheel(Shift: TShiftState; WheelDelta: Integer;\r\n  var Handled: Boolean);\r\nvar\r\n  IsNeg: Boolean;\r\nbegin\r\n  if Assigned(OnMouseWheel) then\r\n    OnMouseWheel(Self, Shift, WheelDelta, Point(0, 0), Handled);\r\n\r\n  Inc(FWheelAccumulator, WheelDelta);\r\n  while Abs(FWheelAccumulator) >= WHEEL_DELTA do\r\n  begin\r\n    IsNeg := FWheelAccumulator < 0;\r\n    FWheelAccumulator := Abs(FWheelAccumulator) - WHEEL_DELTA;\r\n    if IsNeg then\r\n    begin\r\n      if FWheelAccumulator <> 0 then FWheelAccumulator := -FWheelAccumulator;\r\n      DoMouseWheelDown(Shift, FWheelMousePos);\r\n    end\r\n    else\r\n      DoMouseWheelUp(Shift, FWheelMousePos);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.MoveElements(FromElement, ToElement: TJSElement);\r\nbegin\r\n  //\r\n  {$IFDEF PAS2JS}\r\n  asm\r\n    if (FromElement && ToElement) {\r\n      while (FromElement.childNodes.length) { ToElement.appendChild(FromElement.firstChild); }\r\n    }\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TControl.MoveElementsAndFree(FromElement, ToElement: TJSElement);\r\nbegin\r\n  //\r\n  {$IFDEF PAS2JS}\r\n  asm\r\n    if (FromElement && ToElement){\r\n      while (FromElement.childNodes.length) { ToElement.appendChild(FromElement.firstChild); }\r\n      FromElement.remove();\r\n    }\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TControl.MoveFirst(AControl: TControl);\r\nvar\r\n  i: integer;\r\n  fnd: boolean;\r\nbegin\r\n  fnd  := false;\r\n  for i := ControlCount - 1 downto 0 do\r\n  begin\r\n    if FControls[i] = AControl then\r\n      fnd := true;\r\n\r\n    if fnd then\r\n    begin\r\n      if (i > 0) then\r\n        FControls[i] := FControls[i - 1]\r\n      else\r\n        FControls[i] := AControl;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.MoveLast(AControl: TControl);\r\nvar\r\n  i: integer;\r\n  fnd: boolean;\r\nbegin\r\n  fnd  := false;\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    if FControls[i] = AControl then\r\n      fnd := true;\r\n\r\n    if fnd then\r\n    begin\r\n      if (i < ControlCount - 1) then\r\n        FControls[i] := FControls[i + 1]\r\n      else\r\n        FControls[i] := AControl;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.DoMouseLeave;\r\nbegin\r\n  if Assigned(OnMouseLeave) then\r\n    OnMouseLeave(Self);\r\nend;\r\n\r\nfunction TControl.DoMouseWheelDown(Shift: TShiftState;\r\n  MousePos: TPoint): Boolean;\r\nbegin\r\n  Result := False;\r\n  if Assigned(FOnMouseWheelDown) then\r\n    FOnMouseWheelDown(Self, Shift, MousePos, Result);\r\nend;\r\n\r\nfunction TControl.DoMouseWheelUp(Shift: TShiftState; MousePos: TPoint): Boolean;\r\nbegin\r\n  Result := False;\r\n  if Assigned(FOnMouseWheelUp) then\r\n    FOnMouseWheelUp(Self, Shift, MousePos, Result);\r\nend;\r\n\r\nprocedure TControl.DoMouseEnter;\r\nbegin\r\n  if Assigned(OnMouseEnter) then\r\n    OnMouseEnter(Self);\r\nend;\r\n\r\nprocedure TControl.AlignControls(AControl: TControl; var ARect: TRect);\r\nvar\r\n  j: Integer;\r\n//  ORect: TRect;\r\n\r\n  procedure DoPosition(Control: TControl; AAlign: TAlign);\r\n  var\r\n    dl, dt, dr, db: integer;\r\n  begin\r\n    if not Control.AnchoringInitialized then\r\n      InitAnchoring;\r\n\r\n    Control.FUpdateTopLeft := true;\r\n\r\n    if Control.AlignWithMargins then\r\n    begin\r\n      dl := Control.Margins.Left;\r\n      dt := Control.Margins.Top;\r\n      db := Control.Margins.Bottom;\r\n      dr := Control.Margins.Right;\r\n    end\r\n    else\r\n    begin\r\n      dl := 0;\r\n      dt := 0;\r\n      db := 0;\r\n      dr := 0;\r\n    end;\r\n\r\n    case AAlign of\r\n      alTop:\r\n      begin\r\n        Control.SetBoundsInt(ARect.Left + dl, ARect.Top + dt, ARect.Right - ARect.Left - dl - dr, Control.Height);\r\n        ARect.Top := ARect.Top + Control.Height + dt + db;\r\n      end;\r\n      alBottom:\r\n      begin\r\n        Control.SetBoundsInt(ARect.Left + dl, ARect.Bottom - Control.Height - db - 1, ARect.Right - ARect.Left - dl - dr - 1, Control.Height);\r\n        ARect.Bottom := ARect.Bottom - Control.Height - dt - db;\r\n      end;\r\n      alLeft:\r\n      begin\r\n        Control.SetBoundsInt(ARect.Left + dl, ARect.Top + dt, Control.Width, ARect.Bottom - ARect.Top - dt - db);\r\n        ARect.Left := ARect.Left + Control.Width + dl + dr;\r\n      end;\r\n      alRight:\r\n      begin\r\n        Control.SetBoundsInt(ARect.Right - Control.Width - dr, ARect.Top + dt, Control.Width, ARect.Bottom - ARect.Top - db - dt);\r\n        ARect.Right := ARect.Right - Control.Width - dr - dl;\r\n      end;\r\n      alClient:\r\n      begin\r\n        Control.SetBoundsInt(ARect.Left + dl, ARect.Top + dt, ARect.Right - ARect.Left - dl - dr, ARect.Bottom - ARect.Top - db - dt);\r\n        // just in case there are multiple controls with client alignment\r\n//        ARect.Left := 0;\r\n//        ARect.Top := 0;\r\n//        ARect.Right := 0;\r\n//        ARect.Bottom := 0;\r\n      end;\r\n    end;\r\n\r\n    Control.FUpdateTopLeft := false;\r\n  end;\r\n\r\n  procedure DoAlign(AAlign: TAlign);\r\n  var\r\n    i,j,ins: Integer;\r\n    il: TList;\r\n  begin\r\n    il := TList.Create;\r\n\r\n    for i := 0 to ControlCount - 1 do\r\n    begin\r\n      if (Controls[i].Align = AAlign) and ((Controls[i].Visible) or (csDesigning in ComponentState)) then\r\n      begin\r\n        ins := il.Count;\r\n\r\n        for j := il.Count - 1 downto 0 do\r\n        begin\r\n          case AAlign of\r\n          alTop:\r\n            if Controls[i].FOrigTop < TControl(il.Items[j]).FOrigTop then\r\n              ins := j;\r\n          alLeft:\r\n            if Controls[i].FOrigLeft < TControl(il.Items[j]).FOrigLeft then\r\n              ins := j;\r\n          alRight:\r\n            if Controls[i].FOrigLeft + Controls[i].Width > TControl(il.Items[j]).FOrigLeft + TControl(il.Items[j]).Width then\r\n              ins := j;\r\n          alBottom:\r\n            if Controls[i].FOrigTop + Controls[i].Height > TControl(il.Items[j]).FOrigTop + TControl(il.Items[j]).Height then\r\n              ins := j;\r\n          end;\r\n        end;\r\n        il.Insert(ins, Controls[i]);\r\n      end;\r\n    end;\r\n\r\n    for i := 0 to il.Count - 1 do\r\n    begin\r\n      DoPosition(TControl(il.Items[i]), AAlign);\r\n    end;\r\n\r\n    il.Free;\r\n  end;\r\n\r\nbegin\r\n  //ORect := ARect;\r\n  DoAlign(alTop);\r\n  DoAlign(alBottom);\r\n  DoAlign(alLeft);\r\n  DoAlign(alRight);\r\n  DoAlign(alClient);\r\n  DoAlign(alCustom);\r\n\r\n  for j := 0 to ControlCount - 1 do\r\n  begin\r\n    Controls[j].AlignControl(Controls[j]);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.ApplyName;\r\nvar\r\n  s, prefix: String;\r\n  frm: TCustomForm;\r\nbegin\r\n  s := ClassName;\r\n  Delete(s, 1, 1);\r\n\r\n  prefix := '';\r\n  frm := GetParentForm(Self);\r\n  if Assigned(frm) then\r\n    prefix := frm.ClassName;\r\n\r\n  SetID(prefix+'_'+FindUniqueName(s));\r\nend;\r\n\r\nconstructor TControl.Create(ID: string);\r\nbegin\r\n  FGotFocus := false;\r\n  FTabStop := true;\r\n  FAllowTouch := true;\r\n\r\n  CreateWithID(ID);\r\nend;\r\n\r\nprocedure TControl.HookElement;\r\nvar\r\n  el: TJSElement;\r\n  i: integer;\r\nbegin\r\n  el := document.getElementByID(FID);\r\n  Container := el;\r\n  BindElement;\r\n  BindEvents;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].HookElement;\r\nend;\r\n\r\nfunction TControl.CanAcceptChild(AValue: TControl): TControl;\r\nbegin\r\n   Result := Self;\r\nend;\r\n\r\nfunction TControl.CanFocus: Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TControl.CanShowFocus: boolean;\r\nbegin\r\n  Result := FShowFocus;\r\nend;\r\n\r\nprocedure TControl.Capture;\r\nbegin\r\n  FCaptureDown := True;\r\n  window.setTimeout(@StartCapture, 100);\r\nend;\r\n\r\nprocedure TControl.StartCapture;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  if not FCaptureDown then\r\n    Exit;\r\n\r\n  if Captured then\r\n    ReleaseCapture;\r\n\r\n  FMouseInsideLayer := true;\r\n\r\n  FLayer := document.createElement('SPAN');\r\n  document.body.appendChild(FLayer);\r\n\r\n  eh := TJSHTMLElement(FLayer);\r\n  eh.addEventListener('mouseenter', FLayerMouseEnterPtr);\r\n  eh.addEventListener('mouseleave', FLayerMouseLeavePtr);\r\n  eh.addEventListener('mousedown', FMouseDownPtr);\r\n  eh.addEventListener('mouseup', FMouseUpPtr);\r\n  eh.addEventListener('mousemove', FMouseMovePtr);\r\n  eh.addEventListener('touchstart', FTouchStartPtr);\r\n  eh.addEventListener('touchmove', FTouchMovePtr);\r\n  eh.addEventListener('touchend', FTouchEndPtr);\r\n  eh.addEventListener('touchcancel', FTouchCancelPtr);\r\n\r\n  eh.style.setProperty('top', '0');\r\n  eh.style.setProperty('left', '0');\r\n  eh.style.setProperty('right', '0');\r\n  eh.style.setProperty('bottom', '0');\r\n\r\n  eh.style.setProperty('webkit-user-select', 'none');\r\n  eh.style.setProperty('moz-user-select', 'none');\r\n  eh.style.setProperty('khtml-user-select', 'none');\r\n  eh.style.setProperty('ms-user-select', 'none');\r\n  eh.style.setProperty('user-select', 'none');\r\n  eh.style.setProperty('position', 'absolute');\r\n\r\n  eh.style.setProperty(CSSZIndex, '999999');\r\n\r\n  FCaptured := True;\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TControl.Captured: Boolean;\r\nbegin\r\n  Result := FCaptured and Assigned(FLayer);\r\nend;\r\n\r\nprocedure TControl.ClearChildElements;\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  if not Assigned(ElementHandle) then\r\n    Exit;\r\n\r\n  while ElementHandle.childElementCount > 0 do\r\n  begin\r\n    el := TJSElement(ElementHandle.firstChild);\r\n    ElementHandle.removeChild(el);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.ClearControls;\r\nbegin\r\n  SetLength(FControls, 0);\r\nend;\r\n\r\nprocedure TControl.Click;\r\nbegin\r\n  if Assigned(OnClick) and IsEnabled then\r\n    OnClick(Self);\r\nend;\r\n\r\nfunction TControl.ClientToScreen(const Point: TPoint): TPoint;\r\nvar\r\n  Origin: TPoint;\r\nbegin\r\n  Origin := ClientOrigin;\r\n  Result.X := Point.X + Origin.X;\r\n  Result.Y := Point.Y + Origin.Y;\r\nend;\r\n\r\nprocedure TControl.ColorChanging;\r\nbegin\r\n\r\nend;\r\n\r\nfunction TControl.ContainerElement: TJSElement;\r\nbegin\r\n  Result := document.body;\r\nend;\r\n\r\nfunction TControl.RequiredBaseURL: string;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nprocedure TControl.RequiredScriptLoaded(Event: TJSEvent);\r\nbegin\r\n  (Event.Target as TJSHTMLScriptElement).Title := 'tmswebloaded';\r\n  inc(FControlScriptCountLoaded);\r\nend;\r\n\r\nconstructor TControl.Create(AOwner: TComponent);\r\nvar\r\n  lName: string;\r\n  frm: TCustomForm;\r\n  lDesign: boolean;\r\n\r\nbegin\r\n  FGotFocus := false;\r\n  FEventsBound := false;\r\n  FTabStop := true;\r\n  FAllowTouch := true;\r\n  FNoUserSelect := true;\r\n  ClearMethodPointers;\r\n\r\n  inherited Create(AOwner);\r\n\r\n  EventStopPropagation := [eeClick, eeDblClick, eeMouseUp, eeMouseMove, eeMouseDown, eeKeypress, eeKeyDown, eeKeyUp];\r\n\r\n  FScriptLoaded := false;\r\n  FElementFont := efProperty;\r\n  FElementPosition := epAbsolute;\r\n  FParentElement := nil;\r\n  FTextDirection := tdDefault;\r\n\r\n  lDesign := false;\r\n\r\n  frm := GetParentForm(Self);\r\n  if Assigned(frm) then\r\n  begin\r\n    lDesign := (csDesigning in frm.ComponentState);\r\n  end;\r\n\r\n  lName := GetNewName;\r\n\r\n  // for VSC, when creating control, initialize without ID\r\n  if lDesign then\r\n    CreateWithID('')\r\n  else\r\n    CreateWithID(lName);\r\n\r\n  if Assigned(AOwner) and not (csDesigning in AOwner.ComponentState) then\r\n    Name := lName;\r\nend;\r\n\r\n\r\nprocedure TControl.CreateControl;\r\nbegin\r\n  if not Assigned(FElement) then\r\n  begin\r\n    FElement := CreateElement;\r\n\r\n    if Assigned(FElement) then\r\n    begin\r\n      FControlCreated := True;\r\n      Container := FElement;\r\n      if not (ElementID = 'body') then\r\n        Container['id'] := ElementID;\r\n      Container['zindex'] := '0';\r\n      if FElementClassName <> '' then\r\n        Container['class'] := FElementClassName;\r\n      CreateChildElements(FElement);\r\n\r\n      BindEvents;\r\n      UpdateElement;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nprocedure TControl.CreateChildElements(AContainer: TJSElement);\r\nbegin\r\nend;\r\n\r\nprocedure TControl.CreateInitialize;\r\nbegin\r\n  FRequiredScripts := TStringList.Create;\r\n  FOrigRect := Rect(-1,-1,-1,-1);\r\n  FClipChildren := True;\r\nend;\r\n\r\nprocedure TControl.CreateWithID(AID: string);\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  ClearMethodPointers;\r\n\r\n  FUpdateCount := 0;\r\n\r\n  FControlCreated := False;\r\n  FLinkTouchEvents := True;\r\n  FIsResizing := false;\r\n\r\n  if (Assigned(Owner) and (csLoading in Owner.ComponentState)) or not Assigned(Owner) then\r\n  begin\r\n    if not (Assigned(Owner) and (csDesigning in Owner.ComponentState)) then\r\n      Loading;\r\n  end;\r\n\r\n  FElementPosition := epAbsolute;\r\n  FWidthStyle := ssAbsolute;\r\n  FHeightStyle := ssAbsolute;\r\n\r\n  el := document.getElementByID(AID);\r\n\r\n  FNew := not Assigned(el);\r\n\r\n  FFont := TFont.Create;\r\n  FFont.OnChange := HandleFontChanged;\r\n\r\n  // the HTML element is not found\r\n  if FNew then\r\n  begin\r\n    Container := nil;\r\n  end\r\n  else\r\n  begin\r\n    Container := el;\r\n    FControlCreated := true;\r\n    FElementPosition := epRelative;\r\n    CreateChildElements(el);\r\n    BindElement;\r\n    BindEvents;\r\n  end;\r\n\r\n  FID := AID;\r\n  FEnabled := True;\r\n  FVisible := True;\r\n  FLeft := 0;\r\n  FTop := 0;\r\n  FAlign := alNone;\r\n  FAlignWithMargins := false;\r\n  FIsAligning := false;\r\n  FParentFont := true;\r\n  FParentBiDiMode := true;\r\n  FParentColor := false;\r\n  FAnchors := [akLeft, akTop];\r\n  FShowFocus := false;\r\n  FBorderWidth := 0;\r\n  FEnablePropagation := False;\r\n  FToolTip := nil;\r\n\r\n  FColor := clWindow;\r\n\r\n  FMargins := TMargins.Create;\r\n  FMargins.OnChange := DoMarginsChanged;\r\n\r\n  FParent := nil;\r\n  FPrevParent := nil;\r\n\r\n  // Issue with Visual Studio Code design-time assigning ElementID for conntrols with childs\r\n  if not (csAcceptsControls in ControlStyle) then\r\n    ClearControls;\r\n\r\n  CreateInitialize;\r\nend;\r\n\r\nprocedure TControl.BindElement;\r\nbegin\r\nend;\r\n\r\nprocedure TControl.AddControlLink(const linkid, link: string);\r\nbegin\r\n  {$IFDEF PAS2JS}\r\n  asm\r\n    function writeLinkOnce(linkName, linkText) {\r\n        var linkElement = document.getElementById(linkName);\r\n        if (linkElement)\r\n          return;\r\n        linkElement = document.createElement('link');\r\n        linkElement.id = linkName;\r\n        linkElement.setAttribute('rel', 'stylesheet');\r\n        linkElement.setAttribute('type', 'text/css');\r\n        linkElement.setAttribute('href', linkText);\r\n        document.getElementsByTagName('head')[0].appendChild(linkElement);\r\n    }\r\n    writeLinkOnce(linkid,link);\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\n\r\n{$HINTS OFF}\r\nprocedure TControl.AddControlScriptLink(const link: string);\r\nvar\r\n  id: string;\r\n  script: TJSHTMLScriptElement;\r\n\r\nbegin\r\n  id := ClassName;\r\n\r\n  if not Assigned(document.getElementById(id)) then\r\n  begin\r\n    script := TJSHTMLScriptElement(document.createElement('script'));\r\n    script.id := id;\r\n    script.src := link;\r\n    script.type_ := 'text/javascript';\r\n    document.head.appendChild(script);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.AddControlScriptSource(const source: string);\r\nvar\r\n  id: string;\r\n  script: TJSHTMLScriptElement;\r\n\r\nbegin\r\n  id := ClassName+'SRC';\r\n\r\n  if not Assigned(document.getElementById(id)) then\r\n  begin\r\n    script := TJSHTMLScriptElement(document.createElement('script'));\r\n    script.id := id;\r\n    script.innerHTML := source;\r\n    script.type_ := 'text/javascript';\r\n    document.head.appendChild(script);\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TControl.AddControlStyle(const css: string);\r\nvar\r\n  cssname: string;\r\nbegin\r\n  cssname := ClassName;\r\n  {$IFDEF PAS2JS}\r\n  asm\r\n    function writeStylesOnce(styleName, cssText) {\r\n        var styleElement = document.getElementById(styleName);\r\n        if (styleElement) {\r\n             styleElement.innerHTML = cssText;\r\n          return;\r\n          }\r\n        styleElement = document.createElement('style');\r\n        styleElement.type = 'text/css';\r\n        styleElement.id = styleName;\r\n        styleElement.innerHTML = cssText;\r\n        document.getElementsByTagName('head')[0].appendChild(styleElement);\r\n    }\r\n    writeStylesOnce(cssname,css);\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nclass procedure TControl.AddInstanceStyle(const id: string; const css: string);\r\nbegin\r\n  {$IFDEF PAS2JS}\r\n  asm\r\n    function writeStylesOnce(styleName, cssText) {\r\n        var styleElement = document.getElementById(styleName);\r\n        if (styleElement) {\r\n          styleElement.innerHTML = cssText;\r\n          return;\r\n          }\r\n        styleElement = document.createElement('style');\r\n        styleElement.type = 'text/css';\r\n        styleElement.id = styleName;\r\n        styleElement.innerHTML = cssText;\r\n        document.getElementsByTagName('head')[0].appendChild(styleElement);\r\n    }\r\n    writeStylesOnce(id,css);\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TControl.AddInstanceStyle(const css: string);\r\nvar\r\n  cssname: string;\r\nbegin\r\n  cssname := Name + '_style';\r\n  AddInstanceStyle(cssname, css);\r\nend;\r\n\r\nprocedure TControl.AddRequiredScript(const link: string);\r\nvar\r\n  id: string;\r\n  script: TJSHTMLScriptElement;\r\n\r\nbegin\r\n  script := TJSHTMLScriptElement(document.createElement('script'));\r\n  script.src := link;\r\n  script.type_ := 'text/javascript';\r\n  script.title := 'tmswebloading';\r\n\r\n  if not Assigned(FScriptLoadedPtr) then\r\n    FScriptLoadedPtr := @RequiredScriptLoaded;\r\n\r\n  script.addEventListener('load', FScriptLoadedPtr);\r\n  document.head.appendChild(script);\r\nend;\r\n\r\nfunction TControl.AddRequiredScripts: boolean;\r\nvar\r\n  i,j: integer;\r\n  el: TJSElement;\r\n  scr: TJSHTMLScriptElement;\r\n  found, loading: boolean;\r\nbegin\r\n  FControlScriptCount := 0;\r\n\r\n  for j := 0 to RequiredScripts.Count - 1 do\r\n  begin\r\n    found := false;\r\n    loading := false;\r\n\r\n    for i := 0 to document.head.children.length - 1 do\r\n    begin\r\n      el := TJSElement(document.head.children[i]);\r\n      if (el.tagName = 'SCRIPT') then\r\n      begin\r\n        scr := TJSHTMLScriptElement(el);\r\n        if (pos(RequiredScripts[j], scr.src) > 0) then\r\n        begin\r\n          found := true;\r\n\r\n          if scr.title = 'tmswebloading' then\r\n          begin\r\n            loading := true;\r\n            if not Assigned(FScriptLoadedPtr) then\r\n              FScriptLoadedPtr := @RequiredScriptLoaded;\r\n            scr.addEventListener('load', FScriptLoadedPtr);\r\n          end;\r\n\r\n          break;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if not found then\r\n    begin\r\n      inc(FControlScriptCount);\r\n      AddRequiredScript( RequiredBaseURL + RequiredScripts[j]);\r\n    end;\r\n\r\n    if found and loading then\r\n      inc(FControlScriptCount);\r\n  end;\r\n\r\n  Result := (FControlScriptCount > 0);\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nprocedure TControl.AlignControl(AControl: TControl);\r\nvar\r\n  r: TRect;\r\n  cr: TJSDOMRect;\r\n  ovf, ovfx, ovfy: string;\r\n  eh: TJSHTMLElement;\r\n  el: TJSElement;\r\n  frm: TCustomForm;\r\n  ctop: integer;\r\n  vscrl: integer;\r\n\r\nbegin\r\n  if FIsAligning then\r\n    Exit;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if csLoading in ComponentState then\r\n    Exit;\r\n\r\n//  if not Visible then\r\n//    Exit;\r\n\r\n  if Assigned(Parent) and not Parent.Visible then\r\n    Exit;\r\n\r\n  frm := GetParentForm(Self);\r\n\r\n  if Assigned(frm) and frm.IsUpdating then\r\n    Exit;\r\n\r\n  ctop := 0;\r\n\r\n  if Assigned(frm) and (frm.FormContainer <> '') and (AControl is TCustomForm) then\r\n  begin\r\n    el := document.getElementById(frm.FormContainer);\r\n    if Assigned(el) then\r\n    begin\r\n      cr := el.getBoundingClientRect;\r\n      ctop := Round(cr.Top + 1);\r\n    end;\r\n  end;\r\n\r\n  FIsAligning := true;\r\n\r\n  if not Assigned(AControl) then\r\n    Exit;\r\n\r\n  eh := AControl.ElementHandle;\r\n\r\n  if Assigned(eh) then\r\n  begin\r\n    ovf := AControl.GetElementStyle.getPropertyValue('overflow');\r\n    ovfx := AControl.GetElementStyle.getPropertyValue('overflow-x');\r\n    ovfy := AControl.GetElementStyle.getPropertyValue('overflow-y');\r\n\r\n    if ClipChildren and (LowerCase(eh.tagName) <> cBodyTag) then\r\n      AControl.GetElementStyle.setProperty('overflow', 'hidden')\r\n    else\r\n      AControl.GetElementStyle.setProperty('overflow', '');\r\n  end;\r\n\r\n  r := GetClientRect;\r\n  // when it concerns a control linked to an element, need to get the element bounding rect here\r\n  if IsLinked then\r\n  begin\r\n    cr := ElementHandle.getBoundingClientRect;\r\n    // get the real dimensions of the control, it will be absolutely positioned taking the elements\r\n    // real top,left in account in SetBoundsInt()\r\n    r := Rect(0, 0, Round(cr.Right - cr.Left), Round(cr.Bottom - cr.Top));\r\n  end;\r\n\r\n  // limit size except when it is absolute positioned & has fixed height\r\n  if (r.Bottom + ctop > WinHeight) and (HeightStyle <> ssAbsolute) and not (ElementPosition = epAbsolute) and not IsLinked and not Assigned(VSIDE) then\r\n  begin\r\n    if (Assigned(Parent) and (Parent is TCustomForm)) or (Self is TCustomForm) then\r\n    begin\r\n      r.Bottom := WinHeight - ctop;\r\n    end;\r\n  end;\r\n\r\n  if Assigned(eh) and (eh.tagName = 'BODY') then\r\n  begin\r\n    vscrl := 0;\r\n\r\n    if (document.body.scrollHeight > document.body.clientHeight) and not (csDesigning in ComponentState) then\r\n      vscrl := 16;\r\n\r\n    if frm.FormContainer <> '' then\r\n    begin\r\n      r.Bottom := Round(Min(r.Bottom , WinHeight));\r\n      r.Right := Round(Min(r.Right - vscrl, WinWidth));\r\n    end\r\n    else\r\n    begin\r\n      r.Bottom := frm.Height;\r\n      r.Right := frm.Width;\r\n    end;\r\n  end;\r\n\r\n  // limit size to browser window size anyway\r\n  if (AControl is TCustomForm) and not Assigned(VSIDE) then\r\n  begin\r\n    if r.Bottom > WinHeight then\r\n      r.Bottom := WinHeight;\r\n\r\n    if r.Right > WinWidth then\r\n      r.Right := WinWidth;\r\n  end;\r\n\r\n  if AControl.IsStructuralElement then\r\n  begin\r\n    r := Parent.GetClientRect;\r\n  end;\r\n\r\n  AlignControls(AControl, r);\r\n\r\n  if Assigned(eh) then\r\n  begin\r\n    AControl.GetElementStyle.setProperty('overflow', ovf);\r\n    AControl.GetElementStyle.setProperty('overflow-x', ovfx);\r\n    AControl.GetElementStyle.setProperty('overflow-y', ovfy);\r\n  end;\r\n\r\n  FIsAligning := false;\r\nend;\r\n\r\nprocedure TControl.DblClick;\r\nbegin\r\n  if Assigned(OnDblClick) then\r\n    OnDblClick(Self);\r\nend;\r\n\r\ndestructor TControl.Destroy;\r\nbegin\r\n  UnbindEvents;\r\n  DestroyControls;\r\n\r\n  if Assigned(Container) and Assigned(Parent) and Assigned(Parent.GetChildContainer) then\r\n  begin\r\n    if Parent.GetChildContainer = Container.parentNode then\r\n    begin\r\n      Parent.GetChildContainer.removeChild(Container);\r\n    end;\r\n\r\n    Container := nil;\r\n    Parent := nil;\r\n    FControlCreated := False;\r\n  end;\r\n\r\n  FRequiredScripts.Free;\r\n  FMargins.Free;\r\n  FFont.Free;\r\n\r\n  if Assigned(FToolTip) then\r\n  begin\r\n    {$IFDEF PAS2JS}\r\n    asm\r\n      FToolTip.dispose();\r\n    end;\r\n    {$ENDIF}\r\n    FToolTip := nil;\r\n  end;\r\n\r\n  inherited;\r\nend;\r\n\r\nprocedure TControl.DestroyControls;\r\nvar\r\n  i: integer;\r\n  ctrl: TControl;\r\nbegin\r\n  for i := ControlCount - 1 downto 0 do\r\n  begin\r\n    ctrl := Controls[i];\r\n    ctrl.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.DisableDrag;\r\nbegin\r\n  if Assigned(Container) and (Container['draggable'] = 'true') then\r\n    Container['draggable'] := 'false';\r\nend;\r\n\r\nprocedure TControl.DisableTab;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if not (TabStop and CanFocus) then\r\n  begin\r\n    if Assigned(Container) then\r\n      Container.setAttribute('tabindex','-1');\r\n  end;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    Controls[i].DisableTab;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.DisposeOf;\r\nvar\r\n  t: TControl;\r\nbegin\r\n  t := Self;\r\n  t.Free;\r\nend;\r\n\r\nprocedure TControl.Assign(Source: TPersistent);\r\nbegin\r\n\r\nend;\r\n\r\nfunction TControl.GetElement: TJSElement;\r\nbegin\r\n  Result := document.getElementByID(GetID);\r\nend;\r\n\r\nfunction TControl.GetElementBindHandle: TJSEventTarget;\r\nbegin\r\n  Result := TJSEventTarget(GetElementHandle);\r\nend;\r\n\r\nfunction TControl.GetElementEvent: TJSEvent;\r\nbegin\r\n  Result := FElementEvent;\r\nend;\r\n\r\nprocedure TControl.SetEnabled(Value: Boolean);\r\nbegin\r\n  if (FEnabled <> Value) then\r\n  begin\r\n    FEnabled := Value;\r\n    UpdateElementData;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetVisible(AValue: Boolean);\r\nbegin\r\n  if (FVisible <> AValue) then\r\n  begin\r\n    VisibleChanging;\r\n    FVisible := AValue;\r\n    UpdateElement;\r\n    DoRealign;\r\n    AlignControl(Self);\r\n    VisibleChanged;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetWidth(AValue: Integer);\r\nbegin\r\n  if (FWidth <> AValue) then\r\n  begin\r\n    FWidth := AValue;\r\n\r\n    ResetAnchoring;\r\n    DoBoundsChange;\r\n\r\n    // still do element height updating at runtime\r\n    if IsLinked and not IsUpdating and Assigned(ElementHandle) then\r\n    begin\r\n      if AValue >= 0 then\r\n        GetElementStyle.setProperty('width',IntTostr(AValue)+'px')\r\n      else\r\n        GetElementStyle.removeProperty('width');\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetWidthInt(AValue: Integer);\r\nbegin\r\n  FWidth := AValue;\r\nend;\r\n\r\nprocedure TControl.SetWidthPercent(const Value: TPercentSize);\r\nbegin\r\n  if (FWidthPercent <> Value) then\r\n  begin\r\n    FWidthPercent := Value;\r\n    UpdateElementSize;\r\n    ResetAnchoring;\r\n    DoBoundsChange;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetWidthStyle(const Value: TSizeStyle);\r\nbegin\r\n  if (FWidthStyle <> Value) then\r\n  begin\r\n    FWidthStyle := Value;\r\n\r\n    if (FWidthStyle = ssAuto) and Assigned(ElementHandle) then\r\n      GetElementStyle.removeProperty('width');\r\n\r\n    UpdateElementSize;\r\n    ResetAnchoring;\r\n    DoBoundsChange;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.Show;\r\nbegin\r\n  Visible := true;\r\nend;\r\n\r\nprocedure TControl.StopPropagation;\r\nbegin\r\n  if Assigned(ElementEvent) and not EnablePropagation then\r\n    ElementEvent.stopPropagation;\r\nend;\r\n\r\nprocedure TControl.TouchCancel(X, Y: Integer);\r\nbegin\r\n  if Assigned(OnTouchCancel) then\r\n    OnTouchCancel(Self, X, Y);\r\nend;\r\n\r\nprocedure TControl.TouchEnd(X, Y: Integer);\r\nbegin\r\n  if Assigned(OnTouchEnd) then\r\n    OnTouchEnd(Self, X, Y);\r\nend;\r\n\r\nprocedure TControl.TouchMove(X, Y: Integer);\r\nbegin\r\n  if Assigned(OnTouchMove) then\r\n    OnTouchMove(Self, X, Y);\r\nend;\r\n\r\nprocedure TControl.TouchStart(X, Y: Integer);\r\nbegin\r\n  if Assigned(OnTouchStart) then\r\n    OnTouchStart(Self, X, Y);\r\nend;\r\n\r\nprocedure TControl.SetHeight(AValue: Integer);\r\nvar\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if FHeight <> AValue then\r\n  begin\r\n    if (Align in [alLeft, alRight, alClient]) and Assigned(ElementHandle) then\r\n    begin\r\n      dr := ElementHandle.getBoundingClientRect;\r\n      if dr.top + AValue >= WinHeight then\r\n      begin\r\n        AValue := Round(WinHeight - dr.top);\r\n      end;\r\n    end;\r\n\r\n    FHeight := AValue;\r\n\r\n    ResetAnchoring;\r\n    DoBoundsChange;\r\n\r\n    // still do element height updating at runtime\r\n    if IsLinked and not IsUpdating and Assigned(ElementHandle) then\r\n    begin\r\n      if AValue >= 0 then\r\n        GetElementStyle.setProperty('height',IntTostr(AValue)+'px')\r\n      else\r\n        GetElementStyle.removeProperty('height');\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetHeightInt(AValue: Integer);\r\nbegin\r\n  FHeight := AValue;\r\nend;\r\n\r\nprocedure TControl.SetHeightPercent(const Value: TPercentSize);\r\nbegin\r\n  if (FHeightPercent <> Value) then\r\n  begin\r\n    FHeightPercent := Value;\r\n    UpdateElementSize;\r\n    ResetAnchoring;\r\n    DoBoundsChange;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetHeightStyle(const Value: TSizeStyle);\r\nbegin\r\n  if (FHeightStyle <> Value) then\r\n  begin\r\n    FHeightStyle := Value;\r\n\r\n    if (FHeightStyle = ssAuto) and Assigned(ElementHandle) then\r\n      GetElementStyle.removeProperty('height');\r\n\r\n    UpdateElementSize;\r\n    ResetAnchoring;\r\n    DoBoundsChange;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetLeft(AValue: Integer);\r\nbegin\r\n  if FLeft <> AValue then\r\n  begin\r\n    FLeft := AValue;\r\n\r\n    ResetAnchoring;\r\n\r\n    if not FUpdateTopLeft then\r\n      FOrigLeft := AValue;\r\n\r\n    UpdateElementSize;\r\n    RecreateCanvas;\r\n    InternalResize;\r\n\r\n    if not (csLoading in ComponentState) and (Align <> alNone) and Assigned(Parent) then\r\n    begin\r\n      DoRealign;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetMargins(const Value: TMargins);\r\nbegin\r\n  FMargins.Assign(Value);\r\nend;\r\n\r\nprocedure TControl.SetTop(AValue: Integer);\r\nbegin\r\n  if FTop <> AValue then\r\n  begin\r\n    FTop := AValue;\r\n\r\n    ResetAnchoring;\r\n\r\n    if not FUpdateTopLeft then\r\n      FOrigTop := AValue;\r\n\r\n    UpdateElementSize;\r\n    RecreateCanvas;\r\n    InternalResize;\r\n\r\n    if not (csLoading in ComponentState) and (Align <> alNone) and Assigned(Parent) then\r\n    begin\r\n      DoRealign;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetScriptLoaded(const Value: boolean);\r\nbegin\r\n  FScriptLoaded := Value;\r\nend;\r\n\r\nprocedure TControl.SetShowFocus(const Value: boolean);\r\nbegin\r\n  if (FShowFocus <> Value) then\r\n  begin\r\n    FShowFocus := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetShowHint(AValue: Boolean);\r\nbegin\r\n  if FShowHint <> AValue then\r\n  begin\r\n    FShowHint := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetHint(AValue: string);\r\nbegin\r\n  if FHint <> AValue then\r\n  begin\r\n    FHint := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TControl.SetID(const Value: string);\r\nvar\r\n  eh,el,tmp: TJSElement;\r\n  frm: TCustomForm;\r\n  p: TComponent;\r\n  l,t,w,h: integer;\r\n\r\nbegin\r\n  // it was a new created control and now going to be a HTML element wrapper\r\n\r\n  if FNew and (FID <> Value) then\r\n  begin\r\n    // switch to template element - so find it\r\n    eh := document.getElementById(Value);\r\n    if Assigned(eh) then\r\n    begin\r\n      l := FLeft;\r\n      t := FTop;\r\n      w := FWidth;\r\n      h := FHeight;\r\n      tmp := nil;\r\n\r\n      // unbind event handlers from created control\r\n      UnbindEvents;\r\n\r\n      if Assigned(FContainer) then\r\n      begin\r\n        // remember previous HTML parent element\r\n        FParentElement := TJSHTMLElement(FContainer.parentElement);\r\n\r\n        // move child elements from current control to HTML element\r\n        tmp := document.createElement('SPAN');\r\n        MoveElements(FContainer, tmp);\r\n      end;\r\n\r\n      p := Parent;\r\n\r\n      // remove created control\r\n      Parent := nil;\r\n\r\n      // create wrapper for HTML element\r\n      CreateWithID(Value);\r\n\r\n      // add it back as child\r\n      SetParentComponent(p);\r\n\r\n      FID := Value;\r\n\r\n      FWidth := w;\r\n      FHeight := h;\r\n\r\n      // perform update to set wrapper properties to HTML element\r\n      UpdateElement;\r\n\r\n      // keep Left,Top at design-time for Delphi compatibility\r\n      if (csDesigning in ComponentState) then\r\n      begin\r\n        FLeft := l;\r\n        FTop := t;\r\n      end;\r\n\r\n      if Assigned(tmp) then\r\n        MoveElementsAndFree(tmp, ElementHandle);\r\n\r\n      Exit;\r\n    end;\r\n  end;\r\n\r\n  // it is a wrapped control and now going to be a new created control\r\n  if not FNew and (FID <> Value) then\r\n  begin\r\n    w := FWidth;\r\n    h := FHeight;\r\n    // unbind event handlers from wrapped HTML element\r\n    eh := document.getElementById(FID);\r\n    if Assigned(eh) then\r\n    begin\r\n      // move child elements to temp SPAN\r\n      tmp := document.createElement('SPAN');\r\n      MoveElements(eh, tmp);\r\n      UnbindEvents;\r\n      //DestroyControls;\r\n    end;\r\n\r\n    if (Value <> '') then\r\n    begin\r\n      eh := document.getElementById(Value);\r\n      // wrap another HTML element\r\n      if Assigned(eh) then\r\n      begin\r\n        CreateWithID(Value);\r\n        FID := Value;\r\n        FWidth := w;\r\n        FHeight := h;\r\n        UpdateElement;\r\n\r\n        MoveElementsAndFree(tmp, FContainer);\r\n\r\n        Exit;\r\n      end;\r\n    end;\r\n\r\n    // create new control\r\n    FNew := true;\r\n    FElement := nil;\r\n\r\n    CreateControl;\r\n\r\n    if Value = '' then\r\n    begin\r\n      CreateInitialize;\r\n      FWidth := w;\r\n      FHeight := h;\r\n    end;\r\n\r\n    if Assigned(FParentElement) then\r\n    begin\r\n      FParentElement.appendChild(Container);\r\n    end\r\n    else\r\n      document.body.appendChild(Container);\r\n\r\n    frm := GetParentForm(Self); //Application.ActiveForm;\r\n    if Assigned(frm) then\r\n    begin\r\n      Parent := frm;\r\n      ElementPosition := epAbsolute;\r\n      Left := 0;\r\n      Top := 0;\r\n    end;\r\n\r\n    // move child elements from temp SPAN to new control\r\n    if Assigned(tmp) then\r\n      MoveElementsAndFree(tmp, FContainer);\r\n\r\n    // perform update to set instance properties to control\r\n    UpdateElement;\r\n    UpdateElementSize;\r\n  end;\r\n\r\n  FID := Value;\r\n  if Assigned(FContainer) then\r\n    FContainer['id'] := Value;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TControl.SetTabOrder(AValue: Integer);\r\nbegin\r\n  if FTabOrder <> AValue then\r\n  begin\r\n    FTabOrder := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetTabStop(AValue: Boolean);\r\nbegin\r\n  if FTabStop <> AValue then\r\n  begin\r\n    FTabStop := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nfunction TControl.SaveState: string;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nfunction TControl.ScreenToClient(const Point: TPoint): TPoint;\r\nvar\r\n  Origin: TPoint;\r\nbegin\r\n  Origin := ClientOrigin;\r\n  Result.X := Point.X - Origin.X;\r\n  Result.Y := Point.Y - Origin.Y;\r\nend;\r\n\r\nprocedure TControl.SendToBack;\r\nbegin\r\n  if Assigned(ElementHandle) and Assigned(ElementHandle.parentElement) then\r\n  begin\r\n    ElementHandle.parentElement.insertBefore(ElementHandle, ElementHandle.parentElement.firstElementChild);\r\n    //if not ((ElementPosition <> epAbsolute) or IsLinked) then\r\n    //  ElementHandle.style.setProperty(CSSZIndex, '0');\r\n\r\n    if Assigned(Parent) then\r\n      Parent.MoveFirst(Self);\r\n  end\r\nend;\r\n\r\n\r\nprocedure TControl.BeginDrag;\r\nbegin\r\n  EnableDrag;\r\nend;\r\n\r\nprocedure TControl.BeginUpdate;\r\nbegin\r\n  inc(FUpdateCount);\r\nend;\r\n\r\nprocedure TControl.Invalidate;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.EnableDrag;\r\nbegin\r\n  if Assigned(Container) then\r\n    Container['draggable'] := 'true';\r\nend;\r\n\r\nprocedure TControl.EnableTab;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if Assigned(FContainer) and not IsLinked then\r\n  begin\r\n    if TabStop and CanFocus then\r\n    begin\r\n      FContainer['tabindex'] := IntToStr(TabOrder + 1)\r\n    end\r\n    else\r\n    begin\r\n      FContainer['tabindex'] := '-1';\r\n    end;\r\n  end;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    Controls[i].EnableTab;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.EndUpdate;\r\nbegin\r\n  if (FUpdateCount > 0) then\r\n  begin\r\n    dec(FUpdateCount);\r\n\r\n    if FUpdateCount = 0 then\r\n      UpdateElement;\r\n  end;\r\nend;\r\n\r\nfunction TControl.EventsBound: boolean;\r\nbegin\r\n  Result := FEventsBound;\r\nend;\r\n\r\nfunction TControl.IsUpdating: boolean;\r\nbegin\r\n  Result := FUpdateCount > 0;\r\nend;\r\n\r\nprocedure TControl.SetAlign(const Value: TAlign);\r\nbegin\r\n  if FAlign <> Value then\r\n  begin\r\n    FAlign := Value;\r\n    DoRealign;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetAlignWithMargins(const Value: boolean);\r\nbegin\r\n  if FAlignWithMargins <> Value then\r\n  begin\r\n    FAlignWithMargins := Value;\r\n    DoRealign;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetBiDiMode(const Value: TBiDiMode);\r\nbegin\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if (Value = bdLeftToRight) then\r\n      ElementHandle.removeAttribute('dir')\r\n    else\r\n      ElementHandle.setAttribute('dir','rtl');\r\n  end;\r\nend;\r\n\r\nprocedure TControl.DoMarginsChanged(Sender: TObject);\r\nbegin\r\n  DoRealign;\r\nend;\r\n\r\nprocedure TControl.DoRealign;\r\nbegin\r\n  if Assigned(Parent) and not Parent.IsUpdating then\r\n  begin\r\n    Parent.AlignControl(Parent);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetAnchors(const Value: TAnchors);\r\nbegin\r\n  if (FAnchors <> Value) then\r\n  begin\r\n    FAnchors := Value;\r\n    if not (csLoading in ComponentState) then\r\n    begin\r\n      UpdateAnchoring;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetBorderWidth(const Value: integer);\r\nbegin\r\n  if (FBorderWidth <> Value) then\r\n  begin\r\n    FBorderWidth := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetBoundsInt(X, Y, AWidth, AHeight: Integer);\r\nbegin\r\n  if (X <> Left) or (Y <> Top) or ((AWidth <> Width) and (WidthStyle = ssAbsolute)) or ((AHeight <> Height) and (HeightStyle = ssAbsolute)) or\r\n    (Assigned(Parent) and Parent.isLinked) then\r\n  begin\r\n    FBlockUpdateElement := True;\r\n    FLeft := X;\r\n    FTop := Y;\r\n\r\n    FWidth := AWidth;\r\n    FHeight := AHeight;\r\n\r\n    FBlockUpdateElement := False;\r\n\r\n    UpdateElementSize;\r\n\r\n    if Align <> alNone then\r\n      DoRealign\r\n    else\r\n      Realign;\r\n\r\n    RecreateCanvas;\r\n\r\n    DoBoundsChange;\r\n    Invalidate;\r\n    UpdateChildAnchoring;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetBounds(X, Y, AWidth, AHeight: Integer);\r\nbegin\r\n  SetBoundsInt(X, Y, AWidth, AHeight);\r\n  FWidth := AWidth;\r\n  FHeight := AHeight;\r\n\r\n  if not FUpdateTopLeft then\r\n  begin\r\n    FOrigTop := Y;\r\n    FOrigLeft := X;\r\n  end;\r\n\r\n  ResetAnchoring;\r\n\r\n  if not (csLoading in ComponentState) and (Align <> alNone) and Assigned(Parent) then\r\n  begin\r\n    DoRealign;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetBoundsRect(const Value: TRect);\r\nbegin\r\n  SetBoundsInt(Value.Left, Value.Top, Value.Right - Value.Left, Value.Bottom - Value.Top);\r\nend;\r\n\r\nprocedure TControl.SetElementClassName(AValue: string);\r\nbegin\r\n  if (FElementClassName <> AValue) then\r\n  begin\r\n    FElementClassName := AValue;\r\n    if Assigned(FContainer) then\r\n      FContainer['class'] := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetElementColor(AElement: TJSHTMLElement; AColor: TColor);\r\nvar\r\n  noCSS: boolean;\r\nbegin\r\n  noCSS := (not Application.Themed and not (ElementClassName <> ''));\r\n\r\n  if not IsLinked then\r\n    SetHTMLElementColor(AElement, AColor, not noCSS);\r\nend;\r\n\r\nprocedure TControl.SetElementFont(const Value: TElementFont);\r\nbegin\r\n  if (FElementFont <> Value) then\r\n  begin\r\n    FElementFont := Value;\r\n    UpdateElementVisual;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetElementPointer(AElement: TJSHTMLElement;\r\n  ACursor: TCursor);\r\nbegin\r\n  if ACursor <> crDefault then\r\n    AElement.style.setProperty('cursor', GetHTMLCursorName(ACursor))\r\n  else\r\n    AElement.style.removeProperty('cursor');\r\nend;\r\n\r\nprocedure TControl.SetElementPosition(const Value: TElementPosition);\r\nbegin\r\n  if (FElementPosition <> Value) then\r\n  begin\r\n    FElementPosition := Value;\r\n    if Assigned(ElementHandle) then\r\n    begin\r\n      UpdateElementSize;\r\n      RecreateCanvas;\r\n      InternalResize;\r\n    end;\r\n  end;\r\nend;\r\n\r\n\r\n{$HINTS OFF}\r\nprocedure TControl.SetFocus;\r\nvar\r\n  e: TJSHTMLElement;\r\nbegin\r\n  if not CanFocus then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    e := ElementHandle;\r\n    if FGotFocus then\r\n    begin\r\n      {$IFDEF PAS2JS}\r\n      asm\r\n        e.focus();\r\n      end;\r\n      {$ENDIF}\r\n    end\r\n    else\r\n    begin\r\n      {$IFDEF PAS2JS}\r\n      asm\r\n        setTimeout(function() {e.focus();}, 1);\r\n      end;\r\n      {$ENDIF}\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TControl.SetFont(AValue: TFont);\r\nbegin\r\n  FFont.Name := AValue.Name;\r\n  FFont.Size := AValue.Size;\r\n  FFont.Style := AValue.Style;\r\n  FFont.Color := AValue.Color;\r\nend;\r\n\r\nprocedure TControl.SetChildOrderEx(const Value: integer);\r\nbegin\r\n  FChildOrder := Value;\r\nend;\r\n\r\nprocedure TControl.SetClientHeight(const Value: Integer);\r\nbegin\r\n  Height := Value;\r\nend;\r\n\r\nprocedure TControl.SetClientWidth(const Value: Integer);\r\nbegin\r\n  Width := Value;\r\nend;\r\n\r\nprocedure TControl.SetClipChildren(const Value: Boolean);\r\nbegin\r\n  FClipChildren := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TControl.SetColor(AValue: TColor);\r\nbegin\r\n  FColor := AValue;\r\n  UpdateElementVisual;\r\n  ColorChanging;\r\nend;\r\n\r\nprocedure TControl.SetControlCursor(const Value: TCursor);\r\nbegin\r\n  FCursor := Value;\r\n\r\n  if (ElementClassName = '') and Assigned(ElementHandle) then\r\n  begin\r\n    SetElementPointer(ElementHandle, Value);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetDragMode(const Value: TDragMode);\r\nbegin\r\n  FDragMode := Value;\r\n  if Value = dmAutomatic then\r\n    BeginDrag\r\n  else\r\n    DisableDrag;\r\nend;\r\n\r\nfunction TControl.GetID: string;\r\nbegin\r\n  Result := FID;\r\nend;\r\n\r\nfunction TControl.GetIsLinked: boolean;\r\nbegin\r\n  Result := not FNew;\r\nend;\r\n\r\nfunction TControl.GetElementHandle: TJSHTMLElement;\r\nbegin\r\n  Result := nil;\r\n  if Assigned(FContainer) and FControlCreated then\r\n    Result := TJSHTMLElement(FContainer);\r\nend;\r\n\r\nfunction TControl.GetMouseEventButton(Event: TJSMouseEvent): TMouseButton;\r\nbegin\r\n  Result := mbLeft;\r\n  case Event.button of\r\n    0: Result := mbLeft;\r\n    1: Result := mbMiddle;\r\n    2: Result := mbRight;\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetMouseEventShiftState(Event: TJSMouseEvent): TShiftState;\r\nbegin\r\n  Result := [];\r\n  if Event.shiftKey then\r\n    Result := Result + [ssShift];\r\n\r\n  if Event.ctrlKey then\r\n    Result := Result + [ssCtrl];\r\n\r\n  if Event.altKey then\r\n    Result := Result + [ssAlt];\r\n\r\n  if Event.buttons and 1 = 1 then\r\n     Result := Result + [ssLeft];\r\n\r\n  if Event.buttons and 2 = 2 then\r\n     Result := Result + [ssRight];\r\n\r\n  if Event.buttons and 4 = 4 then\r\n     Result := Result + [ssMiddle];\r\nend;\r\n\r\nfunction TControl.GetMouseWheelEventShiftState(\r\n  Event: TJSWheelEvent): TShiftState;\r\nbegin\r\n  Result := [];\r\n  if Event.shiftKey then\r\n    Result := Result + [ssShift];\r\n  if Event.ctrlKey then\r\n    Result := Result + [ssCtrl];\r\n  if Event.altKey then\r\n    Result := Result + [ssAlt];\r\nend;\r\n\r\nfunction TControl.GetNewName: string;\r\nvar\r\n  s: string;\r\n  lPrefix: string;\r\n  frm: TCustomForm;\r\nbegin\r\n  s := ClassName;\r\n  Delete(s, 1, 1);\r\n\r\n  lPrefix := '';\r\n\r\n  frm := GetParentForm(Self);\r\n  if Assigned(frm) then\r\n    lPrefix := frm.ClassName;\r\n\r\n  Result := lPrefix+'_'+FindUniqueName(s);\r\nend;\r\n\r\nfunction TControl.GetOuterHeight: integer;\r\nbegin\r\n  Result := FHeight - FBorderWidth;\r\nend;\r\n\r\nfunction TControl.GetOuterWidth: integer;\r\nbegin\r\n  Result := FWidth - FBorderWidth;\r\nend;\r\n\r\nfunction TControl.GetRole: string;\r\nbegin\r\n  Result := FRole;\r\n  if Assigned(ElementHandle) then\r\n    Result := ElementHandle.getAttribute('role');\r\nend;\r\n\r\nfunction TControl.GetElementStyle: TJSCSSStyleDeclaration;\r\nbegin\r\n  Result := ElementHandle.style;\r\nend;\r\n\r\nfunction TControl.GetStyle(css: string): string;\r\nvar\r\n  res: string;\r\n  el: TJSElement;\r\nbegin\r\n  el := ElementHandle;\r\n  res := '';\r\n\r\n  if not Assigned(el) then\r\n    Exit;\r\n  {$IFDEF PAS2JS}\r\n  asm\r\n    if (window.getComputedStyle) res = getComputedStyle(el, '')[css];\r\n        if(el.currentStyle) res = el.currentStyle[css];\r\n\r\n  end;\r\n  {$ENDIF}\r\n  Result := res;\r\nend;\r\n\r\nfunction TControl.GetKeyboardEventShiftState(Event: TJSKeyboardEvent): TShiftState;\r\nbegin\r\n  Result := [];\r\n  if Event.shiftKey then\r\n    Result := Result + [ssShift];\r\n  if Event.ctrlKey then\r\n    Result := Result + [ssCtrl];\r\n  if Event.altKey then\r\n    Result := Result + [ssAlt];\r\nend;\r\n\r\nprocedure TControl.ClearMethodPointers;\r\nbegin\r\n  FWheelPtr := nil;\r\n  FClickPtr := nil;\r\n  FDblClickPtr := nil;\r\n  FMouseDownPtr := nil;\r\n  FMouseUpPtr := nil;\r\n  FMouseMovePtr := nil;\r\n  FMouseLeavePtr := nil;\r\n  FMouseEnterPtr := nil;\r\n  FKeyDownPtr := nil;\r\n  FKeyUpPtr := nil;\r\n  FKeypressPtr := nil;\r\n  FInputPtr := nil;\r\n  FEnterPtr := nil;\r\n  FExitPtr := nil;\r\n  FTouchStartPtr := nil;\r\n  FTouchEndPtr := nil;\r\n  FTouchMovePtr := nil;\r\n  FTouchCancelPtr := nil;\r\n  FLayerMouseLeavePtr := nil;\r\n  FLayerMouseEnterPtr := nil;\r\n  FScriptLoadedPtr := nil;\r\n  FContextMenuPtr := nil;\r\nend;\r\n\r\nprocedure TControl.GetMethodPointers;\r\nbegin\r\n  if FWheelPtr = nil then\r\n  begin\r\n    FWheelPtr := @HandleDoWheel;\r\n    FClickPtr := @HandleDoClick;\r\n    FDblClickPtr := @HandleDoDblClick;\r\n    FMouseDownPtr := @HandleDoMouseDown;\r\n    FMouseUpPtr := @HandleDoMouseUp;\r\n    FMouseMovePtr := @HandleDoMouseMove;\r\n    FMouseLeavePtr := @HandleDoMouseLeave;\r\n    FMouseEnterPtr := @HandleDoMouseEnter;\r\n    FKeyDownPtr := @HandleDoKeyDown;\r\n    FKeyUpPtr := @HandleDoKeyUp;\r\n    FKeypressPtr := @HandleDoKeyPress;\r\n    FInputPtr := @HandleDoInput;\r\n    FEnterPtr := @HandleDoEnter;\r\n    FExitPtr := @HandleDoExit;\r\n    FTouchStartPtr := @HandleDoTouchStart;\r\n    FTouchEndPtr := @HandleDoTouchEnd;\r\n    FTouchMovePtr := @HandleDoTouchMove;\r\n    FTouchCancelPtr := @HandleDoTouchCancel;\r\n    FLayerMouseLeavePtr := @LayerHandleDoMouseLeave;\r\n    FLayerMouseEnterPtr := @LayerHandleDoMouseEnter;\r\n    FScriptLoadedPtr := @RequiredScriptLoaded;\r\n    FDragStartPtr := @HandleDoDragStart;\r\n    FDragOverPtr := @HandleDoDragOver;\r\n    FDragEnterPtr := @HandleDoDragEnter;\r\n    FDragLeavePtr := @HandledoDragLeave;\r\n    FDragEndPtr := @HandleDoDragEnd;\r\n    FDragDropPtr := @HandleDoDragDrop;\r\n    FContextMenuPtr := @HandleDoContextMenu;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.BindEvents;\r\nvar\r\n  eh: TJSEventTarget;\r\nbegin\r\n  if Assigned(ElementBindHandle) then\r\n  begin\r\n    GetMethodPointers;\r\n    FEventsBound := true;\r\n    eh := ElementBindHandle;\r\n    eh.addEventListener('wheel', FWheelPtr);\r\n    eh.addEventListener('click', FClickPtr);\r\n    eh.addEventListener('dblclick', FDblClickPtr);\r\n    eh.addEventListener('mousedown', FMouseDownPtr);\r\n    eh.addEventListener('mouseup', FMouseUpPtr);\r\n    eh.addEventListener('mousemove', FMouseMovePtr);\r\n    eh.addEventListener('mouseleave', FMouseLeavePtr);\r\n    eh.addEventListener('mouseenter', FMouseEnterPtr);\r\n    eh.addEventListener('keydown', FKeyDownPtr);\r\n    eh.addEventListener('keyup', FKeyUpPtr);\r\n    eh.addEventListener('keypress', FKeyPressPtr);\r\n    eh.addEventListener('input', FInputPtr);\r\n    eh.addEventListener('focus', FEnterPtr);\r\n    eh.addEventListener('blur', FExitPtr);\r\n\r\n    eh.addEventListener('touchstart', FTouchStartPtr);\r\n    eh.addEventListener('touchmove', FTouchMovePtr);\r\n    eh.addEventListener('touchend', FTouchEndPtr);\r\n    eh.addEventListener('touchcancel', FTouchCancelPtr);\r\n\r\n    eh.addEventListener('contextmenu', FContextMenuPtr);\r\n\r\n    eh.addEventListener('dragstart', FDragStartPtr);\r\n    eh.addEventListener('dragover', FDragOverPtr);\r\n    eh.addEventListener('dragenter', FDragEnterPtr);\r\n    eh.addEventListener('dragleave', FDragLeavePtr);\r\n    eh.addEventListener('dragend', FDragEndPtr);\r\n    eh.addEventListener('drop', FDragDropPtr);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.BringToFront;\r\nbegin\r\n  if Assigned(ElementHandle) and Assigned(ElementHandle.parentElement) then\r\n  begin\r\n    try\r\n      ElementHandle.parentElement.appendChild(ElementHandle);\r\n      if Assigned(Parent) then\r\n        Parent.MoveLast(Self);\r\n    except\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetChildContainer: TJSElement;\r\nbegin\r\n  Result := FContainer;\r\nend;\r\n\r\nprocedure TControl.GetChildren(Proc: TGetChildProc; Root: TComponent);\r\nvar\r\n  I: Integer;\r\n  Control: TControl;\r\nbegin\r\n  for I := 0 to ControlCount - 1 do\r\n  begin\r\n    Control := Controls[I];\r\n    if (Control.Owner = Root) or (Root = nil) then\r\n      Proc(Control);\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetClientHeight: Integer;\r\nbegin\r\n  Result := Height;\r\nend;\r\n\r\nfunction TControl.GetClientOrigin: TPoint;\r\nvar\r\n  r: TJSDomRect;\r\nbegin\r\n  Result := Point(0, 0);\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    r := ElementHandle.getBoundingClientRect;\r\n    Result := Point(Round(r.Left), Round(r.Top));\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetClientRect: TRect;\r\nvar\r\n  css: string;\r\n  p,brdr: integer;\r\nbegin\r\n  css := Uppercase(GetStyle('border-width'));\r\n  brdr := 0;\r\n\r\n  p := pos('PX',css);\r\n  if p > 0 then\r\n  begin\r\n    delete(css,p,2);\r\n    val(css, brdr, p);\r\n  end;\r\n\r\n  Result := Rect(0, 0, GetWidth - 2* brdr, GetHeight - 2*brdr);\r\nend;\r\n\r\nfunction TControl.GetClientWidth: Integer;\r\nbegin\r\n  Result := Width;\r\nend;\r\n\r\nfunction TControl.GetKeyChar(AValue: string): char;\r\nvar\r\n  i: integer;\r\nbegin\r\n  i := -1;\r\n  Result := #0;\r\n\r\n  case AValue of\r\n    TJSKeyNames.BackSpace: i := 8;\r\n    TJSKeyNames.Tab: i := 9;\r\n    TJSKeyNames.Enter: i := 13;\r\n    TJSKeyNames.Shift: i := 16;\r\n    TJSKeyNames.Control: i := 17;\r\n    TJSKeyNames.Alt: i := 18;\r\n    TJSKeyNames.Pause: i := 19;\r\n    TJSKeyNames.CapsLock: i := 20;\r\n    TJSKeyNames.Escape: i := 27;\r\n    TJSKeyNames.PageUp: i := 33;\r\n    TJSKeyNames.PageDown: i := 34;\r\n    TJSKeyNames._End: i := 35;\r\n    TJSKeyNames.Home: i := 36;\r\n    TJSKeyNames.ArrowLeft: i := 37;\r\n    TJSKeyNames.ArrowUp: i := 38;\r\n    TJSKeyNames.ArrowRight: i := 39;\r\n    TJSKeyNames.ArrowDown: i := 40;\r\n    TJSKeyNames.Insert: i := 45;\r\n    TJSKeyNames.Delete: i := 46;\r\n\r\n    TJSKeyNames.F1: i := 112;\r\n    TJSKeyNames.F2: i := 113;\r\n    TJSKeyNames.F3: i := 114;\r\n    TJSKeyNames.F4: i := 115;\r\n    TJSKeyNames.F5: i := 116;\r\n    TJSKeyNames.F6: i := 117;\r\n    TJSKeyNames.F7: i := 118;\r\n    TJSKeyNames.F8: i := 119;\r\n    TJSKeyNames.F9: i := 120;\r\n    TJSKeyNames.F10: i := 121;\r\n    TJSKeyNames.F11: i := 122;\r\n    TJSKeyNames.F12: i := 123;\r\n    TJSKeyNames.F13: i := 124;\r\n    TJSKeyNames.F14: i := 125;\r\n    TJSKeyNames.F15: i := 126;\r\n    TJSKeyNames.F16: i := 127;\r\n    TJSKeyNames.F17: i := 128;\r\n    TJSKeyNames.F18: i := 129;\r\n    TJSKeyNames.F19: i := 130;\r\n    TJSKeyNames.F20: i := 131;\r\n    else\r\n    begin\r\n      Result := AValue[1];\r\n    end;\r\n  end;\r\n\r\n  if i <> -1 then\r\n    Result := chr(i);\r\nend;\r\n\r\nfunction TControl.GetKeyCode(AValue: string; IgnoreCase: boolean = true): Integer;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  i := -1;\r\n  case AValue of\r\n    'Up': i := 38;\r\n    'Down': i := 40;\r\n    'Left': i := 37;\r\n    'Right': i := 39;\r\n    '!': i := 56;\r\n    '\"': i := 51;\r\n    '#': i := 51;\r\n    '$': i := 186;\r\n    '%': i := 192;\r\n    '''': i := 52;\r\n    '(': i := 53;\r\n    ')': i := 219;\r\n    '*': i := 106;\r\n    '+': i := 107;\r\n    '-': i := 109;\r\n    ',': i := 44;\r\n    '.': i := 46;\r\n    '/': i := 111;\r\n    '\\': i := 226;\r\n    '=': i := 187;\r\n    '<': i := 226;\r\n    '>': i := 226;\r\n    TJSKeyNames.BackSpace: i := 8;\r\n    TJSKeyNames.Tab: i := 9;\r\n    TJSKeyNames.Enter: i := 13;\r\n    TJSKeyNames.Shift: i := 16;\r\n    TJSKeyNames.Control: i := 17;\r\n    TJSKeyNames.Alt: i := 18;\r\n    TJSKeyNames.Pause: i := 19;\r\n    TJSKeyNames.CapsLock: i := 20;\r\n    TJSKeyNames.Escape: i := 27;\r\n    TJSKeyNames.PageUp: i := 33;\r\n    TJSKeyNames.PageDown: i := 34;\r\n    TJSKeyNames._End: i := 35;\r\n    TJSKeyNames.Home: i := 36;\r\n    TJSKeyNames.ArrowLeft: i := 37;\r\n    TJSKeyNames.ArrowUp: i := 38;\r\n    TJSKeyNames.ArrowRight: i := 39;\r\n    TJSKeyNames.ArrowDown: i := 40;\r\n    TJSKeyNames.Insert: i := 45;\r\n    TJSKeyNames.Delete: i := 46;\r\n\r\n    TJSKeyNames.F1: i := 112;\r\n    TJSKeyNames.F2: i := 113;\r\n    TJSKeyNames.F3: i := 114;\r\n    TJSKeyNames.F4: i := 115;\r\n    TJSKeyNames.F5: i := 116;\r\n    TJSKeyNames.F6: i := 117;\r\n    TJSKeyNames.F7: i := 118;\r\n    TJSKeyNames.F8: i := 119;\r\n    TJSKeyNames.F9: i := 120;\r\n    TJSKeyNames.F10: i := 121;\r\n    TJSKeyNames.F11: i := 122;\r\n    TJSKeyNames.F12: i := 123;\r\n    TJSKeyNames.F13: i := 124;\r\n    TJSKeyNames.F14: i := 125;\r\n    TJSKeyNames.F15: i := 126;\r\n    TJSKeyNames.F16: i := 127;\r\n    TJSKeyNames.F17: i := 128;\r\n    TJSKeyNames.F18: i := 129;\r\n    TJSKeyNames.F19: i := 130;\r\n    TJSKeyNames.F20: i := 131;\r\n    else\r\n    begin\r\n      if Assigned(AValue) and (Length(AValue) > 0) then\r\n      begin\r\n        i := Ord(AValue[1]);\r\n        if IgnoreCase and (i >= 97) and (i <= 122)  then\r\n          i := i and $DF\r\n        else\r\n          if (i >= 65) and (i <= 90) then\r\n            i := i or $40\r\n          else\r\n          if i > 122 then\r\n            i := i or $80;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  Result := i;\r\nend;\r\n\r\nfunction TControl.GetLeft: Integer;\r\nbegin\r\n  Result := FLeft;\r\n  if (Result = -1) and Assigned(ElementHandle) and not (csLoading in ComponentState) then\r\n    Result := Round(ElementHandle.offsetLeft);\r\nend;\r\n\r\nfunction TControl.GetTop: Integer;\r\nbegin\r\n  Result := FTop;\r\n  if (Result = -1) and Assigned(ElementHandle) and not (csLoading in ComponentState) then\r\n    Result := Round(ElementHandle.offsetTop);\r\nend;\r\n\r\nfunction TControl.GetTouchEventShiftState(Event: TJSTouchEvent): TShiftState;\r\nbegin\r\n  Result := [];\r\n  if Event.shiftKey then\r\n    Result := Result + [ssShift];\r\n  if Event.ctrlKey then\r\n    Result := Result + [ssCtrl];\r\n  if Event.altKey then\r\n    Result := Result + [ssAlt];\r\nend;\r\n\r\nfunction TControl.GetWebClassName: string;\r\nbegin\r\n  Result := ClassName;\r\n  Delete(Result, 1, 1);\r\n  Result := 'TWeb' + Result;\r\nend;\r\n\r\nfunction TControl.GetWidth: Integer;\r\nvar\r\n  cr: TJSDOMRect;\r\nbegin\r\n  Result := FWidth;\r\n\r\n  if Assigned(ElementHandle) and not (csLoading in ComponentState) then\r\n  begin\r\n    if (Result = -1) then\r\n    begin\r\n      Result := Round(Int(ElementHandle.offsetWidth));\r\n    end;\r\n\r\n    if (WidthStyle <> ssAbsolute) then\r\n    begin\r\n      cr := ElementHandle.getBoundingClientRect;\r\n      Result := Round(Int(cr.Right - cr.Left));\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetHeight: Integer;\r\nvar\r\n  cr: TJSDOMRect;\r\nbegin\r\n  Result := FHeight;\r\n\r\n  if Assigned(ElementHandle) and not (csLoading in ComponentState) then\r\n  begin\r\n    if (Result = -1) then\r\n    begin\r\n      Result := Round(Int(ElementHandle.offsetHeight));\r\n    end;\r\n\r\n    if (HeightStyle <> ssAbsolute) then\r\n    begin\r\n      cr := ElementHandle.getBoundingClientRect;\r\n      Result := Round(Int(cr.Bottom - cr.Top));\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.KeyDown(var Key: Word; Shift: TShiftState);\r\nbegin\r\n  if Assigned(OnKeyDown) then\r\n    OnKeyDown(Self, Key, Shift);\r\nend;\r\n\r\nprocedure TControl.KeyPress(var Key: Char);\r\nbegin\r\n  if Assigned(OnKeyPress) then\r\n    OnKeyPress(Self, Key);\r\nend;\r\n\r\nprocedure TControl.KeyUp(var Key: Word; Shift: TShiftState);\r\nbegin\r\n  if Assigned(OnKeyUp) then\r\n    OnKeyUp(Self, Key, Shift);\r\nend;\r\n\r\nfunction TControl.LayerHandleDoMouseEnter(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if (Event.buttons = 0) and Captured and not FMouseInsideLayer then\r\n  begin\r\n    ReleaseCapture;\r\n    HandleDoMouseUp(Event);\r\n    HandleDoMouseLeave(Event);\r\n  end;\r\n  FMouseInsideLayer := True;\r\n  Result := true;\r\nend;\r\n\r\nfunction TControl.LayerHandleDoMouseLeave(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FMouseInsideLayer := False;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TControl.Loaded;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if not (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  inherited;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    // handle relative child positions\r\n    if (Controls[i].ElementPosition in [epRelative, epIgnore]) and not (Controls[i].IsLinked) and (Controls[i].ChildOrder >= 0) then\r\n    begin\r\n      if (Controls[i].ChildOrder < ChildContainer.childNodes.Length) then\r\n      begin\r\n        ChildContainer.insertBefore(Controls[i].Container, ChildContainer.childNodes[Controls[i].ChildOrder]);\r\n      end;\r\n    end;\r\n    Controls[i].Loaded;\r\n  end;\r\n\r\n  // all remaining child controls set to Loaded\r\n  for i := 0 to ComponentCount - 1 do\r\n  begin\r\n    if (csLoading in Components[i].ComponentState) then\r\n      Components[i].Loaded;\r\n  end;\r\n\r\n  case Align of\r\n    alClient:\r\n    begin\r\n      if Assigned(Parent) then\r\n        SetBoundsInt(0, 0, Parent.FWidth, Parent.FHeight);\r\n    end;\r\n  end;\r\n\r\n  Resize;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TControl.LoadFromHTML(const HTML: string);\r\nbegin\r\n  if Assigned(ElementHandle) then\r\n    ElementHandle.outerHTML := HTML;\r\nend;\r\n\r\nprocedure TControl.LoadState(AState: string);\r\nbegin\r\n\r\nend;\r\n\r\nfunction TControl.HandleAllocated: Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TControl.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeClick in EventStopPropagation) then\r\n    StopPropagation;\r\n  if Enabled then\r\n    Click;\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoContextMenu(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  Result := true;\r\nend;\r\n\r\nfunction TControl.HandleDoDblClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeDblClick in EventStopPropagation) then\r\n    StopPropagation;\r\n  if Enabled then\r\n    DblClick;\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoDragDrop(Event: TJSDragEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  Event.stopPropagation;\r\n  if not FAcceptDrag then\r\n    Event.preventDefault\r\n  else\r\n  begin\r\n    if not IsInputControl then\r\n      Event.preventDefault;\r\n    DragDrop(DragObject, Event.clientX, Event.clientY);\r\n  end;\r\n  Result := FAcceptDrag;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoDragEnd(Event: TJSDragEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  Event.stopPropagation;\r\n  DoEndDrag(DragObject, Event.clientX, Event.clientY);\r\n  Result := True;\r\n  if (DragMode = dmManual) then\r\n    DisableDrag;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoDragEnter(Event: TJSDragEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  Event.stopPropagation;\r\n  FAcceptDrag := IsInputControl;\r\n  DragOver(DragObject, Event.clientX, Event.clientY, dsDragEnter, FAcceptDrag);\r\n  if FAcceptDrag then\r\n    Event.preventDefault;\r\n  Result := not FAcceptDrag;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandledoDragLeave(Event: TJSDragEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  Event.stopPropagation;\r\n  DragOver(DragObject, Event.clientX, Event.clientY, dsDragLeave, FAcceptDrag);\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoDragOver(Event: TJSDragEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  Event.stopPropagation;\r\n  DragOver(DragObject, Event.clientX, Event.clientY, dsDragMove, FAcceptDrag);\r\n  if FAcceptDrag and (not IsInputControl or (Event.dataTransfer.items.length = 0)) then\r\n    Event.preventDefault;\r\n  Result := not FAcceptDrag;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoDragStart(Event: TJSDragEvent): Boolean;\r\nvar\r\n  obj: TDragObject;\r\nbegin\r\n  FElementEvent := Event;\r\n  Event.stopPropagation;\r\n  obj := nil;\r\n  DoStartDrag(obj);\r\n  if Assigned(obj) then\r\n    DragObject := obj\r\n  else\r\n    DragObject := Self;\r\n  Result := True;\r\nend;\r\n\r\n{$HINTS OFF}\r\n\r\nprocedure TControl.XYToClient(X,Y: single; var AClientX, AClientY: single);\r\nvar\r\n  p: TControl;\r\n  cr: TJSDOMRect;\r\n  el: TJSHTMLElement;\r\n  OrigX,OrigY: single;\r\n  norel, formcont: boolean;\r\n  r: TRect;\r\n  cs: TJSCSSStyleDeclaration;\r\n  csx, csy: integer;\r\n  scrollx, scrolly: integer;\r\nbegin\r\n  norel := True;\r\n  formcont := False;\r\n\r\n  scrollx := 0;\r\n  scrolly := 0;\r\n\r\n  if (ElementPosition = epAbsolute) then\r\n  begin\r\n    scrollx := document.body.scrollLeft + document.documentElement.scrollLeft;\r\n    scrolly := document.body.scrollTop + document.documentElement.scrollTop;\r\n    OrigX := X - Left;\r\n    OrigY := Y - Top;\r\n  end\r\n  else\r\n  begin\r\n    norel := false;\r\n    cr := ElementHandle.getBoundingClientRect;\r\n    OrigX := X - cr.Left;\r\n    OrigY := Y - cr.Top;\r\n    AClientX := OrigX;\r\n    AClientY := OrigY;\r\n    Exit;\r\n  end;\r\n\r\n  AClientX := OrigX;\r\n  AClientY := OrigY;\r\n\r\n  p := Parent;\r\n\r\n  if (Self is TCustomForm) and not Assigned(p) and Assigned(Container) then\r\n  begin\r\n    cr := Container.getBoundingClientRect;\r\n    AClientX := AClientX - cr.Left;\r\n    AClientY := AClientY - cr.Top;\r\n  end;\r\n\r\n  while Assigned(p) do\r\n  begin\r\n    if (p.IsLinked) then\r\n    begin\r\n      if (p is TCustomForm) then\r\n      // is a form hosted in another HTML element\r\n        cr := p.Container.getBoundingClientRect\r\n      else\r\n      // is control linked to HTML element\r\n        cr := p.ElementHandle.getBoundingClientRect;\r\n\r\n      // subtract the calculated position\r\n      AClientX := AClientX - cr.Left;\r\n      AClientY := AClientY - cr.Top;\r\n\r\n      scrollx := 0;\r\n      scrolly := 0;\r\n    end\r\n    else\r\n    if (p is TCustomForm) then\r\n    begin\r\n      if ((p as TCustomForm).FormContainer <> '') then\r\n      begin\r\n        el := TJSHTMLElement(document.getElementById((p as TCustomForm).FormContainer));\r\n\r\n        if Assigned(el) then\r\n        begin\r\n          formcont := true;\r\n          cr := el.getBoundingClientRect;\r\n          AClientX := AClientX - cr.Left;\r\n          AClientY := AClientY - cr.Top;\r\n        end;\r\n      end;\r\n\r\n      if Assigned((p as TCustomForm).Container) and ((p as TCustomForm).FormContainer = '') and {((p as TCustomForm).FormFileName <> '') and} ((p as TCustomForm).Popup) then\r\n      begin\r\n        cr := (p as TCustomForm).Container.getBoundingClientRect;\r\n        AClientX := AClientX - cr.Left;\r\n        AClientY := AClientY - cr.Top;\r\n        r := (p as TCustomForm).ClientRect;\r\n        AClientY := AClientY + r.Top;\r\n        scrollx := 0;\r\n        scrolly := 0;\r\n      end;\r\n    end\r\n    else\r\n    // restart calculation from bounding rectangle in case it is relative positioned\r\n    if (p.ElementPosition in [epRelative, epIgnore]) then\r\n    begin\r\n      if Assigned(p.ElementHandle) then\r\n      begin\r\n        cr := p.ElementHandle.getBoundingClientRect;\r\n        AClientX := OrigX - cr.Left;\r\n        AClientY := OrigY - cr.Top;\r\n        scrollx := 0;\r\n        scrolly := 0;\r\n\r\n        // as first relative element, take the BODY margins in account\r\n        if norel then\r\n        begin\r\n          cs := window.getComputedStyle(document.documentElement);\r\n          {$IFDEF PAS2JS}\r\n          asm\r\n            csx = parseInt(cs.marginLeft,10);\r\n            csy = parseInt(cs.marginTop,10)\r\n          end;\r\n          {$ENDIF}\r\n\r\n          AClientX := AClientX + csx;\r\n          AClientY := AClientY + csy;\r\n        end;\r\n\r\n        norel := false;\r\n      end;\r\n    end\r\n    else\r\n    // only subtract for absolute positioned elements\r\n    if (p.ElementPosition = epAbsolute) and norel then\r\n    begin\r\n      AClientX := AClientX - p.Left;\r\n      AClientY := AClientY - p.Top;\r\n      OrigX := AClientX;\r\n      OrigY := AClientY;\r\n    end;\r\n    p := p.Parent;\r\n  end;\r\n\r\n  // take scroll in account when there was no relative element involved\r\n  if (ElementPosition = epAbsolute) and not formcont then\r\n  begin\r\n    AClientX := AClientX + scrollx;\r\n    AClientY := AClientY + scrolly;\r\n  end;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nprocedure TControl.ClientToXY(AClientX, AClientY: single; var X,Y: single);\r\nvar\r\n  p: TControl;\r\n  cr: TJSDOMRect;\r\nbegin\r\n  X := AClientX + Left - document.body.scrollLeft - document.documentElement.scrollLeft;\r\n  Y := AClientY + Top - document.body.scrollTop - document.documentElement.scrollTop;\r\n\r\n  p := Parent;\r\n  while Assigned(p) do\r\n  begin\r\n    if (p.IsLinked) then\r\n    begin\r\n\r\n      if (p is TCustomForm) then\r\n      // is a form hosted in another HTML element\r\n        cr := p.Container.getBoundingClientRect\r\n      else\r\n      // is control linked to HTML element\r\n        cr := p.ElementHandle.getBoundingClientRect;\r\n\r\n      // subtract the calculated position\r\n      X := X + cr.Left;\r\n      Y := Y + cr.Top;\r\n    end;\r\n\r\n    if (p is TCustomForm) then\r\n    begin\r\n\r\n      if Assigned((p as TCustomForm).Container) and ((p as TCustomForm).FormContainer = '') and ((p as TCustomForm).FormFileName <> '') and ((p as TCustomForm).Popup) then\r\n      begin\r\n        cr := (p as TCustomForm).Container.getBoundingClientRect;\r\n        X := X + cr.Left;\r\n        Y := Y + cr.Top;\r\n      end;\r\n    end;\r\n\r\n    // only add for absolute positioned elements\r\n    if (p.ElementPosition = epAbsolute) then\r\n    begin\r\n      X := X + p.Left;\r\n      Y := Y + p.Top;\r\n    end;\r\n\r\n    p := p.Parent;\r\n  end;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseDown(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  l, t: Single;\r\n  ss: TShiftState;\r\n  mb: TMouseButton;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeMouseDown in EventStopPropagation) then\r\n    StopPropagation;\r\n\r\n  if not CanFocus then\r\n    PreventDefault;\r\n\r\n  FMouseX := Round(Event.clientX);\r\n  FMouseY := Round(Event.clientY);\r\n\r\n  XYToClient(Event.clientX, Event.clientY, l, t);\r\n\r\n  // click outside scroll area should not trigger mousedown\r\n  if HasVertScrollBar and (l > Width - GetScrollBarWidth) then\r\n    Exit;\r\n\r\n  if HasHorzScrollBar and (t > Height - GetScrollBarHeight) then\r\n    Exit;\r\n\r\n  ss := GetMouseEventShiftState(Event);\r\n  mb := GetMouseEventButton(Event);\r\n\r\n  MouseDown(mb, ss, Trunc(l), Trunc(t));\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseUp(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  l, t: Single;\r\n  ss: TShiftState;\r\n  mb: TMouseButton;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeMouseUp in EventStopPropagation) then\r\n    StopPropagation;\r\n\r\n  XYToClient(Event.clientX, Event.clientY, l, t);\r\n\r\n  // click outside scroll area should not trigger mousedown\r\n  if HasVertScrollBar and (l > Width - GetScrollBarWidth) then\r\n  begin\r\n    FElementEvent := nil;\r\n    Exit;\r\n  end;\r\n\r\n  if HasHorzScrollBar and (t > Height - GetScrollBarHeight) then\r\n  begin\r\n    FElementEvent := nil;\r\n    Exit;\r\n  end;\r\n\r\n  ss := GetMouseEventShiftState(Event);\r\n  mb := GetMouseEventButton(Event);\r\n\r\n  if (DragMode = dmManual) then\r\n    DisableDrag;\r\n\r\n  MouseUp(mb, ss, Trunc(l), Trunc(t));\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoWheel(Event: TJSWheelEvent): Boolean;\r\nvar\r\n  ss: TShiftState;\r\n  h: Boolean;\r\n  l,t: single;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n\r\n  XYToClient(Event.clientX, Event.clientY, l, t);\r\n\r\n  FWheelMousePos.X := round(l);\r\n  FWheelMousePos.Y := round(t);\r\n\r\n  ss := GetMouseWheelEventShiftState(Event);\r\n\r\n  h := False;\r\n  MouseWheel(ss, Trunc(-Event.deltay), h);\r\n\r\n  Result := true;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nprocedure TControl.ParentFontChanged;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n    begin\r\n      if Controls[i].ParentFont then\r\n      begin\r\n        Controls[i].Font.Assign(Font);\r\n        Controls[i].FontChanged;\r\n        Controls[i].FParentFont := true;\r\n        Controls[i].ParentFontChanged;\r\n      end;\r\n    end;\r\nend;\r\n\r\nprocedure TControl.HandleFontChanged(Sender: TObject);\r\nbegin\r\n  if (FUpdateCount = 0) then\r\n  begin\r\n    ParentFont := false;\r\n    ParentFontChanged;\r\n  end;\r\n\r\n  FontChanged;\r\nend;\r\n\r\nfunction TControl.HasHorzScrollBar: Boolean;\r\nbegin\r\n  Result := False;\r\n\r\n  if Assigned(ElementHandle) then\r\n     Result := ElementHandle.clientWidth < ElementHandle.scrollWidth;\r\nend;\r\n\r\nfunction TControl.HasVertScrollBar: Boolean;\r\nbegin\r\n  Result := False;\r\n\r\n  if Assigned(ElementHandle) then\r\n     Result := ElementHandle.clientHeight < ElementHandle.scrollHeight;\r\nend;\r\n\r\nprocedure TControl.Hide;\r\nbegin\r\n  Visible := false;\r\nend;\r\n\r\nfunction TControl.HandleDoTouchStart(Event: TJSTouchEvent): Boolean;\r\nvar\r\n  l,t: single;\r\n  touch: TJSTouch;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n  FLastElementEvent := Event;\r\n\r\n  StopPropagation;\r\n\r\n  if not FAllowTouch then\r\n    PreventDefault;\r\n\r\n  if Event.Touches.length > 0 then\r\n  begin\r\n    touch := Event.touches.Touches[0];\r\n\r\n    XYToClient(touch.clientX, touch.clientY, l, t);\r\n\r\n    ss := GetTouchEventShiftState(Event);\r\n\r\n    if LinkTouchEvents then\r\n    begin\r\n      MouseDown(mbLeft, ss, Trunc(l), Trunc(t));\r\n    end;\r\n\r\n    TouchStart(Trunc(l), Trunc(t));\r\n  end;\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoTouchMove(Event: TJSTouchEvent): Boolean;\r\nvar\r\n  l,t: single;\r\n  touch: TJSTouch;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n  FLastElementEvent := Event;\r\n\r\n  StopPropagation;\r\n\r\n  if not FAllowTouch then\r\n    PreventDefault;\r\n\r\n  if Captured then\r\n    PreventDefault;\r\n\r\n  if Event.Touches.length > 0 then\r\n  begin\r\n    touch := Event.touches.Touches[0];\r\n\r\n    XYToClient(touch.clientX, touch.clientY, l, t);\r\n\r\n    ss := GetTouchEventShiftState(Event);\r\n\r\n    if LinkTouchEvents then\r\n      MouseMove(ss, Trunc(l), Trunc(t));\r\n\r\n    TouchMove(Trunc(l), Trunc(t));\r\n  end;\r\n  FElementEvent := nil;\r\n  Result := True;\r\nend;\r\n\r\nfunction TControl.HandleDoTouchEnd(Event: TJSTouchEvent): Boolean;\r\nvar\r\n  l,t: single;\r\n  touch: TJSTouch;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n\r\n  if not FAllowTouch then\r\n    PreventDefault;\r\n\r\n  ReleaseCapture;\r\n  StopPropagation;\r\n\r\n  if Assigned(FLastElementEvent) and (TJSTouchEvent(FLastElementEvent).Touches.length > 0) then\r\n  begin\r\n    touch := TJSTouchEvent(FLastElementEvent).touches.Touches[0];\r\n\r\n    XYToClient(touch.clientX, touch.clientY, l, t);\r\n\r\n    ss := GetTouchEventShiftState(Event);\r\n\r\n    if LinkTouchEvents then\r\n    begin\r\n      MouseUp(mbLeft, ss, Trunc(l), Trunc(t));\r\n    end;\r\n\r\n    TouchEnd(Trunc(l), Trunc(t));\r\n  end;\r\n  FElementEvent := nil;\r\n  Result := True;\r\nend;\r\n\r\nfunction TControl.HandleDoTouchCancel(Event: TJSTouchEvent): Boolean;\r\nvar\r\n  l,t: single;\r\n  touch: TJSTouch;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n  ReleaseCapture;\r\n  StopPropagation;\r\n\r\n  if Event.Touches.length > 0 then\r\n  begin\r\n    touch := Event.touches.Touches[0];\r\n\r\n    XYToClient(touch.clientX, touch.clientY, l, t);\r\n\r\n    ss := GetTouchEventShiftState(Event);\r\n\r\n    if LinkTouchEvents then\r\n    begin\r\n      MouseUp(mbLeft, ss, Trunc(l), Trunc(t));\r\n    end;\r\n\r\n    TouchCancel(Trunc(l), Trunc(t));\r\n  end;\r\n  FElementEvent := nil;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TControl.DragDrop(Source: TObject; X, Y: Integer);\r\nbegin\r\n  if Assigned(OnDragDrop) then\r\n    OnDragDrop(Self, Source, X, Y);\r\nend;\r\n\r\nprocedure TControl.DragOver(Source: TObject; X, Y: Integer;\r\n  State: TDragState; var Accept: Boolean);\r\nbegin\r\n  if Assigned(OnDragOver) then\r\n    OnDragOver(Self, Source, X, Y, State, Accept);\r\nend;\r\n\r\nprocedure TControl.DoBoundsChange;\r\nvar\r\n  b: boolean;\r\n  frm: TCustomForm;\r\nbegin\r\n  UpdateElementSize;\r\n  RecreateCanvas;\r\n\r\n  if FIsResizing then\r\n    Exit;\r\n\r\n  FIsResizing := true;\r\n\r\n  InternalResize;\r\n\r\n  DoRealign;\r\n\r\n  b := false;\r\n\r\n  frm := GetParentForm(Self);\r\n  if Assigned(frm) then\r\n  begin\r\n    b := frm.IsResizing;\r\n    b := b or (TControl(frm).FUpdateCount > 0);\r\n  end;\r\n\r\n  b := b or (FUpdateCount > 0);\r\n  b := b or FIsAligning;\r\n\r\n  if not b then\r\n  begin\r\n    UpdateChildAnchoring;\r\n  end;\r\n\r\n  FIsResizing := false;\r\nend;\r\n\r\nprocedure TControl.DoEndDrag(Target: TObject; X, Y: Integer);\r\nbegin\r\n  if Assigned(OnEndDrag) then\r\n    OnEndDrag(Self, Target, X, Y);\r\nend;\r\n\r\nprocedure TControl.DoStartDrag(var DragObject: TDragObject);\r\nbegin\r\n  if Assigned(OnStartDrag) then\r\n    OnStartDrag(Self, DragObject);\r\nend;\r\n\r\nfunction TControl.Focused: Boolean;\r\nbegin\r\n  Result := FContainer = document.activeElement;\r\nend;\r\n\r\n\r\nprocedure TControl.FontChanged;\r\nbegin\r\n  UpdateElementVisual;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseLeave(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if Captured then\r\n    Exit;\r\n\r\n  Event.stopPropagation;\r\n  DoMouseLeave;\r\n  Result := true;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseEnter(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if Captured then\r\n    Exit;\r\n\r\n  Event.stopPropagation;\r\n  DoMouseEnter;\r\n  Result := true;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseMove(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  l, t: Single;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n  FCursorX := round(Event.clientX);\r\n  FCursorY := round(Event.clientY);\r\n\r\n  if (eeMouseMove in EventStopPropagation) then\r\n    StopPropagation;\r\n\r\n  XYToClient(Event.clientX, Event.clientY, l, t);\r\n\r\n  ss := GetMouseEventShiftState(Event);\r\n\r\n  MouseMove(ss, Trunc(l), Trunc(t));\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoKeyDown(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  k: Word;\r\n  ss: TShiftState;\r\n  undef: boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeKeyDown in EventStopPropagation) then\r\n    StopPropagation;\r\n\r\n  {$IFDEF PAS2JS}\r\n  asm\r\n    undef = (Event.key == undefined);\r\n  end;\r\n  {$ENDIF}\r\n\r\n  if not undef then\r\n  begin\r\n    k := GetKeyCode(Event.Key, true);\r\n    ss := GetKeyboardEventShiftState(Event);\r\n    KeyDown(k, ss);\r\n  end;\r\n\r\n  Result := True;\r\n  if k = 0 then\r\n    PreventDefault;\r\n\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoKeyUp(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  k: Word;\r\n  ss: TShiftState;\r\n  c: Char;\r\n  undef: boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeKeyUp in EventStopPropagation) then\r\n    StopPropagation;\r\n  {$IFDEF PAS2JS}\r\n  asm\r\n    undef = (Event.key == undefined);\r\n  end;\r\n  {$ENDIF}\r\n\r\n  if not undef then\r\n  begin\r\n    k := GetKeyCode(Event.Key, true);\r\n\r\n    ss := GetKeyboardEventShiftState(Event);\r\n\r\n    // #27 is not send as char in the browser\r\n    if (k = 27) then\r\n    begin\r\n      c := #27;\r\n      KeyPress(c);\r\n    end;\r\n\r\n    KeyUp(k, ss);\r\n  end;\r\n\r\n  Result := True;\r\n  if k = 0 then\r\n    PreventDefault;\r\n  FelementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoKeyPress(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  c: Char;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeKeyPress in EventStopPropagation) then\r\n    StopPropagation;\r\n\r\n  if IsKeyCharacter(Event.Key) then\r\n  begin\r\n    c := GetKeyChar(Event.Key);\r\n    KeyPress(c);\r\n  end;\r\n\r\n  Result := True;\r\n  if c = #0 then\r\n    PreventDefault;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoInput(Event: TJSInputEvent): Boolean;\r\nvar\r\n  c: Char;\r\n  stemp: string;\r\nbegin\r\n  //Note: On Android the OnKeyPress event is not triggered.\r\n  //The OnInput event is used instead to trigger the OnKeyPress event.\r\n  if IsAndroid then\r\n  begin\r\n    FElementEvent := Event;\r\n    if (eeKeyPress in EventStopPropagation) then\r\n      StopPropagation;\r\n\r\n    c := #0;\r\n    if Event.Data <> '' then\r\n    begin\r\n      stemp := Event.Data;\r\n\r\n      if Assigned(stemp) then\r\n        c := stemp[Length(stemp)]\r\n      else\r\n        c := #8;\r\n\r\n      KeyPress(c);\r\n    end;\r\n\r\n    Result := True;\r\n    if c = #0 then\r\n      PreventDefault;\r\n    FElementEvent := nil;\r\n  end;\r\nend;\r\n\r\nfunction TControl.HandleDoEnter(Event: TJSFocusEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n\r\n  DoEnter;\r\n  Result := True;\r\n  FElementEvent := nil;\r\n  FGotFocus := True;\r\nend;\r\n\r\nfunction TControl.HandleDoExit(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  DoExit;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TControl.SetParent(AValue: TControl);\r\nvar\r\n  isNew: boolean;\r\nbegin\r\n  if Assigned(AValue) then\r\n    AValue := AValue.CanAcceptChild(Self);\r\n\r\n  isNew := FNew;\r\n\r\n  if (FParent <> AValue) then\r\n  begin\r\n    if Assigned(FParent) then\r\n      FParent.UnRegisterParent(Self);\r\n\r\n    FPrevParent := FParent;\r\n    FParent := AValue;\r\n    FGotFocus := False;\r\n\r\n    UpdateParent;\r\n\r\n    if not (csDestroying in ComponentState) then\r\n    begin\r\n      if not isNew then\r\n        UpdateElement;\r\n      InitScript;\r\n    end;\r\n\r\n    if Assigned(FParent) then\r\n    begin\r\n      FParent.RegisterParent(Self);\r\n    end;\r\n\r\n    if (csLoading in ComponentState) and Assigned(Parent) and not (csLoading in Parent.ComponentState) then\r\n      Loaded;\r\n\r\n    if Assigned(AValue) and Assigned(Parent) and not Parent.IsUpdating then\r\n      Realign;\r\n\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetParentColor(const Value: boolean);\r\nbegin\r\n  if (FParentColor <> Value) and Value and Assigned(Parent) then\r\n  begin\r\n    Color := Parent.Color;\r\n  end;\r\n\r\n  FParentColor := Value;\r\nend;\r\n\r\nprocedure TControl.SetParentComponent(Value: TComponent);\r\nbegin\r\n  if (Parent <> Value) and (Value is TControl) then\r\n   SetParent(TControl(Value));\r\nend;\r\n\r\nprocedure TControl.SetParentElement(const Value: TJSHTMLElement);\r\nbegin\r\n  if FNew then\r\n  begin\r\n    FElementPosition := epRelative;\r\n    CreateControl;\r\n    FParentElement := Value;\r\n\r\n    if Assigned(FParentElement) then\r\n    begin\r\n      FParentElement.appendChild(Container);\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    if Assigned(FParentElement) then\r\n      FParentElement.removeChild(Container);\r\n\r\n    FParentElement := Value;\r\n\r\n    if Assigned(FParentElement) then\r\n      FParentElement.appendChild(Container);\r\n\r\n    UpdateElement;\r\n  end;\r\n\r\n  InitScript;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TControl.SetParentElementID(const Value: string);\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  FParentElementID := Value;\r\n\r\n  el := TJSHTMLElement(document.getElementById(FParentElementID));\r\n\r\n  if Assigned(el) then\r\n    SetParentElement(el);\r\nend;\r\n\r\nprocedure TControl.SetParentFont(const Value: boolean);\r\nbegin\r\n  if (Value <> FParentFont) and (Value) and Assigned(Parent) then\r\n  begin\r\n    BeginUpdate;\r\n    Font.Assign(Parent.Font);\r\n    EndUpdate;\r\n    UpdateElement;\r\n  end;\r\n\r\n  FParentFont := Value;\r\nend;\r\n\r\nprocedure TControl.SetRequiredScripts(const Value: TStringList);\r\nbegin\r\n  FRequiredScripts.Assign(Value);\r\nend;\r\n\r\nprocedure TControl.SetRole(const Value: string);\r\nbegin\r\n  FRole := Value;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if Value = '' then\r\n      ElementHandle.removeAttribute('role')\r\n    else\r\n      ElementHandle.setAttribute('role', Value);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.Realign;\r\nbegin\r\n  AlignControl(Self);\r\nend;\r\n\r\nprocedure TControl.RecreateCanvas;\r\nbegin\r\nend;\r\n\r\nprocedure TControl.RecreateElement;\r\nbegin\r\n  if Assigned(Container) then\r\n  begin\r\n    UnbindEvents;\r\n    Container.parentNode.removeChild(Container);\r\n    FElement := nil;\r\n    CreateControl;\r\n\r\n    if Assigned(Parent) and Assigned(Parent.Container) then\r\n      Parent.ChildContainer.appendChild(Container);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.RegisterParent(AValue: TControl);\r\nbegin\r\n  SetLength(FControls, Length(FControls) + 1);\r\n  FControls[Length(FControls) - 1] := AValue;\r\nend;\r\n\r\nprocedure TControl.ReleaseCapture;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  FCaptureDown := False;\r\n\r\n  if FCaptured and Assigned(FLayer) then\r\n  begin\r\n    eh := TJSHTMLElement(FLayer);\r\n    eh.removeEventListener('mouseenter', FLayerMouseEnterPtr);\r\n    eh.removeEventListener('mouseleave', FLayerMouseLeavePtr);\r\n    eh.removeEventListener('mousedown', FMouseDownPtr);\r\n    eh.removeEventListener('mouseup', FMouseUpPtr);\r\n    eh.removeEventListener('mousemove', FMouseMovePtr);\r\n    eh.removeEventListener('touchstart', FTouchStartPtr);\r\n    eh.removeEventListener('touchmove', FTouchMovePtr);\r\n    eh.removeEventListener('touchend', FTouchEndPtr);\r\n    eh.removeEventListener('touchcancel', FTouchEndPtr);\r\n\r\n    document.body.removeChild(eh);\r\n    FCaptured := False;\r\n    FLayer := nil;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.ResetAnchoring;\r\nbegin\r\n  FOrigRect := Rect(-1,-1,-1,-1);\r\n  InitAnchoring;\r\nend;\r\n\r\nprocedure TControl.Resize;\r\nbegin\r\n  if Assigned(FOnResize) then\r\n    FOnResize(Self);\r\nend;\r\n\r\nfunction TControl.AnchoringInitialized: boolean;\r\nbegin\r\n  Result := (OrigRect.Left <> -1) or (OrigRect.Top <> -1);\r\nend;\r\n\r\nprocedure TControl.InitAnchoring;\r\nvar\r\n  i,dx,dy: integer;\r\n\r\n  procedure SizeBorderOffset(AObject: TObject; var ax,ay: integer);\r\n  var\r\n    prop: TTypeMemberProperty;\r\n  begin\r\n    ax := 0;\r\n    ay := 0;\r\n    prop := GetPropInfo(AObject.ClassInfo, 'BorderStyle');\r\n    if Assigned(prop) then\r\n    begin\r\n      i := GetOrdProp(AObject, prop);\r\n      if i in [1,4,5] then\r\n      begin\r\n        ax := 4;\r\n        ay := 4;\r\n      end;\r\n      if i in [2,3] then\r\n      begin\r\n        ax := 16;\r\n        ay := 16;\r\n      end;\r\n    end;\r\n  end;\r\n\r\nbegin\r\n  if AnchoringInitialized then\r\n    Exit;\r\n\r\n  dx := 0;\r\n  dy := 0;\r\n\r\n  if (Self is TForm) then\r\n  begin\r\n    if (self as TForm).IsMiletus then\r\n      SizeBorderOffset(Self, dx,dy);\r\n\r\n    FOrigRect := Rect(0, 0, GetDesignWidth - dx, GetDesignHeight - dy);\r\n  end\r\n  else\r\n  begin\r\n    FOrigRect := Rect(GetDesignLeft, GetDesignTop, GetDesignLeft + GetDesignWidth, GetDesignTop + GetDesignHeight);\r\n  end;\r\n\r\n  if Assigned(Parent) then\r\n  begin\r\n    if (Parent is TForm) then\r\n    begin\r\n      if (Parent as TForm).IsMiletus then\r\n      begin\r\n        SizeBorderOffset(Parent, dx,dy);\r\n      end;\r\n      FOrigParentRect := Rect(0, 0, Parent.GetDesignWidth -dx, Parent.GetDesignHeight-dy)\r\n    end\r\n    else\r\n    begin\r\n      //InitAnchoring;\r\n      if not Parent.AnchoringInitialized then\r\n        Parent.InitAnchoring;\r\n\r\n      FOrigParentRect := Rect(Parent.GetDesignLeft, Parent.GetDesignTop, Parent.GetDesignLeft + Parent.GetDesignWidth, Parent.GetDesignTop + Parent.GetDesignHeight);\r\n    end;\r\n  end;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].InitAnchoring;\r\nend;\r\n\r\nprocedure TControl.InjectCSS;\r\nvar\r\n  cssname,css: string;\r\n  cssmgr: TCSSCodeManager;\r\nbegin\r\n  cssname := GetWebClassname;\r\n\r\n  css := '';\r\n\r\n  cssmgr := GetCSSManager;\r\n\r\n  if Assigned(cssmgr) then\r\n    css := cssmgr.GetClassCSS(cssname);\r\n\r\n  if (css <> '') then\r\n    AddControlStyle(css);\r\nend;\r\n\r\nprocedure TControl.InternalResize;\r\nbegin\r\n  if (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  Resize;\r\nend;\r\n\r\nprocedure TControl.InternalUpdateParent;\r\nvar\r\n  p: TControl;\r\nbegin\r\n  p := FPrevParent;\r\n  if FNew then\r\n  begin\r\n    CreateControl;\r\n\r\n    if Assigned(Container) then\r\n    begin\r\n      if Assigned(Parent) and not Assigned(Parent.Container) then\r\n        Parent.CreateControl;\r\n\r\n      if (Parent <> p) and Assigned(p) and Assigned(p.Container) then\r\n      begin\r\n        if Container.parentNode = p.ChildContainer then\r\n          p.ChildContainer.removeChild(Container);\r\n      end;\r\n\r\n      if Assigned(Parent) and Assigned(Parent.Container) then\r\n      begin\r\n        Parent.ChildContainer.appendChild(Container);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TControl.IsEnabled: boolean;\r\nbegin\r\n  Result := FEnabled;\r\nend;\r\n\r\nfunction TControl.IsFocused: Boolean;\r\nbegin\r\n  Result := FContainer = document.activeElement;\r\nend;\r\n\r\nfunction TControl.IsInputControl: Boolean;\r\nbegin\r\n  Result := False;\r\nend;\r\n\r\nfunction TControl.IsKeyCharacter(AValue: string): Boolean;\r\nbegin\r\n  case AValue of\r\n    'Up',\r\n    'Down',\r\n    'Left',\r\n    'Right',\r\n    TJSKeyNames.Shift,\r\n    TJSKeyNames.Control,\r\n    TJSKeyNames.Alt,\r\n    TJSKeyNames.Pause,\r\n    TJSKeyNames.CapsLock,\r\n    TJSKeyNames.PageUp,\r\n    TJSKeyNames.PageDown,\r\n    TJSKeyNames._End,\r\n    TJSKeyNames.Home,\r\n    TJSKeyNames.ArrowLeft,\r\n    TJSKeyNames.ArrowUp,\r\n    TJSKeyNames.ArrowRight,\r\n    TJSKeyNames.ArrowDown,\r\n    TJSKeyNames.Insert,\r\n    TJSKeyNames.Delete,\r\n    TJSKeyNames.F1,\r\n    TJSKeyNames.F2,\r\n    TJSKeyNames.F3,\r\n    TJSKeyNames.F4,\r\n    TJSKeyNames.F5,\r\n    TJSKeyNames.F6,\r\n    TJSKeyNames.F7,\r\n    TJSKeyNames.F8,\r\n    TJSKeyNames.F9,\r\n    TJSKeyNames.F10,\r\n    TJSKeyNames.F11,\r\n    TJSKeyNames.F12,\r\n    TJSKeyNames.F13,\r\n    TJSKeyNames.F14,\r\n    TJSKeyNames.F15,\r\n    TJSKeyNames.F16,\r\n    TJSKeyNames.F17,\r\n    TJSKeyNames.F18,\r\n    TJSKeyNames.F19,\r\n    TJSKeyNames.F20: Result := False;\r\n    else\r\n      Result := True;\r\n  end;\r\nend;\r\n\r\nfunction TControl.IsStructuralElement: boolean;\r\nbegin\r\n  Result := false;\r\nend;\r\n\r\nprocedure TControl.UnbindEvents;\r\nvar\r\n  eh: TJSEventTarget;\r\nbegin\r\n  if Assigned(ElementBindHandle) then\r\n  begin\r\n    eh := ElementBindHandle;\r\n\r\n    eh.removeEventListener('wheel', FWheelPtr);\r\n    eh.removeEventListener('click', FClickPtr);\r\n    eh.removeEventListener('dblclick', FDblClickPtr);\r\n    eh.removeEventListener('mousedown', FMouseDownPtr);\r\n    eh.removeEventListener('mouseup', FMouseUpPtr);\r\n    eh.removeEventListener('mousemove', FMouseMovePtr);\r\n    eh.removeEventListener('mouseleave', FMouseLeavePtr);\r\n    eh.removeEventListener('mouseenter', FMouseEnterPtr);\r\n    eh.removeEventListener('keydown', FKeyDownPtr);\r\n    eh.removeEventListener('keyup', FKeyUpPtr);\r\n    eh.removeEventListener('keypress', FKeyPressPtr);\r\n    eh.removeEventListener('focus', FEnterPtr);\r\n    eh.removeEventListener('blur', FExitPtr);\r\n    eh.removeEventListener('input', FInputPtr);\r\n\r\n    eh.removeEventListener('touchstart', FTouchStartPtr);\r\n    eh.removeEventListener('touchmove', FTouchMovePtr);\r\n    eh.removeEventListener('touchend', FTouchEndPtr);\r\n    eh.removeEventListener('touchcancel', FTouchEndPtr);\r\n\r\n    eh.removeEventListener('contextmenu', FContextMenuPtr);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UnRegisterParent(AValue: TControl);\r\nvar\r\n  i: Integer;\r\n  flg: Boolean;\r\nbegin\r\n  flg := false;\r\n\r\n  for i := 0 to Length(FControls) - 1 do\r\n  begin\r\n    if (FControls[i] = AValue) then\r\n    begin\r\n      flg := True;\r\n    end;\r\n\r\n    if (flg) and (i < Length(FControls) - 1) then\r\n      FControls[i] := FControls[i + 1];\r\n  end;\r\n\r\n  if flg then\r\n    SetLength(FControls, Length(FControls) - 1);\r\nend;\r\n\r\nprocedure TControl.UpdateAnchoring;\r\nvar\r\n  dxr,dyr: integer;\r\n  dxo,dyo: integer;\r\n  dxw,dyw: integer;\r\n  br,r: TRect;\r\nbegin\r\n  if (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  if not FControlCreated then\r\n    Exit;\r\n\r\n  if (OrigRect.Left = -1) and (OrigRect.Top = -1) then\r\n    InitAnchoring;\r\n\r\n  if Assigned(Parent) and not Parent.AnchoringInitialized then\r\n    Exit;\r\n\r\n  if (Align <> alClient) then\r\n  begin\r\n    if Assigned(Parent) and not (Self is TForm) then\r\n    begin\r\n      r := Parent.BoundsRect;\r\n\r\n      dxr := (r.Right - r.Left) - (FOrigParentRect.Right - FOrigParentRect.Left);\r\n      dyr := (r.Bottom - r.Top) - (FOrigParentRect.Bottom - FOrigParentRect.Top);\r\n\r\n      br := FOrigRect;\r\n\r\n      dxo := 0;\r\n      dyo := 0;\r\n      dxw := 0;\r\n      dyw := 0;\r\n\r\n      if (akRight in Anchors) then\r\n      begin\r\n        if (akLeft in Anchors) then\r\n          dxw := dxr\r\n        else\r\n          dxo := dxr;\r\n      end;\r\n\r\n      if (akBottom in Anchors) then\r\n      begin\r\n        if (akTop in Anchors) then\r\n          dyw := dyr\r\n        else\r\n          dyo := dyr;\r\n      end;\r\n\r\n      if (akBottom in Anchors) or (akRight in Anchors) then\r\n      begin\r\n        SetBoundsInt(br.Left + dxo, br.Top + dyo, br.Right - br.Left + dxw, br.Bottom - br.Top  + dyw);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  UpdateChildAnchoring;\r\nend;\r\n\r\nprocedure TControl.UpdateChildAnchoring;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    Controls[i].UpdateAnchoring;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UpdateChildren(AControl: TControl);\r\nvar\r\n  I: Integer;\r\n  c: TControl;\r\nbegin\r\n  if Assigned(AControl) and not (csDestroying in ComponentState) then\r\n  begin\r\n    if (AControl.Align <> alNone)  then\r\n      AControl.DoRealign;\r\n\r\n    if (AControl is TCustomControl) then\r\n    begin\r\n      (AControl as TCustomControl).RecreateCanvas;\r\n      (AControl as TCustomControl).Invalidate;\r\n    end;\r\n\r\n    for I := 0 to AControl.ControlCount - 1 do\r\n    begin\r\n      c := AControl.Controls[I];\r\n      UpdateChildren(c);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.PersistinHTML;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].PersistinHTML;\r\nend;\r\n\r\nprocedure TControl.InitFromHTML;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].InitFromHTML;\r\nend;\r\n\r\nprocedure TControl.InitScript;\r\nbegin\r\n  // script to initialize any javascript control\r\nend;\r\n\r\nprocedure TControl.PreventDefault;\r\nbegin\r\n  if Assigned(ElementEvent) then\r\n    ElementEvent.preventDefault;\r\nend;\r\n\r\nprocedure TControl.UpdateElement;\r\nbegin\r\n  if FBlockUpdateElement or (FUpdateCount > 0) then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) and (ElementHandle <> ContainerElement) and not IsUpdating then\r\n  begin\r\n    UpdateElementData;\r\n\r\n    if not IsLinked then\r\n    begin\r\n      UpdateElementVisual;\r\n    end;\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TControl.UpdateElementData;\r\nvar\r\n  frm: TCustomForm;\r\n  el: TJSHTMLElement;\r\n  AToolTip, ToolTipClass, ToolTipPos: string;\r\n  ToolTipPause, ToolTipHidePause: integer;\r\nbegin\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if not (csDesigning in ComponentState) then\r\n    begin\r\n      if Visible then\r\n        GetElementStyle.setProperty('display', '')\r\n      else\r\n        GetElementStyle.setProperty('display', 'none');\r\n    end;\r\n\r\n    EnableTab;\r\n\r\n    if IsEnabled then\r\n      FContainer.removeAttribute('disabled')\r\n    else\r\n      FContainer.setAttribute('disabled','');\r\n\r\n    if IsLinked and (Hint = '') then\r\n      Exit;\r\n\r\n    if (Role <> '') then\r\n      FContainer['role'] := FRole;\r\n\r\n    frm := GetParentForm(Self);\r\n    if Assigned(frm) and (frm.CSSLibrary = cssBootstrap) and ShowHint and (Hint <> '') then\r\n    begin\r\n      el := ElementHandle;\r\n      AToolTip := Hint;\r\n      case Application.HintPosition of\r\n      hpLeft: ToolTipPos := 'left';\r\n      hpRight: ToolTipPos := 'right';\r\n      hpTop: ToolTipPos := 'top';\r\n      hpBottom: ToolTipPos := 'bottom';\r\n      end;\r\n      ToolTipClass := Application.HintClassName;\r\n      ToolTipPause := Application.HintPause;\r\n      ToolTipHidePause := Application.HintHidePause;\r\n      asm\r\n        this.FTooltip = new bootstrap.Tooltip(el, {\r\n        title: AToolTip,\r\n        placement: ToolTipPos,\r\n        customClass: ToolTipClass,\r\n        delay: { \"show\": ToolTipPause, \"hide\": ToolTipHidePause }\r\n       });\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      if ShowHint and (Hint <> '') then\r\n         FContainer['title'] := Hint\r\n      else\r\n         FContainer.removeAttribute('title');\r\n    end;\r\n\r\n    if not IsEnabled then\r\n      GetElementStyle.removeProperty('color')\r\n    else // restore color when font color is used\r\n      if ELementFont <> efCSS then\r\n        GetElementStyle.setProperty('color',ColorToHTML(Font.Color));\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TControl.UpdateElementSize;\r\nvar\r\n  es: TJSCSSStyleDeclaration;\r\n  offsLeft,offsTop,ow: integer;\r\n  ctrl: TControl;\r\n  cr: TJSDOMRect;\r\n\r\nbegin\r\n  if FBlockUpdateElement or (FUpdateCount > 0) then\r\n    Exit;\r\n\r\n  if IsLinked then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) and (ElementHandle <> ContainerElement) then\r\n  begin\r\n    es := GetElementStyle;\r\n\r\n    offsLeft := 0;\r\n    offsTop := 0;\r\n\r\n    ctrl := Parent;\r\n    while Assigned(ctrl) and (ElementPosition = epAbsolute) and (ctrl.ElementPosition <> epAbsolute) and not (ctrl is TCustomForm) do\r\n    begin\r\n      // found in the hierarchy a free floating control, so take its position in account\r\n      if ctrl.IsLinked and Assigned(ctrl.ElementHandle) and (ctrl.ElementHandle['position'] <> 'absolute') then\r\n      begin\r\n        cr := ctrl.ElementHandle.getBoundingClientRect;\r\n        offsLeft := Round(cr.Left);\r\n        offsTop := Round(cr.Top);\r\n        break;\r\n      end;\r\n      ctrl := ctrl.Parent;\r\n    end;\r\n\r\n    if Assigned(Parent) and (Parent.IsStructuralElement) then\r\n    begin\r\n      offsLeft := Parent.Left;\r\n      offsTop := Parent.Top;\r\n    end;\r\n\r\n    if (ElementPosition = epAbsolute) then\r\n    begin\r\n      if FTop <> -1 then\r\n        es.setProperty('top', IntToStr(FTop + offsTop) + 'px')\r\n      else\r\n        es.setProperty('top', '');\r\n\r\n      if FLeft <> -1 then\r\n        es.setProperty('left', IntToStr(FLeft + offsLeft) + 'px')\r\n      else\r\n        es.setProperty('left', '');\r\n    end\r\n    else\r\n    begin\r\n      es.removeProperty('top');\r\n      es.removeProperty('left');\r\n    end;\r\n\r\n    if (FWidthStyle = ssAbsolute) then\r\n    begin\r\n      ow := GetOuterWidth;\r\n      if FWidth <> -1 then\r\n        es.setProperty('width', IntToStr(ow) + 'px')\r\n      else\r\n        es.removeProperty('width');\r\n    end;\r\n\r\n    if (FWidthStyle = ssAuto) then\r\n    begin\r\n      es.removeProperty('width');\r\n    end;\r\n\r\n    if (FHeightStyle = ssAbsolute) then\r\n    begin\r\n      if FHeight <> -1 then\r\n        es.setProperty('height', IntToStr(GetOuterHeight) + 'px')\r\n      else\r\n        es.removeProperty('height');\r\n    end;\r\n\r\n    if (FHeightStyle = ssAuto) then\r\n    begin\r\n      es.removeProperty('height');\r\n    end;\r\n\r\n    if (FWidthStyle = ssPercent) then\r\n    begin\r\n      if FWidth <> -1 then\r\n        es.setProperty('width', FormatProp('%.2f%%',[FWidthPercent]))\r\n      else\r\n        es.removeProperty('width');\r\n    end;\r\n\r\n    if (FHeightStyle = ssPercent) then\r\n    begin\r\n      if FHeight <> -1 then\r\n        es.setProperty('height', FormatProp('%.2f%%',[FHeightPercent]))\r\n      else\r\n        es.removeProperty('height');\r\n    end;\r\n\r\n    if FElementPosition = epAbsolute then\r\n      es.setProperty('position', 'absolute')\r\n    else if FElementPosition = epRelative then\r\n      es.setProperty('position', 'relative')\r\n    else\r\n      es.removeProperty('position');\r\n\r\n    es.setProperty('box-sizing','border-box');\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UpdateElementVisual;\r\nvar\r\n  eh: TJSHTMLElement;\r\n  es: TJSCSSStyleDeclaration;\r\n  useCSS: boolean;\r\nbegin\r\n  eh := ElementHandle;\r\n\r\n  if not Assigned(eh) then\r\n    Exit;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  es := GetElementStyle;\r\n\r\n//  if (csLoading in ComponentState) then\r\n//    Exit;\r\n\r\n  if ParentFont and Assigned(Parent) then\r\n  begin\r\n    Font.OnChange := nil;\r\n    Font.Assign(Parent.Font);\r\n    Font.OnChange := HandleFontChanged;\r\n  end;\r\n\r\n  if ElementClassName = '' then\r\n  begin\r\n    if ClipChildren and (LowerCase(eh.tagName) <> cBodyTag) then\r\n      es.setProperty('overflow', 'hidden')\r\n    else\r\n      es.setProperty('overflow', '');\r\n\r\n    SetElementPointer(eh, Cursor);\r\n  end;\r\n\r\n  if Captured then\r\n    TJSHTMLElement(FLayer).style.setProperty('cursor', es.getPropertyValue('cursor'));\r\n\r\n  if (ElementClassName <> '') or CanShowFocus then\r\n    es.setProperty('outline', '')\r\n  else\r\n    es.setProperty('outline', 'none');\r\n\r\n  UpdateElementSize;\r\n\r\n  case FTextDirection of\r\n  tdDefault: es.removeProperty('direction');\r\n  tdRightToLeft: es.setProperty('direction','rtl');\r\n  tdLeftToRight: es.setProperty('direction','ltr');\r\n  tdInherit: es.setProperty('direction','inherit');\r\n  end;\r\n\r\n  if (ElementClassName = '') and FNoUserSelect then\r\n  begin\r\n    es.setProperty('webkit-user-select', 'none');\r\n    es.setProperty('moz-user-select', 'none');\r\n    es.setProperty('khtml-user-select', 'none');\r\n    es.setProperty('ms-user-select', 'none');\r\n    es.setProperty('user-select', 'none');\r\n    es.setProperty('-webkit-tap-highlight-color', 'transparent');\r\n  end;\r\n\r\n  SetElementColor(eh, Color);\r\n\r\n  useCSS := not ((ElementClassName = '') and (ElementFont = efProperty) and not IsLinked);\r\n\r\n  SetHTMLElementFont(eh, Font, useCSS);\r\n\r\n  if not useCSS then\r\n  begin\r\n    if IsEnabled then\r\n      es.setProperty('color', ColorToHtml(Font.Color));\r\n  end\r\n  else\r\n  begin\r\n    es.removeProperty('color');\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UpdateParent;\r\nbegin\r\n  InternalUpdateParent;\r\n\r\n//  if (csLoading in ComponentState) and Assigned(Parent) and not (csLoading in Parent.ComponentState) then\r\n//    Loaded;\r\n\r\n  UpdateChildren(FPrevParent);\r\n  UpdateChildren(Parent);\r\nend;\r\n\r\nprocedure TControl.UpdateSize;\r\nvar\r\n  i: integer;\r\nbegin\r\n  UpdateElementSize;\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].UpdateSize;\r\nend;\r\n\r\nprocedure TControl.UpdateControlSize(AWidth, AHeight: integer);\r\nbegin\r\n  FWidth := AWidth;\r\n  FHeight := AHeight;\r\nend;\r\n\r\nprocedure TControl.VisibleChanged;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    Controls[i].VisibleChanged;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.VisibleChanging;\r\nbegin\r\n\r\nend;\r\n\r\nfunction TControl.GetBoundsRect: TRect;\r\nbegin\r\n  Result.Left := Left;\r\n  Result.Top := Top;\r\n  Result.Right := Left + Width;\r\n  Result.Bottom := Top + Height;\r\nend;\r\n\r\nfunction TControl.GetControlsCount: Integer;\r\nbegin\r\n  Result := Length(FControls);\r\nend;\r\n\r\nfunction TControl.GetCSSManager: TCSSCodeManager;\r\nvar\r\n  frm: TCustomForm;\r\n  i: integer;\r\nbegin\r\n  Result := nil;\r\n\r\n  frm := GetParentForm(Self);\r\n\r\n  if Assigned(frm) then\r\n  begin\r\n    for i := 0 to frm.ComponentCount - 1 do\r\n    begin\r\n      if frm.Components[i] is TCSSCodeManager then\r\n      begin\r\n        Result := frm.Components[i] as TCSSCodeManager;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetDesignHeight: integer;\r\nbegin\r\n  Result := FHeight;\r\nend;\r\n\r\nfunction TControl.GetDesignLeft: integer;\r\nbegin\r\n  Result := FLeft;\r\nend;\r\n\r\nfunction TControl.GetDesignTop: integer;\r\nbegin\r\n  Result := FTop;\r\nend;\r\n\r\nfunction TControl.GetDesignWidth: integer;\r\nbegin\r\n  Result := FWidth;\r\nend;\r\n\r\nfunction TControl.GetContainer: TJSElement;\r\nbegin\r\n  Result := FContainer;\r\nend;\r\n\r\nfunction TControl.GetControls(Index: Integer): TControl;\r\nbegin\r\n  Result := FControls[Index];\r\nend;\r\n\r\nprocedure TControl.DoEnter;\r\nbegin\r\n  if Assigned(OnEnter) then\r\n    OnEnter(Self);\r\nend;\r\n\r\nprocedure TControl.DoExit;\r\nbegin\r\n  if Assigned(OnExit) then\r\n    OnExit(Self);\r\nend;\r\n\r\n{ TCustomControl }\r\n\r\nprocedure TCustomControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  ControlStyle := ControlStyle + [csSetCaption];\r\n  FBorderStyle := bsSingle;\r\n  FBorderColor := clSilver;\r\n  FPainting := false;\r\n  FWidth := 100;\r\n  FHeight := 25;\r\n  FWidthPercent := 100;\r\n  FHeightPercent := 100;\r\n  FCustomBorder := false;\r\nend;\r\n\r\nprocedure TCustomControl.BindElement;\r\nbegin\r\n  if (Container.TagName <> 'CANVAS') and not FControlCreated then\r\n  begin\r\n    FElementCanvas := TJSHTMLCanvasElement(document.createElement('CANVAS'));\r\n    Container.appendChild(FElementCanvas);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.BindEvents;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomControl.CreateControl;\r\nbegin\r\n  inherited;\r\n  RecreateCanvas;\r\nend;\r\n\r\nfunction TCustomControl.CreateElement: TJSElement;\r\nbegin\r\n  FElementCanvas := TJSHTMLCanvasElement(document.createElement('CANVAS'));\r\n  if csAcceptsControls in ControlStyle then\r\n  begin\r\n    Result := document.createElement('SPAN');\r\n    Result.appendChild(FElementCanvas);\r\n    if ElementID <> '' then\r\n      FElementCanvas['id'] := ElementID + '_Canvas';\r\n    FElementCanvas['zindex'] := '-1';\r\n  end\r\n  else\r\n    Result := FElementCanvas;\r\nend;\r\n\r\ndestructor TCustomControl.Destroy;\r\nbegin\r\n  if Assigned(FCanvas) then\r\n    FCanvas.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomControl.EndUpdate;\r\nbegin\r\n  inherited;\r\n  if FUpdateCount = 0 then\r\n    Invalidate;\r\nend;\r\n\r\nfunction TCustomControl.Focused: boolean;\r\nbegin\r\n  Result := inherited Focused;\r\nend;\r\n\r\nfunction TCustomControl.GetCanvas: TCanvas;\r\nbegin\r\n  if not Assigned(FCanvas) then\r\n  begin\r\n    if not IsLinked then\r\n      CreateControl\r\n    else\r\n    begin\r\n      if not Assigned(FElementCanvas) then\r\n        FElementCanvas := TJSHTMLCanvasElement(document.getElementById(ElementID));\r\n      RecreateCanvas;\r\n    end;\r\n\r\n  end;\r\n  Result := FCanvas;\r\nend;\r\n\r\nfunction TCustomControl.GetCanvasHeightOffset: Integer;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nfunction TCustomControl.GetCanvasWidthOffset: Integer;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nfunction TCustomControl.GetContext: TJSCanvasRenderingContext2D;\r\nvar\r\n  ctx: TJSCanvasRenderingContext2D;\r\nbegin\r\n  {$IFDEF PAS2JS}\r\n  asm\r\n    ctx = this.FElementCanvas.getContext(\"2d\");\r\n  end;\r\n  {$ENDIF}\r\n\r\n  Result := ctx;\r\nend;\r\n\r\nfunction TCustomControl.GetPixelRatio: Single;\r\nvar\r\n  res: single;\r\nbegin\r\n  {$IFDEF PAS2JS}\r\n  asm\r\n    var ctx = document.createElement(\"canvas\").getContext(\"2d\"),\r\n        dpr = window.devicePixelRatio || 1,\r\n        bsr = ctx.webkitBackingStorePixelRatio ||\r\n              ctx.mozBackingStorePixelRatio ||\r\n              ctx.msBackingStorePixelRatio ||\r\n              ctx.oBackingStorePixelRatio ||\r\n              ctx.backingStorePixelRatio || 1;\r\n    res = dpr / bsr\r\n  end;\r\n  {$ENDIF}\r\n\r\n  Result := res;\r\nend;\r\n\r\nprocedure TCustomControl.Invalidate;\r\nvar\r\n  px: Single;\r\n  frm: TCustomForm;\r\nbegin\r\n  inherited;\r\n\r\n  if (Parent = nil) or (csDestroying in ComponentState) then\r\n    Exit;\r\n\r\n  if not Visible then\r\n    Exit;\r\n\r\n  if FUpdateCount > 0 then\r\n    Exit;\r\n\r\n  frm := GetParentForm(Self);\r\n  if Assigned(frm) then\r\n    if frm.IsUpdating then\r\n      Exit;\r\n\r\n  px := GetPixelRatio;\r\n  if (px <> FPixelRatio) then\r\n    RecreateCanvas;\r\n\r\n  FPixelRatio := GetPixelRatio;\r\n\r\n  FPainting := true;\r\n\r\n  if Assigned(FCanvas) then\r\n    FCanvas.Clear;\r\n\r\n  Paint;\r\n  FPainting := false;\r\nend;\r\n\r\nprocedure TCustomControl.Loaded;\r\nbegin\r\n  inherited;\r\n  Invalidate;\r\nend;\r\n\r\nfunction TCustomControl.MakeScreenShot: TBitmap;\r\nbegin\r\n  Result := TBitmap.Create;\r\n  Result.OnChange := HandleScreenshot;\r\n  Result.LoadFromCanvas(Canvas);\r\nend;\r\n\r\nprocedure TCustomControl.HandleScreenShot(Sender: TObject);\r\nbegin\r\n  if Assigned(OnScreenshot) then\r\n    OnScreenshot(Self, TBitmap(Sender));\r\nend;\r\n\r\nprocedure TCustomControl.Paint;\r\nbegin\r\n  \r\nend;\r\n\r\nprocedure TCustomControl.RecreateCanvas;\r\nvar\r\n  px: Single;\r\n  el: TJSHTMLCanvasElement;\r\n  h, w: Integer;\r\nbegin\r\n  if Assigned(FElementCanvas) then\r\n  begin\r\n    if not FPainting then\r\n    begin\r\n      if IsLinked then\r\n      begin\r\n        el := TJSHTMLCanvasElement(ElementHandle);\r\n      end\r\n      else\r\n        el := TJSHTMLCanvasElement(document.getElementByID(GetID+'_Canvas'));\r\n\r\n      // it is already found\r\n      if Assigned(el) then\r\n      begin\r\n        FElementCanvas := el;\r\n        FCanvas.Free;\r\n        FCanvas := nil;\r\n      end;\r\n\r\n      px := GetPixelRatio;\r\n      h := Height - GetCanvasHeightOffset;\r\n      w := Width - GetCanvasWidthOffset;\r\n\r\n      if ElementPosition = epRelative then\r\n        FElementCanvas.style.setProperty('position', 'relative')\r\n      else\r\n        FElementCanvas.style.setProperty('position', 'absolute');\r\n\r\n      FElementCanvas.style.setProperty('height', IntToStr(h) + 'px');\r\n      FElementCanvas.style.setProperty('width', IntToStr(w) + 'px');\r\n      FElementCanvas.height := Round(h * px);\r\n      FElementCanvas.width := Round(w * px);\r\n    end;\r\n\r\n    if not Assigned(FCanvas) then\r\n    begin\r\n      FCanvas := TCanvas.Create(FElementCanvas);\r\n    end;\r\n\r\n    FCanvas.ApplyPixelRatio := True;\r\n    FCanvas.SetTransform(1, 0, 0, 1, 0, 0);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.RenderDesigning(ACaption: string; AElement: TJSElement;\r\n  AControl: TCustomControl; ADisplay: Boolean; AImage: string);\r\nvar\r\n  LContainer, LLabel, LDiv: TJSHTMLElement;\r\n  LHasLabel: boolean;\r\nbegin\r\n  LContainer := TJSHTMLElement(AElement);\r\n  LLabel := TJSHTMLElement(LContainer.firstChild);\r\n  LHasLabel := Assigned(LLabel) and (LLabel.tagName = 'DIV') and (LLabel.getAttribute('data-design') = '1');\r\n\r\n  if (csDesigning in AControl.ComponentState) and (ADisplay) and (ElementClassName = '') then\r\n  begin\r\n    LContainer.style.setProperty('border','1px solid gray');\r\n\r\n    if AImage = '' then\r\n      LContainer.style.setProperty('background-color','#F0F0F0')\r\n    else\r\n      LContainer.style.setProperty('background-color','white');\r\n\r\n    if LHasLabel then\r\n      Exit;\r\n\r\n    LContainer.innerHTML := '';\r\n\r\n    if AImage <> '' then\r\n    begin\r\n      LDiv := TJSHTMLElement(document.createElement('DIV'));\r\n      LDiv.style.setProperty('background-color','white');\r\n      LDiv.style.setProperty('background-repeat','no-repeat');\r\n      LDiv.style.setProperty('background-position-y','center');\r\n      LDiv.style.setProperty('background-image', 'url('+AImage+')');\r\n      LDiv.style.setProperty('background-position-x','center');\r\n      LDiv.style.setProperty('background-size','128px');\r\n      LDiv.style.setProperty('top','50%');\r\n      LDiv.style.setProperty('left','50%');\r\n      LDiv.style.setProperty('height','70%');\r\n      LContainer.appendChild(LDiv);\r\n    end;\r\n\r\n    LLabel := TJSHTMLElement(document.createElement('DIV'));\r\n    LLabel.setAttribute('data-design','1');\r\n    LLabel.innerHTML := ACaption;\r\n    LLabel.style.setProperty('position','relative');\r\n    LLabel.style.setProperty('top','50%');\r\n    LLabel.style.setProperty('left','50%');\r\n    LLabel.style.setProperty('display','inline-block');\r\n    LLabel.style.setProperty('transform','translateX(-50%)');\r\n\r\n    CustomBorder := True;\r\n    LContainer.appendChild(LLabel);\r\n  end\r\n  else\r\n  begin\r\n    if LHasLabel then\r\n    begin\r\n      while Assigned(LContainer.firstChild) do\r\n        LContainer.removeChild(LContainer.firstChild);\r\n\r\n      LContainer.style.removeProperty('border');\r\n      LContainer.style.removeProperty('background-color');\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.Resize;\r\nbegin\r\n  inherited;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TCustomControl.SetBorderColor(const AValue: TColor);\r\nbegin\r\n  if (FBorderColor <> AValue) then\r\n  begin\r\n    FBorderColor := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.SetBorderStyle(const AValue: TBorderStyle);\r\nbegin\r\n  if FBorderStyle <> AValue then\r\n  begin\r\n    FBorderStyle := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.SetCaption(const AValue: string);\r\nbegin\r\n  FCaption := AValue;\r\n  ControlStyle := ControlStyle - [csSetCaption];\r\nend;\r\n\r\nprocedure TCustomControl.SetFocus;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomControl.SetName(const NewName: TComponentName);\r\nvar\r\n  cs: TControlStyle;\r\n  ownername: string;\r\nbegin\r\n  ownername := '';\r\n\r\n  if not (Assigned(VSIDE) and (csDesigning in ComponentState)) then\r\n  begin\r\n    if (Self is TFrame) then\r\n    begin\r\n      ownername := 'F' + FindUniqueName(Name) + '_';\r\n    end;\r\n  end;\r\n\r\n  inherited SetName(ownername + NewName);\r\n\r\n  if (csSetCaption in ControlStyle) and (csDesigning in ComponentState) and not (csLoading in ComponentState) then\r\n  begin\r\n    if Assigned(Owner) and (csLoading in Owner.ComponentState) then\r\n      Exit;\r\n\r\n    cs := ControlStyle;\r\n    SetCaption(NewName);\r\n    ControlStyle := cs;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if not IsLinked and (ElementClassName = '') then\r\n    begin\r\n      if BorderStyle = bsSingle then // default border style\r\n      begin\r\n        if CustomBorder then\r\n        begin\r\n          GetElementStyle.setProperty('border-style', 'solid');\r\n          GetElementStyle.setProperty('border-width', '1px');\r\n          GetElementStyle.setProperty('border-color', ColorToHTML(BorderColor));\r\n        end\r\n        else\r\n          GetElementStyle.setProperty('border-style', '')\r\n      end\r\n      else\r\n        GetElementStyle.setProperty('border-style', 'none');\r\n    end;\r\n\r\n    if (ElementClassName <> '') then\r\n    begin\r\n      GetElementStyle.removeProperty('border-style');\r\n      GetElementStyle.removeProperty('border-width');\r\n      GetElementStyle.removeProperty('border-color');\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TScrollingGraphicControl }\r\n\r\nprocedure TScrollingGraphicControl.UpdateElement;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n    ElementHandle.style.setProperty('overflow', 'auto');\r\nend;\r\n\r\n\r\nfunction TScrollingGraphicControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\n{ TMargins }\r\n\r\nprocedure TMargins.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TMargins then\r\n  begin\r\n    FLeft := (Source as TMargins).Left;\r\n    FTop := (Source as TMargins).Top;\r\n    FBottom := (Source as TMargins).Bottom;\r\n    FRight := (Source as TMargins).Right;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nconstructor TMargins.Create;\r\nbegin\r\n  FLeft := 3;\r\n  FTop := 3;\r\n  FBottom := 3;\r\n  FRight := 3;\r\nend;\r\n\r\n{ TControlManager }\r\n\r\nconstructor TControlManager.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FInstanceCount := 0;\r\nend;\r\n\r\nfunction TControlManager.GetInstanceNumber: integer;\r\nbegin\r\n  Inc(FInstanceCount);\r\n  Result := FInstanceCount;\r\nend;\r\n\r\nprocedure TControlManager.Reset;\r\nbegin\r\n  FInstanceCount := 0;\r\nend;\r\n\r\n{ TCSSCodeFragment }\r\n\r\nconstructor TCSSCodeFragment.Create(Collection: TCollection);\r\nbegin\r\n  inherited;\r\n  FCSS := TStringList.Create;\r\nend;\r\n\r\ndestructor TCSSCodeFragment.Destroy;\r\nbegin\r\n  FCSS.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCSSCodeFragment.SetCSS(const Value: TStringList);\r\nbegin\r\n  FCSS.Assign(Value);\r\nend;\r\n\r\n{ TCSSCodeFragments }\r\n\r\nfunction TCSSCodeFragments.Add: TCSSCodeFragment;\r\nbegin\r\n  Result := TCSSCodeFragment(inherited Add);\r\nend;\r\n\r\nconstructor TCSSCodeFragments.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TCSSCodeFragment);\r\nend;\r\n\r\nfunction TCSSCodeFragments.GetItemEx(Index: integer): TCSSCodeFragment;\r\nbegin\r\n  Result := TCSSCodeFragment(inherited Items[Index]);\r\nend;\r\n\r\nfunction TCSSCodeFragments.Insert(Index: integer): TCSSCodeFragment;\r\nbegin\r\n  Result := TCSSCodeFragment(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TCSSCodeFragments.SetItemEx(Index: integer;\r\n  const Value: TCSSCodeFragment);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TCSSCodeManager }\r\n\r\nconstructor TCSSCodeManager.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FCSSFragments := TCSSCodeFragments.Create(Self);\r\n  FCSSFragments.PropName := 'CSSFragments';\r\nend;\r\n\r\ndestructor TCSSCodeManager.Destroy;\r\nbegin\r\n  FCSSFragments.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TCSSCodeManager.GetClassCSS(AClassname: string): string;\r\nvar\r\n  CSSCodeFragment: TCSSCodeFragment;\r\nbegin\r\n  Result := '';\r\n\r\n  CSSCodeFragment := GetClassFragment(AClassName);\r\n\r\n  if Assigned(CSSCodeFragment) then\r\n    Result := CSSCodeFragment.CSS.Text;\r\nend;\r\n\r\nfunction TCSSCodeManager.GetClassFragment(AClassname: string): TCSSCodeFragment;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := nil;\r\n  for i := 0 to CSSFragments.Count - 1 do\r\n  begin\r\n    if CSSFragments.Items[i].ControlClassName = AClassname then\r\n      Result := CSSFragments.Items[i];\r\n  end;\r\nend;\r\n\r\nprocedure TCSSCodeManager.SetCSSFragments(const Value: TCSSCodeFragments);\r\nbegin\r\n  FCSSFragments.Assign(Value);\r\nend;\r\n\r\n{ TjQueryCustomContol }\r\n\r\nfunction TjQueryCustomControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\nprocedure TjQueryCustomControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FIsInitialized := false;\r\nend;\r\n\r\nfunction TjQueryCustomControl.GetJQID: string;\r\nbegin\r\n  Result := '#' + GetID;\r\nend;\r\n\r\nprocedure TjQueryCustomControl.InitJQuery;\r\nbegin\r\n  //\r\nend;\r\n\r\nprocedure TjQueryCustomControl.InitJQueryOnce;\r\nbegin\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if FIsInitialized then\r\n    Exit;\r\n\r\n  FIsInitialized := true;\r\n  InitJQuery;\r\nend;\r\n\r\nprocedure TjQueryCustomControl.Loaded;\r\nbegin\r\n  inherited;\r\n  InitJQueryOnce;\r\nend;\r\n\r\nprocedure TjQueryCustomControl.SetParent(AValue: TControl);\r\nbegin\r\n  inherited;\r\n  InitJQueryOnce;\r\nend;\r\n\r\n{ TPadding }\r\n\r\nprocedure TPadding.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TPadding) then\r\n  begin\r\n    FLeft := (Source as TPadding).Left;\r\n    FRight := (Source as TPadding).Right;\r\n    FTop := (Source as TPadding).Top;\r\n    FBottom := (Source as TPadding).Bottom;\r\n  end;\r\nend;\r\n\r\nconstructor TPadding.Create;\r\nbegin\r\n  inherited;\r\n  FLeft := 0;\r\n  FTop := 0;\r\n  FRight := 0;\r\n  FBottom := 0;\r\nend;\r\n\r\nprocedure TPadding.DoChange;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TPadding.SetBottom(const Value: integer);\r\nbegin\r\n  if (FBottom <> Value) then\r\n  begin\r\n    FBottom := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TPadding.SetLeft(const Value: integer);\r\nbegin\r\n  if (FLeft <> Value) then\r\n  begin\r\n    FLeft := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TPadding.SetRight(const Value: integer);\r\nbegin\r\n  if (FRight <> Value) then\r\n  begin\r\n    FRight := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TPadding.SetTop(const Value: integer);\r\nbegin\r\n  if (FTop <> Value) then\r\n  begin\r\n    FTop := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\n{ TCustomHTMLDiv }\r\n\r\nfunction TCustomHTMLDiv.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\n{ TControlScrollBar }\r\n\r\nconstructor TControlScrollBar.Create(AControl: TControl; AKind: TScrollBarKind);\r\nbegin\r\n  inherited;\r\n  FControl := AControl;\r\n  FKind := AKind;\r\nend;\r\n\r\nfunction TControlScrollBar.IsScrollBarVisible: boolean;\r\nbegin\r\n  Result := false;\r\n\r\n  if Assigned(FControl.ELementHandle) then\r\n  begin\r\n    if Kind = sbVertical then\r\n      Result := TJSHTMLElement(FControl.ElementHandle).ScrollHeight > TJSHTMLElement(FControl.ElementHandle).ClientHeight\r\n    else\r\n      Result := TJSHTMLElement(FControl.ElementHandle).ScrollWidth > TJSHTMLElement(FControl.ElementHandle).ClientWidth;\r\n  end;\r\nend;\r\n\r\nfunction TControlScrollBar.Range: integer;\r\nbegin\r\n  Result := 0;\r\n  if Assigned(FControl.ELementHandle) then\r\n  begin\r\n    if Kind = sbVertical then\r\n      Result := TJSHTMLElement(FControl.ElementHandle).ScrollHeight\r\n    else\r\n      Result := TJSHTMLElement(FControl.ElementHandle).ScrollWidth;\r\n  end;\r\nend;\r\n\r\nfunction TControlScrollBar.ScrollPos: integer;\r\nbegin\r\n  Result := 0;\r\n  if Assigned(FControl.ELementHandle) then\r\n  begin\r\n    if Kind = sbVertical then\r\n      Result := FControl.ElementHandle.scrollTop\r\n    else\r\n      Result := FControl.ElementHandle.scrollLeft;\r\n  end;\r\nend;\r\n\r\ninitialization\r\n  ScrollBW := 0;\r\n  ScrollBH := 0;\r\n  DragObject := nil;\r\n  ControlManager := TControlManager.Create(nil);\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2022                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Graphics;\r\n\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, Types, Web, JS;\r\n\r\nconst\r\n  WEBDEFAULTFONT = 'Arial';\r\n  SysDefault = $20000000;\r\n\r\n  clNone = -1;\r\n  clBlack = $000000;\r\n  clMaroon = $000080;\r\n  clGreen = $008000;\r\n  clOlive = $008080;\r\n  clNavy = $800000;\r\n  clPurple = $800080;\r\n  clTeal = $808000;\r\n  clGray = $808080;\r\n  clSilver = $C0C0C0;\r\n  clRed = $0000FF;\r\n  clLime = $00FF00;\r\n  clYellow = $00FFFF;\r\n  clBlue = $FF0000;\r\n  clFuchsia = $FF00FF;\r\n  clAqua = $FFFF00;\r\n  clLtGray = $C1C1C1;\r\n  clDkGray = $818181;\r\n  clWhite = $FFFFFF;\r\n  clMoneyGreen = $C0DCC0;\r\n  clSkyBlue = $F0CAA6;\r\n  clCream = $F0FBFF;\r\n  clMedGray = $A0A0A0;\r\n\r\n  clDefault = SysDefault;\r\n  clBtnFace = $F0F0F0;\r\n  clWindowText = $010101;\r\n  clWindow = $FEFEFE;\r\n  clHighlight = $D77800;\r\n  clHighlightText = $030303;\r\n  clInfoText = $020202;\r\n  clInfoBk = $E1FFFF;\r\n  clActiveCaption = $D1B499;\r\n  clInactiveCaption =  $DBCDBF;\r\n  clInactiveCaptionText = $000000;\r\n  clHotLight = $CC6600;\r\n\r\n  clScrollBar = $C8C8C8;\r\n  clBackground = clBtnFace;\r\n  clMenu = clBtnFace;\r\n  clWindowFrame = $646464;\r\n  clMenuText = clBlack;\r\n  clCaptionText = clWhite;\r\n  clActiveBorder = $B4B4B4;\r\n  clAppWorkSpace = $ABABAB;\r\n  clBtnShadow = $A0A0A0;\r\n  clGrayText = $6D6D6D;\r\n  clBtnText = clBlack;\r\n  clBtnHighlight = clWhite;\r\n  cl3DDkShadow = $696969;\r\n  cl3DLight = $E3E3E3;\r\n  clMenuHighlight = $D77800;\r\n  clMenuBar = $F0F0F0;\r\n\r\n\r\n  clWebAliceblue = $FFF8F0;\r\n  clWebAntiquewhite = $D7EBFA;\r\n  clWebAqua = $FFFF00;\r\n  clWebAquamarine = $D4FF7F;\r\n  clWebAzure = $FFFFF0;\r\n  clWebBeige = $DCF5F5;\r\n  clWebBisque = $C4E4FF;\r\n  clWebBlack = $000000;\r\n  clWebBlanchedalmond = $CDEBFF;\r\n  clWebBlue = $FF0000;\r\n  clWebBlueviolet = $E22B8A;\r\n  clWebBrown = $2A2AA5;\r\n  clWebBurlywood = $87B8DE;\r\n  clWebCadetblue = $A09E5F;\r\n  clWebChartreuse = $00FF7F;\r\n  clWebChocolate = $1E69D2;\r\n  clWebCoral = $507FFF;\r\n  clWebCornflowerblue = $ED9564;\r\n  clWebCornsilk = $DCF8FF;\r\n  clWebCrimson = $3C14DC;\r\n  clWebCyan = $FFFF00;\r\n  clWebDarkblue = $8B0000;\r\n  clWebDarkcyan = $8B8B00;\r\n  clWebDarkgoldenrod = $0B86B8;\r\n  clWebDarkgray = $A9A9A9;\r\n  clWebDarkgreen = $006400;\r\n  clWebDarkgrey = $A9A9A9;\r\n  clWebDarkkhaki = $6BB7BD;\r\n  clWebDarkmagenta = $8B008B;\r\n  clWebDarkolivegreen = $2F6B55;\r\n  clWebDarkorange = $008CFF;\r\n  clWebDarkorchid = $CC3299;\r\n  clWebDarkred = $00008B;\r\n  clWebDarksalmon = $7A96E9;\r\n  clWebDarkseagreen = $8FBC8F;\r\n  clWebDarkslateblue = $8B3D48;\r\n  clWebDarkslategray = $4F4F2F;\r\n  clWebDarkslategrey = $4F4F2F;\r\n  clWebDarkturquoise = $D1CE00;\r\n  clWebDarkviolet = $D30094;\r\n  clWebDeeppink = $9314FF;\r\n  clWebDeepskyblue = $FFBF00;\r\n  clWebDimgray = $696969;\r\n  clWebDimgrey = $696969;\r\n  clWebDodgerblue = $FF901E;\r\n  clWebFirebrick = $2222B2;\r\n  clWebFloralwhite = $F0FAFF;\r\n  clWebForestgreen = $228B22;\r\n  clWebFuchsia = $FF00FF;\r\n  clWebGainsboro = $DCDCDC;\r\n  clWebGhostwhite = $FFF8F8;\r\n  clWebGold = $00D7FF;\r\n  clWebGoldenrod = $20A5DA;\r\n  clWebGray = $808080;\r\n  clWebGreen = $008000;\r\n  clWebGreenyellow = $2FFFAD;\r\n  clWebGrey = $808080;\r\n  clWebHoneydew = $F0FFF0;\r\n  clWebHotpink = $B469FF;\r\n  clWebIndianred = $5C5CCD;\r\n  clWebIndigo = $82004B;\r\n  clWebIvory = $F0FFFF;\r\n  clWebKhaki = $8CE6F0;\r\n  clWebLavender = $FAE6E6;\r\n  clWebLavenderblush = $F5F0FF;\r\n  clWebLawngreen = $00FC7C;\r\n  clWebLemonchiffon = $CDFAFF;\r\n  clWebLightblue = $E6D8AD;\r\n  clWebLightcoral = $8080F0;\r\n  clWebLightcyan = $FFFFE0;\r\n  clWebLightgoldenrodyellow = $D2FAFA;\r\n  clWebLightgray = $D3D3D3;\r\n  clWebLightgreen = $90EE90;\r\n  clWebLightgrey = $D3D3D3;\r\n  clWebLightpink = $C1B6FF;\r\n  clWebLightsalmon = $7AA0FF;\r\n  clWebLightseagreen = $AAB220;\r\n  clWebLightskyblue = $FACE87;\r\n  clWebLightslategray = $998877;\r\n  clWebLightslategrey = $998877;\r\n  clWebLightsteelblue = $DEC4B0;\r\n  clWebLightyellow = $E0FFFF;\r\n  clWebLtGray = $C0C0C0;\r\n  clWebMedGray = $A4A0A0;\r\n  clWebDkGray = $808080;\r\n  clWebMoneyGreen = $C0DCC0;\r\n  clWebLegacySkyBlue = $F0CAA6;\r\n  clWebCream = $F0FBFF;\r\n  clWebLime = $00FF00;\r\n  clWebLimegreen = $32CD32;\r\n  clWebLinen = $E6F0FA;\r\n  clWebMagenta = $FF00FF;\r\n  clWebMaroon = $000080;\r\n  clWebMediumaquamarine = $AACD66;\r\n  clWebMediumblue = $CD0000;\r\n  clWebMediumorchid = $D355BA;\r\n  clWebMediumpurple = $DB7093;\r\n  clWebMediumseagreen = $71B33C;\r\n  clWebMediumslateblue = $EE687B;\r\n  clWebMediumspringgreen = $9AFA00;\r\n  clWebMediumturquoise = $CCD148;\r\n  clWebMediumvioletred = $8515C7;\r\n  clWebMidnightblue = $701919;\r\n  clWebMintcream = $FAFFF5;\r\n  clWebMistyrose = $E1E4FF;\r\n  clWebMoccasin = $B5E4FF;\r\n  clWebNavajowhite = $ADDEFF;\r\n  clWebNavy = $800000;\r\n  clWebOldlace = $E6F5FD;\r\n  clWebOlive = $008080;\r\n  clWebOlivedrab = $238E6B;\r\n  clWebOrange = $00A5FF;\r\n  clWebOrangered = $0045FF;\r\n  clWebOrchid = $D670DA;\r\n  clWebPalegoldenrod = $AAE8EE;\r\n  clWebPalegreen = $98FB98;\r\n  clWebPaleturquoise = $EEEEAF;\r\n  clWebPalevioletred = $9370DB;\r\n  clWebPapayawhip = $D5EFFF;\r\n  clWebPeachpuff = $B9DAFF;\r\n  clWebPeru = $3F85CD;\r\n  clWebPink = $CBC0FF;\r\n  clWebPlum = $DDA0DD;\r\n  clWebPowderblue = $E6E0B0;\r\n  clWebPurple = $800080;\r\n  clWebRed = $0000FF;\r\n  clWebRosybrown = $8F8FBC;\r\n  clWebRoyalblue = $E16941;\r\n  clWebSaddlebrown = $13458B;\r\n  clWebSalmon = $7280FA;\r\n  clWebSandybrown = $60A4F4;\r\n  clWebSeagreen = $578B2E;\r\n  clWebSeashell = $EEF5FF;\r\n  clWebSienna = $2D52A0;\r\n  clWebSilver = $C0C0C0;\r\n  clWebSkyblue = $EBCE87;\r\n  clWebSlateblue = $CD5A6A;\r\n  clWebSlategray = $908070;\r\n  clWebSlategrey = $908070;\r\n  clWebSnow = $FAFAFF;\r\n  clWebSpringgreen = $7FFF00;\r\n  clWebSteelblue = $B48246;\r\n  clWebTan = $8CB4D2;\r\n  clWebTeal = $808000;\r\n  clWebThistle = $D8BFD8;\r\n  clWebTomato = $4763FF;\r\n  clWebTurquoise = $D0E040;\r\n  clWebViolet = $EE82EE;\r\n  clWebWheat = $B3DEF5;\r\n  clWebWhite = $FFFFFF;\r\n  clWebWhitesmoke = $F5F5F5;\r\n  clWebYellow = $00FFFF;\r\n  clWebYellowgreen = $32CD9A;\r\n\r\n  clInactiveBorder = $FCF7F4;\r\n\r\n  ANSI_CHARSET = 0;\r\n  DEFAULT_CHARSET = 1;\r\n  SYMBOL_CHARSET = 2;\r\n  MAC_CHARSET = 77;\r\n  SHIFTJIS_CHARSET = 128;\r\n  HANGEUL_CHARSET = 129;\r\n  JOHAB_CHARSET = 130;\r\n  GB2312_CHARSET = 134;\r\n  CHINESEBIG5_CHARSET = 136;\r\n  GREEK_CHARSET = 161;\r\n  TURKISH_CHARSET = 162;\r\n  HEBREW_CHARSET = 177;\r\n  ARABIC_CHARSET = 178;\r\n  BALTIC_CHARSET = 186;\r\n  RUSSIAN_CHARSET = 204;\r\n  THAI_CHARSET = 222;\r\n  EASTEUROPE_CHARSET = 238;\r\n  OEM_CHARSET = 255;\r\n\r\ntype\r\n  TColor = type NativeInt;\r\n\r\n  TVerticalAlignment = (taAlignTop, taAlignBottom, taVerticalCenter);\r\n\r\n  TPenStyle = (psSolid, psDash, psDot, psDashDot, psDashDotDot, psClear,\r\n    psInsideFrame, psUserStyle, psAlternate);\r\n\r\n  TPenMode = (pmBlack, pmWhite, pmNop, pmNot, pmCopy, pmNotCopy,\r\n    pmMergePenNot, pmMaskPenNot, pmMergeNotPen, pmMaskNotPen, pmMerge,\r\n    pmNotMerge, pmMask, pmNotMask, pmXor, pmNotXor);\r\n\r\n  TBrushStyle = (bsSolid, bsClear, bsHorizontal, bsVertical,\r\n    bsFDiagonal, bsBDiagonal, bsCross, bsDiagCross);\r\n\r\n  TBrushGradient = (bgNone, bgLinearVert, bgLinearHorz, bgRadial);\r\n\r\n  TFontStyle = (fsBold, fsItalic, fsStrikeOut, fsUnderline);\r\n\r\n  TFontStyles = set of TFontStyle;\r\n\r\n  TFontCharset = 0..255;\r\n\r\n  TBinaryString = type string;\r\n\r\n  TCanvasPointF = record\r\n    X: Double;\r\n    Y: Double;\r\n  end;\r\n\r\n  TCanvasRectF = record\r\n    Left, Top, Right, Bottom: Double;\r\n  end;\r\n\r\n  TCanvasSizeF = record\r\n    cx: Double;\r\n    cy: Double;\r\n  end;\r\n\r\n  TPen = class(TPersistent)\r\n  private\r\n    FWidth: Integer;\r\n    FColor: TColor;\r\n    FStyle: TPenStyle;\r\n    FMode: TPenMode;\r\n    procedure SetColor(const Value: TColor);\r\n  public\r\n    constructor Create; reintroduce;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Color: TColor read FColor write SetColor;\r\n    property Mode: TPenMode read FMode write FMode default pmCopy;\r\n    property Width: Integer read FWidth write FWidth default 1;\r\n    property Style: TPenStyle read FStyle write FStyle default psSolid;\r\n  end;\r\n\r\n  TGradientColor = class(TPersistent)\r\n  private\r\n    FColor: TColor;\r\n    FStop: single;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create; reintroduce;\r\n  published\r\n    property Stop: single read FStop write FStop;\r\n    property Color: TColor read FColor write FColor default clNone;\r\n  end;\r\n\r\n  TBrush = class(TPersistent)\r\n  private\r\n    FColor: TColor;\r\n    FStyle: TBrushStyle;\r\n    FGradientColors: TList;\r\n    FGradient: TBrushGradient;\r\n  public\r\n    constructor Create; reintroduce;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure AddGradientColor(AColor: TColor; AStop: single);\r\n    procedure GetGradientColor(AIndex: integer; var AColor: TColor; var AStop: single);\r\n    function GradientCount: integer;\r\n    procedure ClearGradient;\r\n  published\r\n    property Gradient: TBrushGradient read FGradient write FGradient;\r\n    property Color: TColor read FColor write FColor;\r\n    property Style: TBrushStyle read FStyle write FStyle;\r\n  end;\r\n\r\n  TFont = class(TPersistent)\r\n  private\r\n    FName: string;\r\n    FSize: Integer;\r\n    FColor: TColor;\r\n    FStyle: TFontStyles;\r\n    FOnChange: TNotifyEvent;\r\n    FHeight: Integer;\r\n    FCharset: TFontCharset;\r\n    FOrientation: integer;\r\n    procedure SetHeight(const Value: Integer);\r\n  protected\r\n    procedure SetName(const AName: string);\r\n    procedure SetSize(const ASize: Integer);\r\n    procedure SetColor(const AColor: TColor);\r\n    procedure SetStyle(const AStyle: TFontStyles);\r\n    procedure DoChange; virtual;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create; reintroduce;\r\n    function ToString: string; override;\r\n    property Orientation: integer read FOrientation write FOrientation;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  published\r\n    property Charset: TFontCharset read FCharset write FCharset;\r\n    property Name: string read FName write SetName;\r\n    property Height: Integer read FHeight write SetHeight;\r\n    property Style: TFontStyles read FStyle write SetStyle;\r\n    property Color: TColor read FColor write SetColor;\r\n    property Size: Integer read FSize write SetSize;\r\n  end;\r\n\r\n  TImageType = (itBase64, itBMP, itPNG, itJPEG, itGIF, itSVG);\r\n\r\n  TCanvas = class;\r\n\r\n  TBitmap = class;\r\n\r\n  TBitmapLoadedProc = reference to procedure;\r\n\r\n  TGraphic = class(TPersistent)\r\n  private\r\n    FAddToQueue: Boolean;\r\n    FCanvasElement: TJSHTMLCanvasElement;\r\n    FEmpty: Boolean;\r\n    FData: string;\r\n    FDataBin: TBinaryString;\r\n    FCanvas: TCanvas;\r\n    FOnChange: TNotifyEvent;\r\n    FImage: TJSObject;\r\n    FBitmap: TBitmap;\r\n    FURL: String;\r\n    FLoaded: TBitmapLoadedProc;\r\n    FUsedCanvas: boolean;\r\n    procedure SetHeight(const Value: Integer);\r\n    procedure SetWidth(const Value: Integer);\r\n    function GetCanvas: TCanvas;\r\n    function GetData: TBinaryString;\r\n    procedure SetData(const Value: TBinaryString);\r\n  protected\r\n    procedure DoChange;\r\n    procedure SetURL(const URL: string);\r\n    function GetWidth: Integer;\r\n    function GetHeight: Integer;\r\n    procedure RecreateCanvas;\r\n    procedure DoBeginScene(Sender: TObject);\r\n    procedure DoEndScene(Sender: TObject);\r\n    procedure AssignEvents;\r\n    procedure CreateImage;\r\n    procedure LoadFromCache(AData: String; ALoaded: TBitmapLoadedProc = nil);\r\n  public\r\n    class function CreateFromResource(AResource: String): TGraphic; overload;\r\n    class function CreateFromResource(AResource: String; AInstance: NativeUInt): TGraphic; overload;\r\n    class function CreateFromURL(AURL: String): TGraphic; overload;\r\n    class function CreateFromURL(AURL: String; AInstance: NativeUInt): TGraphic; overload;\r\n    function Image: TJSObject;\r\n    function Empty: Boolean;\r\n    function GetBase64Image: string;\r\n    function GetAsImage(AType: TImageType = itBase64): string;\r\n    constructor Create(URL: string); overload;\r\n    constructor Create(Img: TJSObject); overload;\r\n    constructor Create; overload; reintroduce;\r\n    property Width: Integer read GetWidth write SetWidth;\r\n    property Height: Integer read GetHeight write SetHeight;\r\n    procedure CaptureCanvas; virtual;\r\n    procedure LoadFromCanvas(ACanvas: TCanvas); virtual;\r\n    procedure SetSize(AWidth, AHeight: Integer);\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure LoadFromURL(AURL: string; ALoaded: TBitmapLoadedProc = nil); virtual; overload;\r\n    procedure LoadFromURL(AURL: string; AHInstance: Integer; ALoaded: TBitmapLoadedProc = nil); virtual; overload;\r\n    procedure LoadFromFile(AFileName: string; ALoaded: TBitmapLoadedProc = nil); virtual;\r\n    procedure LoadFromResource(AResource: string); virtual; overload;\r\n    procedure LoadFromResource(AResource: string; AHInstance: Integer); virtual; overload;\r\n    procedure LoadFromStream(AStream: TStream);\r\n    property Canvas: TCanvas read GetCanvas;\r\n    property Bitmap: TBitmap read FBitmap;\r\n  published\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property URL: string read FURL write SetURL;\r\n    property Data: TBinaryString read GetData write SetData;\r\n  end;\r\n\r\n  TBitmap = class(TGraphic)\r\n  end;\r\n\r\n  TMatrix = record\r\n    m11, m12, m13: Single;\r\n    m21, m22, m23: Single;\r\n    m31, m32, m33: Single;\r\n  end;\r\n\r\n  TCanvas = class(TObject)\r\n  private\r\n    FElementCanvas: TJSHTMLCanvasElement;\r\n    FContext: TJSCanvasRenderingContext2D;\r\n    FPen: TPen;\r\n    FBrush: TBrush;\r\n    FFont: TFont;\r\n    FPathOpen: boolean;\r\n    FPathX, FPathY: Double;\r\n    FClipRect: TCanvasRectF;\r\n    FOnEndScene: TNotifyEvent;\r\n    FOnBeginScene: TNotifyEvent;\r\n    FApplyPixelRatio: Boolean;\r\n    procedure SetClipRect(const Value: TCanvasRectF);\r\n  protected\r\n    procedure GetAccuOffset(X,Y: double; var dx,dy: single);\r\n    function GetPixel(X,Y: Single): TColor;\r\n    procedure SetPixel(X,Y: Single; Clr: TColor);\r\n    procedure ApplyStroke;\r\n    procedure ApplyFill;\r\n    procedure ApplyBrush(X1,Y1,X2,Y2: single);\r\n    property OnBeginScene: TNotifyEvent read FOnBeginScene write FOnBeginScene;\r\n    property OnEndScene: TNotifyEvent read FOnEndScene write FOnEndScene;\r\n  public\r\n    constructor Create(AControl: TJSHTMLCanvasElement); overload; virtual;\r\n    constructor Create; overload; reintroduce;\r\n    destructor Destroy; override;\r\n    procedure SetTransform(m11, m12, m21, m22, dx, dy: Double);\r\n    procedure Transform(m11, m12, m21, m22, dx, dy: Double);\r\n    procedure Rotate(Angle: Double);\r\n    procedure Translate(X, Y: Double);\r\n    procedure AngleArc(X, Y: Integer; Radius: Cardinal; StartAngle, SweepAngle: Double); overload;\r\n    procedure AngleArc(X, Y: Double; Radius: Double; StartAngle, SweepAngle: Double); overload;\r\n    procedure CopyRect(const DestRect: TRect; Canvas: TCanvas; SourceRect: TRect);\r\n    procedure MoveTo(X, Y: Integer); overload;\r\n    procedure MoveTo(X, Y: Double); overload;\r\n    procedure LineTo(X, Y: Integer); overload;\r\n    procedure LineTo(X, Y: Double); overload;\r\n    procedure Rectangle(X1, Y1, X2, Y2: Double); overload;\r\n    procedure Rectangle(X1, Y1, X2, Y2: Integer); overload;\r\n    procedure Rectangle(const Rect: TRect); overload;\r\n    procedure Rectangle(const Rect: TCanvasRectF); overload;\r\n    procedure RoundRect(X1, Y1, X2, Y2, X3, Y3: Integer); overload;\r\n    procedure RoundRect(X1, Y1, X2, Y2, X3, Y3: Double); overload;\r\n    procedure RoundRect(const Rect: TRect; CX, CY: Integer); overload;\r\n    procedure RoundRect(const Rect: TCanvasRectF; CX, CY: Double); overload;\r\n    procedure FillRect(const Rect: TRect); overload;\r\n    procedure FillRect(const Rect: TCanvasRectF); overload;\r\n    procedure Arc(X1, Y1, X2, Y2, X3, Y3, X4, Y4: Integer);\r\n    procedure Ellipse(X1, Y1, X2, Y2: Integer); overload;\r\n    procedure Ellipse(X1, Y1, X2, Y2: Double); overload;\r\n    procedure Ellipse(const Rect: TRect); overload;\r\n    procedure Ellipse(const Rect: TCanvasRectF); overload;\r\n    procedure Polyline(const Points: array of TPoint); overload;\r\n    procedure Polyline(const Points: array of TCanvasPointF); overload;\r\n    procedure Polygon(const Points: array of TPoint); overload;\r\n    procedure Polygon(const Points: array of TCanvasPointF); overload;\r\n    procedure TextOut(X, Y: Integer; const Text: string); overload;\r\n    procedure TextOut(X, Y: Double; const Text: string); overload;\r\n    procedure Draw(X, Y: Integer; Graphic: TGraphic); overload;\r\n    procedure Draw(X, Y: Double; Graphic: TGraphic); overload;\r\n    procedure StretchDraw(Rect: TRect; Graphic: TGraphic); overload;\r\n    procedure StretchDraw(Rect: TCanvasRectF; Graphic: TGraphic); overload;\r\n    procedure DrawFocusRect(const Rect: TRect); overload;\r\n    procedure DrawFocusRect(const Rect: TCanvasRectF); overload;\r\n    procedure BeginScene;\r\n    procedure EndScene;\r\n    procedure PathBegin;\r\n    procedure PathClose;\r\n    procedure PathStroke;\r\n    procedure PathFill;\r\n    procedure PathMoveTo(X, Y: Integer); overload;\r\n    procedure PathMoveTo(X, Y: Double); overload;\r\n    procedure PathLineTo(X, Y: Integer); overload;\r\n    procedure PathLineTo(X, Y: Double); overload;\r\n    procedure Save;\r\n    procedure Clip;\r\n    procedure Restore;\r\n    procedure Refresh;\r\n    procedure Clear; overload;\r\n    procedure Clear(AColor: TColor); overload;\r\n    function TextExtent(const Text: string): TCanvasSizeF;\r\n    function TextRect(ARect: TRect; const Text: String; const WordWrap: Boolean = False; const Calculate: Boolean = False; const AHorizontalAlignment: TAlignment = taLeftJustify; const AVerticalAlignment: TVerticalAlignment = taAlignTop): TRect; overload;\r\n    function TextRect(ARect: TCanvasRectF; const Text: String; const WordWrap: Boolean = False; const Calculate: Boolean = False; const AHorizontalAlignment: TAlignment = taLeftJustify; const AVerticalAlignment: TVerticalAlignment = taAlignTop): TCanvasRectF; overload;\r\n    function TextWidth(const Text: string): Double; overload;\r\n    function TextHeight(const Text: string): Double; overload;\r\n    function GetBase64Image: string;\r\n    function GetAsImage(AType: TImageType = itBase64): string;\r\n    procedure DownloadImage(AFileName: string; AType: TImageType = itPNG);\r\n    property Element: TJSHTMLCanvasElement read FElementCanvas;\r\n    property Pen: TPen read FPen;\r\n    property Brush: TBrush read FBrush;\r\n    property Font: TFont read FFont;\r\n    property Pixels[X, Y: Single]: TColor read GetPixel write SetPixel;\r\n    property ClipRect: TCanvasRectF read FClipRect write SetClipRect;\r\n    property Context: TJSCanvasRenderingContext2D read FContext;\r\n    property ApplyPixelRatio: Boolean read FApplyPixelRatio write FApplyPixelRatio default False;\r\n  end;\r\n\r\n  TJSCSSStyleDeclarationEx = class(TJSCSSStyleDeclaration)\r\n  public\r\n    filter: string;\r\n  end;\r\n\r\n  TJSHTMLElementEx = class(TJSHTMLElement)\r\n  private\r\n    FStyle: TJSCSSStyleDeclarationEx; external name 'style';\r\n  public\r\n  property style: TJSCSSStyleDeclarationEx read FStyle write FStyle;\r\n  end;\r\n\r\n  TJSCanvasRenderingContext2DEx = class(TJSCanvasRenderingContext2D)\r\n  private\r\n    FFilter: string; external name 'filter';\r\n  public\r\n    property filter: string read FFilter write FFilter;\r\n  end;\r\n\r\n\r\n  TURLPicture = class(TPersistent)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    FFilename: string;\r\n    FData: TBinaryString;\r\n    FOnDataChange: TNotifyEvent;\r\n    FWidth: integer;\r\n    FHeight: integer;\r\n    procedure SetData(const Value: TBinaryString);\r\n    function GetData: TBinaryString;\r\n  protected\r\n    procedure Changed; virtual;\r\n    procedure DataChanged; virtual;\r\n  public\r\n    procedure LoadFromFile(AFileName: string);\r\n    property Filename: string read FFilename;\r\n    procedure Assign(Source: TPersistent); override;\r\n    property OnDataChange: TNotifyEvent read FOnDataChange write FOnDataChange;\r\n    property Width: integer read FWidth write FWidth;\r\n    property Height: integer read FHeight write FHeight;\r\n  published\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property Data: TBinaryString read GetData write SetData;\r\n  end;\r\n\r\n\r\n  TThumbnailCreatedProc = reference to procedure(ADataURL: string);\r\n\r\nfunction ColorToRGB(Color: TColor): Longint;\r\nfunction ColorToHex(c: TColor): string;\r\nfunction ColorToHTML(c: TColor): string;\r\nfunction HTMLToColor(s: string): TColor;\r\n\r\nfunction ColorToString(Color: TColor): string;\r\nfunction StringToColor(const S: string): TColor;\r\nfunction CharsetToIdent(ACharSet: TFontCharSet): string;\r\nfunction IdentToCharset(const S: string): TFontCharSet;\r\n\r\nfunction FontSizeToHTML(sz: Double): string;\r\nfunction HTMLChar(h: string): integer;\r\nfunction HexToColor(h: string): TColor;\r\nfunction RGBToColor(argb: string): TColor;\r\nfunction FontSizeToPx(sz: Double): Double;\r\nfunction GetRValue(rgb: NativeInt): Byte;\r\nfunction GetGValue(rgb: NativeInt): Byte;\r\nfunction GetBValue(rgb: NativeInt): Byte;\r\nfunction CreateCanvasRectF(Left, Top, Right, Bottom: Double): TCanvasRectF;\r\nfunction CreateCanvasPointF(X, Y: Double): TCanvasPointF;\r\nfunction CreateCanvasSizeF(cx, cy: Double): TCanvasSizeF;\r\nfunction RGB(r, g, b: Byte): TColor;\r\nfunction RGBA(r, g, b, a: Byte): TColor;\r\nfunction CSSFont(Font: TFont): string;\r\nprocedure CreateThumbnail(ADataURL: string; AWidth, AHeight: integer; UseAspectRatio: boolean; ThumbnailReady: TThumbnailCreatedProc);\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Forms, WEBLib.WEBTools, Math, SysUtils, Contnrs;\r\n\r\ntype\r\n  TGraphicCache = class\r\n  private\r\n    FImage: TJSObject;\r\n    FID: string;\r\n  public\r\n    constructor Create(AImage: TJSObject; AID: string); reintroduce;\r\n    property Image: TJSObject read FImage;\r\n    property ID: string read FID;\r\n  end;\r\n\r\n  TGraphicCacheList = class(TObjectList)\r\n  public\r\n    function Find(AID: string; var FImage: TJSObject): Boolean; virtual;\r\n    function Exists(AID: string): Boolean; virtual;\r\n  end;\r\n\r\nvar\r\n  FCache: TGraphicCacheList;\r\n  FQueue: TStringList;\r\n  FCacheCount: Integer = 0;\r\n\r\nfunction RGB(r, g, b: Byte): TColor;\r\nbegin\r\n  Result := (r or (g shl 8) or (b shl 16));\r\nend;\r\n\r\nfunction RGBA(r, g, b, a: Byte): TColor;\r\nbegin\r\n  Result := (r or (g shl 8) or (b shl 16)) or (a shl 24);\r\nend;\r\n\r\nfunction MatrixIdentity: TMatrix;\r\nbegin\r\n  Result.m11 := 1;\r\n  Result.m12 := 0;\r\n  Result.m13 := 0;\r\n  Result.m21 := 0;\r\n  Result.m22 := 1;\r\n  Result.m23 := 0;\r\n  Result.m31 := 0;\r\n  Result.m32 := 0;\r\n  Result.m33 := 1;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction GetPixelRatio(ACanvas: TCanvas): Single;\r\nvar\r\n  res: single;\r\n  ca: TCanvas;\r\nbegin\r\n  ca := ACanvas;\r\n  asm\r\n    var ctx = ca.FContext,\r\n        dpr = window.devicePixelRatio || 1,\r\n        bsr = ctx.webkitBackingStorePixelRatio ||\r\n              ctx.mozBackingStorePixelRatio ||\r\n              ctx.msBackingStorePixelRatio ||\r\n              ctx.oBackingStorePixelRatio ||\r\n              ctx.backingStorePixelRatio || 1;\r\n    res = dpr / bsr\r\n  end;\r\n  Result := res;\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction MatrixCreateScaling(const AScaleX, AScaleY: Single): TMatrix;\r\nbegin\r\n  Result := MatrixIdentity;\r\n  Result.m11 := AScaleX;\r\n  Result.m22 := AScaleY;\r\nend;\r\n\r\nfunction MatrixMultiply(const AMatrix1, AMatrix2: TMatrix): TMatrix;\r\nbegin\r\n  Result.m11 := AMatrix1.m11 * AMatrix2.m11 + AMatrix1.m12 * AMatrix2.m21 + AMatrix1.m13 * AMatrix2.m31;\r\n  Result.m12 := AMatrix1.m11 * AMatrix2.m12 + AMatrix1.m12 * AMatrix2.m22 + AMatrix1.m13 * AMatrix2.m32;\r\n  Result.m13 := AMatrix1.m11 * AMatrix2.m13 + AMatrix1.m12 * AMatrix2.m23 + AMatrix1.m13 * AMatrix2.m33;\r\n  Result.m21 := AMatrix1.m21 * AMatrix2.m11 + AMatrix1.m22 * AMatrix2.m21 + AMatrix1.m23 * AMatrix2.m31;\r\n  Result.m22 := AMatrix1.m21 * AMatrix2.m12 + AMatrix1.m22 * AMatrix2.m22 + AMatrix1.m23 * AMatrix2.m32;\r\n  Result.m23 := AMatrix1.m21 * AMatrix2.m13 + AMatrix1.m22 * AMatrix2.m23 + AMatrix1.m23 * AMatrix2.m33;\r\n  Result.m31 := AMatrix1.m31 * AMatrix2.m11 + AMatrix1.m32 * AMatrix2.m21 + AMatrix1.m33 * AMatrix2.m31;\r\n  Result.m32 := AMatrix1.m31 * AMatrix2.m12 + AMatrix1.m32 * AMatrix2.m22 + AMatrix1.m33 * AMatrix2.m32;\r\n  Result.m33 := AMatrix1.m31 * AMatrix2.m13 + AMatrix1.m32 * AMatrix2.m23 + AMatrix1.m33 * AMatrix2.m33;\r\nend;\r\n\r\nprocedure CreateThumbnail(ADataURL: string; AWidth, AHeight: integer; UseAspectRatio: boolean; ThumbnailReady: TThumbnailCreatedProc);\r\nvar\r\n  LImg: TJSElement;\r\n\r\nbegin\r\n  if (AWidth <=0) or (AHeight <= 0) then\r\n    Exit;\r\n\r\n  LImg := document.createElement('IMG');\r\n\r\n  asm\r\n    LImg.onload = function() {\r\n\r\n      var w = LImg.width;\r\n      var h = LImg.height;\r\n\r\n      var neww = AWidth;\r\n      var newh = AHeight;\r\n\r\n      if (UseAspectRatio) {\r\n        if ((w/neww) > (h/newh))\r\n        {\r\n          newh = h / (w/neww);\r\n        }\r\n        else\r\n        {\r\n          neww = w / (h/newh);\r\n        }\r\n      }\r\n      var LCanvas = document.createElement('CANVAS');\r\n      var ctx = LCanvas.getContext(\"2d\");\r\n      ctx.drawImage(LImg, 0, 0, neww, newh);\r\n      var res = LCanvas.toDataURL(\"image/png\");\r\n      ThumbnailReady(res);\r\n    }\r\n  end;\r\n\r\n  LImg['src'] := ADataURL;\r\nend;\r\n\r\nfunction CSSFont(Font: TFont): string;\r\nvar\r\n  res,fs: string;\r\nbegin\r\n  res := 'font-family:'+ Font.Name+';';\r\n  res := res + 'font-style: normal;';\r\n\r\n  if fsBold in Font.Style then\r\n    res := res + 'font-weight: bold;';\r\n\r\n  if fsItalic in Font.Style then\r\n    res := res + 'font-style: italic;';\r\n\r\n  fs := '';\r\n\r\n  if fsUnderline in Font.Style then\r\n    fs := fs + ' underline';\r\n\r\n  if fsStrikeOut in Font.Style then\r\n     fs:= fs + ' line-through';\r\n\r\n  if (fs <> '') then\r\n    res := res + 'text-decoration:' + fs+';';\r\n\r\n  res := res + 'font-size:'+ IntToStr(Font.Size) + 'pt;';\r\n\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction CreateCanvasRectF(Left, Top, Right, Bottom: Double): TCanvasRectF;\r\nbegin\r\n  Result.Left := Left;\r\n  Result.Top := Top;\r\n  Result.Right := Right;\r\n  Result.Bottom := Bottom;\r\nend;\r\n\r\nfunction CreateCanvasPointF(X, Y: Double): TCanvasPointF;\r\nbegin\r\n  Result.X := X;\r\n  Result.Y := Y;\r\nend;\r\n\r\nfunction CreateCanvasSizeF(cx, cy: Double): TCanvasSizeF;\r\nbegin\r\n  Result.cx := cx;\r\n  Result.cy := cy;\r\nend;\r\n\r\nfunction GetRValue(rgb: NativeInt): Byte;\r\nbegin\r\n  Result := Byte(rgb and $FF);\r\nend;\r\n\r\nfunction GetGValue(rgb: NativeInt): Byte;\r\nbegin\r\n  Result := Byte((rgb shr 8) and $FF);\r\nend;\r\n\r\nfunction GetBValue(rgb: NativeInt): Byte;\r\nbegin\r\n  Result := Byte((rgb shr 16) and $FF);\r\nend;\r\n\r\nfunction ColorToRGB(Color: TColor): Longint;\r\nbegin\r\n  Result := Color;\r\nend;\r\n\r\nfunction ColorToHex(c: TColor): string;\r\nvar\r\n  s: string;\r\nbegin\r\n  asm\r\n    s = c.toString(16);\r\n\r\n    while (s.length < 6)\r\n    {\r\n      s = \"0\" + s;\r\n    }\r\n  end;\r\n\r\n  Result := Copy(s,5,2) + Copy(s,3,2) + Copy(s,1,2);\r\nend;\r\n\r\nfunction ColorToHTML(c: TColor): string;\r\nbegin\r\n  Result := '#' + ColorToHex(c);\r\nend;\r\n\r\nfunction HTMLToColor(s: string): TColor;\r\nbegin\r\n  if pos('#',s) = 1 then\r\n    Delete(s,1,1);\r\n\r\n  Result := HexToColor(s);\r\nend;\r\n\r\nfunction ColorToString(Color: TColor): string;\r\nbegin\r\n  case Color of\r\n  clNone: Result := 'clNone';\r\n  clBlack: Result := 'clBlack';\r\n  clMaroon: Result := 'clMaroon';\r\n  clGreen: Result := 'clGreen';\r\n  clOlive: Result := 'clOlive';\r\n  clNavy: Result := 'clNavy';\r\n  clPurple: Result := 'clPurple';\r\n  clTeal: Result := 'clTeal';\r\n  clGray: Result := 'clGray';\r\n  clSilver: Result := 'clSilver';\r\n  clRed: Result := 'clRed';\r\n  clLime: Result := 'clLime';\r\n  clYellow: Result := 'clYellow';\r\n  clBlue: Result := 'clBlue';\r\n  clFuchsia: Result := 'clFuchsia';\r\n  clAqua: Result := 'clAqua';\r\n  clWhite: Result := 'clWhite';\r\n  clLtGray: Result := 'clLtGray';\r\n  clDkGray: Result := 'clDkGray';\r\n  clDefault: Result := 'clDefault';\r\n  clBtnFace: Result := 'clBtnFace';\r\n  clWindowText: Result := 'clWindowText';\r\n  clWindow: Result := 'clWindow';\r\n  clHighlight: Result := 'clHighlight';\r\n  clHighlightText: Result :='clHighlightText';\r\n  clInfoText: Result :='clInfoText';\r\n  clInfoBk: Result := 'clInfoBk';\r\n  clActiveCaption: Result := 'clActiveCaption';\r\n  clInactiveCaption: Result := 'clInactiveCaption';\r\n  clHotLight: Result := 'clHotLight'\r\n  else\r\n    Result := '$' + ColorToHex(Color);\r\n  end;\r\nend;\r\n\r\nfunction StringToColor(const S: string): TColor;\r\nvar\r\n  us: string;\r\nbegin\r\n  us := Uppercase(s);\r\n  if (us = 'CLNONE') then Result := clNone else\r\n  if (us = 'CLBLACK') then Result := clBlack else\r\n  if (us = 'CLMAROON') then Result := clMaroon else\r\n  if (us = 'CLGREEN') then Result := clGreen else\r\n  if (us = 'CLOLIVE') then Result := clOlive else\r\n  if (us = 'CLNAVY') then Result := clNavy else\r\n  if (us = 'CLPURPLE') then Result := clPurple else\r\n  if (us = 'CLTEAL') then Result := clTeal else\r\n  if (us = 'CLGRAY') then Result := clGray else\r\n  if (us = 'CLSILVER') then Result := clSilver else\r\n  if (us = 'CLRED') then Result := clRed else\r\n  if (us = 'CLLIME') then Result := clLime else\r\n  if (us = 'CLYELLOW') then Result := clYellow else\r\n  if (us = 'CLBLUE') then Result := clBlue else\r\n  if (us = 'CLFUCHSIA') then Result := clFuchsia else\r\n  if (us = 'CLAQUA') then Result := clAqua else\r\n  if (us = 'CLWHITE') then Result := clWhite else\r\n  if (us = 'CLLTGRAY') then Result := clLtGray else\r\n  if (us = 'CLDKGRAY') then Result := clDkGray else\r\n  if (us = 'CLDEFAULT') then Result := clDefault else\r\n  if (us = 'CLBTNFACE') then Result := clBtnFace else\r\n  if (us = 'CLWINDOWTEXT') then Result := clWindowText else\r\n  if (us = 'CLWINDOW') then Result := clWindow else\r\n  if (us = 'CLHIGHLIGHT') then Result := clHighlight else\r\n  if (us = 'CLHIGHLIGHTTEXT') then Result := clWhite else\r\n  if (us = 'CLINFOTEXT') then Result := clInfoText else\r\n  if (us = 'CLINFOBK') then Result := clInfoBk else\r\n  if (us = 'CLACTIVECAPTION') then Result := clActiveCaption else\r\n  if (us = 'CLINACTIVECAPTION') then Result := clInactiveCaption else\r\n  if (us = 'CLHOTLIGHT') then Result := clHotLight else\r\n    Result := HexToColor(us);\r\nend;\r\n\r\n\r\nfunction RGBToColor(argb: string): TColor;\r\nvar\r\n  r,g,b: string;\r\n  ri,gi,bi: byte;\r\n  e: integer;\r\nbegin\r\n  Result := clNone;\r\n\r\n  argb := Trim(argb);\r\n\r\n  if pos('RGB', uppercase(argb)) > 0  then\r\n  begin\r\n    delete(argb,1,4);\r\n\r\n    r := copy(argb,1, pos(',', argb) -1);\r\n    delete(argb, 1, pos(',', argb) + 1);\r\n\r\n    g := copy(argb,1, pos(',', argb) -1);\r\n    delete(argb, 1, pos(',', argb) + 1);\r\n\r\n    b := copy(argb,1, pos(')', argb) -1);\r\n\r\n    val(r, ri, e);\r\n    val(g, gi, e);\r\n    val(b, bi, e);\r\n\r\n    Result := RGB(ri,gi,bi);\r\n  end;\r\nend;\r\n\r\nfunction HexToColor(h: string): TColor;\r\nvar\r\n  s: string;\r\n  i: integer;\r\nbegin\r\n  s := '';\r\n  for i := 1 to Length(h) do\r\n  begin\r\n    // accept hex chars\r\n    if ((h[i] >='0') and (h[i] <= '9')) or ((h[i] >='A') and (h[i] <= 'F') or ((h[i] >='a') and (h[i] <= 'f'))) then\r\n      s := s + h[i];\r\n  end;\r\n\r\n  s := '$' + Copy(s,5,2) + Copy(s,3,2) + Copy(s,1,2);\r\n  Result := StrToInt64(s);\r\nend;\r\n\r\nfunction HTMLChar(h: string): integer;\r\nbegin\r\n  // fmt &#xABCD;\r\n  Delete(h,1,3);\r\n  Delete(h,Length(h) - 1, 1);\r\n  Result := StrToInt('0x' + h);\r\nend;\r\n\r\nfunction FontSizeToHTML(sz: Double): string;\r\nbegin\r\n  Result := FloatToStr(sz)+'px';\r\n  Result := StringReplace(Result, ',', '.', [rfReplaceAll]);\r\nend;\r\n\r\n\r\nfunction CharSetToIdent(ACharSet: TFontCharSet): string;\r\nbegin\r\n  case ACharSet of\r\n  ANSI_CHARSET: Result := 'ANSI_CHARSET';\r\n  DEFAULT_CHARSET: Result := 'DEFAULT_CHARSET';\r\n  SYMBOL_CHARSET: Result := 'SYMBOL_CHARSET';\r\n  MAC_CHARSET: Result := 'MAC_CHARSET';\r\n  SHIFTJIS_CHARSET: Result := 'SHIFTJIS_CHARSET';\r\n  HANGEUL_CHARSET: Result := 'HANGEUL_CHARSET';\r\n  JOHAB_CHARSET: Result := 'JOHAB_CHARSET';\r\n  GB2312_CHARSET: Result := 'GB2312_CHARSET';\r\n  CHINESEBIG5_CHARSET: Result := 'CHINESEBIG5_CHARSET';\r\n  GREEK_CHARSET: Result := 'GREEK_CHARSET';\r\n  TURKISH_CHARSET: Result := 'TURKISH_CHARSET';\r\n  HEBREW_CHARSET: Result := 'HEBREW_CHARSET';\r\n  ARABIC_CHARSET: Result := 'ARABIC_CHARSET';\r\n  BALTIC_CHARSET: Result := 'BALTIC_CHARSET';\r\n  RUSSIAN_CHARSET: Result := 'RUSSIAN_CHARSET';\r\n  THAI_CHARSET: Result := 'THAI_CHARSET';\r\n  EASTEUROPE_CHARSET: Result := 'EASTEUROPE_CHARSET';\r\n  OEM_CHARSET: Result := 'OEM_CHARSET';\r\n  end;\r\nend;\r\n\r\nfunction IdentToCharSet(const S: string): TFontCharSet;\r\nbegin\r\n  if S = 'ANSI_CHARSET' then Result := ANSI_CHARSET;\r\n  if S = 'DEFAULT_CHARSET' then Result := DEFAULT_CHARSET;\r\n  if S = 'SYMBOL_CHARSET' then Result := SYMBOL_CHARSET;\r\n  if S = 'MAC_CHARSET' then Result := MAC_CHARSET;\r\n  if S = 'SHIFTJIS_CHARSET' then Result := SHIFTJIS_CHARSET;\r\n  if S = 'HANGEUL_CHARSET' then Result := HANGEUL_CHARSET;\r\n  if S = 'JOHAB_CHARSET' then Result := JOHAB_CHARSET;\r\n  if S = 'GB2312_CHARSET' then Result := GB2312_CHARSET;\r\n  if S = 'CHINESEBIG5_CHARSET' then Result := CHINESEBIG5_CHARSET;\r\n  if S = 'GREEK_CHARSET' then Result := GREEK_CHARSET;\r\n  if S = 'TURKISH_CHARSET' then Result := TURKISH_CHARSET;\r\n  if S = 'HEBREW_CHARSET' then Result := HEBREW_CHARSET;\r\n  if S = 'ARABIC_CHARSET' then Result := ARABIC_CHARSET;\r\n  if S = 'BALTIC_CHARSET' then Result := BALTIC_CHARSET;\r\n  if S = 'RUSSIAN_CHARSET' then Result := RUSSIAN_CHARSET;\r\n  if S = 'THAI_CHARSET' then Result := THAI_CHARSET;\r\n  if S = 'EASTEUROPE_CHARSET' then Result := EASTEUROPE_CHARSET;\r\n  if S = 'OEM_CHARSET' then Result := OEM_CHARSET;\r\nend;\r\n\r\n{ TPen }\r\n\r\nprocedure TPen.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TPen) then\r\n  begin\r\n    FColor := (Source as TPen).Color;\r\n    FStyle := (Source as TPen).Style;\r\n    FWidth := (Source as TPen).Width;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nconstructor TPen.Create;\r\nbegin\r\n  FColor := clBlack;\r\n  FWidth := 1;\r\n  FStyle := psSolid;\r\n  FMode := pmCopy;\r\nend;\r\n\r\nprocedure TPen.SetColor(const Value: TColor);\r\nbegin\r\n  FColor := Value;\r\nend;\r\n\r\n{ TBrush }\r\n\r\nprocedure TBrush.AddGradientColor(AColor: TColor; AStop: single);\r\nvar\r\n  gr: TGradientColor;\r\nbegin\r\n  gr := TGradientColor.Create;\r\n  gr.Color := AColor;\r\n  gr.Stop := AStop;\r\n  FGradientColors.Add(gr);\r\nend;\r\n\r\nprocedure TBrush.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TBrush) then\r\n  begin\r\n    FColor := (Source as TBrush).Color;\r\n    FStyle := (Source as TBrush).Style;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nfunction FontSizeToPx(sz: Double): Double;\r\nbegin\r\n  Result := sz * 96 / 72;\r\nend;\r\n\r\nprocedure TBrush.ClearGradient;\r\nvar\r\n  i: integer;\r\n  gr: TGradientColor;\r\nbegin\r\n  for i := FGradientColors.Count - 1 downto 0 do\r\n  begin\r\n    gr := TGradientColor(FGradientColors[i]);\r\n    gr.Free;\r\n    FGradientColors.Delete(i);\r\n  end;\r\nend;\r\n\r\nconstructor TBrush.Create;\r\nbegin\r\n  FColor := clWhite;\r\n  FStyle := bsSolid;\r\n  FGradient := bgNone;\r\n  FGradientColors := TList.Create;\r\nend;\r\n\r\ndestructor TBrush.Destroy;\r\nbegin\r\n  FGradientColors.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TBrush.GetGradientColor(AIndex: integer; var AColor: TColor;\r\n  var AStop: single);\r\nbegin\r\n  if AIndex < FGradientColors.Count then\r\n  begin\r\n    AColor := TGradientColor(FGradientColors[AIndex]).Color;\r\n    AStop := TGradientColor(FGradientColors[AIndex]).Stop;\r\n  end\r\n  else\r\n    raise Exception.Create('Invalid gradient color index');\r\nend;\r\n\r\nfunction TBrush.GradientCount: integer;\r\nbegin\r\n  Result := FGradientColors.Count;\r\nend;\r\n\r\n{ TFont }\r\n\r\nprocedure TFont.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TFont) then\r\n  begin\r\n    FName := (Source as TFont).Name;\r\n    FColor := (Source as TFont).Color;\r\n    FSize := (Source as TFont).Size;\r\n    FStyle := (Source as TFont).Style;\r\n    DoChange;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nfunction TFont.ToString: string;\r\nvar\r\n  s: string;\r\nbegin\r\n  s := '';\r\n  if (TFontStyle.fsBold in Style) and (TFontStyle.fsItalic in Style) then\r\n    s := s + 'bold italic'\r\n  else if TFontStyle.fsBold in Style then\r\n    s := s + 'bold'\r\n  else if TFontStyle.fsItalic in Style then\r\n    s := s + 'italic';\r\n\r\n  Result := s + ' ' + FontSizeToHTML(FontSizeToPx(Size)) + ' ' + Name;\r\nend;\r\n\r\nprocedure TFont.SetName(const AName: string);\r\nbegin\r\n  if (FName <> AName) then\r\n  begin\r\n    FName := AName;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TFont.SetSize(const ASize: Integer);\r\nbegin\r\n  if (FSize <> ASize) then\r\n  begin\r\n    FSize := ASize;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TFont.SetColor(const AColor: TColor);\r\nbegin\r\n  if (FColor <> AColor) then\r\n  begin\r\n    FColor := AColor;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TFont.SetHeight(const Value: Integer);\r\nvar\r\n  d: double;\r\nbegin\r\n  d := -Value * 72/96;\r\n  FSize := Round(d);\r\n\r\n  if (FHeight <> Value) then\r\n  begin\r\n    FHeight := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TFont.SetStyle(const AStyle: TFontStyles);\r\nbegin\r\n  if (FStyle <> AStyle) then\r\n  begin\r\n    FStyle := AStyle;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nconstructor TFont.Create;\r\nbegin\r\n  inherited;\r\n  FName := WEBDEFAULTFONT;\r\n  FSize := 8;\r\n  FHeight := -11;\r\n  FStyle := [];\r\n  FColor := clBlack;\r\nend;\r\n\r\nprocedure TFont.DoChange;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\n{ TCanvas }\r\n\r\nprocedure TCanvas.AngleArc(X, Y, Radius: Double; StartAngle,\r\n  SweepAngle: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    FContext.arc(X, Y, Radius, StartAngle, StartAngle + SweepAngle);\r\n    FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.ApplyFill;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.fillStyle := ColorToHtml(Brush.Color);\r\nend;\r\n\r\nprocedure TCanvas.ApplyStroke;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.lineWidth := Pen.Width;\r\n    FContext.strokeStyleAsColor := ColorToHtml(Pen.Color);\r\n    case Pen.Style of\r\n      psSolid: FContext.setlinedash([]);\r\n      psDot: FContext.setlinedash([1,2]);\r\n      psDash: FContext.setlinedash([8,2]);\r\n      psDashDot: FContext.setlinedash([6,2,2,2]);\r\n      psDashDotDot: FContext.setlinedash([6,2,2,2,2,2]);\r\n      psClear: FContext.setlinedash([0, $FFFF]);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction AngleOfPoints(x1,y1,x2,y2:double):double;\r\nvar\r\n  part1, part2:double;\r\n  angle:double;\r\nbegin\r\n  if (x1=x2) and (y1=y2) then\r\n  begin\r\n    Result:=0.0;\r\n    Exit;\r\n  end;\r\n\r\n  part1 := abs(y2 - y1);\r\n  if (part1=0) then\r\n  begin\r\n    part1:=0.0000001;\r\n    y1 := y1+0.0000001;\r\n  end;\r\n\r\n  part2 := abs(x2- x1);\r\n  if (part2=0) then\r\n  begin\r\n    part2:=0.0000001;\r\n    x1 := x1 + 0.0000001;\r\n  end;\r\n\r\n  angle := arctan(part1/part2);\r\n\r\n  if ((x1>x2) and (y1<y2)) then angle:=PI-angle;\r\n  if ((x1>x2) and (y1>y2)) then angle:=angle +PI;\r\n  if ((x1<x2) and (y1>y2)) then angle:=2*PI-angle;\r\n\r\n  while angle>= 2*PI do\r\n    angle := angle - 2*PI;\r\n  while angle < 0 do\r\n   angle := angle + 2*PI;\r\n  Result := angle;\r\nend;\r\n\r\nprocedure TCanvas.Arc(X1, Y1, X2, Y2, X3, Y3, X4, Y4: Integer);\r\nvar\r\n  rx,ry: integer;\r\n  angleStart,angleEnd: double;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    rx := (X2-X1) div 2;\r\n    ry := (Y2-Y1) div 2;\r\n\r\n    angleStart := AngleOfPoints(X1+rx,Y1+ry,X4,Y4);\r\n    angleEnd := AngleOfPoints(X1+rx,Y1+ry,X3,Y3);\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    FContext.ellipse(X1+rx,Y1+ry,rx,ry,0,angleStart,angleEnd);\r\n    FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.PathBegin;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.beginPath();\r\nend;\r\n\r\nprocedure TCanvas.BeginScene;\r\nbegin\r\n  if Assigned(OnBeginScene) then\r\n    OnBeginScene(Self);\r\nend;\r\n\r\nprocedure TCanvas.Clear;\r\nbegin\r\n  if Assigned(FContext) and Assigned(FElementCanvas) then\r\n    FContext.clearRect(0, 0, FElementCanvas.width, FElementCanvas.height);\r\nend;\r\n\r\nprocedure TCanvas.Clear(AColor: TColor);\r\nvar\r\n  c: TColor;\r\n  s: TBrushStyle;\r\nbegin\r\n  Clear;\r\n  if Assigned(FElementCanvas) then\r\n  begin\r\n    c := Brush.Color;\r\n    s := Brush.Style;\r\n    Brush.Color := AColor;\r\n    Brush.Style := bsSolid;\r\n    FillRect(Rect(0, 0, FElementCanvas.width, FElementCanvas.height));\r\n    Brush.Color := c;\r\n    Brush.Style := s;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Clip;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.clip;\r\nend;\r\n\r\nprocedure TCanvas.CopyRect(const DestRect: TRect; Canvas: TCanvas;\r\n  SourceRect: TRect);\r\nvar\r\n  sw,sh: integer;\r\n  dw,dh: integer;\r\n  imgData: TJSImageData;\r\n  ACanvas: TCanvas;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    sw := SourceRect.Right - SourceRect.Left;\r\n    sh := SourceRect.Bottom - SourceRect.Top;\r\n\r\n    dw := DestRect.Right - DestRect.Left;\r\n    dh := DestRect.Bottom - DestRect.Top;\r\n\r\n    imgData := FContext.getImageData(SourceRect.Left, SourceRect.Top, sw, sh);\r\n\r\n    ACanvas := TCanvas.Create;\r\n    try\r\n      ACanvas.FElementCanvas.width := sw;\r\n      ACanvas.FElementCanvas.height := sh;\r\n\r\n      ACanvas.FContext.putImageData(imgData, 0,0);\r\n      Canvas.FContext.drawImage(ACanvas.FElementCanvas, DestRect.Left, DestRect.Top, dw, dh);\r\n    finally\r\n      ACanvas.Free;\r\n    end;\r\n  end;\r\nend;\r\n\r\nconstructor TCanvas.Create;\r\nbegin\r\n  FElementCanvas := TJSHTMLCanvasElement(document.createElement('CANVAS'));\r\n  Create(FElementCanvas);\r\nend;\r\n\r\nconstructor TCanvas.Create(AControl: TJSHTMLCanvasElement);\r\nbegin\r\n  FElementCanvas := AControl;\r\n  FContext := AControl.getContextAs2DContext('2d');\r\n  FPen := TPen.Create;\r\n  FBrush := TBrush.Create;\r\n  FPathOpen := false;\r\n  FFont := TFont.Create;\r\n  FApplyPixelRatio := False;\r\nend;\r\n\r\nprocedure TCanvas.AngleArc(X, Y: Integer; Radius: Cardinal; StartAngle, SweepAngle: Double);\r\nbegin\r\n  AngleArc(Double(X), Double(Y), Double(Radius), Double(StartAngle), Double(SweepAngle));\r\nend;\r\n\r\nprocedure TCanvas.MoveTo(X,Y: Integer);\r\nbegin\r\n  MoveTo(Double(X), Double(Y));\r\nend;\r\n\r\nprocedure TCanvas.LineTo(X,Y: Integer);\r\nbegin\r\n  LineTo(Double(X), Double(Y));\r\nend;\r\n\r\nprocedure TCanvas.Rectangle(const Rect: TRect);\r\nbegin\r\n  Rectangle(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TCanvas.ApplyBrush(X1, Y1, X2, Y2: Double);\r\nvar\r\n  dx,dy,p: single;\r\n  gr: TJSCanvasGradient;\r\n  i: integer;\r\n  clr: string;\r\n  AColor: TColor;\r\n  AStop: single;\r\nbegin\r\n  GetAccuOffset(X1,Y1,dx,dy);\r\n\r\n  if Brush.Style in [bsHorizontal, bsCross] then\r\n  begin\r\n    p := Y1 + dy;\r\n    FContext.lineWidth := 1;\r\n    FContext.strokeStyleAsColor := ColorToHtml(Brush.Color);\r\n    while p < Y2 do\r\n    begin\r\n      FContext.moveTo(x1,p);\r\n      FContext.lineTo(x2,p);\r\n      p := p + 8;\r\n    end;\r\n  end;\r\n\r\n  if Brush.Style in [bsVertical, bsCross] then\r\n  begin\r\n    p := X1 + dx;\r\n    FContext.lineWidth := 1;\r\n    FContext.strokeStyleAsColor := ColorToHtml(Brush.Color);\r\n    while p < X2 do\r\n    begin\r\n      FContext.moveTo(p,y1);\r\n      FContext.lineTo(p,y2);\r\n      p := p + 8;\r\n    end;\r\n  end;\r\n\r\n  if Brush.Style in [bsFDiagonal, bsDiagCross] then\r\n  begin\r\n    p := X1 + dx - (X2 - X1);\r\n    FContext.lineWidth := 1;\r\n    FContext.strokeStyleAsColor := ColorToHtml(Brush.Color);\r\n    while p < X2 do\r\n    begin\r\n      FContext.moveTo(p,y1);\r\n      FContext.lineTo(p + (y2-y1),y2);\r\n      p := p + 8;\r\n    end;\r\n  end;\r\n\r\n  if Brush.Style in [bsBDiagonal, bsDiagCross] then\r\n  begin\r\n    p := X1 + dx;\r\n    FContext.lineWidth := 1;\r\n    FContext.strokeStyleAsColor := ColorToHtml(Brush.Color);\r\n    while p < X2 + (X2 - X1) do\r\n    begin\r\n      FContext.moveTo(p,y1);\r\n      FContext.lineTo(p - (y2-y1),y2);\r\n      p := p + 8;\r\n    end;\r\n  end;\r\n\r\n  if Brush.Gradient <> bgNone then\r\n  begin\r\n    case Brush.Gradient of\r\n    bgLinearHorz: gr := FContext.createLinearGradient(X1, Y1, X2, Y1);\r\n    bgLinearVert: gr := FContext.createLinearGradient(X1, Y1, X1, Y2);\r\n    bgRadial: gr :=  FContext.createRadialGradient(X1 + (X2-X1)/2, Y1+ (Y2 - Y1)/2, 0, X1 + (X2-X1)/2, Y1+ (Y2 - Y1)/2, (X2-X1)/2);\r\n    end;\r\n\r\n    clr := ColorToHtml(ColorToRGB(Brush.Color));\r\n    asm\r\n      gr.addColorStop(0,clr);\r\n    end;\r\n\r\n    for i := 0 to Brush.GradientCount - 1 do\r\n    begin\r\n      Brush.GetGradientColor(i, AColor, AStop);\r\n      clr := ColorToHtml(ColorToRGB(AColor));\r\n      asm\r\n        gr.addColorStop(AStop,clr);\r\n      end;\r\n    end;\r\n\r\n    FContext.fillStyle := gr;\r\n    FContext.fillRect(X1,Y1,X2,Y2);\r\n\r\n    Exit;\r\n  end;\r\n\r\n  FContext.stroke();\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TCanvas.Rectangle(X1, Y1, X2, Y2: Double);\r\nvar\r\n  dx,dy: single;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.save;\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n\r\n    GetAccuOffset(X1,Y1,dx,dy);\r\n\r\n    asm\r\n      let region = new Path2D();\r\n      region.rect(X1, Y1, X2- X1 + 1, Y2 - Y1 + 1);\r\n      this.FContext.clip(region, \"evenodd\");\r\n    end;\r\n\r\n    ApplyBrush(X1,Y1,X2,Y2);\r\n\r\n    if not (Brush.Style in [bsClear, bsHorizontal, bsVertical, bsCross, bsFDiagonal, bsBDiagonal, bsDiagCross]) then\r\n    begin\r\n      FContext.rect(X1+dx, Y1+dy, X2 - X1, Y2 - Y1);\r\n      FContext.fill();\r\n    end;\r\n\r\n    if Pen.Style <> psClear then\r\n    begin\r\n      ApplyStroke;\r\n      FContext.beginPath;\r\n      FContext.rect(X1+dx, Y1+dy, X2 - X1, Y2 - Y1);\r\n      FContext.stroke();\r\n    end;\r\n\r\n    FContext.restore;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Rectangle(const Rect: TCanvasRectF);\r\nbegin\r\n  Rectangle(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.Refresh;\r\nbegin\r\nend;\r\n\r\nprocedure TCanvas.Restore;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.restore();\r\nend;\r\n\r\nprocedure TCanvas.Rectangle(X1, Y1, X2, Y2: Integer);\r\nbegin\r\n  Rectangle(Double(X1), Double(Y1), Double(X2), Double(Y2));\r\nend;\r\n\r\nprocedure TCanvas.FillRect(const Rect: TRect);\r\nbegin\r\n  Rectangle(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.RoundRect(X1,Y1,X2,Y2,X3,Y3: Integer);\r\nbegin\r\n  RoundRect(Double(X1), Double(Y1), Double(X2), Double(Y2), Double(X3), Double(Y3));\r\nend;\r\n\r\nprocedure TCanvas.RoundRect(const Rect: TRect; CX, CY: Integer);\r\nbegin\r\n  RoundRect(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom, CX, CY);\r\nend;\r\n\r\nprocedure TCanvas.RoundRect(X1, Y1, X2, Y2, X3, Y3: Double);\r\nvar\r\n  dx,dy: single;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n\r\n    GetAccuOffset(X1, Y1, dx, dy);\r\n\r\n    FContext.moveTo(X1 + X3/2, Y1 + dy);\r\n    FContext.lineTo(X2 - X3/2, Y1 + dy);\r\n    FContext.quadraticCurveTo(X2 + dx,Y1 + dy, X2 + dx, Y1 + dy + Y3/2);\r\n\r\n    FContext.lineTo(X2 + dx, Y2 - Y3/2 );\r\n    FContext.quadraticCurveTo(X2 + dx, Y2 + dy, X2 - X3/2 - dx, Y2 + dy);\r\n    FContext.lineTo(X1 + X3/2, Y2 + dy);\r\n    FContext.quadraticCurveTo(X1 + dx, Y2 + dy, X1 + dx, Y2 - Y3/2);\r\n    FContext.lineTo(X1 + dx, Y1 + Y3/2 + dy);\r\n    FContext.quadraticCurveTo(X1 + dx, Y1 + dy, X1 + X3/2 + dx, Y1 + dy);\r\n\r\n    if Brush.Style = bsSolid then\r\n      FContext.fill();\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n\r\n    FContext.save;\r\n\r\n    asm\r\n      let region = new Path2D();\r\n      region.moveTo(X1 + X3/2, Y1 + dy);\r\n      region.lineTo(X2 - X3/2, Y1 + dy);\r\n      region.quadraticCurveTo(X2 + dx,Y1 + dy, X2 + dx, Y1 + dy + Y3/2);\r\n      region.lineTo(X2 + dx, Y2 - Y3/2 );\r\n      region.quadraticCurveTo(X2 + dx, Y2 + dy, X2 - X3/2 - dx, Y2 + dy);\r\n      region.lineTo(X1 + X3/2, Y2 + dy);\r\n      region.quadraticCurveTo(X1 + dx, Y2 + dy, X1 + dx, Y2 - Y3/2);\r\n      region.lineTo(X1 + dx, Y1 + Y3/2 + dy);\r\n      region.quadraticCurveTo(X1 + dx, Y1 + dy, X1 + X3/2 + dx, Y1 + dy);\r\n      this.FContext.clip(region, \"evenodd\");\r\n    end;\r\n\r\n    ApplyBrush(X1,Y1,X2,Y2);\r\n\r\n    FContext.restore;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Ellipse(X1, Y1, X2, Y2: Integer);\r\nbegin\r\n  Ellipse(Double(X1), Double(Y1), Double(X2), Double(Y2));\r\nend;\r\n\r\nprocedure TCanvas.Ellipse(const Rect: TRect);\r\nbegin\r\n  Ellipse(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.Polyline(const Points: array of TPoint);\r\nvar\r\n  l, i: Integer;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    l := Length(Points);\r\n\r\n    if l = 0 then\r\n      Exit;\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    i := 0;\r\n    FContext.moveTo(Points[i].X, Points[i].Y);\r\n\r\n    while (i < l - 1) do\r\n    begin\r\n      inc(i);\r\n      FContext.lineTo(Points[i].X, Points[i].Y);\r\n    end;\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Polygon(const Points: array of TPoint);\r\nvar\r\n  l, i: Integer;\r\n  x1,y1,x2,y2: integer;\r\n\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    l := Length(Points);\r\n\r\n    if l = 0 then\r\n      Exit;\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n\r\n    x1 := $FFFF;\r\n    y1 := $FFFF;\r\n    x2 := 0;\r\n    y2 := 0;\r\n    for i := 0 to Length(Points) - 1 do\r\n    begin\r\n      if Points[i].X < x1 then\r\n        x1 := Points[i].X;\r\n      if Points[i].X < y1 then\r\n        y1 := Points[i].Y;\r\n\r\n      if Points[i].X > x2 then\r\n        x2 := Points[i].X;\r\n      if Points[i].X < y2 then\r\n        y2 := Points[i].Y;\r\n    end;\r\n\r\n    if Brush.Gradient <> bgNone then\r\n      ApplyBrush(x1,y1,x2,y2)\r\n    else\r\n      ApplyFill;\r\n\r\n    i := 0;\r\n    FContext.moveTo(Points[i].X, Points[i].Y);\r\n\r\n    while (i < l - 1) do\r\n    begin\r\n      inc(i);\r\n      FContext.lineTo(Points[i].X, Points[i].Y);\r\n    end;\r\n\r\n    FContext.closePath();\r\n\r\n    if Brush.Style <> bsClear then\r\n      FContext.fill();\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nfunction TCanvas.TextExtent(const Text: string): TCanvasSizeF;\r\nbegin\r\n  Result.cx := TextWidth(Text);\r\n  Result.cy := TextHeight(Text);\r\nend;\r\n\r\nfunction TCanvas.TextHeight(const Text: string): Double;\r\nbegin\r\n  Result := FontSizeToPx(Font.Size);\r\nend;\r\n\r\nprocedure TCanvas.MoveTo(X, Y: Double);\r\nvar\r\n  dx,dy: single;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FPathOpen := true;\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    dx := 0;\r\n    dy := 0;\r\n    GetAccuOffset(X, Y, dx, dy);\r\n    FContext.moveTo(X + dx,Y + dy);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.TextOut(X, Y: Double; const Text: string);\r\nvar\r\n  tm: TJSTextMetrics;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.fillStyle := ColorToHtml(Font.Color);\r\n    FContext.font := Font.ToString;\r\n    FContext.textBaseline := 'top';\r\n    FContext.fillText(Text, X, Y);\r\n\r\n    if fsUnderline in Font.Style then\r\n    begin\r\n      tm := FContext.measureText(Text);\r\n      FContext.fillRect(X, Y + Font.Size *1.4, tm.width, 1);\r\n    end;\r\n\r\n    if fsStrikeOut in Font.Style then\r\n    begin\r\n      tm := FContext.measureText(Text);\r\n      FContext.fillRect(X, Y + Font.Size *0.7, tm.width, 1);\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\nfunction TCanvas.TextRect(ARect: TCanvasRectF; const Text: String; const WordWrap: Boolean = False; const Calculate: Boolean = False; const AHorizontalAlignment: TAlignment = taLeftJustify; const AVerticalAlignment: TVerticalAlignment = taAlignTop): TCanvasRectF;\r\nvar\r\n  i: Integer;\r\n  s, sn, st: string;\r\n  l: Integer;\r\n  w, mw: Double;\r\n  f: Boolean;\r\n  p: Integer;\r\n  tw: Double;\r\n  th: Double;\r\n  lcnt: Integer;\r\n  rs: TCanvasRectF;\r\n  fws: Double;\r\n  ths: Double;\r\n  ww, wwx, fx: Boolean;\r\n\r\n  procedure DrawText(AText: string; AWidth, AHeight: Single);\r\n  begin\r\n    if ww then\r\n    begin\r\n      case AHorizontalAlignment of\r\n        taCenter: TextOut(ARect.Left + (ARect.Right - ARect.Left - AWidth) / 2, ARect.Top, AText);\r\n        taLeftJustify: TextOut(ARect.Left, ARect.Top, AText);\r\n        taRightJustify: TextOut(ARect.Right - AWidth, ARect.Top, AText);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      case AHorizontalAlignment of\r\n        taCenter:\r\n        begin\r\n          case AVerticalAlignment of\r\n            taAlignTop: TextOut(ARect.Left + (ARect.Right - ARect.Left - AWidth) / 2, ARect.Top, AText);\r\n            taVerticalCenter: TextOut(ARect.Left + (ARect.Right - ARect.Left - AWidth) / 2, ARect.Top + (ARect.Bottom - ARect.Top - AHeight) / 2, AText);\r\n            taAlignBottom: TextOut(ARect.Left + (ARect.Right - ARect.Left - AWidth) / 2, ARect.Bottom - AHeight, AText);\r\n          end;\r\n        end;\r\n        taLeftJustify:\r\n        begin\r\n          case AVerticalAlignment of\r\n            taAlignTop: TextOut(ARect.Left, ARect.Top, AText);\r\n            taVerticalCenter: TextOut(ARect.Left, ARect.Top + (ARect.Bottom - ARect.Top - AHeight) / 2, AText);\r\n            taAlignBottom: TextOut(ARect.Left, ARect.Bottom - AHeight, AText);\r\n          end;\r\n        end;\r\n        taRightJustify:\r\n        begin\r\n          case AVerticalAlignment of\r\n            taAlignTop: TextOut(ARect.Right - AWidth, ARect.Top, AText);\r\n            taVerticalCenter: TextOut(ARect.Right - AWidth, ARect.Top + (ARect.Bottom - ARect.Top - AHeight) / 2, AText);\r\n            taAlignBottom: TextOut(ARect.Right - AWidth, ARect.Bottom - AHeight, AText);\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  function FindNextWord(Text: String; var APos: Integer): String;\r\n  var\r\n    l: Integer;\r\n    i: Integer;\r\n  begin\r\n    Result := '';\r\n\r\n    l := Length(Text);\r\n    if APos > l then\r\n      Exit;\r\n\r\n    i := APos;\r\n    while True do\r\n    begin\r\n      if ((Text[i] = #10) and (Text[i - 1] = #13)) or ((Text[i] = #13) and (Text[i - 1] = #10)) or (Text[i] = ' ') then\r\n      begin\r\n        if Text[i] = ' ' then\r\n          Result := Copy(Text, APos, i - (APos - 1))\r\n        else\r\n          Result := Copy(Text, APos, i - APos);\r\n\r\n        Break;\r\n      end\r\n      else if (Text[i] = #10) or (Text[i] = #13) or (Text[i] = ' ') then\r\n      begin\r\n        result := Copy(Text, APos, i - (APos - 1));\r\n        Break;\r\n      end\r\n      else if i >= l then\r\n      begin\r\n        result := Copy(Text, APos, i - (APos - 1));\r\n        Break;\r\n      end\r\n      else\r\n        inc(i);\r\n    end;\r\n\r\n    APos := i + 1;\r\n  end;\r\nbegin\r\n  ww := WordWrap or (Pos(#13, Text) > 0) or (Pos(#10, Text) > 0);\r\n  wwx := not WordWrap and ((Pos(#13, Text) > 0) or (Pos(#10, Text) > 0));\r\n\r\n  if not ww then\r\n  begin\r\n    w := TextWidth(Text);\r\n    th := TextHeight(Text);\r\n    if not Calculate then\r\n      DrawText(Text, w, th);\r\n\r\n    Result := CreateCanvasRectF(ARect.Left, ARect.Top, ARect.Left + w, ARect.Top + th);\r\n  end\r\n  else\r\n  begin\r\n    rs := ARect;\r\n\r\n    mw := 0;\r\n    i := 1;\r\n    ths := FFont.Size * 0.5;\r\n    lcnt := 0;\r\n    fws := 0;\r\n    tw := 0;\r\n    s := FindNextWord(Text, i);\r\n    w := TextWidth(s);\r\n    th := TextHeight(s) + ths;\r\n\r\n    mw := mw + w;\r\n    if (Length(s) > 0) and (s[Length(s)] = ' ') then\r\n      mw := mw + fws;\r\n\r\n    fx := False;\r\n    while i <= Length(Text) do\r\n    begin\r\n      l := Length(s);\r\n      if (l >= 2) and (((s[l] = #10) and (s[l - 1] = #13)) or ((s[l] = #13) and (s[l - 1] = #10))) then\r\n      begin\r\n        s := Copy(s, 1, l - 2);\r\n        f := True;\r\n      end\r\n      else if (l >= 1) and ((s[l] = #10) or (s[l] = #13)) then\r\n      begin\r\n        s := Copy(s, 1, l - 1);\r\n        f := True;\r\n      end\r\n      else\r\n        f := False;\r\n\r\n      sn := FindNextWord(Text, i);\r\n      w := TextWidth(sn);\r\n      th := Max(th, TextHeight(sn) + ths);\r\n\r\n      if (ARect.Left + mw + w > ARect.Right) or f then\r\n      begin\r\n        if (s <> '') and not fx then\r\n        begin\r\n          p := Length(s);\r\n\r\n          st := Copy(s, 1, p);\r\n\r\n          Inc(lcnt);\r\n          if mw > tw then\r\n            tw := mw;\r\n\r\n          if not Calculate then\r\n            DrawText(st, mw, th);\r\n\r\n          mw := 0;\r\n        end;\r\n\r\n        s := '';\r\n\r\n        fx := False;\r\n        if (wwx and f) or not wwx then\r\n          ARect.Top := ARect.Top + th\r\n        else if (wwx and not f) then\r\n          fx := True;\r\n\r\n        if (Trunc(ARect.Top) > Trunc(ARect.Bottom - th + ths)) and not Calculate then\r\n          Break;\r\n      end;\r\n\r\n      mw := mw + w;\r\n      if (Length(sn) > 0) and (sn[Length(sn)] = ' ') then\r\n        mw := mw + fws;\r\n      s := s + sn;\r\n    end;\r\n\r\n    if s <> '' then\r\n    begin\r\n      p := Length(s);\r\n      st := Copy(s, 1, p);\r\n      Inc(lcnt);\r\n      if mw > tw then\r\n        tw := mw;\r\n\r\n      if not Calculate then\r\n        DrawText(st, mw, th);\r\n    end;\r\n\r\n    Result := CreateCanvasRectF(rs.Left, rs.Top, rs.Left + tw, rs.Top + lcnt * th);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.TextOut(X,Y: Integer; const Text: string);\r\nbegin\r\n  TextOut(Double(X), Double(Y), Text);\r\nend;\r\n\r\nfunction TCanvas.TextRect(ARect: TRect; const Text: String; const WordWrap: Boolean = False; const Calculate: Boolean = False; const AHorizontalAlignment: TAlignment = taLeftJustify; const AVerticalAlignment: TVerticalAlignment = taAlignTop): TRect;\r\nvar\r\n  r: TCanvasRectF;\r\nbegin\r\n  r := TextRect(CreateCanvasRectF(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom), Text, WordWrap, Calculate, AHorizontalAlignment, AVerticalAlignment);\r\n  Result := Rect(Round(r.Left), Round(r.Top), Round(r.Right), Round(r.Bottom));\r\nend;\r\n\r\nfunction TCanvas.TextWidth(const Text: string): Double;\r\nvar\r\n  f: string;\r\n  tm: TJSTextMetrics;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    f := Font.ToString;\r\n    FContext.font := f;\r\n    tm := FContext.measureText(Text);\r\n    Result := tm.width;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Transform(m11, m12, m21, m22, dx, dy: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.transform(m11, m12, m21, m22, dx, dy);\r\nend;\r\n\r\nprocedure TCanvas.Translate(X, Y: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.translate(X, Y);\r\nend;\r\n\r\nprocedure TCanvas.Draw(X, Y: Integer; Graphic: TGraphic);\r\nbegin\r\n  Draw(Double(X), Double(Y), Graphic);\r\nend;\r\n\r\ndestructor TCanvas.Destroy;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TCanvas.Draw(X, Y: Double; Graphic: TGraphic);\r\nvar\r\n  img: TJSObject;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    img := Graphic.Image;\r\n\r\n    if Assigned(img) then\r\n    begin\r\n      if Graphic.FUsedCanvas then\r\n        FContext.drawImage(TJSObject(Graphic.FCanvasElement), X, Y)\r\n      else\r\n        FContext.drawImage(img, X, Y);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.DrawFocusRect(const Rect: TCanvasRectF);\r\nvar\r\n  ps: TPenStyle;\r\nbegin\r\n  ps := Pen.Style;\r\n  Pen.Style := psDot;\r\n  Pen.Width := 1;\r\n  Pen.Color := clBlack;\r\n\r\n  MoveTo(Rect.Left, Rect.Top);\r\n  LineTo(Rect.Right, Rect.Top);\r\n  LineTo(Rect.Right, Rect.Bottom);\r\n  LineTo(Rect.Left, Rect.Bottom);\r\n  LineTo(Rect.Left, Rect.Top);\r\n\r\n  Pen.Style := ps;\r\nend;\r\n\r\nprocedure TCanvas.DrawFocusRect(const Rect: TRect);\r\nbegin\r\n  DrawFocusRect(CreateCanvasRectF(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom));\r\nend;\r\n\r\nprocedure TCanvas.Ellipse(X1, Y1, X2, Y2: Double);\r\nvar\r\n  w, h: Double;\r\n  kappa: Double;\r\n  ox, oy, xe, ye, xm, ym: Double;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    w := x2 - x1;\r\n    h := y2 - y1;\r\n\r\n    kappa := 0.5522848;\r\n\r\n    ox := (w / 2) * kappa;\r\n    oy := (h / 2) * kappa;\r\n    xe := x1 + w;\r\n    ye := y1 + h;\r\n    xm := x1 + w / 2;\r\n    ym := y1 + h / 2;\r\n\r\n    FContext.save;\r\n    asm\r\n      let region = new Path2D();\r\n      region.moveTo(X1, ym);\r\n      region.bezierCurveTo(X1, ym - oy, xm - ox, Y1, xm, Y1);\r\n      region.bezierCurveTo(xm + ox, Y1, xe, ym - oy, xe, ym);\r\n      region.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\r\n      region.bezierCurveTo(xm - ox, ye, X1, ym + oy, X1, ym);\r\n      region.closePath();\r\n      this.FContext.clip(region, \"evenodd\");\r\n    end;\r\n\r\n    ApplyBrush(X1,Y1,X2,Y2);\r\n\r\n    FContext.restore;\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n\r\n    FContext.moveTo(X1, ym);\r\n    FContext.bezierCurveTo(X1, ym - oy, xm - ox, Y1, xm, Y1);\r\n    FContext.bezierCurveTo(xm + ox, Y1, xe, ym - oy, xe, ym);\r\n    FContext.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\r\n    FContext.bezierCurveTo(xm - ox, ye, X1, ym + oy, X1, ym);\r\n    FContext.closePath();\r\n\r\n    if (Brush.Style = bsSolid) and (Brush.Gradient = bgNone) then\r\n      FContext.fill();\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.GetAccuOffset(X,Y: double; var dx, dy: single);\r\nbegin\r\n  dx := 0;\r\n  dy := 0;\r\n\r\n  if (Pen.Width = 1) and (Pen.Style <> psClear) and (Frac(X) = 0) then\r\n    dx := 0.5;\r\n\r\n  if (Pen.Width = 1) and (Pen.Style <> psClear) and (Frac(Y) = 0) then\r\n    dy := 0.5;\r\nend;\r\n\r\nfunction TCanvas.GetBase64Image: string;\r\nbegin\r\n  Result := '';\r\n  if Assigned(Element) then\r\n    Result := Element.toDataURL();\r\nend;\r\n\r\nfunction TCanvas.GetPixel(X,Y: Single): TColor;\r\nvar\r\n  imgd: TJSImageData;\r\nbegin\r\n  Result := clNone;\r\n  if Assigned(FContext) then\r\n  begin\r\n    imgd := FContext.getImageData(x, y, 1, 1);\r\n    Result := RGBA(imgd.data[0], imgd.data[1], imgd.data[2], imgd.data[3]);\r\n  end;\r\nend;\r\n\r\nfunction TCanvas.GetAsImage(AType: TImageType): string;\r\nbegin\r\n  Result := '';\r\n  if Assigned(Element) then\r\n  begin\r\n    case AType of\r\n    itBase64: Result := Element.toDataURL();\r\n    itPNG: Result := Element.toDataURL('image/png');\r\n    itJPEG: Result := Element.toDataURL('image/jpeg',1.0);\r\n    itBMP: Result := Element.toDataURL('image/bmp');\r\n    itGIF: Result := Element.toDataURL('image/gif');\r\n    itSVG: Result := Element.toDataURL('image/svg+xml');\r\n   end;\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TCanvas.DownloadImage( AFileName: string; AType: TImageType = itPNG);\r\nvar\r\n  s: string;\r\n  el: TJSHTMLElement;\r\nbegin\r\n  if Assigned(Element) then\r\n  begin\r\n    s := GetAsImage(AType);\r\n\r\n    el := TJSHTMLElement(document.createElement('a'));\r\n    el['href'] := s;\r\n    if (AFileName <> '') then\r\n      el['download'] := AFileName;\r\n    el.style.setProperty('display','none');\r\n    document.body.appendChild(el);\r\n    el.click();\r\n    document.body.removeChild(el);\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TCanvas.LineTo(X, Y: Double);\r\nvar\r\n  dx,dy: single;\r\n  clr: TColor;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    dx := 0;\r\n    dy := 0;\r\n    GetAccuOffset(X,Y,dx,dy);\r\n\r\n    case Pen.Mode of\r\n    pmBlack: FContext.strokeStyleAsColor := ColorToHtml(clBlack);\r\n    pmWhite: FContext.strokeStyleAsColor := ColorToHtml(clWhite);\r\n    pmXor: FContext.globalCompositeOperation := 'xor';\r\n    pmMask: FContext.globalCompositeOperation := 'source-atop';\r\n    pmNotCopy:\r\n      begin\r\n        clr := ColorToRGB(Pen.Color) xor $FFFFFFFF;\r\n        FContext.strokeStyleAsColor := ColorToHtml(clr);\r\n      end;\r\n    pmNotXor:\r\n      begin\r\n        clr := ColorToRGB(Pen.Color) xor $FFFFFFFF;\r\n        FContext.strokeStyleAsColor := ColorToHtml(clr);\r\n        FContext.globalCompositeOperation := 'xor';\r\n      end;\r\n    end;\r\n\r\n\r\n    if not FPathOpen then\r\n    begin\r\n      FContext.beginPath();\r\n      ApplyStroke;\r\n      FContext.moveTo(FPathX + dx, FPathY + dy);\r\n    end;\r\n\r\n    FContext.lineTo(X + dx, Y + dy);\r\n    FContext.stroke();\r\n    FPathX := X;\r\n    FPathY := Y;\r\n\r\n    FPathOpen := false;\r\n\r\n    FContext.globalCompositeOperation := 'source-over';\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Save;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.save();\r\nend;\r\n\r\nprocedure TCanvas.SetClipRect(const Value: TCanvasRectF);\r\nbegin\r\n  FClipRect := Value;\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.beginPath;\r\n    FContext.rect(FClipRect.Left, FClipRect.Top, FClipRect.Right - FClipRect.Left, FClipRect.Bottom - FClipRect.Top);\r\n    FContext.clip;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.SetPixel(X,Y: Single; Clr: TColor);\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.fillStyle := ColorToHtml(Clr);\r\n    FContext.fillRect(x,y, 1, 1);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.SetTransform(m11, m12, m21, m22, dx, dy: Double);\r\nvar\r\n  m: TMatrix;\r\n  px: Single;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    m := MatrixIdentity;\r\n    m.m11 := m11;\r\n    m.m12 := m12;\r\n    m.m21 := m21;\r\n    m.m22 := m22;\r\n    m.m31 := dx;\r\n    m.m32 := dy;\r\n\r\n    if ApplyPixelRatio then\r\n    begin\r\n      px := GetPixelRatio(Self);\r\n      m := MatrixMultiply(m, MatrixCreateScaling(px, px));\r\n    end;\r\n\r\n    FContext.setTransform(m.m11, m.m12, m.m21, m.m22, m.m31, m.m32);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.StretchDraw(Rect: TCanvasRectF; Graphic: TGraphic);\r\nvar\r\n  img: TJSObject;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    img := Graphic.Image;\r\n    FContext.drawImage(img, 0, 0, Graphic.width, Graphic.height, Rect.Left, Rect.Top, Rect.Right - Rect.Left, Rect.Bottom - Rect.Top);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.StretchDraw(Rect: TRect; Graphic: TGraphic);\r\nbegin\r\n  StretchDraw(CreateCanvasRectF(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom), Graphic);\r\nend;\r\n\r\nprocedure TCanvas.PathLineTo(X, Y: Integer);\r\nbegin\r\n  PathLineTo(Double(X), Double(Y));\r\nend;\r\n\r\nprocedure TCanvas.PathLineTo(X, Y: Double);\r\nvar\r\n  dx, dy: Double;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    dx := 0;\r\n    dy := 0;\r\n    GetAccuOffset(X, Y, dx, dy);\r\n    FContext.lineTo(X + dx, Y + dy);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.PathFill;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    ApplyFill;\r\n    FContext.fill();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.PathStroke;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    ApplyStroke;\r\n    FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.PathMoveTo(X, Y: Integer);\r\nbegin\r\n  PathMoveTo(Double(X), Double(Y));\r\nend;\r\n\r\nprocedure TCanvas.PathMoveTo(X, Y: Double);\r\nvar\r\n  dx, dy: Double;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    dx := 0;\r\n    dy := 0;\r\n    GetAccuOffset(X, Y, dx, dy);\r\n    FContext.moveTo(X + dx, Y + dy);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Polygon(const Points: array of TCanvasPointF);\r\nvar\r\n  l, i: Integer;\r\n  x1,y1,x2,y2: Double;\r\n\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    l := Length(Points);\r\n\r\n    if l = 0 then\r\n      Exit;\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n\r\n    x1 := $FFFF;\r\n    y1 := $FFFF;\r\n    x2 := 0;\r\n    y2 := 0;\r\n    for i := 0 to Length(Points) - 1 do\r\n    begin\r\n      if Points[i].X < x1 then\r\n        x1 := Points[i].X;\r\n      if Points[i].X < y1 then\r\n        y1 := Points[i].Y;\r\n\r\n      if Points[i].X > x2 then\r\n        x2 := Points[i].X;\r\n      if Points[i].X < y2 then\r\n        y2 := Points[i].Y;\r\n    end;\r\n\r\n    if Brush.Gradient <> bgNone then\r\n      ApplyBrush(x1,y1,x2,y2)\r\n    else\r\n      ApplyFill;\r\n\r\n    i := 0;\r\n    FContext.moveTo(Points[i].X, Points[i].Y);\r\n\r\n    while (i < l - 1) do\r\n    begin\r\n      inc(i);\r\n      FContext.lineTo(Points[i].X, Points[i].Y);\r\n    end;\r\n\r\n    FContext.closePath();\r\n\r\n    if Brush.Style <> bsClear then\r\n      FContext.fill();\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Polyline(const Points: array of TCanvasPointF);\r\nvar\r\n  l, i: Integer;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    l := Length(Points);\r\n\r\n    if l = 0 then\r\n      Exit;\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    i := 0;\r\n    FContext.moveTo(Points[i].X, Points[i].Y);\r\n\r\n    while (i < l - 1) do\r\n    begin\r\n      inc(i);\r\n      FContext.lineTo(Points[i].X, Points[i].Y);\r\n    end;\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Ellipse(const Rect: TCanvasRectF);\r\nbegin\r\n  Ellipse(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.PathClose;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.closePath();\r\nend;\r\n\r\nprocedure TCanvas.EndScene;\r\nbegin\r\n  if Assigned(OnEndScene) then\r\n    OnEndScene(Self);\r\nend;\r\n\r\nprocedure TCanvas.FillRect(const Rect: TCanvasRectF);\r\nbegin\r\n  Rectangle(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.Rotate(Angle: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.rotate(Angle);\r\nend;\r\n\r\nprocedure TCanvas.RoundRect(const Rect: TCanvasRectF; CX, CY: Double);\r\nbegin\r\n  RoundRect(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom, CX, CY);\r\nend;\r\n\r\n{ TGraphic }\r\n\r\nconstructor TGraphic.Create(Img: TJSObject);\r\nbegin\r\n  FAddToQueue := True;\r\n  FEmpty := True;\r\n  FData := '';\r\n  FDataBin := '';\r\n  FURL := '';\r\n  FImage := Img;\r\n  FLoaded := nil;\r\nend;\r\n\r\nprocedure TGraphic.AssignEvents;\r\nbegin\r\n  asm\r\n    var me = this;\r\n    this.FImage.onload = function() {\r\n       me.DoChange();\r\n      };\r\n  end;\r\nend;\r\n\r\nprocedure TGraphic.CaptureCanvas;\r\nbegin\r\n  if Assigned(FCanvas) and Assigned(FCanvas.Element) then\r\n    LoadFromResource(FCanvas.Element.toDataURL());\r\nend;\r\n\r\nconstructor TGraphic.Create;\r\nbegin\r\n  FAddToQueue := True;\r\n  FEmpty := True;\r\n  FData := '';\r\n  FDataBin := '';\r\n  FUsedCanvas := False;\r\n  CreateImage;\r\n  AssignEvents;\r\nend;\r\n\r\nconstructor TGraphic.Create(URL: string);\r\nbegin\r\n  FAddToQueue := True;\r\n  FEmpty := True;\r\n  FData := '';\r\n  FDataBin := '';\r\n  Create;\r\n  LoadFromURL(URL);\r\nend;\r\n\r\nprocedure TGraphic.Assign(Source: TPersistent);\r\nvar\r\n  s: string;\r\nbegin\r\n  if Assigned(Source) and (Source is TGraphic) and Assigned((Source as TGraphic).FCanvas) then\r\n    LoadFromCanvas((Source as TGraphic).FCanvas)\r\n  else if Assigned(Source) and (Source is TGraphic) and Assigned((Source as TGraphic).FImage) and not (Source as TGraphic).Empty then\r\n  begin\r\n    asm\r\n      s = Source.FImage.src;\r\n    end;\r\n\r\n    LoadFromURL(s);\r\n  end\r\n  else if not Assigned(Source) then\r\n  begin\r\n    CreateImage;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nfunction TGraphic.Image: TJSObject;\r\nbegin\r\n  Result := FImage;\r\nend;\r\n\r\nprocedure TGraphic.LoadFromCache(AData: String; ALoaded: TBitmapLoadedProc = nil);\r\nvar\r\n  dt: string;\r\n  o: TJSObject;\r\n  b: Boolean;\r\n  s: string;\r\n  l: Boolean;\r\nbegin\r\n  FData := AData;\r\n  if Pos('DATA:', UpperCase(AData)) > 0 then\r\n  begin\r\n    FDataBin := HexImageEncodeFromBase64(AData);\r\n  end;\r\n\r\n  dt := AData;\r\n  if dt = '' then\r\n    Exit;\r\n\r\n  FLoaded := ALoaded;\r\n  FUsedCanvas := false;\r\n\r\n  if not FCache.Find(dt, o) then\r\n  begin\r\n    b := False;\r\n    s := '';\r\n    asm\r\n      s = this.FImage.src;\r\n      b = (s != '');\r\n    end;\r\n\r\n    l := b and (dt <> s);\r\n    if l then\r\n    begin\r\n      CreateImage;\r\n      AssignEvents;\r\n    end;\r\n\r\n    if (not l and (FQueue.IndexOf(dt) = -1)) or l then\r\n    begin\r\n      asm\r\n        this.FImage.src = dt;\r\n        dt = this.FImage.src;\r\n      end;\r\n\r\n      FData := dt;\r\n      if Pos('DATA:', UpperCase(dt)) > 0 then\r\n        FDataBin := HexImageEncodeFromBase64(dt);\r\n\r\n      Inc(FCacheCount);\r\n      if FAddToQueue then\r\n        FQueue.Add(dt);\r\n    end\r\n    else if (not l and (FQueue.IndexOf(dt) <> -1)) then\r\n    begin\r\n      asm\r\n        this.FImage.src = dt;\r\n      end;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    FImage := o;\r\n    DoChange;\r\n  end;\r\n\r\n  asm\r\n    if (this.FImage) {\r\n      this.FEmpty = (this.FImage.src == '');\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGraphic.LoadFromCanvas(ACanvas: TCanvas);\r\nbegin\r\n  if Assigned(ACanvas) and Assigned(ACanvas.Element) then\r\n    LoadFromResource(ACanvas.Element.toDataURL());\r\nend;\r\n\r\nprocedure TGraphic.LoadFromFile(AFileName: string; ALoaded: TBitmapLoadedProc);\r\nbegin\r\n  LoadFromURL(AFileName, 0, ALoaded);\r\nend;\r\n\r\nfunction TGraphic.GetAsImage(AType: TImageType): string;\r\nbegin\r\n  Result := '';\r\n  if Assigned(FCanvas) then\r\n    Result := FCanvas.GetAsImage(AType);\r\nend;\r\n\r\nfunction TGraphic.GetBase64Image: string;\r\nbegin\r\n  Result := '';\r\n  if Assigned(FCanvas) then\r\n    Result := FCanvas.GetBase64Image;\r\nend;\r\n\r\nprocedure TGraphic.LoadFromResource(AResource: string; AHInstance: Integer);\r\nbegin\r\n  FEmpty := True;\r\n  LoadFromCache(AResource);\r\nend;\r\n\r\nprocedure TGraphic.LoadFromResource(AResource: string);\r\nbegin\r\n  LoadFromResource(AResource, 0);\r\nend;\r\n\r\nprocedure TGraphic.LoadFromStream(AStream: TStream);\r\nbegin\r\n  DoChange;\r\nend;\r\n\r\nprocedure TGraphic.LoadFromURL(AURL: string; AHInstance: Integer; ALoaded: TBitmapLoadedProc);\r\nbegin\r\n  FEmpty := True;\r\n  LoadFromCache(AURL, ALoaded);\r\nend;\r\n\r\nprocedure TGraphic.LoadFromURL(AURL: string; ALoaded: TBitmapLoadedProc);\r\nbegin\r\n  LoadFromURL(AURL, 0, ALoaded);\r\nend;\r\n\r\nprocedure TGraphic.RecreateCanvas;\r\nbegin\r\n  if not Assigned(FCanvasElement) then\r\n    FCanvasElement := TJSHTMLCanvasElement(document.createElement('CANVAS'));\r\n\r\n  if Assigned(FCanvasElement) then\r\n  begin\r\n    FCanvasElement.height := Height;\r\n    FCanvasElement.width := Width;\r\n    if not Assigned(FCanvas) then\r\n    begin\r\n      FCanvas := TCanvas.Create(FCanvasElement);\r\n      FCanvas.OnBeginScene := DoBeginScene;\r\n      FCanvas.OnEndScene := DoEndScene;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TGraphic.CreateFromResource(AResource: String;\r\n  AInstance: NativeUInt): TGraphic;\r\nbegin\r\n  Result := TGraphic.Create;\r\n  Result.LoadFromResource(AResource);\r\nend;\r\n\r\nclass function TGraphic.CreateFromURL(AURL: String): TGraphic;\r\nbegin\r\n  Result := CreateFromURL(AURL, 0);\r\nend;\r\n\r\nclass function TGraphic.CreateFromURL(AURL: String;\r\n  AInstance: NativeUInt): TGraphic;\r\nbegin\r\n  Result := TGraphic.Create;\r\n  Result.LoadFromURL(AURL);\r\nend;\r\n\r\nclass function TGraphic.CreateFromResource(AResource: string): TGraphic;\r\nbegin\r\n  Result := CreateFromResource(AResource, 0);\r\nend;\r\n\r\nprocedure TGraphic.CreateImage;\r\nbegin\r\n  asm\r\n    this.FImage = new Image();\r\n  end;\r\nend;\r\n\r\nprocedure TGraphic.DoBeginScene(Sender: TObject);\r\nbegin\r\n  FCanvas.Clear;\r\nend;\r\n\r\nprocedure TGraphic.DoChange;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  FEmpty := (Width = 0) and (Height = 0);\r\n  if not FEmpty and (FData <> '') and not FCache.Exists(FData) then\r\n  begin\r\n    FCache.Add(TGraphicCache.Create(FImage, FData));\r\n    i := FQueue.IndexOf(FData);\r\n    if (i >= 0) and (i <= FQueue.Count - 1) then\r\n      FQueue.Delete(i);\r\n\r\n    Dec(FCacheCount);\r\n    if FCacheCount = 0 then\r\n    begin\r\n      if Assigned(Application.OnImageCacheReady) then\r\n        Application.OnImageCacheReady(Application);\r\n    end;\r\n  end;\r\n\r\n  if Assigned(FOnChange) then\r\n  begin\r\n    FOnChange(Self);\r\n  end;\r\n\r\n  if Assigned(FLoaded) then\r\n  begin\r\n    FLoaded;\r\n    FLoaded := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TGraphic.DoEndScene(Sender: TObject);\r\nbegin\r\n  FAddToQueue := False;\r\n  CaptureCanvas;\r\n  FAddToQueue := True;\r\nend;\r\n\r\nfunction TGraphic.Empty: Boolean;\r\nbegin\r\n  Result := FEmpty;\r\nend;\r\n\r\nprocedure TGraphic.SetData(const Value: TBinaryString);\r\nvar\r\n  hx: string;\r\nbegin\r\n  if (FDataBin <> Value) then\r\n  begin\r\n    FDataBin := Value;\r\n    hx := HexImageDecodeAsBase64(FDataBin);\r\n    if Pos('PHN2ZyB', hx) > 0 then\r\n      LoadFromResource('data:image/svg+xml;base64,' + hx)\r\n    else\r\n      LoadFromResource('data:image/png;base64,' + hx);\r\n  end;\r\nend;\r\n\r\nprocedure TGraphic.SetHeight(const Value: Integer);\r\nbegin\r\n  asm\r\n    this.FImage.height = Value;\r\n  end;\r\n  RecreateCanvas;\r\n  DoChange;\r\nend;\r\n\r\nprocedure TGraphic.SetSize(AWidth, AHeight: Integer);\r\nbegin\r\n  Width := AWidth;\r\n  Height := AHeight;\r\nend;\r\n\r\nprocedure TGraphic.SetURL(const URL: string);\r\nbegin\r\n  LoadFromURL(URL);\r\nend;\r\n\r\nprocedure TGraphic.SetWidth(const Value: Integer);\r\nbegin\r\n  asm\r\n    this.FImage.width = Value;\r\n  end;\r\n  RecreateCanvas;\r\n  DoChange;\r\nend;\r\n\r\nfunction TGraphic.GetWidth: Integer;\r\nvar\r\n  w: integer;\r\nbegin\r\n  w := 0;\r\n  if Assigned(FImage) then\r\n  begin\r\n    asm\r\n      w = this.FImage.width;\r\n    end;\r\n  end;\r\n  Result := w;\r\nend;\r\n\r\nfunction TGraphic.GetCanvas: TCanvas;\r\nbegin\r\n  if not Assigned(FCanvas) then\r\n    RecreateCanvas;\r\n\r\n  Result := FCanvas;\r\n  FUsedCanvas := True;\r\nend;\r\n\r\nfunction TGraphic.GetData: TBinaryString;\r\nbegin\r\n  Result := FDataBin;\r\nend;\r\n\r\nfunction TGraphic.GetHeight: Integer;\r\nvar\r\n  h: integer;\r\nbegin\r\n  h := 0;\r\n  if Assigned(FImage) then\r\n  begin\r\n    asm\r\n      h = this.FImage.height;\r\n    end;\r\n  end;\r\n  Result := h;\r\nend;\r\n\r\n{ TGraphicCache }\r\n\r\nconstructor TGraphicCache.Create(AImage: TJSObject; AID: string);\r\nbegin\r\n  FImage := AImage;\r\n  FID := AID;\r\nend;\r\n\r\n{ TGraphicCacheList }\r\n\r\nfunction TGraphicCacheList.Exists(AID: string): Boolean;\r\nvar\r\n  I: Integer;\r\n  it: TGraphicCache;\r\nbegin\r\n  Result := False;\r\n  for I := 0 to Count - 1 do\r\n  begin\r\n    it := Items[I] as TGraphicCache;\r\n    if (it.ID = AID) and Assigned(it.Image) then\r\n    begin\r\n      Result := True;\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TGraphicCacheList.Find(AID: string; var FImage: TJSObject): Boolean;\r\nvar\r\n  I: Integer;\r\n  it: TGraphicCache;\r\nbegin\r\n  Result := False;\r\n  for I := 0 to Count - 1 do\r\n  begin\r\n    it := Items[I] as TGraphicCache;\r\n    if (it.ID = AID) and Assigned(it.Image) then\r\n    begin\r\n      FImage := it.Image;\r\n      Result := True;\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TURLPicture }\r\n\r\nprocedure TURLPicture.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TURLPicture) then\r\n  begin\r\n    FFileName := (Source as TURLPicture).FileName;\r\n    Changed;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TURLPicture.Changed;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TURLPicture.DataChanged;\r\nbegin\r\n  if Assigned(OnDataChange) then\r\n    OnDataChange(Self);\r\nend;\r\n\r\nfunction TURLPicture.GetData: TBinaryString;\r\nbegin\r\n  Result := FData;\r\nend;\r\n\r\nprocedure TURLPicture.LoadFromFile(AFileName: string);\r\nbegin\r\n  FFilename := AFileName;\r\n  Changed;\r\nend;\r\n\r\nprocedure TURLPicture.SetData(const Value: TBinaryString);\r\nbegin\r\n  if (FData <> Value) then\r\n  begin\r\n    FData := Value;\r\n    DataChanged;\r\n  end;\r\nend;\r\n\r\n{ TGradientColor }\r\n\r\nprocedure TGradientColor.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TGradientColor) then\r\n  begin\r\n    FColor := (Source as TGradientColor).Color;\r\n    FStop := (Source as TGradientColor).Stop;\r\n  end;\r\nend;\r\n\r\nconstructor TGradientColor.Create;\r\nbegin\r\n  FColor := clNone;\r\n  FStop := 0;\r\nend;\r\n\r\ninitialization\r\nbegin\r\n  FCache := TGraphicCacheList.Create;\r\n  FQueue := TStringList.Create;\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2021                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.WebCtrls;\r\n\r\n{$DEFINE NOPP}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Controls, WEBLib.Graphics, SysUtils, Web, JS, WEBLib.Menus;\r\n\r\ntype\r\n  TBrowserSandboxType = (stAllowForms, stAllowModals, stAllowOrientationLock, stAllowPointerLock, stAllowPopups, stAllowPopupsToEscapeSandbox,\r\n    stAllowPresentation, stAllowSameOrigin, stAllowScripts, stAllowTopNavigation, stAllowTopNavigationByUserActivation);\r\n\r\n  TBrowserSandboxTypes = set of TBrowserSandboxType;\r\n\r\n  TBrowserReferrerPolicy = (rfNone, rfNoReferrer, rfNoReferrerWhenDowngrade, rfOrigin, rfOriginWhenCrossOrigin, rfUnsafeUrl);\r\n\r\n  TBrowserControl = class(TCustomControl)\r\n  private\r\n    FURL: string;\r\n    FSandbox: TBrowserSandboxTypes;\r\n    FReferrerPolicy: TBrowserReferrerPolicy;\r\n    procedure SetURL(const Value: string);\r\n    procedure SetSandbox(const Value: TBrowserSandboxTypes);\r\n    procedure SetReferrerPolicy(const Value: TBrowserReferrerPolicy);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure BindEvents; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure Navigate(const AURL: string);\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BorderStyle;\r\n    property ReferrerPolicy: TBrowserReferrerPolicy read FReferrerPolicy write SetReferrerPolicy;\r\n    property Sandbox: TBrowserSandboxTypes read FSandbox write SetSandbox;\r\n    property URL: string read FURL write SetURL;\r\n    property Visible;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnMouseDown;\r\n    property OnMouseMove;\r\n    property OnMouseUp;\r\n  end;\r\n\r\n  TWebBrowserControl = class(TBrowserControl);\r\n\r\n  TYoutube = class(TCustomControl)\r\n  private \r\n    FVideoID: string;\r\n    FAllowFullScreen: boolean;\r\n    FAutoPlay: boolean;\r\n    procedure SetAllowFullScreen(const Value: boolean);\r\n  protected\r\n    procedure SetVideoID(const Value: string);\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure UpdateElementVisual; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AllowFullScreen: boolean read FAllowFullScreen write SetAllowFullScreen;\r\n    property AutoPlay: boolean read FAutoPlay write FAutoPlay;\r\n    property VideoID: string read FVideoID write SetVideoID;\r\n  end;\r\n\r\n  TWebYoutube = class(TYoutube);\r\n\r\n  TMapClickEvent = procedure(Sender: TObject; Lon, Lat: double) of object;\r\n  TMapZoomEvent = procedure(Sender: TObject; ZoomLevel: integer) of object;\r\n  TMapMarkerClickEvent = procedure(Sender: TObject; AIndex: integer; AMarker: TJSObjectRecord) of object;\r\n  TMapPolygonClickEvent = procedure(Sender: TObject; AIndex: integer; APolygon: TJSObjectRecord) of object;\r\n  TMapPolylineClickEvent = procedure(Sender: TObject; AIndex: integer; APolyline: TJSObjectRecord) of object;\r\n  TMapCircleClickEvent = procedure(Sender: TObject; AIndex: integer; ACircle: TJSObjectRecord) of object;\r\n  TMapRectangleClickEvent = procedure(Sender: TObject; AIndex: integer; ARectangle: TJSObjectRecord) of object;\r\n  TMapKMLClickEvent = procedure(Sender: TObject; AIndex: integer; AKML: TJSObjectRecord) of object;\r\n\r\n  TGoogleMarkerColor = (mcDefault, mcRed, mcBlue, mcGreen, mcPurple, mcYellow);\r\n  TGoogleMarkerShape = (msPin, msPinDot, msFlag, msBookmark, msFlagSmall, msHome, msFavorite, msStar, msCustom);\r\n  TGoogleTravelMode = (tmDriving, tmWalking, tmBicycling, tmTransit);\r\n  TGoogleMapType = (mtDefault, mtSatellite, mtHybrid, mtTerrain);\r\n  TGoogleMapStyle = (mstDefault, mstNightMode, mstCustom);\r\n\r\n  TGoogleMaps = class;\r\n\r\n  TGoogleMapsOptions = class(TPersistent)\r\n  private\r\n    FOwner: TGoogleMaps;\r\n    FCustomStyle: TStringList;\r\n    FMapStyle: TGoogleMapStyle;\r\n    FDefaultLongitude: Double;\r\n    FDefaultLatitude: Double;\r\n    FDefaultZoomLevel: Integer;\r\n    procedure SetCustomStyle(const Value: TStringList);\r\n    procedure SetMapStyle(const Value: TGoogleMapStyle);\r\n    procedure SetDefaultLatitude(const Value: Double);\r\n    procedure SetDefaultLongitude(const Value: Double);\r\n    procedure SetDefaultZoomLevel(const Value: Integer);\r\n  public\r\n    constructor Create(AGoogleMaps: TGoogleMaps);\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property CustomStyle: TStringList read FCustomStyle write SetCustomStyle;\r\n    property MapStyle: TGoogleMapStyle read FMapStyle write SetMapStyle default mstDefault;\r\n    property DefaultLatitude: Double read FDefaultLatitude write SetDefaultLatitude default -34.397;\r\n    property DefaultLongitude: Double read FDefaultLongitude write SetDefaultLongitude default 150.644;\r\n    property DefaultZoomLevel: Integer read FDefaultZoomLevel write SetDefaultZoomLevel default 8;\r\n  end;\r\n\r\n  TGoogleMapsRender = (mrRaster, mrVector);\r\n\r\n  TGoogleMaps = class(TCustomControl)\r\n  private\r\n    FUpdateCount: integer;\r\n    FReq: TJSXMLHttpRequest;\r\n    FAPIKey: string;\r\n    FOldAPIKey: string;\r\n    FMap: TJSHTMLElement;\r\n    FDirectionsService: TJSElement;\r\n    FDirectionsDisplay: TJSElement;\r\n    FCode: boolean;\r\n    FBound: boolean;\r\n    FOnMapClick: TMapClickEvent;\r\n    FOnMapDblClick: TMapClickEvent;\r\n    FOnMapZoom: TMapZoomEvent;\r\n    FOnMapPan: TMapClickEvent;\r\n    FOnGeoCoded: TMapClickEvent;\r\n    FOnMapIdle: TNotifyEvent;\r\n    FOnMapLoaded: TNotifyEvent;\r\n    FOnMarkerClick: TMapMarkerClickEvent;\r\n    FOnPolygonClick: TMapPolygonClickEvent;\r\n    FOnPolylineClick: TMapPolylineClickEvent;\r\n    FOnCircleClick: TMapCircleClickEvent;\r\n    FOnRectangleClick: TMapRectangleClickEvent;\r\n    FOnKMLClick: TMapKMLClickEvent;\r\n    FOptions: TGoogleMapsOptions;\r\n    FMapID: string;\r\n    FMapRender: TGoogleMapsRender;\r\n    procedure SetAPIKey(const Value: string);\r\n    function GetMarker(AIndex: integer): TJSObject;\r\n    function GetCircle(AIndex: integer): TJSObject;\r\n    function GetRectangle(AIndex: integer): TJSObject;\r\n    function GetPolygon(AIndex: integer): TJSObject;\r\n    function GetPolyline(AIndex: integer): TJSObject;\r\n    procedure SetMapID(const Value: string);\r\n    procedure SetMapRender(const Value: TGoogleMapsRender);\r\n  protected\r\n    function GetMap: TJSHTMLElement;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure SetControlCursor(const Value: TCursor); override;\r\n    procedure BindEvents; override;\r\n\r\n    procedure HandleMapClick(e: TJSEvent);\r\n    procedure HandleMapDblClick(e: TJSEvent);\r\n    procedure HandleMapPan(e: TJSEvent);\r\n    procedure HandleMapZoom(e: TJSEvent);\r\n    procedure HandleMapIdle(e: TJSEvent);\r\n    procedure HandleMarkerClick(e: TJSEvent);\r\n    procedure HandlePolygonClick(e: TJSEvent);\r\n    procedure HandlePolylineClick(e: TJSEvent);\r\n    procedure HandleCircleClick(e: TJSEvent);\r\n    procedure HandleRectangleClick(e: TJSEvent);\r\n    procedure HandleKMLClick(e: TJSEvent);\r\n    function HandleResponse(Event: TEventListenerEvent): boolean;\r\n    function HandleAbort(Event: TEventListenerEvent): boolean;\r\n    function TravelModeStr(ATravelMode: TGoogleTravelMode): string;\r\n    function DoLoaded(Event: TEventListenerEvent): boolean; virtual;\r\n    function GetID: string; override;\r\n    procedure Loaded; override;\r\n    function GoogleLoaded: boolean;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure SetCenter(Lat, Lon: Double);\r\n    function GetCenter(var Lat, Lon: Double): Boolean;\r\n    function GetBounds(var NorthEastLat, NorthEastLon, SouthWestLat, SouthWestLon: Double): Boolean;\r\n    procedure SetDoubleClickZoom(AValue: Boolean);\r\n    procedure SetDraggable(AValue: Boolean);\r\n    procedure SetScrollWheel(AValue: Boolean);\r\n    procedure SetMapType(AMapType: TGoogleMapType = mtDefault);\r\n    procedure SetZoom(Zoom: integer);\r\n    procedure SetHeading(AHeading: double);\r\n    procedure SetTilt(ATilt: double);\r\n    procedure PanTo(Lat, Lon: double);\r\n    procedure PanToBounds(Lat1, Lon1, Lat2, Lon2: double);\r\n    procedure AddGPX(AGPX: string; AColor: TColor = clRed; AWidth: integer = 2; AOpacity: Double = 1);\r\n    procedure AddKML(Url: string; ZoomToBounds: Boolean = true);\r\n    procedure AddPolyLine(Points: TJSArray; AColor: TColor = clRed;AWidth: integer = 2; AOpacity: Double = 1);\r\n    procedure AddPolygon(Points: TJSArray; AFillColor: TColor = clRed; AStrokeColor: TColor = clBlack; AWidth: Integer = 2; AOpacity: Double = 1);\r\n    procedure AddCircle(Lat, Lon: double; Radius: Integer; AFillColor: TColor = clRed; AStrokeColor: TColor = clBlack; AWidth: Integer = 2; AOpacity: double = 1);\r\n    procedure AddRectangle(NorthEastLat, NorthEastLon, SouthWestLat, SouthWestLon: double; AFillColor: TColor = clRed; AStrokeColor: TColor = clBlack; AWidth: integer = 2; AOpacity: double = 1);\r\n    procedure AddMarker(Lat,Lon: Double; Title: string = ''); overload;\r\n    procedure AddMarker(Lat,Lon: Double; Color: TGoogleMarkerColor; Title: string = ''); overload;\r\n    procedure AddMarker(Lat,Lon: Double; Color: TColor; PinLetter: string; Title: string = ''); overload;\r\n    procedure AddMarker(Lat,Lon: Double; PinIcon: string; Title: string; XOffset: integer = 0; YOffset: integer = 0); overload;\r\n    procedure AddMarker(Lat,Lon: Double; Shape: TGoogleMarkerShape; Color: TColor; Title: string = ''); overload;\r\n    procedure AddMarker(Lat,Lon: Double; Shape: TGoogleMarkerShape; Color: TColor = clRed; BorderColor: TColor = clBlack; Scale: Double = 1; CustomShape: string = ''; Title: string = ''); overload;\r\n    procedure SetMarkerTitle(AIndex: Integer; ATitle: string);\r\n    procedure SetMarkerLocation(AIndex: Integer; Lat, Lon: Double);\r\n    procedure SetMarkerIcon(AIndex: Integer; Url: string);\r\n    procedure SetCircleCenter(AIndex: Integer; Lat, Lon: Double);\r\n    procedure SetCircleRadius(AIndex, Radius: Integer);\r\n    procedure SetCircleColors(AIndex: Integer; AFillColor, AStrokeColor: TColor);\r\n    procedure SetRectangleLocation(AIndex: Integer; NorthEastLat, NorthEastLon, SouthWestLat, SouthWestLon: Double);\r\n    procedure SetRectangleColors(AIndex: Integer; AFillColor, AStrokeColor: TColor);\r\n    procedure SetPolylineColor(AIndex: Integer; AColor: TColor);\r\n    procedure SetPolylinePoints(AIndex: Integer; Points: TJSArray);\r\n    procedure SetPolygonColors(AIndex: Integer; AFillColor, AStrokeColor: TColor);\r\n    procedure SetPolygonPoints(AIndex: Integer; Points: TJSArray);\r\n    procedure FitBounds(LatMin, LonMin, LatMax, LonMax: Double);\r\n    procedure ClearMarkers;\r\n    procedure ClearKMLs;\r\n    procedure ClearPolylines;\r\n    procedure ClearPolygons;\r\n    procedure ClearCircles;\r\n    procedure ClearRectangles;\r\n    procedure ShowDirections(Source, Destination: string; ATravelMode: TGoogleTravelMode = tmDriving; WayPoints: TStringList = nil; OptimizeWayPoints: Boolean = False; AvoidHighways: Boolean = False; AvoidTolls: Boolean = False); overload;\r\n    procedure ShowDirections(SourceLon, SourceLat, DestLon, DestLat: Double; ATravelMode: TGoogleTravelMode = tmDriving; WayPoints: TStringList = nil; OptimizeWayPoints: Boolean = False; AvoidHighways: Boolean = False; AvoidTolls: Boolean = False); overload;\r\n    procedure ShowStreetView(Lat, Lon: Double; Heading: Integer = 0; Zoom: Integer = 0; Pitch: Integer = 0);\r\n    procedure HideStreetView;\r\n    procedure MoveMarker(AIndex: integer; NewLat, NewLon: double);\r\n    procedure RemoveDirections;\r\n    procedure RemoveMarker(AIndex: Integer);\r\n    procedure RemovePolygon(AIndex: Integer);\r\n    procedure RemovePolyline(AIndex: Integer);\r\n    procedure RemoveCircle(AIndex: Integer);\r\n    procedure RemoveRectangle(AIndex: Integer);\r\n    procedure GeoCode(const Address: string);\r\n    function GetCoord(Lon,Lat: double): JSValue;\r\n    function Distance(Lon1,Lat1,Lon2,Lat2: double): double;\r\n    function GetBBox(Lon1,Lat1,Lon2,Lat2: double): JSValue;\r\n    property Markers[AIndex: Integer]: TJSObject read GetMarker;\r\n    property Polygons[AIndex: Integer]: TJSObject read GetPolygon;\r\n    property Polylines[AIndex: Integer]: TJSObject read GetPolyline;\r\n    property Circles[AIndex: Integer]: TJSObject read GetCircle;\r\n    property Rectangles[AIndex: Integer]: TJSObject read GetRectangle;\r\n  published\r\n    property Align;\r\n    property Options: TGoogleMapsOptions read FOptions write FOptions;\r\n    property APIKey: string read FAPIKey write SetAPIKey;\r\n    property MapID: string read FMapID write SetMapID;\r\n    property MapRender: TGoogleMapsRender read FMapRender write SetMapRender default mrRaster;\r\n    property OnGeoCoded: TMapClickEvent read FOnGeoCoded write FOnGeoCoded;\r\n    property OnKeyDown;\r\n    property OnKeyUp;\r\n    property OnKeyPress;\r\n    property OnMapClick: TMapClickEvent read FOnMapClick write FOnMapClick;\r\n    property OnMapDblClick: TMapClickEvent read FOnMapDblClick write FOnMapDblClick;\r\n    property OnMapIdle: TNotifyEvent read FOnMapIdle write FOnMapIdle;\r\n    property OnMapPan: TMapClickEvent read FOnMapPan write FOnMapPan;\r\n    property OnMapLoaded: TNotifyEvent read FOnMapLoaded write FOnMapLoaded;\r\n    property OnMapZoom: TMapZoomEvent read FOnMapZoom write FOnMapZoom;\r\n    property OnMarkerClick: TMapMarkerClickEvent read FOnMarkerClick write FOnMarkerClick;\r\n    property OnPolygonClick: TMapPolygonClickEvent read FOnPolygonClick write FOnPolygonClick;\r\n    property OnPolylineClick: TMapPolylineClickEvent read FOnPolylineClick write FOnPolylineClick;\r\n    property OnCircleClick: TMapCircleClickEvent read FOnCircleClick write FOnCircleClick;\r\n    property OnRectangleClick: TMapRectangleClickEvent read FOnRectangleClick write FOnRectangleClick;\r\n    property OnKMLClick: TMapKMLClickEvent read FOnKMLClick write FOnKMLClick;\r\n  end;\r\n\r\n  TWebGoogleMaps = class(TGoogleMaps);\r\n\r\n  TDriveView = (dvList, dvGrid);\r\n\r\n  TGoogleDrive = class(TCustomControl)\r\n  private\r\n    FView: TDriveView;\r\n    FFolderID: string;\r\n    FFrameHandle: TJSElement;\r\n    procedure SetFolderID(const Value: string);\r\n    procedure SetView(const Value: TDriveView);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property FolderID: string read FFolderID write SetFolderID;\r\n    property View: TDriveView read FView write SetView;\r\n  end;\r\n\r\n  TWebGoogleDrive = class(TGoogleDrive);\r\n\r\n  TTwitterFeed = class(TCustomControl)\r\n  private\r\n    FUpdatedFeed: boolean;\r\n    FFeed: string;\r\n    FFeedLinkText: string;\r\n    procedure SetFeed(const Value: string);\r\n    procedure SetFeedLinkText(const Value: string);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Feed: string read FFeed write SetFeed;\r\n    property FeedLinkText: string read FFeedLinkText write SetFeedLinkText;\r\n    property Visible;\r\n  end;\r\n\r\n  TWebTwitterFeed = class(TTwitterFeed);\r\n\r\n  TFilesDroppedEvent = procedure(Sender: TObject; AFileList: TStringList) of object;\r\n\r\n  TFileAsTextEvent = procedure(Sender: TObject; AFileIndex: integer; AText: string) of object;\r\n\r\n  TFileAsBase64Event = procedure(Sender: TObject; AFileIndex: integer; ABase64: string) of object;\r\n\r\n  TFileAsDataURLEvent = procedure(Sender: TObject; AFileIndex: integer; AURL: string) of object;\r\n\r\n  TFileAsArrayBufferEvent = procedure(Sender: TObject; AFileIndex: integer; ABuffer: TJSArrayBufferRecord) of object;\r\n\r\n  TFileAsStreamEvent = procedure(Sender: TObject; AFileIndex: integer; AStream: TStream) of object;\r\n\r\n  TFileUploadEvent = procedure(Sender: TObject; AFileIndex: integer) of object;\r\n\r\n  TFileUploadResponseEvent = procedure(Sender: TObject; AFileIndex: integer; ARequest:TJSXMLHttpRequestRecord; AResponse: string) of object;\r\n\r\n  TFileUploadErrorEvent = procedure(Sender: TObject; AFileIndex: integer; AError: string) of object;\r\n\r\n  TFileUploadProgressEvent = procedure(Sender: TObject; AFileIndex: integer; APosition, ATotalSize: longint) of object;\r\n\r\n  TFileGetAsBase64 = procedure(Sender: TObject; ABase64: string) of object;\r\n\r\n  TFileGetAsText = procedure(Sender: TObject; AText: string) of object;\r\n\r\n  TFileGetAsURL = procedure(Sender: TObject; AURL: string) of object;\r\n\r\n  TFileGetAsArrayBuffer = procedure(Sender: TObject; ABuffer: TJSArrayBufferRecord) of object;\r\n\r\n  TFileGetAsStream = procedure(Sender: TObject; AStream: TStream) of object;\r\n\r\n  TGetAsStringProc = reference to procedure(AValue: string);\r\n\r\n  TGetAsArrayBufferProc = reference to procedure(AValue: TJSArrayBuffer);\r\n\r\n  TGetAsStreamProc = reference to procedure(AStream: TStream);\r\n\r\n  TFile = class(TCollectionItem)\r\n  private\r\n    FReq: TJSXMLHttpRequest;\r\n    FModified: TDateTime;\r\n    FName: string;\r\n    FMimeType: string;\r\n    FSize: integer;\r\n    FFileObject: TJSHTMLFile;\r\n    FTag: integer;\r\n    FObject: TObject;\r\n    FOnGetFileAsBase64: TFileGetAsBase64;\r\n    FOnGetFileAsArrayBuffer: TFileGetAsArrayBuffer;\r\n    FOnGetFileAsText: TFileGetAsText;\r\n    FOnGetFileAsURL: TFileGetAsURL;\r\n    FOnGetFileAsStream: TFileGetAsStream;\r\n    FGetAsString: TGetAsStringProc;\r\n    FGetAsStream: TGetAsStreamProc;\r\n    FGetAsArrayBuffer: TGetAsArrayBufferProc;\r\n  protected\r\n    function HandleFileLoadAsText(Event: TJSEvent): boolean;\r\n    function HandleFileLoadAsBase64(Event: TJSEvent): boolean;\r\n    function HandleFileLoadAsArrayBuffer(Event: TJSEvent): boolean;\r\n    function HandleFileLoadAsDataURL(Event: TJSEvent): boolean;\r\n    function HandleFileLoadAsStream(Event: TJSEvent): boolean;\r\n    function HandleFileUploadProgress(Event: TJSEvent): boolean;\r\n    function HandleFileUploadComplete(Event: TJSEvent): boolean;\r\n    function HandleFileUploadError(Event: TJSEvent): boolean;\r\n    function HandleFileUploadAbort(Event: TJSEvent): boolean;\r\n    function GetControl: TComponent;\r\n  public\r\n    property FileObject: TJSHTMLFile read FFileObject write FFileObject;\r\n    property Name: string read FName write FName;\r\n    property MimeType: string read FMimeType write FMimeType;\r\n    property Modified: TDateTime read FModified write FModified;\r\n    property &Object: TObject read FObject write FObject;\r\n    property Size: integer read FSize write FSize;\r\n    property Tag: integer read FTag write FTag;\r\n\r\n    [async]\r\n    function FileAsText: TJSPromise; overload;\r\n    [async]\r\n    function FileAsText(AEncoding: string): TJSPromise; overload;\r\n    [async]\r\n    function FileAsBase64: TJSPromise;\r\n    [async]\r\n    function FileAsStream: TJSPromise;\r\n    [async]\r\n    function FileAsDataURL: TJSPromise;\r\n    [async]\r\n    function FileAsArrayBuffer: TJSPromise;\r\n\r\n    procedure GetFileAsText; overload;\r\n    procedure GetFileAsText(GetAsString: TGetAsStringProc); overload;\r\n    procedure GetFileAsText(AEncoding: string); overload;\r\n    procedure GetFileAsBase64; overload;\r\n    procedure GetFileAsBase64(GetAsString: TGetAsStringProc); overload;\r\n    procedure GetFileAsArrayBuffer; overload;\r\n    procedure GetFileAsArrayBuffer(GetAsArrayBuffer: TGetAsArrayBufferProc); overload;\r\n    procedure GetFileAsStream; overload;\r\n    procedure GetFileAsStream(GetAsStream: TGetAsStreamProc); overload;\r\n    procedure GetFileAsDataURL; overload;\r\n    procedure GetFileAsDataURL(GetAsString: TGetAsStringProc); overload;\r\n    procedure Upload(AAction: string);\r\n    function AbortUpload: boolean;\r\n    property OnGetFileAsText: TFileGetAsText read FOnGetFileAsText write FOnGetFileAsText;\r\n    property OnGetFileAsBase64: TFileGetAsBase64 read FOnGetFileAsBase64 write FOnGetFileAsBase64;\r\n    property OnGetFileAsURL: TFileGetAsURL read FOnGetFileAsURL write FOnGetFileAsURL;\r\n    property OnGetFileAsArrayBuffer: TFileGetAsArrayBuffer read FOnGetFileAsArrayBuffer write FOnGetFileAsArrayBuffer;\r\n    property OnGetFileAsStream: TFileGetAsStream read FOnGetFileAsStream write FOnGetFileAsStream;\r\n  end;\r\n\r\n  TFilePicker = class;\r\n\r\n  TFiles = class(TCollection)\r\n  private\r\n    FOwner: TCustomControl;\r\n    function GetItem(Index: integer): TFile; reintroduce;\r\n    procedure SetItem(Index: integer; const Value: TFile);\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Owner: TPersistent; reintroduce;\r\n    property Items[Index: integer]: TFile read GetItem write SetItem; default;\r\n    function Add: TFile; reintroduce;\r\n    function Insert(Index: integer): TFile; reintroduce;\r\n    procedure Clear; reintroduce;\r\n  end;\r\n\r\n  TFileUpload = class(TCustomControl)\r\n  private\r\n    FAccept: string;\r\n    FCreateRef: string;\r\n    FEventInit: boolean;\r\n    FFiles: TFiles;\r\n    FFileList: TStringList;\r\n    FOnDroppedFiles: TFilesDroppedEvent;\r\n    FMultiFile: boolean;\r\n    FShowFiles: boolean;\r\n    FDragCaption: string;\r\n    FOnGetFileAsArrayBuffer: TFileAsArrayBufferEvent;\r\n    FOnFileAsText: TFileAsTextEvent;\r\n    FOnFileAsBase64: TFileAsBase64Event;\r\n    FOnFileAsDataURL: TFileAsDataURLEvent;\r\n    FOnUploadFileAbort: TFileUploadEvent;\r\n    FOnUploadFileComplete: TFileUploadEvent;\r\n    FOnUploadFileProgress: TFileUploadProgressEvent;\r\n    FOnUploadFileError: TFileUploadErrorEvent;\r\n    FOnUploadFileResponseComplete: TFileUploadResponseEvent;\r\n    FOnGetFileAsStream: TFileAsStreamEvent;\r\n    FFontHoverColor: TColor;\r\n    FShowPicture: boolean;\r\n    FDragColor: TColor;\r\n    procedure SetDragCaption(const Value: string);\r\n    procedure SetAccept(const Value: string);\r\n    procedure SetShowPicture(const Value: boolean);\r\n  protected\r\n    procedure SetCaption(const AValue: string); override;\r\n    function HandleFiles(files: TJSHTMLFileList): string;\r\n    function DoHandleChange(e: TJSEvent): boolean;\r\n    function HandleDroppedFiles(Event: TJSDragEvent): boolean;\r\n    function HandleDragOver(Event: TJSDragEvent): boolean;\r\n    function HandleDragEnd(Event: TJSDragEvent): boolean;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure ColorChanging; override;\r\n    procedure CreateCSS;\r\n  public\r\n    constructor Create(AOwner: TComponent); overload; override;\r\n    destructor Destroy; override;\r\n    procedure CreateInitialize; override;\r\n    property Files: TFiles read FFiles;\r\n    procedure Clear;\r\n  published\r\n    property Accept: string read FAccept write SetAccept;\r\n    property Caption;\r\n    property ChildOrder;\r\n    property Color default $dfdac8;\r\n    property DragCaption: string read FDragCaption write SetDragCaption;\r\n    property DragColor: TColor read FDragColor write FDragColor default clNone;\r\n    property ElementFont;\r\n    property Font;\r\n    property FontHoverColor: TColor read FFontHoverColor write FFontHoverColor default $00d3bf39;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Multifile: boolean read FMultiFile write FMultiFile default false;\r\n    property ParentFont;\r\n    property ShowFiles: boolean read FShowFiles write FShowFiles default false;\r\n    property ShowPicture: boolean read FShowPicture write SetShowPicture default true;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnDroppedFiles: TFilesDroppedEvent read FOnDroppedFiles write FOnDroppedFiles;\r\n    property OnGetFileAsText: TFileAsTextEvent read FOnFileAsText write FOnFileAsText;\r\n    property OnGetFileAsArrayBuffer: TFileAsArrayBufferEvent read FOnGetFileAsArrayBuffer write FOnGetFileAsArrayBuffer;\r\n    property OnGetFileAsStream: TFileAsStreamEvent read FOnGetFileAsStream write FOnGetFileAsStream;\r\n    property OnGetFileAsBase64: TFileAsBase64Event read FOnFileAsBase64 write FOnFileAsBase64;\r\n    property OnGetFileAsDataURL: TFileAsDataURLEvent read FOnFileAsDataURL write FOnFileAsDataURL;\r\n    property OnUploadFileComplete: TFileUploadEvent read FOnUploadFileComplete write FOnUploadFileComplete;\r\n    property OnUploadFileResponseComplete: TFileUploadResponseEvent read FOnUploadFileResponseComplete write FOnUploadFileResponseComplete;\r\n    property OnUploadFileAbort: TFileUploadEvent read FOnUploadFileAbort write FOnUploadFileAbort;\r\n    property OnUploadFileError: TFileUploadErrorEvent read FOnUploadFileError write FOnUploadFileError;\r\n    property OnUploadFileProgress: TFileUploadProgressEvent read FOnUploadFileProgress write FOnUploadFileProgress;\r\n  end;\r\n\r\n  TWebFileUpload = class(TFileUpload);\r\n\r\n  TFilePicker = class(TCustomControl)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    FMultiFile: boolean;\r\n    FFiles: TFiles;\r\n    FOnFileAsText: TFileAsTextEvent;\r\n    FOnGetFileAsArrayBuffer: TFileAsArrayBufferEvent;\r\n    FAccept: string;\r\n    FOnFileAsBase64: TFileAsBase64Event;\r\n    FChangePtr: pointer;\r\n    FOnFileAsDataURL: TFileAsDataURLEvent;\r\n    FOnUploadFileAbort: TFileUploadEvent;\r\n    FOnUploadFileComplete: TFileUploadEvent;\r\n    FOnUploadFileProgress: TFileUploadProgressEvent;\r\n    FOnUploadFileError: TFileUploadErrorEvent;\r\n    FOnUploadFileResponseComplete: TFileUploadResponseEvent;\r\n    FOnGetFileAsStream: TFileAsStreamEvent;\r\n    procedure SetMultiFile(const Value: boolean);\r\n    function DoHandleChange(e: TJSEvent): boolean;\r\n    procedure SetAccept(const Value: string);\r\n  protected\r\n    procedure UpdateElement; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure GetMethodPointers; override;\r\n    procedure BindEvents; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    property Files: TFiles read FFiles;\r\n    procedure Clear;\r\n  published\r\n    property Accept: string read FAccept write SetAccept;\r\n    property ChildOrder;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Multifile: boolean read FMultiFile write SetMultiFile;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnGetFileAsText: TFileAsTextEvent read FOnFileAsText write FOnFileAsText;\r\n    property OnGetFileAsArrayBuffer: TFileAsArrayBufferEvent read FOnGetFileAsArrayBuffer write FOnGetFileAsArrayBuffer;\r\n    property OnGetFileAsBase64: TFileAsBase64Event read FOnFileAsBase64 write FOnFileAsBase64;\r\n    property OnGetFileAsDataURL: TFileAsDataURLEvent read FOnFileAsDataURL write FOnFileAsDataURL;\r\n    property OnGetFileAsStream: TFileAsStreamEvent read FOnGetFileAsStream write FOnGetFileAsStream;\r\n    property OnUploadFileComplete: TFileUploadEvent read FOnUploadFileComplete write FOnUploadFileComplete;\r\n    property OnUploadFileResponseComplete: TFileUploadResponseEvent read FOnUploadFileResponseComplete write FOnUploadFileResponseComplete;\r\n    property OnUploadFileAbort: TFileUploadEvent read FOnUploadFileAbort write FOnUploadFileAbort;\r\n    property OnUploadFileError: TFileUploadErrorEvent read FOnUploadFileError write FOnUploadFileError;\r\n    property OnUploadFileProgress: TFileUploadProgressEvent read FOnUploadFileProgress write FOnUploadFileProgress;\r\n  end;\r\n\r\n  TWebFilePicker = class(TFilePicker);\r\n\r\n  THTMLDiv = class(TCustomControl)\r\n  private\r\n    FHTML: TStrings;\r\n    FOldText: string;\r\n    procedure SetHTML(const Value: TStrings);\r\n  protected\r\n    procedure UpdateElementData; override;\r\n    procedure HTMLChanged(Sender: TObject);\r\n    function CreateElement: TJSElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ChildOrder;\r\n    property DragMode;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property HTML: TStrings read FHTML write SetHTML;\r\n    property Role;\r\n    property Visible;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnTouchStart;\r\n    property OnTouchEnd;\r\n    property OnTouchMove;\r\n    property OnTouchCancel;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebHTMLDiv = class(THTMLDiv);\r\n\r\n  THTMLSpan = class(TCustomControl)\r\n  private\r\n    FHTML: TStrings;\r\n    FOldText: string;\r\n    procedure SetHTML(const Value: TStrings);\r\n  protected\r\n    procedure UpdateElementData; override;\r\n    procedure HTMLChanged(Sender: TObject);\r\n    function CreateElement: TJSElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ChildOrder;\r\n    property DragMode;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property HTML: TStrings read FHTML write SetHTML;\r\n    property Role;\r\n    property Visible;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnTouchStart;\r\n    property OnTouchEnd;\r\n    property OnTouchMove;\r\n    property OnTouchCancel;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebHTMLSpan = class(THTMLSpan);\r\n\r\n  THTMLAnchor = class(TCustomControl)\r\n  private\r\n    FHref: string;\r\n    FTarget: string;\r\n    procedure SetHref(const Value: string);\r\n    procedure SetTarget(const Value: string);\r\n  protected\r\n    procedure SetCaption(const Value: string); override;\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElementData; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Caption;\r\n    property ChildOrder;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property HRef: string read FHref write SetHref;\r\n    property Target: string read FTarget write SetTarget;\r\n    property Role;\r\n    property Visible;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n  end;\r\n\r\n  TWebHTMLAnchor = class(THTMLAnchor);\r\n\r\n  TURLValidatorEvent = procedure(Sender: TObject; IsValid: boolean) of object;\r\n\r\n  TURLValidator = class(TComponent)\r\n  private\r\n    FURL: string;\r\n    FOnValidated: TURLValidatorEvent;\r\n  protected\r\n    procedure HandleResult(IsValid: boolean);\r\n  public\r\n    procedure Validate;\r\n  published\r\n    property URL: string read FURL write FURL;\r\n    property OnValidated: TURLValidatorEvent read FOnValidated write FOnValidated;\r\n  end;\r\n\r\n  TWebURLValidator = class(TURLValidator);\r\n\r\n\r\n  TJSHTMLFileArray = array of TJSHTMLFile;\r\n\r\n  TShare = class(TComponent)\r\n  private\r\n    FTitle: string;\r\n    FText: string;\r\n    FURL: string;\r\n  public\r\n    function Share(ATitle,AText,AURL: string): boolean; virtual overload;\r\n    function Share(ATitle,AText,AURL: string; AFiles: TJSHTMLFileArray): boolean; virtual overload;\r\n    function CanShareFiles: boolean;\r\n    function Execute: boolean;\r\n  published\r\n    property Title: string read FTitle write FTitle;\r\n    property Text: string read FText write FText;\r\n    property URL: string read FURL write FURL;\r\n  end;\r\n\r\n  TWebShare = class(TShare);\r\n\r\n  TDeviceOrientationError = (oeDenied, oeNotSupported);\r\n\r\n  TDeviceOrientationEvent = procedure(Sender: TObject; Heading: double) of object;\r\n  TDeviceOrientationErrorEvent = procedure(Sender: TObject; AError: TDeviceOrientationError) of object;\r\n\r\n  TDeviceOrientation = class(TComponent)\r\n  private\r\n    FOnHeadingChange: TDeviceOrientationEvent;\r\n    FOnInitialized: TNotifyEvent;\r\n    FOnError: TDeviceOrientationErrorEvent;\r\n    FStarted: boolean;\r\n  protected\r\n    FOrientationPtr: pointer;\r\n    function DoHandleOrientationEvent(e: TJSEvent): boolean;\r\n  public\r\n    function Enabled: boolean;\r\n    procedure Start;\r\n    property Started: boolean read FStarted;\r\n  published\r\n    property OnHeadingChange: TDeviceOrientationEvent read FOnHeadingChange write FOnHeadingChange;\r\n    property OnInitialized: TNotifyEvent read FOnInitialized write FOnInitialized;\r\n    property OnError: TDeviceOrientationErrorEvent read FOnError write FOnError;\r\n  end;\r\n\r\n  TWebDeviceOrientation = class(TDeviceOrientation);\r\n\r\n  TSpeechSynthesis = class(TComponent)\r\n  private\r\n    FVolume: single;\r\n    FPitch: single;\r\n    FRate: single;\r\n    FVoices: TStrings;\r\n    FOnVoicesReady: TNotifyEvent;\r\n    FVoice: string;\r\n    procedure SetVolume(const Value: single);\r\n    procedure SetPitch(const Value: single);\r\n    procedure SetRate(const Value: single);\r\n    procedure SetVoice(const Value: string);\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Speak(AText: string);\r\n    procedure Cancel;\r\n    function GetVoices: TStrings;\r\n    property Voices: TStrings read FVoices;\r\n    function IsSpeaking: boolean;\r\n    function Supported: boolean;\r\n  published\r\n    property Pitch: single read FPitch write SetPitch;\r\n    property Rate: single read FRate write SetRate;\r\n    property Voice: string read FVoice write SetVoice;\r\n    property Volume: single read FVolume write SetVolume;\r\n    property OnVoicesReady: TNotifyEvent read FOnVoicesReady write FOnVoicesReady;\r\n  end;\r\n\r\n  TWebSpeechSynthesis = class(TSpeechSynthesis);\r\n\r\n  TConsoleLog = class(TWebCustomControl)\r\n  private\r\n    FLog: TJSHTMLElement;\r\n    FInit: boolean;\r\n    FAutoScroll: boolean;\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Clear;\r\n  published\r\n    property AutoScroll: boolean read FAutoScroll write FAutoScroll default true;\r\n  end;\r\n\r\n  TWebConsoleLog = class(TConsoleLog);\r\n\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Dialogs, WEBLib.WebTools;\r\n\r\nconst\r\n  TWITTERSCRIPTID = 'twitterscriptid';\r\n\r\n{$HINTS OFF}\r\nfunction EventResult(Event: TEventListenerEvent): string;\r\nbegin\r\n  asm\r\n    Result = Event.target.result;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n{ TYouTube }\r\n\r\nfunction TYoutube.CreateElement: TJSElement;\r\nvar\r\n//  LLabel: TJSHTMLElement;\r\n  LDiv: TJSHTMLElement;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    LDiv := TJSHTMLElement(document.createElement('DIV'));\r\n    {\r\n    LLabel := TJSHTMLElement(document.createElement('DIV'));\r\n    LLabel.innerHTML := 'TWebYouTube';\r\n    BorderStyle := bsSingle;\r\n    LLabel['align'] := 'center';\r\n    LLabel.style.setProperty('border','1px solid gray');\r\n    LLabel.style.setProperty('vertical-align','middle');\r\n    LLabel.style.setProperty('display','table-cell');\r\n    Result.appendChild(LLabel);\r\n    }\r\n\r\n    LDiv.style.setProperty('background-color','slategray');\r\n    LDiv.style.setProperty('background-repeat','no-repeat');\r\n    LDiv.style.setProperty('background-position-y','center');\r\n    LDiv.style.setProperty('background-image',\r\n       'url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAuNDc5OTk5OTU5NDY4ODQyIDE2OS43MDk4Njkz'+\r\n       'ODQ3NjYgMTE5LjA4NTYyODA5MjI4OSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PG'+\r\n       'RlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJkZWYwIiB4MT0iMC41IiB4Mj0iMC41IiB5MT0iMSIgeTI9IjMuMTAwNzJFLTA2Ij48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNG'+\r\n       'RjAwMDAiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNGRjZCMDAiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48Zz48cGF0aCBkPSJNMzEuMDI5MywxLjc3NzM0QzEzLj'+\r\n       'E0MjcsMi45OTQ2Nyw0LjE1NDY3LDYuMTIsMS40ODgsMjguNzkzM0wxLjQ4OCwyOC43OTMzQzAuNTA2NjY3LDM3LjEzNiwwLjAwOTMzMzMzLDQ4LjQwMTMsMCw1OS42OTg3TDAsNjAu'+\r\n       'MzQ1M0MwLjAwOTMzMzMzLDcxLjYyOTMsMC41MDQsODIuODg5MywxLjQ4OCw5MS4yNTA3TDEuNDg4LDkxLjI1MDdDNC4xNTQ2NywxMTMuOTI3LDEzLjE0MjcsMTE3LjA1MiwzMS4wMj'+\r\n       'kzLDExOC4yNjdMMzEuMDI5MywxMTguMjY3QzU2LjQ3NzMsMTIwLDExMy4yNTEsMTE5Ljk5NywxMzguNjgsMTE4LjI2N0wxMzguNjgsMTE4LjI2N0MxNTYuNTY4LDExNy4wNTIsMTY1'+\r\n       'LjU1NSwxMTMuOTI3LDE2OC4yMjMsOTEuMjUwN0wxNjguMjIzLDkxLjI1MDdDMTcwLjIwMyw3NC40MTczLDE3MC4yMDgsNDUuNjg2NywxNjguMjIzLDI4Ljc5MzNMMTY4LjIyMywyOC'+\r\n       '43OTMzQzE2NS41NTUsNi4xMTg2OCwxNTYuNTY4LDIuOTk0NjcsMTM4LjY4LDEuNzc3MzRMMTM4LjY4LDEuNzc3MzRDMTI1Ljk2MywwLjkxMjAxLDEwNS4zOTcsMC40ODAwMDMsODQu'+\r\n       'ODQsMC40ODAwMDNMODQuODQsMC40ODAwMDNDNjQuMjkyLDAuNDc4Njc2LDQzLjc1MDcsMC45MTIwMSwzMS4wMjkzLDEuNzc3MzR6IiBmaWxsPSJ1cmwoI2RlZjApIi8+PHBhdGggZD'+\r\n       '0iTTEwOC40MjUsNjAuMDIyN0w2Mi4yNDE5LDkxLjk0NjcgNjIuMjQxOSwyOC4wOTg3IDEwOC40MjUsNjAuMDIyN3oiIGZpbGw9IiNGRkZGRkYiLz48L2c+PC9zdmc+)');\r\n    LDiv.style.setProperty('background-position-x','center');\r\n    LDiv.style.setProperty('background-size','128px');\r\n    Result := LDiv;\r\n  end\r\n  else\r\n  begin\r\n    Result := document.createElement('IFRAME');\r\n    Result.setAttribute('id', GetID);\r\n    Result.setAttribute('frameborder','0');\r\n  end;\r\nend;\r\n\r\nprocedure TYoutube.UpdateElement;\r\nvar\r\n  FURL: string;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    if Assigned(ElementHandle) then\r\n    begin\r\n      TJSHTMLElement(ElementHandle).style.setProperty('background-color','slategray');\r\n    end;\r\n  end;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    if FVideoID <> '' then\r\n    begin\r\n      FURL := 'https://www.youtube.com/embed/' + FVideoID;\r\n      if AutoPlay then\r\n        FURL := FURL + '?autoplay=1';\r\n      Container.setAttribute('src', FURL);\r\n    end;\r\n    if FAllowFullScreen then\r\n      Container.setAttribute('allowfullscreen','allowfullscreen')\r\n    else\r\n      Container.removeAttribute('allowfullscreen');\r\n  end;\r\nend;\r\n\r\nprocedure TYoutube.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    if Assigned(ElementHandle) then\r\n    begin\r\n      TJSHTMLElement(ElementHandle).style.setProperty('background-color','slategray');\r\n    end;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TYoutube.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Width := 400;\r\n  Height := 300;\r\nend;\r\n\r\nprocedure TYoutube.SetAllowFullScreen(const Value: boolean);\r\nbegin\r\n  FAllowFullScreen := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TYoutube.SetVideoID(const Value: string);\r\nbegin\r\n  FVideoID := Value;\r\n  UpdateElement;\r\nend;\r\n\r\n{ TGoogleMaps }\r\n\r\n{$HINTS OFF}\r\nprocedure TGoogleMaps.AddPolyLine(Points: TJSArray; AColor: TColor = clRed; AWidth: integer = 2; AOpacity: double = 1);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clr: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandlePolylineClick;\r\n  map := GetMap;\r\n  clr := ColorToHTML(AColor);\r\n\r\n  asm\r\n    var poly = new google.maps.Polyline({\r\n      map: map,\r\n  \t  path: Points,\r\n\t    strokeColor: clr,\r\n  \t  strokeOpacity: AOpacity,\r\n  \t  strokeWeight: AWidth\r\n  \t});\r\n\r\n    poly.idx = this.FPolylines.length;\r\n    poly.addListener('click', function() { ptr(poly); } );\r\n    this.FPolylines.push(poly);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddRectangle(NorthEastLat, NorthEastLon, SouthWestLat,\r\n  SouthWestLon: double; AFillColor, AStrokeColor: TColor; AWidth: integer;\r\n  AOpacity: double);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clrF,clrS: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleRectangleClick;\r\n  map := GetMap;\r\n  clrF := ColorToHTML(AFillColor);\r\n  clrS := ColorToHTML(AStrokeColor);\r\n\r\n  asm\r\n    var NELatLng = {lat: NorthEastLat, lng: NorthEastLon};\r\n    var SWLatLng = {lat: SouthWestLat, lng: SouthWestLon};\r\n    var rect = new google.maps.Rectangle({\r\n      map: map,\r\n  \t  bounds: new google.maps.LatLngBounds(NELatLng, SWLatLng),\r\n      fillColor: clrF,\r\n      fillOpacity: AOpacity,\r\n\t    strokeColor: clrS,\r\n  \t  strokeOpacity: AOpacity,\r\n  \t  strokeWeight: AWidth\r\n  \t});\r\n\r\n    rect.idx = this.FRectangles.length;\r\n    rect.addListener('click', function() { ptr(rect); } );\r\n    this.FRectangles.push(rect);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddPolygon(Points: TJSArray; AFillColor: TColor = clRed; AStrokeColor: TColor = clBlack; AWidth: integer = 2; AOpacity: double = 1);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clrF,clrS: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandlePolygonClick;\r\n  map := GetMap;\r\n  clrF := ColorToHTML(AFillColor);\r\n  clrS := ColorToHTML(AStrokeColor);\r\n\r\n  asm\r\n    var poly = new google.maps.Polygon({\r\n      map: map,\r\n  \t  paths: Points,\r\n      fillColor: clrF,\r\n      fillOpacity: AOpacity,\r\n\t    strokeColor: clrS,\r\n  \t  strokeOpacity: AOpacity,\r\n  \t  strokeWeight: AWidth\r\n  \t});\r\n\r\n    poly.idx = this.FPolygons.length;\r\n    poly.addListener('click', function() { ptr(poly); } );\r\n    this.FPolygons.push(poly);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddCircle(Lat, Lon: double; Radius: Integer;\r\n  AFillColor, AStrokeColor: TColor; AWidth: integer; AOpacity: double);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clrF,clrS: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleCircleClick;\r\n  map := GetMap;\r\n  clrF := ColorToHTML(AFillColor);\r\n  clrS := ColorToHTML(AStrokeColor);\r\n\r\n  asm\r\n    var myLatLng = {lat: Lat, lng: Lon};\r\n    var circle = new google.maps.Circle({\r\n      map: map,\r\n  \t  center: myLatLng,\r\n      radius: Radius,\r\n      fillColor: clrF,\r\n      fillOpacity: AOpacity,\r\n\t    strokeColor: clrS,\r\n  \t  strokeOpacity: AOpacity,\r\n  \t  strokeWeight: AWidth\r\n  \t});\r\n\r\n    circle.idx = this.FCircles.length;\r\n    circle.addListener('click', function() { ptr(circle); } );\r\n    this.FCircles.push(circle);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddMarker(Lat, Lon: double; Title: string = '');\r\nvar\r\n  map: TJSHTMLElement;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleMarkerClick;\r\n  map := GetMap;\r\n  asm\r\n    var myLatLng = {lat: Lat, lng: Lon};\r\n    var marker = new google.maps.Marker({\r\n          position: myLatLng,\r\n          map: map,\r\n          title: Title\r\n        });\r\n    marker.idx = this.FMarkers.length;\r\n    marker.addListener('click', function() { ptr(marker); } );\r\n    this.FMarkers.push(marker);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddMarker(Lat, Lon: double; Color: TGoogleMarkerColor; Title: string);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clr: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleMarkerClick;\r\n\r\n  case Color of\r\n  mcDefault: clr := '';\r\n  mcRed: clr := 'red-dot.png';\r\n  mcGreen: clr := 'green-dot.png';\r\n  mcYellow: clr := 'yellow-dot.png';\r\n  mcPurple: clr := 'purple-dot.png';\r\n  mcBlue: clr := 'blue-dot.png';\r\n  end;\r\n\r\n  map := GetMap;\r\n  asm\r\n    var myLatLng = {lat: Lat, lng: Lon};\r\n\r\n    var marker = new google.maps.Marker({\r\n          position: myLatLng,\r\n          map: map,\r\n          title: Title\r\n        });\r\n\r\n    if (clr != \"\") {\r\n      marker.setIcon('http://maps.google.com/mapfiles/ms/icons/' + clr);\r\n    }\r\n    marker.idx = this.FMarkers.length;\r\n    marker.addListener('click', function() { ptr(marker); } );\r\n\r\n    this.FMarkers.push(marker);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddMarker(Lat, Lon: double; Color: TColor; PinLetter: string; Title: string);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clr,url: string;\r\n  ch: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleMarkerClick;\r\n\r\n  clr := ColorToHTML(Color);\r\n  delete(clr,1,1);\r\n  map := GetMap;\r\n  asm\r\n    var myLatLng = {lat: Lat, lng: Lon};\r\n\r\n    url = \"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=\"+ PinLetter + \"|\" + clr;\r\n\r\n    var pinImage = new google.maps.MarkerImage(url);\r\n\r\n    var marker = new google.maps.Marker({\r\n          position: myLatLng,\r\n          map: map,\r\n          title: Title,\r\n          icon: pinImage\r\n        });\r\n    marker.idx = this.FMarkers.length;\r\n    marker.addListener('click', function() { ptr(marker); } );\r\n\r\n    this.FMarkers.push(marker);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddMarker(Lat, Lon: double; PinIcon, Title: string; XOffset: integer = 0; YOffset: integer = 0);\r\nvar\r\n  map: TJSHTMLElement;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleMarkerClick;\r\n\r\n  map := GetMap;\r\n  asm\r\n    var pinImage = new google.maps.MarkerImage(PinIcon, null, null,new google.maps.Point(XOffset, YOffset));\r\n    var myLatLng = {lat: Lat, lng: Lon};\r\n    var marker = new google.maps.Marker({\r\n          position: myLatLng,\r\n          map: map,\r\n          title: Title,\r\n          icon: pinImage\r\n        });\r\n    marker.idx = this.FMarkers.length;\r\n    marker.addListener('click', function() { ptr(marker); } );\r\n\r\n    this.FMarkers.push(marker);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddMarker(Lat, Lon: double; Shape: TGoogleMarkerShape;\r\n  Color: TColor; Title: string);\r\n begin\r\n   AddMarker(Lat, Lon, Shape, Color, clBlack, 1, Title);\r\n end;\r\n\r\nprocedure TGoogleMaps.AddGPX(AGPX: string; AColor: TColor; AWidth: integer;\r\n  AOpacity: double);\r\nvar\r\n  Points: TJSArray;\r\n  LatMax,LonMax,LatMin,LonMin: double;\r\nbegin\r\n  Points := TJSArray.new;\r\n  asm\r\n    var parser = new DOMParser();\r\n    var doc = parser.parseFromString(AGPX, 'text/xml');\r\n    var trk = doc.getElementsByTagName(\"trk\")[0];\r\n    var name = trk.getElementsByTagName(\"name\")[0];\r\n    var trkseg = doc.getElementsByTagName(\"trkseg\")[0];\r\n    var i = trkseg.getElementsByTagName(\"trkpt\").length;\r\n    var trkpt;\r\n    var j;\r\n    var lat;\r\n    var lon;\r\n    var bounds = new google.maps.LatLngBounds ();\r\n\r\n    for (j= 0; j < i; j++)\r\n    {\r\n      trkpt = trkseg.getElementsByTagName(\"trkpt\")[j];\r\n      lat = trkpt.getAttribute('lat');\r\n      lon = trkpt.getAttribute('lon');\r\n\r\n      var p = new google.maps.LatLng(lat, lon);\r\n  \t  Points.push(p);\r\n      bounds.extend(p);\r\n    }\r\n    LatMax = bounds.getNorthEast().lat();\r\n    LonMax = bounds.getNorthEast().lng();\r\n\r\n    LatMin = bounds.getSouthWest().lat();\r\n    LonMin = bounds.getSouthWest().lng();\r\n  end;\r\n\r\n  AddPolyLine(Points, AColor, AWidth, AOpacity);\r\n  FitBounds(LatMin, LonMin, LatMax, LonMax);\r\nend;\r\n\r\nprocedure TGoogleMaps.AddKML(Url: string; ZoomToBounds: Boolean);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clr: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleKMLClick;\r\n  map := GetMap;\r\n\r\n  asm\r\n    var kml = new google.maps.KmlLayer(Url, {\r\n      map: map,\r\n      clickable: true,\r\n      preserveViewport: !ZoomToBounds\r\n  \t});\r\n\r\n    kml.idx = this.FKMLs.length;\r\n    kml.addListener('click', function() { ptr(kml); } );\r\n    this.FKMLs.push(kml);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddMarker(Lat, Lon: double; Shape: TGoogleMarkerShape;\r\n  Color: TColor; BorderColor: TColor; Scale: Double; CustomShape: string; Title: string);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clr: string;\r\n  bclr: string;\r\n  pth: string;\r\n  scl: string;\r\n  ptr: pointer;\r\nbegin\r\n  ptr := @HandleMarkerClick;\r\n  map := GetMap;\r\n  clr := ColorToHTML(Color);\r\n  bclr := ColorToHTML(BorderColor);\r\n  scl := StringReplace(FloatToStr(Scale), ',', '.', []);\r\n\r\n  case Shape of\r\n  msPin: pth:= 'M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z';\r\n  msPinDot: pth := 'M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z M -2,-30 a 2,2 0 1,1 4,0 2,2 0 1,1 -4,0';\r\n  msFlag:  pth := 'M 0,0 -1,-2 V -43 H 1 V -2 z M 1,-40 H 30 V -20 H 1 z';\r\n  msBookmark: pth := 'M17 3h-10c-1.1 0-1.99.9-1.99 2l-.01 16 7-3 7 3v-16c0-1.1-.9-2-2-2z';\r\n  msFlagSmall: pth := 'M14.4 6l-.4-2h-9v17h2v-7h5.6l.4 2h7v-10z';\r\n  msHome: pth := 'M10 20v-6h4v6h5v-8h3l-10-9-10 9h3v8z';\r\n  msFavorite: pth := 'M12 21.35l-1.45-1.32c-5.15-4.67-8.55-7.75-8.55-11.53 0-3.08 2.42-5.5 5.5-5.5 1.74 0 3.41.81 4.5 2.09 1.09-1.28 2.76-2.09 4.5-2.09 3.08 0 5.5 2.42 5.5 5.5 0 3.78-3.4 6.86-8.55 11.54l-1.45 1.31z';\r\n  msStar: pth := 'M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z';\r\n  msCustom: pth := CustomShape;\r\n  end;\r\n\r\n  asm\r\n    function pinSymbol(color, bcolor, scale) {\r\n    return {\r\n        path: pth,\r\n        fillColor: color,\r\n        fillOpacity: 1,\r\n        strokeColor: bcolor,\r\n        strokeWeight: 1,\r\n        scale: parseFloat(scale),\r\n        };\r\n    }\r\n    var myLatLng = {lat: Lat, lng: Lon};\r\n    var marker = new google.maps.Marker({\r\n          position: myLatLng,\r\n          map: map,\r\n          title: Title,\r\n          icon: pinSymbol(clr, bclr, scl)\r\n        });\r\n    marker.idx = this.FMarkers.length;\r\n    marker.addListener('click', function() { ptr(marker); } );\r\n\r\n    this.FMarkers.push(marker);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.BindEvents;\r\nvar\r\n  map: TJSHTMLElement;\r\n  ptr1,ptr2,ptr3,ptr4,ptr5: pointer;\r\n  dirsvc, dirdispl: TJSElement;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  map := GetMap;\r\n\r\n  if Assigned(map) and not FBound and not (csDesigning in ComponentState) then\r\n  begin\r\n    ptr1 := @HandleMapClick;\r\n    ptr2 := @HandleMapDblClick;\r\n    ptr3 := @HandleMapPan;\r\n    ptr4 := @HandleMapZoom;\r\n    ptr5 := @HandleMapIdle;\r\n\r\n    asm\r\n      this.FMarkers = [];\r\n      this.FPolygons = [];\r\n      this.FPolylines = [];\r\n      this.FCircles = [];\r\n      this.FRectangles = [];\r\n      this.FKMLs = [];\r\n    end;\r\n\r\n\r\n    asm\r\n      dirsvc = new google.maps.DirectionsService;\r\n      dirdispl = new google.maps.DirectionsRenderer;\r\n      dirdispl.setMap(map);\r\n      map.addListener('click', ptr1);\r\n      map.addListener('dblclick', ptr2);\r\n      map.addListener('center_changed',ptr3);\r\n      map.addListener('zoom_changed',ptr4);\r\n      map.addListener('tilesloaded',ptr5);\r\n    end;\r\n\r\n    FDirectionsService := dirsvc;\r\n    FDirectionsDisplay := dirdispl;\r\n\r\n    FBound := true;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\nprocedure TGoogleMaps.ClearCircles;\r\nbegin\r\n  asm\r\n    for (var i = 0; i < this.FCircles.length; i++) {\r\n          this.FCircles[i].setMap(null);\r\n          }\r\n    this.FMarkers = [];\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ClearKMLs;\r\nbegin\r\n  asm\r\n    for (var i = 0; i < this.FKMLs.length; i++) {\r\n          this.FKMLs[i].setMap(null);\r\n          }\r\n    this.FKMLs = [];\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ClearMarkers;\r\nbegin\r\n  asm\r\n    for (var i = 0; i < this.FMarkers.length; i++) {\r\n          this.FMarkers[i].setMap(null);\r\n          }\r\n    this.FMarkers = [];\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ClearPolygons;\r\nbegin\r\n  asm\r\n    for (var i = 0; i < this.FPolygons.length; i++) {\r\n          this.FPolygons[i].setMap(null);\r\n          }\r\n    this.FPolyLines = [];\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ClearPolyLines;\r\nbegin\r\n  asm\r\n    for (var i = 0; i < this.FPolylines.length; i++) {\r\n          this.FPolylines[i].setMap(null);\r\n          }\r\n    this.FPolyLines = [];\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ClearRectangles;\r\nbegin\r\n  asm\r\n    for (var i = 0; i < this.FRectangles.length; i++) {\r\n          this.FRectangles[i].setMap(null);\r\n          }\r\n    this.FRectangles = [];\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.CreateElement: TJSElement;\r\nbegin\r\n  FDirectionsService := nil;\r\n  FDirectionsDisplay := nil;\r\n\r\n  Result := document.createElement('DIV');\r\n  Result.setAttribute('id', GetID);\r\n  FMap := nil;\r\nend;\r\n\r\nprocedure TGoogleMaps.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FOptions := TGoogleMapsOptions.Create(Self);\r\n  Width := 400;\r\n  Height := 300;\r\nend;\r\n\r\nfunction TGoogleMaps.Distance(Lon1, Lat1, Lon2, Lat2: double): double;\r\nbegin\r\n  Result := 0;\r\n  asm\r\n    var R = 3958.8; // Radius of the Earth in miles\r\n    var rlat1 = Lat1 * (Math.PI/180); // Convert degrees to radians\r\n    var rlat2 = Lat2 * (Math.PI/180); // Convert degrees to radians\r\n    var difflat = rlat2-rlat1; // Radian difference (latitudes)\r\n    var difflon = (Lon2-Lon1) * (Math.PI/180); // Radian difference (longitudes)\r\n    var d = 2 * R * Math.asin(Math.sqrt(Math.sin(difflat/2)*Math.sin(difflat/2)+Math.cos(rlat1)*Math.cos(rlat2)*Math.sin(difflon/2)*Math.sin(difflon/2)));\r\n    Result = d;\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.DoLoaded(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  BindEvents;\r\n  Result := true;\r\n\r\n  Options.SetMapStyle(Options.MapStyle);\r\n\r\n  if Cursor <> crDefault then\r\n    SetControlCursor(Cursor);\r\n\r\n  if Assigned(OnMapLoaded) then\r\n    OnMapLoaded(Self);\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TGoogleMaps.FitBounds(LatMin, LonMin, LatMax, LonMax: double);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n\r\n  if Assigned(map) and GoogleLoaded then\r\n  begin\r\n    asm\r\n      var ne = new google.maps.LatLng(LatMax, LonMax);\r\n      var sw = new google.maps.LatLng(LatMin, LonMin);\r\n      var bounds = new google.maps.LatLngBounds(sw,ne);\r\n      map.fitBounds(bounds);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.Loaded;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TGoogleMaps.MoveMarker(AIndex: integer; NewLat, NewLon: double);\r\nvar\r\n  marker: JSValue;\r\nbegin\r\n  marker := Markers[AIndex];\r\n  asm\r\n    var latlng = new google.maps.LatLng(NewLat,NewLon);\r\n    marker.setPosition(latlng);\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\nprocedure TGoogleMaps.GeoCode(const Address: string);\r\nvar\r\n  FURL: string;\r\nbegin\r\n  FReq := TJSXMLHttpRequest.new;\r\n  FReq.addEventListener('load', @HandleResponse);\r\n  FReq.addEventListener('abort',@HandleAbort);\r\n\r\n  FURL := 'https://maps.googleapis.com/maps/api/geocode/json?address=' + encodeURIComponent(Address) +'&key=' + APIKey;\r\n  FReq.open('GET', FURL);\r\n  FReq.send;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TGoogleMaps.PanTo(Lat, Lon: double);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  if Assigned(map) and GoogleLoaded then\r\n  begin\r\n    asm\r\n      map.panTo(new google.maps.LatLng(Lat, Lon));\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.PanToBounds(Lat1, Lon1, Lat2, Lon2: double);\r\nvar\r\n  bounds: JSValue;\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  if Assigned(map) and GoogleLoaded then\r\n  begin\r\n    bounds := GetBBox(Lon1,Lat1,Lon2,Lat2);\r\n    asm\r\n      map.panToBounds(bounds);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.GetMap: TJSHTMLElement;\r\nvar\r\n  map: TJSHTMLElement;\r\n  id: string;\r\nbegin\r\n  if Assigned(FMap) then\r\n    Result := FMap\r\n  else\r\n  begin\r\n    map := nil;\r\n\r\n    id := GetID;\r\n    asm\r\n      var el = document.getElementById(id);\r\n      if (el != null) {\r\n        map = el.gMap;\r\n      }\r\n    end;\r\n\r\n    Result := map;\r\n    if Assigned(map) then\r\n      FMap := Result;\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.GetBounds(var NorthEastLat, NorthEastLon, SouthWestLat,\r\n  SouthWestLon: Double): Boolean;\r\nvar\r\n  neLon, neLat, swLon, swLat: String;\r\nbegin\r\n  Result := false;\r\n  NorthEastLon := -1;\r\n  NorthEastLat := -1;\r\n  SouthWestLon := -1;\r\n  SouthWestLat := -1;\r\n\r\n  asm\r\n    neLon = map.getBounds().getNorthEast().lng().toString();\r\n    neLat = map.getBounds().getNorthEast().lat().toString();\r\n    swLon = map.getBounds().getSouthWest().lng().toString();\r\n    swLat = map.getBounds().getSouthWest().lat().toString();\r\n  end;\r\n\r\n  if (neLon <> '') and (neLat <> '') and (swLon <> '') and (swLat <> '') then\r\n  begin\r\n    NorthEastLon := StrToFloat(swLon);\r\n    NorthEastLat := StrToFloat(swLat);\r\n    SouthWestLon := StrToFloat(swLon);\r\n    SouthWestLat := StrToFloat(swLat);\r\n    Result := true;\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.GetBBox(Lon1, Lat1, Lon2, Lat2: double): JSValue;\r\nvar\r\n  SW,NE: JSValue;\r\nbegin\r\n  SW := GetCoord(Lon1,Lat1);\r\n  NE := GetCoord(Lon2,Lat2);\r\n\r\n  asm\r\n    Result = new google.maps.LatLngBounds(SW,NE);\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.GetCenter(var Lat, Lon: Double): Boolean;\r\nvar\r\n  sLon, sLat: String;\r\nbegin\r\n  Result := false;\r\n  Lon := -1;\r\n  Lat := -1;\r\n\r\n  asm\r\n    sLon = map.getCenter().lng().toString();\r\n    sLat = map.getCenter().lat().toString();\r\n  end;\r\n\r\n  if (sLon <> '') and (sLat <> '') then\r\n  begin\r\n    Lon := StrToFloat(sLon);\r\n    Lat := StrToFloat(sLat);\r\n    Result := true;\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.GetCircle(AIndex: integer): TJSObject;\r\nvar\r\n  res: TJSObject;\r\nbegin\r\n  asm\r\n    res = this.FCircles[AIndex];\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction TGoogleMaps.GetCoord(Lon, Lat: double): JSValue;\r\nbegin\r\n  asm\r\n    Result = new google.maps.LatLng(Lat,Lon);\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.GetID: string;\r\nbegin\r\n  Result := inherited GetID;\r\n\r\n  if Result = '' then\r\n  begin\r\n    ElementID := GetNewName;\r\n    Result := ElementID;\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.GetMarker(AIndex: integer): TJSObject;\r\nvar\r\n  res: TJSObject;\r\nbegin\r\n  asm\r\n    res = this.FMarkers[AIndex];\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TGoogleMaps.GetPolygon(AIndex: integer): TJSObject;\r\nvar\r\n  res: TJSObject;\r\nbegin\r\n  asm\r\n    res = this.FPolygon[AIndex];\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TGoogleMaps.GetPolyline(AIndex: integer): TJSObject;\r\nvar\r\n  res: TJSObject;\r\nbegin\r\n  asm\r\n    res = this.FPolyline[AIndex];\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TGoogleMaps.GetRectangle(AIndex: integer): TJSObject;\r\nvar\r\n  res: TJSObject;\r\nbegin\r\n  asm\r\n    res = this.FGetRectangle[AIndex];\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TGoogleMaps.GoogleLoaded: boolean;\r\nvar\r\n  res: boolean;\r\nbegin\r\n  res := false;\r\n\r\n  asm\r\n    if (typeof google === 'object' && typeof google.maps === 'object')\r\n    {\r\n      res = true;\r\n    }\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TGoogleMaps.HandleAbort(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  //\r\n  Result := true;\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleCircleClick(e: TJSEvent);\r\nvar\r\n  idx: integer;\r\n  LObjRec: TJSObjectRecord;\r\nbegin\r\n  asm\r\n    idx = e.idx;\r\n  end;\r\n\r\n  if Assigned(OnCircleClick) then\r\n  begin\r\n    LObjRec.jsobject := TJSObject(e);\r\n    OnCircleClick(Self, idx, LObjRec);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleKMLClick(e: TJSEvent);\r\nvar\r\n  idx: integer;\r\n  LObjRec: TJSObjectRecord;\r\nbegin\r\n  asm\r\n    idx = e.idx;\r\n  end;\r\n\r\n  if Assigned(OnKMLClick) then\r\n  begin\r\n    LObjRec.jsobject := TJSObject(e);\r\n    OnKMLClick(Self, idx, LObjRec);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleRectangleClick(e: TJSEvent);\r\nvar\r\n  idx: integer;\r\n  LObjRec: TJSObjectRecord;\r\nbegin\r\n  asm\r\n    idx = e.idx;\r\n  end;\r\n\r\n  if Assigned(OnRectangleClick) then\r\n  begin\r\n    LObjRec.jsobject := TJSObject(e);\r\n    OnRectangleClick(Self, idx, LObjRec);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleMapClick(e: TJSEvent);\r\nvar\r\n  lon,lat: double;\r\nbegin\r\n  asm\r\n    lon = e.latLng.lng();\r\n    lat = e.latLng.lat();\r\n  end;\r\n\r\n  if Assigned(OnMapClick) then\r\n    OnMapClick(Self, lon, lat);\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleMapDblClick(e: TJSEvent);\r\nvar\r\n  lon,lat: double;\r\nbegin\r\n  asm\r\n    lon = e.latLng.lng();\r\n    lat = e.latLng.lat();\r\n  end;\r\n\r\n  if Assigned(OnMapDblClick) then\r\n    OnMapDblClick(Self, lon, lat);\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleMapIdle(e: TJSEvent);\r\nbegin\r\n  if Assigned(OnMapIdle) then\r\n    OnMapIdle(Self);\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleMapPan(e: TJSEvent);\r\nvar\r\n  lon,lat: double;\r\nbegin\r\n  asm\r\n    var c = map.getCenter();\r\n    lon = c.lng();\r\n    lat = c.lat();\r\n  end;\r\n\r\n  if Assigned(OnMapPan) then\r\n    OnMapPan(Self, lon, lat);\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleMapZoom(e: TJSEvent);\r\nvar\r\n  map: TJSHTMLElement;\r\n  zoom: integer;\r\nbegin\r\n  map := GetMap;\r\n  asm\r\n    zoom = map.getZoom();\r\n  end;\r\n  if Assigned(OnMapZoom) then\r\n    OnMapZoom(Self, zoom);\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleMarkerClick(e: TJSEvent);\r\nvar\r\n  idx: integer;\r\n  LObjRec: TJSObjectRecord;\r\nbegin\r\n  asm\r\n    idx = e.idx;\r\n  end;\r\n\r\n  if Assigned(OnMarkerClick) then\r\n  begin\r\n    LObjRec.jsobject := TJSObject(e);\r\n    OnMarkerClick(Self, idx, LObjRec);\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TGoogleMaps.HandlePolygonClick(e: TJSEvent);\r\nvar\r\n  idx: integer;\r\n  LObjRec: TJSObjectRecord;\r\nbegin\r\n  asm\r\n    idx = e.idx;\r\n  end;\r\n\r\n  if Assigned(OnPolygonClick) then\r\n  begin\r\n    LObjRec.jsobject := TJSObject(e);\r\n    OnPolygonClick(Self, idx, LObjRec);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.HandlePolylineClick(e: TJSEvent);\r\nvar\r\n  idx: integer;\r\n  LObjRec: TJSObjectRecord;\r\nbegin\r\n  asm\r\n    idx = e.idx;\r\n  end;\r\n\r\n  if Assigned(OnPolylineClick) then\r\n  begin\r\n    LObjRec.jsobject := TJSObject(e);\r\n    OnPolylineClick(Self, idx, LObjRec);\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.HandleResponse(Event: TEventListenerEvent): boolean;\r\nvar\r\n  fnd: boolean;\r\n  reslat, reslon: double;\r\nbegin\r\n  Result := true;\r\n  fnd := false;\r\n\r\n  asm\r\n    var s = Event.target.responseText;\r\n    var js = JSON.parse(s);\r\n    if (js.status == \"OK\") {\r\n      fnd = true;\r\n      var lat = js.results[0].geometry.location.lat;\r\n      var lng = js.results[0].geometry.location.lng;\r\n      reslon = lng;\r\n      reslat = lat;\r\n    }\r\n  end;\r\n\r\n  if fnd and Assigned(OnGeoCoded) then\r\n  begin\r\n    OnGeoCoded(Self, reslon, reslat);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.RemoveDirections;\r\nvar\r\n  dirdispl: TJSElement;\r\nbegin\r\n  if not Assigned(FDirectionsDisplay) then\r\n    BindEvents;\r\n\r\n  dirdispl := FDirectionsDisplay;\r\n\r\n  asm\r\n    dirdispl.setMap(null);\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\nprocedure TGoogleMaps.SetAPIKey(const Value: string);\r\nbegin\r\n  if FAPIKey <> Value then\r\n  begin\r\n    FAPIKey := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TGoogleMaps.SetCenter(Lat, Lon: double);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  if Assigned(map) then\r\n  begin\r\n    asm\r\n      map.setCenter(new google.maps.LatLng(Lat, Lon));\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetDoubleClickZoom(AValue: Boolean);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  if Assigned(map) then\r\n  begin\r\n    asm\r\n      map.setOptions( {disableDoubleClickZoom:!AValue} );\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetDraggable(AValue: Boolean);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  if Assigned(map) then\r\n  begin\r\n    asm\r\n      map.setOptions( {draggable:AValue} );\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetHeading(AHeading: double);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  if Assigned(map) then\r\n  begin\r\n    asm\r\n      map.setHeading(AHeading);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetMapID(const Value: string);\r\nbegin\r\n  if FMapID <> Value then\r\n  begin\r\n    FMapID := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetMapRender(const Value: TGoogleMapsRender);\r\nbegin\r\n  if FMapRender <> Value then\r\n  begin\r\n    FMapRender := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetMapType(AMapType: TGoogleMapType);\r\nvar\r\n  map: TJSHTMLElement;\r\n  smt: string;\r\nbegin\r\n  map := GetMap;\r\n\r\n  case AMapType of\r\n    mtDefault: smt := 'roadmap';\r\n    mtSatellite: smt := 'satellite';\r\n    mtHybrid: smt := 'hybrid';\r\n    mtTerrain: smt := 'terrain';\r\n  end;\r\n\r\n  asm\r\n    map.setMapTypeId(smt);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.RemoveCircle(AIndex: Integer);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FPolygons.length)\r\n    {\r\n      this.FCircles[AIndex].setMap(null);\r\n      this.FCircles.splice(AIndex, 1);\r\n    }\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TGoogleMaps.RemoveMarker(AIndex: Integer);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FMarkers.length)\r\n    {\r\n      this.FMarkers[AIndex].setMap(null);\r\n      this.FMarkers.splice(AIndex, 1);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.RemovePolygon(AIndex: Integer);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FPolygons.length)\r\n    {\r\n      this.FPolygons[AIndex].setMap(null);\r\n      this.FPolygons.splice(AIndex, 1);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.RemovePolyline(AIndex: Integer);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FPolylines.length)\r\n    {\r\n      this.FPolylines[AIndex].setMap(null);\r\n      this.FPolylines.splice(AIndex, 1);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.RemoveRectangle(AIndex: Integer);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FPolygons.length)\r\n    {\r\n      this.FRectangles[AIndex].setMap(null);\r\n      this.FRectangles.splice(AIndex, 1);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetMarkerIcon(AIndex: Integer; Url: string);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FMarkers.length)\r\n    {\r\n      this.FMarkers[AIndex].setIcon(Url);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetMarkerLocation(AIndex: Integer; Lat, Lon: Double);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FMarkers.length)\r\n    {\r\n      this.FMarkers[AIndex].setPosition(new google.maps.LatLng(Lat, Lon));\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetMarkerTitle(AIndex: Integer; ATitle: string);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FMarkers.length)\r\n    {\r\n      this.FMarkers[AIndex].setTitle(ATitle);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetPolygonColors(AIndex: Integer; AFillColor,\r\n  AStrokeColor: TColor);\r\nvar\r\n  clrF, clrS: string;\r\nbegin\r\n  clrF := ColorToHTML(AFillColor);\r\n  clrS := ColorToHTML(AStrokeColor);\r\n  asm\r\n    if (AIndex < this.FPolygons.length)\r\n    {\r\n      this.FPolygons[AIndex].setOptions({ fillColor: clrF, strokeColor: clrS });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetPolygonPoints(AIndex: Integer; Points: TJSArray);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FPolygons.length)\r\n    {\r\n      this.FPolygons[AIndex].setOptions({ path: Points });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetPolylineColor(AIndex: Integer; AColor: TColor);\r\nvar\r\n  clr: string;\r\nbegin\r\n  clr := ColorToHTML(AColor);\r\n  asm\r\n    if (AIndex < this.FPolylines.length)\r\n    {\r\n      this.FPolylines[AIndex].setOptions({ strokeColor: clr });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetPolylinePoints(AIndex: Integer; Points: TJSArray);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FPolylines.length)\r\n    {\r\n      this.FPolylines[AIndex].setOptions({ path: Points });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetRectangleColors(AIndex: Integer; AFillColor,\r\n  AStrokeColor: TColor);\r\nvar\r\n  clrF, clrS: string;\r\nbegin\r\n  clrF := ColorToHTML(AFillColor);\r\n  clrS := ColorToHTML(AStrokeColor);\r\n  asm\r\n    if (AIndex < this.FRectangles.length)\r\n    {\r\n      this.FRectangles[AIndex].setOptions({ fillColor: clrF, strokeColor: clrS });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetRectangleLocation(AIndex: Integer; NorthEastLat,\r\n  NorthEastLon, SouthWestLat, SouthWestLon: double);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FRectangles.length)\r\n    {\r\n      var NELatLng = {lat: NorthEastLat, lng: NorthEastLon};\r\n      var SWLatLng = {lat: SouthWestLat, lng: SouthWestLon};\r\n      this.FRectangles[AIndex].setOptions({ bounds: new google.maps.LatLngBounds(NELatLng, SWLatLng) });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetCircleCenter(AIndex: Integer; Lat, Lon: Double);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FCircles.length)\r\n    {\r\n      this.FCircles[AIndex].setCenter(new google.maps.LatLng(Lat, Lon));\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetCircleColors(AIndex: Integer; AFillColor,\r\n  AStrokeColor: TColor);\r\nvar\r\n  clrF, clrS: string;\r\nbegin\r\n  clrF := ColorToHTML(AFillColor);\r\n  clrS := ColorToHTML(AStrokeColor);\r\n  asm\r\n    if (AIndex < this.FCircles.length)\r\n    {\r\n      this.FCircles[AIndex].setOptions({ fillColor: clrF, strokeColor: clrS });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetCircleRadius(AIndex, Radius: Integer);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FCircles.length)\r\n    {\r\n      this.FCircles[AIndex].setRadius(Radius);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetControlCursor(const Value: TCursor);\r\nvar\r\n  map: TJSHTMLElement;\r\n  s: string;\r\nbegin\r\n  inherited;\r\n\r\n  map := GetMap;\r\n  if Value = crDefault then\r\n    s := ''''''\r\n  else\r\n    s := GetHTMLCursorName(Value);\r\n\r\n  if Assigned(map) then\r\n  begin\r\n    asm\r\n      map.setOptions({draggableCursor: s});\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetScrollWheel(AValue: Boolean);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  asm\r\n    map.setOptions( {scrollWheel:AValue} );\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetTilt(ATilt: double);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  if Assigned(map) then\r\n  begin\r\n    asm\r\n      map.setTitle(ATilt);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetZoom(Zoom: Integer);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  if Assigned(map) then\r\n  begin\r\n    asm\r\n      map.setZoom(Zoom);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ShowDirections(SourceLon, SourceLat, DestLon,\r\n  DestLat: double; ATravelMode: TGoogleTravelMode = tmDriving;\r\n  WayPoints: TStringList = nil; OptimizeWayPoints: Boolean = False;\r\n  AvoidHighways: Boolean = False; AvoidTolls: Boolean = False);\r\nvar\r\n  dirsvc,dirdispl,map: TJSElement;\r\n  tm: string;\r\n  wp: TJSArray;\r\n  I: Integer;\r\nbegin\r\n  if not Assigned(FDirectionsDisplay) then\r\n    BindEvents;\r\n\r\n  dirsvc := FDirectionsService;\r\n  dirdispl := FDirectionsDisplay;\r\n  map := GetMap;\r\n  tm := TravelModeStr(ATravelMode);\r\n  wp := TJSArray.New;\r\n  if WayPoints <> nil then\r\n  begin\r\n    for I := 0 to WayPoints.Count - 1 do\r\n      wp.Push(New(['location', WayPoints[I]]));\r\n  end;\r\n\r\n  asm\r\n    var sourcelatlon = new google.maps.LatLng(SourceLat, SourceLon);\r\n    var destlatlon = new google.maps.LatLng(DestLat, DestLon);\r\n\r\n    dirdispl.setMap(map);\r\n    dirsvc.route({\r\n          origin: sourcelatlon,\r\n          destination: destlatlon,\r\n          waypoints: wp,\r\n          optimizeWaypoints: OptimizeWayPoints,\r\n          avoidHighways: AvoidHighways,\r\n          avoidTolls: AvoidTolls,\r\n          travelMode: tm\r\n        }, function(response, status) {\r\n          if (status === 'OK') {\r\n            dirdispl.setDirections(response);\r\n          } else {\r\n            window.alert('Directions request failed due to ' + status);\r\n          }\r\n        });\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.HideStreetView;\r\nvar\r\n  map: TJSElement;\r\nbegin\r\n  map := GetMap;\r\n  asm\r\n    map.streetView.setVisible(false);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ShowStreetView(Lat, Lon: Double; Heading, Zoom,\r\n  Pitch: Integer);\r\nvar\r\n  map: TJSElement;\r\n  mapid: string;\r\nbegin\r\n  map := GetMap;\r\n  mapid := GetID;\r\n  asm\r\n    var LatLng = {lat: Lat, lng: Lon};\r\n    var panorama = new google.maps.StreetViewPanorama(\r\n        document.getElementById(mapid), {\r\n          position: LatLng,\r\n          pov: {\r\n            heading: Heading,\r\n            zoom: Zoom,\r\n            pitch: Pitch\r\n          }\r\n        });\r\n    map.setStreetView(panorama);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ShowDirections(Source, Destination: string;\r\n  ATravelMode: TGoogleTravelMode; WayPoints: TStringList; OptimizeWayPoints,\r\n  AvoidHighways, AvoidTolls: Boolean);\r\nvar\r\n  dirsvc,dirdispl,map: TJSElement;\r\n  tm: string;\r\n  wp: TJSArray;\r\n  I: Integer;\r\nbegin\r\n  if not Assigned(FDirectionsDisplay) then\r\n    BindEvents;\r\n\r\n  dirsvc := FDirectionsService;\r\n  dirdispl := FDirectionsDisplay;\r\n  map := GetMap;\r\n  tm := TravelModeStr(ATravelMode);\r\n  wp := TJSArray.New;\r\n  if WayPoints <> nil then\r\n  begin\r\n    for I := 0 to WayPoints.Count - 1 do\r\n      wp.Push(New(['location', WayPoints[I]]));\r\n  end;\r\n\r\n  asm\r\n    dirdispl.setMap(map);\r\n\r\n    dirsvc.route({\r\n          origin: Source,\r\n          destination: Destination,\r\n          waypoints: wp,\r\n          optimizeWaypoints: OptimizeWayPoints,\r\n          avoidHighways: AvoidHighways,\r\n          avoidTolls: AvoidTolls,\r\n          travelMode: tm\r\n        }, function(response, status) {\r\n          if (status === 'OK') {\r\n            dirdispl.setDirections(response);\r\n          } else {\r\n            window.alert('Directions request failed due to ' + status);\r\n          }\r\n        });\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.TravelModeStr(ATravelMode: TGoogleTravelMode): string;\r\nbegin\r\n  Result := 'DRIVING';\r\n  case ATravelMode of\r\n    tmDriving: Result := 'DRIVING';\r\n    tmWalking: Result := 'WALKING';\r\n    tmBicycling: Result := 'BICYCLING';\r\n    tmTransit: Result := 'TRANSIT';\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.UpdateElement;\r\nvar\r\n  map: TJSHTMLElement;\r\n  id: string;\r\n  srcurl: string;\r\n  scriptsrc: string;\r\n  mapidstr: string;\r\n  mapbeta: string;\r\n  scr,scro: TJSElement;\r\n  sp: TJSHTMLElement;\r\n\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if FUpdateCount > 0 then\r\n    Exit;\r\n\r\n  if ((not FCode) and (FAPIKey <> '')) or (FAPIKey <> FOldAPIKey) then\r\n  begin\r\n    FCode := true;\r\n    id := GetID;\r\n    FOldAPIKey := FAPIKey;\r\n\r\n    scr := document.getElementById('scrgooglemaps');\r\n    if Assigned(scr) then\r\n    begin\r\n      document.head.removeChild(scr);\r\n    end;\r\n\r\n    scro := document.getElementById('scrogooglemaps');\r\n    if Assigned(scro) then\r\n    begin\r\n      document.head.removeChild(scro);\r\n    end;\r\n\r\n    if (MapRender = mrVector) and (MapID <> '') then\r\n      mapbeta := 'v=beta&';\r\n\r\n    mapidstr := '';\r\n    if MapID <> '' then\r\n      mapidstr := 'mapId:'''+MapID+''','+#13#10;\r\n\r\n    srcurl := 'https://maps.googleapis.com/maps/api/js?'+mapbeta+'key=' + FAPIKey + '&callback=initMap'+id;\r\n\r\n    scriptsrc := 'var gmapserror = false;'+#13#10+\r\n         'function initMap'+id+'() { '+#13#10+\r\n         'var el = document.getElementById(\"'+id+'\");'+#13#10+\r\n         'if (el == null) { alert(\"Google Maps DIV element not found!\"); }'+#13#10+\r\n         'map = new google.maps.Map(el, {'+#13#10+\r\n         'center: {lat: ' + StringReplace(FloatToStr(Options.DefaultLatitude), ',', '.', [rfReplaceAll]) + ', lng: ' + StringReplace(FloatToStr(Options.DefaultLongitude), ',', '.', [rfReplaceAll]) + '},'+#13#10+\r\n         mapidstr+\r\n         'zoom: ' + IntToStr(Options.DefaultZoomLevel) + '});'+#13#10+\r\n         'el.gMap = map;'+#13#10+\r\n         '}';\r\n\r\n    scr := document.createElement('script');\r\n    scr.addEventListener('load',@DoLoaded);\r\n    asm\r\n      scr.defer = true;\r\n      scr.async = true;\r\n      scr.src = srcurl;\r\n      scr.type = 'text/javascript';\r\n    end;\r\n\r\n    document.head.appendChild(scr);\r\n    scr['id'] := 'scrgooglemaps';\r\n\r\n    scro := document.createElement('script');\r\n    TJSHTMLElement(scro).innerHTML := scriptsrc;\r\n    document.head.appendChild(scro);\r\n    scro['id'] := 'scrogooglemaps';\r\n\r\n  end\r\n  else if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('border', '1px solid gray');\r\n    ElementHandle.style.setProperty('background-color', '#eee');\r\n    if (ElementHandle.childElementCount = 0) then\r\n    begin\r\n      sp := TJSHTMLElement(document.createElement('SPAN'));\r\n\r\n      srcurl := '<br>Set the Google Maps JavaScript API key via WebGoogleMaps.APIKey in order to see the map.<br>'+\r\n                'Request the key via <a href=\"https://developers.google.com/maps/documentation/javascript/get-api-key\">this page</a>';\r\n      sp.innerHTML := srcurl;\r\n      ElementHandle.appendChild(sp);\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\n{ TFileUpload }\r\n\r\n// https://css-tricks.com/drag-and-drop-file-uploading/\r\n// https://html5demos.com/dnd-upload/\r\n\r\nfunction isAdvancedUpload: boolean; assembler;\r\nasm\r\n  var div = document.createElement('div');\r\n  return (('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;\r\nend;\r\n\r\n\r\nprocedure TFileUpload.Clear;\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  el := document.getElementByID('FP'+ElementId);\r\n  if Assigned(el) then\r\n  begin\r\n    el['type'] := '';\r\n    el['type'] := 'file';\r\n  end;\r\n\r\n  el := document.getElementById(ElementID+'fileslist');\r\n  if Assigned(el) then\r\n  begin\r\n    el.innerHTML := '';\r\n  end;\r\n\r\n  while Files.Count > 0 do\r\n    Files.Delete(0);\r\nend;\r\n\r\nprocedure TFileUpload.ColorChanging;\r\nbegin\r\n  inherited;\r\n  UpdateElement;\r\nend;\r\n\r\nconstructor TFileUpload.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n\r\n  Color := $00DFDAC8;\r\n  FontHoverColor :=  $00d3bf39;\r\n  Caption := 'Choose a file';\r\n  FDragCaption := 'or drag it here';\r\n  FDragColor := clNone;\r\n\r\n  FShowPicture := true;\r\n  FFiles := TFiles.Create(Self);\r\n\r\n  FFileList := TStringList.Create;\r\n  FFileList.SkipLastLineBreak := true;\r\nend;\r\n\r\nprocedure TFileUpload.CreateCSS;\r\nbegin\r\n  AddControlStyle(\r\n  '  \t.box'+\r\n\t'\t\t\t{'+\r\n//\t'\t\t\t\tfont-size: 1.25rem; /* 20 */'+\r\n//\t'\t\t\t\tbackground-color: #c8dadf;'+\r\n\t' \t\t\tposition: relative;'+\r\n\t'\t    \tpadding: 2px 2px;'+\r\n\t'\t\t}'+\r\n\t'\t\t.box.has-advanced-upload'+\r\n\t'\t\t{'+\r\n\t'\t\t\toutline: 2px dashed #92b0b3;'+\r\n\t'\t\t\toutline-offset: -10px;'+\r\n\t'\t\t\t-webkit-transition: outline-offset .15s ease-in-out, background-color .15s linear;'+\r\n\t'\t\t\ttransition: outline-offset .15s ease-in-out, background-color .15s linear;'+\r\n\t'\t\t}'+\r\n\t'\t\t.box.is-dragover'+\r\n\t'\t\t{'+\r\n\t'\t\t\toutline-offset: -20px;'+\r\n\t'\t\t\toutline-color: #c8dadf;'+\r\n\t'\t\t\tbackground-color: #fff;'+\r\n\t'\t\t}'+\r\n\t'\t\t\t.box__dragndrop,'+\r\n\t'\t\t\t.box__icon'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\t\tdisplay: none;'+\r\n\t'\t\t\t}'+\r\n\t'\t\t\t.box.has-advanced-upload .box__dragndrop'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\t\tdisplay: inline;'+\r\n\t'\t\t\t}'+\r\n\t'\t\t\t.box.has-advanced-upload .box__icon'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\t\twidth: 100%;'+\r\n\t'\t\t\t\theight: 80px;'+\r\n\t'\t\t\t\tfill: #92b0b3;'+\r\n  '\t\t\t\tdisplay: block;'+\r\n\t'\t\t\t\tmargin-bottom: 40px;'+\r\n\t'\t\t\t}'+\r\n\t'\t\t\t.box.is-uploading .box__input,'+\r\n\t'\t\t\t.box.is-success .box__input,'+\r\n\t'\t\t\t.box.is-error .box__input'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\t\tvisibility: hidden;'+\r\n\t'\t\t\t}'+\r\n\t'\t\t\t.box__uploading,'+\r\n\t'\t\t\t.box__success,'+\r\n\t'\t\t\t.box__error'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\tdisplay: none;'+\r\n\t'\t\t\t}'+\r\n\t'\t\t\t.box.is-uploading .box__uploading,'+\r\n\t'\t\t\t.box.is-success .box__success,'+\r\n\t'\t\t\t.box.is-error .box__error'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\t\tdisplay: block;'+\r\n\t'\t\t\t\tposition: absolute;'+\r\n\t'\t\t\t\ttop: 50%;'+\r\n\t'       right: 0;'+\r\n  '\t\t\t\tleft: 0;'+\r\n\t'\t   \t\t-webkit-transform: translateY( -50% );'+\r\n\t'\t\t\t\t\ttransform: translateY( -50% );'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__uploading'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\tfont-style: italic;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__success'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\t-webkit-animation: appear-from-inside .25s ease-in-out;'+\r\n\t'\t\t\t\t\tanimation: appear-from-inside .25s ease-in-out;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t\t@-webkit-keyframes appear-from-inside'+\r\n\t'\t\t\t\t\t{'+\r\n\t'\t\t\t\t\t\tfrom\t{ -webkit-transform: translateY( -50% ) scale( 0 ); }'+\r\n\t'\t\t\t\t\t\t75%\t\t{ -webkit-transform: translateY( -50% ) scale( 1.1 ); }'+\r\n\t'\t\t\t\t\t\tto\t\t{ -webkit-transform: translateY( -50% ) scale( 1 ); }'+\r\n\t'\t\t\t\t\t}'+\r\n\t'\t\t\t\t\t@keyframes appear-from-inside'+\r\n\t'\t\t\t\t\t{'+\r\n\t'\t\t\t\t\t\tfrom\t{ transform: translateY( -50% ) scale( 0 ); }'+\r\n\t'\t\t\t\t\t\t75%\t\t{ transform: translateY( -50% ) scale( 1.1 ); }'+\r\n\t'\t\t\t\t\t\tto\t\t{ transform: translateY( -50% ) scale( 1 ); }'+\r\n\t'\t\t\t\t\t}'+\r\n\t'\t\t\t\t.box__restart'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\tfont-weight: 700;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__restart:focus,'+\r\n\t'\t\t\t\t.box__restart:hover'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\tcolor: '+ ColorToHTML(FontHoverColor)+';'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__file'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\twidth: 0.1px;'+\r\n\t'\t\t\t\t\theight: 0.1px;'+\r\n\t'\t\t\t\t\topacity: 0;'+\r\n\t'\t\t\t\t\toverflow: hidden;'+\r\n\t'\t\t\t\t\tposition: absolute;'+\r\n\t'\t\t\t\t\tz-index: -1;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__file + label'+\r\n\t'\t\t\t\t{'+\r\n//\t'\t\t\t\t\tmax-width: 80%;'+\r\n\t'\t\t\t\t\ttext-overflow: ellipsis;'+\r\n\t'\t\t\t\t\twhite-space: nowrap;'+\r\n\t'\t\t\t\t\tcursor: pointer;'+\r\n\t'\t\t\t\t\tdisplay: inline-block;'+\r\n\t'\t\t\t\t\toverflow: hidden;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__file + label:hover strong,'+\r\n\t'\t\t\t\t.box__file:focus + label strong,'+\r\n\t'\t\t\t\t.box__file.has-focus + label strong'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\tcolor: '+ColorToHTML(FontHoverColor)+';' +\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__file:focus + label,'+\r\n\t'\t\t\t\t.box__file.has-focus + label'+\r\n\t'\t\t\t\t{'+\r\n\t' \t\t\t\toutline: 1px dotted #000;'+\r\n\t'\t\t\t\t\toutline: -webkit-focus-ring-color auto 5px;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__button'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\tfont-weight: 700;'+\r\n\t'\t\t\t\t\tcolor: #e5edf1;'+\r\n\t'\t\t\t\t\tbackground-color: #39bfd3;'+\r\n\t'\t\t\t\t\tdisplay: none;'+\r\n\t'\t\t\t\t\tpadding: 8px 16px;'+\r\n\t'\t\t\t\t\tmargin: 10px auto 0;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t\t.box__button:hover,'+\r\n\t'\t\t\t\t\t.box__button:focus'+\r\n\t'\t\t\t\t\t{'+\r\n\t'\t\t\t\t\t\tbackground-color: #0f3c4b;'+\r\n\t'\t\t\t\t\t}'\r\n  );\r\n\r\nend;\r\n\r\nfunction TFileUpload.CreateElement: TJSElement;\r\nbegin\r\n  CreateCSS;\r\n  FCreateRef := Name;\r\n  Result := document.createElement('FORM');\r\n  Result.setAttribute('method','post');\r\n  Result.setAttribute('class','box');\r\n  Result.setAttribute('enctype','multipart/form-data');\r\n                            //display:flex;justify-content:center;align-items:center\"\r\n  TJSHTMLElement(Result).style.setProperty('display','flex');\r\n  TJSHTMLElement(Result).style.setProperty('justify-content','center');\r\n  TJSHTMLElement(Result).style.setProperty('align-items','center');\r\n\r\n//    <span style=\"display:inline-block;\">\r\n  Result.innerHTML :=\r\n   '<div class=\"box__input\" style=\"text-align: center\">' +\r\n   '<svg class=\"box__icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"43\" viewBox=\"0 0 50 43\">'+\r\n   '<path d=\"M48.4 26.5c-.9 0-1.7.7-1.7 1.7v11.6h-43.3v-11.6c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v13.2c0 .9.7 1.7 1.7 1.7h46.7c.9 0 1.7-.7 1.7-1.7v-13.2c0-1-.7-1.7-1.7-1.7zm-24.5 6.1c.3.3.8.5 1.2.5.4 0 .9-.2 1.2-.5l10-11.6c.7-.7.7-1.7 0-2.4s-1.7-.7-2.4 0l-7.1 8.3v-25.3c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v25.3l-7.1-8.3c-.7-.7-1.7-.7-2.4 0s-.7 1.7 0 2.4l10 11.6z\"/></svg>'+\r\n   '<input class=\"box__file\" type=\"file\" name=\"files[]\" id=\"FP'+Name+'\" data-multiple-caption=\"{count} files selected\" multiple/>' +\r\n   '<label for=\"FP'+Name+'\" style=\"outline:none\"><strong id=\"'+Name+'lbl\">'+Caption+'</strong>&nbsp;<span class=\"box__dragndrop\" id=\"'+Name+'drag\">'+FDragCaption+'</span>.</label>' +\r\n   '<button class=\"box__button\" type=\"submit\">Upload</button>' +\r\n   '<br><span style=\"display:inline-block;\" id=\"'+Name+'fileslist\"></span>' +\r\n   '</div><div class=\"box__uploading\">Uploading&hellip;</div>';\r\n\r\n   Result.addEventListener('drop', @HandleDroppedFiles);\r\n   Result.addEventListener('dragenter', @HandleDragOver);\r\n   Result.addEventListener('dragover', @HandleDragOver);\r\n   Result.addEventListener('dragend', @HandleDragEnd);\r\n   Result.addEventListener('dragleave', @HandleDragEnd);\r\n\r\n   if isAdvancedUpload then\r\n     Result.classList.add( 'has-advanced-upload' );\r\nend;\r\n\r\nprocedure TFileUpload.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FMultifile := false;\r\n  FShowFiles := false;\r\n  FEventInit := false;\r\n  Width := 170;\r\n  Height := 190;\r\nend;\r\n\r\ndestructor TFileUpload.Destroy;\r\nbegin\r\n  FFiles.Free;\r\n  FFilelist.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TFileUpload.DoHandleChange(e: TJSEvent): boolean;\r\nvar\r\n  el,span: TJSHTMLElement;\r\n  curfiles: TJSHTMLFileList;\r\n  szfiles: string;\r\nbegin\r\n  Result := true;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    el := TJSHTMLElement(e.target);\r\n    if Assigned(el) then\r\n    begin\r\n      asm\r\n        curfiles = el.files;\r\n      end;\r\n\r\n      szfiles := HandleFiles(curfiles);\r\n\r\n      if ShowFiles then\r\n      begin\r\n        span := TJSHTMLElement(document.getElementById(ElementID+'fileslist'));\r\n        span.innerHTML := szFiles;\r\n      end;\r\n\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TFileUpload.HandleDragEnd(Event: TJSDragEvent): boolean;\r\nbegin\r\n  Result := true;\r\n  Event.preventDefault();\r\n  Event.stopPropagation();\r\n\r\n  if Assigned(Container) then\r\n    Container.setAttribute('class','box has-advanced-upload');\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if (Color <> clNone) and (DragColor <> clNone) then\r\n      ElementHandle.style.setProperty('background-color',ColorToHTML(Color))\r\n    else\r\n      ElementHandle.style.removeProperty('background-color');\r\n  end;\r\nend;\r\n\r\nfunction TFileUpload.HandleDragOver(Event: TJSDragEvent): boolean;\r\nbegin\r\n  Result := true;\r\n  Event.preventDefault();\r\n  Event.stopPropagation();\r\n\r\n  if Assigned(Container) then\r\n    Container.setAttribute('class','box has-advanced-upload is-dragover');\r\n\r\n  if Assigned(ElementHandle) and (DragColor <> clNone) then\r\n    ElementHandle.style.setProperty('background-color',ColorToHTML(DragColor));\r\nend;\r\n\r\nfunction TFileUpload.HandleDroppedFiles(Event: TJSDragEvent): boolean;\r\nvar\r\n  droppedfiles: TJSHTMLFileList;\r\n  span: TJSHTMLElement;\r\n  szFiles: string;\r\n\r\nbegin\r\n  Result := true;\r\n  Event.preventDefault();\r\n  Event.stopPropagation();\r\n\r\n  droppedFiles := Event.dataTransfer.files;\r\n  szFiles := HandleFiles(droppedfiles);\r\n\r\n  if ShowFiles then\r\n  begin\r\n    span := TJSHTMLElement(document.getElementById(ElementID+'fileslist'));\r\n    span.innerHTML := szFiles;\r\n  end;\r\n\r\n  Container.setAttribute('class','box has-advanced-upload');\r\nend;\r\n\r\nfunction TFileUpload.HandleFiles(files: TJSHTMLFileList): string;\r\nvar\r\n  i,sz: integer;\r\n  afile: TJSHTMLFile;\r\n  szFiles, m: string;\r\n  d: TJSDate;\r\nbegin\r\n  szFiles := '';\r\n\r\n  while FFiles.Count > 0 do\r\n    FFiles.Delete(0);\r\n  while FFileList.Count > 0 do\r\n    FFileList.Delete(0);\r\n\r\n  for i := 0 to files.length - 1 do\r\n  begin\r\n    afile := files.item(i);\r\n\r\n    asm\r\n      d = new Date(afile.lastModified);\r\n      m = afile.type;\r\n      sz = afile.size;\r\n    end;\r\n\r\n    with FFiles.Add do\r\n    begin\r\n      FileObject := afile;\r\n      Name := afile.Name;\r\n      MimeType := m;\r\n      Size := sz;\r\n      Modified := EncodeDate(d.Year + 1900, d.Month + 1, d.Date)+EncodeTime(d.Hours, d.Minutes, d.Seconds, d.Milliseconds);\r\n    end;\r\n\r\n    if Assigned(FFileList) then\r\n      FFileList.Add(afile.name);\r\n\r\n    if ShowFiles then\r\n    begin\r\n      if i > 0 then\r\n        szFiles := szFiles + '<br>';\r\n\r\n      szFiles := szFiles + afile.name;\r\n    end;\r\n\r\n    if not MultiFile then\r\n      break;\r\n  end;\r\n\r\n  Result := szFiles;\r\n\r\n  if Assigned(OnDroppedFiles) then\r\n    OnDroppedFiles(Self, FFileList);\r\nend;\r\n\r\nprocedure TFileUpload.SetAccept(const Value: string);\r\nbegin\r\n  if FAccept <> Value then\r\n  begin\r\n    FAccept := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TFileUpload.SetCaption(const AValue: string);\r\nbegin\r\n  if (Caption <> AValue) then\r\n  begin\r\n    inherited SetCaption(AValue);\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TFileUpload.SetDragCaption(const Value: string);\r\nbegin\r\n  FDragCaption := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TFileUpload.SetShowPicture(const Value: boolean);\r\nbegin\r\n  if (FShowPicture <> Value) then\r\n  begin\r\n    FShowPicture := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TFileUpload.UpdateElement;\r\nvar\r\n  el:TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n\r\n  CreateCSS;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('display','flex');\r\n\r\n    el := TJSHTMLElement(ElementHandle.children[0]);\r\n    el := TJSHTMLElement(el.children[0]);\r\n\r\n    if not ShowPicture then\r\n       el.style.setProperty('display','none')\r\n    else\r\n      el.style.removeProperty('display');\r\n\r\n    if ElementFont <> efCSS then\r\n      el.style.setProperty('color',ColorToHTML(Font.Color))\r\n    else\r\n      el.style.removeProperty('color');\r\n\r\n    el := TJSHTMLElement(document.getElementById('FP'+FCreateRef));\r\n\r\n    if Assigned(el) then\r\n    begin\r\n      if not FEventInit then\r\n      begin\r\n        FEventInit := true;\r\n        el.addEventListener('change', @DoHandleChange);\r\n      end;\r\n\r\n      if MultiFile then\r\n        el.SetAttribute('multiple','')\r\n      else\r\n        el.RemoveAttribute('multiple');\r\n\r\n      if FAccept <> '' then\r\n        el.SetAttribute('accept',FAccept)\r\n      else\r\n        el.RemoveAttribute('accept');\r\n    end;\r\n\r\n    el := TJSHTMLElement(document.getElementById(FCreateRef+'lbl'));\r\n    if Assigned(el) then\r\n    begin\r\n      el.innerHTML := Caption;\r\n    end;\r\n\r\n    el := TJSHTMLElement(document.getElementById(FCreateRef+'drag'));\r\n    if Assigned(el) then\r\n    begin\r\n      el.innerHTML := FDragCaption;\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TTwitterFeed }\r\n\r\nfunction TTwitterFeed.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\nprocedure TTwitterFeed.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Width := 400;\r\n  Height := 300;\r\nend;\r\n\r\nprocedure TTwitterFeed.SetFeed(const Value: string);\r\nbegin\r\n  FFeed := Value;\r\n  FUpdatedFeed := false;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TTwitterFeed.SetFeedLinkText(const Value: string);\r\nbegin\r\n  FFeedLinkText := Value;\r\n  UpdateElement;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TTwitterFeed.UpdateElement;\r\nvar\r\n  srcurl,img: string;\r\n  script: TJSElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) and not IsUpdating then\r\n  begin\r\n    srcurl := 'https://platform.twitter.com/widgets.js';\r\n\r\n    script := document.getElementById(TWITTERSCRIPTID);\r\n\r\n    if not Assigned(script) then\r\n    begin\r\n      script := document.createElement('script');\r\n      script['id'] := TWITTERSCRIPTID;\r\n      asm\r\n        script.async = true;\r\n      end;\r\n      script['type'] := 'text/javascript';\r\n      script['charset'] := 'utf-8';\r\n      script['src'] := srcurl;\r\n      document.head.appendChild(script);\r\n    end;\r\n  end;\r\n\r\n  if Assigned(ElementHandle) and not IsUpdating and not FUpdatedFeed then\r\n  begin\r\n    if (Feed <> '') and not (csDesigning in ComponentState) then\r\n    begin\r\n      srcurl := '<a class=\"twitter-timeline\" href=\"https://twitter.com/' + Feed +'\" data-chrome=\"nofooter noborders\">'+ FeedLinkText + '</a>';\r\n\r\n      BorderStyle := bsNone;\r\n      ElementHandle.innerHTML := srcurl;\r\n      asm\r\n        if (typeof twttr !== 'undefined') {\r\n          twttr.widgets.load() }\r\n      end;\r\n      FUpdatedFeed := true;\r\n    end\r\n    else\r\n    begin\r\n      img := 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIg0KICAgd2lkdGg9IjMwMCINCiAgIGhlaWdodD0iMzAwIj4NCjxwYX'+\r\n             'RoIGQ9Im0gMjUwLDg3Ljk3NCBjIC03LjM1OCwzLjI2NCAtMTUuMjY3LDUuNDY5IC0yMy41NjYsNi40NjEgOC40NzEsLTUuMDc4IDE0Ljk3OCwtMTMuMTE5IDE4LjA0MSwtMjIuNzAxIC03LjkyOSw0LjcwMyAtMTYuNzEsOC4xMTcgLTI2LjA1Ny'+\r\n             'w5Ljk1NyAtNy40ODQsLTcuOTc1IC0xOC4xNDgsLTEyLjk1NyAtMjkuOTUsLTEyLjk1NyAtMjIuNjYsMCAtNDEuMDMzLDE4LjM3MSAtNDEuMDMzLDQxLjAzMSAwLDMuMjE2IDAuMzYzLDYuMzQ4IDEuMDYyLDkuMzUxIC0zNC4xMDIsLTEuNzExIC'+\r\n             '02NC4zMzYsLTE4LjA0NyAtODQuNTc0LC00Mi44NzIgLTMuNTMyLDYuMDYgLTUuNTU2LDEzLjEwOCAtNS41NTYsMjAuNjI4IDAsMTQuMjM2IDcuMjQ0LDI2Ljc5NSAxOC4yNTQsMzQuMTUzIC02LjcyNiwtMC4yMTMgLTEzLjA1MywtMi4wNTkgLT'+\r\n             'E4LjU4NSwtNS4xMzIgLTAuMDA0LDAuMTcxIC0wLjAwNCwwLjM0MyAtMC4wMDQsMC41MTYgMCwxOS44OCAxNC4xNDQsMzYuNDY0IDMyLjkxNSw0MC4yMzQgLTMuNDQzLDAuOTM4IC03LjA2OCwxLjQzOSAtMTAuODEsMS40MzkgLTIuNjQ0LDAgLT'+\r\n             'UuMjE0LC0wLjI1OCAtNy43MiwtMC43MzYgNS4yMjIsMTYuMzAxIDIwLjM3NSwyOC4xNjUgMzguMzMxLDI4LjQ5NSAtMTQuMDQzLDExLjAwNiAtMzEuNzM1LDE3LjU2NSAtNTAuOTYsMTcuNTY1IC0zLjMxMiwwIC02LjU3OCwtMC4xOTQgLTkuNz'+\r\n             'g4LC0wLjU3NCAxOC4xNTksMTEuNjQzIDM5LjcyNywxOC40MzcgNjIuODk5LDE4LjQzNyA3NS40NzMsMCAxMTYuNzQ2LC02Mi41MjQgMTE2Ljc0NiwtMTE2Ljc0NyAwLC0xLjc3OSAtMC4wNCwtMy41NDggLTAuMTE5LC01LjMwOSA4LjAxNywtNS'+\r\n             '43ODQgMTQuOTczLC0xMy4wMTEgMjAuNDc0LC0yMS4yMzkgeiIgc3R5bGU9ImZpbGw6IzNhYWFlMSIgLz4NCjwvc3ZnPg==';\r\n\r\n      RenderDesigning(ClassName, Container, Self, True, img);\r\n    end;\r\n  end;\r\n\r\n  if Assigned(ElementHandle)  then\r\n    ElementHandle.style.setProperty('overflow-y','auto');\r\nend;\r\n{$HINTS ON}\r\n\r\n{ TBrowserControl }\r\n\r\nprocedure TBrowserControl.BindEvents;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nfunction TBrowserControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('IFRAME');\r\nend;\r\n\r\nprocedure TBrowserControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Width := 400;\r\n  Height := 300;\r\nend;\r\n\r\nprocedure TBrowserControl.Navigate(const AURL: string);\r\nbegin\r\n  URL := AURL;\r\nend;\r\n\r\nprocedure TBrowserControl.SetReferrerPolicy(\r\n  const Value: TBrowserReferrerPolicy);\r\nbegin\r\n  FReferrerPolicy := Value;\r\n  UpdateElementVisual;\r\nend;\r\n\r\nprocedure TBrowserControl.SetSandbox(const Value: TBrowserSandboxTypes);\r\nbegin\r\n  FSandbox := Value;\r\n  UpdateElementVisual;\r\nend;\r\n\r\nprocedure TBrowserControl.SetURL(const Value: string);\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  FURL := Value;\r\n  el := ElementHandle;\r\n  el.setAttribute('src',Value);\r\nend;\r\n\r\nprocedure TBrowserControl.UpdateElementVisual;\r\nvar\r\n  SandboxStr: string;\r\n\r\n  procedure AppendStr(var s: string; appstr: string);\r\n  begin\r\n    if s = '' then\r\n      s := appstr\r\n    else\r\n      s := s + ' ' + appstr;\r\n  end;\r\n\r\nbegin\r\n  inherited;\r\n\r\n\r\n  if BorderStyle = bsSingle then\r\n    ElementHandle.style.setProperty('border','1px solid silver')\r\n  else\r\n    ElementHandle.style.setProperty('border','0px');\r\n\r\n  SandboxStr := '';\r\n\r\n  if stAllowForms in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-forms');\r\n  if stAllowModals in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-modals');\r\n  if stAllowOrientationLock in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-orientation-lock');\r\n  if stAllowPointerLock in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-pointer-lock');\r\n  if stAllowPopups in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-popups');\r\n  if stAllowPopupsToEscapeSandbox in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-popups-to-escape-sandbox');\r\n  if stAllowPresentation in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-presentation');\r\n  if stAllowSameOrigin in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-same-origin');\r\n  if stAllowScripts in  Sandbox then\r\n    AppendStr(SandboxStr, 'allow-scripts');\r\n  if stAllowTopNavigation in  Sandbox then\r\n    AppendStr(SandboxStr, 'allow-top-navigation');\r\n  if stAllowTopNavigationByUserActivation in  Sandbox then\r\n    AppendStr(SandboxStr, 'allow-top-navigation-by-user-activation');\r\n\r\n  if SandboxStr <> '' then\r\n  begin\r\n    ElementHandle.setAttribute('sandbox',SandboxStr);\r\n  end;\r\n\r\n  case ReferrerPolicy of\r\n    rfNoReferrer: ElementHandle.setAttribute('referrerpolicy','no-referrer');\r\n    rfNoReferrerWhenDowngrade: ElementHandle.setAttribute('referrerpolicy','no-referrer-when-downgrade');\r\n    rfOrigin: ElementHandle.setAttribute('referrerpolicy','origin');\r\n    rfOriginWhenCrossOrigin: ElementHandle.setAttribute('referrerpolicy','origin-when-cross-origin');\r\n    rfUnsafeUrl: ElementHandle.setAttribute('referrerpolicy','unsafe-url');\r\n  end;\r\nend;\r\n\r\n{ TGoogleDrive }\r\n\r\nfunction TGoogleDrive.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\n  FFrameHandle := document.createElement('IFRAME');\r\n  Result.appendChild(FFrameHandle);\r\n  FFrameHandle.setAttribute('frameborder','0');\r\nend;\r\n\r\nprocedure TGoogleDrive.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Width := 400;\r\n  Height := 300;\r\nend;\r\n\r\nprocedure TGoogleDrive.SetFolderID(const Value: string);\r\nbegin\r\n  if (FFolderID <> Value) then\r\n  begin\r\n    FFolderID := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleDrive.SetView(const Value: TDriveView);\r\nbegin\r\n  if (FView <> Value) then\r\n  begin\r\n    FView := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleDrive.UpdateElement;\r\nvar\r\n  vs,img: string;\r\nbegin\r\n  inherited;\r\n\r\n  case View of\r\n  dvList: vs := 'list';\r\n  dvGrid: vs := 'grid';\r\n  end;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if FolderID <> '' then\r\n    begin\r\n      FFrameHandle.setAttribute('src','https://drive.google.com/embeddedfolderview?id='+ FolderID + '&embedded=true#' + vs);\r\n      TJSHTMLElement(FFrameHandle).style.setProperty('border','0');\r\n    end\r\n    else\r\n//      if (csDesigning in ComponentState) then\r\n      begin\r\n        img := 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGV'+\r\n               'uYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEyOCAxMjgiIGlkPSJTb2NpYWxfSWNvbnMiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1s'+\r\n               'bnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnIGlkPSJfeDMzX19zdHJva2UiPjxnIGlkPSJHb29nbGVfRHJpdmUiPjxyZWN0IGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBoZWlnaHQ9I'+\r\n               'jEyOCIgd2lkdGg9IjEyOCIvPjxnIGlkPSJHb29nbGVfRHJpdmVfMV8iPjxwb2x5Z29uIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzM3NzdFMyIgZmlsbC1ydWxlPSJldmVub2RkIiBwb2ludHM9IjIxLjMzNSwxMjAgNDIuNjY2LDgyLjY2NyAxMjgsODIuNj'+\r\n               'Y3IDEwNi42NjYsMTIwICAgICAgICAgIi8+PHBvbHlnb24gY2xpcC1ydWxlPSJldmVub2RkIiBmaWxsPSIjRkZDRjYzIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHBvaW50cz0iODUuMzM1LDgyLjY2NyAxMjgsODIuNjY3IDg1LjMzNSw4IDQyLjY2Niw4ICAgICIvPjx'+\r\n               'wb2x5Z29uIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzExQTg2MSIgZmlsbC1ydWxlPSJldmVub2RkIiBwb2ludHM9IjAsODIuNjY3IDIxLjMzNSwxMjAgNjQsNDUuMzMzIDQyLjY2Niw4ICAgICIvPjwvZz48L2c+PC9nPjwvc3ZnPg==';\r\n\r\n        RenderDesigning(ClassName, Container, Self, True, Img);\r\n      end;\r\n  end;\r\nend;\r\n\r\n{ TFilePicker }\r\n\r\nprocedure TFilePicker.BindEvents;\r\nvar\r\n  eh: TJSEventTarget;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementBindHandle) then\r\n  begin\r\n    eh := ElementBindHandle;\r\n    eh.addEventListener('change',@DoHandleChange);\r\n  end;\r\nend;\r\n\r\nprocedure TFilePicker.Clear;\r\nbegin\r\n  ElementHandle['type'] := '';\r\n  ElementHandle['type'] := 'file';\r\n\r\n  while Files.Count > 0 do\r\n    Files.Delete(0);\r\nend;\r\n\r\nfunction TFilePicker.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('INPUT');\r\n  Result.setAttribute('type','file');\r\nend;\r\n\r\nprocedure TFilePicker.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FFiles := TFiles.Create(Self);\r\n  begin\r\n    Width := 160;\r\n    Height := 40;\r\n  end;\r\nend;\r\n\r\ndestructor TFilePicker.Destroy;\r\nbegin\r\n  FFiles.Free;\r\n  inherited;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TFilePicker.DoHandleChange(e: TJSEvent): boolean;\r\nvar\r\n  i,l,sz: integer;\r\n  eh: TJSElement;\r\n  s,m: string;\r\n  f: TFile;\r\n  d: TJSDate;\r\n  jsfile: TJSHTMLFile;\r\nbegin\r\n  Result := true;\r\n\r\n  // clear existing collection\r\n  while FFiles.Count > 0 do\r\n    FFiles.Delete(0);\r\n\r\n  eh := ElementHandle;  \r\n\r\n  asm\r\n    var curFiles = eh.files;\r\n    l = curFiles.length;\r\n  end;\r\n\r\n  for i := 0 to l - 1 do\r\n  begin\r\n    f := FFiles.Add;\r\n\r\n    asm\r\n      jsfile = curFiles[i];\r\n      s = curFiles[i].name;\r\n      m = curFiles[i].type;\r\n      sz = curFiles[i].size;\r\n      d = new Date(curFiles[i].lastModified);\r\n    end;\r\n\r\n    f.FileObject := jsfile;\r\n    f.Name := s;\r\n    f.MimeType := m;\r\n    f.Size := sz;\r\n    f.Modified := EncodeDate(d.Year + 1900, d.Month + 1, d.Date)+EncodeTime(d.Hours, d.Minutes, d.Seconds, d.Milliseconds);\r\n  end;\r\n\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TFilePicker.GetMethodPointers;\r\nbegin\r\n  if FChangePtr = nil then\r\n  begin\r\n    FChangePtr := @DoHandleChange;\r\n    inherited;\r\n  end;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nprocedure TFilePicker.SetAccept(const Value: string);\r\nbegin\r\n  if (FAccept <> Value) then\r\n  begin\r\n    FAccept := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TFilePicker.SetMultiFile(const Value: boolean);\r\nbegin\r\n  if (FMultiFile <> Value) then\r\n  begin\r\n    FMultiFile := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TFilePicker.UpdateElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if MultiFile then\r\n      ElementHandle.SetAttribute('multiple','')\r\n    else\r\n      ElementHandle.RemoveAttribute('multiple');\r\n\r\n    if FAccept <> '' then\r\n      ElementHandle.SetAttribute('accept',FAccept)\r\n    else\r\n      ElementHandle.RemoveAttribute('accept');\r\n  end;\r\nend;\r\n\r\n{ TFiles }\r\n\r\nfunction TFiles.Add: TFile;\r\nbegin\r\n  Result := TFile(inherited Add);\r\nend;\r\n\r\nprocedure TFiles.Clear;\r\nvar\r\n  fc: integer;\r\nbegin\r\n  fc := Count;\r\n  inherited Clear;\r\n\r\n  if fc > 0 then\r\n  begin\r\n    if (FOwner is TFilePicker) then\r\n      (FOwner as TFilePicker).Clear;\r\n    if (FOwner is TFileUpload) then\r\n      (FOwner as TFileUpload).Clear;\r\n  end;\r\nend;\r\n\r\nconstructor TFiles.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(TFile);\r\n  FOwner := TFilePicker(AOwner);\r\nend;\r\n\r\nfunction TFiles.GetItem(Index: integer): TFile;\r\nbegin\r\n  Result := TFile(inherited Items[Index]);\r\nend;\r\n\r\nfunction TFiles.Insert(Index: integer): TFile;\r\nbegin\r\n  Result := TFile(inherited Insert(Index));\r\nend;\r\n\r\nfunction TFiles.Owner: TPersistent;\r\nbegin\r\n  Result := FOwner;\r\nend;\r\n\r\nprocedure TFiles.SetItem(Index: integer; const Value: TFile);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TFile }\r\n\r\n{$HINTS OFF}\r\nfunction TFile.GetControl: TComponent;\r\nbegin\r\n  Result := nil;\r\n\r\n  if Assigned(Collection) and Assigned((Collection as TFiles).Owner) then\r\n  begin\r\n    if (Collection as TFiles).Owner is TComponent then\r\n      Result := (Collection as TFiles).Owner as TComponent;\r\n  end;\r\nend;\r\n\r\nprocedure TFile.GetFileAsArrayBuffer;\r\nvar\r\n  ptr: pointer;\r\n  f: TJSHTMLFile;\r\nbegin\r\n  ptr := @HandleFileLoadAsArrayBuffer;\r\n  f := FileObject;\r\n\r\n  asm\r\n    var reader = new FileReader();\r\n    reader.addEventListener('load',ptr);\r\n    reader.readAsArrayBuffer(f);\r\n  end;\r\nend;\r\n\r\nprocedure TFile.GetFileAsArrayBuffer(GetAsArrayBuffer: TGetAsArrayBufferProc);\r\nbegin\r\n  FGetAsArrayBuffer := GetAsArrayBuffer;\r\n  GetFileAsArrayBuffer;\r\nend;\r\n\r\nprocedure TFile.GetFileAsBase64(GetAsString: TGetAsStringProc);\r\nbegin\r\n  FGetAsString := GetAsString;\r\n  GetFileAsBase64;\r\nend;\r\n\r\nprocedure TFile.GetFileAsDataURL(GetAsString: TGetAsStringProc);\r\nbegin\r\n  FGetAsString := GetAsString;\r\n  GetFileAsDataURL;\r\nend;\r\n\r\nprocedure TFile.GetFileAsStream;\r\nvar\r\n  ptr: pointer;\r\n  f: TJSHTMLFile;\r\nbegin\r\n  ptr := @HandleFileLoadAsStream;\r\n  f := FileObject;\r\n\r\n  asm\r\n    var reader = new FileReader();\r\n    reader.addEventListener('load',ptr);\r\n    reader.readAsArrayBuffer(f);\r\n  end;\r\nend;\r\n\r\nprocedure TFile.GetFileAsStream(GetAsStream: TGetAsStreamProc);\r\nbegin\r\n  FGetAsStream := GetAsStream;\r\n  GetFileAsStream;\r\nend;\r\n\r\nfunction TFile.FileAsText: TJSPromise;\r\nbegin\r\n  Result := FileAsText('utf-8');\r\nend;\r\n\r\nfunction TFile.FileAsText(AEncoding: string): TJSPromise;\r\nvar\r\n  reader: TJSFileReader;\r\n\r\nbegin\r\n  Result := TJSPromise.new(\r\n    procedure(ASuccess, AFailed: TJSPromiseResolver)\r\n\r\n       function Loader(Event: TEventListenerEvent): boolean;\r\n       begin\r\n         ASuccess(EventResult(Event));\r\n       end;\r\n\r\n    begin\r\n      reader := TJSFileReader.new;\r\n      reader.onload := @Loader;\r\n      reader.readAsText(FileObject, AEncoding);\r\n    end);\r\nend;\r\n\r\nfunction TFile.FileAsBase64: TJSPromise;\r\nvar\r\n  reader: TJSFileReader;\r\n\r\nbegin\r\n  Result := TJSPromise.new(\r\n    procedure(ASuccess, AFailed: TJSPromiseResolver)\r\n\r\n       function Loader(Event: TEventListenerEvent): boolean;\r\n       var\r\n         s: string;\r\n       begin\r\n         asm\r\n           function _arrayBufferToBase64( buffer ) {\r\n           var binary = '';\r\n           var bytes = new Uint8Array( buffer );\r\n           var len = bytes.byteLength;\r\n           for (var i = 0; i < len; i++) {\r\n               binary += String.fromCharCode( bytes[ i ] );\r\n           }\r\n           return window.btoa( binary );\r\n           }\r\n           s = _arrayBufferToBase64(Event.target.result);\r\n         end;\r\n\r\n         ASuccess(s);\r\n       end;\r\n\r\n    begin\r\n      reader := TJSFileReader.new;\r\n      reader.onload := @Loader;\r\n      reader.readAsArrayBuffer(FileObject);\r\n    end);\r\nend;\r\n\r\nfunction TFile.FileAsStream: TJSPromise;\r\nvar\r\n  reader: TJSFileReader;\r\n\r\nbegin\r\n  Result := TJSPromise.new(\r\n    procedure(ASuccess, AFailed: TJSPromiseResolver)\r\n\r\n       function Loader(Event: TEventListenerEvent): boolean;\r\n       var\r\n         ms: TMemoryStream;\r\n         ja: TJSArrayBuffer;\r\n         b: TBytes;\r\n         l: longint;\r\n       begin\r\n         asm\r\n          ja = event.target.result;\r\n         end;\r\n\r\n         b := TMemoryStream.MemoryToBytes(ja);\r\n         l := ja.byteLength;\r\n\r\n         ms := TMemoryStream.Create;\r\n         ms.Write(b,0, l);\r\n         ms.Position := 0;\r\n\r\n         ASuccess(ms);\r\n       end;\r\n\r\n    begin\r\n      reader := TJSFileReader.new;\r\n      reader.onload := @Loader;\r\n      reader.readAsArrayBuffer(FileObject);\r\n    end);\r\nend;\r\n\r\nfunction TFile.FileAsArrayBuffer: TJSPromise;\r\nvar\r\n  reader: TJSFileReader;\r\n\r\nbegin\r\n  Result := TJSPromise.new(\r\n    procedure(ASuccess, AFailed: TJSPromiseResolver)\r\n\r\n       function Loader(Event: TEventListenerEvent): boolean;\r\n       var\r\n         arr: TJSArrayBuffer;\r\n       begin\r\n         asm\r\n           arr = Event.target.result;\r\n         end;\r\n\r\n         ASuccess(arr);\r\n       end;\r\n\r\n    begin\r\n      reader := TJSFileReader.new;\r\n      reader.onload := @Loader;\r\n      reader.readAsArrayBuffer(FileObject);\r\n    end);\r\nend;\r\n\r\nfunction TFile.FileAsDataURL: TJSPromise;\r\nvar\r\n  reader: TJSFileReader;\r\n\r\nbegin\r\n  Result := TJSPromise.new(\r\n    procedure(ASuccess, AFailed: TJSPromiseResolver)\r\n\r\n       function Loader(Event: TEventListenerEvent): boolean;\r\n       var\r\n         s: string;\r\n       begin\r\n         asm\r\n           s = Event.target.result;\r\n         end;\r\n\r\n         ASuccess(s);\r\n       end;\r\n\r\n    begin\r\n      reader := TJSFileReader.new;\r\n      reader.onload := @Loader;\r\n      reader.readAsDataURL(FileObject);\r\n    end);\r\nend;\r\n\r\n\r\nprocedure TFile.GetFileAsText;\r\nvar\r\n  ptr: pointer;\r\n  f: TJSHTMLFile;\r\nbegin\r\n  ptr := @HandleFileLoadAsText;\r\n  f := FileObject;\r\n\r\n  asm\r\n    var reader = new FileReader();\r\n    reader.addEventListener('load',ptr);\r\n    reader.readAsText(f);\r\n  end;\r\nend;\r\n\r\nprocedure TFile.GetFileAsText(AEncoding: string);\r\nvar\r\n  ptr: pointer;\r\n  f: TJSHTMLFile;\r\nbegin\r\n  ptr := @HandleFileLoadAsText;\r\n  f := FileObject;\r\n\r\n  asm\r\n    var reader = new FileReader();\r\n    reader.addEventListener('load',ptr);\r\n    reader.readAsText(f, AEncoding);\r\n  end;\r\n\r\nend;\r\n\r\n\r\nprocedure TFile.GetFileAsBase64;\r\nvar\r\n  ptr: pointer;\r\n  f: TJSHTMLFile;\r\nbegin\r\n  ptr := @HandleFileLoadAsBase64;\r\n  f := FileObject;\r\n\r\n  asm\r\n    var reader = new FileReader();\r\n    reader.addEventListener('load',ptr);\r\n    reader.readAsArrayBuffer(f);\r\n  end;\r\nend;\r\n\r\nprocedure TFile.GetFileAsDataURL;\r\nvar\r\n  ptr: pointer;\r\n  f: TJSHTMLFile;\r\nbegin\r\n  ptr := @HandleFileLoadAsDataURL;\r\n  f := FileObject;\r\n\r\n  asm\r\n    var reader = new FileReader();\r\n    reader.addEventListener('load',ptr);\r\n    reader.readAsDataURL(f);\r\n  end;\r\nend;\r\n\r\nprocedure TFile.GetFileAsText(GetAsString: TGetAsStringProc);\r\nbegin\r\n  FGetAsString := GetAsString;\r\n  GetFileAsText;\r\nend;\r\n\r\nprocedure TFile.Upload(AAction: string);\r\nvar\r\n  f: TJSHTMLFile;\r\n  fd: TJSFormData;\r\n  ptrProgress, ptrComplete, ptrError, ptrAbort: pointer;\r\nbegin\r\n  f := FileObject;\r\n\r\n  fd := TJSFormData.new;\r\n  fd.Append('file1',f);\r\n\r\n  FReq := TJSXMLHttpRequest.new;\r\n\r\n  ptrProgress := @HandleFileUploadProgress;\r\n  ptrComplete := @HandleFileUploadComplete;\r\n  ptrError := @HandleFileUploadError;\r\n  ptrAbort := @HandleFileUploadAbort;\r\n\r\n  FReq.addEventListener('load', ptrComplete);\r\n  FReq.addEventListener('error', ptrError);\r\n  FReq.addEventListener('abort', ptrAbort);\r\n  FReq.upload.addEventListener('progress', ptrProgress);\r\n\r\n  FReq.Open('POST',AAction, true);\r\n  FReq.Send(fd);\r\nend;\r\n\r\nfunction TFile.AbortUpload: boolean;\r\nbegin\r\n  Result := false;\r\n  if Assigned(FReq) then\r\n  begin\r\n    FReq.Abort();\r\n    Result := true;\r\n  end;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nfunction TFile.HandleFileLoadAsArrayBuffer(Event: TJSEvent): boolean;\r\nvar\r\n  ja: TJSArrayBuffer;\r\n  LJARec: TJSArrayBufferRecord;\r\n  ctrl: TComponent;\r\nbegin\r\n\r\n  Result := true;\r\n  asm\r\n    ja = event.target.result;\r\n  end;\r\n\r\n  if Assigned(FGetAsArrayBuffer) then\r\n  begin\r\n    FGetAsArrayBuffer(ja);\r\n  end;\r\n\r\n  FGetAsArrayBuffer := nil;\r\n\r\n  if Assigned(OnGetFileAsArrayBuffer) then\r\n  begin\r\n    LJARec.jsarraybuffer := ja;\r\n    OnGetFileAsArrayBuffer(Self, LJARec);\r\n  end;\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    LJARec.jsarraybuffer := ja;\r\n\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnGetFileAsArrayBuffer) then\r\n      (ctrl as TFilePicker).OnGetFileAsArrayBuffer(ctrl, Index, LJARec);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnGetFileAsArrayBuffer) then\r\n      (ctrl as TFileUpload).OnGetFileAsArrayBuffer(ctrl, Index, LJARec);\r\n\r\n    if (ctrl is TOpenDialog) and Assigned( (ctrl as TOpenDialog).OnGetFileAsArrayBuffer) then\r\n      (ctrl as TOpenDialog).OnGetFileAsArrayBuffer(ctrl, Index, LJARec);\r\n  end;\r\nend;\r\n\r\n\r\nfunction TFile.HandleFileLoadAsBase64(Event: TJSEvent): boolean;\r\nvar\r\n  s: string;\r\n  ctrl: TComponent;\r\nbegin\r\n  Result := true;\r\n\r\n  asm\r\n    function _arrayBufferToBase64( buffer ) {\r\n    var binary = '';\r\n    var bytes = new Uint8Array( buffer );\r\n    var len = bytes.byteLength;\r\n    for (var i = 0; i < len; i++) {\r\n        binary += String.fromCharCode( bytes[ i ] );\r\n    }\r\n    return window.btoa( binary );\r\n    }\r\n    s = _arrayBufferToBase64(event.target.result);\r\n  end;\r\n\r\n  if Assigned(FGetAsString) then\r\n    FGetAsString(s);\r\n\r\n  FGetAsString := nil;\r\n\r\n  if Assigned(OnGetFileAsBase64) then\r\n    OnGetFileAsBase64(Self, s);\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnGetFileAsBase64) then\r\n      (ctrl as TFilePicker).OnGetFileAsBase64(ctrl, Index, s);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnGetFileAsBase64) then\r\n      (ctrl as TFileUpload).OnGetFileAsBase64(ctrl, Index, s);\r\n\r\n    if (ctrl is TWebOpenDialog) and Assigned( (ctrl as TWebOpenDialog).OnGetFileAsBase64) then\r\n      (ctrl as TWebOpenDialog).OnGetFileAsBase64(ctrl, Index, s);\r\n  end;\r\nend;\r\n\r\n\r\nfunction TFile.HandleFileLoadAsDataURL(Event: TJSEvent): boolean;\r\nvar\r\n  s: string;\r\n  ctrl: TComponent;\r\nbegin\r\n  Result := true;\r\n  asm\r\n    s = event.target.result;\r\n  end;\r\n\r\n  if Assigned(FGetAsString) then\r\n    FGetAsString(s);\r\n\r\n  FGetAsString := nil;\r\n\r\n  if Assigned(OnGetFileAsURL) then\r\n    OnGetFileAsURL(Self, s);\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnGetFileAsDataURL) then\r\n      (ctrl as TFilePicker).OnGetFileAsDataURL(ctrl, Index, s);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnGetFileAsDataURL) then\r\n      (ctrl as TFileUpload).OnGetFileAsDataURL(ctrl, Index, s);\r\n\r\n    if (ctrl is TWebOpenDialog) and Assigned( (ctrl as TWebOpenDialog).OnGetFileAsDataURL) then\r\n      (ctrl as TWebOpenDialog).OnGetFileAsDataURL(ctrl, Index, s);\r\n  end;\r\nend;\r\n\r\nfunction TFile.HandleFileLoadAsStream(Event: TJSEvent): boolean;\r\nvar\r\n  ctrl: TComponent;\r\n  b: TBytes;\r\n  l: longint;\r\n  ms: TMemoryStream;\r\n  ja: TJSArrayBuffer;\r\nbegin\r\n\r\n  Result := true;\r\n  asm\r\n    ja = event.target.result;\r\n  end;\r\n\r\n  b := TMemoryStream.MemoryToBytes(ja);\r\n  l := ja.byteLength;\r\n\r\n  ms := TMemoryStream.Create;\r\n  ms.Write(b,0, l);\r\n  ms.Position := 0;\r\n\r\n  if Assigned(FGetAsStream) then\r\n  begin\r\n    FGetAsStream(ms);\r\n  end;\r\n\r\n  FGetAsStream := nil;\r\n\r\n  if Assigned(OnGetFileAsStream) then\r\n  begin\r\n    OnGetFileAsStream(Self, ms);\r\n  end;\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnGetFileAsStream) then\r\n      (ctrl as TFilePicker).OnGetFileAsStream(ctrl, Index, ms);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnGetFileAsStream) then\r\n      (ctrl as TFileUpload).OnGetFileAsStream(ctrl, Index, ms);\r\n\r\n    if (ctrl is TOpenDialog) and Assigned( (ctrl as TOpenDialog).OnGetFileAsStream) then\r\n      (ctrl as TOpenDialog).OnGetFileAsStream(ctrl, Index, ms);\r\n  end;\r\n\r\n  ms.Free;\r\nend;\r\n\r\nfunction TFile.HandleFileLoadAsText(Event: TJSEvent): boolean;\r\nvar\r\n  s: string;\r\n  ctrl: TComponent;\r\n\r\nbegin\r\n  Result := true;\r\n  asm\r\n    s = event.target.result;\r\n  end;\r\n\r\n  if Assigned(FGetAsString) then\r\n    FGetAsString(s);\r\n\r\n  FGetAsString := nil;\r\n\r\n  if Assigned(OnGetFileAsText) then\r\n    OnGetFileAsText(Self, s);\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnGetFileAsText) then\r\n      (ctrl as TFilePicker).OnGetFileAsText(ctrl, Index, s);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnGetFileAsText) then\r\n      (ctrl as TFileUpload).OnGetFileAsText(ctrl, Index, s);\r\n\r\n    if (ctrl is TOpenDialog) and Assigned( (ctrl as TOpenDialog).OnGetFileAsText) then\r\n      (ctrl as TOpenDialog).OnGetFileAsText(ctrl, Index, s);\r\n  end;\r\nend;\r\n\r\nfunction TFile.HandleFileUploadAbort(Event: TJSEvent): boolean;\r\nvar\r\n  ctrl: TComponent;\r\nbegin\r\n  Result := true;\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnUploadFileAbort) then\r\n      (ctrl as TFilePicker).OnUploadFileAbort(ctrl, Index);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnUploadFileAbort) then\r\n      (ctrl as TFileUpload).OnUploadFileAbort(ctrl, Index);\r\n  end;\r\nend;\r\n\r\nfunction TFile.HandleFileUploadComplete(Event: TJSEvent): boolean;\r\nvar\r\n  ctrl: TComponent;\r\n  LRequestRec: TJSXMLHttpRequestRecord;\r\n  AResponse: string;\r\nbegin\r\n  Result := true;\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnUploadFileComplete) then\r\n      (ctrl as TFilePicker).OnUploadFileComplete(ctrl, Index);\r\n\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnUploadFileResponseComplete) then\r\n    begin\r\n      LRequestRec.req := TJSXMLHttpRequest(Event.Target);\r\n      asm\r\n        AResponse = Event.target.responseText;\r\n      end;\r\n\r\n      (ctrl as TFilePicker).OnUploadFileResponseComplete(ctrl, Index, LRequestRec, AResponse);\r\n    end;\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnUploadFileComplete) then\r\n      (ctrl as TFileUpload).OnUploadFileComplete(ctrl, Index);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnUploadFileResponseComplete) then\r\n    begin\r\n      LRequestRec.req := TJSXMLHttpRequest(Event.Target);\r\n      asm\r\n        AResponse = Event.target.responseText;\r\n      end;\r\n\r\n      (ctrl as TFileUpload).OnUploadFileResponseComplete(ctrl, Index, LRequestRec, AResponse);\r\n    end;\r\n  end;\r\n  FReq := nil;\r\nend;\r\n\r\nfunction TFile.HandleFileUploadError(Event: TJSEvent): boolean;\r\nvar\r\n  err: string;\r\n  ctrl: TComponent;\r\nbegin\r\n  asm\r\n    err = Event.target.status;\r\n  end;\r\n  Result := true;\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnUploadFileError) then\r\n      (ctrl as TFilePicker).OnUploadFileError(ctrl, Index, err);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnUploadFileError) then\r\n      (ctrl as TFileUpload).OnUploadFileError(ctrl, Index, err);\r\n  end;\r\nend;\r\n\r\nfunction TFile.HandleFileUploadProgress(Event: TJSEvent): boolean;\r\nvar\r\n  Lloaded, Ltotal: longint;\r\n  ctrl: TComponent;\r\nbegin\r\n  Lloaded := 0;\r\n  LTotal := 0;\r\n\r\n  asm\r\n   if (Event.lengthComputable) {\r\n      Lloaded = Event.loaded;\r\n      Ltotal = Event.total;\r\n      //console.log(Event.loaded + \" bytes of \" + Event.total); } else { console.log('no calc');\r\n   }\r\n  end;\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (GetControl as TFilePicker).OnUploadFileProgress) then\r\n      (ctrl as TFilePicker).OnUploadFileProgress(ctrl, Index, Lloaded, Ltotal);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (GetControl as TFileUpload).OnUploadFileProgress) then\r\n      (ctrl as TFileUpload).OnUploadFileProgress(ctrl, Index, Lloaded, Ltotal);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\n{ THTMLDiv }\r\n\r\nfunction THTMLDiv.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\nprocedure THTMLDiv.CreateInitialize;\r\nbegin\r\n  FHTML := TStringList.Create;\r\n  FHTML.SkipLastLineBreak := true;\r\n  (FHTML as TStringList).OnChange := HTMLChanged;\r\n\r\n  inherited;\r\n\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\n  ClipChildren := false;\r\n  TabStop := false;\r\nend;\r\n\r\ndestructor THTMLDiv.Destroy;\r\nbegin\r\n  FHTML.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure THTMLDiv.HTMLChanged(Sender: TObject);\r\nbegin\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure THTMLDiv.SetHTML(const Value: TStrings);\r\nbegin\r\n  FHTML.Assign(Value);\r\nend;\r\n\r\nprocedure THTMLDiv.UpdateElementData;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if (FOldText <> '') or (FHTML.Text <> '') then\r\n      ElementHandle.innerHTML := FHTML.Text;\r\n    FOldText := FHTML.Text;\r\n  end\r\n  else\r\n  begin\r\n    if not IsLinked and (csDesigning in ComponentState) then\r\n      RenderDesigning(ClassName, Container, Self, True);\r\n  end;\r\nend;\r\n\r\n{ THTMLSpan }\r\n\r\nfunction THTMLSpan.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\nprocedure THTMLSpan.CreateInitialize;\r\nbegin\r\n  FHTML := TStringList.Create;\r\n  (FHTML as TStringList).OnChange := HTMLChanged;\r\n\r\n  inherited;\r\n\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\n  TabStop := false;\r\n  ClipChildren := false;\r\nend;\r\n\r\ndestructor THTMLSpan.Destroy;\r\nbegin\r\n  FHTML.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure THTMLSpan.HTMLChanged(Sender: TObject);\r\nbegin\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure THTMLSpan.SetHTML(const Value: TStrings);\r\nbegin\r\n  FHTML.Assign(Value);\r\nend;\r\n\r\nprocedure THTMLSpan.UpdateElementData;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if (FOldText <> '') or (FHTML.Text <> '') then\r\n      ElementHandle.innerHTML := FHTML.Text;\r\n    FOldText := FHTML.Text;\r\n  end\r\n  else\r\n  begin\r\n    if not IsLinked and (csDesigning in ComponentState) then\r\n      RenderDesigning(ClassName, Container, Self, True);\r\n  end;\r\nend;\r\n\r\n{ THTMLAnchor }\r\n\r\nfunction THTMLAnchor.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('A');\r\nend;\r\n\r\nprocedure THTMLAnchor.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Caption := 'WebHTMLAnchor';\r\nend;\r\n\r\nfunction THTMLAnchor.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if Assigned(OnClick) then\r\n  begin\r\n    Event.preventDefault();\r\n    StopPropagation;\r\n    Result := false;\r\n    OnClick(Self);\r\n  end\r\n  else\r\n    Result := inherited;\r\nend;\r\n\r\nprocedure THTMLAnchor.SetCaption(const Value: string);\r\nbegin\r\n  inherited SetCaption(Value);\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure THTMLAnchor.SetHref(const Value: string);\r\nbegin\r\n  FHref := Value;\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure THTMLAnchor.SetTarget(const Value: string);\r\nbegin\r\n  FTarget := Value;\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure THTMLAnchor.UpdateElementData;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if Caption <> '' then\r\n     ElementHandle.innerHTML := Caption;\r\n    ElementHandle.setAttribute('href', FHref);\r\n    ElementHandle.setAttribute('target', FTarget);\r\n  end;\r\nend;\r\n\r\n{ TURLValidator }\r\n\r\nprocedure TURLValidator.HandleResult(IsValid: boolean);\r\nbegin\r\n  if Assigned(OnValidated) then\r\n    OnValidated(Self, IsValid);\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TURLValidator.Validate;\r\nvar\r\n  s: string;\r\n  ptr: pointer;\r\nbegin\r\n  s := URL;\r\n  ptr := @HandleResult;\r\n  asm\r\n    var request = new XMLHttpRequest();\r\n    request.open('GET', s, true);\r\n    request.onreadystatechange = function(){\r\n       if (request.readyState === 4){\r\n           ptr(request.status === 200);\r\n           }\r\n    };\r\n    request.send();\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n{ TGoogleMapsOptions }\r\n\r\nprocedure TGoogleMapsOptions.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  FCustomStyle := (Source as TGoogleMapsOptions).CustomStyle;\r\n  FMapStyle := (Source as TGoogleMapsOptions).MapStyle;\r\n  FDefaultLatitude := (Source as TGoogleMapsOptions).DefaultLatitude;\r\n  FDefaultLongitude := (Source as TGoogleMapsOptions).DefaultLongitude;\r\n  FDefaultZoomLevel := (Source as TGoogleMapsOptions).DefaultZoomLevel;\r\nend;\r\n\r\nconstructor TGoogleMapsOptions.Create(AGoogleMaps: TGoogleMaps);\r\nbegin\r\n  inherited Create;\r\n  FCustomStyle := TStringList.Create;\r\n  FMapStyle := mstDefault;\r\n  FDefaultLatitude := -34.397;\r\n  FDefaultLongitude := 150.644;\r\n  FDefaultZoomLevel := 8;\r\n  FOwner := AGoogleMaps;\r\nend;\r\n\r\ndestructor TGoogleMapsOptions.Destroy;\r\nbegin\r\n  FCustomStyle.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TGoogleMapsOptions.SetCustomStyle(const Value: TStringList);\r\nbegin\r\n  FCustomStyle.Assign(Value);\r\nend;\r\n\r\nprocedure TGoogleMapsOptions.SetDefaultLatitude(const Value: Double);\r\nbegin\r\n  if FDefaultLatitude <> Value then\r\n  begin\r\n    FDefaultLatitude := Value;\r\n    FOwner.UpdateElement;\r\n    FOwner.PanTo(DefaultLatitude, DefaultLongitude);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMapsOptions.SetDefaultLongitude(const Value: Double);\r\nbegin\r\n  if FDefaultLongitude <> Value then\r\n  begin\r\n    FDefaultLongitude := Value;\r\n    FOwner.UpdateElement;\r\n    FOwner.PanTo(DefaultLatitude, DefaultLongitude);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMapsOptions.SetDefaultZoomLevel(const Value: Integer);\r\nbegin\r\n  if (FDefaultZoomLevel <> Value) and (Value >= 0) and (Value <= 21) then\r\n  begin\r\n    FDefaultZoomLevel := Value;\r\n    FOwner.UpdateElement;\r\n    FOwner.SetZoom(Value);\r\n  end;\r\nend;\r\n\r\n\r\n{$HINTS OFF}\r\nprocedure TGoogleMapsOptions.SetMapStyle(const Value: TGoogleMapStyle);\r\nvar\r\n  map: TJSHTMLElement;\r\n  cstyle: string;\r\n  ostyle: TJSObject;\r\nbegin\r\n  FMapStyle := Value;\r\n  map := FOwner.GetMap;\r\n\r\n  if not Assigned(map) then\r\n    Exit;\r\n\r\n  if FMapStyle = mstNightMode then\r\n  begin\r\n    asm\r\n      var myStyle =\r\n      [\r\n        {\r\n          \"elementType\": \"geometry\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#242f3e\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#746855\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"elementType\": \"labels.text.stroke\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#242f3e\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"administrative.locality\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#d59563\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"poi\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#d59563\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"poi.park\",\r\n          \"elementType\": \"geometry\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#263c3f\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"poi.park\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#6b9a76\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"road\",\r\n          \"elementType\": \"geometry\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#38414e\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"road\",\r\n          \"elementType\": \"geometry.stroke\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#212a37\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"road\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#9ca5b3\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"road.highway\",\r\n          \"elementType\": \"geometry\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#746855\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"road.highway\",\r\n          \"elementType\": \"geometry.stroke\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#1f2835\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"road.highway\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#f3d19c\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"transit\",\r\n          \"elementType\": \"geometry\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#2f3948\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"transit.station\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#d59563\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"water\",\r\n          \"elementType\": \"geometry\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#17263c\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"water\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#515c6d\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"water\",\r\n          \"elementType\": \"labels.text.stroke\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#17263c\"\r\n            }\r\n          ]\r\n        }\r\n      ];\r\n\r\n      map.setOptions({styles: myStyle});\r\n    end;\r\n  end\r\n  else if (FMapStyle = mstCustom) and (CustomStyle.Text <> '') then\r\n  begin\r\n    cstyle := CustomStyle.Text;\r\n    try\r\n      ostyle := TJSObject(TJSJSON.Parse(cstyle));\r\n      asm\r\n        map.setOptions({styles: ostyle});\r\n      end;\r\n    except\r\n\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    asm\r\n      map.setOptions({styles: []});\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\n\r\n{ TShare }\r\n\r\nfunction TShare.CanShareFiles: boolean;\r\nvar\r\n  res: boolean;\r\nbegin\r\n  res := false;\r\n  asm\r\n    if (navigator.share) {\r\n    try\r\n    {\r\n      res = navigator.canShare;\r\n    }\r\n    catch(err)\r\n    {\r\n    }\r\n    }\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction TShare.Share(ATitle, AText, AURL: string): boolean;\r\nvar\r\n  res: boolean;\r\nbegin\r\n  res := false;\r\n  asm\r\n    if (navigator.share) {\r\n      res = true;\r\n      navigator.share({\r\n        title: ATitle,\r\n        text: AText,\r\n        url: AURL });\r\n    }\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction TShare.Execute: boolean;\r\nbegin\r\n  Result := Share(FTitle, FText, FURL);\r\nend;\r\n\r\nfunction TShare.Share(ATitle, AText, AURL: string; AFiles: TJSHTMLFileArray): boolean;\r\nvar\r\n  res: boolean;\r\nbegin\r\n  res := false;\r\n\r\n  asm\r\n  if (navigator.canShare && navigator.canShare({ files: AFiles })) {\r\n    res = true;\r\n    navigator.share({\r\n    files: AFiles,\r\n    title: ATitle,\r\n    text: AText });\r\n   }\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\n{ TDeviceOrientation }\r\n\r\n{$HINTS OFF}\r\nfunction TDeviceOrientation.DoHandleOrientationEvent(e: TJSEvent): boolean;\r\nvar\r\n  s: double;\r\n  compass: JSValue;\r\nbegin\r\n  s := 0.0;\r\n  asm\r\n    compass = e.webkitCompassHeading || Math.abs(e.alpha - 360);\r\n    var d = 0.0;\r\n    s = d + compass;\r\n  end;\r\n\r\n  if Assigned(OnHeadingChange) then\r\n    OnHeadingChange(Self, s);\r\nend;\r\n\r\nfunction TDeviceOrientation.Enabled: boolean;\r\nbegin\r\n  asm\r\n    Result = window.DeviceOrientationEvent != null;\r\n  end;\r\nend;\r\n\r\nprocedure TDeviceOrientation.Start;\r\nvar\r\n  os: TOperatingSystem;\r\n  ptr: pointer;\r\n\r\n  procedure HandleDeny;\r\n  begin\r\n    if Assigned(OnError) then\r\n      OnError(Self, oeDenied);\r\n  end;\r\n\r\n  procedure HandleError;\r\n  begin\r\n    if Assigned(OnError) then\r\n      OnError(Self, oeNotSupported);\r\n  end;\r\n\r\n  procedure HandleSuccess;\r\n  begin\r\n    FStarted := true;\r\n    if Assigned(OnInitialized) then\r\n      OnInitialized(Self);\r\n  end;\r\n\r\nbegin\r\n  os := GetOperatingSystem;\r\n\r\n  FOrientationPtr := @DoHandleOrientationEvent;\r\n\r\n  ptr := FOrientationPtr;\r\n\r\n  if (os in [osiOS,osmacOS]) then\r\n  begin\r\n    asm\r\n      if (DeviceOrientationEvent==null) return;\r\n      if (DeviceOrientationEvent.requestPermission==null) return;\r\n\r\n      DeviceOrientationEvent.requestPermission().then((response) => {\r\n        if (response === \"granted\") {\r\n          window.addEventListener(\"deviceorientation\", ptr, true);\r\n          HandleSuccess();\r\n        } else {\r\n          HandleDeny();\r\n        }\r\n      })\r\n      .catch(() => HandleError());\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    asm\r\n      window.addEventListener(\"deviceorientationabsolute\", ptr, true);\r\n      HandleSuccess();\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\n{ TWebSpeechSynthesis }\r\n\r\nprocedure TSpeechSynthesis.Cancel;\r\nbegin\r\n  asm\r\n    window.speechSynthesis.cancel();\r\n  end;\r\nend;\r\n\r\nconstructor TSpeechSynthesis.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FVolume := 1;\r\n  FRate := 1;\r\n  FPitch := 1;\r\n  FVoices := TStringList.Create;\r\n\r\n  if Supported then\r\n    GetVoices;\r\nend;\r\n\r\ndestructor TSpeechSynthesis.Destroy;\r\nbegin\r\n  FVoices.Free;\r\n  inherited;\r\nend;\r\n\r\n{$HINTS OFF}\r\n\r\nfunction TSpeechSynthesis.GetVoices: TStrings;\r\nvar\r\n  sl: TStrings;\r\n\r\n  procedure VoicesReady;\r\n  begin\r\n    if Assigned(OnVoicesReady) then\r\n      OnVoicesReady(Self);\r\n  end;\r\n\r\nbegin\r\n  sl := FVoices;\r\n\r\n  if (1<0) then\r\n    VoicesReady;\r\n\r\n  asm\r\n    function populateVoiceList()\r\n    {\r\n    \tvar voices = speechSynthesis.getVoices();\r\n      // console.log(voices);\r\n      // Loop through each of the voices.\r\n     \tvoices.forEach(function(voice, i) {\r\n        sl.Add(voice.name);\r\n        //console.log(voice.name);\r\n    \t});\r\n      if (voices.length > 0) { VoicesReady(); }\r\n\r\n   }\r\n   populateVoiceList();\r\n   if (window.speechSynthesis.onvoiceschanged !== undefined) {\r\n     speechSynthesis.onvoiceschanged = populateVoiceList;\r\n   }\r\n  end;\r\nend;\r\n\r\nfunction TSpeechSynthesis.IsSpeaking: boolean;\r\nvar\r\n  res: boolean;\r\nbegin\r\n  asm\r\n    res = window.speechSynthesis.speaking;\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nprocedure TSpeechSynthesis.SetPitch(const Value: single);\r\nbegin\r\n  if (Value >=0) and (Value <= 10) then\r\n    FPitch := Value;\r\nend;\r\n\r\nprocedure TSpeechSynthesis.SetRate(const Value: single);\r\nbegin\r\n  if (Value >= 0) and (Value <= 2) then\r\n   FRate := Value;\r\nend;\r\n\r\nprocedure TSpeechSynthesis.SetVoice(const Value: string);\r\nbegin\r\n  FVoice := Value;\r\nend;\r\n\r\nprocedure TSpeechSynthesis.SetVolume(const Value: single);\r\nbegin\r\n  if (Value >= 0) and (Value <= 1) then\r\n    FVolume := Value;\r\nend;\r\n\r\nprocedure TSpeechSynthesis.Speak(AText: string);\r\nvar\r\n  v,r,p: single;\r\n  avoice: string;\r\nbegin\r\n  v := FVolume;\r\n  r := FRate;\r\n  p := FPitch;\r\n  avoice := FVoice;\r\n  asm\r\n    // Create a new instance of SpeechSynthesisUtterance.\r\n  \tvar msg = new SpeechSynthesisUtterance();\r\n\r\n    // Set the text.\r\n  \tmsg.text = AText;\r\n\r\n    // Set the attributes.\r\n\t  msg.volume = v;\r\n  \tmsg.rate = r;\r\n  \tmsg.pitch = p;\r\n\r\n    // If a voice has been selected, find the voice and set the\r\n    // utterance instance's voice attribute.\r\n  \tif (avoice != \"\") {\r\n  \t\tmsg.voice = speechSynthesis.getVoices().filter(function(voice) { return voice.name == avoice; })[0];\r\n  \t}\r\n\r\n    // Queue this utterance.\r\n\t  window.speechSynthesis.speak(msg);\r\n  end;\r\nend;\r\n\r\nfunction TSpeechSynthesis.Supported: boolean;\r\nvar\r\n  res: boolean;\r\nbegin\r\n  res := false;\r\n  asm\r\n    if ('speechSynthesis' in window) { res = true; }\r\n  end;\r\n  Result := res;\r\nend;\r\n{$HINTS ON}\r\n\r\n{ TConsoleLog }\r\n\r\nprocedure TConsoleLog.Clear;\r\nbegin\r\n  FLog.innerHTML := '';\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TConsoleLog.CreateElement: TJSElement;\r\nvar\r\n  el,ellog: TJSHTMLElement;\r\n  LAutoScroll: boolean;\r\nbegin\r\n  LAutoScroll := FAutoScroll;\r\n  el := TJSHTMLElement(document.createElement('DIV'));\r\n  ellog := TJSHTMLElement(document.createElement('PRE'));\r\n  el.appendChild(ellog);\r\n\r\n  Result := el;\r\n  FLog := ellog;\r\n\r\n  if (csDesigning in ComponentState) then\r\n    Exit;\r\n\r\n  AddControlStyle(\r\n    '.log-warn { color: orange }'+CRLF+\r\n    '.log-error { color: red }'+CRLF+\r\n    '.log-info { color: skyblue }'+CRLF+\r\n    '.log-log { color: silver }'+CRLF+\r\n    '.log-warn, .log-error { font-weight: bold; }'\r\n  );\r\n\r\n  AddControlScriptSource(\r\n  '    function unfixLoggingFunc(name) {' + CRLF +\r\n  '        console[name] = console[\"old\" + name];' + CRLF +\r\n  ' }'+CRLF+\r\n  'function unwireLogging() {' + CRLF +\r\n  '    unfixLoggingFunc(\"log\");' + CRLF +\r\n  '    unfixLoggingFunc(\"debug\");' + CRLF +\r\n  '    unfixLoggingFunc(\"warn\");' + CRLF +\r\n  '    unfixLoggingFunc(\"error\");' + CRLF +\r\n  '    unfixLoggingFunc(\"info\");' + CRLF +\r\n  '}' + CRLF +\r\n  'function rewireLoggingToElement(eleLocator, eleOverflowLocator, autoScroll) {' + CRLF +\r\n  '    fixLoggingFunc(\"log\");' + CRLF +\r\n  '    fixLoggingFunc(\"debug\");' + CRLF +\r\n  '    fixLoggingFunc(\"warn\");' + CRLF +\r\n  '    fixLoggingFunc(\"error\");' + CRLF +\r\n  '    fixLoggingFunc(\"info\");' + CRLF +\r\n  '' + CRLF +\r\n  '    function fixLoggingFunc(name) {' + CRLF +\r\n  '        console[\"old\" + name] = console[name];' + CRLF +\r\n  '        console[name] = function(...arguments) {' + CRLF +\r\n  '            const output = produceOutput(name, arguments);' + CRLF +\r\n  '            const eleLog = eleLocator;' + CRLF +\r\n  '' + CRLF +\r\n  '            if (autoScroll) {' + CRLF +\r\n  '                const eleContainerLog = eleOverflowLocator;' + CRLF +\r\n  '                const isScrolledToBottom = eleContainerLog.scrollHeight - eleContainerLog.clientHeight <= eleContainerLog.scrollTop + 1;' + CRLF +\r\n  '                eleLog.innerHTML += output + \"<br>\";' + CRLF +\r\n  '                if (isScrolledToBottom) {' + CRLF +\r\n  '                    eleContainerLog.scrollTop = eleContainerLog.scrollHeight - eleContainerLog.clientHeight;' + CRLF +\r\n  '                }' + CRLF +\r\n  '            } else {' + CRLF +\r\n  '                eleLog.innerHTML += output + \"<br>\";' + CRLF +\r\n  '            }' + CRLF +\r\n  '' + CRLF +\r\n  '            console[\"old\" + name].apply(undefined, arguments);' + CRLF +\r\n  '        };' + CRLF +\r\n  '    }' + CRLF +\r\n  '' + CRLF +\r\n  '   function produceOutput(name, args) {' + CRLF +\r\n  '       return args.reduce((output, arg) => {' + CRLF +\r\n  '            return output +' + CRLF +\r\n  '                \"<span class=\\\"log-\" + (typeof arg) + \" log-\" + name + \"\\\">\" +' + CRLF +\r\n  '                    (typeof arg === \"object\" && (JSON || {}).stringify ? JSON.stringify(arg) : arg) +' + CRLF +\r\n  '                \"</span>&nbsp;\";' + CRLF +\r\n  '        }, \"\");' + CRLF +\r\n  '    }' + CRLF +\r\n  '}'\r\n  );\r\n\r\n  asm\r\n    rewireLoggingToElement(ellog, el, LAutoScroll);\r\n  end;\r\n\r\n  FInit := true;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TConsoleLog.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FAutoScroll := true;\r\nend;\r\n\r\ndestructor TConsoleLog.Destroy;\r\nbegin\r\n  if FInit then\r\n  begin\r\n    asm\r\n      unwireLogging();\r\n    end;\r\n  end;\r\n\r\n  inherited;\r\nend;\r\n\r\nprocedure TConsoleLog.UpdateElement;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n    ElementHandle.style.setProperty('overflow','auto');\r\nend;\r\n\r\nend.\r\n","unit WEBLib.Consts;\r\n\r\ninterface\r\n\r\nresourcestring\r\n  SWarning = 'Warning';\r\n  SError = 'Error';\r\n  SInformation = 'Information';\r\n  SConfirm = 'Confirm';\r\n  SOK = 'OK';\r\n  SCancel = 'Cancel';\r\n  SYes = 'Yes';\r\n  SNo = 'No';\r\n  SAbort = 'Abort';\r\n  SRetry = 'Retry';\r\n  SIgnore = 'Ignore';\r\n  SHelp = 'Help';\r\n  SClose = 'Close';\r\n  SAll = 'All';\r\n  SYesToAll = 'Yes to all';\r\n  SNoToAll = 'No to all';\r\n\r\n  SReadError = 'Stream read error';\r\n  SWriteError = 'Stream write error';\r\n  SCannotGetFile = 'Cannot get the file from the URL %s because of the error %d!';\r\n\r\n  SErrorLoadFromFile = 'There was an error during the download of the file %s!';\r\n  SLoadFromFileAborted = 'The download of the file %s was aborted!';\r\n\r\n\r\nresourcestring\r\n  SWarningFR = 'Avertissement';\r\n  SErrorFR = 'Erreur';\r\n  SInformationFR = 'Information';\r\n  SConfirmFR = 'Confirmer';\r\n  SOKFR = 'OK';\r\n  SCancelFR = 'Annuler';\r\n  SYesFR = 'Oui';\r\n  SNoFR = 'Non';\r\n  SAbortFR = 'Interrompre';\r\n  SRetryFR = 'Ressayer';\r\n  SIgnoreFR = 'Ignorer';\r\n  SHelpFR = 'Aide';\r\n  SCloseFR = 'Fermer';\r\n  SAllFR = 'Tout';\r\n  SYesToAllFR = 'Oui  tout';\r\n  SNoToAllFR = 'Non  tout';\r\n\r\nresourcestring\r\n  SWarningDE = 'Warnung';\r\n  SErrorDE = 'Fehler';\r\n  SInformationDE = 'Information';\r\n  SConfirmDE = 'Besttigen';\r\n  SOKDE = 'OK';\r\n  SCancelDE = 'Verzgern';\r\n  SYesDE = 'Ja';\r\n  SNoDE = 'Nein';\r\n  SAbortDE = 'Abbrechen';\r\n  SRetryDE = 'Wiederholen';\r\n  SIgnoreDE = 'Ignorieren';\r\n  SHelpDE = 'Hilfe';\r\n  SCloseDE = 'Schlieen';\r\n  SAllDE = 'Alles';\r\n  SYesToAllDE = 'Ja auf Alles';\r\n  SNoToAllDE = 'Nein auf Alles';\r\n\r\nresourcestring\r\n  SWarningES = 'Advertencia';\r\n  SErrorES = 'Error';\r\n  SInformationES = 'Informacin';\r\n  SConfirmES = 'Confirmado';\r\n  SOKES = 'OK';\r\n  SCancelES = 'Cancelar';\r\n  SYesES = 'S';\r\n  SNoES = 'No';\r\n  SAbortES = 'Abortar';\r\n  SRetryES = 'Rever';\r\n  SIgnoreES = 'Ignorar';\r\n  SHelpES = 'Ayudar';\r\n  SCloseES = 'Cerrar';\r\n  SAllES = 'Todos';\r\n  SYesToAllES = 'S a todo';\r\n  SNoToAllES = 'No a todo';\r\n\r\nresourcestring\r\n  SWarningNL = 'Waarschuwing';\r\n  SErrorNL = 'Fout';\r\n  SInformationNL = 'Informatie';\r\n  SConfirmNL = 'Bevestiging';\r\n  SOKNL = 'OK';\r\n  SCancelNL = 'Afbreken';\r\n  SYesNL = 'Ja';\r\n  SNoNL = 'Nee';\r\n  SAbortNL = 'Afbreken';\r\n  SRetryNL = 'Opnieuw';\r\n  SIgnoreNL = 'Negeren';\r\n  SHelpNL = 'Hulp';\r\n  SCloseNL = 'Sluiten';\r\n  SAllNL = 'Alles';\r\n  SYesToAllNL = 'Ja op alles';\r\n  SNoToAllNL = 'Nee op alles';\r\n\r\nimplementation\r\n\r\nend.","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2022                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Dialogs;\r\n\r\n{$DEFINE NOPP}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Controls, Web, JS, SysUtils, WebLib.WebTools,\r\n  WEBLib.WebCtrls, WEBLib.Graphics;\r\n\r\ntype\r\n  TMsgDlgType = (mtWarning, mtError, mtInformation, mtConfirmation, mtCustom);\r\n  TMsgDlgBtn = (mbYes, mbNo, mbOK, mbCancel, mbAbort, mbRetry, mbIgnore,\r\n    mbAll, mbNoToAll, mbYesToAll, mbHelp, mbClose);\r\n  TMsgDlgButtons = set of TMsgDlgBtn;\r\n\r\n  TDialogResult = Integer;\r\n  TDialogResultProc = reference to procedure(AValue: TDialogResult);\r\n\r\n  TCustomDialogButton = class(TCollectionItem)\r\n  private\r\n    FCaption: string;\r\n    FTag: integer;\r\n    FElementClassName: TElementClassName;\r\n  published\r\n    property Caption: string read FCaption write FCaption;\r\n    property ElementClassName: TElementClassName read FElementClassName write FElementClassName;\r\n    property Tag: integer read FTag write FTag default 0;\r\n  end;\r\n\r\n  TCustomDialogButtons = class(TOwnedCollection)\r\n  private\r\n    function GetItem(AIndex: integer): TCustomDialogButton; reintroduce;\r\n    procedure SetItem(AIndex: integer; const Value: TCustomDialogButton); reintroduce;\r\n  public\r\n    function Add: TCustomDialogButton; reintroduce;\r\n    function Insert(AIndex: integer): TCustomDialogButton; reintroduce;\r\n    property Items[AIndex: integer]: TCustomDialogButton read GetItem write SetItem; default;\r\n  end;\r\n\r\n  TMessageDlg = class(TCustomControl)\r\n  private\r\n    FOpacity: double;\r\n    FLayer: TJSElement;\r\n    FDlg: TJSElement;\r\n    FCancel: TJSElement;\r\n    FMessage: string;\r\n    FTitle: string;\r\n    FMsgDlgType: TMSgDlgType;\r\n    FOnButtonClick: TNotifyEvent;\r\n    FOnClose: TNotifyEvent;\r\n    FButtons: TMsgDlgButtons;\r\n    FDialogProc: TDialogResultProc;\r\n    FDialogResult: TDialogResult;\r\n    FMdx, FMdy: integer;\r\n    FDlgX, FDlgY: integer;\r\n    FCaptured: boolean;\r\n    FDown: boolean;\r\n    FElementTitleClassName: TElementClassName;\r\n    FElementButtonClassName: TElementClassName;\r\n    FElementContentClassName: TElementClassName;\r\n    FDialogText: TStringList;\r\n    FCustomButtons: TCustomDialogButtons;\r\n    FElementDialogClassName: TElementClassName;\r\n    FAutoLanguage: boolean;\r\n    procedure SetDialogText(const Value: TStringList);\r\n    procedure SetCustomButtons(const Value: TCustomDialogButtons);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    function GetDialogText(Index: integer): string; virtual;\r\n    procedure BindEvents; override;\r\n    procedure SetDialogResult(const Value: TDialogResult);\r\n    function CreateButton(Caption: string; var DoFocus: boolean; AClass: string = ''): TJSHTMLElement;\r\n    function HandleDocMouseMove(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDocMouseUp(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleMouseDown(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleButtonClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleKeyDown(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    procedure InitBootstrapStyle;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Close;\r\n    property DialogResult: TDialogResult read FDialogResult write SetDialogResult;\r\n    procedure Show; reintroduce;\r\n    function ShowDialog: Integer; overload; virtual;\r\n    function ShowDialog(Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons; AProc: TDialogResultProc): TDialogResult; overload; virtual;\r\n    [async]\r\n    function ShowDialog(Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons): TJSPromise; overload;\r\n  published\r\n    property AutoLanguage: boolean read FAutoLanguage write FAutoLanguage default true;\r\n    property Buttons: TMsgDlgButtons read FButtons write FButtons default [];\r\n    property CustomButtons: TCustomDialogButtons read FCustomButtons write SetCustomButtons;\r\n    property DialogText: TStringList read FDialogText write SetDialogText;\r\n    property DialogType: TMSgDlgType read FMsgDlgType write FMsgDlgType default mtCustom;\r\n    property &Message: string read FMessage write FMessage;\r\n    property Opacity: double read FOpacity write FOpacity;\r\n    property ElementButtonClassName: TElementClassName read FElementButtonClassName write FElementButtonClassName;\r\n    property ElementDialogClassName: TElementClassName read FElementDialogClassName write FElementDialogClassName;\r\n    property ElementTitleClassName: TElementClassName read FElementTitleClassName write FElementTitleClassName;\r\n    property ElementContentClassName: TElementClassName read FElementContentClassName write FElementContentClassName;\r\n    property Title: string read FTitle write FTitle;\r\n    property OnButtonClick: TNotifyEvent read FOnButtonClick write FOnButtonClick;\r\n    property OnClose: TNotifyEvent read FOnClose write FOnClose;\r\n  end;\r\n\r\n  TWebMessageDlg = class(TMessageDlg);\r\n\r\n  TWaitMessage = class(TCustomControl)\r\n  private\r\n    FLayer: TJSElement;\r\n    FPicture: TURLPicture;\r\n    FOpacity: double;\r\n    FOnShow: TNotifyEvent;\r\n    FIsWaiting: boolean;\r\n    FPictureURL: string;\r\n    procedure SetPicture(const Value: TURLPicture);\r\n    procedure SetPictureURL(const Value: string);\r\n  protected\r\n    procedure WaitDisplayed;\r\n    function CreateElement: TJSElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Show; reintroduce;\r\n    procedure Hide; reintroduce;\r\n    property IsWaiting: boolean read FIsWaiting write FIsWaiting;\r\n    property Showing: boolean read FIsWaiting;\r\n  published\r\n    property Opacity: double read FOpacity write FOpacity;\r\n    property Picture: TURLPicture read FPicture write SetPicture;\r\n    property PictureURL: string read FPictureURL write SetPictureURL;\r\n    property OnShow: TNotifyEvent read FOnShow write FOnShow;\r\n  end;\r\n\r\n  TWebWaitMessage = class(TWaitMessage);\r\n\r\n  TOpenDialogProc = reference to procedure(AFileName: string);\r\n\r\n  TOpenOption = (ofReadOnly, ofOverwritePrompt, ofHideReadOnly,\r\n    ofNoChangeDir, ofShowHelp, ofNoValidate, ofAllowMultiSelect,\r\n    ofExtensionDifferent, ofPathMustExist, ofFileMustExist, ofCreatePrompt,\r\n    ofShareAware, ofNoReadOnlyReturn, ofNoTestFileCreate, ofNoNetworkButton,\r\n    ofNoLongNames, ofOldStyleDialog, ofNoDereferenceLinks, ofEnableIncludeNotify,\r\n    ofEnableSizing, ofDontAddToRecent, ofForceShowHidden);\r\n  TOpenOptions = set of TOpenOption;\r\n\r\n  TOpenDialog = class(TComponent)\r\n  private\r\n    FFiles: TFiles;\r\n    FOnChange: TNotifyEvent;\r\n    FFileName: string;\r\n    FMultiFile: boolean;\r\n    FFilter: string;\r\n    FAccept: string;\r\n    FOpenDialogProc: TOpenDialogProc;\r\n    FOptions: TOpenOptions;\r\n    FFilterIndex: Integer;\r\n    FOnFileAsBase64: TFileAsBase64Event;\r\n    FOnGetFileAsArrayBuffer: TFileAsArrayBufferEvent;\r\n    FOnFileAsDataURL: TFileAsDataURLEvent;\r\n    FOnFileAsText: TFileAsTextEvent;\r\n    FOnGetFileAsStream: TFileAsStreamEvent;\r\n  protected\r\n    procedure HandleInputChange(Event: TJSEvent); virtual;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Execute; overload;\r\n    procedure Execute(AProc: TOpenDialogProc); overload;\r\n    [async]\r\n    function Perform: TJSPromise;\r\n    property FileName: string read FFileName;\r\n    property Files: TFiles read FFiles;\r\n    property Filter: string read FFilter write FFilter;\r\n    property Options: TOpenOptions read FOptions write FOptions;\r\n    property FilterIndex: Integer read FFilterIndex write FFilterIndex;\r\n  published\r\n    property Accept: string read FAccept write FAccept;\r\n    property MultiFile: boolean read FMultiFile write FMultiFile default false;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnGetFileAsText: TFileAsTextEvent read FOnFileAsText write FOnFileAsText;\r\n    property OnGetFileAsArrayBuffer: TFileAsArrayBufferEvent read FOnGetFileAsArrayBuffer write FOnGetFileAsArrayBuffer;\r\n    property OnGetFileAsStream: TFileAsStreamEvent read FOnGetFileAsStream write FOnGetFileAsStream;\r\n    property OnGetFileAsBase64: TFileAsBase64Event read FOnFileAsBase64 write FOnFileAsBase64;\r\n    property OnGetFileAsDataURL: TFileAsDataURLEvent read FOnFileAsDataURL write FOnFileAsDataURL;\r\n  end;\r\n\r\n  TWebOpenDialog = class(TOpenDialog);\r\n\r\n\r\nprocedure MessageDlg(const Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons;  AResultProc: TDialogResultProc = nil);\r\nprocedure ShowMessage(AMsg: string);\r\nfunction InputBox(const ACaption, APrompt, ADefault: string): string;\r\nfunction InputQuery(const ACaption, APrompt: string; var Value: string): Boolean; overload;\r\nfunction Confirm(const Value: string): boolean;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Forms, WebLib.Consts;\r\n\r\nconst\r\n  lMaterial = 'https://fonts.googleapis.com/icon?family=Material+Icons';\r\n\r\n  lWaitCursor =\r\n    '0954474946496D61676547494638396190012C01A20000FFFFFFDDDDDDBBBBBB999999FFFFFFFFFFFFFFFFFFFFFFFF21FF0B4E45545343415045322E30030100000021F90405050004002C0000000090012C0182FFFFFFDDDDD'+\r\n    'DBBBBBB999999FFFFFFFFFFFFFFFFFFFFFFFF03FF48BADCFE30CA49ABBD38EBCDBBFF60288E64699E68AAAE6CEBBE702CCF746DDF78AEEF7CEFFFC0A070482C1A8FC8A472C96C3A9FD0A8744AAD5AAFD8AC76CBED7ABFE0B078'+\r\n    '4C2E9BCFE8B47ACD6EBBDFF0B87C4EAFDBEFF8BC7ECFEFFBFF808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBFC'+\r\n    '0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDFE0E1E2E3E4E5E6E7E8E9EAEBECEDEEEFF0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF00030A1C48B0A0C18308132A5CC8B0A1C3871023861A407180C4'+\r\n    '44152B5E349431FFE346421D357E141492E24892254F062A6951E51F962EC978F400D383809B02621E09493365079C387512A9B981A806A040850A319A812906A441950261D95283530B50A34AF541B52A86AB14B26ADDDA836'+\r\n    'A519F19C4E6243B15AC04B711D4B20D62B629DA0B72E7B6BD5B01EE83BC7A7F74FDCA7782DAB58105FB6DB09801E0C45CEBF62D1CF731E4B28D15642660F93266CA0F3277F6CC43F204D162492F6DDC78B4EA1D834F8376ECFA'+\r\n    'B50ED31016D7B69D237604BF8779AF9EBD80A7E1D4C24BCCFC803BB44809BB2F04981E20B9F19EC48F22F7409D3AEFE676AF87D8CEA1BB79DB5DBD86EF48827C06F3F0D1A7577F41BC08A8E5E1C77F3DDFE459FFFF2624B5817'+\r\n    'EFA7DD71F7D4E1058A0700702D884820B26474083081601E17E1216D7A012179E97A103141AD161771FBEB56110237A57A26C070291E2742B5A70220F2FC6B81E78378C682307E9F970E18ED865370384408220240D111669E4'+\r\n    '733F90A8E493504629E594545669E5955866A9A54014FA960400608629E698648EB955973D7E59E69A6C86A9149AF321D1E69C6C0A05679A46D0A9A7993ADDE925117B060A809D7E6E9683A07BBE59287B6A225AA7548B3229A'+\r\n    '7A3656E69E9A59866AAE9A69C76EAE9A7A086AAC5728A39E8E99133A06AE59FBDE198259EB0B18A657F91C1BA6A8B9FC5596588A5D22A25AF7BF9AA24B04310BBA2B145206BDD8CFF4928CB1FB34C387B19B44F503BADB0EBA1'+\r\n    '402A61BAAA862DB79286605F7DDD92662BB8DB32A72A88B226E6AA8CEB5260A873F1129AAE55F3B2382EBEF77AD6EF8DFF6A682ABDFBF25BE1AC8B15CCC0BBA2FEC6B05FED36ECB09009E71B6AC402336AA2C59F32ACD9911E4'+\r\n    'B3C61662473CC69C8232BCC98C99AA29CB2C6F2B27C29C62BAB5C73BD2D1BAAB3CC5AD27C73C0ECF28C70BCF3BA9C73BDF91A8DA9D22F034D30CC0D33DD74B893E13C34CE16FBBC34C75C0B1DA5C9605B7DABCD1B438D2ED5A7'+\r\n    '9A7DF6C0678BFC31DB6B1F0C2FDC6E77E075DDCA898D770A77EF2D42DF7E2F4976E02F004E7890741F9E2ADA8A37EEF8E390472EF9E494576EF9E5649867AEF9E69C77EEF9E7A0872EFAE8A4976EFAE9A8A7AEFAEAACB7EEFAE'+\r\n    'BB0C72EFBECB4D76EFBEDB8E7AEFBEEBCF7EEFBEFC0072FFCF0C4176FFCF1C827AFFCF2CC37EFFCF3D0472FFDF4D4576FFDF5D867AFFDF6DC77EFFDF7E0872FFEF8E497DF7D020021F90405050007002CD60060003000570082'+\r\n    'FFFFFFDDDDDDBBBBBB999999FFFFFFFFFFFFFFFFFFFFFFFF03EC78BABCF3A3C9492B85D0EA7D71E6E0E67D61298DA4A9A2A95AB291BBB2B20BD7E68D8770BC73BA9F2828B4108B1D1472A85C568E4E462F9A1C5127D36B037AE'+\r\n    '5AA04608191B60B879FCD9A795DC5A8D7ECB6CF04AF8F1FB2BA9DAADF3BFB7E4880707C83665186877F8960858C8E865A895A0A83940B80970C819A95679DA0A1A2A3A4A5A6A7A8A9AA2A01ADAEAFB0B1B035B2B5B6AF2EB7BA'+\r\n    'B6ACBBBEB826BFC201BDC3BBB9C6B7B4C9B2ABCECFD0D1D2D3D4D53200D800A5D9DCA2DCDFDA9DE0DFE2E3E494E6E3E8E9E05AECEDEEEFDDF1F2D8F4F5EBF5E157FAFBFCF8F9D8954B178AA0B773A3E65148000021F90405050'+\r\n    '007002CD60075003000570082FFFFFFDDDDDDBBBBBB999999FFFFFFFFFFFFFFFFFFFFFFFF03E978BADCFE6EC801ABBD6D4ECCFBD1A0274660388E657A8AA9BA62ADFB56B13C93B576D3B9BEE33DCA2F13940C81BD2331A844B6'+\r\n    '9A8F1C14529BF24CD6AB30CBED7ABFE0B0784C2E9BCF5C817ACD6EBBDBB3B77CCE5ED1EFF3137E0F1FF1FF027A807B76837471866F688B8C8D8E8F909192930A01960166979A639A9D98609E9DA0A1A25DA4A1A6A79E5CAAABA'+\r\n    'CAD9BAFB096B2B3A9B39F59B8B91000BE002FB815BFBFC1B0BDC4C5C6A7C8C9C037CC0FCECAD0A5D2D3CF3BB1C3D862D8BEDEDD61DFD95FDF63E7E3E2EAD3E1EBE6EF5EE4EECEE8F15DE9ECF5FAFB60F9FEEDE81123D3CF1EB8'+\r\n    '2909000021F90405050007002CC40092004200420082FFFFFFDDDDDDBBBBBB999999FFFFFFFFFFFFFFFFFFFFFFFF03F978BADCFE508D49ABBD36EA1DB1FF15277260F98DE863AE59EA4A6CFCBEB13CBBB579CFF9B9FFC0A0704'+\r\n    '82C1A8FC8A472C96C3A9FD0A8747A105805D4D7759B1D6DBFD8AE06FC1547C860B3034D5633D86D77155E96CFE957FB1D1F76F3F3767F567A8246018701377F4488888A78438D8D3B74919287406C96978999751100A1001C9C'+\r\n    '98415C1AA2A2A4A54FAAAA1BA5A64CAFABB1AD4DB5A1ACB84BBAA3BC97B9BA23B2B4C422C6BEC8C9BD48BF28B29DCFCCCD9C4AD0D1CA47D9DAD7D4B52FDB45DDDEC2DCD5E692E8E1E2E342E529EF41F1F2DF44F5EA8EE4E92EE'+\r\n    '7FCED764C62F74A8F837C7610CA51E886A11A870F0B1A7C006B6283040021F90405050007002CA700A4005700300082FFFFFFDDDDDDBBBBBB999999FFFFFFFFFFFFFFFFFFFFFFFF03FF78BADCFE30CA37EA9838EBCD8FFD5D28'+\r\n    '8ECD675E64AA4AA7B9BEB0D7BA711DCEADAD6B78BEFF90DE0948740869C5E411942C2E2D4DE51315054E35802CE027E80A464F8C56ABF37AC1C7C9785C339B4942F53ADB76775538C99C1CB39FF148107B7413018601187E772'+\r\n    'B4C11835B858786898A518F90119292138A8B458F189A87947E4997A1A2889C9D9F8319A9AAABA540A0AFA91AAC3FB5A8A2B8953BBBBC9A1BB935A71AB0C4C530C1C29BCAB3CCCD91BDD0D12BD3D4C31CCB29D9DACFDCBF2ADF'+\r\n    '12C91DDD22E5E6B721E91CC71DE7E8EF58AE22F3F4D71DF7F8ED22E342F40B914F9F1B6F6B521434E889041B85FF46BCA9E26C14C5280B2FFEC8A8511307C78E353E82842172E48B6A2689844BA920010021F90405050007002'+\r\n    'C9200A4005700300082FFFFFFDDDDDDBBBBBB999999FFFFFFFFFFFFFFFFFFFFFFFF03FF78BADC0E10B849ABBD38B7C8B5FFE0C78D52689E2139A26C4BA9A42BB7B03ADF606DE33CA6C7BDE0E4B7121A17C4CE71998C2C8F4DC8'+\r\n    '13DA9C5289A78036201C7807996476ABED7DBF3E1D8A4CC69DCF975A8BBD75BFBD69258B5EBFDDD1714E2E7C6517028702187F785607845C8688878A8B568F90159292178B8C4B8F189A88947F4F97A1A2899C9D9F8419A9AAA'+\r\n    'BA546A0AFA91AAC42B5A8A2B89541BBBC9A1EB938A71AB0C4C533C1C29BCAB3CCCD91BDD0D183AE1FC91FCB7BD9DAB720DD637C21DBDCBFDEE5E6E1E2E926C720E7E8EF20D3C8EDEED7F6EB26F3FA6FD6F46357CD443D7E6D50'+\r\n    'FC03E849602185F90C026A446D18452B0B2F0AC9A8B11207C78E383E829C2172A48C82268D3CE391000021F90405050007002C8A0092004200420082FFFFFFDDDDDDBBBBBB999999FFFFFFFFFFFFFFFFFFFFFFFF03F57807DCF'+\r\n    'EF0A949ABBD98C6CD5DFEE0D58D5C6882642A9DACA5BE402B4FB03ADFF578EFF9B6FFC0A070482C1A8FC8A472C96C3A9FD0A8744A3D05AE81AA0CCBD59AB8E0AC3713068F2FE5F099922EAF0F6DF73AAE3ED3CDF63BF6ADDFE7'+\r\n    'FB7C8081773B028602467A85878645743F8C8C446D4191878E784096979857439B8D2003A30352A088A2A4A350A7A819AAAA4FA721B0A44EADB4B5A54DB3B9B5BCA027BABB4BBDBEB04CC6C7B14AB8C2BAC5C12CC3CDCACBB64'+\r\n    '9D6D7AB48DADBC446DEA9BF47E2E3C8E1E61FD4E99B3BEC45D237F044F233F4F59140F8F9A13FFC6F26000C78606040836F10AE5178866143740431304B000021F90405050007002C8A0075003000570082FFFFFFDDDDDDBBBB'+\r\n    'BB999999FFFFFFFFFFFFFFFFFFFFFFFF03E778BA0C0E2CCA496B7BCEEA4DB1E7E0E68D61298DA8A9A2A95AB2ADCBC1B1ACD1A47DE3982EF20FDF0E0811768845E304A9AC009B161C340A9B0E7BD65F26CBED7ABFE0B0784C2E9'+\r\n    'BCFA1807ACD6EBBDBB6B77CCE76D1EF73157E0F37F1FF017A807B76837471866F688B8C8D8E8F909192936802960266979A639A9D98609E9D5FA19E5DA4A159A7A856AAA553ADA2AFB097A9B396ACB69FB2B35CB63203C00316'+\r\n    'BC2EC1C115AD36C6C614A73ECBC7CDB13AD0D1D2B742D5C062DAC261DDDE60DDDCE3DFDAE4D563E5E2E7E6EDECE9EEF1F0D0E8F5F6CBF8CCF2F7F4F9FADBD4CDD377669F86040021F90405050007002C8A0060003000570082F'+\r\n    'FFFFFDDDDDDBBBBBB999999FFFFFFFFFFFFFFFFFFFFFFFF03EB78BADCFE0B4800ABBD6D4ECCBBD29A2756E0369E4C69A2A7BAB2A24BC1AD4B8FF28DDB7A27CF3D4C2E281C122DC62389A784249B8E2734229D1EAAD39F35CA84'+\r\n    '04BE811EF60006EBB0E5F4ADCB48BB61EC857BCE2A55E67454C882CF4FFB7E50806F7F83655B8687568966858C888F90835B7280949578976D849A9B5F9DA0A1A2A3A4A5A6A7A8A93A02ACADAEAFB0AF30B1B4B5AE28B6B9B52'+\r\n    '7BABDB223BEC102BCC2BDB8C5B6B3C8B1AACDCECFD0D1D2D3D4CF03D703A3D8DBA0DBDED997DFDE94E2DF56E5E250E8E94DEBE64AEEE3F0F1D8EAF4D7EDF7E0F3F453F75BFD00AED3842ED43B51DCAC24000021F90405050007'+\r\n    '002C8A0058004200420082FFFFFFDDDDDDBBBBBB999999FFFFFFFFFFFFFFFFFFFFFFFF03FD78BADCFE30CA062A9838EB69EDFE20D77961698EA4A96E68B5BE597BC13424D738D5E64BE007AF1BEFF75B097144A2EA584B164FB'+\r\n    'B9CF31962D2A6D48FF58A2D6DB9D36A74D8057DC14EF3985CD69CD149ED9A1D76CFE9713B8AE7C0026377784A807B7C0D7E842386878822858B3D6D116F528D93818696971D13029E027083129C129F9F309A2BA6AB2F92AAAB'+\r\n    'AC26AE2AB0B5B27934B5B625A235BABB9020BFC0C11BC3B0C51FC7B1C91ACBA6CDC6CF9ED119D3D4D518D7D9D6CBDCCEC3DFE0BAE2D2CCE5E3A0E8EBECEDEEEFF0F1F2F3F4F5F68603F9FAFBFCFDFCD5FE020ADCD76CA04181C'+\r\n    '90E2AFC576CA1C301091F2A2C287120C08AFEA225000021F90405050007002C920058005700300082FFFFFFDDDDDDBBBBBB999999FFFFFFFFFFFFFFFFFFFFFFFF03FF78BADCFE30BE4083BC38EB3D2BE560284A9E379E285756'+\r\n    '69EB76EB2BBFEB37DF676DE13CA8F723815090FAA10048406B38441947C9248AC9CCD54ED1E889DA1C3D435969902BF45E4561B188DCF59D4169F59A2DFA6EE2CA149BE88EC1E32E7B217619782F822A6F1A8687881A8412787'+\r\n    '98D64897E8B80337B7C19901092388E189E0F8CA1749D8A91993CA224AA11A6ADA817A40CB2B3B411B60AA0400AAE302518B83D9BB5B00DBEBFC0BA1097B1AC1003D40381CEC2C4D20FD5D54BD847DB0DDDE47A9532E2E3E4E5'+\r\n    '635C33E90CEBF2ED6DE85918F2F373653C5A19F9FA9809041850E02F82EB0C3243C84E211086DD1C1E84484D620F8A152DF2C0A8F11322C38E0F09820C996FE4C48626495A4BA921010021F90401050007002CA700580057003'+\r\n    '00082FFFFFFDDDDDDBBBBBB999999FFFFFFFFFFFFFFFFFFFFFFFF03FF78BADCFE4B4801ABBD38EB36E7FE60A8759D689E22E9A16C5BA9922BCF074CD1F869E77CB8F7A28170C0FA9D02C8406B38441945C9248AC9D4C18E51A9'+\r\n    '89DA343D41596D902BF45EA161E489DC057D3569F1989C3A83E34BB6CFBE892BF3746E7C70782E6C441F6F177E33878823838B8C8D7A1B8A1593949519970F7E7F34879691988539A29CA49EA6A79B179D0D993CA8AFAAB1ACB'+\r\n    '3B42FB60B9F400BBA10B00AB2408EB52A92B8C6AEC22418C5BF07C10F25CA612E00DA0018D428D121DBDBDD8132CB20E2E917CD2CE71AE9F0E45538D822F0F719F3395126F7F8D2D2FCFD03D843E04082380CC643C843A13A86'+\r\n    '091D8E834843E2448A332C6AC358D11422C7880A3FE6082972A4C0920517A24CB9D14402003B';\r\n\r\nvar\r\n  WebLibDlg: TMessageDlg;\r\n\r\nfunction StringToHTML(AValue: string): string;\r\nbegin\r\n  Result := StringReplace(AValue,#13,'<BR>',[rfReplaceAll]);\r\n  Result := StringReplace(Result,#10,'',[rfReplaceAll]);\r\nend;\r\n\r\nprocedure ShowMessage(AMsg: string);\r\nbegin\r\n  if (Application <> nil) and (Application.MainForm <> nil) and (Application.MainForm.CSSLibrary = cssBootstrap) then\r\n  begin\r\n    MessageDlg(AMsg, mtInformation, [mbOK]);\r\n  end\r\n  else\r\n  begin\r\n    asm\r\n      alert(AMsg);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction InputBox(const ACaption, APrompt, ADefault: string): string;\r\nvar\r\n  retvalue: string;\r\nbegin\r\n//\r\n  asm\r\n    retvalue = prompt(APrompt, ADefault);\r\n    if (retvalue == null) {\r\n      retvalue = \"\";\r\n    }\r\n  end;\r\n\r\n  Result := retvalue;\r\nend;\r\n\r\nfunction InputQuery(const ACaption, APrompt: string; var Value: string): Boolean; overload;\r\nvar\r\n  retvalue: boolean;\r\n  s: string;\r\nbegin\r\n  retvalue := true;\r\n  s := Value;\r\n\r\n  asm\r\n    var text = s;\r\n    s = prompt(APrompt, text);\r\n    if (s == null) {\r\n      retvalue = false;\r\n    }\r\n  end;\r\n\r\n  if retvalue then\r\n    Value := s;\r\n\r\n  Result := retvalue;\r\nend;\r\n\r\nfunction Confirm(const Value: string): boolean;\r\nvar\r\n  res: boolean;\r\nbegin\r\n  asm\r\n    res = confirm(Value);\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nprocedure MessageDlg(const Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons;  AResultProc: TDialogResultProc = nil);\r\nbegin\r\n  if not Assigned(WebLibDlg) then\r\n  begin\r\n    WebLibDlg := TMessageDlg.Create(nil);\r\n    if Application.MainForm.CSSLibrary = cssBootstrap then\r\n    begin\r\n      TMessageDlg(WebLibDlg).InitBootstrapStyle;\r\n    end;\r\n  end;\r\n\r\n  WebLibDlg.ShowDialog(Msg, DlgType, Buttons, AResultProc);\r\nend;\r\n\r\n{ TMessageDlg }\r\n\r\nprocedure TMessageDlg.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FOpacity := 0.2;\r\n  FMessage := '';\r\n  FAutoLanguage := true;\r\n  FMsgDlgType := mtInformation;\r\n  FDialogText := TStringList.Create;\r\n  FDialogText.SkipLastLinebreak := true;\r\n  FDialogText.Add(SWarning);     // 0\r\n  FDialogText.Add(SError);       // 1\r\n  FDialogText.Add(SInformation); // 2\r\n  FDialogText.Add(SConfirm);     // 3\r\n  FDialogText.Add('Custom');     // 4\r\n  FDialogText.Add(SOK);          // 5\r\n  FDialogText.Add(SCancel);      // 6\r\n  FDialogText.Add(SYes);         // 7\r\n  FDialogText.Add(SNo);          // 8\r\n  FDialogText.Add(SAbort);       // 9\r\n  FDialogText.Add(SRetry);       // 10\r\n  FDialogText.Add(SIgnore);      // 11\r\n  FDialogText.Add(SAll);         // 12\r\n  FDialogText.Add(SYestoAll);    // 13\r\n  FDialogText.Add(SNotoAll);     // 14\r\n  FDialogText.Add(SHelp);        // 15\r\n  FDialogText.Add(SClose);       // 16\r\n\r\n  FMsgDlgType := mtCustom;\r\n\r\n  FCustomButtons := TCustomDialogButtons.Create(Self, TCustomDialogButton);\r\n  FCustomButtons.PropName := 'CustomButtons';\r\nend;\r\n\r\ndestructor TMessageDlg.Destroy;\r\nbegin\r\n  FDialogText.Free;\r\n  FCustomButtons.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TMessageDlg.GetDialogText(Index: integer): string;\r\ntype\r\n  TLang = (lEN, lFR, lDE, lES, lNL);\r\nvar\r\n  locl: string;\r\n  l: TLang;\r\nbegin\r\n  Result := 'Undefined';\r\n\r\n  if Index < FDialogText.Count then\r\n    Result := FDialogText.Strings[Index];\r\n\r\n  if AutoLanguage then\r\n  begin\r\n    locl := GetBrowserLocale;\r\n\r\n    l := lEN;\r\n    if pos('es', locl) = 1  then\r\n      l := lES;\r\n    if pos('fr', locl) = 1  then\r\n      l := lFR;\r\n    if pos('de', locl) = 1  then\r\n      l := lDE;\r\n    if pos('nl', locl) = 1  then\r\n      l := lNL;\r\n\r\n//  FDialogText.Add(SWarning);     // 0\r\n//  FDialogText.Add(SError);       // 1\r\n//  FDialogText.Add(SInformation); // 2\r\n//  FDialogText.Add(SConfirm);     // 3\r\n//  FDialogText.Add('Custom');     // 4\r\n//  FDialogText.Add(SOK);          // 5\r\n//  FDialogText.Add(SCancel);      // 6\r\n//  FDialogText.Add(SYes);         // 7\r\n//  FDialogText.Add(SNo);          // 8\r\n//  FDialogText.Add(SAbort);       // 9\r\n//  FDialogText.Add(SRetry);       // 10\r\n//  FDialogText.Add(SIgnore);      // 11\r\n//  FDialogText.Add(SAll);         // 12\r\n//  FDialogText.Add(SYestoAll);    // 13\r\n//  FDialogText.Add(SNotoAll);     // 14\r\n//  FDialogText.Add(SHelp);        // 15\r\n//  FDialogText.Add(SClose);       // 16\r\n\r\n    case l of\r\n    lES:\r\n      begin\r\n        case Index of\r\n        0: Result := SWarningES;\r\n        1: Result := SErrorES;\r\n        2: Result := SInformationES;\r\n        3: Result := SConfirmES;\r\n//        4: Result :=\r\n        5: Result := SOKES;\r\n        6: Result := SCancelES;\r\n        7: Result := SYesES;\r\n        8: Result := SNoES;\r\n        9: Result := SAbortES;\r\n        10: Result := SRetryES;\r\n        11: Result := SIgnoreES;\r\n        12: Result := SAllES;\r\n        13: Result := SYesToAllES;\r\n        14: Result := SNoToAllES;\r\n        15: Result := SHelpES;\r\n        16: Result := SCloseES;\r\n        end;\r\n      end;\r\n    lFR:\r\n      begin\r\n        case Index of\r\n        0: Result := SWarningFR;\r\n        1: Result := SErrorFR;\r\n        2: Result := SInformationFR;\r\n        3: Result := SConfirmFR;\r\n//        4: Result :=\r\n        5: Result := SOKFR;\r\n        6: Result := SCancelFR;\r\n        7: Result := SYesFR;\r\n        8: Result := SNoFR;\r\n        9: Result := SAbortFR;\r\n        10: Result := SRetryFR;\r\n        11: Result := SIgnoreFR;\r\n        12: Result := SAllFR;\r\n        13: Result := SYesToAllFR;\r\n        14: Result := SNoToAllFR;\r\n        15: Result := SHelpFR;\r\n        16: Result := SCloseFR;\r\n        end;\r\n      end;\r\n    lDE:\r\n      begin\r\n        case Index of\r\n        0: Result := SWarningDE;\r\n        1: Result := SErrorDE;\r\n        2: Result := SInformationDE;\r\n        3: Result := SConfirmDE;\r\n//        4: Result :=\r\n        5: Result := SOKDE;\r\n        6: Result := SCancelDE;\r\n        7: Result := SYesDE;\r\n        8: Result := SNoDE;\r\n        9: Result := SAbortDE;\r\n        10: Result := SRetryDE;\r\n        11: Result := SIgnoreDE;\r\n        12: Result := SAllDE;\r\n        13: Result := SYesToAllDE;\r\n        14: Result := SNoToAllDE;\r\n        15: Result := SHelpDE;\r\n        16: Result := SCloseDE;\r\n        end;\r\n      end;\r\n    lNL:\r\n      begin\r\n        case Index of\r\n        0: Result := SWarningNL;\r\n        1: Result := SErrorNL;\r\n        2: Result := SInformationNL;\r\n        3: Result := SConfirmNL;\r\n//        4: Result :=\r\n        5: Result := SOKNL;\r\n        6: Result := SCancelNL;\r\n        7: Result := SYesNL;\r\n        8: Result := SNoNL;\r\n        9: Result := SAbortNL;\r\n        10: Result := SRetryNL;\r\n        11: Result := SIgnoreNL;\r\n        12: Result := SAllNL;\r\n        13: Result := SYesToAllNL;\r\n        14: Result := SNoToAllNL;\r\n        15: Result := SHelpNL;\r\n        16: Result := SCloseNL;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TMessageDlg.BindEvents;\r\nbegin\r\n//\r\nend;\r\n\r\nfunction TMessageDlg.ShowDialog: integer;\r\nbegin\r\n  Result := mrNone;\r\n  Show;\r\nend;\r\n\r\nfunction TMessageDlg.ShowDialog(Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons; AProc: TDialogResultProc = nil): TDialogResult;\r\nbegin\r\n  Result := mrNone;\r\n  FButtons := Buttons;\r\n  FMessage := Msg;\r\n  FMsgDlgType := DlgType;\r\n  FDialogProc := AProc;\r\n  DialogResult := mrNone;\r\n  Show;\r\nend;\r\n\r\nfunction TMessageDlg.CreateButton(Caption: string; var DoFocus: boolean; AClass: string = ''): TJSHTMLElement;\r\nbegin\r\n  Result := TJSHTMLElement(document.createElement('BUTTON'));\r\n  Result.innerHTML := Caption;\r\n\r\n  if Application.MainForm.CSSLibrary = cssBootstrap then\r\n  begin\r\n    Result['type'] := 'BUTTON';\r\n    Result['class'] := 'btn ' + AClass;\r\n    Result['data-dismiss'] := 'modal-dialog';\r\n  end\r\n  else\r\n  begin\r\n    Result.style.setProperty('width', '100px');\r\n    Result.style.setProperty('margin-left', '5px');\r\n    if ElementButtonClassName <> '' then\r\n      Result['class'] := ElementButtonClassName + ' ' + AClass\r\n    else\r\n      if Application.ThemeButtonClassName <> '' then\r\n        Result['class'] := Application.ThemeButtonClassName + ' ' + AClass;\r\n  end;\r\n\r\n  Result.id := Caption;\r\n  Result.addEventListener('click', @HandleButtonClick);\r\n  Result.addEventListener('keydown', @HandleKeyDown);\r\n\r\n  if DoFocus then\r\n  begin\r\n    asm\r\n      setTimeout(function() {Result.focus();}, 1);\r\n    end;\r\n    DoFocus := false;\r\n  end;\r\nend;\r\n\r\nfunction TMessageDlg.CreateElement: TJSElement;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n    Result := nil\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TMessageDlg.Show;\r\nvar\r\n  title, msg, icon, content, contentdiv, bar, edlg, eh, cancel: TJSHTMLElement;\r\n  adiv,ldiv,cdiv: TJSElement;\r\n  MsgSymbol, MsgColor, MsgTitle, BorderColor, BarBGColor, BarHeight, Padding: string;\r\n  btnFocus: boolean;\r\n  i: Integer;\r\n\r\nbegin\r\n  if (Application = nil) or (Application.MainForm = nil) then\r\n    Exit;\r\n\r\n  // verify material icons\r\n  if not Application.HasCSS(lMaterial) then\r\n    AddControlLink('material',lMaterial);\r\n\r\n  Application.LockForm(Application.MainForm);\r\n\r\n  FLayer := document.createElement('SPAN');\r\n  document.body.appendChild(FLayer);\r\n  FLayer['tabindex'] := '0';\r\n  FLayer.addEventListener('keydown', @HandleKeyDown);\r\n\r\n  btnFocus := true;\r\n  MsgTitle := FTitle;\r\n  FMessage := StringToHTML(FMessage);\r\n\r\n  case FMsgDlgType of\r\n    mtWarning: begin MsgSymbol := 'warning'; MsgColor := 'orange'; MsgTitle := GetDialogText(0); end;\r\n    mtError: begin MsgSymbol := 'cancel'; MsgColor := 'red'; MsgTitle := GetDialogText(1); end;\r\n    mtInformation: begin MsgSymbol := 'info'; MsgColor := 'blue'; MsgTitle := GetDialogText(2); end;\r\n    mtConfirmation: begin MsgSymbol := 'help'; MsgColor := 'blue'; MsgTitle := GetDialogText(3); end;\r\n    mtCustom: begin MsgSymbol := ''; MsgColor := ''; MsgTitle := GetDialogText(4); end;\r\n  end;\r\n\r\n  if Application.MainForm.CSSLibrary = cssBootstrap then\r\n  begin\r\n    FDlg := document.createElement('DIV');\r\n    FDlg['class'] := 'modal-dialog'; //  modal-dialog-centered';\r\n    FDlg['role'] := 'document';\r\n\r\n    // app wide highest z-index\r\n    TJSHTMLElement(FDlg).style.setProperty('z-index', '1999998');\r\n\r\n    // insert opaque background on entire window\r\n    eh := TJSHTMLElement(document.createElement('SPAN'));\r\n    eh.style.setProperty('position', 'absolute');\r\n    eh.style.setProperty('top', '0');\r\n    eh.style.setProperty('left', '0');\r\n    eh.style.setProperty('right', '0');\r\n    eh.style.setProperty('bottom', '0');\r\n    eh.style.setProperty('z-index', '1999997');\r\n    document.body.appendChild(eh);\r\n    eh.appendChild(FDlg);\r\n\r\n    ldiv := FDlg;\r\n\r\n    adiv := document.createElement('DIV');\r\n    adiv['class'] := 'modal-content ' + ElementDialogClassName;\r\n    ldiv.appendChild(adiv);\r\n\r\n    cdiv := adiv;\r\n    ldiv := adiv;\r\n\r\n    adiv := document.createElement('DIV');\r\n    adiv['class'] := 'modal-header';\r\n    cdiv.appendChild(adiv);\r\n\r\n    ldiv := adiv;\r\n\r\n    adiv := document.createElement('H5');\r\n    adiv['class'] := 'modal-title';\r\n    adiv.innerHTML := MsgTitle;\r\n\r\n    ldiv.appendChild(adiv);\r\n\r\n    if (mbCancel in Buttons) then\r\n    begin\r\n      adiv := document.createElement('BUTTON');\r\n      adiv['type'] := 'button';\r\n      adiv['class'] := 'close btn btn-danger';\r\n      adiv['data-dismiss'] := 'modal-dialog';\r\n      adiv['aria-label'] := 'Close';\r\n      adiv['id'] := GetDialogText(6);\r\n      adiv.addEventListener('click', @HandleButtonClick);\r\n\r\n      ldiv.appendChild(adiv);\r\n      ldiv := adiv;\r\n\r\n      adiv := document.createElement('SPAN');\r\n      adiv['aria-hidden'] := 'true';\r\n      adiv['id'] := GetDialogText(6);\r\n      adiv.innerHTML := '&times;';\r\n\r\n      ldiv.appendChild(adiv);\r\n    end;\r\n\r\n    adiv := document.createElement('DIV');\r\n    adiv['class'] := 'modal-body';\r\n    cdiv.appendChild(adiv);\r\n\r\n    ldiv := adiv;\r\n\r\n    if FMsgDlgType <> mtCustom then\r\n    begin\r\n      icon := TJSHTMLElement(document.createElement('SPAN'));\r\n      icon.innerHTML := '<i class=\"material-icons\" style=\"color:' + MsgColor + '!important;font-size:48px!important\">' + MsgSymbol + '</i>';\r\n      icon.style.setProperty('display', 'inline-block');\r\n      icon.style.setProperty('float', 'left');\r\n      icon.style.setProperty('padding-right', '15px');\r\n      ldiv.appendChild(icon);\r\n    end;\r\n\r\n    adiv := document.createElement('H6');\r\n    adiv.innerHTML := FMessage;\r\n\r\n    ldiv.appendChild(adiv);\r\n\r\n    adiv := document.createElement('DIV');\r\n    adiv['class'] := 'modal-footer';\r\n    cdiv.appendChild(adiv);\r\n\r\n    ldiv := adiv;\r\n\r\n    bar := TJSHTMLElement(ldiv);\r\n\r\n    FDlg := eh;\r\n  end\r\n  else\r\n  begin\r\n    Padding := '5';\r\n    BarHeight := '26';\r\n    BarBGColor := '#f1f1f1';\r\n    BorderColor := '#ababab';\r\n\r\n    FDlg := document.createElement('DIV');\r\n    document.body.appendChild(FDlg);\r\n\r\n    edlg := TJSHTMLElement(FDlg);\r\n\r\n    if ElementDialogClassName <> '' then\r\n       edlg['class'] := ElementDialogClassName\r\n    else\r\n    begin\r\n      edlg.style.setProperty('background-color', 'white');\r\n      edlg.style.setProperty('border', '1px solid ' + BorderColor);\r\n      edlg.style.setProperty('font-family', 'Arial');\r\n      edlg.style.setProperty('font-size', '10pt');\r\n    end;\r\n\r\n    edlg.style.setProperty('cursor', 'default');\r\n    edlg.style.setProperty('position', 'fixed');\r\n    edlg.style.setProperty('min-width', '300px');\r\n    edlg.style.setProperty('min-height', '125px');\r\n    edlg.style.setProperty('max-width', '100%');\r\n    edlg.style.setProperty('max-height', '100%');\r\n    edlg.style.setProperty('top', '50%');\r\n    edlg.style.setProperty('left', '50%');\r\n    edlg.style.setProperty('transform', 'translate(-50%, -50%)');\r\n    edlg.style.setProperty('z-index', '1999998');\r\n    edlg.style.setProperty('box-shadow','5px 5px 5px gray');\r\n\r\n    cancel := TJSHTMLElement(document.createElement('DIV'));\r\n    FCancel := cancel;\r\n    cancel.innerHTML := '<i id=\"Cancel\" class=\"material-icons\" style=\"font-size:16px!important\">clear</i>';\r\n    cancel.id := 'Cancel';\r\n    cancel.style.setProperty('color', ColorToHTML(Application.ThemeTextColor));\r\n    cancel.style.setProperty('position', 'fixed');\r\n    cancel.style.setProperty('top', '0');\r\n    cancel.style.setProperty('right', '0');\r\n    cancel.style.setProperty('padding', Padding + 'px');\r\n    cancel.style.setProperty('height', BarHeight + 'px');\r\n    cancel.style.setProperty('line-height', BarHeight + 'px');\r\n    cancel.addEventListener('click', @HandleButtonClick);\r\n    edlg.appendChild(cancel);\r\n\r\n    title := TJSHTMLElement(document.createElement('DIV'));\r\n    title.innerHTML := MsgTitle;\r\n\r\n    if FElementTitleClassName <> '' then\r\n    begin\r\n      title['class'] := FElementTitleClassName;\r\n    end\r\n    else\r\n    begin\r\n      title.style.setProperty('background-color', ColorToHTML(Application.ThemeColor));\r\n      title.style.setProperty('color', ColorToHTML(Application.ThemeTextColor));\r\n    end;\r\n\r\n    title.style.setProperty('cursor', 'move');\r\n    title.style.setProperty('padding-left', Padding + 'px');\r\n    title.style.setProperty('height', BarHeight + 'px');\r\n    title.style.setProperty('vertical-align','middle');\r\n    title.style.setProperty('line-height', BarHeight + 'px');\r\n    title.style.setProperty('border-bottom', '1px solid ' + BorderColor);\r\n\r\n    title.style.setProperty('-moz-user-select','none');\r\n    title.style.setProperty('-webkit-user-select','none');\r\n    title.style.setProperty('-ms-user-select','none');\r\n    title.style.setProperty('user-select','none');\r\n    title.style.setProperty('-o-user-select','none');\r\n\r\n    title.addEventListener('mousedown',@HandleMouseDown);\r\n\r\n    edlg.appendChild(title);\r\n\r\n    msg := TJSHTMLElement(document.createElement('DIV'));\r\n\r\n    msg.style.setProperty('padding', Padding + 'px');\r\n    msg.style.setProperty('height', 'auto');\r\n    msg.style.setProperty('min-height', '50px');\r\n    msg.style.setProperty('border-bottom', '1px solid ' + BorderColor);\r\n\r\n    if FMsgDlgType <> mtCustom then\r\n    begin\r\n      icon := TJSHTMLElement(document.createElement('DIV'));\r\n      icon.innerHTML := '<i class=\"material-icons\" style=\"color:' + MsgColor + '!important;font-size:48px!important\">' + MsgSymbol + '</i>';\r\n      icon.style.setProperty('display', 'inline-block');\r\n      icon.style.setProperty('float', 'left');\r\n      icon.style.setProperty('padding-right', '15px');\r\n      msg.appendChild(icon);\r\n    end;\r\n\r\n    FMessage := StringReplace(FMessage, sLineBreak, '<BR>', [rfReplaceAll]);\r\n\r\n    contentdiv := TJSHTMLElement(document.createElement('DIV'));\r\n    contentdiv.innerHTML := FMessage;\r\n    contentdiv.style.setProperty('height','auto');\r\n    contentdiv.style.setProperty('min-height','50px');\r\n    contentdiv.style.setProperty('white-space','pre-wrap');\r\n\r\n    content := TJSHTMLElement(document.createElement('LABEL'));\r\n    content.innerHTML := FMessage;\r\n\r\n    if FElementTitleClassName <> '' then\r\n    begin\r\n      content['class'] := FElementContentClassName;\r\n    end;\r\n\r\n    contentdiv.appendChild(content);\r\n\r\n    msg.appendChild(content);\r\n\r\n    edlg.appendChild(msg);\r\n\r\n    bar := TJSHTMLElement(document.createElement('DIV'));\r\n    bar.style.setProperty('background-color', BarBGColor);\r\n    bar.style.setProperty('padding', Padding + 'px');\r\n    bar.style.setProperty('min-height', BarHeight + 'px');\r\n    bar.style.setProperty('height', 'auto');\r\n    bar.style.setProperty('line-height', BarHeight + 'px');\r\n    bar.style.setProperty('text-align', 'right');\r\n    edlg.appendChild(bar);\r\n  end;\r\n\r\n  if (FButtons = []) and (CustomButtons.Count = 0) then\r\n    bar.appendChild(CreateButton(GetDialogText(5), btnFocus))\r\n  else\r\n  begin\r\n    if mbYes in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(7), btnFocus));\r\n\r\n    if mbNo in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(8), btnFocus));\r\n\r\n    if mbOK in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(5), btnFocus));\r\n\r\n    if mbCancel in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(6), btnFocus));\r\n\r\n    if mbAbort in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(9), btnFocus));\r\n\r\n    if mbRetry in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(10), btnFocus));\r\n\r\n    if mbIgnore in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(11), btnFocus));\r\n\r\n    if mbAll in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(12), btnFocus));\r\n\r\n    if mbYesToAll in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(13), btnFocus));\r\n\r\n    if mbNoToAll in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(14), btnFocus));\r\n\r\n    if mbHelp in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(15), btnFocus));\r\n\r\n    if mbClose in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(16), btnFocus));\r\n  end;\r\n\r\n  for i := 0 to FCustomButtons.Count - 1 do\r\n  begin\r\n    bar.appendChild(CreateButton(FCustomButtons[i].Caption, btnFocus, FCustomButtons[i].ElementClassName));\r\n  end;\r\n\r\n  eh := TJSHTMLElement(FLayer);\r\n  eh.style.setProperty('background-color', 'black');\r\n  eh.style.setProperty('opacity', DoubleToHTML(Opacity));\r\n\r\n  eh.style.setProperty('top', '0');\r\n  eh.style.setProperty('left', '0');\r\n  eh.style.setProperty('right', '0');\r\n  eh.style.setProperty('bottom', '0');\r\n  eh.style.setProperty('z-index', '19990');\r\n\r\n  eh.style.setProperty('webkit-user-select', 'none');\r\n  eh.style.setProperty('moz-user-select', 'none');\r\n  eh.style.setProperty('khtml-user-select', 'none');\r\n  eh.style.setProperty('ms-user-select', 'none');\r\n  eh.style.setProperty('user-select', 'none');\r\n  eh.style.SetProperty('position','fixed');\r\nend;\r\n\r\nfunction TMessageDlg.ShowDialog(Msg: string; DlgType: TMsgDlgType;\r\n  Buttons: TMsgDlgButtons): TJSPromise;\r\nbegin\r\n  Result := TJSPromise.new(\r\n\r\n    procedure(ASuccess, AFailed: TJSPromiseResolver)\r\n    begin\r\n      ShowDialog(Msg, DlgType, Buttons, procedure(AResult: TModalResult)\r\n        begin\r\n          ASuccess(AResult);\r\n        end);\r\n    end\r\n\r\n  );\r\nend;\r\n\r\nprocedure TMessageDlg.SetCustomButtons(const Value: TCustomDialogButtons);\r\nbegin\r\n  FCustomButtons.Assign(Value);\r\nend;\r\n\r\nprocedure TMessageDlg.SetDialogResult(const Value: TDialogResult);\r\nbegin\r\n  FDialogResult := Value;\r\n  if (FDialogResult <> mrNone) then\r\n    Close;\r\nend;\r\n\r\nprocedure TMessageDlg.SetDialogText(const Value: TStringList);\r\nbegin\r\n  FDialogText.Assign(Value);\r\nend;\r\n\r\nprocedure TMessageDlg.Close;\r\nbegin\r\n  Application.UnlockForm(Application.MainForm);\r\n\r\n  document.body.removeChild(FLayer);\r\n  document.body.removeChild(FDlg);\r\n\r\n  FDown := false;\r\n  FCaptured := false;\r\n\r\n  if Assigned(OnClose) then\r\n    OnClose(Self);\r\n\r\n  if Assigned(FDialogProc) then\r\n    FDialogProc(FDialogResult);\r\nend;\r\n\r\nfunction TMessageDlg.HandleButtonClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  id: string;\r\n  i: integer;\r\nbegin\r\n  DialogResult := mrNone;\r\n\r\n  id := event.targetElement['id'];\r\n\r\n  if id = GetDialogText(7) then\r\n    DialogResult := mrYes\r\n  else if id = GetDialogText(8) then\r\n    DialogResult := mrNo\r\n  else if id = GetDialogText(5) then\r\n    DialogResult := mrOK\r\n  else if id = GetDialogText(6) then\r\n    DialogResult := mrCancel\r\n  else if id = GetDialogText(9) then\r\n    DialogResult := mrAbort\r\n  else if id = GetDialogText(10) then\r\n    DialogResult := mrRetry\r\n  else if id = GetDialogText(11) then\r\n    DialogResult := mrIgnore\r\n  else if id = GetDialogText(12) then\r\n    DialogResult := mrAll\r\n  else if id = GetDialogText(13) then\r\n    DialogResult := mrNoToAll\r\n  else if id = GetDialogText(14) then\r\n    DialogResult := mrYesToAll\r\n  else if id = GetDialogText(15) then\r\n    DialogResult := mrHelp\r\n  else if id = GetDialogText(16) then\r\n    DialogResult := mrClose;\r\n\r\n  if (DialogResult = mrNone) and (CustomButtons.Count > 0) then\r\n  begin\r\n    for i := 0 to CustomButtons.Count - 1 do\r\n    begin\r\n      if id = CustomButtons[i].Caption then\r\n      begin\r\n        DialogResult := 100 + i;\r\n        break;\r\n      end;\r\n\r\n    end;\r\n  end;\r\n\r\n  if Assigned(OnButtonClick) then\r\n    OnButtonClick(Self);\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TMessageDlg.HandleDocMouseMove(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  deltax,deltay: double;\r\n  el: TJSHTMLElement;\r\nbegin\r\n  if FDown then\r\n  begin\r\n    deltax := Event.screenX - FMdx;\r\n    deltay := Event.screenY - FMdy;\r\n\r\n    el := TJSHTMLElement(FDlg);\r\n\r\n    el.style.setProperty('transform','');\r\n    el.style.setProperty('position','absolute');\r\n    el.style.setProperty('left', inttostr(round(FDlgX + deltax))+'px');\r\n    el.style.setProperty('top', inttostr(round(FDlgY + deltay))+'px');\r\n\r\n    el := TJSHTMLElement(FCancel);\r\n    el.style.setProperty('position', 'absolute');\r\n    el.style.setProperty('top', '0');\r\n    el.style.setProperty('right', '0');\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TMessageDlg.HandleDocMouseUp(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FDown := false;\r\n  document.body.removeEventListener('mousemove', @HandleDocMouseMove);\r\n  document.body.removeEventListener('mouseup', @HandleDocMouseUp);\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TMessageDlg.HandleMouseDown(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  r: TJSDOMRect;\r\nbegin\r\n  FMdx := Round(Event.screenX);\r\n  FMdy := Round(Event.screenY);\r\n\r\n  r := FDlg.getBoundingClientRect();\r\n\r\n  FDlgX := Round(int(r.left));\r\n  FDlgY := Round(int(r.top));\r\n\r\n  FDown := true;\r\n\r\n  if not FCaptured then\r\n  begin\r\n    FCaptured := true;\r\n    document.body.addEventListener('mousemove', @HandleDocMouseMove);\r\n    document.body.addEventListener('mouseup', @HandleDocMouseUp);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nprocedure TMessageDlg.InitBootstrapStyle;\r\nbegin\r\n  FElementButtonClassName := 'btn';\r\n  FElementContentClassName := 'text-body';\r\n  FElementTitleClassName := 'text-body';\r\n  FElementDialogClassName := 'shadow-lg p-3 mb-5 bg-white rounded';\r\nend;\r\n\r\nfunction TMessageDlg.HandleKeyDown(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  k: Word;\r\nbegin\r\n  k := GetKeyCode(Event.Key);\r\n  if not Assigned(k) then\r\n    Exit;\r\n  if k = VK_ESCAPE then\r\n    DialogResult := mrCancel;\r\n  Result := true;\r\nend;\r\n\r\n{ TWaitMessage }\r\n\r\nfunction TWaitMessage.CreateElement: TJSElement;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n    Result := nil\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TWaitMessage.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FOpacity := 0.2;\r\n  FPicture := TURLPicture.Create;\r\n  FIsWaiting := false;\r\n  FPicture.Data := lWaitCursor;\r\nend;\r\n\r\ndestructor TWaitMessage.Destroy;\r\nbegin\r\n  FPicture.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TWaitMessage.Hide;\r\nbegin\r\n  if FIsWaiting then\r\n    document.body.removeChild(FLayer);\r\n  FIsWaiting := false;\r\nend;\r\n\r\nprocedure TWaitMessage.SetPicture(const Value: TURLPicture);\r\nbegin\r\n  FPicture.Assign(Value);\r\nend;\r\n\r\nprocedure TWaitMessage.SetPictureURL(const Value: string);\r\nbegin\r\n  FPictureURL := Value;\r\nend;\r\n\r\nprocedure TWaitMessage.Show;\r\nvar\r\n  eh,img,dv: TJSHTMLElement;\r\n  el: TJSElement;\r\nbegin\r\n  FLayer := document.createElement('SPAN');\r\n\r\n  eh := TJSHTMLElement(FLayer);\r\n  eh.style.setProperty('background-color', 'black');\r\n  eh.style.setProperty('opacity', DoubleToHTML(Opacity));\r\n  eh.style.setProperty('top', '0');\r\n  eh.style.setProperty('left', '0');\r\n  eh.style.setProperty('right', '0');\r\n  eh.style.setProperty('bottom', '0');\r\n  eh.style.setProperty('z-index', '9999999');\r\n\r\n  eh.style.setProperty('webkit-user-select', 'none');\r\n  eh.style.setProperty('moz-user-select', 'none');\r\n  eh.style.setProperty('khtml-user-select', 'none');\r\n  eh.style.setProperty('ms-user-select', 'none');\r\n  eh.style.setProperty('user-select', 'none');\r\n  eh.style.SetProperty('position','fixed');\r\n\r\n  document.body.appendChild(FLayer);\r\n  FLayer['tabindex'] := '0';\r\n\r\n  el := document.createElement('DIV');\r\n  dv := TJSHTMLElement(el);\r\n  FLayer.appendChild(el);\r\n  dv.style.SetProperty('position','relative');\r\n  dv.style.SetProperty('width','100%');\r\n  dv.style.SetProperty('height','100%');\r\n\r\n  el := document.createElement('IMG');\r\n  img := TJSHTMLElement(el);\r\n  dv.appendChild(img);\r\n  if FPictureURL <> '' then\r\n    img['src'] := FPictureURL\r\n  else\r\n    img['src'] := FPicture.FileName;\r\n  img.style.setProperty('position','absolute');\r\n  img.style.setProperty('top', '0');\r\n  img.style.setProperty('left', '0');\r\n  img.style.setProperty('right', '0');\r\n  img.style.setProperty('bottom', '0');\r\n  img.style.setProperty('margin', 'auto');\r\n\r\n  FIsWaiting := true;\r\n\r\n  if Assigned(OnShow) then\r\n  begin\r\n    window.setTimeout(@WaitDisplayed, 100);\r\n  end;\r\nend;\r\n\r\nprocedure TWaitMessage.WaitDisplayed;\r\nbegin\r\n  if Assigned(OnShow) then\r\n    OnShow(Self);\r\nend;\r\n\r\n{ TCustomDialogButtons }\r\n\r\nfunction TCustomDialogButtons.Add: TCustomDialogButton;\r\nbegin\r\n  Result := TCustomDialogButton(inherited Add);\r\nend;\r\n\r\nfunction TCustomDialogButtons.GetItem(AIndex: integer): TCustomDialogButton;\r\nbegin\r\n  Result := TCustomDialogButton(inherited Items[AIndex]);\r\nend;\r\n\r\nfunction TCustomDialogButtons.Insert(AIndex: integer): TCustomDialogButton;\r\nbegin\r\n  Result := TCustomDialogButton(inherited Insert(AIndex));\r\nend;\r\n\r\nprocedure TCustomDialogButtons.SetItem(AIndex: integer;\r\n  const Value: TCustomDialogButton);\r\nbegin\r\n  inherited Items[AIndex] := Value;\r\nend;\r\n\r\n{ TOpenDialog }\r\n\r\nconstructor TOpenDialog.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner);\r\n  FFiles := TFiles.Create(Self);\r\nend;\r\n\r\ndestructor TOpenDialog.Destroy;\r\nbegin\r\n  FFiles.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TOpenDialog.Execute(AProc: TOpenDialogProc);\r\nbegin\r\n  FOpenDialogProc := AProc;\r\n  Execute;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TOpenDialog.Execute;\r\nvar\r\n  ic: pointer;\r\n  fp: TJSHTMLElement;\r\nbegin\r\n  ic := @HandleInputChange;\r\n  fp := TJSHTMLElement(document.createElement('input'));\r\n  fp.setAttribute('type','file');\r\n  if FMultiFile or (ofAllowMultiSelect in Options) then\r\n    fp.setAttribute('multiple','');\r\n\r\n  if FAccept <> '' then\r\n    fp.SetAttribute('accept',FAccept);\r\n\r\n  fp.addEventListener('change', ic);\r\n\r\n  asm\r\n    fp.click();\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TOpenDialog.HandleInputChange(Event: TJSEvent);\r\nvar\r\n  i,l,sz: integer;\r\n  s,m: string;\r\n  f: TFile;\r\n  d: TJSDate;\r\n  jsfile: TJSHTMLFile;\r\n\r\nbegin\r\n  // clear existing collection\r\n  while FFiles.Count > 0 do\r\n    FFiles.Delete(0);\r\n\r\n  asm\r\n    var curFiles = Event.target.files;\r\n    l = curFiles.length;\r\n  end;\r\n\r\n  for i := 0 to l - 1 do\r\n  begin\r\n    f := FFiles.Add;\r\n\r\n    asm\r\n      jsfile = curFiles[i];\r\n      s = curFiles[i].name;\r\n      m = curFiles[i].type;\r\n      sz = curFiles[i].size;\r\n      d = new Date(curFiles[i].lastModified);\r\n    end;\r\n\r\n    // get the first file\r\n    if (i = 0) then\r\n      FFileName := s;\r\n\r\n    f.FileObject := jsfile;\r\n    f.Name := s;\r\n    f.MimeType := m;\r\n    f.Size := sz;\r\n    f.Modified := EncodeDate(d.Year + 1900, d.Month + 1, d.Date)+EncodeTime(d.Hours, d.Minutes, d.Seconds, d.Milliseconds);\r\n  end;\r\n\r\n  if Assigned(FOpenDialogProc) then\r\n    FOpenDialogProc(FFileName);\r\n\r\n  FOpenDialogProc := nil;\r\n\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TOpenDialog.Perform: TJSPromise;\r\nbegin\r\n  Result := TJSPromise.new(\r\n    procedure(ASuccess, AFailed: TJSPromiseResolver)\r\n    begin\r\n      Execute(procedure(AFileName: string)\r\n        begin\r\n          ASuccess(AFileName);\r\n        end);\r\n    end\r\n\r\n  );\r\nend;\r\n\r\ninitialization\r\n  WebLibDlg := nil;\r\n\r\nend.","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit Math;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\nconst\r\n  MinInteger = -$fffffffffffff-1;\r\n  MaxInteger = $fffffffffffff;\r\n  MinDouble  =  5.0e-324;\r\n  MaxDouble  =  1.7e+308;\r\n\r\nconst\r\n  NaN: Double; external name 'NaN';\r\n  Infinity: Double; external name 'Infinity';\r\n  NegInfinity: Double; external name '-Infinity';\r\n\r\ntype\r\n  float = double;\r\n\r\n  //EInvalidArgument = class(EMathError);\r\n\r\nfunction Min(const a, b: Double): Double; varargs; external name 'Math.min'; overload;\r\nfunction Max(const a, b: Double): Double; varargs; external name 'Math.max'; overload;\r\nfunction Min(const a, b: NativeLargeUInt): NativeLargeUInt; varargs; external name 'Math.min'; overload;\r\nfunction Max(const a, b: NativeLargeUInt): NativeLargeUInt; varargs; external name 'Math.max'; overload;\r\nfunction Min(const a, b: NativeLargeInt): NativeLargeInt; varargs; external name 'Math.min'; overload;\r\nfunction Max(const a, b: NativeLargeInt): NativeLargeInt; varargs; external name 'Math.max'; overload;\r\nfunction Min(const a, b: Integer): Integer; varargs; external name 'Math.min'; overload;\r\nfunction Max(const a, b: Integer): Integer; varargs; external name 'Math.max'; overload;\r\n\r\nfunction InRange(const AValue, AMin, AMax: Integer): Boolean; assembler; overload;\r\nfunction InRange(const AValue, AMin, AMax: Double): Boolean; assembler; overload;\r\n\r\nfunction EnsureRange(const AValue, AMin, AMax: Integer): Integer; assembler; overload;\r\nfunction EnsureRange(const AValue, AMin, AMax: Double): Double; assembler; overload;\r\n\r\ntype\r\n  TRoundToRange = -37..37;\r\n\r\nfunction RoundTo(const AValue: Double; const Digits: TRoundToRange): Double;\r\nfunction SimpleRoundTo(const AValue: Double; const Digits: TRoundToRange = -2): Double;\r\n\r\nfunction randg(mean,stddev : float) : float;\r\nfunction RandomRange(const aFrom, aTo: Integer): Integer;\r\nfunction RandomRange(const aFrom, aTo: NativeLargeInt): NativeLargeInt;\r\n\r\nType\r\n  TValueSign = -1..1;\r\n\r\nconst\r\n  NegativeValue = -1;\r\n  ZeroValue = 0;\r\n  PositiveValue = 1;\r\n\r\nfunction Sign(const AValue: NativeInt): TValueSign; external name 'Math.sign'; overload;\r\nfunction Sign(const AValue: Double): TValueSign; external name 'Math.sign'; overload;\r\n\r\nfunction IsZero(const d: Double; Epsilon: Double): Boolean; overload;\r\nfunction IsZero(const d: Double): Boolean; overload;\r\n\r\nfunction IsNaN(const v: JSValue): boolean; external name {$IFDEF ECMAScript5}'isNaN'{$ELSE}'Number.isNaN'{$ENDIF}; overload;\r\nfunction IsFinite(const d: JSValue): Boolean; external name 'isFinite'; overload;// false if NaN, positive or negative infinity\r\nfunction IsInfinite(const d: JSValue): Boolean; assembler; overload; // negative or positive infinity\r\n{$IFDEF ECMAScript6}\r\nfunction IsInteger(const d: JSValue): Boolean; external name 'Number.isInteger'; // any integer representable by a double\r\nfunction IsSafeInteger(const d: JSValue): Boolean; external name 'Number.isSafeInteger'; // an integer between MinInteger and MaxInteger, inclusive\r\n{$ENDIF}\r\n\r\nfunction SameValue(const A, B: Double; Epsilon: Double = 0.0): Boolean; overload;\r\n\r\n// function Abs is in System.pas\r\nfunction ArcCos(const A : Double): Double; external name 'Math.acos';\r\nfunction ArcCosH(const A: Double): Double; external name 'Math.acosh'; // not on IE\r\nfunction ArcSin(const A : Double): Double; external name 'Math.asin';\r\nfunction ArcSinH(const A : Double): Double; external name 'Math.asinh'; // not on IE\r\nfunction ArcTanH(const A: Double): Double; external name 'Math.atanh'; // not on IE\r\nfunction CosH(const A: Double): Double; external name 'Math.cosh'; // not on IE\r\nprocedure SinCos(const A: Double; var B: Double; var C: Double);\r\nfunction ExpM1(const A: Double): Double; external name 'Math.expm1'; // not on IE\r\nfunction FRound(const A: Double): Double; overload; external name 'Math.fround'; // not on IE\r\nfunction FTrunc(const A: Double): double; overload; external name 'Math.trunc'; // not on IE\r\nfunction Hypot(const A : Double): Double; varargs; external name 'Math.hypot'; // not on IE\r\nfunction IMul(const A, B: Integer): Integer; external name 'Math.imul'; // not on IE\r\nfunction Log10(const A: Double): Double; external name 'Math.log10';\r\nfunction Log1p(const A: Double): Double; external name 'Math.log1p'; // not on IE\r\nfunction Log2(const A: Double): Double; external name 'Math.log2'; // not on IE\r\nfunction LogN(const Base, A: Double): Double;\r\nfunction Power(const Base, Exponent: Double): Double; external name 'Math.pow';\r\n// ln, round, sqrt, trunc, cos, sin, arctan, round, exp are in unit system\r\nfunction Ceil(const A: Double): Integer;\r\nfunction Floor(const A: Double): Integer;\r\nfunction Ceil64(const A: Double): NativeLargeInt;\r\nfunction Floor64(const A: Double): NativeLargeInt;\r\nfunction ldexp(x : double;const p : Integer) : double;\r\nprocedure Frexp(X: double; out Mantissa: double; out Exponent: integer);\r\nfunction lnxp1(x : double) : double;\r\n\r\nfunction IntPower(base : float;const exponent : Integer) : double;\r\n\r\nprocedure DivMod(Dividend: LongInt; Divisor: Word; out Result, Remainder: Word);\r\nprocedure DivMod(Dividend: LongInt; Divisor: Word; out Result, Remainder: SmallInt);\r\nprocedure DivMod(Dividend: DWord; Divisor: DWord; out Result, Remainder: DWord);\r\nprocedure DivMod(Dividend: LongInt; Divisor: LongInt; out Result, Remainder: LongInt);\r\n\r\n{ Angle conversion }\r\nfunction DegToRad(deg : double) : double;\r\nfunction RadToDeg(rad : double) : double;\r\nfunction GradToRad(grad : double) : double;\r\nfunction RadToGrad(rad : double) : double;\r\nfunction DegToGrad(deg : double) : double;\r\nfunction GradToDeg(grad : double) : double;\r\n{ one cycle are 2*Pi rad }\r\nfunction CycleToRad(cycle : double) : double;\r\nfunction RadToCycle(rad : double) : double;\r\nFunction DegNormalize(deg : double) : double;\r\n\r\nfunction Norm(const data : array of double) : double;\r\n\r\n// Statistical functions\r\nfunction Mean(const data : array of double) : double;\r\nfunction Sum(const data : array of double) : double;\r\nprocedure SumsAndSquares(const data : Array of Double; out Sum,SumOfSquares : double);\r\n\r\nfunction StdDev(const data : array of Double) : float;\r\nprocedure MeanAndStdDev(const data : array of Double; out Mean,StdDev : double);\r\nfunction Variance(const data : array of Double) : double;\r\nfunction TotalVariance(const data : array of Double) : double;\r\nfunction PopNStdDev(const data : array of Double) : double;\r\nfunction PopNVariance(const data : array of Double) : double;\r\nprocedure MomentSkewKurtosis(const data : array of Double; out m1,m2,m3,m4,skew,kurtosis : double);\r\n\r\n// Financial functions\r\n\r\nType\r\n  TPaymentTime = (ptEndOfPeriod,ptStartOfPeriod);\r\n\r\nfunction FutureValue(ARate: double; NPeriods: Integer;\r\n  APayment, APresentValue: double; APaymentTime: TPaymentTime): double;\r\n\r\nfunction InterestRate(NPeriods: Integer; APayment, APresentValue, AFutureValue: double;\r\n  APaymentTime: TPaymentTime): double;\r\n\r\nfunction NumberOfPeriods(ARate, APayment, APresentValue, AFutureValue: double;\r\n  APaymentTime: TPaymentTime): double;\r\n\r\nfunction Payment(ARate: double; NPeriods: Integer;\r\n  APresentValue, AFutureValue: double; APaymentTime: TPaymentTime): double;\r\n\r\nfunction PresentValue(ARate: double; NPeriods: Integer;\r\n  APayment, AFutureValue: double; APaymentTime: TPaymentTime): double;\r\n\r\n// Miscellaneous\r\n\r\nfunction IfThen(val:boolean;const ifTrue:integer; const ifFalse:integer= 0) :integer; overload;\r\nfunction IfThen(val:boolean;const ifTrue:double ; const ifFalse:double =0.0):double; overload;\r\n\r\nType\r\n  TValueRelationship = -1..1;\r\n\r\nconst\r\n  EqualsValue = 0;\r\n  LessThanValue = Low(TValueRelationship);\r\n  GreaterThanValue = High(TValueRelationship);\r\n\r\nfunction CompareValue ( const A, B  : Integer) : TValueRelationship;\r\nfunction CompareValue ( const A, B  : NativeLargeInt) : TValueRelationship;\r\nfunction CompareValue ( const A, B  : NativeLargeUInt) : TValueRelationship;\r\nfunction CompareValue ( const A, B : Double; delta : Double = 0.0) : TValueRelationship;\r\n\r\nfunction MinValue(const Data: array of Double): Double;\r\nfunction MaxValue(const Data: array of Double): Double; overload;\r\n\r\nimplementation\r\n\r\nfunction MinValue(const Data: array of Double): Double;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := Data[Low(Data)];\r\n  for I := Low(Data) + 1 to High(Data) do\r\n    if Result > Data[I] then\r\n      Result := Data[I];\r\nend;\r\n\r\nfunction MaxValue(const Data: array of Double): Double;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := Data[Low(Data)];\r\n  for I := Low(Data) + 1 to High(Data) do\r\n    if Result < Data[I] then\r\n      Result := Data[I];\r\nend;\r\n\r\nfunction InRange(const AValue, AMin, AMax: Integer): Boolean; assembler;\r\nasm\r\n  return (AValue >= AMin) && (AValue <= AMax);\r\nend;\r\n\r\nfunction InRange(const AValue, AMin, AMax: Double): Boolean; assembler;\r\nasm\r\n  return (AValue >= AMin) && (AValue <= AMax);\r\nend;\r\n\r\nfunction EnsureRange(const AValue, AMin, AMax: Integer): Integer; assembler;\r\nasm\r\n  if (AValue<AMin){ return AMin;\r\n  } else if (AValue>AMax){ return AMax;\r\n  } else return AValue;\r\nend;\r\n\r\nfunction EnsureRange(const AValue, AMin, AMax: Double): Double; assembler;\r\nasm\r\n  if (AValue<AMin){ return AMin;\r\n  } else if (AValue>AMax){ return AMax;\r\n  } else return AValue;\r\nend;\r\n\r\nfunction RoundTo(const AValue: Double; const Digits: TRoundToRange): Double;\r\nvar\r\n  RV : Double;\r\n\r\nbegin\r\n  RV:=IntPower(10,Digits);\r\n  Result:=Round(AValue/RV)*RV;\r\nend;\r\n\r\nfunction SimpleRoundTo(const AValue: Double; const Digits: TRoundToRange): Double;\r\nvar\r\n  RV : Double;\r\n\r\nbegin\r\n  RV := IntPower(10, -Digits);\r\n  if AValue < 0 then\r\n    Result := Int((AValue*RV) - 0.5)/RV\r\n  else\r\n    Result := Int((AValue*RV) + 0.5)/RV;\r\nend;\r\n\r\nfunction randg(mean,stddev : float) : float;\r\n\r\nVar\r\n  U1,S2 : Float;\r\n\r\nbegin\r\n  repeat\r\n    u1:= 2*random-1;\r\n    S2:=Sqr(U1)+sqr(2*random-1);\r\n  until s2<1;\r\n  Result:=Sqrt(-2*ln(S2)/S2)*u1*stddev+Mean;\r\nend;\r\n\r\n\r\nfunction RandomRange(const aFrom, aTo: Integer): Integer;\r\nbegin\r\n  Result:=Random(Abs(aFrom-aTo))+Min(aTo,AFrom);\r\nend;\r\n\r\n\r\nfunction RandomRange(const aFrom, aTo: NativeLargeInt): NativeLargeInt;\r\n\r\nVar\r\n  m : NativeLargeInt;\r\nbegin\r\n  if aFrom<aTo then\r\n    M:=aFrom\r\n  else\r\n    M:=aTo;\r\n  Result:=Random(Abs(aFrom-aTo))+M;\r\nend;\r\n\r\nconst\r\n  DZeroResolution = 1E-12;\r\n\r\nfunction IsZero(const d: Double; Epsilon: Double): Boolean;\r\nbegin\r\n  if Epsilon=0 then\r\n    Epsilon:=DZeroResolution;\r\n  Result:=Abs(d)<=Epsilon;\r\nend;\r\n\r\nfunction IsZero(const d: Double): Boolean;\r\nbegin\r\n  Result:=Abs(d)<=DZeroResolution;\r\nend;\r\n\r\nfunction IsInfinite(const d: JSValue): Boolean; assembler;\r\nasm\r\n  return (d==Infinity) || (d==-Infinity);\r\nend;\r\n\r\nfunction SameValue(const A, B: Double; Epsilon: Double): Boolean;\r\nbegin\r\n  if (Epsilon=0.0) then\r\n    Epsilon:=Max(Min(Abs(A),Abs(B))*DZeroResolution,DZeroResolution);\r\n  if (A>B) then\r\n    Result:=((A-B)<=Epsilon)\r\n  else\r\n    Result:=((B-A)<=Epsilon);\r\nend;\r\n\r\nfunction JSFloor(const A: Double): Double; external name 'Math.floor';\r\nfunction JSCeil(const A: Double): Double; external name 'Math.ceil';\r\n\r\nfunction Ceil(const A: Double): Integer;\r\n\r\nbegin\r\n  // TODO: add Range check ?\r\n  Result:=trunc(JSCeil(a));\r\nend;\r\n\r\nfunction Floor(const A: Double): Integer;\r\n\r\nbegin\r\n  // TODO: add Range check ?\r\n  Result:=trunc(JSFloor(a));\r\nend;\r\n\r\nfunction Ceil64(const A: Double): NativeLargeInt;\r\n\r\nbegin\r\n  Result:=trunc(JSCeil(a));\r\nend;\r\n\r\nfunction Floor64(const A: Double): NativeLargeInt;\r\n\r\nbegin\r\n  Result:=trunc(JSCeil(a));\r\nend;\r\n\r\nprocedure Frexp(X: double; out Mantissa: double; out Exponent: integer);\r\n\r\nbegin\r\n  Exponent:=0;\r\n  if (X<>0) then\r\n    if (abs(X)<0.5) then\r\n      repeat\r\n        X:=X*2;\r\n        Dec(Exponent);\r\n      until (abs(X)>=0.5)\r\n    else\r\n      while (abs(X)>=1) do\r\n        begin\r\n        X:=X/2;\r\n        Inc(Exponent);\r\n        end;\r\n  Mantissa:=X;\r\nend;\r\n\r\nprocedure SinCos(const A: Double; var B: Double; var C: Double);\r\nbegin\r\n  B:=Sin(A);\r\n  C:=Cos(A);\r\nend;\r\n\r\nfunction LogN(const Base, A: Double): Double;\r\n\r\nbegin\r\n  Result:=Ln(A)/Ln(Base);\r\nend;\r\n\r\nfunction lnxp1(x: double): double;\r\n\r\nvar\r\n  y: float;\r\n\r\nbegin\r\n  if (x>=4.0) then\r\n    result:=ln(1.0+x)\r\n  else\r\n    begin\r\n    y:=1.0+x;\r\n    if (y=1.0) then\r\n      result:=x\r\n    else\r\n      begin\r\n      result:=ln(y);     { lnxp1(-1) = ln(0) = -Inf }\r\n      if y>0.0 then\r\n        result:=result+(x-(y-1.0))/y;\r\n      end;\r\n    end;\r\nend;\r\n\r\nfunction ldexp(x : double;const p : Integer) : double;\r\n\r\nbegin\r\n   result:=x*intpower(2.0,p);\r\nend;\r\n\r\n\r\nfunction IntPower(base: float; const exponent: Integer): double;\r\n\r\nvar\r\n  i : longint;\r\n\r\nbegin\r\n  if (base = 0.0) and (exponent = 0) then\r\n    result:=1\r\n  else\r\n    begin\r\n    i:=abs(exponent);\r\n    Result:=1.0;\r\n    while i>0 do\r\n      begin\r\n      while (i and 1)=0 do\r\n        begin\r\n        i:=i shr 1;\r\n        base:=sqr(base);\r\n        end;\r\n      i:=i-1;\r\n      Result:=Result*base;\r\n      end;\r\n    if exponent<0 then\r\n      Result:=1.0/Result;\r\n    end;\r\nend;\r\n\r\nprocedure DivMod(Dividend: LongInt; Divisor: Word; out Result, Remainder: Word);\r\nbegin\r\n  if Dividend < 0 then\r\n    begin\r\n    Dividend:=-Dividend;\r\n    Result:=-(Dividend Div Divisor);\r\n    Remainder:=-(Dividend+(Result*Divisor));\r\n    end\r\n  else\r\n    begin\r\n    Result:=Dividend Div Divisor;\r\n    Remainder:=Dividend-(Result*Divisor);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure DivMod(Dividend: LongInt; Divisor: Word; out Result,\r\n  Remainder: SmallInt);\r\nbegin\r\n  if Dividend < 0 then\r\n    begin\r\n    Dividend:=-Dividend;\r\n    Result:=-(Dividend Div Divisor);\r\n    Remainder:=-(Dividend+(Result*Divisor));\r\n    end\r\n  else\r\n    begin\r\n    Result:=Dividend Div Divisor;\r\n    Remainder:=Dividend-(Result*Divisor);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure DivMod(Dividend: DWord; Divisor: DWord; out Result, Remainder: DWord);\r\nbegin\r\n  Result:=Dividend Div Divisor;\r\n  Remainder:=Dividend-(Result*Divisor);\r\nend;\r\n\r\n\r\nprocedure DivMod(Dividend: LongInt; Divisor: LongInt; out Result,\r\n  Remainder: LongInt);\r\n\r\nbegin\r\n  if Dividend < 0 then\r\n    begin\r\n    Dividend:=-Dividend;\r\n    Result:=-(Dividend Div Divisor);\r\n    Remainder:=-(Dividend+(Result*Divisor));\r\n    end\r\n  else\r\n    begin\r\n    Result:=Dividend Div Divisor;\r\n    Remainder:=Dividend-(Result*Divisor);\r\n    end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Angle conversion\r\n  ---------------------------------------------------------------------}\r\nfunction DegToRad(deg: double): double;\r\n\r\nbegin\r\n  Result:=deg*(pi/180.0);\r\nend;\r\n\r\n\r\nfunction RadToDeg(rad: double): double;\r\n\r\nbegin\r\n  Result:=rad*(180.0/pi);\r\nend;\r\n\r\n\r\nfunction GradToRad(grad: double): double;\r\n\r\nbegin\r\n  Result:=grad*(pi/200.0);\r\nend;\r\n\r\n\r\nfunction RadToGrad(rad: double): double;\r\n\r\nbegin\r\n  Result:=rad*(200.0/pi);\r\nend;\r\n\r\n\r\nfunction DegToGrad(deg: double): double;\r\n\r\nbegin\r\n  Result:=deg*(200.0/180.0);\r\nend;\r\n\r\n\r\nfunction GradToDeg(grad: double): double;\r\n\r\nbegin\r\n  Result:=grad*(180.0/200.0);\r\nend;\r\n\r\n\r\nfunction CycleToRad(cycle: double): double;\r\n\r\nbegin\r\n  Result:=(2*pi)*cycle;\r\nend;\r\n\r\n\r\nfunction RadToCycle(rad: double): double;\r\n\r\nbegin\r\n  Result:=rad*(1/(2*pi));\r\nend;\r\n\r\n\r\nfunction DegNormalize(deg: double): double;\r\n\r\nbegin\r\n  Result:=Deg-Int(Deg/360)*360;\r\n  If (Result<0) then Result:=Result+360;\r\nend;\r\n\r\nfunction sumofsquares(const data : array of double) : double;\r\nvar\r\n  i,N : longint;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  Result:=0.0;\r\n  for i:=0 to N-1 do\r\n    Result:=Result+sqr(data[i]);\r\nend;\r\n\r\nfunction Norm(const data: array of double): double;\r\nbegin\r\n  Result:=sqrt(sumofsquares(data));\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Statistical functions\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction Sum(const data: array of double): double;\r\n\r\nvar\r\n  i,N : longint;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  Result:=0.0;\r\n  for i:=0 to N-1 do\r\n    Result:=Result+data[i];\r\nend;\r\n\r\nfunction Mean(const data: array of double): double;\r\n\r\nVar\r\n  N : integer;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  if N=0 then\r\n    Result:=0\r\n  else\r\n    Result:=Sum(Data)/N;\r\nend;\r\nprocedure SumsAndSquares(const data: array of Double; out Sum,\r\n  SumOfSquares: double);\r\n\r\nvar\r\n  i,n : Integer;\r\n  t,s,ss: double;\r\n\r\nbegin\r\n  n:=length(Data);\r\n  ss:=0.0; // Use local vars, var is very inefficient in js\r\n  s:=0.0;\r\n  for i:=0 to N-1 do\r\n    begin\r\n    t:=data[i];\r\n    ss:=ss+sqr(t);\r\n    s:=s+t;\r\n    end;\r\n  Sum:=s;\r\n  SumOfSquares:=ss;\r\nend;\r\n\r\nfunction StdDev(const data: array of Double): float;\r\n\r\nbegin\r\n  Result:=Sqrt(Variance(Data));\r\nend;\r\n\r\nfunction Variance(const data: array of Double): double;\r\n\r\nvar\r\n  n : integer;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  If N=1 then\r\n    Result:=0\r\n  else\r\n    Result:=TotalVariance(Data)/(N-1);\r\nend;\r\n\r\nfunction TotalVariance(const data: array of Double): double;\r\n\r\nvar\r\n  S,SS : Float;\r\n  N : integer;\r\nbegin\r\n  N:=Length(Data);\r\n  If Length(Data)=1 then\r\n    Result:=0\r\n  else\r\n    begin\r\n    SumsAndSquares(Data,S,SS);\r\n    Result := SS-Sqr(S)/N;\r\n    end;\r\nend;\r\n\r\nprocedure MeanAndStdDev(const data: array of Double; out Mean, StdDev: double);\r\n\r\nVar\r\n  I,N : longint;\r\n  M,S : Double;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  M:=0;\r\n  S:=0;\r\n  For I:=0 to N-1 do\r\n    begin\r\n    M:=M+Data[i];\r\n    S:=S+Sqr(Data[i]);\r\n    end;\r\n  M:=M/N;\r\n  S:=(S-N*Sqr(M));\r\n  If N>1 then\r\n    S:=Sqrt(S/(N-1))\r\n  else\r\n    S:=0;\r\n  Mean:=M;\r\n  StdDev:=S;\r\nend;\r\n\r\nfunction PopNStdDev(const data : array of Double) : double;\r\n\r\nbegin\r\n  Result:=Sqrt(PopnVariance(Data));\r\nend;\r\n\r\nfunction PopNVariance(const data : array of Double) : double;\r\n\r\nVar\r\n  N : integer;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  if N=0 then\r\n    Result:=0\r\n  else\r\n    Result:=TotalVariance(Data)/N;\r\nend;\r\n\r\nprocedure MomentSkewKurtosis(const data: array of Double; out m1, m2, m3, m4, skew, kurtosis: double);\r\n\r\nvar\r\n  i,N: integer;\r\n  deviation, deviation2: double;\r\n  reciprocalN: float;\r\n  // Use local vars for all calculations, var is very slow\r\n  lm1, lm2, lm3, lm4, lskew, lkurtosis: double;\r\n\r\nbegin\r\n  N:=length(Data);\r\n  lm1 := 0;\r\n  reciprocalN := 1/N;\r\n  for i := 0 to N-1 do\r\n    lm1 := lm1 + data[i];\r\n  lm1 := reciprocalN * lm1;\r\n\r\n  lm2 := 0;\r\n  lm3 := 0;\r\n  lm4 := 0;\r\n  for i := 0 to N-1 do\r\n    begin\r\n    deviation := (data[i]-lm1);\r\n    deviation2 := deviation * deviation;\r\n    lm2 := lm2 + deviation2;\r\n    lm3 := lm3 + deviation2 * deviation;\r\n    lm4 := lm4 + deviation2 * deviation2;\r\n    end;\r\n  lm2 := reciprocalN * lm2;\r\n  lm3 := reciprocalN * lm3;\r\n  lm4 := reciprocalN * lm4;\r\n\r\n  lskew := lm3 / (sqrt(lm2)*lm2);\r\n  lkurtosis := lm4 / (lm2 * lm2);\r\n\r\n  m1:=lm1;\r\n  m2:=lm2;\r\n  m3:=lm3;\r\n  m4:=lm4;\r\n  skew:=lskew;\r\n  kurtosis:=lkurtosis;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Financial functions\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction FutureValue(ARate: double; NPeriods: Integer;\r\n  APayment, APresentValue: double; APaymentTime: TPaymentTime): double;\r\nvar\r\n  q, qn, factor: double;\r\nbegin\r\n  if ARate = 0 then\r\n    Result := -APresentValue - APayment * NPeriods\r\n  else begin\r\n    q := 1.0 + ARate;\r\n    qn := power(q, NPeriods);\r\n    factor := (qn - 1) / (q - 1);\r\n    if APaymentTime = ptStartOfPeriod then\r\n      factor := factor * q;\r\n    Result := -(APresentValue * qn + APayment*factor);\r\n  end;\r\nend;\r\n\r\nfunction InterestRate(NPeriods: Integer; APayment, APresentValue, AFutureValue: double;\r\n  APaymentTime: TPaymentTime): double;\r\n{ The interest rate cannot be calculated analytically. We solve the equation\r\n  numerically by means of the Newton method:\r\n  - guess value for the interest reate\r\n  - calculate at which interest rate the tangent of the curve fv(rate)\r\n    (straight line!) has the requested future vale.\r\n  - use this rate for the next iteration. }\r\nconst\r\n  DELTA = 0.001;\r\n  EPS = 1E-9;   // required precision of interest rate (after typ. 6 iterations)\r\n  MAXIT = 20;   // max iteration count to protect agains non-convergence\r\nvar\r\n  r1, r2, dr: double;\r\n  fv1, fv2: double;\r\n  iteration: Integer;\r\nbegin\r\n  iteration := 0;\r\n  r1 := 0.05;  // inital guess\r\n  repeat\r\n    r2 := r1 + DELTA;\r\n    fv1 := FutureValue(r1, NPeriods, APayment, APresentValue, APaymentTime);\r\n    fv2 := FutureValue(r2, NPeriods, APayment, APresentValue, APaymentTime);\r\n    dr := (AFutureValue - fv1) / (fv2 - fv1) * delta;  // tangent at fv(r)\r\n    r1 := r1 + dr;      // next guess\r\n    inc(iteration);\r\n  until (abs(dr) < EPS) or (iteration >= MAXIT);\r\n  Result := r1;\r\nend;\r\n\r\nfunction NumberOfPeriods(ARate, APayment, APresentValue, AFutureValue: double;\r\n  APaymentTime: TPaymentTime): double;\r\n{ Solve the cash flow equation (1) for q^n and take the logarithm }\r\nvar\r\n  q, x1, x2: double;\r\nbegin\r\n  if ARate = 0 then\r\n    Result := -(APresentValue + AFutureValue) / APayment\r\n  else begin\r\n    q := 1.0 + ARate;\r\n    if APaymentTime = ptStartOfPeriod then\r\n      APayment := APayment * q;\r\n    x1 := APayment - AFutureValue * ARate;\r\n    x2 := APayment + APresentValue * ARate;\r\n    if   (x2 = 0)                    // we have to divide by x2\r\n      or (sign(x1) * sign(x2) < 0)   // the argument of the log is negative\r\n    then\r\n      Result := Infinity\r\n    else begin\r\n      Result := ln(x1/x2) / ln(q);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction Payment(ARate: double; NPeriods: Integer;\r\n  APresentValue, AFutureValue: double; APaymentTime: TPaymentTime): double;\r\nvar\r\n  q, qn, factor: double;\r\nbegin\r\n  if ARate = 0 then\r\n    Result := -(AFutureValue + APresentValue) / NPeriods\r\n  else begin\r\n    q := 1.0 + ARate;\r\n    qn := power(q, NPeriods);\r\n    factor := (qn - 1) / (q - 1);\r\n    if APaymentTime = ptStartOfPeriod then\r\n      factor := factor * q;\r\n    Result := -(AFutureValue + APresentValue * qn) / factor;\r\n  end;\r\nend;\r\n\r\nfunction PresentValue(ARate: double; NPeriods: Integer;\r\n  APayment, AFutureValue: double; APaymentTime: TPaymentTime): double;\r\nvar\r\n  q, qn, factor: double;\r\nbegin\r\n  if ARate = 0.0 then\r\n    Result := -AFutureValue - APayment * NPeriods\r\n  else begin\r\n    q := 1.0 + ARate;\r\n    qn := power(q, NPeriods);\r\n    factor := (qn - 1) / (q - 1);\r\n    if APaymentTime = ptStartOfPeriod then\r\n      factor := factor * q;\r\n    Result := -(AFutureValue + APayment*factor) / qn;\r\n  end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Miscellaneous\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction IfThen(val: boolean; const ifTrue: integer; const ifFalse: integer): integer;\r\n\r\nbegin\r\n  if val then result:=iftrue else result:=iffalse;\r\nend;\r\n\r\nfunction IfThen(val: boolean; const ifTrue: double; const ifFalse: double): double;\r\n\r\nbegin\r\n  if val then result:=iftrue else result:=iffalse;\r\nend;\r\n\r\nfunction CompareValue(const A, B  : Integer): TValueRelationship;\r\n\r\nbegin\r\n  result:=GreaterThanValue;\r\n  if a=b then\r\n    result:=EqualsValue\r\n  else\r\n   if a<b then\r\n     result:=LessThanValue;\r\nend;\r\n\r\nfunction CompareValue(const A, B: NativeLargeInt): TValueRelationship;\r\n\r\nbegin\r\n  result:=GreaterThanValue;\r\n  if a=b then\r\n    result:=EqualsValue\r\n  else\r\n   if a<b then\r\n     result:=LessThanValue;\r\nend;\r\n\r\nfunction CompareValue(const A, B: NativeLargeUInt): TValueRelationship;\r\n\r\nbegin\r\n  result:=GreaterThanValue;\r\n  if a=b then\r\n    result:=EqualsValue\r\n  else\r\n   if a<b then\r\n     result:=LessThanValue;\r\nend;\r\n\r\nfunction CompareValue(const A, B: Double; delta: Double): TValueRelationship;\r\nbegin\r\n  result:=GreaterThanValue;\r\n  if abs(a-b)<=delta then\r\n    result:=EqualsValue\r\n  else\r\n   if a<b then\r\n     result:=LessThanValue;\r\nend;\r\n\r\nend.\r\n\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            Copyright (c) 2019 - 2022                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Utils;\r\n\r\ninterface\r\n\r\nuses\r\n  Types, Web, SysUtils, Math, Classes, JS;\r\n\r\nconst\r\n  DayMonday = 1;\r\n  DayTuesday = 2;\r\n  DayWednesday = 3;\r\n  DayThursday = 4;\r\n  DayFriday = 5;\r\n  DaySaturday = 6;\r\n  DaySunday = 7;\r\n\r\n  MonthJanuary = 1;\r\n  MonthFebruary = 2;\r\n  MonthMarch = 3;\r\n  MonthApril = 4;\r\n  MonthMay = 5;\r\n  MonthJune = 6;\r\n  MonthJuly = 7;\r\n  MonthAugust = 8;\r\n  MonthSeptember = 9;\r\n  MonthOctober = 10;\r\n  MonthNovember = 11;\r\n  MonthDecember = 12;\r\n\r\ntype\r\n  TInterfaceList = class;\r\n\r\n  TProc = Types.TProc;\r\n  TProcBoolean = reference to procedure(AValue: Boolean);\r\n  TProcInteger = reference to procedure(AValue: Integer);\r\n  TProcString = Types.TProcString;\r\n\r\n  EConvertError = SysUtils.EConvertError;\r\n\r\n  EEncodingError = class(Exception);\r\n\r\n  EStreamError = Classes.EStreamError;\r\n  EStringStreamError = class(EStreamError);\r\n  EFilerError = Classes.EFilerError;\r\n  EReadError = Classes.EReadError;\r\n  EWriteError = Classes.EWriteError;\r\n\r\n  TBytesHelper = record helper for TBytes\r\n  strict private\r\n    function get_Length: Integer;\r\n    procedure set_Length(const AValue: Integer);\r\n  public\r\n    function Compare(const ARight: TBytes): Integer;\r\n    function High: Integer;\r\n    function Low: Integer;\r\n    function SubBytes(const AStartIndex: Integer): TBytes; overload; inline;\r\n    function SubBytes(const AStartIndex, ALength: Integer): TBytes; overload; inline;\r\n    property Length: Integer read get_Length write set_Length;\r\n  end;\r\n\r\n  TWords = array of Word;\r\n  TWordsHelper = record helper for TWords\r\n  strict private\r\n    function get_Length: Integer;\r\n    procedure set_Length(const AValue: Integer);\r\n  public\r\n    class function FromBytes(const ABytes: TBytes): TWords; static;\r\n    function High: Integer;\r\n    function Low: Integer;\r\n    function ToBytes: TBytes;\r\n    property Length: Integer read get_Length write set_Length;\r\n  end;\r\n\r\n  TCharHelper = record helper for Char\r\n  public const\r\n    Length = 1;\r\n    Size = 2;\r\n  public\r\n    function IsDigit: Boolean;\r\n    function ToOrd: Integer;\r\n    function ToUpper: Char; overload;\r\n    class function ToUpper(const AValue: Char): Char; overload; assembler; static;\r\n  end;\r\n\r\n  TIntegerHelper = record helper for Integer\r\n  public\r\n    function Equals(const AValue: Integer): Boolean; inline;\r\n    function NotEquals(const AValue: Integer): Boolean; inline;\r\n    class function Parse(const AValue: string): Integer; static;\r\n    function ToString: string; overload;\r\n    class function ToString(const AValue: Integer): string; overload; assembler; static;\r\n    class function TryParse(const AString: string; out AValue: Integer): Boolean; static; inline;\r\n  end;\r\n\r\n  TLongIntHelper = record helper for LongInt\r\n  public\r\n    function Equals(const AValue: LongInt): Boolean; inline;\r\n    function NotEquals(const AValue: LongInt): Boolean; inline;\r\n    class function Parse(const AValue: string): Integer; static;\r\n    function ToString: string; overload;\r\n    class function ToString(const AValue: LongInt): string; overload; assembler; static;\r\n    class function TryParse(const AString: string; out AValue: Integer): Boolean; static; inline;\r\n  end;\r\n\r\n  TWordHelper = record helper for Word\r\n  public\r\n    class function FromBytes(const ALow, AHigh: Byte): Word; static;\r\n    procedure ToBytes(out ALow, AHigh: Byte);\r\n  end;\r\n\r\n  TStringHelper = record helper for string\r\n  strict private\r\n    function get_Chars(const AIndex: Integer): Char; inline;\r\n    function get_Length: Integer; inline;\r\n    function Pos(const ASubStr, AStr: string; const AOffset: Integer): Integer;\r\n    function Reverse: string;\r\n    procedure set_Chars(const AIndex: Integer; const AValue: Char); inline;\r\n    procedure set_Length(const AValue: Integer); inline;\r\n  public const\r\n    Empty = '';\r\n  public\r\n    function CompareTo(const AValue: string): Integer; overload;\r\n    class function CompareTo(const ALeft, ARight: string): Integer; overload; assembler; static;\r\n    function Contains(const AValue: string): Boolean;\r\n    function Equals(const AValue: string): Boolean;\r\n    function FirstChar: Char;\r\n    function Format(const AArgs: array of const): string; overload;\r\n    class function Format(const AValue: string; const AArgs: array of const): string; overload; static;\r\n    function High: Integer; overload; inline;\r\n    function IndexOf(const AValue: Char): Integer; overload; inline;\r\n    function IndexOf(const AValue: string; const AStartIndex, ACount: Integer): Integer; overload;\r\n    function IndexOf(const AValue: string): Integer; overload; inline;\r\n    function Insert(const AStartIndex: Integer; const AValue: string): string;\r\n    function IsEmpty: Boolean; inline;\r\n    function IsNumber: Boolean;\r\n    function LastIndexOf(const AValue: Char): Integer; overload; inline;\r\n    class function Low: Integer; static; inline;\r\n    function NotEquals(const AValue: string): Boolean;\r\n    function NotIsEmpty: Boolean; inline;\r\n    function PadLeft(const ATotalWidth: Integer): string; overload; inline;\r\n    function PadLeft(ATotalWidth: Integer; const APaddingChar: Char): string; overload; inline;\r\n    function Remove(const AStartIndex: Integer): string; overload; inline;\r\n    function Remove(const AStartIndex, ACount: Integer): string; overload; inline;\r\n    function Replace(const AOldValue: string; const ANewValue: string): string; overload;\r\n    function Same(const AValue: string): Boolean; inline;\r\n    class function StartsText(const ASubText, AText: string): Boolean; static;\r\n    function StartsWith(const AValue: string): Boolean; overload; inline;\r\n    function StartsWith(const AValue: string; AIgnoreCase: Boolean): Boolean; overload;\r\n    function Substring(const AStartIndex: Integer): string; overload; inline;\r\n    function Substring(const AStartIndex, ALength: Integer): string; overload; inline;\r\n    function ToLower: string;\r\n    function ToUpper: string;\r\n    function Trim: string;\r\n    property Chars[const AIndex: Integer]: Char read get_Chars write set_Chars;\r\n    property Length: Integer read get_Length write set_Length;\r\n  end;\r\n\r\n  TDateTimeHelper = record helper for TDateTime\r\n  public\r\n    function Equals(const AValue: TDateTime): Boolean; inline;\r\n    function NotEquals(const AValue: TDateTime): Boolean; inline;\r\n    function ToString: string; inline;\r\n  end;\r\n\r\n  TMonthNameArray = SysUtils.TMonthNameArray;\r\n  TMonthNames = SysUtils.TMonthNames;\r\n  TDayNames = SysUtils.TDayNames;\r\n\r\n  TFormatSettings = SysUtils.TFormatSettings;\r\n\r\n  TTMSEncoding = class(TObject)\r\n  strict private class var\r\n    FANSI: TTMSEncoding;\r\n    FUnicode: TTMSEncoding;\r\n  strict private\r\n    class function get_ANSI: TTMSEncoding; static;\r\n    class function get_Default: TTMSEncoding; static;\r\n    class function get_Unicode: TTMSEncoding; static;\r\n  public\r\n    function GetByteCount(const AChars: string): Integer; overload; virtual; abstract;\r\n    function GetByteCount(const AChars: string; const ACharCount: Integer): Integer; overload;\r\n    function GetByteCount(const AChars: string; const ACharIndex, ACharCount: Integer): Integer; overload; inline;\r\n    function GetBytes(const AChars: string): TBytes; overload; virtual; abstract;\r\n    function GetBytes(const AChars: string; const ACharCount: Integer): TBytes; overload;\r\n    function GetBytes(const AChars: string; const ACharIndex, ACharCount: Integer): TBytes; overload; inline;\r\n    function GetString(const ABytes: TBytes): string; overload; virtual; abstract;\r\n    function GetString(const ABytes: TBytes; const ACharCount: Integer): string; overload;\r\n    function GetString(const ABytes: TBytes; const ACharIndex, ACharCount: Integer): string; overload; inline;\r\n    class function IsStandardEncoding(AEncoding: TTMSEncoding): Boolean; static;\r\n    class property ANSI: TTMSEncoding read get_ANSI;\r\n    class property Default: TTMSEncoding read get_Default;\r\n    class property Unicode: TTMSEncoding read get_Unicode;\r\n  end;\r\n\r\n  TANSIEncoding = class(TTMSEncoding)\r\n  public\r\n    function GetByteCount(const AChars: string): Integer; overload; override;\r\n    function GetBytes(const AChars: string): TBytes; overload; override;\r\n    function GetString(const ABytes: TBytes): string; overload; override;\r\n  end;\r\n\r\n  TUnicodeEncoding = class(TTMSEncoding)\r\n  strict private\r\n    procedure InternalGetBytes(const AChars: string; out ABytes: TBytes);\r\n  public\r\n    function GetByteCount(const AChars: string): Integer; overload; override;\r\n    function GetBytes(const AChars: string): TBytes; overload; override;\r\n    function GetString(const ABytes: TBytes): string; overload; override;\r\n  end;\r\n\r\n  TStreamHelper = class helper for TStream\r\n  public\r\n    function CopyFrom(const ASource: TStream; ACount: Int64): Int64;\r\n  end;\r\n\r\n  TTMSStringStream = class(TBytesStream)\r\n  private\r\n    FEncoding: TTMSEncoding;\r\n    FFileName: string;\r\n    FOwnsEncoding: Boolean;\r\n    FError: TProcString;\r\n    FLoaded: TProc;\r\n    FRequest: TJSXMLHTTPRequest;\r\n    function GetDataString: string;\r\n    function InternalLoadFromFileP(const AFileName: string): TJSPromise;\r\n    function OnAbort(AEvent: TEventListenerEvent): Boolean;\r\n    function OnError(AEvent: TEventListenerEvent): Boolean;\r\n    function OnLoad(AEvent: TEventListenerEvent): Boolean;\r\n  public\r\n    constructor Create; overload;\r\n    constructor Create(const AString: string); overload;\r\n    constructor Create(const AString: string; AEncoding: TTMSEncoding; AOwnsEncoding: Boolean = True); overload;\r\n    destructor Destroy; override;\r\n    procedure LoadFromFile(const AFileName: string); overload;\r\n    procedure LoadFromFile(const AFileName: string; const ALoaded: TProc); overload;\r\n    procedure LoadFromFile(const AFileName: string; const ALoaded: TProc; const AError: TProcString); overload; reintroduce;\r\n    function LoadFromFileP(const AFileName: string): Boolean; async;\r\n    function ReadString(ACount: Integer): string;\r\n    procedure WriteString(const AString: string);\r\n    property DataString: string read GetDataString;\r\n  end;\r\n\r\n  IInterfaceList = interface\r\n  ['{285DEA8A-B865-11D1-AAA7-00C04FB17A72}']\r\n    function Add(const AItem: IInterface): Integer;\r\n    procedure Clear;\r\n    procedure Delete(const AIndex: Integer);\r\n    procedure Exchange(const AIndex1, AIndex2: Integer);\r\n    function Expand: TInterfaceList;\r\n    function First: IInterface;\r\n    function get_Capacity: Integer;\r\n    function get_Count: Integer;\r\n    function get_Items(const AIndex: Integer): IInterface;\r\n    function IndexOf(const AItem: IInterface): Integer;\r\n    function IndexOfItem(const AItem: IInterface; const ADirection: TDirection): Integer;\r\n    procedure Insert(const AIndex: Integer; const AItem: IInterface);\r\n    function Last: IInterface;\r\n    procedure Lock;\r\n    function Remove(const AItem: IInterface): Integer;\r\n    function RemoveItem(const AItem: IInterface; const ADirection: TDirection): Integer;\r\n    procedure set_Capacity(const AValue: Integer);\r\n    procedure set_Count(const AValue: Integer);\r\n    procedure set_Items(const AIndex: Integer; const AItem: IInterface);\r\n    procedure Unlock;\r\n    property Count: Integer read get_Count write set_Count;\r\n    property Items[const AIndex: Integer]: IInterface read get_Items write set_Items; default;\r\n  end;\r\n\r\n  TInterfaceListEnumerator = class(TObject)\r\n  strict private\r\n    FIndex: Integer;\r\n    FInterfaceList: TInterfaceList;\r\n    function get_Current: IInterface; inline;\r\n  public\r\n    constructor Create(const AInterfaceList: TInterfaceList);\r\n    function MoveNext: Boolean;\r\n    property Current: IInterface read get_Current;\r\n  end;\r\n\r\n  IInterfaceListEx = interface(IInterfaceList)\r\n    ['{FDB39D70-65B9-4995-9436-6084ACA05DB3}']\r\n    function GetEnumerator: TInterfaceListEnumerator;\r\n  end;\r\n\r\n  TCompareItems = reference to function(const ALeft, ARight: IInterface): TValueRelationship;\r\n\r\n  IInterfaceListEx2 = interface(IInterfaceList)\r\n    ['{4FE71218-0F8F-4027-B050-5E84E2202604}']\r\n    procedure Sort(const ACompare: TCompareItems);\r\n  end;\r\n\r\n  TInterfaceList = class(TInterfacedObject, IInterfaceList, IInterfaceListEx, IInterfaceListEx2)\r\n  strict private\r\n    FList: TFPList;\r\n  strict protected\r\n    function Add(const AItem: IInterface): Integer;\r\n    procedure Clear;\r\n    procedure Delete(const AIndex: Integer);\r\n    procedure Exchange(const AIndex1, AIndex2: Integer);\r\n    function Expand: TInterfaceList;\r\n    function First: IInterface;\r\n    function GetEnumerator: TInterfaceListEnumerator;\r\n    function get_Capacity: Integer;\r\n    function get_Count: Integer;\r\n    function get_Items(const AIndex: Integer): IInterface;\r\n    function IndexOf(const AItem: IInterface): Integer;\r\n    function IndexOfItem(const AItem: IInterface; const ADirection: TDirection): Integer;\r\n    procedure Insert(const AIndex: Integer; const AItem: IInterface);\r\n    function Last: IInterface;\r\n    procedure Lock;\r\n    function Remove(const AItem: IInterface): Integer;\r\n    function RemoveItem(const AItem: IInterface; const ADirection: TDirection): Integer;\r\n    procedure set_Capacity(const AValue: Integer);\r\n    procedure set_Count(const AValue: Integer);\r\n    procedure set_Items(const AIndex: Integer; const AItem: IInterface);\r\n    procedure Sort(const ACompare: TCompareItems);\r\n    procedure Unlock;\r\n    property Capacity: Integer read get_Capacity write set_Capacity;\r\n    property Items[const AIndex: Integer]: IInterface read get_Items write set_Items; default;\r\n  protected\r\n    property Count: Integer read get_Count write set_Count;\r\n  public\r\n    constructor Create;\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  TStringBuilder = class(TObject)\r\n  strict private\r\n    FData: string;\r\n    function get_Length: Integer;\r\n    procedure set_Length(const AValue: Integer);\r\n  public\r\n    constructor Create(const AValue: string); overload;\r\n    function Append(const AValue: Integer): TStringBuilder; overload;\r\n    function Append(const AValue: string): TStringBuilder; overload;\r\n    function Insert(const AIndex: Integer; const AValue: Integer): TStringBuilder; overload;\r\n    function Insert(const AIndex: Integer; const AValue: string): TStringBuilder; overload;\r\n    function ToString: string; overload; override;\r\n    property Length: Integer read get_Length write set_Length;\r\n  end;\r\n\r\nprocedure UseVariable(const AValue: IInterface); overload;\r\nprocedure UseVariable(const AValue: Integer); overload;\r\nprocedure UseVariable(const AValue: string); overload;\r\n\r\nfunction ArrayBufferToBase64(Buffer: TJSArrayBuffer): string;\r\nfunction Base64ToArrayBuffer(Base64: string): TJSArrayBuffer;\r\nfunction StringToBase64(AValue: string): string;\r\nfunction Base64ToString(AValue: string): string;\r\n\r\nfunction SizeOf(const AValue: Double): Integer; overload;\r\nfunction SizeOf(const AValue: Integer): Integer; overload;\r\n\r\nprocedure InsertAfter(newNode, referenceNode: TJSElement);\r\n\r\nfunction MatchStrEx(AValue1, AValue2: string; ACaseSensitive: Boolean = true): Boolean;\r\nfunction MatchStr(AValue1, AValue2:string; ACaseSensitive:Boolean = true):Boolean;\r\n\r\nprocedure SelectElementContents(AElement: TJSElement);\r\n\r\nfunction FormatProp(const AFmt: string; const AArgs: array of const): string;\r\n\r\nfunction StringIsFloat(N: string): boolean;\r\nfunction StringIsInteger(N: string): boolean;\r\n\r\nfunction MD5Hash(N: string): string;\r\n\r\nimplementation\r\n\r\nuses\r\n  RTLConsts, WEBLib.Consts;\r\n\r\nvar\r\n  FCompare: TCompareItems;\r\n\r\nprocedure UseVariable(const AValue: IInterface);\r\nbegin\r\nend;\r\n\r\nprocedure UseVariable(const AValue: Integer);\r\nbegin\r\nend;\r\n\r\nprocedure UseVariable(const AValue: string);\r\nbegin\r\nend;\r\n\r\n{ TBytesHelper }\r\n\r\nfunction TBytesHelper.Compare(const ARight: TBytes): Integer;\r\nvar\r\n  lCount: Integer;\r\nbegin\r\n  if Length > ARight.Length then\r\n    Exit(GreaterThanValue);\r\n\r\n  if Length < ARight.Length then\r\n    Exit(LessThanValue);\r\n\r\n  Result := EqualsValue;\r\n  for lCount := Low to High do\r\n  begin\r\n    if Self[lCount] > ARight[lCount] then\r\n      Exit(GreaterThanValue);\r\n    if Self[lCount] < ARight[lCount] then\r\n      Exit(LessThanValue);\r\n  end;\r\nend;\r\n\r\nfunction TBytesHelper.get_Length: Integer;\r\nbegin\r\n  Result := System.Length(Self);\r\nend;\r\n\r\nfunction TBytesHelper.High: Integer;\r\nbegin\r\n  Result := System.High(Self);\r\nend;\r\n\r\nfunction TBytesHelper.Low: Integer;\r\nbegin\r\n  Result := System.Low(Self);\r\nend;\r\n\r\nprocedure TBytesHelper.set_Length(const AValue: Integer);\r\nbegin\r\n  System.SetLength(Self, AValue);\r\nend;\r\n\r\nfunction TBytesHelper.SubBytes(const AStartIndex: Integer): TBytes;\r\nbegin\r\n  Result := System.Copy(Self, AStartIndex, Length);\r\nend;\r\n\r\nfunction TBytesHelper.SubBytes(const AStartIndex, ALength: Integer): TBytes;\r\nbegin\r\n  Result := System.Copy(Self, AStartIndex, ALength);\r\nend;\r\n\r\n{ TWordsHelper }\r\n\r\nclass function TWordsHelper.FromBytes(const ABytes: TBytes): TWords;\r\nconst\r\n  cBytesPerWord = 2;\r\nvar\r\n  lCount: Integer;\r\n  lLow: Byte;\r\n  lHigh: Byte;\r\nbegin\r\n  lCount := ABytes.Length;\r\n  if Odd(lCount) then\r\n    Inc(lCount);\r\n  Result.Length := lCount div cBytesPerWord;\r\n\r\n  lCount := ABytes.Low;\r\n  while lCount <= ABytes.High do\r\n  begin\r\n    lLow := ABytes[lCount];\r\n    if lCount + 1 <= ABytes.High then\r\n      lHigh := ABytes[lCount + 1]\r\n    else\r\n      lHigh := 0;\r\n\r\n    Result[lCount div cBytesPerWord] := Word.FromBytes(lLow, lHigh);\r\n    Inc(lCount, cBytesPerWord);\r\n  end;\r\n\r\nend;\r\n\r\nfunction TWordsHelper.get_Length: Integer;\r\nbegin\r\n  Result := System.Length(Self);\r\nend;\r\n\r\nfunction TWordsHelper.High: Integer;\r\nbegin\r\n  Result := System.High(Self);\r\nend;\r\n\r\nfunction TWordsHelper.Low: Integer;\r\nbegin\r\n  Result := System.Low(Self);\r\nend;\r\n\r\nprocedure TWordsHelper.set_Length(const AValue: Integer);\r\nbegin\r\n  System.SetLength(Self, AValue);\r\nend;\r\n\r\nfunction TWordsHelper.ToBytes: TBytes;\r\nconst\r\n  cBytesPerWord = 2;\r\nvar\r\n  lLow: Byte;\r\n  lHigh: Byte;\r\n  lCount: Integer;\r\n  lNewIndex: Integer;\r\nbegin\r\n  Result.Length := Length * cBytesPerWord;\r\n  for lCount := Low to High do\r\n  begin\r\n    Self[lCount].ToBytes(lLow, lHigh);\r\n    lNewIndex := lCount * cBytesPerWord;\r\n    Result[lNewIndex] := lLow;\r\n    Result[lNewIndex + 1] := lHigh;\r\n  end;\r\nend;\r\n\r\n{ TCharHelper }\r\n\r\nfunction TCharHelper.IsDigit: Boolean;\r\nconst\r\n  cNumChars = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];\r\nbegin\r\n  Result := Self in cNumChars;\r\nend;\r\n\r\nfunction TCharHelper.ToOrd: Integer;\r\nbegin\r\n  Result := Ord(Self);\r\nend;\r\n\r\nfunction TCharHelper.ToUpper: Char;\r\nbegin\r\n  Result := ToUpper(Self);\r\nend;\r\n\r\nclass function TCharHelper.ToUpper(const AValue: Char): Char; assembler;\r\nasm\r\n  return AValue.toUpperCase();\r\nend;\r\n\r\n{ TIntegerHelper }\r\n\r\nfunction TIntegerHelper.Equals(const AValue: Integer): Boolean;\r\nbegin\r\n  Result := Self = AValue;\r\nend;\r\n\r\nfunction TIntegerHelper.NotEquals(const AValue: Integer): Boolean;\r\nbegin\r\n  Result := not Equals(AValue);\r\nend;\r\n\r\nclass function TIntegerHelper.Parse(const AValue: string): Integer;\r\nbegin\r\n  Result := StrToInt(AValue);\r\nend;\r\n\r\nfunction TIntegerHelper.ToString: string;\r\nbegin\r\n  Result := ToString(Self);\r\nend;\r\n\r\nclass function TIntegerHelper.ToString(const AValue: Integer): string; assembler;\r\nasm\r\n  return AValue.toString();\r\nend;\r\n\r\nclass function TIntegerHelper.TryParse(const AString: string; out AValue: Integer): Boolean;\r\nbegin\r\n  Result := TryStrToInt(AString, AValue);\r\nend;\r\n\r\n{ TLongIntHelper }\r\n\r\nfunction TLongIntHelper.Equals(const AValue: LongInt): Boolean;\r\nbegin\r\n  Result := Self = AValue;\r\nend;\r\n\r\nfunction TLongIntHelper.NotEquals(const AValue: LongInt): Boolean;\r\nbegin\r\n  Result := not Equals(AValue);\r\nend;\r\n\r\nclass function TLongIntHelper.Parse(const AValue: string): Integer;\r\nbegin\r\n  Result := StrToInt(AValue);\r\nend;\r\n\r\nfunction TLongIntHelper.ToString: string;\r\nbegin\r\n  Result := ToString(Self);\r\nend;\r\n\r\nclass function TLongIntHelper.ToString(const AValue: LongInt): string;\r\nasm\r\n  return AValue.toString();\r\nend;\r\n\r\nclass function TLongIntHelper.TryParse(const AString: string; out AValue: Integer): Boolean;\r\nbegin\r\n  Result := TryStrToInt(AString, AValue);\r\nend;\r\n\r\n{ TWordHelper }\r\n\r\nclass function TWordHelper.FromBytes(const ALow, AHigh: Byte): Word;\r\nconst\r\n  cBitPerByte = 8;\r\nbegin\r\n  Result := ALow + (AHigh shl cBitPerByte);\r\nend;\r\n\r\nprocedure TWordHelper.ToBytes(out ALow, AHigh: Byte);\r\nconst\r\n  cMask: Byte = $FF;\r\n  cBitPerByte = 8;\r\nbegin\r\n  ALow := Self and cMask;\r\n  AHigh := (Self and (cMask shl cBitPerByte)) shr cBitPerByte;\r\nend;\r\n\r\n{ TStringHelper }\r\n\r\nfunction TStringHelper.CompareTo(const AValue: string): Integer;\r\nbegin\r\n  Result := CompareTo(Self, AValue);\r\nend;\r\n\r\nclass function TStringHelper.CompareTo(const ALeft, ARight: string): Integer; assembler;\r\nasm\r\n  return ALeft.localeCompare(ARight);\r\nend;\r\n\r\nfunction TStringHelper.Contains(const AValue: string): Boolean;\r\nbegin\r\n  Result := IndexOf(AValue) >= 0;\r\nend;\r\n\r\nfunction TStringHelper.Equals(const AValue: string): Boolean;\r\nbegin\r\n  Result := Self = AValue;\r\nend;\r\n\r\nfunction TStringHelper.FirstChar: Char;\r\nbegin\r\n  if NotIsEmpty then\r\n    Result := Chars[0]\r\n  else\r\n    Result := #0;\r\nend;\r\n\r\nfunction TStringHelper.Format(const AArgs: array of const): string;\r\nbegin\r\n  Result := SysUtils.Format(Self, AArgs);\r\nend;\r\n\r\nclass function TStringHelper.Format(const AValue: string; const AArgs: array of const): string;\r\nbegin\r\n  Result := SysUtils.Format(AValue, AArgs);\r\nend;\r\n\r\nfunction TStringHelper.get_Chars(const AIndex: Integer): Char;\r\nbegin\r\n  Result := Self[AIndex + 1];\r\nend;\r\n\r\nfunction TStringHelper.get_Length: Integer;\r\nbegin\r\n  Result := System.Length(Self);\r\nend;\r\n\r\nfunction TStringHelper.High: Integer;\r\nbegin\r\n  Result := Length - 1;\r\nend;\r\n\r\nfunction TStringHelper.IndexOf(const AValue: Char): Integer;\r\nbegin\r\n  Result := Pos(AValue, Self, 1) - 1;\r\nend;\r\n\r\nfunction TStringHelper.IndexOf(const AValue: string; const AStartIndex, ACount: Integer): Integer;\r\nbegin\r\n  Result := Pos(AValue, Self, AStartIndex + 1) - 1;\r\n  if (Result + AValue.Length) > (AStartIndex + ACount) then\r\n    Result := -1;\r\nend;\r\n\r\nfunction TStringHelper.IndexOf(const AValue: string): Integer;\r\nbegin\r\n  Result := System.Pos(AValue, Self) - 1;\r\nend;\r\n\r\nfunction TStringHelper.Insert(const AStartIndex: Integer; const AValue: string): string;\r\nbegin\r\n  System.Insert(AValue, Self, AStartIndex + 1);\r\n  Result := Self;\r\nend;\r\n\r\nfunction TStringHelper.IsEmpty: Boolean;\r\nbegin\r\n  Result := Self = Empty;\r\nend;\r\n\r\nfunction TStringHelper.IsNumber: Boolean;\r\nconst\r\n  cNumbers = ['0'..'9'];\r\nvar\r\n  lCount: Integer;\r\nbegin\r\n  if IsEmpty then\r\n    Exit(False);\r\n\r\n  for lCount := 0 to Length - 1 do\r\n  begin\r\n    if not (Chars[lCount] in cNumbers) then\r\n      Exit(False);\r\n  end;\r\n  Result := True;\r\nend;\r\n\r\nfunction TStringHelper.LastIndexOf(const AValue: Char): Integer;\r\nbegin\r\n  Result := Reverse.IndexOf(AValue);\r\n  if Result >= 0 then\r\n    Result := Length - Result - 1;\r\nend;\r\n\r\nclass function TStringHelper.Low: Integer;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nfunction TStringHelper.NotEquals(const AValue: string): Boolean;\r\nbegin\r\n  Result := not Equals(AValue);\r\nend;\r\n\r\nfunction TStringHelper.NotIsEmpty: Boolean;\r\nbegin\r\n  Result := Self <> Empty;\r\nend;\r\n\r\nfunction TStringHelper.PadLeft(const ATotalWidth: Integer): string;\r\nconst\r\n  cDefPadChar = ' ';\r\nbegin\r\n  Result := PadLeft(ATotalWidth, cDefPadChar);\r\nend;\r\n\r\nfunction TStringHelper.PadLeft(ATotalWidth: Integer; const APaddingChar: Char): string;\r\nbegin\r\n  ATotalWidth := ATotalWidth - Length;\r\n  if ATotalWidth > 0 then\r\n    Result := System.StringOfChar(APaddingChar, ATotalWidth) + Self\r\n  else\r\n    Result := Self;\r\nend;\r\n\r\nfunction TStringHelper.Pos(const ASubStr, AStr: string; const AOffset: Integer): Integer;\r\nasm\r\n  return AStr.indexOf(ASubStr, AOffset - 1) + 1;\r\nend;\r\n\r\nfunction TStringHelper.Remove(const AStartIndex: Integer): string;\r\nbegin\r\n  Result := Remove(AStartIndex, 1);\r\nend;\r\n\r\nfunction TStringHelper.Remove(const AStartIndex, ACount: Integer): string;\r\nbegin\r\n  Result := SubString(0, AStartIndex - 1) + SubString(AStartIndex + ACount);\r\nend;\r\n\r\nfunction TStringHelper.Replace(const AOldValue, ANewValue: string): string;\r\nbegin\r\n  Result := SysUtils.StringReplace(Self, AOldValue, ANewValue, [rfReplaceAll]);\r\nend;\r\n\r\nfunction TStringHelper.Reverse: string;\r\nvar\r\n  lCount: Integer;\r\nbegin\r\n  Result := Empty;\r\n  Result.Length := Length;\r\n  for lCount := 0 to Length - 1 do\r\n    Result.Chars[Length - lCount - 1] := Self.Chars[lCount];\r\nend;\r\n\r\nfunction TStringHelper.Same(const AValue: string): Boolean;\r\nbegin\r\n  Result := SysUtils.SameText(Self, AValue);\r\nend;\r\n\r\nprocedure TStringHelper.set_Chars(const AIndex: Integer; const AValue: Char);\r\nbegin\r\n  Self[AIndex + 1] := AValue;\r\nend;\r\n\r\nprocedure TStringHelper.set_Length(const AValue: Integer);\r\nbegin\r\n  System.SetLength(Self, AValue);\r\nend;\r\n\r\nclass function TStringHelper.StartsText(const ASubText, AText: string): Boolean;\r\nbegin\r\n  if ASubText.IsEmpty then\r\n    Result := True\r\n  else\r\n  begin\r\n    if AText.Length >= ASubText.Length then\r\n      Result := SysUtils.SameText(AText.Substring(0, ASubText.Length), ASubText)\r\n    else\r\n      Result := False;\r\n  end;\r\nend;\r\n\r\nfunction TStringHelper.StartsWith(const AValue: string): Boolean;\r\nbegin\r\n  Result := StartsWith(AValue, False);\r\nend;\r\n\r\nfunction TStringHelper.StartsWith(const AValue: string; AIgnoreCase: Boolean): Boolean;\r\nbegin\r\n  if AIgnoreCase then\r\n    Result := StartsText(AValue, Self)\r\n  else\r\n  if AValue = Empty then\r\n    Result := True\r\n  else\r\n  begin\r\n    if (Self.Length >= AValue.Length) then\r\n      Result := Substring(0, AValue.Length).Equals(AValue)\r\n    else\r\n      Result := False;\r\n  end;\r\nend;\r\n\r\nfunction TStringHelper.Substring(const AStartIndex: Integer): string;\r\nbegin\r\n  Result := System.Copy(Self, AStartIndex + 1, Self.Length);\r\nend;\r\n\r\nfunction TStringHelper.Substring(const AStartIndex, ALength: Integer): string;\r\nbegin\r\n  Result := System.Copy(Self, AStartIndex + 1, ALength);\r\nend;\r\n\r\nfunction TStringHelper.ToLower: string;\r\nvar\r\n  lValue: string;\r\nbegin\r\n  lValue := Self;\r\n  asm\r\n    lValue = lValue.toLowerCase();\r\n  end;\r\n  Result := lValue;\r\nend;\r\n\r\nfunction TStringHelper.ToUpper: string;\r\nvar\r\n  lValue: string;\r\nbegin\r\n  lValue := Self;\r\n  asm\r\n    lValue = lValue.toUpperCase();\r\n  end;\r\n  Result := lValue;\r\nend;\r\n\r\nfunction TStringHelper.Trim: string;\r\nbegin\r\n  Result := SysUtils.Trim(Self);\r\nend;\r\n\r\n{ TDateTimeHelper }\r\n\r\nfunction TDateTimeHelper.Equals(const AValue: TDateTime): Boolean;\r\nbegin\r\n  Result := SameValue(Self, AValue);\r\nend;\r\n\r\nfunction TDateTimeHelper.NotEquals(const AValue: TDateTime): Boolean;\r\nbegin\r\n  Result := not SameValue(Self, AValue);\r\nend;\r\n\r\nfunction TDateTimeHelper.ToString: string;\r\nbegin\r\n  Result := SysUtils.DateTimeToStr(Self, FormatSettings);\r\nend;\r\n\r\n{ TTMSEncoding }\r\n\r\nfunction TTMSEncoding.GetByteCount(const AChars: string; const ACharCount: Integer): Integer;\r\nbegin\r\n  Result := GetByteCount(AChars.Substring(0, ACharCount));\r\nend;\r\n\r\nfunction TTMSEncoding.GetByteCount(const AChars: string; const ACharIndex, ACharCount: Integer): Integer;\r\nbegin\r\n  Result := GetByteCount(AChars.Substring(ACharIndex, ACharCount));\r\nend;\r\n\r\nfunction TTMSEncoding.GetBytes(const AChars: string; const ACharCount: Integer): TBytes;\r\nbegin\r\n  Result := GetBytes(AChars.Substring(0, ACharCount));\r\nend;\r\n\r\nfunction TTMSEncoding.GetBytes(const AChars: string; const ACharIndex, ACharCount: Integer): TBytes;\r\nbegin\r\n  Result := GetBytes(AChars.Substring(ACharIndex, ACharCount));\r\nend;\r\n\r\nfunction TTMSEncoding.GetString(const ABytes: TBytes; const ACharCount: Integer): string;\r\nbegin\r\n  Result := GetString(ABytes.SubBytes(0, ACharCount));\r\nend;\r\n\r\nfunction TTMSEncoding.GetString(const ABytes: TBytes; const ACharIndex, ACharCount: Integer): string;\r\nbegin\r\n  Result := GetString(ABytes.SubBytes(ACharIndex, ACharCount));\r\nend;\r\n\r\nclass function TTMSEncoding.get_ANSI: TTMSEncoding;\r\nbegin\r\n  if FANSI = nil then\r\n    FANSI := TANSIEncoding.Create;\r\n  Result := FANSI;\r\nend;\r\n\r\nclass function TTMSEncoding.get_Default: TTMSEncoding;\r\nbegin\r\n  Result := ANSI;\r\nend;\r\n\r\nclass function TTMSEncoding.get_Unicode: TTMSEncoding;\r\nbegin\r\n  if FUnicode = nil then\r\n    FUnicode := TUnicodeEncoding.Create;\r\n  Result := FUnicode;\r\nend;\r\n\r\nclass function TTMSEncoding.IsStandardEncoding(AEncoding: TTMSEncoding): Boolean;\r\nbegin\r\n  Result := (AEncoding <> nil) and ((AEncoding = FANSI) or (AEncoding = FUnicode));\r\nend;\r\n\r\n{ TANSIEncoding }\r\n\r\nfunction TANSIEncoding.GetByteCount(const AChars: string): Integer;\r\nbegin\r\n  Result := AChars.Length;\r\nend;\r\n\r\nfunction TANSIEncoding.GetBytes(const AChars: string): TBytes;\r\nbegin\r\n  Result := BytesOf(AChars);\r\nend;\r\n\r\nfunction TANSIEncoding.GetString(const ABytes: TBytes): string;\r\nbegin\r\n  Result := StringOf(ABytes);\r\nend;\r\n\r\n{ TUnicodeEncoding }\r\n\r\nfunction TUnicodeEncoding.GetByteCount(const AChars: string): Integer;\r\nbegin\r\n  Result := Char.Size * AChars.Length;\r\nend;\r\n\r\nfunction TUnicodeEncoding.GetBytes(const AChars: string): TBytes;\r\nbegin\r\n  InternalGetBytes(AChars, Result);\r\nend;\r\n\r\nfunction TUnicodeEncoding.GetString(const ABytes: TBytes): string;\r\nvar\r\n  lWords: TWords;\r\n  lBuffer: string;\r\nbegin\r\n  lBuffer := string.Empty;\r\n  lWords := TWords.FromBytes(ABytes);\r\n  if lWords <> nil then\r\n  begin\r\n    asm\r\n      for (var lCount = 0; lCount < lWords.length; lCount++)\r\n        lBuffer += string.fromCharCode(lWords[lCount]);\r\n    end;\r\n  end;\r\n  Result := lBuffer;\r\nend;\r\n\r\nprocedure TUnicodeEncoding.InternalGetBytes(const AChars: string; out ABytes: TBytes);\r\nvar\r\n  lWords: TWords;\r\nbegin\r\n  lWords := nil;\r\n  asm\r\n    for (var lCount = 0; lCount < AChars.length; lCount++)\r\n      lWords.push(AChars.charCodeAt(lCount));\r\n  end;\r\n  ABytes := lWords.ToBytes;\r\nend;\r\n\r\n{ TStreamHelper }\r\n\r\nfunction TStreamHelper.CopyFrom(const ASource: TStream; ACount: Int64): Int64;\r\nconst\r\n  MaxBufSize = $F000;\r\nvar\r\n  lBufSize: Integer;\r\n  lCount: Integer;\r\n  lBuffer: TBytes;\r\nbegin\r\n  if ACount <= 0 then\r\n  begin\r\n    ASource.Position := 0;\r\n    ACount := ASource.Size;\r\n  end;\r\n  Result := ACount;\r\n  if ACount > MaxBufSize then\r\n    lBufSize := MaxBufSize\r\n  else\r\n    lBufSize := ACount;\r\n  lBuffer.Length := lBufSize;\r\n  try\r\n    while ACount <> 0 do\r\n    begin\r\n      if ACount > lBufSize then\r\n        lCount := lBufSize\r\n      else\r\n        lCount := ACount;\r\n      ASource.ReadBuffer(lBuffer, lCount);\r\n      WriteBuffer(lBuffer, lCount);\r\n      Dec(ACount, lCount);\r\n    end;\r\n  finally\r\n    lBuffer.Length := 0;\r\n  end;\r\nend;\r\n\r\n{ TTMSStringStream }\r\n\r\nconstructor TTMSStringStream.Create;\r\nbegin\r\n  Create(string.Empty, TTMSEncoding.Default, False);\r\nend;\r\n\r\nconstructor TTMSStringStream.Create(const AString: string);\r\nbegin\r\n  Create(AString, TTMSEncoding.Default, False);\r\nend;\r\n\r\nconstructor TTMSStringStream.Create(const AString: string; AEncoding: TTMSEncoding; AOwnsEncoding: Boolean);\r\nvar\r\n  lBytes: TBytes;\r\nbegin\r\n  inherited Create;\r\n  FEncoding := AEncoding;\r\n  FOwnsEncoding := AOwnsEncoding and not TTMSEncoding.IsStandardEncoding(AEncoding);\r\n  lBytes := FEncoding.GetBytes(AString);\r\n  SetPointer(BytesToMemory(lBytes), lBytes.Length);\r\nend;\r\n\r\ndestructor TTMSStringStream.Destroy;\r\nbegin\r\n  if FOwnsEncoding then\r\n    FEncoding.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TTMSStringStream.GetDataString: string;\r\nbegin\r\n  Result := FEncoding.GetString(Copy(Bytes, 0, Size));\r\nend;\r\n\r\nprocedure TTMSStringStream.LoadFromFile(const AFileName: string);\r\nconst\r\n  cStatusOK = 200;\r\nvar\r\n  lStatus: Integer;\r\n  lResponse: string;\r\nbegin\r\n  lResponse := string.Empty;\r\n  lStatus := cStatusOK;\r\n  asm\r\n    var lRequest = new XMLHttpRequest();\r\n    lRequest.open(\"GET\", AFileName, false);\r\n    lRequest.send();\r\n\r\n    if (lRequest.status == cStatusOK)\r\n      lResponse = lRequest.responseText\r\n    else\r\n      lStatus = lRequest.status;\r\n  end;\r\n\r\n  if lStatus <> cStatusOK then\r\n    raise EStringStreamError.CreateFmt(SCannotGetFile, [AFileName, lStatus]);\r\n  WriteString(lResponse);\r\nend;\r\n\r\nprocedure TTMSStringStream.LoadFromFile(const AFileName: string; const ALoaded: TProc);\r\nbegin\r\n  LoadFromFile(AFileName, ALoaded, nil);\r\nend;\r\n\r\nprocedure TTMSStringStream.LoadFromFile(const AFileName: string; const ALoaded: TProc; const AError: TProcString);\r\nconst\r\n  cAbortMethod = 'abort';\r\n  cErrorMethod = 'error';\r\n  cGetMethod = 'GET';\r\n  cLoadMethod = 'load';\r\nbegin\r\n  FLoaded := ALoaded;\r\n  FError := AError;\r\n  FFileName := AFileName;\r\n  FRequest := TJSXMLHttpRequest.New;\r\n  FRequest.AddEventListener(cAbortMethod, @OnAbort);\r\n  FRequest.AddEventListener(cErrorMethod, @OnError);\r\n  FRequest.AddEventListener(cLoadMethod, @OnLoad);\r\n  try\r\n    FRequest.Open(cGetMethod, AFileName, True);\r\n    FRequest.Send;\r\n  except\r\n    on E: Exception do\r\n    begin\r\n      if Assigned(AError) then\r\n        AError(E.Message)\r\n      else\r\n        raise;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSStringStream.InternalLoadFromFileP(const AFileName: string): TJSPromise;\r\nbegin\r\n  Result := TJSPromise.New(\r\n    procedure(AResolve, AReject : TJSPromiseResolver)\r\n    begin\r\n      LoadFromFile(AFileName,\r\n      procedure()\r\n      begin\r\n        AResolve(True);\r\n      end,\r\n      procedure(const AError: string)\r\n      begin\r\n        AReject(AError);\r\n      end);\r\n    end);\r\nend;\r\n\r\nfunction TTMSStringStream.LoadFromFileP(const AFileName: string): Boolean; async;\r\nbegin\r\n  Result := await(Boolean, InternalLoadFromFileP(AFileName));\r\nend;\r\n\r\nfunction TTMSStringStream.OnAbort(AEvent: TEventListenerEvent): Boolean;\r\nbegin\r\n  Result := True;\r\n  if Assigned(FError) then\r\n    FError(Format(SLoadFromFileAborted, [FFileName]));\r\nend;\r\n\r\nfunction TTMSStringStream.OnError(AEvent: TEventListenerEvent): Boolean;\r\nbegin\r\n  Result := True;\r\n  if Assigned(FError) then\r\n    FError(Format(SErrorLoadFromFile, [FFileName]));\r\nend;\r\n\r\nfunction TTMSStringStream.OnLoad(AEvent: TEventListenerEvent): Boolean;\r\nconst\r\n  cStatusOK = 200;\r\n  cStatusLastOK = 208;\r\nvar\r\n  lReq: TJSXMLHttpRequest;\r\nbegin\r\n  lReq := TJSXMLHttpRequest(AEvent.target);\r\n\r\n  if (lReq.Status < cStatusOK) or (lReq.Status > cStatusLastOK) then\r\n  begin\r\n    if Assigned(FError) then\r\n    begin\r\n      FError(Format(SCannotGetFile, [FFileName, FRequest.Status]));\r\n      Exit;\r\n    end\r\n    else\r\n      raise EStringStreamError.CreateFmt(SCannotGetFile, [FFileName, lReq.Status]);\r\n  end;\r\n  WriteString(lReq.ResponseText);\r\n  Result := True;\r\n  if Assigned(FLoaded) then\r\n    FLoaded();\r\nend;\r\n\r\nfunction TTMSStringStream.ReadString(ACount: Integer): string;\r\nvar\r\n  lBytes: TBytes;\r\n  lDest: TBytes;\r\n  lCount: Integer;\r\nbegin\r\n  if ACount > Size - Position then\r\n    ACount := Size - Position;\r\n\r\n  lDest.Length := ACount;\r\n  lBytes := Bytes;\r\n  for lCount := Position to ACount + Position - 1 do\r\n    lDest[lCount - Position] := lBytes[lCount];\r\n\r\n  Result := FEncoding.GetString(lDest);\r\n  Position := Position + ACount;\r\nend;\r\n\r\nprocedure TTMSStringStream.WriteString(const AString: string);\r\nvar\r\n  lBytes: TBytes;\r\n  lData: string;\r\nbegin\r\n  lBytes := FEncoding.GetBytes(AString);\r\n  Write(lBytes, 0, lBytes.Length);\r\n\r\n  lData := DataString;\r\n  if lData <> AString then\r\n    WriteString(''); \r\nend;\r\n\r\n{ TInterfaceList }\r\n\r\nconstructor TInterfaceList.Create;\r\nbegin\r\n  inherited Create;\r\n  FList := TFPList.Create;\r\nend;\r\n\r\ndestructor TInterfaceList.Destroy;\r\nbegin\r\n  Clear;\r\n  FList.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TInterfaceList.Add(const AItem: IInterface): Integer;\r\nbegin\r\n  Result := FList.Add(nil);\r\n  Items[Result] := AItem;\r\nend;\r\n\r\nprocedure TInterfaceList.Clear;\r\nvar\r\n  lCount: Integer;\r\nbegin\r\n  for lCount := 0 to FList.Count - 1 do\r\n    Items[lCount] := nil;\r\n  FList.Clear;\r\nend;\r\n\r\nprocedure TInterfaceList.Delete(const AIndex: Integer);\r\nbegin\r\n  Items[AIndex] := nil;\r\n  FList.Delete(AIndex);\r\nend;\r\n\r\nprocedure TInterfaceList.Exchange(const AIndex1, AIndex2: Integer);\r\nbegin\r\n  FList.Exchange(AIndex1, AIndex2);\r\nend;\r\n\r\nfunction TInterfaceList.Expand: TInterfaceList;\r\nbegin\r\n  FList.Expand;\r\n  Result := Self;\r\nend;\r\n\r\nfunction TInterfaceList.First: IInterface;\r\nbegin\r\n  Result := Items[0];\r\nend;\r\n\r\nfunction TInterfaceList.GetEnumerator: TInterfaceListEnumerator;\r\nbegin\r\n  Result := TInterfaceListEnumerator.Create(Self);\r\nend;\r\n\r\nfunction TInterfaceList.get_Capacity: Integer;\r\nbegin\r\n  Result := FList.Capacity;\r\nend;\r\n\r\nfunction TInterfaceList.get_Count: Integer;\r\nbegin\r\n  Result := FList.Count;\r\nend;\r\n\r\nfunction TInterfaceList.get_Items(const AIndex: Integer): IInterface;\r\nbegin\r\n  Result := IInterface(FList[AIndex]);\r\nend;\r\n\r\nfunction TInterfaceList.IndexOf(const AItem: IInterface): Integer;\r\nbegin\r\n  Result := IndexOfItem(AItem, TDirection.FromBeginning);\r\nend;\r\n\r\nfunction TInterfaceList.IndexOfItem(const AItem: IInterface; const ADirection: TDirection): Integer;\r\nbegin\r\n  Result := FList.IndexOfItem(AItem, ADirection);\r\nend;\r\n\r\nprocedure TInterfaceList.Insert(const AIndex: Integer; const AItem: IInterface);\r\nbegin\r\n  FList.Insert(AIndex, nil);\r\n  Items[AIndex] := AItem;\r\nend;\r\n\r\nfunction TInterfaceList.Last: IInterface;\r\nbegin\r\n  Result := Items[Count - 1];\r\nend;\r\n\r\nprocedure TInterfaceList.Lock;\r\nbegin\r\nend;\r\n\r\nfunction TInterfaceList.Remove(const AItem: IInterface): Integer;\r\nbegin\r\n  Result := RemoveItem(AItem, TDirection.FromBeginning);\r\nend;\r\n\r\nfunction TInterfaceList.RemoveItem(const AItem: IInterface; const ADirection: TDirection): Integer;\r\nbegin\r\n  Result := FList.IndexOfItem(AItem, ADirection);\r\n  if Result > -1 then\r\n    Delete(Result);\r\nend;\r\n\r\nprocedure TInterfaceList.set_Capacity(const AValue: Integer);\r\nbegin\r\n  FList.Capacity := AValue;\r\nend;\r\n\r\nprocedure TInterfaceList.set_Count(const AValue: Integer);\r\nbegin\r\n  FList.Count := AValue;\r\nend;\r\n\r\nprocedure TInterfaceList.set_Items(const AIndex: Integer; const AItem: IInterface);\r\nbegin\r\n  if FList[AIndex] <> nil then\r\n    IInterface(FList[AIndex])._Release;\r\n  FList[AIndex] := AItem;\r\n  if AItem <> nil then\r\n    AItem._AddRef;\r\nend;\r\n\r\nfunction InternalCompare(AItem1, AItem2: JSValue): Integer;\r\nbegin\r\n  Result := FCompare(IInterface(AItem1), IInterface(AItem2));\r\nend;\r\n\r\nprocedure TInterfaceList.Sort(const ACompare: TCompareItems);\r\nbegin\r\n  FCompare := ACompare;\r\n  try\r\n    FList.Sort(@InternalCompare);\r\n  finally\r\n    FCompare := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TInterfaceList.Unlock;\r\nbegin\r\nend;\r\n\r\n{ TInterfaceListEnumerator }\r\n\r\nconstructor TInterfaceListEnumerator.Create(const AInterfaceList: TInterfaceList);\r\nbegin\r\n  inherited Create;\r\n  FIndex := -1;\r\n  FInterfaceList := AInterfaceList;\r\nend;\r\n\r\nfunction TInterfaceListEnumerator.get_Current: IInterface;\r\nbegin\r\n  Result := FInterfaceList[FIndex];\r\nend;\r\n\r\nfunction TInterfaceListEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Result := FIndex < FInterfaceList.Count - 1;\r\n  if Result then\r\n    Inc(FIndex);\r\nend;\r\n\r\n{ TStringBuilder }\r\n\r\nconstructor TStringBuilder.Create(const AValue: string);\r\nbegin\r\n  inherited Create;\r\n  FData := AValue;\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: Integer): TStringBuilder;\r\nbegin\r\n  Result := Append(AValue.ToString);\r\nend;\r\n\r\nfunction TStringBuilder.Append(const AValue: string): TStringBuilder;\r\nbegin\r\n  FData := FData + AValue;\r\n  Result := Self;\r\nend;\r\n\r\nfunction TStringBuilder.get_Length: Integer;\r\nbegin\r\n  Result := FData.Length;\r\nend;\r\n\r\nfunction TStringBuilder.Insert(const AIndex, AValue: Integer): TStringBuilder;\r\nbegin\r\n  Result := Insert(AIndex, AValue.ToString);\r\nend;\r\n\r\nfunction TStringBuilder.Insert(const AIndex: Integer; const AValue: string): TStringBuilder;\r\nbegin\r\n  FData.Insert(AIndex, AValue);\r\n  Result := Self;\r\nend;\r\n\r\nprocedure TStringBuilder.set_Length(const AValue: Integer);\r\nbegin\r\n  FData.Length := AValue;\r\nend;\r\n\r\nfunction TStringBuilder.ToString: string;\r\nbegin\r\n  Result := FData;\r\nend;\r\n\r\n{$HINTS OFF}\r\n\r\nfunction StringToBase64(AValue: string): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    res = window.btoa(AValue);\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction Base64ToString(AValue: string): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    res = window.atob(AValue);\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction ArrayBufferToBase64(Buffer: TJSArrayBuffer): string;\r\nbegin\r\n  asm\r\n    function _arrayBufferToBase64(buf) {\r\n    var binary = '';\r\n    var bytes = new Uint8Array(buf);\r\n    var len = bytes.byteLength;\r\n    for (var i = 0; i < len; i++) {\r\n        binary += String.fromCharCode( bytes[i] );\r\n    }\r\n    return window.btoa(binary);\r\n    }\r\n    Result = _arrayBufferToBase64(Buffer);\r\n  end;\r\nend;\r\n\r\nfunction Base64ToArrayBuffer(Base64: string): TJSArrayBuffer;\r\nbegin\r\n  asm\r\n    function _base64ToArrayBuffer(data) {\r\n        var binary_string = window.atob(data);\r\n        var len = binary_string.length;\r\n        var bytes = new Uint8Array(len);\r\n        for (var i = 0; i < len; i++) {\r\n            bytes[i] = binary_string.charCodeAt(i);\r\n        }\r\n        return bytes.buffer;\r\n    }\r\n\r\n    Result = _base64ToArrayBuffer(Base64);\r\n  end;\r\nend;\r\n\r\nfunction SizeOf(const AValue: Double): Integer; overload;\r\nconst\r\n  cSizeOfDouble = 8;\r\nbegin\r\n  Result := cSizeOfDouble;\r\nend;\r\n\r\nfunction SizeOf(const AValue: Integer): Integer; overload;\r\nconst\r\n  cSizeOfInteger = 4;\r\nbegin\r\n  Result := cSizeOfInteger;\r\nend;\r\n\r\nprocedure InsertAfter(newNode, referenceNode: TJSElement);\r\nbegin\r\n  referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\r\nend;\r\n\r\nfunction StripThousandSep(ps: string): string;\r\nbegin\r\n  while (Pos(FormatSettings.ThousandSeparator, ps) > 0) do\r\n    Delete(ps, Pos(FormatSettings.ThousandSeparator, ps), 1);\r\n  Result := ps;\r\nend;\r\n\r\nfunction VarPos(ASubValue, AValue: string; var AResult: Integer): Integer;\r\nbegin\r\n  AResult := Pos(ASubValue, AValue);\r\n  Result := AResult;\r\nend;\r\n\r\nfunction IsDate(AValue: string; var ADate: TDateTime): boolean;\r\nvar\r\n  su, ts: string;\r\n  da,mo,ye,ho,mi,se: Word;\r\n  err: Integer;\r\n  dp,mp,yp,vp: Integer;\r\nbegin\r\n  Result := False;\r\n  ts := '';\r\n  su := UpperCase(FormatSettings.ShortDateFormat);\r\n  dp := pos('D',su);\r\n  mp := pos('M',su);\r\n  yp := pos('Y',su);\r\n\r\n  da := 0;\r\n  mo := 0;\r\n  ye := 0;\r\n  ho := 0;\r\n  mi := 0;\r\n  se := 0;\r\n\r\n  vp := -1;\r\n  if VarPos(FormatSettings.DateSeparator,AValue,vp)>0 then\r\n  begin\r\n    su := Copy(AValue,1,vp - 1);\r\n\r\n    if (dp<mp) and\r\n       (dp<yp) then\r\n       val(su,da,err)\r\n    else\r\n    if (mp<dp) and\r\n       (mp<yp) then\r\n       val(su,mo,err)\r\n    else\r\n    if (yp<mp) and\r\n       (yp<dp) then\r\n       val(su,ye,err);\r\n\r\n    if err<>0 then Exit;\r\n    Delete(AValue,1,vp);\r\n\r\n    if VarPos(FormatSettings.DateSeparator,AValue,vp)>0 then\r\n    begin\r\n      su := Copy(AValue,1,vp - 1);\r\n\r\n      if ((dp>mp) and (dp<yp)) or\r\n         ((dp>yp) and (dp<mp)) then\r\n         val(su,da,err)\r\n      else\r\n      if ((mp>dp) and (mp<yp)) or\r\n         ((mp>yp) and (mp<dp)) then\r\n         val(su,mo,err)\r\n      else\r\n      if ((yp>mp) and (yp<dp)) or\r\n         ((yp>dp) and (yp<mp)) then\r\n         val(su,ye,err);\r\n\r\n      if err<>0 then Exit;\r\n      Delete(AValue,1,vp);\r\n\r\n      AValue := Trim(AValue);\r\n\r\n      if VarPos(' ',AValue, vp) > 0 then  // there is space to separate date & time\r\n      begin\r\n        ts := copy(AValue, vp, length(AValue));\r\n        AValue := copy(AValue, 1, vp - 1);\r\n      end;\r\n\r\n      if (dp>mp) and\r\n         (dp>yp) then\r\n         val(AValue,da,err)\r\n      else\r\n      if (mp>dp) and\r\n         (mp>yp) then\r\n         val(AValue,mo,err)\r\n      else\r\n      if (yp>mp) and\r\n         (yp>dp) then\r\n         val(AValue,ye,err);\r\n\r\n      if err<>0 then Exit;\r\n      if (da>31) then Exit;\r\n      if (mo>12) then Exit;\r\n\r\n      if (ts <> '') then  // there is a time part\r\n      begin\r\n        if VarPos(FormatSettings.TimeSeparator,ts,vp)>0 then\r\n        begin\r\n          su := Copy(ts,1,vp - 1); // hour part\r\n          val(su,ho,err);\r\n\r\n          if (err <> 0) then Exit;\r\n          if (ho > 23) then Exit;\r\n\r\n          Delete(ts,1,vp);\r\n\r\n          if VarPos(FormatSettings.TimeSeparator,ts,vp)>0 then // there is a second part\r\n          begin\r\n            su := Copy(ts,1,vp - 1); // minute part\r\n            val(su,mi,err);\r\n\r\n            if err <> 0 then Exit;\r\n            Delete(ts,1,vp);\r\n\r\n            val(ts,se,err);  // second part\r\n            if (err <> 0) then Exit;\r\n            if (se > 60) then Exit;\r\n          end\r\n          else\r\n          begin\r\n            val(su,mi,err); // minute part\r\n            if (err <> 0) then Exit;\r\n          end;\r\n\r\n          if (mi > 59) then Exit;\r\n\r\n          Result := true;\r\n        end;\r\n      end\r\n      else\r\n        Result := True;\r\n\r\n      try\r\n        ADate := EncodeDate(ye,mo,da) + EncodeTime(ho,mi,se,0);\r\n      except\r\n        Result := False;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction Matches(s0a, s1a: string): Boolean;\r\nconst\r\n  larger = '>';\r\n  smaller = '<';\r\n  logand  = '&';\r\n  logor   = '^';\r\n  asterix = '*';\r\n  qmark = '?';\r\n  negation = '!';\r\n\r\nvar\r\n  matching: boolean;\r\n  done: boolean;\r\n  len: longint;\r\n  lastchar:  char;\r\n  s0,s1,s2,s3: integer;\r\n  oksmaller,oklarger,negflag: boolean;\r\n  compstr: string;\r\n  flag1,flag2,flag3: boolean;\r\n  equal: boolean;\r\n  n1,n2: double;\r\n  code1, code2: Integer;\r\n  dt1,dt2: TDateTime;\r\n  q, i: integer;\r\nbegin\r\n  i := 0;\r\n\r\n  oksmaller := True;\r\n  oklarger := True;\r\n  flag1 := False;\r\n  flag2 := False;\r\n  flag3 := False;\r\n  negflag := False;\r\n  equal := False;\r\n\r\n  { [<>] string [&|] [<>] string }\r\n\r\n  // do larger than or larger than or equal\r\n\r\n  s2 := Pos(larger,s0a);\r\n\r\n  if s2 <> 0 then\r\n  begin\r\n    inc(s2);\r\n    if (s0a[s2 - i] = '=') then\r\n    begin\r\n      Equal := True;\r\n      inc(s2);\r\n    end;\r\n\r\n    while (s0a[s2 - i] = ' ') do\r\n      inc(s2);\r\n\r\n    s3 := s2;\r\n    len := 0;\r\n\r\n    lastchar := #0;\r\n\r\n    q := 0;\r\n\r\n    while ((s2 - i <= Length(s0a)) and (s0a[s2 - i] <> ' ')) and (s2 <= Length(s0a)) and (odd(q) or ((s0a[s2 - i] <> '&') and (s0a[s2 - i] <> '|')))  do\r\n    begin\r\n      if (s0a[s2 - i] = '\"') then\r\n        inc(q);\r\n\r\n      if (len = 0) and (s0a[s2 - i] = '\"') then\r\n        inc(s3)\r\n      else\r\n        inc(len);\r\n\r\n      lastchar := s0a[s2 - i];\r\n      inc(s2);\r\n\r\n      if (s2 - i <= Length(s0a)) and (s0a[s2 - i] = ' ') and odd(q) then // skip space if between quotes\r\n      begin\r\n        lastchar := s0a[s2 - i];\r\n        inc(s2);\r\n      end;\r\n    end;\r\n\r\n    if (len > 0) and (lastchar = '\"') then\r\n      dec(len);\r\n\r\n    compstr := Copy(s0a,s3,len);\r\n\r\n    //StrLCopy(compstr,s3,len);\r\n\r\n    Val(StripThousandSep(s1a),n1,code1);\r\n    Val(StripThousandSep(compstr),n2,code2);\r\n\r\n    dt2 := 0;\r\n    if IsDate(compstr,dt2) then\r\n      code2 := 1;\r\n\r\n    dt1 := 0;\r\n    if IsDate(s1a,dt1) then\r\n      code1 := 1;\r\n\r\n    if (code1 = 0) and (code2 = 0) then {both are numeric types}\r\n    begin\r\n      if equal then\r\n        oklarger := n1 >= n2\r\n      else\r\n        oklarger := n1 > n2;\r\n    end\r\n    else\r\n    begin\r\n      if IsDate(compstr,dt2) and IsDate(s1a,dt1) then\r\n      begin\r\n        if equal then\r\n         oklarger := dt1 >= dt2\r\n        else\r\n         oklarger := dt1 > dt2;\r\n      end\r\n      else\r\n      begin\r\n        if equal then\r\n         oklarger := (CompareStr(compstr,s1a)<=0)\r\n        else\r\n         oklarger := (CompareStr(compstr,s1a)<0);\r\n      end;\r\n    end;\r\n    flag1 := True;\r\n  end;\r\n\r\n  equal := False;\r\n\r\n  // do smaller than or smaller than or equal\r\n  s2 := Pos(smaller, s0a);\r\n  if (s2 <> 0) then\r\n  begin\r\n    inc(s2);\r\n    if (s0a[s2 - i] = '=') then\r\n      begin\r\n       equal := True;\r\n       inc(s2);\r\n      end;\r\n\r\n    lastchar := #0;\r\n\r\n    while (s2 - i <= Length(s0a)) and (s0a[s2 - i] =' ') do inc(s2);\r\n    s3 := s2;\r\n    len := 0;\r\n    q := 0;\r\n\r\n    while (s2 - i <= Length(s0a)) and (s0a[s2 - i] <> ' ') and (s2 <= Length(s0a)) and (odd(q) or ((s0a[s2 - i] <> '&') and (s0a[s2 - i] <> '|'))) do\r\n    begin\r\n      if s0a[s2 - i] = '\"' then\r\n        inc(q);\r\n\r\n      if (len = 0) and (s0a[s2 - i] = '\"') then\r\n        inc(s3)\r\n      else\r\n        inc(len);\r\n\r\n      lastchar := s0a[s2 - i];\r\n      inc(s2);\r\n    end;\r\n\r\n    if (len > 0) and (lastchar = '\"') then\r\n      dec(len);\r\n\r\n    compstr := copy(s0a, s3, len);\r\n\r\n    Val(StripThousandSep(s1a),n1,code1);\r\n    Val(StripThousandSep(compstr),n2,code2);\r\n    if IsDate(compstr,dt2) then code2 := 1;\r\n    if IsDate(s1a,dt1) then code1 := 1;\r\n\r\n    if (code1 = 0) and (code2 = 0) then // both are numeric types\r\n     begin\r\n      if equal then\r\n       oksmaller := n1 <= n2\r\n      else\r\n       oksmaller := n1 < n2;\r\n     end\r\n    else\r\n     begin\r\n      // check for dates here ?\r\n      if IsDate(compstr, dt2) and IsDate(s1a, dt1) then\r\n       begin\r\n        if equal then\r\n         oksmaller := dt1 <= dt2\r\n        else\r\n         oksmaller := dt1 < dt2;\r\n       end\r\n      else\r\n       begin\r\n        if equal then\r\n          oksmaller := (CompareStr(compstr,s1a)>=0)\r\n        else\r\n          oksmaller := (CompareStr(compstr,s1a)>0);\r\n       end;\r\n     end;\r\n\r\n    flag2 := True;\r\n  end;\r\n\r\n  s2 := Pos(negation, s0a);\r\n\r\n  if (s2 <> 0) then\r\n  begin\r\n    inc(s2);\r\n    while (s0a[s2 - i] = ' ') do\r\n      inc(s2);\r\n    s3 := s2;\r\n    len := 0;\r\n\r\n    lastchar := #0;\r\n    q := 0;\r\n\r\n    while (s0a[s2 - i] <> ' ') and (s2 <= length(s0a)) and (odd(q) or ((s0a[s2 - i] <> '&') and (s0a[s2 - i] <> '|'))) do\r\n    begin\r\n      if (s0a[s2 - i] = '\"') then\r\n        inc(q);\r\n\r\n      if (len = 0) and (s0a[s2 - i] = '\"') then\r\n        inc(s3)\r\n      else\r\n        inc(len);\r\n\r\n      lastchar := s0a[s2 - i];\r\n      inc(s2);\r\n    end;\r\n\r\n    if (len > 0) and (lastchar = '\"') then\r\n      dec(len);\r\n\r\n    compstr := copy(s0a, s3, len);\r\n    flag3 := True;\r\n  end;\r\n\r\n  if (flag3) then\r\n  begin\r\n    if Pos(larger, s0a) = 0 then\r\n      flag1 := flag3;\r\n    if Pos(smaller, s0a) = 0 then\r\n      flag2 := flag3;\r\n  end;\r\n\r\n  if (Pos(logor, s0a) <> 0) then\r\n    if flag1 or flag2 then\r\n    begin\r\n      matches := oksmaller or oklarger;\r\n      Exit;\r\n    end;\r\n\r\n  if (Pos(logand, s0a) <> 0) then\r\n    if flag1 and flag2 then\r\n    begin\r\n      matches := oksmaller and oklarger;\r\n      Exit;\r\n    end;\r\n\r\n  if ((Pos(larger, s0a) <> 0) and (oklarger)) or\r\n     ((Pos(smaller, s0a) <> 0) and (oksmaller)) then\r\n  begin\r\n    matches := True;\r\n    Exit;\r\n  end;\r\n\r\n  s0 := 1;\r\n  s1 := 1;\r\n\r\n  done := (s0a = '') or (s1a = '');\r\n\r\n  Matching := True;\r\n\r\n  while not done and matching do\r\n  begin\r\n    case s0a[s0 - i] of\r\n    qmark:\r\n      begin\r\n        matching := s1 <= Length(s1a);\r\n        if matching then\r\n        begin\r\n          inc(s0);\r\n          inc(s1);\r\n        end;\r\n      end;\r\n    negation:\r\n      begin\r\n        negflag:=True;\r\n        inc(s0);\r\n      end;\r\n    '\"':\r\n      begin\r\n        inc(s0);\r\n      end;\r\n    asterix:\r\n      begin\r\n        repeat\r\n          inc(s0)\r\n        until (s0 - i > Length(s0a)) or (s0a[s0 - i] <> asterix);\r\n        len := Length(s1a) - s1;\r\n        inc(s1,len);\r\n        matching := matches(copy(s0a,s0,Length(s0a)),Copy(s1a, s1, Length(s1a)));\r\n\r\n        while (len >= 0) and not matching do\r\n        begin\r\n         dec(s1);\r\n         dec(len);\r\n         matching := matches(copy(s0a,s0,Length(s0a)),Copy(s1a, s1, Length(s1a)));\r\n       end;\r\n       if matching then\r\n       begin\r\n         s0 := Length(s0a) + 1;\r\n         s1 := Length(s1a) + 1;\r\n       end;\r\n    end;\r\n   else\r\n     begin\r\n       if (s0 <= Length(s0a)) and (s1 <= Length(s1a)) then\r\n         matching := s0a[s0 - i] = s1a[s1 - i]\r\n       else\r\n         matching := false;\r\n\r\n       if matching then\r\n       begin\r\n         inc(s0);\r\n         inc(s1);\r\n       end;\r\n     end;\r\n   end;\r\n\r\n   Done := (s0 > Length(s0a)) and (s1 > Length(s1a));\r\n  end;\r\n\r\n  if negflag then\r\n    Matches := not matching\r\n  else\r\n    Matches := matching;\r\nend;\r\n\r\nfunction MatchStr(AValue1, AValue2:string; ACaseSensitive:Boolean = true):Boolean;\r\nbegin\r\n  if ACaseSensitive then\r\n    Result := Matches(AValue1,AValue2)\r\n  else\r\n    Result := Matches(UpperCase(AValue1),UpperCase(AValue2));\r\nend;\r\n\r\nfunction StripLogicSpaces(AValue: string): string;\r\nvar\r\n  i, k: integer;\r\n  q: integer;\r\nbegin\r\n  q := 0;\r\n  i := 1;\r\n  k := length(AValue);\r\n  Result := '';\r\n\r\n  while (i <= k) do\r\n  begin\r\n    if AValue[i] = '\"' then\r\n      inc(q);\r\n\r\n    if (AValue[i] = ' ') then\r\n    begin\r\n      if Odd(q) then\r\n        Result := Result + AValue[i];\r\n    end\r\n    else\r\n      Result := Result + AValue[i];\r\n\r\n    inc(i);\r\n  end;\r\nend;\r\n\r\nfunction FirstChar(ACharset: array of char; AValue: string; var spos: Integer): char;\r\nvar\r\n  i:Integer;\r\n  q: Integer;\r\n  j: Integer;\r\nbegin\r\n  j := 1;\r\n  i := 1;\r\n  q := 0;\r\n  spos := -1;\r\n  Result := #0;\r\n\r\n  while i <= Length(AValue) do\r\n  begin\r\n    if AValue[i - j] = '\"' then\r\n      inc(q);\r\n\r\n    if (CharInSet(AValue[i - j], ACharSet)) and not Odd(q) then\r\n    begin\r\n      spos := i;\r\n      Result := AValue[i - j];\r\n      Break;\r\n    end;\r\n    Inc(i);\r\n  end;\r\nend;\r\n\r\nfunction ClosingParenthesis(s1: string): integer;\r\nvar\r\n  i,j,k,r: integer;\r\nbegin\r\n  r := 0;\r\n  j := 0;\r\n  k := 0;\r\n  i := 1;\r\n\r\n  while (i <= length(s1)) do\r\n  begin\r\n    if (s1[i] = ')') then\r\n      inc(k);\r\n\r\n    if (s1[i] = '(') then\r\n      inc(j);\r\n\r\n    if (s1[i] = ')') and (j = k) then\r\n    begin\r\n      r := i;\r\n      break;\r\n    end;\r\n\r\n    inc(i);\r\n  end;\r\n\r\n  Result := r;\r\nend;\r\n\r\n\r\n\r\nfunction MatchStrEx(AValue1, AValue2: string; ACaseSensitive: Boolean = true): Boolean;\r\nvar\r\n  ch,lastop: Char;\r\n  sep,cp: Integer;\r\n  res,newres: Boolean;\r\n  CharArray: array of char;\r\nbegin\r\n  AValue1 := Trim(AValue1);\r\n  AValue1 := StripLogicSpaces(AValue1);\r\n\r\n  sep := -1;\r\n  if VarPos('=', AValue1, sep) = 1 then\r\n    Delete(AValue1, sep, 1);\r\n\r\n  LastOp := #0;\r\n  Res := True;\r\n\r\n  SetLength(CharArray,5);\r\n  CharArray[0] := '(';\r\n  CharArray[1] := ';';\r\n  CharArray[2] := '^';\r\n  CharArray[3] := '&';\r\n  CharArray[4] := '|';\r\n\r\n  if (AValue1 = '') then\r\n  begin\r\n    Result := (AValue2 = '');\r\n    Exit;\r\n  end;\r\n\r\n  if (AValue1 <> '*') and (AValue2 = '') then\r\n  begin\r\n    Result := False;\r\n    Exit;\r\n  end;\r\n\r\n  repeat\r\n    ch := FirstChar(CharArray, AValue1, sep);\r\n    if ch <> #0 then\r\n    begin\r\n      if (length(AValue1) > 0) and (AValue1[1] = '(') and (pos('(',AValue1) > 0) then\r\n      begin\r\n        cp := ClosingParenthesis(AValue1);\r\n        NewRes := MatchStrEx(copy(AValue1,2,cp - 2),AValue2,ACaseSensitive);\r\n        delete(AValue1,1,cp);\r\n      end\r\n      else\r\n      begin\r\n        NewRes := MatchStr(Copy(AValue1,1,sep - 1),AValue2,ACaseSensitive);\r\n        Delete(AValue1,1,sep);\r\n      end;\r\n\r\n      if LastOp = #0 then\r\n        Res := NewRes\r\n      else\r\n        case LastOp of\r\n        ';','^','|':Res := Res or NewRes;\r\n        '&':Res := Res and NewRes;\r\n        end;\r\n\r\n      LastOp := ch;\r\n     end;\r\n\r\n  until (ch = #0);\r\n\r\n  NewRes := MatchStr(AValue1, AValue2, ACaseSensitive);\r\n\r\n  if LastOp = #0 then\r\n    Res := NewRes\r\n  else\r\n    case LastOp of\r\n    ';','^','|':Res := Res or NewRes;\r\n    '&':Res := Res and NewRes;\r\n    end;\r\n\r\n  Result := Res;\r\nend;\r\n\r\n\r\nprocedure SelectElementContents(AElement: TJSElement);\r\nbegin\r\n  asm\r\n    if (window.getSelection && document.createRange) {\r\n        var sel = window.getSelection();\r\n        var range = document.createRange();\r\n        range.selectNodeContents(AElement);\r\n        sel.removeAllRanges();\r\n        sel.addRange(range);\r\n    } else if (document.selection && document.body.createTextRange) {\r\n        var textRange = document.body.createTextRange();\r\n        textRange.moveToElementText(AElement);\r\n        textRange.select();\r\n    }\r\n  end;\r\nend;\r\n\r\nfunction FormatProp(const AFmt: string; const AArgs: array of const): string;\r\nbegin\r\n  Result := Format(AFmt, AArgs, TFormatSettings.Invariant);\r\nend;\r\n\r\nfunction StringIsFloat(N: string): boolean;\r\nvar\r\n  f: double;\r\nbegin\r\n  Result := TryStrToFloat(N,F);\r\nend;\r\n\r\nfunction StringIsInteger(N: string): boolean;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := True;\r\n  if Trim(N) = '' then\r\n    Exit(False);\r\n\r\n  if (Length(Trim(N)) > 1) and (Trim(N)[1] = '0') then\r\n    Exit(False);\r\n\r\n  if not (N[I] in ['0'..'9','-']) then\r\n    Exit(False);\r\n\r\n  for I := 2 to Length(N) do\r\n  begin\r\n    if not (N[I] in ['0'..'9']) then\r\n    begin\r\n      Result := False;\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction MD5Hash(N: String): string;\r\nvar\r\n  h: string;\r\nbegin\r\n  asm\r\n  function md5(inputString) {\r\n    var hc=\"0123456789abcdef\";\r\n    function rh(n) {var j,s=\"\";for(j=0;j<=3;j++) s+=hc.charAt((n>>(j*8+4))&0x0F)+hc.charAt((n>>(j*8))&0x0F);return s;}\r\n    function ad(x,y) {var l=(x&0xFFFF)+(y&0xFFFF);var m=(x>>16)+(y>>16)+(l>>16);return (m<<16)|(l&0xFFFF);}\r\n    function rl(n,c)            {return (n<<c)|(n>>>(32-c));}\r\n    function cm(q,a,b,x,s,t)    {return ad(rl(ad(ad(a,q),ad(x,t)),s),b);}\r\n    function ff(a,b,c,d,x,s,t)  {return cm((b&c)|((~b)&d),a,b,x,s,t);}\r\n    function gg(a,b,c,d,x,s,t)  {return cm((b&d)|(c&(~d)),a,b,x,s,t);}\r\n    function hh(a,b,c,d,x,s,t)  {return cm(b^c^d,a,b,x,s,t);}\r\n    function ii(a,b,c,d,x,s,t)  {return cm(c^(b|(~d)),a,b,x,s,t);}\r\n    function sb(x) {\r\n        var i;var nblk=((x.length+8)>>6)+1;var blks=new Array(nblk*16);for(i=0;i<nblk*16;i++) blks[i]=0;\r\n        for(i=0;i<x.length;i++) blks[i>>2]|=x.charCodeAt(i)<<((i%4)*8);\r\n        blks[i>>2]|=0x80<<((i%4)*8);blks[nblk*16-2]=x.length*8;return blks;\r\n    }\r\n    var i,x=sb(inputString),a=1732584193,b=-271733879,c=-1732584194,d=271733878,olda,oldb,oldc,oldd;\r\n    for(i=0;i<x.length;i+=16) {olda=a;oldb=b;oldc=c;oldd=d;\r\n        a=ff(a,b,c,d,x[i+ 0], 7, -680876936);d=ff(d,a,b,c,x[i+ 1],12, -389564586);c=ff(c,d,a,b,x[i+ 2],17,  606105819);\r\n        b=ff(b,c,d,a,x[i+ 3],22,-1044525330);a=ff(a,b,c,d,x[i+ 4], 7, -176418897);d=ff(d,a,b,c,x[i+ 5],12, 1200080426);\r\n        c=ff(c,d,a,b,x[i+ 6],17,-1473231341);b=ff(b,c,d,a,x[i+ 7],22,  -45705983);a=ff(a,b,c,d,x[i+ 8], 7, 1770035416);\r\n        d=ff(d,a,b,c,x[i+ 9],12,-1958414417);c=ff(c,d,a,b,x[i+10],17,     -42063);b=ff(b,c,d,a,x[i+11],22,-1990404162);\r\n        a=ff(a,b,c,d,x[i+12], 7, 1804603682);d=ff(d,a,b,c,x[i+13],12,  -40341101);c=ff(c,d,a,b,x[i+14],17,-1502002290);\r\n        b=ff(b,c,d,a,x[i+15],22, 1236535329);a=gg(a,b,c,d,x[i+ 1], 5, -165796510);d=gg(d,a,b,c,x[i+ 6], 9,-1069501632);\r\n        c=gg(c,d,a,b,x[i+11],14,  643717713);b=gg(b,c,d,a,x[i+ 0],20, -373897302);a=gg(a,b,c,d,x[i+ 5], 5, -701558691);\r\n        d=gg(d,a,b,c,x[i+10], 9,   38016083);c=gg(c,d,a,b,x[i+15],14, -660478335);b=gg(b,c,d,a,x[i+ 4],20, -405537848);\r\n        a=gg(a,b,c,d,x[i+ 9], 5,  568446438);d=gg(d,a,b,c,x[i+14], 9,-1019803690);c=gg(c,d,a,b,x[i+ 3],14, -187363961);\r\n        b=gg(b,c,d,a,x[i+ 8],20, 1163531501);a=gg(a,b,c,d,x[i+13], 5,-1444681467);d=gg(d,a,b,c,x[i+ 2], 9,  -51403784);\r\n        c=gg(c,d,a,b,x[i+ 7],14, 1735328473);b=gg(b,c,d,a,x[i+12],20,-1926607734);a=hh(a,b,c,d,x[i+ 5], 4,    -378558);\r\n        d=hh(d,a,b,c,x[i+ 8],11,-2022574463);c=hh(c,d,a,b,x[i+11],16, 1839030562);b=hh(b,c,d,a,x[i+14],23,  -35309556);\r\n        a=hh(a,b,c,d,x[i+ 1], 4,-1530992060);d=hh(d,a,b,c,x[i+ 4],11, 1272893353);c=hh(c,d,a,b,x[i+ 7],16, -155497632);\r\n        b=hh(b,c,d,a,x[i+10],23,-1094730640);a=hh(a,b,c,d,x[i+13], 4,  681279174);d=hh(d,a,b,c,x[i+ 0],11, -358537222);\r\n        c=hh(c,d,a,b,x[i+ 3],16, -722521979);b=hh(b,c,d,a,x[i+ 6],23,   76029189);a=hh(a,b,c,d,x[i+ 9], 4, -640364487);\r\n        d=hh(d,a,b,c,x[i+12],11, -421815835);c=hh(c,d,a,b,x[i+15],16,  530742520);b=hh(b,c,d,a,x[i+ 2],23, -995338651);\r\n        a=ii(a,b,c,d,x[i+ 0], 6, -198630844);d=ii(d,a,b,c,x[i+ 7],10, 1126891415);c=ii(c,d,a,b,x[i+14],15,-1416354905);\r\n        b=ii(b,c,d,a,x[i+ 5],21,  -57434055);a=ii(a,b,c,d,x[i+12], 6, 1700485571);d=ii(d,a,b,c,x[i+ 3],10,-1894986606);\r\n        c=ii(c,d,a,b,x[i+10],15,   -1051523);b=ii(b,c,d,a,x[i+ 1],21,-2054922799);a=ii(a,b,c,d,x[i+ 8], 6, 1873313359);\r\n        d=ii(d,a,b,c,x[i+15],10,  -30611744);c=ii(c,d,a,b,x[i+ 6],15,-1560198380);b=ii(b,c,d,a,x[i+13],21, 1309151649);\r\n        a=ii(a,b,c,d,x[i+ 4], 6, -145523070);d=ii(d,a,b,c,x[i+11],10,-1120210379);c=ii(c,d,a,b,x[i+ 2],15,  718787259);\r\n        b=ii(b,c,d,a,x[i+ 9],21, -343485551);a=ad(a,olda);b=ad(b,oldb);c=ad(c,oldc);d=ad(d,oldd);\r\n    }\r\n    return rh(a)+rh(b)+rh(c)+rh(d);\r\n  }\r\n  h = md5(N);\r\nend;\r\n  Result := h;\r\nend;\r\n\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2022                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.WebTools;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, Web, JS, WEBLib.Controls, WEBLIB.Graphics;\r\n\r\nconst\r\n  CRLF = #13#10;\r\n  LNBR = '<BR>';\r\n  cBodyTag = 'body';\r\n  cHTMLExt = '.html';\r\n\r\n\r\ntype\r\n  TOperatingSystem = (osUnknown, osWindows, osmacOS, osLinux, osAndroid, osiOS);\r\n\r\nfunction DoubleToHTML(d: double): string;\r\n\r\nprocedure MessageBeep(AType: integer);\r\nprocedure OutputDebugString(const s: string);\r\nfunction GetTickCount: longint;\r\nfunction GetQueryParam(AName: string): string;\r\nfunction HasQueryParam(AName: string; var AValue: string): boolean;\r\nfunction EscapeHTML(AValue: string): string;\r\n\r\nfunction GetLocaleShortDateFormat(ALocale: string = ''): string;\r\nfunction GetLocaleLongDayName(DayOfWeek: integer; ALocale: string = ''): string;\r\nfunction GetLocaleShortDayName(DayOfWeek: integer; ALocale: string = ''): string;\r\nfunction GetLocaleLongMonthName(Month: integer; ALocale: string = ''): string;\r\nfunction GetLocaleShortMonthName(Month: integer; ALocale: string = ''): string;\r\nfunction GetLocaleDecimalSeparator(ALocale: string = ''): string;\r\nfunction GetLocaleThousandSeparator(ALocale: string = ''): string;\r\nfunction LocaleFormatCurrency(Value: double; ACurrency: string; ALocale: string = ''): string;\r\nfunction GetLocaleCurrency(ALocale: string = ''): string;\r\nfunction GetBrowserLocale: string;\r\nfunction GetOperatingSystem: TOperatingSystem;\r\nfunction ProcessAccelerator(AValue: string; var Accelerator: string): string;\r\nfunction GetBase64Image(AImage: TJSHTMLElement; AWidth: integer = 0; AHeight: integer = 0): string;\r\nprocedure DebugBreak;\r\nfunction HexImageDecode(s: string): TJSUint8Array;\r\nfunction HexImageEncodeFromBase64(s: string): string;\r\nfunction HexImageEncode(a: TJSUint8Array): string;\r\nfunction HexImageDecodeAsBase64(s: string): string;\r\nfunction EmptyImage: string;\r\nfunction NumAttribute(s: single): string;\r\nfunction DataURLToFile(AURL: string; FileName: string): TJSHTMLFile;\r\nprocedure DownloadFile(AFile: TJSHTMLFile);\r\nfunction URLString(s: string): string;\r\nfunction IsURl(s: string): Boolean;\r\nfunction EmojiString(s: string): string;\r\nfunction HTMLToString(s: string): string;\r\nfunction FileSizeFmt(Size: int64): string;\r\nfunction FileSizeFmtSpeed(Size: int64): string;\r\nfunction ElementVisible(el: TJSHTMLElement): boolean;\r\nfunction GetMaterialGlyph(AGlyph: string; ASize: integer = 0; AColor: TColor = clNone; AType: TMaterialGlyphType = mgNormal): string;\r\n\r\nimplementation\r\n\r\nuses\r\n  SysUtils, WEBLib.Utils;\r\n\r\nfunction EmptyImage: string;\r\nbegin\r\n  Result := 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';\r\nend;\r\n\r\n\r\nfunction DataURLToFile(AURL: string; FileName: string): TJSHTMLFile;\r\nvar\r\n  afile: TJSHTMLFile;\r\nbegin\r\n  asm\r\n    var arr = AURL.split(','),\r\n    mime = arr[0].match(/:(.*?);/)[1],\r\n    bstr = atob(arr[1]),\r\n    n = bstr.length,\r\n    u8arr = new Uint8Array(n);\r\n    while(n--){\r\n      u8arr[n] = bstr.charCodeAt(n);\r\n    }\r\n    afile = new File([u8arr], FileName, {type:mime});\r\n  end;\r\n  Result := afile;\r\nend;\r\n\r\nprocedure DownloadFile(AFile: TJSHTMLFile);\r\nvar\r\n  a: TJSHTMLLinkElement;\r\nbegin\r\n  a := TJSHTMLLinkElement(document.createElement('a'));\r\n  asm\r\n    a.href = window.URL.createObjectURL(AFile);\r\n    a.download = AFile.name;\r\n  end;\r\n  a.click;\r\nend;\r\n\r\nfunction HexImageDecode(s: string): TJSUint8Array;\r\nvar\r\n  i,j,l: integer;\r\n  res: TJSUint8Array;\r\n  c1,c2: byte;\r\n  hdr: byte;\r\nbegin\r\n  l := Length(s) div 2;\r\n  j := 0;\r\n\r\n  c1 := ord(s[1]) - 48;\r\n  if c1 >= 10 then\r\n    c1 := c1 - 7;\r\n\r\n  c2 := ord(s[2]) -48;\r\n  if c2 >= 10 then\r\n    c2 := c2 - 7;\r\n\r\n  hdr := 1 + (c2 +  (c1 shl 4));\r\n\r\n  i := pos('4A5045474',s);\r\n  // possible extra 4 bytes when TJPEGImage?\r\n  if (i > 1) and (i < 10) then\r\n    inc(hdr,4);\r\n\r\n  i := pos('4269746D6',s);\r\n  // possible extra 4 bytes when TBitmap?\r\n  if (i > 1) and (i < 10) then\r\n    inc(hdr,4);\r\n\r\n  res := TJSUint8Array.new(l - hdr);\r\n\r\n  for i := hdr + 1 to l do\r\n  begin\r\n    c1 := ord(s[i*2 - 1]) - 48;\r\n    if c1 >= 10 then\r\n      c1 := c1 - 7;\r\n\r\n    c2 := ord(s[i*2]) -48;\r\n    if c2 >= 10 then\r\n      c2 := c2 - 7;\r\n\r\n    c2 := c2 +  (c1 shl 4);\r\n\r\n    res[j] := c2;\r\n    inc(j);\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction HexImageEncode(a: TJSUint8Array): string;\r\nvar\r\n  i,l: integer;\r\n  b: byte;\r\n  s,ls: string;\r\nbegin\r\n  Result := '';\r\n\r\n  l := a.length;\r\n\r\n  if l = 0 then\r\n    Exit;\r\n\r\n  l := (l and $FF) shl 24 + (l and $FF00) shl 8 +  (l and $FF0000) shr 8 + (l and $FF000000) shr 24;\r\n\r\n  ls := '';\r\n\r\n  if (a[0] = 137) and (a[1] = 80) then\r\n  begin\r\n    s := 'TPngImage';\r\n    b := Length(s);\r\n  end;\r\n\r\n  if (a[0] = $FF) and (a[1] = $D8) then\r\n  begin\r\n    s := 'TJPEGImage';\r\n    b := Length(s);\r\n    ls := inttohex(l,8);\r\n  end;\r\n\r\n  if (a[0] = 66) and (a[1] = 77) then\r\n  begin\r\n    s := 'TBitmap';\r\n    b := Length(s);\r\n    ls := inttohex(l,8);\r\n  end;\r\n\r\n  if (a[0] = 71) and (a[1] = 73) then\r\n  begin\r\n    s := 'TGIFImage';\r\n    b := Length(s);\r\n  end;\r\n\r\n  Result := inttohex(b,2);\r\n\r\n  for i := 1 to length(s) do\r\n  begin\r\n    b := ord(s[i]);\r\n    Result := Result + inttohex(b,2);\r\n  end;\r\n\r\n  Result := Result + ls;\r\n\r\n  for i := 0 to a.length - 1 do\r\n  begin\r\n    b := a[i];\r\n    Result := Result + inttohex(b,2);\r\n  end;\r\nend;\r\n\r\nfunction URLString(s: string): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    function linkify(inputText) {\r\n    var replacedText, replacePattern1, replacePattern2, replacePattern3;\r\n\r\n    //URLs starting with http://, https://, or ftp://\r\n    replacePattern1 = /(\\b(https?|ftp):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gim;\r\n    replacedText = inputText.replace(replacePattern1, '<a href=\"$1\" target=\"_blank\">$1</a>');\r\n\r\n    //URLs starting with \"www.\" (without // before it, or it'd re-link the ones done above).\r\n    replacePattern2 = /(^|[^\\/])(www\\.[\\S]+(\\b|$))/gim;\r\n    replacedText = replacedText.replace(replacePattern2, '$1<a href=\"http://$2\" target=\"_blank\">$2</a>');\r\n\r\n    //Change email addresses to mailto:: links.\r\n    replacePattern3 = /(([a-zA-Z0-9\\-\\_\\.])+@[a-zA-Z\\_]+?(\\.[a-zA-Z]{2,6})+)/gim;\r\n    replacedText = replacedText.replace(replacePattern3, '<a href=\"mailto:$1\">$1</a>');\r\n\r\n    return replacedText;\r\n    }\r\n    res = linkify(s);\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction IsURl(s: string): Boolean;\r\nvar\r\n  res: Boolean;\r\nbegin\r\n  asm\r\n  function CheckIsUrl(inputText) {\r\n    if(new RegExp(\"([a-zA-Z0-9]+://)?([a-zA-Z0-9_]+:[a-zA-Z0-9_]+@)?([a-zA-Z0-9.-]+\\\\.[A-Za-z]{2,4})(:[0-9]+)?(/.*)?\").test(inputText)) {\r\n        return true;\r\n    }\r\n    return false;\r\n    }\r\n    res = CheckIsUrl(s);\r\n  end; \r\n  Result := res; \r\nend;\r\n\r\nfunction HTMLToString(s: string): string;\r\nbegin\r\n  s := StringReplace(s,'<','&lt;',[rfReplaceAll]);\r\n  Result := StringReplace(s,'>','&gt;',[rfReplaceAll]);\r\nend;\r\n\r\n// info\r\n// https://unicode.org/emoji/charts/full-emoji-list.html\r\n// https://en.wikipedia.org/wiki/List_of_emoticons\r\n\r\nfunction Emojistring(s: string): string;\r\nvar\r\n  ls: TStringList;\r\n  i: integer;\r\n  v,k: string;\r\nbegin\r\n  for i := 1 to Length(s) do\r\n    if s[i] = '|' then\r\n      s[i] := '';\r\n\r\n  ls := TStringList.Create;\r\n  ls.AddPair(':)','&#x1F600;');\r\n  ls.AddPair(':D','&#x1F601;');\r\n  ls.AddPair(';)','&#x1F609;');\r\n  ls.AddPair(':O','&#x1F62E;');\r\n  ls.AddPair(':*','&#x1F617;');\r\n  ls.AddPair(':P','&#x1F61C;');\r\n  ls.AddPair(':(','&#x1F641;');\r\n  ls.AddPair(':','&#x1F610;');\r\n  ls.AddPair(':X','&#x1F910;');\r\n  ls.AddPair(';)','&#x1F60E;');\r\n  ls.AddPair(':<','&#x1F621;');\r\n\r\n  for i := 0 to ls.Count - 1 do\r\n  begin\r\n    v := ls.Names[i];\r\n    k := ls.Values[v];\r\n    s := StringReplace(s,v,k,[rfReplaceAll]);\r\n  end;\r\n\r\n  ls.Free;\r\n\r\n  Result := s;\r\nend;\r\n\r\n{$HINTS OFF}\r\n\r\nfunction HexImageEncodeFromBase64(s: string): string;\r\nvar\r\n  ja: TJSUint8Array;\r\nbegin\r\n  asm\r\n    s = s.replace(/^data:image\\/\\S+;base64,/, \"\");\r\n    //ja = Uint8Array.from(atob(s), c => c.charCodeAt(0))\r\n    ja = Uint8Array.from(atob(s), function(c) { return c.charCodeAt(0);} )\r\n  end;\r\n\r\n  Result := HexImageEncode(ja);\r\nend;\r\n\r\nfunction HexImageDecodeAsBase64(s: string): string;\r\nvar\r\n  ja: TJSUint8Array;\r\nbegin\r\n  ja := HexImageDecode(s);\r\n  asm\r\n    s = btoa(new Uint8Array(ja).reduce(function (data, byte) {\r\n      return data + String.fromCharCode(byte);\r\n      }, ''));\r\n  end;\r\n  Result := s;\r\nend;\r\n\r\nfunction GetBase64Image(AImage: TJSHTMLElement; AWidth: integer = 0; AHeight: integer = 0): string;\r\nvar\r\n  s: string;\r\n  m: TJSHTMLElement;\r\nbegin\r\n  s := '';\r\n  m := AImage;\r\n  asm\r\n    function getBase64Image(img) {\r\n      var canvas = document.createElement(\"canvas\");\r\n      if (AWidth == 0) {\r\n        canvas.width = img.width; }\r\n        else {\r\n        canvas.width = AWidth; }\r\n      if (AHeight == 0) {\r\n      canvas.height = img.height; }\r\n      else {\r\n        canvas.height = AHeight; }\r\n      var ctx = canvas.getContext(\"2d\");\r\n      if ((AWidth == 0) || (AHeight == 0)) {\r\n         ctx.drawImage(img, 0, 0); }\r\n      else {\r\n         ctx.drawImage(img, 0, 0, AWidth, AHeight); }\r\n      var dataURL = canvas.toDataURL(\"image/png\");\r\n      return dataURL.replace(/^data:image\\/(png|jpg);base64,/, \"\");\r\n    }\r\n    s = getBase64Image(m);\r\n  end;\r\n  Result := s;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure DebugBreak;\r\n  asm\r\n    debugger;\r\n  end;\r\n\r\nfunction DoubleToHTML(d: double): string;\r\nbegin\r\n  Result := Format('%g',[d], TFormatSettings.Invariant);\r\nend;\r\n\r\nprocedure OutputDebugString(const s: string);\r\nbegin\r\n  asm\r\n    console.log(s);\r\n  end;\r\nend;\r\n\r\nfunction GetTickCount: longint;\r\nvar\r\n  n: longint;\r\nbegin\r\n  asm\r\n    var d = new Date();\r\n    n = d.getTime();\r\n  end;\r\n\r\n  Result := n;\r\nend;\r\n\r\nfunction HasQueryParam(AName: string; var AValue: string): boolean;\r\nvar\r\n  found: boolean;\r\n  s: string;\r\nbegin\r\n  s := '';\r\n  asm\r\n    var query = window.location.search.substring(1);\r\n    var res = \"\";\r\n    found = false;\r\n    var vars = query.split('&');\r\n    for (var i = 0; i < vars.length; i++) {\r\n       var pair = vars[i].split('=');\r\n      if (decodeURIComponent(pair[0]) == AName) {\r\n          res = decodeURIComponent(pair[1]);\r\n          found = true;\r\n       }\r\n    }\r\n    s = res;\r\n  end;\r\n\r\n  AValue := s;\r\n  Result := found;\r\nend;\r\n\r\nfunction GetQueryParam(AName: string): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  HasQueryParam(AName,res);\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction GetLocaleShortDateFormat(ALocale: string = ''): string;\r\nbegin\r\n  Result := TFormatSettings.Create(ALocale).ShortDateFormat;\r\nend;\r\n\r\nfunction GetLocaleLongDayName(DayOfWeek: integer; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var baseDate = new Date(2017, 0, 1); // Sunday\r\n    baseDate.setDate(baseDate.getDate() + DayOfWeek - 1);\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = baseDate.toLocaleDateString(loc, { weekday: 'long' });\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleShortDayName(DayOfWeek: integer; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var baseDate = new Date(2017, 0, 1); // Sunday\r\n    baseDate.setDate(baseDate.getDate() + DayOfWeek - 1);\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = baseDate.toLocaleDateString(loc, { weekday: 'short' });\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleLongMonthName(Month: integer; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var baseDate = new Date(2017, Month - 1, 1);\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = baseDate.toLocaleDateString(loc, { month: 'long' });\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleShortMonthName(Month: integer; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var baseDate = new Date(2017, Month - 1, 1);\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = baseDate.toLocaleDateString(loc, { month: 'short' });\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleDecimalSeparator(ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var n = 1.1;\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    n = n.toLocaleString(loc).substring(1, 2);\r\n    res = n;\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleThousandSeparator(ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var n = 1000.1;\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n    n = n.toLocaleString(loc).substring(1, 2);\r\n    res = n;\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction LocaleFormatCurrency(Value: double; ACurrency: string; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n\r\n  asm\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n    var number = Value;\r\n    res = number.toLocaleString(loc, { style: 'currency', currency: ACurrency });\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleCurrency(ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var curr =\r\n      {\"BD\": \"BDT\", \"BE\": \"EUR\", \"BF\": \"XOF\", \"BG\": \"BGN\", \"BA\": \"BAM\", \"BB\": \"BBD\", \"WF\": \"XPF\",\r\n       \"BL\": \"EUR\", \"BM\": \"BMD\", \"BN\": \"BND\", \"BO\": \"BOB\", \"BH\": \"BHD\", \"BI\": \"BIF\", \"BJ\": \"XOF\",\r\n       \"BT\": \"BTN\", \"JM\": \"JMD\", \"BV\": \"NOK\", \"BW\": \"BWP\", \"WS\": \"WST\", \"BQ\": \"USD\", \"BR\": \"BRL\",\r\n       \"BS\": \"BSD\", \"JE\": \"GBP\", \"BY\": \"BYR\", \"BZ\": \"BZD\", \"RU\": \"RUB\", \"RW\": \"RWF\", \"RS\": \"RSD\",\r\n       \"TL\": \"USD\", \"RE\": \"EUR\", \"TM\": \"TMT\", \"TJ\": \"TJS\", \"RO\": \"RON\", \"TK\": \"NZD\", \"GW\": \"XOF\",\r\n       \"GU\": \"USD\", \"GT\": \"GTQ\", \"GS\": \"GBP\", \"GR\": \"EUR\", \"GQ\": \"XAF\", \"GP\": \"EUR\", \"JP\": \"JPY\",\r\n       \"GY\": \"GYD\", \"GG\": \"GBP\", \"GF\": \"EUR\", \"GE\": \"GEL\", \"GD\": \"XCD\", \"GB\": \"GBP\", \"GA\": \"XAF\",\r\n       \"SV\": \"USD\", \"GN\": \"GNF\", \"GM\": \"GMD\", \"GL\": \"DKK\", \"GI\": \"GIP\", \"GH\": \"GHS\", \"OM\": \"OMR\",\r\n       \"TN\": \"TND\", \"JO\": \"JOD\", \"HR\": \"HRK\", \"HT\": \"HTG\", \"HU\": \"HUF\", \"HK\": \"HKD\", \"HN\": \"HNL\",\r\n       \"HM\": \"AUD\", \"VE\": \"VEF\", \"PR\": \"USD\", \"PS\": \"ILS\", \"PW\": \"USD\", \"PT\": \"EUR\", \"SJ\": \"NOK\",\r\n       \"PY\": \"PYG\", \"IQ\": \"IQD\", \"PA\": \"PAB\", \"PF\": \"XPF\", \"PG\": \"PGK\", \"PE\": \"PEN\", \"PK\": \"PKR\",\r\n       \"PH\": \"PHP\", \"PN\": \"NZD\", \"PL\": \"PLN\", \"PM\": \"EUR\", \"ZM\": \"ZMK\", \"EH\": \"MAD\", \"EE\": \"EUR\",\r\n       \"EG\": \"EGP\", \"ZA\": \"ZAR\", \"EC\": \"USD\", \"IT\": \"EUR\", \"VN\": \"VND\", \"SB\": \"SBD\", \"ET\": \"ETB\",\r\n       \"SO\": \"SOS\", \"ZW\": \"ZWL\", \"SA\": \"SAR\", \"ES\": \"EUR\", \"ER\": \"ERN\", \"ME\": \"EUR\", \"MD\": \"MDL\",\r\n       \"MG\": \"MGA\", \"MF\": \"EUR\", \"MA\": \"MAD\", \"MC\": \"EUR\", \"UZ\": \"UZS\", \"MM\": \"MMK\", \"ML\": \"XOF\",\r\n       \"MO\": \"MOP\", \"MN\": \"MNT\", \"MH\": \"USD\", \"MK\": \"MKD\", \"MU\": \"MUR\", \"MT\": \"EUR\", \"MW\": \"MWK\",\r\n       \"MV\": \"MVR\", \"MQ\": \"EUR\", \"MP\": \"USD\", \"MS\": \"XCD\", \"MR\": \"MRO\", \"IM\": \"GBP\", \"UG\": \"UGX\",\r\n       \"TZ\": \"TZS\", \"MY\": \"MYR\", \"MX\": \"MXN\", \"IL\": \"ILS\", \"FR\": \"EUR\", \"IO\": \"USD\", \"SH\": \"SHP\",\r\n       \"FI\": \"EUR\", \"FJ\": \"FJD\", \"FK\": \"FKP\", \"FM\": \"USD\", \"FO\": \"DKK\", \"NI\": \"NIO\", \"NL\": \"EUR\",\r\n       \"NO\": \"NOK\", \"NA\": \"NAD\", \"VU\": \"VUV\", \"NC\": \"XPF\", \"NE\": \"XOF\", \"NF\": \"AUD\", \"NG\": \"NGN\",\r\n       \"NZ\": \"NZD\", \"NP\": \"NPR\", \"NR\": \"AUD\", \"NU\": \"NZD\", \"CK\": \"NZD\", \"XK\": \"EUR\", \"CI\": \"XOF\",\r\n       \"CH\": \"CHF\", \"CO\": \"COP\", \"CN\": \"CNY\", \"CM\": \"XAF\", \"CL\": \"CLP\", \"CC\": \"AUD\", \"CA\": \"CAD\",\r\n       \"CG\": \"XAF\", \"CF\": \"XAF\", \"CD\": \"CDF\", \"CZ\": \"CZK\", \"CY\": \"EUR\", \"CX\": \"AUD\", \"CR\": \"CRC\",\r\n       \"CW\": \"ANG\", \"CV\": \"CVE\", \"CU\": \"CUP\", \"SZ\": \"SZL\", \"SY\": \"SYP\", \"SX\": \"ANG\", \"KG\": \"KGS\",\r\n       \"KE\": \"KES\", \"SS\": \"SSP\", \"SR\": \"SRD\", \"KI\": \"AUD\", \"KH\": \"KHR\", \"KN\": \"XCD\", \"KM\": \"KMF\",\r\n       \"ST\": \"STD\", \"SK\": \"EUR\", \"KR\": \"KRW\", \"SI\": \"EUR\", \"KP\": \"KPW\", \"KW\": \"KWD\", \"SN\": \"XOF\",\r\n       \"SM\": \"EUR\", \"SL\": \"SLL\", \"SC\": \"SCR\", \"KZ\": \"KZT\", \"KY\": \"KYD\", \"SG\": \"SGD\", \"SE\": \"SEK\",\r\n       \"SD\": \"SDG\", \"DO\": \"DOP\", \"DM\": \"XCD\", \"DJ\": \"DJF\", \"DK\": \"DKK\", \"VG\": \"USD\", \"DE\": \"EUR\",\r\n       \"YE\": \"YER\", \"DZ\": \"DZD\", \"US\": \"USD\", \"UY\": \"UYU\", \"YT\": \"EUR\", \"UM\": \"USD\", \"LB\": \"LBP\",\r\n       \"LC\": \"XCD\", \"LA\": \"LAK\", \"TV\": \"AUD\", \"TW\": \"TWD\", \"TT\": \"TTD\", \"TR\": \"TRY\", \"LK\": \"LKR\",\r\n       \"LI\": \"CHF\", \"LV\": \"EUR\", \"TO\": \"TOP\", \"LT\": \"LTL\", \"LU\": \"EUR\", \"LR\": \"LRD\", \"LS\": \"LSL\",\r\n       \"TH\": \"THB\", \"TF\": \"EUR\", \"TG\": \"XOF\", \"TD\": \"XAF\", \"TC\": \"USD\", \"LY\": \"LYD\", \"VA\": \"EUR\",\r\n       \"VC\": \"XCD\", \"AE\": \"AED\", \"AD\": \"EUR\", \"AG\": \"XCD\", \"AF\": \"AFN\", \"AI\": \"XCD\", \"VI\": \"USD\",\r\n       \"IS\": \"ISK\", \"IR\": \"IRR\", \"AM\": \"AMD\", \"AL\": \"ALL\", \"AO\": \"AOA\", \"AQ\": \"\", \"AS\": \"USD\",\r\n       \"AR\": \"ARS\", \"AU\": \"AUD\", \"AT\": \"EUR\", \"AW\": \"AWG\", \"IN\": \"INR\", \"AX\": \"EUR\", \"AZ\": \"AZN\",\r\n       \"IE\": \"EUR\", \"ID\": \"IDR\", \"UA\": \"UAH\", \"QA\": \"QAR\", \"MZ\": \"MZN\"}\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n    loc = loc.substring(3,5);\r\n    loc = loc.toUpperCase();\r\n    res = curr[loc] || '';\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\n\r\n\r\nfunction GetBrowserLocale: string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    res = navigator.language\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction ProcessAccelerator(AValue: string; var Accelerator: string): string;\r\nvar\r\n  i,l: integer;\r\n  res: string;\r\nbegin\r\n  l := Length(AValue);\r\n\r\n  Accelerator := '';\r\n\r\n  res := '';\r\n\r\n  i := 1;\r\n  while (i <= l) do\r\n  begin\r\n    if (AValue[i] = '&') then\r\n    begin\r\n      if (i + 1 <= l) and (AValue[i + 1] <> '&') then\r\n      begin\r\n        res := res + '<u>' + AValue[i + 1] + '</u>';\r\n        Accelerator := AValue[i + 1];\r\n      end\r\n      else\r\n      if (i + 1 <= l) and (AValue[i + 1] = '&') then\r\n        res := res + '&';\r\n      inc(i, 2);\r\n    end\r\n    else\r\n    begin\r\n      res := res + AValue[i];\r\n      inc(i);\r\n    end;\r\n\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction EscapeHTML(AValue: string): string;\r\nvar\r\n  s: string;\r\nbegin\r\n  s := AValue;\r\n  asm\r\n    function escapeHTML(AString) {\r\n      return AString.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');\r\n    }\r\n    s = escapeHTML(s);\r\n  end;\r\n  Result := s;\r\nend;\r\n\r\nfunction NumAttribute(s: single): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  res := s.ToString;\r\n  Result := StringReplace(res, ',','.',[rfReplaceAll]);\r\nend;\r\n\r\nfunction FileSizeFmt(Size: int64): string;\r\nbegin\r\n  if Size < 1000 then\r\n    Result := IntToStr(Size) + ' bytes';\r\n  if (Size >= 1000) and (Size < 1000000) then\r\n    Result := Format('%.2f',[Size/1000])+' Kb';\r\n  if (Size >= 1000000) and (Size < 1000000000) then\r\n    Result := Format('%.2f',[Size/1000000])+' Mb';\r\n  if Size >= 1000000000 then\r\n    Result := Format('%.2f',[Size/1000000000])+' Gb'\r\nend;\r\n\r\nfunction FileSizeFmtSpeed(Size: int64): string;\r\nbegin\r\n  if Size < 1000 then\r\n    Result := IntToStr(Size)+' bytes/sec';\r\n  if (Size >= 1000) and (Size < 1000000) then\r\n    Result := Format('%.2f',[Size/1000])+' Kb/sec';\r\n  if (Size >= 1000000) and (Size < 1000000000) then\r\n    Result := Format('%.2f',[Size/1000000])+' Mb/sec';\r\n  if (Size >= 1000000000) then\r\n    Result := Format('%.2f',[Size/1000000000])+' Gb/sec';\r\nend;\r\n\r\nfunction GetOperatingSystem: TOperatingSystem;\r\nvar\r\n  ag: string;\r\n  res: boolean;\r\nbegin\r\n  Result := osUnknown;\r\n\r\n  asm\r\n    ag = navigator.userAgent;\r\n  end;\r\n\r\n  if pos('Win',ag) > 0 then\r\n    Result := osWindows;\r\n\r\n  if pos('Mac',ag) > 0 then\r\n    Result := osmacOS;\r\n\r\n  if pos('Linux',ag) > 0 then\r\n    Result := osLinux;\r\n\r\n  if pos('Android',ag) > 0 then\r\n    Result := osAndroid;\r\n\r\n  if pos('Linux',ag) > 0 then\r\n    Result := osLinux;\r\n\r\n  asm\r\n    res = ag.match(/(iPod|iPhone|iPad)/) &&\r\n    ag.match(/AppleWebKit/);\r\n  end;\r\n\r\n  if res then\r\n    Result := osiOS;\r\nend;\r\n\r\n{$HINTS OFF}\r\n\r\nfunction ElementVisible(el: TJSHTMLElement): boolean;\r\nvar\r\n  p: TJSElement;\r\nbegin\r\n  Result := false;\r\n\r\n  p := el;\r\n  while Assigned(p) do\r\n  begin\r\n    if (lowercase(p.tagName) = cBodyTag) then\r\n      Result := true;\r\n    p := p.parentElement;\r\n  end;\r\n\r\n  if not Result then\r\n    // element is not in the DOM, so not visible\r\n    Exit;\r\n\r\n  while Assigned(el) do\r\n  begin\r\n    if el.style.getPropertyValue('display') = 'none' then\r\n    begin\r\n      Result := false;\r\n      exit;\r\n    end;\r\n    p := el.parentElement;\r\n    if not (p is TJSHTMLElement) then\r\n      Exit;\r\n    el := TJSHTMLElement(p);\r\n  end;\r\nend;\r\n\r\nfunction GetMaterialGlyph(AGlyph: string; ASize: integer = 0; AColor: TColor = clNone; AType: TMaterialGlyphType = mgNormal): string;\r\nvar\r\n  s: string;\r\n  matclr, matsize: string;\r\nbegin\r\n  s := '<i';\r\n\r\n  s := s  + ' class=\"' + GetMaterialClass(AType)+'\"';\r\n\r\n  matclr := '';\r\n\r\n  if AColor <> clNone then\r\n    matclr := 'color:'+ColorToHTML(AColor)+';';\r\n\r\n  matsize := '';\r\n\r\n  if ASize <> 0 then\r\n    matsize := 'font-size:'+IntToStr(ASize)+'px;';\r\n\r\n  s := s + ' style=\"pointer-events:none;' + matclr + matsize +'\"';\r\n\r\n  Result := s + '>' +  AGlyph + '</i>';\r\nend;\r\n\r\n\r\nprocedure MessageBeep(AType: integer);\r\nbegin\r\n  asm\r\n    var snd = new Audio(\"data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeI\"+\r\n        \"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\"+\r\n\t\"eFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZ\"+\r\n\t\"B4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZ\"+\r\n\t\"TGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRP\"+\r\n\t\"gUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCk\"+\r\n\t\"QjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk\"+\r\n\t\"4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb////////////////////////////////////////////////////////////////////////////////////////////\"+\r\n\t\"////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\"+\r\n\t\"////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\"+\r\n\t\"/////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=\");\r\n    snd.play();\r\n  end;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Free Component Library (FCL)\r\n    Copyright (c) 2002 by Florian Klaempfl\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n{$mode objfpc}\r\n\r\nunit contnrs;\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils, Classes;\r\n\r\n\r\nType\r\n  TObjectListCallback = Reference to Procedure(data:TObject;arg:JSValue);\r\n\r\n  TFPObjectList = class(TObject)\r\n  private\r\n    FFreeObjects : Boolean;\r\n    FList: TFPList;\r\n    Function GetCount: integer;\r\n    Procedure SetCount(const AValue: integer);\r\n  protected\r\n    Function GetItem(Index: Integer): TObject;\r\n    Procedure SetItem(Index: Integer; AObject: TObject);\r\n    Procedure SetCapacity(NewCapacity: Integer);\r\n    Function GetCapacity: integer;\r\n  public\r\n    constructor Create; reintroduce;\r\n    constructor Create(FreeObjects : Boolean);\r\n    destructor Destroy; override;\r\n    Procedure Clear;\r\n    Function Add(AObject: TObject): Integer;\r\n    Procedure Delete(Index: Integer);\r\n    Procedure Exchange(Index1, Index2: Integer);\r\n    Function Expand: TFPObjectList;\r\n    Function Extract(Item: TObject): TObject;\r\n    Function Remove(AObject: TObject): Integer;\r\n    Function IndexOf(AObject: TObject): Integer;\r\n    Function FindInstanceOf(AClass: TClass; AExact: Boolean; AStartAt: Integer): Integer;\r\n    Procedure Insert(Index: Integer; AObject: TObject);\r\n    Function First: TObject;\r\n    Function Last: TObject;\r\n    Procedure Move(CurIndex, NewIndex: Integer);\r\n    Procedure Assign(Obj:TFPObjectList);\r\n    Procedure Pack;\r\n    Procedure Sort(Compare: TListSortCompare);\r\n    Procedure ForEachCall(proc2call:TObjectListCallback;arg:JSValue);\r\n    property Capacity: Integer read GetCapacity write SetCapacity;\r\n    property Count: Integer read GetCount write SetCount;\r\n    property OwnsObjects: Boolean read FFreeObjects write FFreeObjects;\r\n    property Items[Index: Integer]: TObject read GetItem write SetItem; default;\r\n    property List: TFPList read FList;\r\n  end;\r\n\r\n\r\n  { TObjectList }\r\n\r\n  TObjectList = class(TList)\r\n  private\r\n    FFreeObjects : Boolean;\r\n  Protected\r\n    Procedure Notify(Ptr: JSValue; Action: TListNotification); override;\r\n    Function GetItem(Index: Integer): TObject;\r\n    Procedure SetItem(Index: Integer; AObject: TObject);\r\n  public\r\n    constructor Create; reintroduce;\r\n    constructor Create(FreeObjects : boolean);\r\n    Function Add(AObject: TObject): Integer; reintroduce;\r\n    Function Extract(Item: TObject): TObject; reintroduce;\r\n    Function Remove(AObject: TObject): Integer; reintroduce;\r\n    Function IndexOf(AObject: TObject): Integer; reintroduce;\r\n    Function FindInstanceOf(AClass: TClass; AExact: Boolean; AStartAt: Integer): Integer;\r\n    Procedure Insert(Index: Integer; AObject: TObject); reintroduce;\r\n    Function First: TObject; reintroduce;\r\n    Function Last: TObject; reintroduce;\r\n    property OwnsObjects: Boolean read FFreeObjects write FFreeObjects;\r\n    property Items[Index: Integer]: TObject read GetItem write SetItem; default;\r\n  end;\r\n\r\n  TComponentList = class(TObjectList)\r\n  Private\r\n    FNotifier : TComponent;\r\n  Protected\r\n    Procedure Notify(Ptr: JSValue; Action: TListNotification); override;\r\n    Function GetItems(Index: Integer): TComponent;\r\n    Procedure SetItems(Index: Integer; AComponent: TComponent);\r\n    Procedure HandleFreeNotify(Sender: TObject; AComponent: TComponent);\r\n  public\r\n    destructor Destroy; override;\r\n    Function Add(AComponent: TComponent): Integer; reintroduce;\r\n    Function Extract(Item: TComponent): TComponent; reintroduce;\r\n    Function Remove(AComponent: TComponent): Integer; reintroduce;\r\n    Function IndexOf(AComponent: TComponent): Integer; reintroduce;\r\n    Function First: TComponent; reintroduce;\r\n    Function Last: TComponent; reintroduce;\r\n    Procedure Insert(Index: Integer; AComponent: TComponent); reintroduce;\r\n    property Items[Index: Integer]: TComponent read GetItems write SetItems; default;\r\n  end;\r\n\r\n  TClassList = class(TList)\r\n  protected\r\n    Function GetItems(Index: Integer): TClass;\r\n    Procedure SetItems(Index: Integer; AClass: TClass);\r\n  public\r\n    Function Add(AClass: TClass): Integer; reintroduce;\r\n    Function Extract(Item: TClass): TClass; reintroduce;\r\n    Function Remove(AClass: TClass): Integer; reintroduce;\r\n    Function IndexOf(AClass: TClass): Integer; reintroduce;\r\n    Function First: TClass; reintroduce;\r\n    Function Last: TClass; reintroduce;\r\n    Procedure Insert(Index: Integer; AClass: TClass); reintroduce;\r\n    property Items[Index: Integer]: TClass read GetItems write SetItems; default;\r\n  end;\r\n\r\n  TOrderedList = class(TObject)\r\n  private\r\n    FList: TList;\r\n  protected\r\n    Procedure PushItem(AItem: JSValue); virtual; abstract;\r\n    Function PopItem: JSValue; virtual;\r\n    Function PeekItem: JSValue; virtual;\r\n    property List: TList read FList;\r\n  public\r\n    constructor Create; reintroduce;\r\n    destructor Destroy; override;\r\n    Function Count: Integer;\r\n    Function AtLeast(ACount: Integer): Boolean;\r\n    Function Push(AItem: JSValue): JSValue;\r\n    Function Pop: JSValue;\r\n    Function Peek: JSValue;\r\n  end;\r\n\r\n{ TStack class }\r\n\r\n  TStack = class(TOrderedList)\r\n  protected\r\n    Procedure PushItem(AItem: JSValue); override;\r\n  end;\r\n\r\n{ TObjectStack class }\r\n\r\n  TObjectStack = class(TStack)\r\n  public\r\n    Function Push(AObject: TObject): TObject; reintroduce;\r\n    Function Pop: TObject; reintroduce;\r\n    Function Peek: TObject; reintroduce;\r\n  end;\r\n\r\n{ TQueue class }\r\n\r\n  TQueue = class(TOrderedList)\r\n  protected\r\n    Procedure PushItem(AItem: JSValue); override;\r\n  end;\r\n\r\n{ TObjectQueue class }\r\n\r\n  TObjectQueue = class(TQueue)\r\n  public\r\n    Function Push(AObject: TObject): TObject; reintroduce;\r\n    Function Pop: TObject; reintroduce;\r\n    Function Peek: TObject; reintroduce;\r\n  end;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Hash support, implemented by Dean Zobec\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\n  { Must return a Longword value in the range 0..TableSize,\r\n   usually via a mod operator;  }\r\n  THashFunction = Function(const S: string; const TableSize: Longword): Longword;\r\n\r\n\r\n  { THTNode }\r\n\r\n  THTCustomNode = class(TObject)\r\n  private\r\n    FKey: string;\r\n  public\r\n    constructor CreateWith(const AString: String);\r\n    Function HasKey(const AKey: string): boolean;\r\n    property Key: string read FKey;\r\n  end;\r\n  THTCustomNodeClass = Class of THTCustomNode;\r\n\r\n\r\n  { TFPCustomHashTable }\r\n\r\n  TFPCustomHashTable = class(TObject)\r\n  private\r\n    FHashTable: TFPObjectList;\r\n    FHashFunction: THashFunction;\r\n    FCount: Longword;\r\n    Function GetDensity: Longword;\r\n    Function GetNumberOfCollisions: Longword;\r\n    Procedure SetHashTableSize(const Value: Longword);\r\n    Procedure InitializeHashTable;\r\n    Function GetVoidSlots: Longword;\r\n    Function GetLoadFactor: double;\r\n    Function GetAVGChainLen: double;\r\n    Function GetMaxChainLength: Longword;\r\n  protected\r\n    FHashTableSize: Longword;\r\n    Function Chain(const index: Longword):TFPObjectList;\r\n    Function CreateNewNode(const aKey : string) : THTCustomNode; virtual; abstract;\r\n    Procedure AddNode(ANode : THTCustomNode); virtual; abstract;\r\n    Function ChainLength(const ChainIndex: Longword): Longword; virtual;\r\n    Function FindOrCreateNew(const aKey: string): THTCustomNode; virtual;\r\n    Procedure SetHashFunction(AHashFunction: THashFunction); virtual;\r\n    Function FindChainForAdd(Const aKey : String) : TFPObjectList;\r\n  public\r\n    constructor Create; reintroduce;\r\n    constructor CreateWith(AHashTableSize: Longword; aHashFunc: THashFunction);\r\n    destructor Destroy; override;\r\n    Procedure ChangeTableSize(const ANewSize: Longword); virtual;\r\n    Procedure Clear; virtual;\r\n    Procedure Delete(const aKey: string); virtual;\r\n    Function Find(const aKey: string): THTCustomNode;\r\n    Function IsEmpty: boolean;\r\n    property HashFunction: THashFunction read FHashFunction write SetHashFunction;\r\n    property Count: Longword read FCount;\r\n    property HashTableSize: Longword read FHashTableSize write SetHashTableSize;\r\n    property HashTable: TFPObjectList read FHashTable;\r\n    property VoidSlots: Longword read GetVoidSlots;\r\n    property LoadFactor: double read GetLoadFactor;\r\n    property AVGChainLen: double read GetAVGChainLen;\r\n    property MaxChainLength: Longword read GetMaxChainLength;\r\n    property NumberOfCollisions: Longword read GetNumberOfCollisions;\r\n    property Density: Longword read GetDensity;\r\n  end;\r\n\r\n  { TFPDataHashTable : Hash table with simple data JSValues }\r\n\r\n  THTDataNode = Class(THTCustomNode)\r\n  Private\r\n    FData: JSValue;\r\n  public\r\n    property Data: JSValue read FData write FData;\r\n  end;\r\n  // For compatibility\r\n  THTNode = THTDataNode;\r\n\r\n  TDataIteratorMethod = Procedure(Item: JSValue; const Key: string; var Continue: Boolean) of object;\r\n  TDataIteratorCallBack = Procedure(Item: JSValue; const Key: string; var Continue: Boolean);\r\n\r\n  // For compatibility\r\n  TIteratorMethod = TDataIteratorMethod;\r\n\r\n  TFPDataHashTable = Class(TFPCustomHashTable)\r\n  Private\r\n    FIteratorCallBack: TDataIteratorCallBack;\r\n    Procedure CallbackIterator(Item: JSValue; const Key: string; var Continue: Boolean);\r\n  Protected\r\n    Function CreateNewNode(const aKey : String) : THTCustomNode; override;\r\n    Procedure AddNode(ANode : THTCustomNode); override;\r\n    Procedure SetData(const index: string; const AValue: JSValue); virtual;\r\n    Function GetData(const index: string):JSValue; virtual;\r\n    Function ForEachCall(aMethod: TDataIteratorMethod): THTDataNode; virtual;\r\n  Public\r\n    Function Iterate(aMethod: TDataIteratorMethod): JSValue; virtual;\r\n    Function Iterate(aMethod: TDataIteratorCallBack): JSValue; virtual;\r\n    Procedure Add(const aKey: string; AItem: JSValue); virtual;\r\n    property Items[const index: string]: JSValue read GetData write SetData; default;\r\n  end;\r\n\r\n  { TFPStringHashTable : Hash table with simple strings as data }\r\n  THTStringNode = Class(THTCustomNode)\r\n  Private\r\n    FData : String;\r\n  public\r\n    property Data: String read FData write FData;\r\n  end;\r\n  \r\n  TStringIteratorMethod = Procedure(Item: String; const Key: string; var Continue: Boolean) of object;\r\n  TStringIteratorCallback = Procedure(Item: String; const Key: string; var Continue: Boolean);\r\n\r\n  TFPStringHashTable = Class(TFPCustomHashTable)\r\n  Private\r\n    FIteratorCallBack: TStringIteratorCallback;\r\n    Procedure CallbackIterator(Item: String; const Key: string; var Continue: Boolean);\r\n  Protected\r\n    Function CreateNewNode(const aKey : String) : THTCustomNode; override;\r\n    Procedure AddNode(ANode : THTCustomNode); override;\r\n    Procedure SetData(const Index, AValue: string); virtual;\r\n    Function GetData(const index: string): String; virtual;\r\n    Function ForEachCall(aMethod: TStringIteratorMethod): THTStringNode; virtual;\r\n  Public\r\n    Function Iterate(aMethod: TStringIteratorMethod): String; virtual;\r\n    Function Iterate(aMethod: TStringIteratorCallback): String; virtual;\r\n    Procedure Add(const aKey,aItem: string); virtual;\r\n    property Items[const index: string]: String read GetData write SetData; default;\r\n  end;\r\n\r\n  { TFPStringHashTable : Hash table with simple strings as data }\r\n\r\n\r\n  THTObjectNode = Class(THTCustomNode)\r\n  Private\r\n    FData : TObject;\r\n  public\r\n    property Data: TObject read FData write FData;\r\n  end;\r\n\r\n  THTOwnedObjectNode = Class(THTObjectNode)\r\n  public\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  TObjectIteratorMethod = Procedure(Item: TObject; const Key: string; var Continue: Boolean) of object;\r\n  TObjectIteratorCallback = Procedure(Item: TObject; const Key: string; var Continue: Boolean);\r\n\r\n  TFPObjectHashTable = Class(TFPCustomHashTable)\r\n  Private\r\n    FOwnsObjects : Boolean;\r\n    FIteratorCallBack: TObjectIteratorCallback;\r\n    procedure CallbackIterator(Item: TObject; const Key: string; var Continue: Boolean);\r\n  Protected\r\n    Function CreateNewNode(const aKey : String) : THTCustomNode; override;\r\n    Procedure AddNode(ANode : THTCustomNode); override;\r\n    Procedure SetData(const Index: string; AObject : TObject); virtual;\r\n    Function GetData(const index: string): TObject; virtual;\r\n    Function ForEachCall(aMethod: TObjectIteratorMethod): THTObjectNode; virtual;\r\n  Public\r\n    constructor Create(AOwnsObjects : Boolean = True); reintroduce;\r\n    constructor CreateWith(AHashTableSize: Longword; aHashFunc: THashFunction; AOwnsObjects : Boolean = True); reintroduce;\r\n    Function Iterate(aMethod: TObjectIteratorMethod): TObject; virtual;\r\n    Function Iterate(aMethod: TObjectIteratorCallback): TObject; virtual;\r\n    Procedure Add(const aKey: string; AItem : TObject); virtual;\r\n    property Items[const index: string]: TObject read GetData write SetData; default;\r\n    Property OwnsObjects : Boolean Read FOwnsObjects;\r\n  end;\r\n\r\n  EDuplicate = class(Exception);\r\n  EKeyNotFound = class(Exception);\r\n\r\n  Function RSHash(const S: string; const TableSize: Longword): Longword;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Bucket lists as in Delphi\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nType\r\n  TBucketItem = record\r\n    Item, Data: JSValue;\r\n  end;\r\n  TBucketItemArray = array of TBucketItem;\r\n\r\n  TBucket = record\r\n    Count : Integer;\r\n    Items : TBucketItemArray;\r\n  end;\r\n  TBucketArray = array of TBucket;\r\n\r\n  TBucketProc = Reference to Procedure(AInfo, AItem, AData: JSValue; out AContinue: Boolean);\r\n\r\n{ ---------------------------------------------------------------------\r\n  TCustomBucketList\r\n  ---------------------------------------------------------------------}\r\n\r\n  { TCustomBucketList }\r\n\r\n  TCustomBucketList = class(TObject)\r\n  private\r\n    FBuckets: TBucketArray;\r\n    Function GetBucketCount: Integer;\r\n    Function GetData(AItem: JSValue): JSValue;\r\n    Procedure SetData(AItem: JSValue; const AData: JSValue);\r\n    Procedure SetBucketCount(const Value: Integer);\r\n  protected\r\n    Procedure GetBucketItem(AItem: JSValue; out ABucket, AIndex: Integer);\r\n    Function AddItem(ABucket: Integer; AItem, AData: JSValue): JSValue; virtual;\r\n    Function BucketFor(AItem: JSValue): Integer; virtual; abstract;\r\n    Function DeleteItem(ABucket: Integer; AIndex: Integer): JSValue; virtual;\r\n    Procedure Error(Msg : String; Args : Array of Const);\r\n    Function FindItem(AItem: JSValue; out ABucket, AIndex: Integer): Boolean; virtual;\r\n    property Buckets: TBucketArray read FBuckets;\r\n    property BucketCount: Integer read GetBucketCount write SetBucketCount;\r\n  public\r\n    destructor Destroy; override;\r\n    Procedure Clear;\r\n    Function Add(AItem, AData: JSValue): JSValue;\r\n    Procedure Assign(AList: TCustomBucketList);\r\n    Function Exists(AItem: JSValue): Boolean;\r\n    Function Find(AItem: JSValue; out AData: JSValue): Boolean;\r\n    Function ForEach(AProc: TBucketProc; AInfo: JSValue): Boolean;\r\n    Function ForEach(AProc: TBucketProc): Boolean;\r\n    Function Remove(AItem: JSValue): JSValue;\r\n    property Data[AItem: JSValue]: JSValue read GetData write SetData; default;\r\n  end;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TBucketList\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\n  TBucketListSizes = (bl2, bl4, bl8, bl16, bl32, bl64, bl128, bl256);\r\n\r\n  { TBucketList }\r\n\r\n  TBucketList = class(TCustomBucketList)\r\n  private\r\n    FBucketMask: Byte;\r\n  protected\r\n    Function BucketFor(AItem: JSValue): Integer; override;\r\n  public\r\n    constructor Create(ABuckets: TBucketListSizes = bl16); reintroduce;\r\n  end;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TObjectBucketList\r\n  ---------------------------------------------------------------------}\r\n\r\n  { TObjectBucketList }\r\n\r\n  TObjectBucketList = class(TBucketList)\r\n  protected\r\n    Function GetData(AItem: TObject): TObject; reintroduce;\r\n    Procedure SetData(AItem: TObject; const AData: TObject); reintroduce;\r\n  public\r\n    Function Add(AItem, AData: TObject): TObject; reintroduce;\r\n    Function Remove(AItem: TObject): TObject; reintroduce;\r\n    property Data[AItem: TObject]: TObject read GetData write SetData; default;\r\n  end;\r\n\r\n\r\nimplementation\r\n\r\nuses\r\n  js;\r\n\r\nResourceString\r\n  DuplicateMsg   = 'An item with key %0:s already exists';\r\n  //KeyNotFoundMsg = 'Method: %0:s key [''%1:s''] not found in container';\r\n  NotEmptyMsg    = 'Hash table not empty.';\r\n  SErrNoSuchItem = 'No item in list for %p';\r\n  SDuplicateItem = 'Item already exists in list: %p';\r\n\r\nconst\r\n  NPRIMES = 28;\r\n\r\n  PRIMELIST: array[0 .. NPRIMES-1] of Longword =\r\n  ( 53,         97,         193,       389,       769,\r\n    1543,       3079,       6151,      12289,     24593,\r\n    49157,      98317,      196613,    393241,    786433,\r\n    1572869,    3145739,    6291469,   12582917,  25165843,\r\n    50331653,   100663319,  201326611, 402653189, 805306457,\r\n    1610612741, 3221225473, 4294967291 );\r\n\r\nconstructor TFPObjectList.Create(FreeObjects : boolean);\r\nbegin\r\n  Create;\r\n  FFreeObjects:=Freeobjects;\r\nend;\r\n\r\ndestructor TFPObjectList.Destroy;\r\nbegin\r\n  if (FList <> nil) then\r\n  begin\r\n    Clear;\r\n    FList.Destroy;\r\n  end;\r\n  inherited Destroy;\r\nend;\r\n\r\nProcedure TFPObjectList.Clear;\r\nvar\r\n  i: integer;\r\n  O : TObject;\r\nbegin\r\n  if FFreeObjects then\r\n    for i:=FList.Count-1 downto 0 do\r\n      begin\r\n      O:=TObject(FList[i]);\r\n      FList[i]:=Nil;\r\n      O.Free;\r\n      end;\r\n  FList.Clear;\r\nend;\r\n\r\nconstructor TFPObjectList.Create;\r\nbegin\r\n  inherited Create;\r\n  FList:=TFPList.Create;\r\n  FFreeObjects:=True;\r\nend;\r\n\r\nFunction TFPObjectList.GetCount: integer;\r\nbegin\r\n  Result:=FList.Count;\r\nend;\r\n\r\nProcedure TFPObjectList.SetCount(const AValue: integer);\r\nbegin\r\n  if FList.Count <> AValue then\r\n    FList.Count:=AValue;\r\nend;\r\n\r\nFunction TFPObjectList.GetItem(Index: Integer): TObject;\r\nbegin\r\n  Result:=TObject(FList[Index]);\r\nend;\r\n\r\nProcedure TFPObjectList.SetItem(Index: Integer; AObject: TObject);\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  if OwnsObjects then\r\n    begin\r\n    O:=TObject(FList[Index]);\r\n    FList[Index]:=AObject;\r\n    O.Free;\r\n    end\r\n  else\r\n    FList[index]:=AObject;\r\nend;\r\n\r\nProcedure TFPObjectList.SetCapacity(NewCapacity: Integer);\r\nbegin\r\n  FList.Capacity:=NewCapacity;\r\nend;\r\n\r\nFunction TFPObjectList.GetCapacity: integer;\r\nbegin\r\n  Result:=FList.Capacity;\r\nend;\r\n\r\nFunction TFPObjectList.Add(AObject: TObject): Integer;\r\nbegin\r\n  Result:=FList.Add(AObject);\r\nend;\r\n\r\nProcedure TFPObjectList.Delete(Index: Integer);\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  if OwnsObjects then\r\n    begin\r\n    O:=TObject(FList[Index]);\r\n    FList[Index]:=Nil;\r\n    O.Free;\r\n    end;\r\n  FList.Delete(Index);\r\nend;\r\n\r\nProcedure TFPObjectList.Exchange(Index1, Index2: Integer);\r\nbegin\r\n  FList.Exchange(Index1, Index2);\r\nend;\r\n\r\nFunction TFPObjectList.Expand: TFPObjectList;\r\nbegin\r\n  FList.Expand;\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TFPObjectList.Extract(Item: TObject): TObject;\r\nbegin\r\n  Result:=TObject(FList.Extract(Item));\r\nend;\r\n\r\nFunction TFPObjectList.Remove(AObject: TObject): Integer;\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  Result:=IndexOf(AObject);\r\n  if (Result <> -1) then\r\n    begin\r\n    if OwnsObjects then\r\n      begin\r\n      O:=TObject(FList[Result]);\r\n      FList[Result]:=Nil;\r\n      O.Free;\r\n      end;\r\n    FList.Delete(Result);\r\n    end;\r\nend;\r\n\r\nFunction TFPObjectList.IndexOf(AObject: TObject): Integer;\r\nbegin\r\n  Result:=FList.IndexOf(JSValue(AObject));\r\nend;\r\n\r\nFunction TFPObjectList.FindInstanceOf(AClass: TClass; AExact: Boolean; AStartAt : Integer): Integer;\r\nvar\r\n  I : Integer;\r\nbegin\r\n  I:=AStartAt;\r\n  Result:=-1;\r\n  if AExact then\r\n    while (I<Count) and (Result=-1) do\r\n      if Items[i].ClassType=AClass then\r\n        Result:=I\r\n      else\r\n        Inc(I)\r\n  else\r\n    while (I<Count) and (Result=-1) do\r\n      if Items[i].InheritsFrom(AClass) then\r\n        Result:=I\r\n      else\r\n        Inc(I);\r\nend;\r\n\r\nProcedure TFPObjectList.Insert(Index: Integer; AObject: TObject);\r\nbegin\r\n  FList.Insert(Index, JSValue(AObject));\r\nend;\r\n\r\nProcedure TFPObjectList.Move(CurIndex, NewIndex: Integer);\r\nbegin\r\n  FList.Move(CurIndex, NewIndex);\r\nend;\r\n\r\nProcedure TFPObjectList.Assign(Obj: TFPObjectList);\r\nvar\r\n  i: Integer;\r\nbegin\r\n  Clear;\r\n  for i:=0 to Obj.Count - 1 do\r\n    Add(Obj[i]);\r\nend;\r\n\r\nProcedure TFPObjectList.Pack;\r\nbegin\r\n  FList.Pack;\r\nend;\r\n\r\nProcedure TFPObjectList.Sort(Compare: TListSortCompare);\r\nbegin\r\n  FList.Sort(Compare);\r\nend;\r\n\r\nFunction TFPObjectList.First: TObject;\r\nbegin\r\n  Result:=TObject(FList.First);\r\nend;\r\n\r\nFunction TFPObjectList.Last: TObject;\r\nbegin\r\n  Result:=TObject(FList.Last);\r\nend;\r\n\r\nProcedure TFPObjectList.ForEachCall(proc2call:TObjectListCallback;arg:JSValue);\r\nbegin\r\n  FList.ForEachCall(TListCallBack(proc2call),arg);\r\nend;\r\n\r\n{ TObjectList }\r\n\r\nconstructor TObjectList.Create(FreeObjects: boolean);\r\nbegin\r\n  inherited Create;\r\n  FFreeObjects:=FreeObjects;\r\nend;\r\n\r\nconstructor TObjectList.Create;\r\nbegin\r\n  inherited Create;\r\n  FFreeObjects:=True;\r\nend;\r\n\r\nProcedure TObjectList.Notify(Ptr: JSValue; Action: TListNotification);\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  if FFreeObjects then\r\n    if (Action=lnDeleted) then\r\n      begin\r\n      O:=TObject(Ptr);\r\n      O.Free;\r\n      end;\r\n  inherited Notify(Ptr,Action);\r\nend;\r\n\r\n\r\nFunction TObjectList.GetItem(Index: Integer): TObject;\r\nbegin\r\n  Result:=TObject(inherited Get(Index));\r\nend;\r\n\r\n\r\nProcedure TObjectList.SetItem(Index: Integer; AObject: TObject);\r\nbegin\r\n  // Put will take care of deleting old one in Notify.\r\n  Put(Index,JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.Add(AObject: TObject): Integer;\r\nbegin\r\n  Result:=inherited Add(JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.Extract(Item: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Extract(JSValue(Item)));\r\nend;\r\n\r\n\r\nFunction TObjectList.Remove(AObject: TObject): Integer;\r\nbegin\r\n  Result:=inherited Remove(JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.IndexOf(AObject: TObject): Integer;\r\nbegin\r\n  Result:=inherited IndexOf(JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.FindInstanceOf(AClass: TClass; AExact: Boolean;\r\n  AStartAt: Integer): Integer;\r\nvar\r\n  I : Integer;\r\nbegin\r\n  I:=AStartAt;\r\n  Result:=-1;\r\n  if AExact then\r\n    while (I<Count) and (Result=-1) do\r\n      if Items[i].ClassType=AClass then\r\n        Result:=I\r\n      else\r\n        Inc(I)\r\n  else\r\n    while (I<Count) and (Result=-1) do\r\n      if Items[i].InheritsFrom(AClass) then\r\n        Result:=I\r\n      else\r\n        Inc(I);\r\nend;\r\n\r\n\r\nProcedure TObjectList.Insert(Index: Integer; AObject: TObject);\r\nbegin\r\n  Inherited Insert(Index,JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.First: TObject;\r\nbegin\r\n  Result:=TObject(inherited First);\r\nend;\r\n\r\n\r\nFunction TObjectList.Last: TObject;\r\nbegin\r\n  Result:=TObject(inherited Last);\r\nend;\r\n\r\n{ TListComponent }\r\n\r\ntype\r\n  TlistComponent = class(TComponent)\r\n  private\r\n    Flist : TComponentList;\r\n  public\r\n    Procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n  end;\r\n\r\nProcedure TlistComponent.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nbegin\r\n  if (Operation=opRemove) then\r\n    Flist.HandleFreeNotify(Self,AComponent);\r\n  inherited;\r\nend;\r\n\r\n{ TComponentList }\r\n\r\nFunction TComponentList.Add(AComponent: TComponent): Integer;\r\nbegin\r\n  Result:=inherited Add(AComponent);\r\nend;\r\n\r\ndestructor TComponentList.Destroy;\r\nbegin\r\n  inherited;\r\n  FreeAndNil(FNotifier);\r\nend;\r\n\r\nFunction TComponentList.Extract(Item: TComponent): TComponent;\r\nbegin\r\n  Result:=TComponent(inherited Extract(Item));\r\nend;\r\n\r\nFunction TComponentList.First: TComponent;\r\nbegin\r\n  Result:=TComponent(inherited First);\r\nend;\r\n\r\nFunction TComponentList.GetItems(Index: Integer): TComponent;\r\nbegin\r\n  Result:=TComponent(inherited Items[Index]);\r\nend;\r\n\r\nProcedure TComponentList.HandleFreeNotify(Sender: TObject;\r\n  AComponent: TComponent);\r\nbegin\r\n  Extract(AComponent);\r\n  if Sender=nil then ;\r\nend;\r\n\r\nFunction TComponentList.IndexOf(AComponent: TComponent): Integer;\r\nbegin\r\n  Result:=inherited IndexOf(AComponent);\r\nend;\r\n\r\nProcedure TComponentList.Insert(Index: Integer; AComponent: TComponent);\r\nbegin\r\n  inherited Insert(Index,AComponent)\r\nend;\r\n\r\nFunction TComponentList.Last: TComponent;\r\nbegin\r\n  Result:=TComponent(inherited Last);\r\nend;\r\n\r\nProcedure TComponentList.Notify(Ptr: JSValue; Action: TListNotification);\r\nbegin\r\n  if FNotifier=nil then\r\n    begin\r\n    FNotifier:=TlistComponent.Create(nil);\r\n    TlistComponent(FNotifier).FList:=Self;\r\n    end;\r\n  if Assigned(Ptr) then\r\n    with TComponent(Ptr) do\r\n      case Action of\r\n        lnAdded : FreeNotification(FNotifier);\r\n        lnExtracted, lnDeleted: RemoveFreeNotification(FNotifier);\r\n      end;\r\n  inherited Notify(Ptr, Action);\r\nend;\r\n\r\nFunction TComponentList.Remove(AComponent: TComponent): Integer;\r\nbegin\r\n  Result:=inherited Remove(AComponent);\r\nend;\r\n\r\nProcedure TComponentList.SetItems(Index: Integer; AComponent: TComponent);\r\nbegin\r\n  Put(Index,AComponent);\r\nend;\r\n\r\n{ TClassList }\r\n\r\nFunction TClassList.Add(AClass: TClass): Integer;\r\nbegin\r\n  Result:=inherited Add(JSValue(AClass));\r\nend;\r\n\r\nFunction TClassList.Extract(Item: TClass): TClass;\r\nbegin\r\n  Result:=TClass(inherited Extract(JSValue(Item)));\r\nend;\r\n\r\nFunction TClassList.First: TClass;\r\nbegin\r\n  Result:=TClass(inherited First);\r\nend;\r\n\r\nFunction TClassList.GetItems(Index: Integer): TClass;\r\nbegin\r\n  Result:=TClass(inherited Items[Index]);\r\nend;\r\n\r\nFunction TClassList.IndexOf(AClass: TClass): Integer;\r\nbegin\r\n  Result:=inherited IndexOf(JSValue(AClass));\r\nend;\r\n\r\nProcedure TClassList.Insert(Index: Integer; AClass: TClass);\r\nbegin\r\n  inherited Insert(Index,JSValue(AClass));\r\nend;\r\n\r\nFunction TClassList.Last: TClass;\r\nbegin\r\n  Result:=TClass(inherited Last);\r\nend;\r\n\r\nFunction TClassList.Remove(AClass: TClass): Integer;\r\nbegin\r\n  Result:=inherited Remove(JSValue(AClass));\r\nend;\r\n\r\nProcedure TClassList.SetItems(Index: Integer; AClass: TClass);\r\nbegin\r\n  Put(Index,JSValue(AClass));\r\nend;\r\n\r\n{ TOrderedList }\r\n\r\nFunction TOrderedList.AtLeast(ACount: Integer): Boolean;\r\nbegin\r\n  Result:=(FList.Count>=Acount)\r\nend;\r\n\r\nFunction TOrderedList.Count: Integer;\r\nbegin\r\n  Result:=FList.Count;\r\nend;\r\n\r\nconstructor TOrderedList.Create;\r\nbegin\r\n  FList:=Tlist.Create;\r\nend;\r\n\r\ndestructor TOrderedList.Destroy;\r\nbegin\r\n  FList.Free;\r\nend;\r\n\r\nFunction TOrderedList.Peek: JSValue;\r\nbegin\r\n  if AtLeast(1) then\r\n    Result:=PeekItem\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nFunction TOrderedList.PeekItem: JSValue;\r\n\r\nbegin\r\n  with Flist do\r\n    Result:=Items[Count-1]\r\nend;\r\n\r\nFunction TOrderedList.Pop: JSValue;\r\nbegin\r\n  If Atleast(1) then\r\n    Result:=PopItem\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nFunction TOrderedList.PopItem: JSValue;\r\nbegin\r\n  with FList do\r\n    if Count>0 then\r\n      begin\r\n      Result:=Items[Count-1];\r\n      Delete(Count-1);\r\n      end\r\n    else\r\n      Result:=nil;\r\nend;\r\n\r\nFunction TOrderedList.Push(AItem: JSValue): JSValue;\r\nbegin\r\n  PushItem(AItem);\r\n  Result:=AItem;\r\nend;\r\n\r\n{ TStack }\r\n\r\nProcedure TStack.PushItem(AItem: JSValue);\r\nbegin\r\n  FList.Add(AItem);\r\nend;\r\n\r\n{ TObjectStack }\r\n\r\nFunction TObjectStack.Peek: TObject;\r\nbegin\r\n  Result:=TObject(inherited Peek);\r\nend;\r\n\r\nFunction TObjectStack.Pop: TObject;\r\nbegin\r\n  Result:=TObject(Inherited Pop);\r\nend;\r\n\r\nFunction TObjectStack.Push(AObject: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Push(JSValue(AObject)));\r\nend;\r\n\r\n{ TQueue }\r\n\r\nProcedure TQueue.PushItem(AItem: JSValue);\r\nbegin\r\n  with FList Do\r\n    Insert(0,AItem);\r\nend;\r\n\r\n{ TObjectQueue }\r\n\r\nFunction TObjectQueue.Peek: TObject;\r\nbegin\r\n  Result:=TObject(inherited Peek);\r\nend;\r\n\r\nFunction TObjectQueue.Pop: TObject;\r\nbegin\r\n  Result:=TObject(inherited Pop);\r\nend;\r\n\r\nFunction TObjectQueue.Push(AObject: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Push(JSValue(AObject)));\r\nend;\r\n\r\n\r\n{*****************************************************************************\r\n                            TFPHashList\r\n*****************************************************************************}\r\n(*\r\n    Function FPHash(const s:shortstring):LongWord;\r\n    var\r\n      p,pmax : PChar;\r\n    begin\r\n{$push}\r\n{$Q-}\r\n      Result:=0;\r\n      p:=@s[1];\r\n      pmax:=@s[length(s)+1];\r\n      while (p<pmax) do\r\n        begin\r\n          Result:=LongWord(LongInt(Result shl 5) - LongInt(Result)) xor LongWord(P^);\r\n          Inc(p);\r\n        end;\r\n{$pop}\r\n    end;\r\n\r\n    Function FPHash(P: PChar; Len: Integer): LongWord;\r\n    var\r\n      pmax : PChar;\r\n    begin\r\n{$push}\r\n{$Q-}\r\n      Result:=0;\r\n      pmax:=p+len;\r\n      while (p<pmax) do\r\n        begin\r\n          Result:=LongWord(LongInt(Result shl 5) - LongInt(Result)) xor LongWord(P^);\r\n          Inc(p);\r\n        end;\r\n{$pop}\r\n    end;\r\n\r\n*)\r\n\r\n{ ---------------------------------------------------------------------\r\n    Hash support, by Dean Zobec\r\n  ---------------------------------------------------------------------}\r\n\r\n{ Default hash Function }\r\n\r\nFunction RSHash(const S: string; const TableSize: Longword): Longword;\r\nconst\r\n  b = 378551;\r\nvar\r\n  a: Longword;\r\n  i: Longword;\r\nbegin\r\n  a:=63689;\r\n  Result:=0;\r\n  if length(s)>0 then\r\n    for i:=1 to Length(S) do\r\n      begin\r\n      Result:=Result * a + Ord(S[i]);\r\n      a:=a * b;\r\n      end;\r\n  Result:=(Result and $7FFFFFFF) mod TableSize;\r\nend;\r\n\r\n{ THTNode }\r\n\r\nconstructor THTCustomNode.CreateWith(const AString: string);\r\nbegin\r\n  inherited Create;\r\n  FKey:=AString;\r\nend;\r\n\r\nFunction THTCustomNode.HasKey(const AKey: string): boolean;\r\nbegin\r\n  Result:=(AKey=FKey);\r\nend;\r\n\r\n{ TFPCustomHashTable }\r\n\r\nconstructor TFPCustomHashTable.Create;\r\nbegin\r\n  CreateWith(196613,@RSHash);\r\nend;\r\n\r\nconstructor TFPCustomHashTable.CreateWith(AHashTableSize: Longword;\r\n  aHashFunc: THashFunction);\r\nbegin\r\n  inherited Create;\r\n  FHashTable:=TFPObjectList.Create(True);\r\n  HashTableSize:=AHashTableSize;\r\n  FHashFunction:=aHashFunc;\r\nend;\r\n\r\ndestructor TFPCustomHashTable.Destroy;\r\nbegin\r\n  FHashTable.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetDensity: Longword;\r\nbegin\r\n  Result:=FHashTableSize - VoidSlots\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetNumberOfCollisions: Longword;\r\nbegin\r\n  Result:=FCount -(FHashTableSize - VoidSlots)\r\nend;\r\n\r\nProcedure TFPCustomHashTable.SetHashTableSize(const Value: Longword);\r\nvar\r\n  i: Longword;\r\n  newSize: Longword;\r\nbegin\r\n  if Value <> FHashTableSize then\r\n    begin\r\n    i:=0;\r\n    while (PRIMELIST[i] < Value) and (i < 27) do\r\n     Inc(i);\r\n    newSize:=PRIMELIST[i];\r\n    if Count = 0 then\r\n      begin\r\n      FHashTableSize:=newSize;\r\n      InitializeHashTable;\r\n      end\r\n    else\r\n      ChangeTableSize(newSize);\r\n    end;\r\nend;\r\n\r\nProcedure TFPCustomHashTable.InitializeHashTable;\r\nvar\r\n  i: LongWord;\r\nbegin\r\n  if FHashTableSize>0 Then\r\n    for i:=0 to FHashTableSize-1 do\r\n      FHashTable.Add(nil);\r\n  FCount:=0;\r\nend;\r\n\r\nProcedure TFPCustomHashTable.ChangeTableSize(const ANewSize: Longword);\r\nvar\r\n  SavedTable, List: TFPObjectList;\r\n  SavedTableSize: Longword;\r\n  i, j: Longword;\r\n  temp: THTCustomNode;\r\nbegin\r\n  SavedTable:=FHashTable;\r\n  SavedTableSize:=FHashTableSize;\r\n  FHashTableSize:=ANewSize;\r\n  FHashTable:=TFPObjectList.Create(True);\r\n  InitializeHashTable;\r\n  if SavedTableSize>0 Then\r\n    for i:=0 to SavedTableSize-1 do\r\n      begin\r\n      List:=TFPObjectList(SavedTable[i]);\r\n      if Assigned(List) then\r\n        for j:=0 to List.Count -1 do\r\n          begin\r\n          temp:=THTCustomNode(List[j]);\r\n          AddNode(temp);\r\n          end;\r\n      end;\r\n  SavedTable.Free;\r\nend;\r\n\r\nProcedure TFPCustomHashTable.SetHashFunction(AHashFunction: THashFunction);\r\nbegin\r\n  if IsEmpty then\r\n    FHashFunction:=AHashFunction\r\n  else\r\n    raise Exception.Create(NotEmptyMsg);\r\nend;\r\n\r\nFunction TFPCustomHashTable.Find(const aKey: string): THTCustomNode;\r\nvar\r\n  hashCode: Longword;\r\n  chn: TFPObjectList;\r\n  i: Longword;\r\nbegin\r\n  hashCode:=FHashFunction(aKey, FHashTableSize);\r\n  chn:=Chain(hashCode);\r\n  if Assigned(chn) then\r\n    if chn.count>0 then\r\n      for i:=0 to chn.Count - 1 do\r\n        if THTCustomNode(chn[i]).Key=aKey then\r\n          Exit(THTCustomNode(chn[i]));\r\n  Result:=nil;\r\nend;\r\n\r\nFunction TFPCustomHashTable.FindChainForAdd(Const aKey : String) : TFPObjectList;\r\nvar\r\n  hashCode: Longword;\r\n  i: Longword;\r\nbegin\r\n  hashCode:=FHashFunction(aKey, FHashTableSize);\r\n  Result:=Chain(hashCode);\r\n  if Assigned(Result)  then\r\n    begin\r\n    if Result.count>0 then\r\n      for i:=0 to Result.Count - 1 do\r\n        if (THTCustomNode(Result[i]).Key=aKey) then\r\n          raise EDuplicate.CreateFmt(DuplicateMsg, [aKey]);\r\n    end\r\n  else\r\n    begin\r\n    FHashTable[hashcode]:=TFPObjectList.Create(True);\r\n    Result:=Chain(hashCode);\r\n    end;\r\n  Inc(FCount);\r\nend;\r\n\r\n\r\nProcedure TFPCustomHashTable.Delete(const aKey: string);\r\nvar\r\n  hashCode: Longword;\r\n  chn: TFPObjectList;\r\n  i: Longword;\r\nbegin\r\n  hashCode:=FHashFunction(aKey, FHashTableSize);\r\n  chn:=Chain(hashCode);\r\n  if Assigned(chn) then\r\n    if chn.count>0 then\r\n      for i:=0 to chn.Count - 1 do\r\n        if THTCustomNode(chn[i]).Key=aKey then\r\n          begin\r\n          chn.Delete(i);\r\n          dec(FCount);\r\n          Exit;\r\n          end;\r\nend;\r\n\r\nFunction TFPCustomHashTable.IsEmpty: boolean;\r\nbegin\r\n  Result:=(FCount = 0);\r\nend;\r\n\r\nFunction TFPCustomHashTable.Chain(const index: Longword): TFPObjectList;\r\nbegin\r\n  Result:=TFPObjectList(FHashTable[index]);\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetVoidSlots: Longword;\r\nvar\r\n  i: Longword;\r\n  num: Longword;\r\nbegin\r\n  num:=0;\r\n  if FHashTableSize>0 then\r\n    for i:= 0 to FHashTableSize-1 do\r\n      if not Assigned(Chain(i)) then\r\n        Inc(num);\r\n  Result:=num;\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetLoadFactor: double;\r\nbegin\r\n  Result:=Count / FHashTableSize;\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetAVGChainLen: double;\r\nbegin\r\n  Result:=Count / (FHashTableSize - VoidSlots);\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetMaxChainLength: Longword;\r\nvar\r\n  i: Longword;\r\nbegin\r\n  Result:=0;\r\n  if FHashTableSize>0 Then\r\n   for i:=0 to FHashTableSize-1 do\r\n      if ChainLength(i) > Result then\r\n        Result:=ChainLength(i);\r\nend;\r\n\r\nFunction TFPCustomHashTable.FindOrCreateNew(const aKey: string): THTCustomNode;\r\nvar\r\n  hashCode: Longword;\r\n  chn: TFPObjectList;\r\n  i: Longword;\r\nbegin\r\n  hashCode:=FHashFunction(aKey, FHashTableSize);\r\n  chn:=Chain(hashCode);\r\n  if Assigned(chn)  then\r\n    begin\r\n    if chn.count>0 then\r\n      for i:=0 to chn.Count - 1 do\r\n        if (THTCustomNode(chn[i]).Key=aKey) then\r\n          Exit(THTNode(chn[i]));\r\n    end\r\n  else\r\n    begin\r\n    FHashTable[hashcode]:=TFPObjectList.Create(true);\r\n    chn:=Chain(hashcode);\r\n    end;\r\n  Inc(FCount);\r\n  Result:=CreateNewNode(aKey);\r\n  chn.Add(Result);\r\nend;\r\n\r\nFunction TFPCustomHashTable.ChainLength(const ChainIndex: Longword): Longword;\r\nbegin\r\n  if Assigned(Chain(ChainIndex)) then\r\n    Result:=Chain(ChainIndex).Count\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nProcedure TFPCustomHashTable.Clear;\r\nvar\r\n  i: Longword;\r\nbegin\r\n  if FHashTableSize>0 then\r\n    for i:=0 to FHashTableSize - 1 do\r\n      if Assigned(Chain(i)) then\r\n        Chain(i).Clear;\r\n  FCount:=0;\r\nend;\r\n\r\n\r\n\r\n{ TFPDataHashTable }\r\n\r\nProcedure TFPDataHashTable.Add(const aKey: string; aItem: JSValue);\r\nvar\r\n  chn: TFPObjectList;\r\n  NewNode: THtDataNode;\r\nbegin\r\n  chn:=FindChainForAdd(akey);\r\n  NewNode:=THtDataNode(CreateNewNode(aKey));\r\n  NewNode.Data:=aItem;\r\n  chn.Add(NewNode);\r\nend;\r\n\r\nFunction TFPDataHashTable.GetData(const Index: string): JSValue;\r\nvar\r\n  node: THTDataNode;\r\nbegin\r\n  node:=THTDataNode(Find(Index));\r\n  if Assigned(node) then\r\n    Result:=node.Data\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nProcedure TFPDataHashTable.SetData(const index: string; const AValue: JSValue);\r\nbegin\r\n  THTDataNode(FindOrCreateNew(index)).Data:=AValue;\r\nend;\r\n\r\nFunction TFPDataHashTable.CreateNewNode(const aKey : string) : THTCustomNode;\r\n\r\nbegin\r\n  Result:=THTDataNode.CreateWith(aKey);\r\nend;\r\n\r\nFunction TFPDataHashTable.Iterate(aMethod: TDataIteratorMethod): JSValue;\r\nvar\r\n  N : THTDataNode;\r\nbegin\r\n  N:=ForEachCall(AMethod);\r\n  if Assigned(N) then\r\n    Result:=N.Data\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nProcedure TFPDataHashTable.CallbackIterator(Item: JSValue; const Key: string; var Continue: Boolean);\r\nbegin\r\n  FIteratorCallBack(Item, Key, Continue);\r\nend;\r\n\r\nFunction TFPDataHashTable.Iterate(aMethod: TDataIteratorCallBack): JSValue;\r\nbegin\r\n  FIteratorCallBack := aMethod;\r\n  Result := Iterate(@CallbackIterator);\r\nend;\r\n\r\nFunction TFPDataHashTable.ForEachCall(aMethod: TDataIteratorMethod): THTDataNode;\r\nvar\r\n  i, j: Longword;\r\n  continue: Boolean;\r\nbegin\r\n  Result:=nil;\r\n  continue:=true;\r\n  if FHashTableSize>0 then\r\n    for i:=0 to FHashTableSize-1 do\r\n      if Assigned(Chain(i)) then\r\n        if chain(i).count>0 then\r\n          for j:=0 to Chain(i).Count-1 do\r\n            begin\r\n            aMethod(THTDataNode(Chain(i)[j]).Data, THTDataNode(Chain(i)[j]).Key, continue);\r\n            if not continue then\r\n              begin\r\n              Result:=THTDataNode(Chain(i)[j]);\r\n              Exit;\r\n              end;\r\n           end;\r\nend;\r\n\r\nProcedure TFPDataHashTable.AddNode(ANode : THTCustomNode);\r\nbegin\r\n  with THTDataNode(ANode) do\r\n    Add(Key,Data);\r\nend;\r\n\r\n{ TFPStringHashTable }\r\n\r\nProcedure TFPStringHashTable.AddNode(ANode : THTCustomNode);\r\nbegin\r\n  with THTStringNode(ANode) do\r\n    Add(Key,Data);\r\nend;\r\n\r\nFunction TFPStringHashTable.GetData(const Index: string): String;\r\nvar\r\n  node: THTStringNode;\r\nbegin\r\n  node:=THTStringNode(Find(Index));\r\n  if Assigned(node) then\r\n    Result:=node.Data\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nProcedure TFPStringHashTable.SetData(const index, AValue: string);\r\nbegin\r\n  THTStringNode(FindOrCreateNew(index)).Data:=AValue;\r\nend;\r\n\r\nProcedure TFPStringHashTable.Add(const aKey, aItem: string);\r\nvar\r\n  chn: TFPObjectList;\r\n  NewNode: THtStringNode;\r\nbegin\r\n  chn:=FindChainForAdd(akey);\r\n  NewNode:=THtStringNode(CreateNewNode(aKey));\r\n  NewNode.Data:=aItem;\r\n  chn.Add(NewNode);\r\nend;\r\n\r\nFunction TFPStringHashTable.CreateNewNode(const aKey : string) : THTCustomNode;\r\nbegin\r\n  Result:=THTStringNode.CreateWith(aKey);\r\nend;\r\n\r\nFunction TFPStringHashTable.Iterate(aMethod: TStringIteratorMethod): String;\r\nvar\r\n  N : THTStringNode;\r\nbegin\r\n  N:=ForEachCall(AMethod);\r\n  if Assigned(N) then\r\n    Result:=N.Data\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nProcedure TFPStringHashTable.CallbackIterator(Item: String; const Key: string; var Continue: Boolean);\r\nbegin\r\n  FIteratorCallBack(Item, Key, Continue);\r\nend;\r\n\r\nFunction TFPStringHashTable.Iterate(aMethod: TStringIteratorCallback): String;\r\nbegin\r\n  FIteratorCallBack := aMethod;\r\n  Result := Iterate(@CallbackIterator);\r\nend;\r\n\r\nFunction TFPStringHashTable.ForEachCall(aMethod: TStringIteratorMethod): THTStringNode;\r\nvar\r\n  i, j: Longword;\r\n  continue: boolean;\r\nbegin\r\n  Result:=nil;\r\n  continue:=True;\r\n  if FHashTableSize>0 then\r\n    for i:=0 to FHashTableSize-1 do\r\n      if Assigned(Chain(i)) then\r\n        if chain(i).Count>0 then\r\n          for j:=0 to Chain(i).Count-1 do\r\n            begin\r\n            aMethod(THTStringNode(Chain(i)[j]).Data, THTStringNode(Chain(i)[j]).Key, continue);\r\n            if not continue then\r\n              begin\r\n              Result:=THTStringNode(Chain(i)[j]);\r\n              Exit;\r\n              end;\r\n            end;\r\nend;\r\n\r\n{ TFPObjectHashTable }\r\n\r\nProcedure TFPObjectHashTable.AddNode(ANode : THTCustomNode);\r\nbegin\r\n  With THTObjectNode(ANode) do\r\n    Add(Key,Data);\r\nend;\r\n\r\nFunction TFPObjectHashTable.GetData(const Index: string): TObject;\r\nvar\r\n  node: THTObjectNode;\r\nbegin\r\n  node:=THTObjectNode(Find(Index));\r\n  if Assigned(node) then\r\n    Result:=node.Data\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nProcedure TFPObjectHashTable.SetData(const index : string; AObject : TObject);\r\nbegin\r\n  THTObjectNode(FindOrCreateNew(index)).Data:=AObject;\r\nend;\r\n\r\nProcedure TFPObjectHashTable.Add(const aKey: string; AItem : TObject);\r\nvar\r\n  chn: TFPObjectList;\r\n  NewNode: THTObjectNode;\r\nbegin\r\n  chn:=FindChainForAdd(akey);\r\n  NewNode:=THTObjectNode(CreateNewNode(aKey));\r\n  NewNode.Data:=aItem;\r\n  chn.Add(NewNode);\r\nend;\r\n\r\nFunction TFPObjectHashTable.CreateNewNode(const aKey : string) : THTCustomNode;\r\nbegin\r\n  if OwnsObjects then\r\n    Result:=THTOwnedObjectNode.CreateWith(aKey)\r\n  else\r\n    Result:=THTObjectNode.CreateWith(aKey);\r\nend;\r\n\r\n\r\nFunction TFPObjectHashTable.Iterate(aMethod: TObjectIteratorMethod): TObject;\r\nvar\r\n  N : THTObjectNode;\r\nbegin\r\n  N:=ForEachCall(AMethod);\r\n  if Assigned(N) then\r\n    Result:=N.Data\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nProcedure TFPObjectHashTable.CallbackIterator(Item: TObject; const Key: string; var Continue: Boolean);\r\nbegin\r\n  FIteratorCallBack(Item, Key, Continue);\r\nend;\r\n\r\nFunction TFPObjectHashTable.Iterate(aMethod: TObjectIteratorCallback): TObject;\r\nbegin\r\n  FIteratorCallBack := aMethod;\r\n  Result := Iterate(@CallbackIterator);\r\nend;\r\n\r\nFunction TFPObjectHashTable.ForEachCall(aMethod: TObjectIteratorMethod): THTObjectNode;\r\nvar\r\n  i, j: Longword;\r\n  continue: boolean;\r\nbegin\r\n  Result:=nil;\r\n  continue:=true;\r\n  if FHashTableSize>0 then\r\n    for i:=0 to FHashTableSize-1 do\r\n      if Assigned(Chain(i)) then\r\n        if Chain(i).Count>0 then\r\n          for j:=0 to Chain(i).Count-1 do\r\n           begin\r\n           aMethod(THTObjectNode(Chain(i)[j]).Data, THTObjectNode(Chain(i)[j]).Key, continue);\r\n           if not continue then\r\n             begin\r\n             Result:=THTObjectNode(Chain(i)[j]);\r\n             Exit;\r\n             end;\r\n           end;\r\nend;\r\n\r\nconstructor TFPObjectHashTable.Create(AOwnsObjects : Boolean = True);\r\nbegin\r\n  inherited Create;\r\n  FOwnsObjects:=AOwnsObjects;\r\nend;\r\n\r\nconstructor TFPObjectHashTable.CreateWith(AHashTableSize: Longword; aHashFunc: THashFunction; AOwnsObjects : Boolean = True);\r\nbegin\r\n  inherited CreateWith(AHashTableSize,AHashFunc);\r\n  FOwnsObjects:=AOwnsObjects;\r\nend;\r\n\r\ndestructor THTOwnedObjectNode.Destroy;\r\nbegin\r\n  FreeAndNil(FData);\r\n  inherited;\r\nend;\r\n\r\n{ TCustomBucketList }\r\n\r\nFunction TCustomBucketList.GetData(AItem: JSValue): JSValue;\r\nvar\r\n  B,I : Integer;\r\nbegin\r\n  GetBucketItem(AItem,B,I);\r\n  Result:=FBuckets[B].Items[I].Data;\r\nend;\r\n\r\nFunction TCustomBucketList.GetBucketCount: Integer;\r\nbegin\r\n  Result:=Length(FBuckets);\r\nend;\r\n\r\nProcedure TCustomBucketList.SetData(AItem: JSValue; const AData: JSValue);\r\nvar\r\n  B,I : Integer;\r\nbegin\r\n  GetBucketItem(AItem,B,I);\r\n  FBuckets[B].Items[I].Data:=AData;\r\nend;\r\n\r\nProcedure TCustomBucketList.SetBucketCount(const Value: Integer);\r\nbegin\r\n  if (Value<>GetBucketCount) then\r\n    SetLength(FBuckets,Value);\r\nend;\r\n\r\nProcedure TCustomBucketList.GetBucketItem(AItem: JSValue; out ABucket,\r\n  AIndex: Integer);\r\nbegin\r\n  if not FindItem(AItem,ABucket,AIndex) then\r\n    Error(SErrNoSuchItem,[AItem]);\r\nend;\r\n\r\nFunction TCustomBucketList.AddItem(ABucket: Integer; AItem, AData: JSValue\r\n  ): JSValue;\r\nvar\r\n  L : Integer;\r\nbegin\r\n  L:=Length(FBuckets[ABucket].Items);\r\n  if (FBuckets[ABucket].Count=L) then\r\n    begin\r\n    if L<8 then\r\n      L:=8\r\n    else\r\n      L:=L+L div 2;\r\n    SetLength(FBuckets[ABucket].Items,L);\r\n    end;\r\n  with FBuckets[ABucket] do\r\n    begin\r\n    Items[Count].Item:=AItem;\r\n    Items[Count].Data:=AData;\r\n    Result:=AData;\r\n    Inc(Count);\r\n    end;\r\nend;\r\n\r\nFunction TCustomBucketList.DeleteItem(ABucket: Integer; AIndex: Integer): JSValue;\r\nvar\r\n  I,L : Integer;\r\nbegin\r\n  Result:=FBuckets[ABucket].Items[AIndex].Data;\r\n  if FBuckets[ABucket].Count=1 then\r\n    SetLength(FBuckets[ABucket].Items,0)\r\n  else\r\n    begin\r\n    L:=(FBuckets[ABucket].Count-AIndex-1);// No point in moving if last one...\r\n    For I:=0 to L-1 do\r\n      FBuckets[ABucket].Items[AIndex+I]:=FBuckets[ABucket].Items[AIndex+I+1];\r\n    end;\r\n  Dec(FBuckets[ABucket].Count);\r\nend;\r\n\r\nProcedure TCustomBucketList.Error(Msg: String; Args: array of Const);\r\nbegin\r\n  raise ElistError.CreateFmt(Msg,Args);\r\nend;\r\n\r\nFunction TCustomBucketList.FindItem(AItem: JSValue; out ABucket, AIndex: Integer\r\n  ): Boolean;\r\nvar\r\n  I : Integer;\r\n  B : TBucket;\r\nbegin\r\n  ABucket:=BucketFor(AItem);\r\n  B:=FBuckets[ABucket];\r\n  I:=B.Count-1;\r\n  while (I>=0) and (B.Items[I].Item<>AItem) do\r\n    Dec(I);\r\n  Result:=I>=0;\r\n  if Result then\r\n    AIndex:=I;\r\nend;\r\n\r\ndestructor TCustomBucketList.Destroy;\r\nbegin\r\n  Clear;\r\n  inherited Destroy;\r\nend;\r\n\r\nProcedure TCustomBucketList.Clear;\r\nvar\r\n  B : TBucket;\r\n  I,J : Integer;\r\nbegin\r\n  for I:=0 to Length(FBuckets)-1 do\r\n    begin\r\n    B:=FBuckets[I];\r\n    for J:=B.Count-1 downto 0 do\r\n      DeleteItem(I,J);\r\n    end;\r\n  SetLength(FBuckets,0);\r\nend;\r\n\r\nFunction TCustomBucketList.Add(AItem, AData: JSValue): JSValue;\r\nvar\r\n  B,I : Integer;\r\nbegin\r\n  if FindItem(AItem,B,I) then\r\n    Error(SDuplicateItem,[AItem]);\r\n  Result:=AddItem(B,AItem,AData);\r\nend;\r\n\r\nProcedure TCustomBucketList.Assign(AList: TCustomBucketList);\r\nvar\r\n  I,J : Integer;\r\nbegin\r\n  Clear;\r\n  SetLength(FBuckets,Length(Alist.FBuckets));\r\n  for I:=0 to BucketCount-1 do\r\n    begin\r\n    SetLength(FBuckets[i].Items,Length(AList.Fbuckets[I].Items));\r\n    for J:=0 to AList.Fbuckets[I].Count-1 do\r\n      with AList.Fbuckets[I].Items[J] do\r\n        AddItem(I,Item,Data);\r\n    end;\r\nend;\r\n\r\nFunction TCustomBucketList.Exists(AItem: JSValue): Boolean;\r\nvar\r\n  B,I : Integer;\r\nbegin\r\n  Result:=FindItem(AItem,B,I);\r\nend;\r\n\r\nFunction TCustomBucketList.Find(AItem: JSValue; out AData: JSValue): Boolean;\r\nvar\r\n  B,I : integer;\r\nbegin\r\n  Result:=FindItem(AItem,B,I);\r\n  if Result then\r\n    AData:=FBuckets[B].Items[I].Data;\r\nend;\r\n\r\nFunction TCustomBucketList.ForEach(AProc: TBucketProc): Boolean;\r\nbegin\r\n  Result:=Foreach(aProc,Null);\r\nend;\r\n\r\nFunction TCustomBucketList.ForEach(AProc: TBucketProc; AInfo: JSValue): Boolean;\r\nvar\r\n  I,J,S : Integer;\r\n  Bu : TBucket;\r\nbegin\r\n  I:=0;\r\n  Result:=True;\r\n  S:=GetBucketCount;\r\n  while Result and (I<S) do\r\n    begin\r\n    J:=0;\r\n    Bu:=FBuckets[I];\r\n    while Result and (J<Bu.Count) do\r\n      begin\r\n      with Bu.Items[J] do\r\n        AProc(AInfo,Item,Data,Result);\r\n      Inc(J);\r\n      end;\r\n    Inc(I);\r\n    end;\r\nend;\r\n\r\nFunction TCustomBucketList.Remove(AItem: JSValue): JSValue;\r\nvar\r\n  B,I : integer;\r\nbegin\r\n  if FindItem(AItem,B,I) then\r\n    begin\r\n    Result:=FBuckets[B].Items[I].Data;\r\n    DeleteItem(B,I);\r\n    end\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\n{ TBucketList }\r\n\r\nFunction TBucketList.BucketFor(AItem: JSValue): Integer;\r\nbegin\r\n  // JSValues on average have a granularity of 4\r\n  Result:=(longword(AItem) shr 2) and FBucketMask;\r\nend;\r\n\r\nconstructor TBucketList.Create(ABuckets: TBucketListSizes);\r\nvar\r\n  L : Integer;\r\nbegin\r\n  inherited Create;\r\n  L:=1 shl (Ord(Abuckets)+1);\r\n  SetBucketCount(L);\r\n  FBucketMask:=L-1;\r\nend;\r\n\r\n{ TObjectBucketList }\r\n\r\nFunction TObjectBucketList.GetData(AItem: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited GetData(AItem));\r\nend;\r\n\r\nProcedure TObjectBucketList.SetData(AItem: TObject; const AData: TObject);\r\nbegin\r\n  inherited SetData(JSValue(AItem),JSValue(AData));\r\nend;\r\n\r\nFunction TObjectBucketList.Add(AItem, AData: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Add(JSValue(AItem),JSValue(AData)));\r\nend;\r\n\r\nFunction TObjectBucketList.Remove(AItem: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Remove(JSValue(AItem)));\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018                                      }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Modules;\r\n\r\n{$DEFINE NOPP}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes;\r\n\r\ntype\r\n  TDataModuleClass = class of TDataModule;\r\n  TDataModule = class(TComponent)\r\n  strict private\r\n    FHeight: Integer;\r\n    FOldCreateOrder: Boolean;\r\n    FOnCreate: TNotifyEvent;\r\n    FOnDestroy: TNotifyEvent;\r\n    FWidth: Integer;\r\n  strict protected\r\n    procedure DoCreate; virtual;\r\n    procedure DoDestroy; virtual;\r\n    procedure LoadDFMValues; virtual;\r\n  public\r\n    constructor CreateNew(AOwner: TComponent; Dummy: Integer = 0); virtual;\r\n    procedure AfterConstruction; override;\r\n    procedure BeforeDestruction; override;\r\n    property Height: Integer read FHeight write FHeight;\r\n    property OldCreateOrder: Boolean read FOldCreateOrder write FOldCreateOrder;\r\n    property Width: Integer read FWidth write FWidth;\r\n  published\r\n    property OnCreate: TNotifyEvent read FOnCreate write FOnCreate;\r\n    property OnDestroy: TNotifyEvent read FOnDestroy write FOnDestroy;\r\n  end;\r\n  TWebDataModule = TDataModule;\r\n\r\nimplementation\r\n\r\nconstructor TDataModule.CreateNew(AOwner: TComponent; Dummy: Integer);\r\nbegin\r\n  inherited Create(AOwner);\r\nend;\r\n\r\n{ TDataModule }\r\n\r\nprocedure TDataModule.AfterConstruction;\r\nbegin\r\n  inherited AfterConstruction;\r\n  if not OldCreateOrder then\r\n    DoCreate;\r\nend;\r\n\r\nprocedure TDataModule.BeforeDestruction;\r\nbegin\r\n  inherited BeforeDestruction;\r\n  if not OldCreateOrder then\r\n    DoDestroy;\r\nend;\r\n\r\nprocedure TDataModule.DoCreate;\r\nbegin\r\n  LoadDFMValues;\r\n  if Assigned(FOnCreate) then\r\n    FOnCreate(Self);\r\nend;\r\n\r\nprocedure TDataModule.DoDestroy;\r\nbegin\r\n  if Assigned(FOnDestroy) then\r\n    FOnDestroy(Self);\r\nend;\r\n\r\nprocedure TDataModule.LoadDFMValues;\r\nbegin\r\nend;\r\n\r\nend.\r\n","unit WEBLib.Lang;\r\n\r\ninterface\r\n\r\ntype\r\n\r\n  TUILanguage = (\r\n        lNone,\r\n        lAfar,\r\n        lAbkhazian,\r\n        lAvestan,\r\n        lAfrikaans,\r\n        lAkan,\r\n        lAmharic,\r\n        lAragonese,\r\n        lArabic,\r\n        lAssamese,\r\n        lAvaric,\r\n        lAymara,\r\n        lAzerbaijani,\r\n        lBashkir,\r\n        lBelarusian,\r\n        lBulgarian,\r\n        lBihari,\r\n        lBislama,\r\n        lBambara,\r\n        lBengali,\r\n        lTibetan,\r\n        lBreton,\r\n        lBosnian,\r\n        lCatalan,\r\n        lChechen,\r\n        lChamorro,\r\n        lCorsican,\r\n        lCree,\r\n        lCzech,\r\n        lOldSlavic,\r\n        lChuvash,\r\n        lWelsh,\r\n        lDanish,\r\n        lGerman,\r\n        lDivehi,\r\n        lDzongkha,\r\n        lEwe,\r\n        lEnglish,\r\n        lEsperanto,\r\n        lSpanish,\r\n        lEstonian,\r\n        lBasque,\r\n        lPersian,\r\n        lFulah,\r\n        lFinnish,\r\n        lFijian,\r\n        lFaroese,\r\n        lFrench,\r\n        lWesternFrisian,\r\n        lIrish,\r\n        lGaelic,\r\n        lGalician,\r\n        lGuarani,\r\n        lGujarati,\r\n        lManx,\r\n        lHausa,\r\n        lHebrew,\r\n        lHindi,\r\n        lHiriMotu,\r\n        lCroatian,\r\n        lHaitian,\r\n        lHungarian,\r\n        lArmenian,\r\n        lHerero,\r\n        lInterlingua,\r\n        lIndonesian,\r\n        lInterlingue,\r\n        lIgbo,\r\n        lSichuanYi,\r\n        lInupiaq,\r\n        lIdo,\r\n        lIcelandic,\r\n        lItalian,\r\n        lInuktitut,\r\n        lJapanese,\r\n        lJavanese,\r\n        lGeorgian,\r\n        lKongo,\r\n        lKikuyu,\r\n        lKuanyama,\r\n        lKazakh,\r\n        lKalaallisut,\r\n        lCentralKhmer,\r\n        lKannada,\r\n        lKorean,\r\n        lKanuri,\r\n        lKashmiri,\r\n        lKurdish,\r\n        lKomi,\r\n        lCornish,\r\n        lKirghiz,\r\n        lLatin,\r\n        lLuxembourgish,\r\n        lGanda,\r\n        lLimburgan,\r\n        lLingala,\r\n        lLao,\r\n        lLithuanian,\r\n        lLubaKatanga,\r\n        lLatvian,\r\n        lMalagasy,\r\n        lMarshallese,\r\n        lMaori,\r\n        lMacedonian,\r\n        lMalayalam,\r\n        lMongolian,\r\n        lMarathi,\r\n        lMalay,\r\n        lMaltese,\r\n        lBurmese,\r\n        lNauru,\r\n        lNdebele,\r\n        lNepali,\r\n        lNdonga,\r\n        lDutch,\r\n        lNorwegian,\r\n        lNavajo,\r\n        lChichewa,\r\n        lOccitan,\r\n        lOjibwa,\r\n        lOromo,\r\n        lOriya,\r\n        lOssetian,\r\n        lPanjabi,\r\n        lPali,\r\n        lPolish,\r\n        lPushto,\r\n        lPortuguese,\r\n        lQuechua,\r\n        lRomansh,\r\n        lRundi,\r\n        lRomanian,\r\n        lRussian,\r\n        lKinyarwanda,\r\n        lSanskrit,\r\n        lSardinian,\r\n        lSindhi,\r\n        lNorthernSami,\r\n        lSango,\r\n        lSinhala,\r\n        lSlovak,\r\n        lSlovenian,\r\n        lSamoan,\r\n        lShona,\r\n        lSomali,\r\n        lAlbanian,\r\n        lSerbian,\r\n        lSwati,\r\n        lSotho,\r\n        lSundanese,\r\n        lSwedish,\r\n        lSwahili,\r\n        lTamil,\r\n        lTelugu,\r\n        lTajik,\r\n        lThai,\r\n        lTigrinya,\r\n        lTurkmen,\r\n        lTagalog,\r\n        lTswana,\r\n        lTonga,\r\n        lTurkish,\r\n        lTsonga,\r\n        lTatar,\r\n        lTwi,\r\n        lTahitian,\r\n        lUighur,\r\n        lUkrainian,\r\n        lUrdu,\r\n        lUzbek,\r\n        lVenda,\r\n        lVietnamese,\r\n        lWalloon,\r\n        lWolof,\r\n        lXhosa,\r\n        lYiddish,\r\n        lYoruba,\r\n        lZhuang,\r\n        lChinese,\r\n        lZulu);\r\n\r\nfunction GetLanguageISO639_1Code(ALang: TUILanguage): string;\r\n\r\nimplementation\r\n\r\nfunction GetLanguageISO639_1Code(ALang: TUILanguage): string;\r\nbegin\r\n  case ALang of\r\n    lNone: Result := '';\r\n    lAfar: Result := 'aa';\r\n    lAbkhazian: Result := 'ab';\r\n    lAvestan: Result := 'ae';\r\n    lAfrikaans: Result := 'af';\r\n    lAkan: Result := 'ak';\r\n    lAmharic: Result := 'am';\r\n    lAragonese: Result := 'an';\r\n    lArabic: Result := 'ar';\r\n    lAssamese: Result := 'as';\r\n    lAvaric: Result := 'av';\r\n    lAymara: Result := 'ay';\r\n    lAzerbaijani: Result := 'az';\r\n    lBashkir: Result := 'ba';\r\n    lBelarusian: Result := 'be';\r\n    lBulgarian: Result := 'bg';\r\n    lBihari: Result := 'bh';\r\n    lBislama: Result := 'bi';\r\n    lBambara: Result := 'bm';\r\n    lBengali: Result := 'bn';\r\n    lTibetan: Result := 'bo';\r\n    lBreton: Result := 'br';\r\n    lBosnian: Result := 'bd';\r\n    lCatalan: Result := 'ca';\r\n    lChechen: Result := 'ce';\r\n    lChamorro: Result := 'ch';\r\n    lCorsican: Result := 'co';\r\n    lCree: Result := 'cr';\r\n    lCzech: Result := 'cs';\r\n    lOldSlavic: Result := 'cu';\r\n    lChuvash: Result := 'cv';\r\n    lWelsh: Result := 'cy';\r\n    lDanish: Result := 'da';\r\n    lGerman: Result := 'de';\r\n    lDivehi: Result := 'dv';\r\n    lDzongkha: Result := 'dz';\r\n    lEwe: Result := 'ee';\r\n    lEnglish: Result := 'en';\r\n    lEsperanto: Result := 'eo';\r\n    lSpanish: Result := 'es';\r\n    lEstonian: Result := 'et';\r\n    lBasque: Result := 'eu';\r\n    lPersian: Result := 'fa';\r\n    lFulah: Result := 'ff';\r\n    lFinnish: Result := 'fi';\r\n    lFijian: Result := 'fj';\r\n    lFaroese: Result := 'fo';\r\n    lFrench: Result := 'fr';\r\n    lWesternFrisian: Result := 'fy';\r\n    lIrish: Result := 'ga';\r\n    lGaelic: Result := 'gd';\r\n    lGalician: Result := 'gl';\r\n    lGuarani: Result := 'gn';\r\n    lGujarati: Result := 'gu';\r\n    lManx: Result := 'gv';\r\n    lHausa: Result := 'ha';\r\n    lHebrew: Result := 'he';\r\n    lHindi: Result := 'hi';\r\n    lHiriMotu: Result := 'ho';\r\n    lCroatian: Result := 'hr';\r\n    lHaitian: Result := 'ht';\r\n    lHungarian: Result := 'hu';\r\n    lArmenian: Result := 'hy';\r\n    lHerero: Result := 'hz';\r\n    lInterlingua: Result := 'ia';\r\n    lIndonesian: Result := 'id';\r\n    lInterlingue: Result := 'ie';\r\n    lIgbo: Result := 'ig';\r\n    lSichuanYi: Result := 'ii';\r\n    lInupiaq: Result := 'ik';\r\n    lIdo: Result := 'id';\r\n    lIcelandic: Result := 'is';\r\n    lItalian: Result := 'it';\r\n    lInuktitut: Result := 'iu';\r\n    lJapanese: Result := 'ja';\r\n    lJavanese: Result := 'jv';\r\n    lGeorgian: Result := 'ka';\r\n    lKongo: Result := 'kg';\r\n    lKikuyu: Result := 'ki';\r\n    lKuanyama: Result := 'kj';\r\n    lKazakh: Result := 'kk';\r\n    lKalaallisut: Result := 'kl';\r\n    lCentralKhmer: Result := 'km';\r\n    lKannada: Result := 'kn';\r\n    lKorean: Result := 'ko';\r\n    lKanuri: Result := 'kr';\r\n    lKashmiri: Result := 'ks';\r\n    lKurdish: Result := 'ku';\r\n    lKomi: Result := 'kv';\r\n    lCornish: Result := 'kw';\r\n    lKirghiz: Result := 'ky';\r\n    lLatin: Result := 'la';\r\n    lLuxembourgish: Result := 'lb';\r\n    lGanda: Result := 'lg';\r\n    lLimburgan: Result := 'li';\r\n    lLingala: Result := 'ln';\r\n    lLao: Result := 'lo';\r\n    lLithuanian: Result := 'lt';\r\n    lLubaKatanga: Result := 'lu';\r\n    lLatvian: Result := 'lv';\r\n    lMalagasy: Result := 'mg';\r\n    lMarshallese: Result := 'mh';\r\n    lMaori: Result := 'mi';\r\n    lMacedonian: Result := 'mk';\r\n    lMalayalam: Result := 'ml';\r\n    lMongolian: Result := 'mn';\r\n    lMarathi: Result := 'mr';\r\n    lMalay: Result := 'ms';\r\n    lMaltese: Result := 'mt';\r\n    lBurmese: Result := 'my';\r\n    lNauru: Result := 'na';\r\n    lNdebele: Result := 'nb';\r\n    lNepali: Result := 'nd';\r\n    lNdonga: Result := 'ng';\r\n    lDutch: Result := 'nl';\r\n    lNorwegian: Result := 'no';\r\n    lNavajo: Result := 'nv';\r\n    lChichewa: Result := 'ny';\r\n    lOccitan: Result := 'oc';\r\n    lOjibwa: Result := 'oj';\r\n    lOromo: Result := 'om';\r\n    lOriya: Result := 'or';\r\n    lOssetian: Result := 'os';\r\n    lPanjabi: Result := 'pa';\r\n    lPali: Result := 'pi';\r\n    lPolish: Result := 'pl';\r\n    lPushto: Result := 'ps';\r\n    lPortuguese: Result := 'pt';\r\n    lQuechua: Result := 'qu';\r\n    lRomansh: Result := 'rm';\r\n    lRundi: Result := 'rn';\r\n    lRomanian: Result := 'ro';\r\n    lRussian: Result := 'ru';\r\n    lKinyarwanda: Result := 'rw';\r\n    lSanskrit: Result := 'sa';\r\n    lSardinian: Result := 'sc';\r\n    lSindhi: Result := 'sd';\r\n    lNorthernSami: Result := 'se';\r\n    lSango: Result := 'sg';\r\n    lSinhala: Result := 'si';\r\n    lSlovak: Result := 'sk';\r\n    lSlovenian: Result := 'sl';\r\n    lSamoan: Result := 'sm';\r\n    lShona: Result := 'sn';\r\n    lSomali: Result := 'so';\r\n    lAlbanian: Result := 'sq';\r\n    lSerbian: Result := 'sr';\r\n    lSwati: Result := 'ss';\r\n    lSotho: Result := 'st';\r\n    lSundanese: Result := 'su';\r\n    lSwedish: Result := 'sv';\r\n    lSwahili: Result := 'sw';\r\n    lTamil: Result := 'ta';\r\n    lTelugu: Result := 'te';\r\n    lTajik: Result := 'tg';\r\n    lThai: Result := 'th';\r\n    lTigrinya: Result := 'ti';\r\n    lTurkmen: Result := 'tk';\r\n    lTagalog: Result := 'tl';\r\n    lTswana: Result := 'tn';\r\n    lTonga: Result := 'to';\r\n    lTurkish: Result := 'tr';\r\n    lTsonga: Result := 'ts';\r\n    lTatar: Result := 'tt';\r\n    lTwi: Result := 'tw';\r\n    lTahitian: Result := 'ty';\r\n    lUighur: Result := 'ug';\r\n    lUkrainian: Result := 'uk';\r\n    lUrdu: Result := 'ur';\r\n    lUzbek: Result := 'uz';\r\n    lVenda: Result := 've';\r\n    lVietnamese: Result := 'vi';\r\n    lWalloon: Result := 'wa';\r\n    lWolof: Result := 'wo';\r\n    lXhosa: Result := 'xh';\r\n    lYiddish: Result := 'yi';\r\n    lYoruba: Result := 'yo';\r\n    lZhuang: Result := 'za';\r\n    lChinese: Result := 'zh';\r\n    lZulu: Result := 'zu';\r\n  end;\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2022                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.JSON;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, Web, JS, SysUtils;\r\n\r\ntype\r\n  TJSONObject = class;\r\n  TJSONString = class;\r\n\r\n  TJSONAncestor = class(TObject)\r\n  private\r\n  protected\r\n    function GetStrValue: string; virtual;\r\n    procedure SetStrValue(const Value: string); virtual;\r\n  public\r\n    property Value: string read GetStrValue write SetStrValue;\r\n  end;\r\n\r\n  TJSONValue = class(TJSONAncestor)\r\n  private\r\n    fjv: JSValue;\r\n    fjo: JSValue;\r\n  protected\r\n    function GetStrValue: string; override;\r\n    property jv: JSValue read fjv write fjv;\r\n  public\r\n    constructor Create(AJSValue: JSValue); overload;\r\n    function ToString: string; override;\r\n    function GetValue<T>(const APath: string = ''): T;\r\n  end;\r\n\r\n  TJSONPair = class(TObject)\r\n  private\r\n    fjo: JSValue;\r\n    fjv: TJSONValue;\r\n    fjs: TJSONString;\r\n  public\r\n    constructor Create; overload;\r\n    constructor Create(const Str: string; const Value: TJSONValue); overload;\r\n    constructor Create(const Str: string; const Value: string); overload;\r\n    destructor Destroy; override;\r\n    property JsonValue: TJSONValue read fjv write fjv;\r\n    property JsonString: TJSONString read fjs write fjs;\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSONPairList = class(TList);\r\n\r\n  TJSONObject = class(TJSONValue)\r\n  private\r\n    fjo: TJSObject;\r\n    FMembers: TJSONPairList;\r\n    function GetPair(const I: Integer): TJSONPair;\r\n    function GetCount: Integer;\r\n    function GetItem(const Index: Integer): TJSONValue;\r\n    procedure SetValues(const Name: string; const Value: TJSONValue);\r\n  protected\r\n    property jo: TJSObject read fjo write fjo;\r\n    procedure AddDescendant(const Descendent: TJSONPair); virtual;\r\n    class function JSONValueFromJS(const AJSValue: JSValue): TJSONValue;\r\n  public\r\n    constructor Create; overload;\r\n    constructor Create(AObject: TJSObject); overload;\r\n    destructor Destroy; override;\r\n    property JSObject: TJSObject read fjo;\r\n    class function ParseJSONValue(const data: string): TJSONValue;\r\n    function GetJSONValue(Name: string): string;\r\n    function Get(Name: string): TJSONPair; overload;\r\n    function Get(Index: Integer): TJSONPair; overload;\r\n    function GetValue(const Name: string): TJSONValue;\r\n    procedure SetValue(const Name: string; AValue: string); overload;\r\n    procedure SetValue(const Name: string; AValue: integer); overload;\r\n    procedure SetValue(const Name: string; AValue: double); overload;\r\n    property Items[const Index: Integer]: TJSONValue read GetItem;\r\n    property Values[const Name: string]: TJSONValue read GetValue write SetValues;\r\n    property Pairs[const Index: Integer]: TJSONPair read GetPair;\r\n    property Count: Integer read GetCount;\r\n    function AddPair(const Pair: TJSONPair): TJSONObject; overload;\r\n    function AddPair(const Str: string; const Val: TJSONValue): TJSONObject; overload;\r\n    function AddPair(const Str: string; const Val: string): TJSONObject; overload;\r\n    function AddPair(const Str: string; const Val: Integer): TJSONObject; overload;\r\n\r\n    function ToJSON: string;\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSONString = class(TJSONValue)\r\n  private\r\n    FValue: string;\r\n  protected\r\n    function GetStrValue: string; override;\r\n    procedure SetStrValue(const Value: string); override;\r\n  public\r\n    constructor Create(AString: string); overload;\r\n  end;\r\n\r\n  TJSONNumber = class(TJSONString)\r\n  private\r\n    FInt: integer;\r\n    FDouble: Double;\r\n  protected\r\n    function GetStrValue: string; override;\r\n    procedure SetStrValue(const Value: string); override;\r\n  public\r\n    constructor Create(ANumber: integer); overload;\r\n    constructor Create(ANumber: double); overload;\r\n\r\n    property AsInt: integer read FInt write FInt;\r\n    property AsDouble: Double read FDouble write FDouble;\r\n    property AsFloat: Double read FDouble write FDouble;\r\n  end;\r\n\r\n  TJSONTrue = class(TJSONValue)\r\n  protected\r\n    function GetStrValue: string; override;\r\n  public\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSONFalse = class(TJSONValue)\r\n  protected\r\n    function GetStrValue: string; override;\r\n  public\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSONNull = class(TJSONValue)\r\n  protected\r\n    function GetStrValue: string; override;\r\n  public\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSONArray = class(TJSONObject)\r\n  private\r\n    fja: TJSArray;\r\n    function GetItem(index: integer): TJSONValue;\r\n    procedure SetItem(index: integer; const Value: TJSONValue);\r\n    function GetCount: integer; reintroduce;\r\n    function GetJA: TJSArray;\r\n  protected\r\n    property ja: TJSArray read GetJA write fja;\r\n  public\r\n    constructor Create(AArray: TJSArray); overload;\r\n    property Count: integer read GetCount;\r\n    property Items[index: integer]: TJSONValue read GetItem write SetItem; default;\r\n    procedure Add(const Element: string); overload;\r\n    procedure Add(const Element: boolean); overload;\r\n    procedure Add(const Element: integer); overload;\r\n    procedure Add(const Element: double); overload;\r\n    procedure Add(const Element: TJSONObject); overload;\r\n    procedure Add(const Element: TJSONPair); overload;\r\n\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSON = class(TObject)\r\n    function Parse(s: string): TJSONObject;\r\n  end;\r\n\r\n\r\nimplementation\r\n\r\n\r\nfunction JSONObjectToString(const v: JSValue): string; assembler;\r\nasm\r\n  return v+\"\";\r\nend;\r\n\r\n{ TJSON }\r\n\r\nfunction TJSON.Parse(s: string): TJSONObject;\r\nvar\r\n  O: TJSObject;\r\nbegin\r\n  O := TJSJSON.parseObject(s);\r\n\r\n  if isArray(O) then\r\n  begin\r\n    Result := TJSONArray.Create(TJSArray(O));\r\n  end\r\n  else\r\n  begin\r\n    Result := TJSONObject.Create(O);\r\n  end;\r\nend;\r\n\r\n{ TJSONArray }\r\n\r\nprocedure TJSONArray.Add(const Element: string);\r\nbegin\r\n  ja.push(Element);\r\nend;\r\n\r\nprocedure TJSONArray.Add(const Element: integer);\r\nbegin\r\n  ja.push(Element);\r\nend;\r\n\r\nprocedure TJSONArray.Add(const Element: boolean);\r\nbegin\r\n  ja.push(Element);\r\nend;\r\n\r\nprocedure TJSONArray.Add(const Element: TJSONObject);\r\nbegin\r\n  ja.push(Element);\r\nend;\r\n\r\nprocedure TJSONArray.Add(const Element: double);\r\nbegin\r\n  ja.push(Element);\r\nend;\r\n\r\nprocedure TJSONArray.Add(const Element: TJSONPair);\r\nbegin\r\n  ja.push(Element);\r\nend;\r\n\r\nconstructor TJSONArray.Create(AArray: TJSArray);\r\nbegin\r\n  inherited Create;\r\n  ja := AArray;\r\nend;\r\n\r\nfunction TJSONArray.GetCount: integer;\r\nbegin\r\n  Result := ja.Length;\r\nend;\r\n\r\nfunction TJSONArray.GetItem(index: integer): TJSONValue;\r\nvar\r\n  jv: JSValue;\r\nbegin\r\n  jv := ja[Index];\r\n  if (jv is TJSONObject) or (jv is TJSONArray) then\r\n    Result := TJSONValue(jv)\r\n  else\r\n    Result := JSONValueFromJS(jv);\r\nend;\r\n\r\nfunction TJSONArray.GetJA: TJSArray;\r\nbegin\r\n  if not Assigned(fja) then\r\n    fja := TJSArray.new;\r\n\r\n  Result := fja;\r\nend;\r\n\r\nprocedure TJSONArray.SetItem(index: integer; const Value: TJSONValue);\r\nbegin\r\n  if Value is TJSONObject then\r\n    ja[index] := TJSONObject(Value).jo;\r\nend;\r\n\r\nfunction TJSONArray.ToString: string;\r\nvar\r\n  i: integer;\r\n  jv: TJSONValue;\r\n  comma: string;\r\nbegin\r\n  Result := '[';\r\n  comma := '';\r\n\r\n  for i := 0 to Count - 1 do\r\n  begin\r\n    jv := Items[i];\r\n\r\n    if Assigned(jv) then\r\n    begin\r\n      if (jv is TJSONObject) then\r\n      begin\r\n        Result := Result + comma + (jv as TJSONObject).ToString;\r\n      end\r\n      else\r\n        Result := Result + comma + jv.ToString;\r\n\r\n      comma := ',';\r\n    end;\r\n  end;\r\n\r\n  Result := Result + ']';\r\nend;\r\n\r\n{ TJSONObject }\r\n\r\nconstructor TJSONObject.Create;\r\nbegin\r\n  inherited Create;\r\n  FMembers := TJSONPairList.Create;\r\n  fjo := nil;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TJSONObject.AddPair(const Pair: TJSONPair): TJSONObject;\r\nvar\r\n  LObj: TJSONObject;\r\n  o: TJSObject;\r\nbegin\r\n  if Assigned(Pair) then\r\n  begin\r\n    AddDescendant(Pair);\r\n    if Assigned(fjo) then\r\n    begin\r\n      o := fjo;\r\n      asm\r\n        o[Pair.fjs.FValue] = Pair.fjv.fjv;\r\n      end;\r\n    end;\r\n\r\n    LObj := TJSONObject(ParseJSONValue(ToJSON));\r\n  end;\r\n  Result := LObj;\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction TJSONObject.AddPair(const Str: string;\r\n  const Val: TJSONValue): TJSONObject;\r\nbegin\r\n  AddPair(TJSONPair.Create(Str, Val));\r\n  Result := Self;\r\nend;\r\n\r\nprocedure TJSONObject.AddDescendant(const Descendent: TJSONPair);\r\nbegin\r\n  FMembers.Add(Descendent);\r\nend;\r\n\r\nfunction TJSONObject.AddPair(const Str, Val: string): TJSONObject;\r\nbegin\r\n  AddPair(TJSONPair.Create(Str, Val));\r\n  Result := Self;\r\nend;\r\n\r\nfunction TJSONObject.AddPair(const Str: string; const Val: Integer): TJSONObject;\r\nbegin\r\n  AddPair(TJSONPair.Create(Str, TJSONNumber.Create(Val)));\r\n  Result := Self;\r\nend;\r\n\r\nconstructor TJSONObject.Create(AObject: TJSObject);\r\nbegin\r\n  inherited Create;\r\n  FMembers := TJSONPairList.Create;\r\n  jo := AObject;\r\nend;\r\n\r\ndestructor TJSONObject.Destroy;\r\nbegin\r\n  FMembers.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TJSONObject.Get(Index: Integer): TJSONPair;\r\nbegin\r\n  Result := Get(TJSObject.keys(jo)[Index]);\r\nend;\r\n\r\nfunction TJSONObject.Get(Name: string): TJSONPair;\r\nvar\r\n  jv: JSValue;\r\n  jsv: TJSONValue;\r\n  i: integer;\r\n  p: TJSONPair;\r\nbegin\r\n  Result := nil;\r\n\r\n  if Assigned(jo) then\r\n  begin\r\n    jv := jo.Properties[Name];\r\n\r\n    if jv <> Null then\r\n    begin\r\n      Result := TJSONPair.Create;\r\n      jsv := JSONValueFromJS(jv);\r\n      Result.fjo := jo;\r\n      Result.JsonString.Value := Name;\r\n      Result.JsonValue := jsv;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    for i := 0 to FMembers.Count - 1 do\r\n    begin\r\n      p := TJSONPair(FMembers.Items[i]);\r\n      if (p.fjs.ToString = '\"'+Name+'\"') then\r\n        Result := p;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TJSONObject.GetCount: Integer;\r\nbegin\r\n  if Assigned(jo) then\r\n    Result := Length(TJSObject.keys(jo))\r\n  else\r\n    if Assigned(FMembers) then\r\n      Result := FMembers.Count\r\n    else\r\n      Result := 0;\r\nend;\r\n\r\nfunction TJSONObject.GetItem(const Index: Integer): TJSONValue;\r\nvar\r\n  jv: JSValue;\r\nbegin\r\n  jv := jo[TJSObject.keys(jo)[Index]];\r\n  Result := JSONValueFromJS(jv);\r\nend;\r\n\r\nfunction TJSONObject.GetJSONValue(Name: string): string;\r\nvar\r\n  jv: JSValue;\r\nbegin\r\n  jv :=  jo.Properties[Name];\r\n  Result := JSONObjectToString(jv);\r\nend;\r\n\r\nfunction TJSONObject.GetPair(const I: Integer): TJSONPair;\r\nvar\r\n  v: TJSONValue;\r\n  l: integer;\r\n  s: string;\r\nbegin\r\n  if (FMembers.Count = 0) and  Assigned(jo) and (length(TJSObject.keys(jo)) > 0) then\r\n  begin\r\n    l := length(TJSObject.keys(jo));\r\n    if I < l then\r\n    begin\r\n      s := TJSObject.keys(jo)[I];\r\n      v := TJSONValue.Create(jo[s]);\r\n      Result := TJSONPair.Create(s,v);\r\n      Exit;\r\n    end;\r\n  end;\r\n\r\n  if (I >= 0) and (I < FMembers.Count) then\r\n    Result := TJSONPair(FMembers[I])\r\n  else\r\n    Result := nil;\r\nend;\r\n\r\nfunction TJSONObject.GetValue(const Name: string): TJSONValue;\r\nvar\r\n  jp: TJSONPair;\r\nbegin\r\n  Result := nil;\r\n\r\n  jp := Get(Name);\r\n\r\n  if Assigned(jp) then\r\n  begin\r\n    Result := jp.JsonValue;\r\n    Result.fjo := jp.fjo;\r\n  end;\r\nend;\r\n\r\nclass function TJSONObject.JSONValueFromJS(const AJSValue: JSValue): TJSONValue;\r\nvar\r\n  d: double;\r\nbegin\r\n  Result := nil;\r\n\r\n  if isArray(AJSValue) then\r\n  begin\r\n    Result := TJSONArray.Create;\r\n    (Result as TJSONArray).ja := TJSArray(AJSValue);\r\n  end\r\n  else\r\n  if isObject(AJSValue) then\r\n  begin\r\n    Result := TJSONObject.Create;\r\n    (Result as TJSONObject).jo := TJSObject(AJSValue);\r\n  end\r\n  else\r\n  if isString(AJSValue) then\r\n  begin\r\n    Result := TJSONString.Create;\r\n    (Result as TJSONString).Value := string(AJSValue);\r\n  end\r\n  else\r\n  if isNumber(AJSValue) then\r\n  begin\r\n    Result := TJSONNumber.Create;\r\n    (Result as TJSONNumber).Value := string(AJSValue);\r\n    d := double(AJSValue);\r\n    (Result as TJSONNumber).AsDouble := d;\r\n    if Frac(d) = 0 then\r\n      (Result as TJSONNumber).AsInt := integer(AJSValue);\r\n  end\r\n  else\r\n  if isNull(AJSValue) then\r\n    Result := TJSONNull.Create\r\n  else\r\n  if isBoolean(AJSValue) then\r\n  begin\r\n    if toBoolean(AJSValue) then\r\n      Result := TJSONTrue.Create\r\n    else\r\n      Result := TJSONFalse.Create;\r\n  end;\r\n\r\n  if not Assigned(Result) then\r\n    Result := TJSONNull.Create;\r\n\r\n  Result.jv := AJSValue;\r\nend;\r\n\r\nclass function TJSONObject.ParseJSONValue(const data: string): TJSONValue;\r\nvar\r\n  O: TJSObject;\r\nbegin\r\n  O := TJSJSON.parseObject(data);\r\n  Result := JSONValueFromJS(O);\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TJSONObject.SetValue(const Name: string; AValue: string);\r\nvar\r\n  O: TJSObject;\r\nbegin\r\n  O := JSObject;\r\n  asm\r\n    O[Name] = AValue;\r\n  end;\r\nend;\r\n\r\nprocedure TJSONObject.SetValue(const Name: string; AValue: integer);\r\nvar\r\n  O: TJSObject;\r\nbegin\r\n  O := JSObject;\r\n  asm\r\n    O[Name] = AValue;\r\n  end;\r\nend;\r\n\r\nprocedure TJSONObject.SetValue(const Name: string; AValue: double);\r\nvar\r\n  O: TJSObject;\r\nbegin\r\n  O := JSObject;\r\n  asm\r\n    O[Name] = AValue;\r\n  end;\r\nend;\r\n\r\nprocedure TJSONObject.SetValues(const Name: string; const Value: TJSONValue);\r\nvar\r\n  O: TJSObject;\r\nbegin\r\n  O := JSObject;\r\n  asm\r\n    O[Name] = Value;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction TJSONObject.ToJSON: string;\r\nvar\r\n  s: string;\r\n  Size: Integer;\r\n  I: Integer;\r\n  jp: TJSONPair;\r\nbegin\r\n  if Assigned(jo) then\r\n    Size := Count\r\n  else\r\n    Size := FMembers.Count;\r\n\r\n  if (Self is TJSONArray) then\r\n  begin\r\n    Result := (Self as TJSONArray).ToString;\r\n  end\r\n  else\r\n  begin\r\n    s := '{';\r\n    if Size > 0 then\r\n    begin\r\n      if Assigned(jo) then\r\n      begin\r\n        jp := TJSONPair(Get(0));\r\n        if Assigned(jp) then\r\n          s := s + jp.ToString\r\n        else\r\n          s := s + '\"' + TJSObject.keys(jo)[0] +'\":null';\r\n      end\r\n      else\r\n        s := s + TJSONPair(FMembers[0]).ToString;\r\n    end;\r\n\r\n    for I := 1 to Size - 1 do\r\n    begin\r\n      if Assigned(jo) then\r\n      begin\r\n        jp := TJSONPair(Get(I));\r\n        if Assigned(jp) then\r\n          s := s + ',' + jp.ToString\r\n        else\r\n          s := s + ',' + '\"' + TJSObject.keys(jo)[I] +'\":null';\r\n      end\r\n      else\r\n        s := s + ',' + TJSONPair(FMembers[I]).ToString;\r\n    end;\r\n    s := s + '}';\r\n    Result := s;\r\n  end;\r\nend;\r\n\r\nfunction TJSONObject.ToString: string;\r\nbegin\r\n  Result := ToJSON;\r\nend;\r\n\r\n{ TJSONPair }\r\n\r\nconstructor TJSONPair.Create;\r\nbegin\r\n  inherited;\r\n  fjs := TJSONString.Create;\r\nend;\r\n\r\nconstructor TJSONPair.Create(const Str: string; const Value: TJSONValue);\r\nbegin\r\n  inherited Create;\r\n  JsonString := TJSONString.Create(Str);\r\n  JsonValue := Value;\r\nend;\r\n\r\nconstructor TJSONPair.Create(const Str, Value: string);\r\nbegin\r\n  inherited Create;\r\n  JsonString := TJSONString.Create(Str);\r\n  JsonValue := TJSONString.Create(Value);\r\nend;\r\n\r\ndestructor TJSONPair.Destroy;\r\nbegin\r\n  fjs.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TJSONPair.ToString: string;\r\nbegin\r\n  if (JsonValue is TJSONObject) then\r\n    Result := '\"' + JsonString.GetStrValue + '\":' + (JsonValue as TJSONObject).ToJSON\r\n  else\r\n  begin\r\n    if (JsonString <> nil) and (JsonValue <> nil) then\r\n      Result := '\"' + JsonString.GetStrValue + '\":' + JsonValue.ToString\r\n    else\r\n      Result := '';\r\n  end;\r\nend;\r\n\r\n{ TJSONAncestor }\r\n\r\nfunction TJSONAncestor.GetStrValue: string;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nprocedure TJSONAncestor.SetStrValue(const Value: string);\r\nbegin\r\n  //\r\nend;\r\n\r\n{ TJSONString }\r\n\r\nconstructor TJSONString.Create(AString: string);\r\nbegin\r\n  inherited Create;\r\n  jv := AString;\r\n  FValue := AString;\r\nend;\r\n\r\nfunction TJSONString.GetStrValue: string;\r\nbegin\r\n  Result := FValue;\r\nend;\r\n\r\nprocedure TJSONString.SetStrValue(const Value: string);\r\nbegin\r\n  FValue := Value;\r\n  jv := Value;\r\n\r\n  if Assigned(fjo) then\r\n  begin\r\n    asm\r\n      var s = Object.keys(this.fjo)[0];\r\n      this.fjo[s] = Value;\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TJSONNumber }\r\n\r\nconstructor TJSONNumber.Create(ANumber: integer);\r\nbegin\r\n  inherited Create;\r\n  jv := ANumber;\r\nend;\r\n\r\nconstructor TJSONNumber.Create(ANumber: double);\r\nbegin\r\n  inherited Create;\r\n  jv := ANumber;\r\nend;\r\n\r\nfunction TJSONNumber.GetStrValue: string;\r\nbegin\r\n  Result := FloatToStr(FDouble);\r\nend;\r\n\r\nprocedure TJSONNumber.SetStrValue(const Value: string);\r\nbegin\r\n  FDouble := StrToFloat(Value);\r\n  if Frac(FDouble) = 0 then\r\n  begin\r\n    if not TryStrToInt(Value, FInt) then\r\n      FInt := 0;\r\n    jv := FInt;\r\n  end\r\n  else\r\n    jv := FDouble;\r\nend;\r\n\r\n{ TJSONTrue }\r\n\r\nfunction TJSONTrue.GetStrValue: string;\r\nbegin\r\n   Result := 'true';\r\nend;\r\n\r\nfunction TJSONTrue.ToString: string;\r\nbegin\r\n  Result := GetStrValue;\r\nend;\r\n\r\n{ TJSONFalse }\r\n\r\nfunction TJSONFalse.GetStrValue: string;\r\nbegin\r\n  Result := 'false';\r\nend;\r\n\r\n\r\nfunction TJSONFalse.ToString: string;\r\nbegin\r\n  Result := GetStrValue;\r\nend;\r\n\r\n{ TJSONNull }\r\n\r\nfunction TJSONNull.GetStrValue: string;\r\nbegin\r\n  Result := 'null';\r\nend;\r\n\r\n\r\nfunction TJSONNull.ToString: string;\r\nbegin\r\n  Result := GetStrValue;\r\nend;\r\n\r\n{ TJSONValue }\r\n\r\nconstructor TJSONValue.Create(AJSValue: JSValue);\r\nbegin\r\n  inherited Create;\r\n  jv := AJSValue;\r\nend;\r\n\r\nfunction TJSONValue.ToString: string;\r\nbegin\r\n  Result := TJSJSON.stringify(jv);\r\nend;\r\n\r\nfunction TJSONValue.GetStrValue: string;\r\nbegin\r\n  Result := string(jv);\r\nend;\r\n\r\n\r\nfunction TJSONValue.GetValue<T>(const APath: string = ''): T;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.ClientConnector;\r\n\r\n{$DEFINE NOPP}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.JSON;\r\n\r\ntype\r\n  TClientConnectorIdentifier = (ciUnknown, ciAndroid, ciiOS, ciWindows, ciMac);\r\n\r\n  TClientConnectorReceivedMessageEvent = procedure(Sender: TObject; AJSON: TJSONObject) of object;\r\n\r\n  TClientConnector = class(TComponent)\r\n  private\r\n    FOnReceivedMessage: TClientConnectorReceivedMessageEvent;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Receive(AJSON: string);\r\n    procedure Send(AJSON: TJSONObject);\r\n    procedure SendMessage(AMessage: string);\r\n  published\r\n    property OnReceivedMessage: TClientConnectorReceivedMessageEvent read FOnReceivedMessage write FOnReceivedMessage;\r\n  end;\r\n\r\n  TWebClientConnector = class(TClientConnector);\r\n\r\nimplementation\r\n\r\nuses\r\n  Math, JS, WEBLib.Forms, SysUtils, WEBLib.Dialogs;\r\n\r\nconst\r\n  Prefix: string = 'webclientevent://';\r\n\r\nconstructor TClientConnector.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  Application.ClientConnector := Self;\r\nend;\r\n\r\ndestructor TClientConnector.Destroy;\r\nbegin\r\n  Application.ClientConnector := nil;\r\n  inherited;\r\nend;\r\n\r\nprocedure TClientConnector.Receive(AJSON: string);\r\nvar\r\n  js: TJSON;\r\n  o: TJSONObject;\r\n  s: string;\r\nbegin\r\n  js := TJSON.Create;\r\n  s := decodeURIComponent(AJSON);\r\n  o := js.parse(s);\r\n  if Assigned(OnReceivedMessage) then\r\n    OnReceivedMessage(Self, o);\r\n  o.Free;\r\nend;\r\n\r\nprocedure TClientConnector.Send(AJSON: TJSONObject);\r\nvar\r\n  s: string;\r\nbegin\r\n  s := TJSJSON.stringify(AJSON.JSObject);\r\n  SendMessage(s);\r\nend;\r\n\r\nprocedure TClientConnector.SendMessage(AMessage: string);\r\nconst\r\n  MAXBUFFERCOUNT = 500;\r\nvar\r\n  s: string;\r\n  cid: TClientConnectorIdentifier;\r\n  scid: string;\r\n  sSub: string;\r\n  sc: Integer;\r\n\r\n  procedure InternalSend(m: string);\r\n  begin\r\n    case cid of\r\n      ciAndroid:\r\n      begin\r\n        asm\r\n          injectedObject.Setjsvalue(m);\r\n          injectedObject.performClick();\r\n        end;\r\n      end;\r\n      ciiOS, ciMac:\r\n      begin\r\n        asm\r\n          window.webkit.messageHandlers.bridge.postMessage(m);\r\n        end;\r\n      end;\r\n      ciWindows:\r\n      begin\r\n        asm\r\n          window.location = m;\r\n        end;\r\n      end;\r\n      ciUnknown: ShowMessage('Please perform handshake from client first.');\r\n    end;\r\n  end;\r\nbegin\r\n  s := AMessage;\r\n  asm\r\n    scid = window.TMSWEBCoreClientIdentifier;\r\n  end;\r\n\r\n  cid := ciUnknown;\r\n  case LowerCase(scid) of\r\n    'android': cid := ciAndroid;\r\n    'ios': cid := ciiOS;\r\n    'windows': cid := ciWindows;\r\n    'mac', 'macos': cid := ciMac;\r\n  end;\r\n\r\n\r\n  case LowerCase(scid) of\r\n    'mac', 'macos', 'ios': InternalSend(Prefix + encodeURIcomponent(s));\r\n    'android', 'windows':\r\n    begin\r\n      InternalSend(Prefix + 'BUFFERSTART');\r\n      while Length(s) > 0 do\r\n      begin\r\n        sc := Min(Integer(Length(s)), MAXBUFFERCOUNT);\r\n        sSub := Copy(s, 1, sc);\r\n        Delete(s, 1, sc);\r\n        InternalSend(Prefix + encodeURIcomponent(sSub));\r\n      end;\r\n      InternalSend(Prefix + 'BUFFEREND');\r\n    end;\r\n  end;\r\nend;\r\n\r\nend.\r\n","unit Rtl.BrowserLoadHelper;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, SysUtils, JS, Web;\r\n\r\nType\r\n  { TBrowserLoadHelper }\r\n\r\n  TBrowserLoadHelper = Class (TLoadHelper)\r\n  Public\r\n    Class Procedure LoadText(aURL : String; aSync : Boolean; OnLoaded : TTextLoadedCallBack; OnError : TErrorCallBack); override;\r\n    Class Procedure LoadBytes(aURL : String; aSync : Boolean; OnLoaded : TBytesLoadedCallBack; OnError : TErrorCallBack); override;\r\n  end;\r\n\r\nimplementation\r\n\r\n{ TBrowserLoadHelper }\r\n\r\nclass procedure TBrowserLoadHelper.LoadText(aURL: String; aSync: Boolean; OnLoaded: TTextLoadedCallBack; OnError: TErrorCallBack);\r\n\r\n  function doFetchOK(response : JSValue) : JSValue;\r\n\r\n  var\r\n    Res : TJSResponse absolute response;\r\n\r\n  begin\r\n    Result:=False;\r\n    If (Res.status<>200) then\r\n      begin\r\n      If Assigned(OnError) then\r\n        OnError('Error '+IntToStr(Res.Status)+ ': '+Res.StatusText)\r\n      end\r\n    else\r\n      Res.Text._then(\r\n        function (value : JSValue) : JSValue\r\n          begin\r\n          OnLoaded(String(value));\r\n          end\r\n      );\r\n  end;\r\n\r\n  function doFetchFail(response : JSValue) : JSValue;\r\n\r\n  begin\r\n    Result:=False;\r\n    OnError('Error 999: unknown error');\r\n  end;\r\n\r\nbegin\r\n  if ASync then\r\n    Window.Fetch(aURl)._then(@DoFetchOK).catch(@DoFetchFail)\r\n  else\r\n    With TJSXMLHttpRequest.new do\r\n      begin\r\n      open('GET', aURL, False);\r\n      AddEventListener('load',Procedure (oEvent: JSValue)\r\n        begin\r\n        OnLoaded(responseText);\r\n        end\r\n      );\r\n      AddEventListener('error',Procedure (oEvent: JSValue)\r\n        begin\r\n        if Assigned(OnError) then\r\n          OnError(TJSError(oEvent).Message);\r\n        end\r\n      );\r\n      send();\r\n      end;\r\nend;\r\n\r\nclass procedure TBrowserLoadHelper.LoadBytes(aURL: String; aSync: Boolean; OnLoaded: TBytesLoadedCallBack; OnError: TErrorCallBack);\r\n\r\n  function doFetchFail(response : JSValue) : JSValue;\r\n\r\n  begin\r\n    Result:=False;\r\n    if isObject(Response) and (TJSObject(Response) is TJSError) then\r\n      OnError('Error 999: '+TJSError(Response).Message)\r\n    else\r\n      OnError('Error 999: unknown error');\r\n  end;\r\n\r\n\r\n  function doFetchOK(response : JSValue) : JSValue;\r\n\r\n  var\r\n    Res : TJSResponse absolute response;\r\n\r\n  begin\r\n    Result:=False;\r\n    If (Res.status<>200) then\r\n      begin\r\n      If Assigned(OnError) then\r\n        OnError('Error '+IntToStr(Res.Status)+ ': '+Res.StatusText)\r\n      end\r\n    else\r\n      Res.Blob._then(\r\n        function (value : JSValue) : JSValue\r\n          begin\r\n          TJSBlob(Value).ArrayBuffer._then(function(arr : JSValue) : JSValue\r\n            begin\r\n            OnLoaded(TJSArrayBuffer(arr))\r\n            end\r\n          ).Catch(@DoFetchFail);\r\n          end\r\n        );\r\n  end;\r\n\r\n\r\n  function StringToArrayBuffer(str : string) : TJSArrayBuffer;\r\n\r\n  Var\r\n    i,l : Integer;\r\n\r\n  begin\r\n    L:=Length(str);\r\n    Result:=TJSArrayBuffer.New(l*2); // 2 bytes for each char\r\n    With TJSUint16Array.New(Result) do\r\n      for i:=1 to L do\r\n        Values[i-1]:=Ord(Str[i]);\r\n  end;\r\n\r\nbegin\r\n  if ASync then\r\n    Window.Fetch(aURl)._then(@DoFetchOK).catch(@DoFetchFail)\r\n  else\r\n    With TJSXMLHttpRequest.new do\r\n      begin\r\n      open('GET', aURL, False);\r\n      AddEventListener('load',Procedure (oEvent: JSValue)\r\n        begin\r\n        if Status<>200 then\r\n          OnError('Error '+IntToStr(Status)+ ': '+StatusText)\r\n        else\r\n          OnLoaded(StringToArrayBuffer(responseText));\r\n        end\r\n      );\r\n      AddEventListener('error',Procedure (oEvent: JSValue)\r\n        begin\r\n        if Assigned(OnError) then\r\n          OnError(TJSError(oEvent).Message);\r\n        end\r\n      );\r\n      send();\r\n      end;\r\nend;\r\n\r\ninitialization\r\n  SetLoadHelperClass(TBrowserLoadHelper);\r\nend.\r\n\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2022                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Forms;\r\n\r\n{$DEFINE NOPP}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, Types, SysUtils, WEBLib.Graphics, WEBLib.Controls, WEBLib.Modules,\r\n  WEBLib.Lang, WEBLib.Menus, Web, JS, WEBLib.ClientConnector, Rtl.BrowserLoadHelper\r\n  {$IFDEF SINGLEINSTANCE}\r\n  , WEBLib.WebSocketClient\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  WEBCOREVERSION = '2.0.2.1 Pescara';\r\n\r\n  idOK       = 1;\r\n  idCancel   = 2;\r\n  idAbort    = 3;\r\n  idRetry    = 4;\r\n  idIgnore   = 5;\r\n  idYes      = 6;\r\n  idNo       = 7;\r\n  idClose    = 8;\r\n  idHelp     = 9;\r\n  idTryAgain = 10;\r\n  idContinue = 11;\r\n  mrNone     = 0;\r\n  mrOk       = idOk;\r\n  mrCancel   = idCancel;\r\n  mrAbort    = idAbort;\r\n  mrRetry    = idRetry;\r\n  mrIgnore   = idIgnore;\r\n  mrYes      = idYes;\r\n  mrNo       = idNo;\r\n  mrClose    = idClose;\r\n  mrHelp     = idHelp;\r\n  mrTryAgain = idTryAgain;\r\n  mrContinue = idContinue;\r\n  mrAll      = mrContinue + 1;\r\n  mrNoToAll  = mrAll + 1;\r\n  mrYesToAll = mrNoToAll + 1;\r\n\r\n  rgiFirst = -1024;\r\n  rgiLast  = -513;\r\n  igiFirst = 256;\r\n  igiLast  = 511;\r\n\r\n  clTMSBlue = $E39E00;\r\n  clTMSWEB = $8F8300;\r\n\r\ntype\r\n  TDragDockObject = class;\r\n  TCustomForm = class;\r\n\r\n  TConstraintSize = 0..MaxInt;\r\n  TCloseAction = (caNone, caHide, caFree, caMinimize);\r\n  TModalResult = Integer;\r\n  TFormStyle = (fsNormal, fsStayOnTop);\r\n  TNavigationTarget = (ntBlank, ntPage);\r\n  TGestureID = rgiFirst..igiLast;\r\n  TInteractiveGestureFlag = (gfBegin, gfInertia, gfEnd);\r\n  TInteractiveGestureFlags = set of TInteractiveGestureFlag;\r\n  TMouseActivate = (maDefault, maActivate, maActivateAndEat, maNoActivate, maNoActivateAndEat);\r\n  TScreenOrientation = (soPortrait, soLandscape);\r\n  TApplicationColorScheme = (csNoScheme, csLight, csDark);\r\n\r\n  TSmallPoint  = record\r\n    x, y: SmallInt;\r\n  end;\r\n\r\n  TAlignInfo = record\r\n    AlignList: TList;\r\n    ControlIndex: Integer;\r\n    Align: TAlign;\r\n    Scratch: Integer;\r\n  end;\r\n\r\n  TGestureEventInfo = record\r\n    GestureID: TGestureID;\r\n    Location: TPoint;\r\n    Flags: TInteractiveGestureFlags;\r\n    Angle: Double;\r\n    InertiaVector: TSmallPoint;\r\n    Distance: Integer;\r\n    TapLocation: TSmallPoint;\r\n  end;\r\n\r\n  TOnPaintEvent = TNotifyEvent;\r\n  TCloseEvent = procedure(Sender: TObject; var Action: TCloseAction) of object;\r\n  TCloseQueryEvent = procedure(Sender: TObject; var CanClose: Boolean) of object;\r\n  TOrientationChangeEvent = procedure(Sender: TObject; AOrientation: TScreenOrientation) of object;\r\n  TBeforeUnloadEvent = procedure(Sender: TObject; var AMessage: string) of object;\r\n  TAlignInsertBeforeEvent = function(Sender: TWinControl; C1, C2: TControl): Boolean of object;\r\n  TAlignPositionEvent = procedure(Sender: TWinControl; Control: TControl;\r\n    var NewLeft, NewTop, NewWidth, NewHeight: Integer;\r\n    var AlignRect: TRect; AlignInfo: TAlignInfo) of object;\r\n  TCanResizeEvent = procedure(Sender: TObject; var NewWidth, NewHeight: Integer;\r\n    var Resize: Boolean) of object;\r\n  TConstrainedResizeEvent = procedure(Sender: TObject; var MinWidth, MinHeight,\r\n    MaxWidth, MaxHeight: Integer) of object;\r\n  TContextPopupEvent = procedure(Sender: TObject; MousePos: TPoint; var Handled: Boolean) of object;\r\n  TDockDropEvent = procedure(Sender: TObject; Source: TDragDockObject;\r\n    X, Y: Integer) of object;\r\n  TDockOverEvent = procedure(Sender: TObject; Source: TDragDockObject;\r\n    X, Y: Integer; State: TDragState; var Accept: Boolean) of object;\r\n  TGestureEvent = procedure(Sender: TObject; const EventInfo: TGestureEventInfo;\r\n     var Handled: Boolean) of object;\r\n  TGetSiteInfoEvent = procedure(Sender: TObject; DockClient: TControl;\r\n    var InfluenceRect: TRect; MousePos: TPoint; var CanDock: Boolean) of object;\r\n  TMouseActivateEvent = procedure(Sender: TObject; Button: TMouseButton;\r\n    Shift: TShiftState; X, Y: Integer; HitTest: Integer; var MouseActivate: TMouseActivate) of object;\r\n  TMouseWheelUpDownEvent = procedure(Sender: TObject; Shift: TShiftState;\r\n    MousePos: TPoint; var Handled: Boolean) of object;\r\n  TStartDockEvent = procedure(Sender: TObject;\r\n    var DragObject: TDragDockObject) of object;\r\n  TUnDockEvent = procedure(Sender: TObject; Client: TControl;\r\n    NewTarget: TWinControl; var Allow: Boolean) of object;\r\n\r\n  THashChangeEvent = procedure(Sender: TObject; oldURL, newURL: string) of object;\r\n\r\n  TModalResultProc = reference to procedure(AValue: TModalResult);\r\n  TFormCreatedProc = reference to procedure(AForm: TObject);\r\n\r\n  TWindowState = (wsNormal, wsMinimized, wsMaximized);\r\n\r\n  TPopupMode = (pmNone, pmAuto, pmExplicit);\r\n  TPopupClose = (pcOnDeactivate, pcNever);\r\n  TPosition = (poDesigned, poDefault, poDefaultPosOnly, poDefaultSizeOnly, poScreenCenter, poDesktopCenter, poMainFormCenter, poOwnerFormCenter);\r\n\r\n  TApplicationErrorType = (aeSilent, aeDialog, aeAlert, aeFooter);\r\n\r\n  TFormBorderStyle = (fbNone, fbSingle, fbSizeable, fbDialog, fbDialogSizeable);\r\n  TFormBorder = fbNone..fbSingle;\r\n\r\n  TCSSLibrary = (cssNone, cssBootstrap);\r\n\r\n  TCustomSizeConstraints = class(TPersistent)\r\n  private\r\n    FControl: TControl;\r\n    FMaxHeight: TConstraintSize;\r\n    FMaxWidth: TConstraintSize;\r\n    FMinHeight: TConstraintSize;\r\n    FMinWidth: TConstraintSize;\r\n    FOnChange: TNotifyEvent;\r\n    procedure SetConstraints(AIndex: Integer; AValue: TConstraintSize);\r\n  protected\r\n    procedure Change; virtual;\r\n    procedure AssignTo(ADest: TPersistent); override;\r\n    property Control: TControl read FControl;\r\n    property MaxHeight: TConstraintSize index 0 read FMaxHeight write SetConstraints default 0;\r\n    property MaxWidth: TConstraintSize index 1 read FMaxWidth write SetConstraints default 0;\r\n    property MinHeight: TConstraintSize index 2 read FMinHeight write SetConstraints default 0;\r\n    property MinWidth: TConstraintSize index 3 read FMinWidth write SetConstraints default 0;\r\n  public\r\n    constructor Create(AControl: TControl); virtual;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TSizeConstraints = class(TCustomSizeConstraints)\r\n  published\r\n    property MaxHeight;\r\n    property MaxWidth;\r\n    property MinHeight;\r\n    property MinWidth;\r\n  end;\r\n\r\n  TDragDockObject = class(TObject)\r\n  strict private\r\n    FBrush: TBrush;\r\n    FDockRect: TRect;\r\n    FDropAlign: TAlign;\r\n    FDropOnControl: TControl;\r\n    FEraseDockRect: TRect;\r\n    FEraseWhenMoving: Boolean;\r\n    FFloating: Boolean;\r\n    FFrameWidth: Integer;\r\n  public\r\n    constructor Create(AControl: TControl);\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TDragObject);\r\n    property Brush: TBrush read FBrush write FBrush;\r\n    property DockRect: TRect read FDockRect write FDockRect;\r\n    property DropAlign: TAlign read FDropAlign;\r\n    property DropOnControl: TControl read FDropOnControl;\r\n    property EraseDockRect: TRect read FEraseDockRect write FEraseDockRect;\r\n    property EraseWhenMoving: Boolean read FEraseWhenMoving;\r\n    property Floating: Boolean read FFloating write FFloating;\r\n    property FrameWidth: Integer read FFrameWidth;\r\n  end;\r\n\r\n  TCustomForm = class(TWinControl)\r\n  private\r\n    FDesignContainer: TJSElement;\r\n    FLayer: TJSElement;\r\n    FPopup: Boolean;\r\n    FPopupElement: TJSHTMLElement;\r\n    FFormFileName: string;\r\n    FFormContent: string;\r\n    FFormContainer: TElementID;\r\n    FFormElement: string;\r\n    FFormStyle: TFormStyle;\r\n    FOnCreate: TNotifyEvent;\r\n    FOnShow: TNotifyEvent;\r\n    FModalResult: TModalResult;\r\n    FOnPaint: TOnPaintEvent;\r\n    FOnDeactivate: TNotifyEvent;\r\n    FOnCloseQuery: TCloseQueryEvent;\r\n    FOnClose: TCloseEvent;\r\n    FModalProc: TModalResultProc;\r\n    FCreatedProc: TFormCreatedProc;\r\n    FWindowState: TWindowState;\r\n    FCaption: string;\r\n    FIsResizing: boolean;\r\n    FOnScroll: TNotifyEvent;\r\n    FOnUnload: TNotifyEvent;\r\n    FOnBeforeUnload: TBeforeUnloadEvent;\r\n    FPopupMode: TPopupMode;\r\n    FPopupClose: TPopupClose;\r\n    FPosition: TPosition;\r\n    FActiveControl: TWinControl;\r\n    FMdx, FMdy: integer;\r\n    FDlgX, FDlgY: integer;\r\n    FCaptured: boolean;\r\n    FDown: boolean;\r\n    FHasCaption: boolean;\r\n    FMoveSpan: TJSHTMLElement;\r\n    FCaptionElement: TJSHTMLElement;\r\n    FCaptionCloseElement: TJSHTMLElement;\r\n    FBorder: TFormBorderStyle;\r\n    FShadow: boolean;\r\n    FTimerID: integer;\r\n    FOrigWidth, FOrigHeight: integer;\r\n    FOldWidth, FOldHeight: integer;\r\n    FOnDestroy: TNotifyEvent;\r\n    FPopupOpacity: single;\r\n    FCreating: boolean;\r\n    FLoadedPtr: pointer;\r\n    FDOMContentLoadedPtr: pointer;\r\n    FUnloadPtr: pointer;\r\n    FBeforeUnloadPtr: pointer;\r\n    FResizePtr: pointer;\r\n    FScrollPtr: pointer;\r\n    FDocMouseUpPtr: pointer;\r\n    FDocMouseMovePtr: pointer;\r\n    FTitleDownPtr: pointer;\r\n    FDoClickPtr: pointer;\r\n    FKeyDownPtr: pointer;\r\n    FOrientationChangePtr: pointer;\r\n    FHashChangePtr: pointer;\r\n    FCSSLibrary: TCSSLibrary;\r\n    FNoHTML: boolean;\r\n    FPrevActiveForm: TCustomForm;\r\n    FElementCaptionClassName: TElementClassName;\r\n    FMenu: TCustomControl;\r\n    FResizeObserver: TJSObject;\r\n    FOnOrientationChange: TOrientationChangeEvent;\r\n    FOnDOMContentLoaded: TNotifyEvent;\r\n    FShowClose: boolean;\r\n    FOnHashChange: THashChangeEvent;\r\n    procedure SetModalResult(const Value: TModalResult);\r\n    function GetFormStyle: TFormStyle;\r\n    procedure SetFormStyle(const Value: TFormStyle); virtual;\r\n    function GetCanvas: TCanvas;\r\n    procedure SetCaption(const AValue: string); virtual;\r\n    procedure SetActiveControl(const Value: TWinControl);\r\n    procedure SetShadow(const Value: boolean);\r\n    procedure SetBorder(const Value: TFormBorderStyle);\r\n    procedure SetFormContainer(const Value: TElementID);\r\n    function GetActiveControl: TWinControl;\r\n    procedure SetWidth(AValue: Integer); override;\r\n    procedure SetHeight(AValue: Integer); override;\r\n    procedure SetPosition(const Value: TPosition); virtual;\r\n  protected\r\n    function HandleHashChange(Event: TEventListenerEvent): boolean; virtual;\r\n    function HandleLoaded(Event: TEventListenerEvent): boolean; virtual;\r\n    function HandleDOMContentLoaded(Event: TEventListenerEvent): boolean; virtual;\r\n    function HandleScroll(Event: TEventListenerEvent): boolean; virtual;\r\n    function HandleUnload(Event: TEventListenerEvent): boolean; virtual;\r\n    function HandleBeforeUnload(Event: TEventListenerEvent): boolean; virtual;\r\n    function HandleObserver: boolean; virtual;\r\n    function HandleResize(Event: TEventListenerEvent): boolean; virtual;\r\n    function HandleDocMouseMove(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDocMouseUp(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleTitleDown(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleCloseClick(Event: TEventListenerEvent): boolean; virtual;\r\n\r\n    procedure SetLeft(AValue: Integer); override;\r\n    procedure SetTop(AValue: Integer); override;\r\n\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n    procedure VisibleChanged; override;\r\n    procedure Resize; reintroduce; virtual;\r\n    procedure CreateControl; override;\r\n    procedure DoClose(var CloseAction: TCloseAction); virtual;\r\n    procedure BindEvents; override;\r\n    procedure UnbindEvents; override;\r\n    procedure DoCreate; virtual;\r\n    procedure Realign; override;\r\n    procedure DoResize; virtual;\r\n    procedure DoShow; virtual;\r\n    procedure Paint; virtual;\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; reintroduce; virtual;\r\n    function HandleKeyDown(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    function HandleOrientationChange(Event: TJSEvent): Boolean; virtual;\r\n    procedure HandleDoResize; virtual;\r\n    function GetWidth: Integer; override;\r\n    function GetHeight: Integer; override;\r\n    function GetLeft: Integer; override;\r\n    function GetTop: Integer; override;\r\n    function GetClientRect: TRect; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    function ContainerElement: TJSElement; override;\r\n    function FormContainerElement: TJSElement; virtual;\r\n    function GetElementBindHandle: TJSEventTarget; override;\r\n    function GetElementHandle: TJSHTMLElement; override;\r\n    procedure SetElementClassName(AValue: string); override;\r\n    function CloseQuery: Boolean; virtual;\r\n    procedure LoadDFMValues; virtual;\r\n    procedure Init; virtual;\r\n    property FormContent: string read FFormContent write FFormContent;\r\n    property WindowState: TWindowState read FWindowState write FWindowState;\r\n    function IsFocused: Boolean; override;\r\n    property PopupMode: TPopupMode read FPopupMode write FPopupMode default pmNone;\r\n    property Position: TPosition read FPosition write SetPosition default poDefaultPosOnly;\r\n    function CreateLayer: TJSHTMLElement;\r\n    function CreateCaption: TJSHTMLElement;\r\n    function GetCaptionHeight: integer;\r\n    procedure SetColorScheme(AScheme: TApplicationColorScheme); virtual;\r\n    procedure SetFormPos; virtual;\r\n    property Border: TFormBorderStyle read FBorder write SetBorder;\r\n    class function GetHTMLFileName: string; virtual;\r\n    procedure LoadedDone; virtual;\r\n    procedure Loaded; override;\r\n    procedure ColorChanging; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    constructor Create(id: string); overload; override;\r\n    constructor Create(id: string; var AReference); overload; virtual;\r\n    constructor Create(AOwner: TComponent); overload; override;\r\n    constructor CreateNew(AOwner: TComponent; Dummy: Integer = 0); overload; virtual;\r\n    constructor CreateNew(AFileName: string); overload; virtual;\r\n    constructor CreateNew; overload; virtual;\r\n    constructor CreateNew(AProc: TFormCreatedProc); overload; virtual;\r\n    constructor CreateNew(AElementID: string; AProc: TFormCreatedProc); overload; virtual;\r\n    constructor CreateNew(AElementID, AFileName: string; AProc: TFormCreatedProc); overload; virtual;\r\n    constructor CreateDialog(ACaption: string); virtual;\r\n    constructor CreateDialogNew(ACaption: string); virtual;\r\n\r\n    [async]\r\n    function Load: TJSPromise;\r\n    [async]\r\n    function Execute: TJSPromise;\r\n\r\n    destructor Destroy; override;\r\n    procedure Close; virtual;\r\n    function GetUniqueComponentName(AComponent: TComponent): string;\r\n    function IsMiletus: boolean;\r\n    procedure PreventDefault; reintroduce;\r\n    property ActiveControl: TWinControl read GetActiveControl write SetActiveControl;\r\n    property ModalResult: TModalResult read FModalResult write SetModalResult;\r\n    property Canvas: TCanvas read GetCanvas;\r\n    property CaptionElement: TJSHTMLElement read FCaptionElement;\r\n    property ElementCaptionClassName: TElementClassName read FElementCaptionClassName write FElementCaptionClassName;\r\n    procedure SetBounds(X, Y, AWidth, AHeight: Integer); override;\r\n    procedure SelectFirst;\r\n    procedure SelectNext(CurControl: TControl; GoForward: boolean; CheckTabStop: boolean);\r\n    procedure Show; reintroduce;\r\n    function ShowModal: Integer; overload; virtual;\r\n    function ShowModal(AProc: TModalResultProc): TModalResult; overload; virtual;\r\n    procedure AddCSS(const id: string; const css: string);\r\n    procedure RemoveCSS(const id: string);\r\n    procedure UpdateCSS(const id: string; const css: string);\r\n    property Caption: string read FCaption write SetCaption;\r\n    property Color;\r\n    property CSSLibrary: TCSSLibrary read FCSSLibrary write FCSSLibrary default cssNone;\r\n    property FormContainer: TElementID read FFormContainer write SetFormContainer;\r\n    property FormFileName: string read FFormFileName write FFormFileName;\r\n    property FormStyle: TFormStyle read GetFormStyle write SetFormStyle;\r\n    property IsResizing: boolean read FIsResizing;\r\n    property Menu: TCustomControl read FMenu write FMenu;\r\n    property Popup: boolean read FPopup write FPopup;\r\n    property PopupClose: TPopupClose read FPopupClose write FPopupClose default pcOnDeactivate;\r\n    property PopupOpacity: single read FPopupOpacity write FPopupOpacity;\r\n    property ShowClose: boolean read FShowClose write FShowClose default true;\r\n    property Shadow: boolean read FShadow write SetShadow default true;\r\n    property OnBeforeUnload: TBeforeUnloadEvent read FOnBeforeUnload write FOnBeforeUnload;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnDOMContentLoaded: TNotifyEvent read FOnDOMContentLoaded write FOnDOMContentLoaded;\r\n    property OnClose: TCloseEvent read FOnClose write FOnClose;\r\n    property OnCloseQuery: TCloseQueryEvent read FOnCloseQuery write FOnCloseQuery;\r\n    property OnCreate: TNotifyEvent read FOnCreate write FOnCreate;\r\n    property OnDestroy: TNotifyEvent read FOnDestroy write FOnDestroy;\r\n    property OnDeactivate: TNotifyEvent read FOnDeactivate write FOnDeactivate;\r\n    property OnOrientationChange: TOrientationChangeEvent read FOnOrientationChange write FOnOrientationChange;\r\n    property OnPaint: TOnPaintEvent read FOnPaint write FOnPaint;\r\n    property OnScroll: TNotifyEvent read FOnScroll write FOnScroll;\r\n    property OnShow: TNotifyEvent read FOnShow write FOnShow;\r\n    property OnUnload: TNotifyEvent read FOnUnload write FOnUnload;\r\n    property OnHashChange: THashChangeEvent read FOnHashChange write FOnHashChange;\r\n  end;\r\n\r\n  TFormClass = class of TForm;\r\n  TForm = class(TCustomForm)\r\n  public\r\n    property Border;\r\n    property ClientHeight;\r\n    property ClientWidth;\r\n    property PopupMode;\r\n    property Position;\r\n  published\r\n    property Align;\r\n    property Caption;\r\n    property Color;\r\n    property CSSLibrary;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Font;\r\n    property FormContainer;\r\n    property FormStyle;\r\n    property Menu;\r\n    property ParentFont;\r\n    property Shadow;\r\n    property ShowClose;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property OnBeforeUnload;\r\n    property OnClick;\r\n    property OnClose;\r\n    property OnCloseQuery;\r\n    property OnCreate;\r\n    property OnDblClick;\r\n    property OnDeactivate;\r\n    property OnDestroy;\r\n    property OnDOMContentLoaded;\r\n    property OnHashChange;\r\n    property OnResize;\r\n    property OnShow;\r\n    property OnScroll;\r\n    property OnOrientationChange;\r\n    property OnPaint;\r\n    property OnTouchStart;\r\n    property OnTouchMove;\r\n    property OnTouchEnd;\r\n    property OnUnload;\r\n  end;\r\n\r\n  TWebForm = TForm;\r\n\r\n  //TTouchManager = class(TComponent)\r\n  //end;\r\n\r\n  TCustomFrame = class(TCustomHTMLDiv)\r\n  private\r\n    FAutoScroll: Boolean;\r\n    FAutoSize: Boolean;\r\n    FBiDiMode: TBiDiMode;\r\n    FConstraints: TSizeConstraints;\r\n    FCtl3D: Boolean;\r\n    FDockSite: Boolean;\r\n    FDragCursor: TCursor;\r\n    FDragKind: TDragKind;\r\n    FDragMode: TDragMode;\r\n    FOnAlignInsertBefore: TAlignInsertBeforeEvent;\r\n    FOnAlignPosition: TAlignPositionEvent;\r\n    FOnCanResize: TCanResizeEvent;\r\n    FOnConstrainedResize: TConstrainedResizeEvent;\r\n    FOnContextPopup: TContextPopupEvent;\r\n    FOnDockDrop: TDockDropEvent;\r\n    FOnDockOver: TDockOverEvent;\r\n    FOnEndDock: TEndDragEvent;\r\n    FOnGesture: TGestureEvent;\r\n    FOnGetSiteInfo: TGetSiteInfoEvent;\r\n    FOnMouseActivate: TMouseActivateEvent;\r\n    FOnMouseWheelDown: TMouseWheelUpDownEvent;\r\n    FOnMouseWheelUp: TMouseWheelUpDownEvent;\r\n    FOnStartDock: TStartDockEvent;\r\n    FOnUnDock: TUnDockEvent;\r\n    FPadding: TPadding;\r\n    FParentBackground: Boolean;\r\n    FParentCtl3D: Boolean;\r\n    FPopupMenu: TPopupMenu;\r\n    //FTouch: TTouchManager;\r\n    //FTouchManager: TTouchManager;\r\n    procedure SetConstraints(const AValue: TSizeConstraints);\r\n    procedure SetPopupMenu(AValue: TPopupMenu);\r\n    //procedure SetTouchManager(AValue: TTouchManager);\r\n  protected\r\n    procedure LoadDFMValues; virtual;\r\n    procedure UpdateElement; override;\r\n    property AutoScroll: Boolean read FAutoScroll write FAutoScroll default False;\r\n    property AutoSize: Boolean read FAutoSize write FAutoSize default False;\r\n    property BiDiMode: TBiDiMode read FBiDiMode write FBiDiMode stored False;\r\n    property Constraints: TSizeConstraints read FConstraints write SetConstraints;\r\n    property Ctl3D: Boolean read FCtl3D write FCtl3D stored False;\r\n    property DockSite: Boolean read FDockSite write FDockSite default False;\r\n    property DragCursor: TCursor read FDragCursor write FDragCursor default crDrag;\r\n    property DragKind: TDragKind read FDragKind write FDragKind default dkDrag;\r\n    property DragMode: TDragMode read FDragMode write FDragMode default dmManual;\r\n    property Padding: TPadding read FPadding write FPadding;\r\n    property ParentBackground: Boolean read FParentBackground write FParentBackground;\r\n    property ParentCtl3D: Boolean read FParentCtl3D write FParentCtl3D default True;\r\n    property PopupMenu: TPopupMenu read FPopupMenu write SetPopupMenu;\r\n    //property Touch: TTouchManager read FTouch write SetTouchManager;\r\n    property OnAlignInsertBefore: TAlignInsertBeforeEvent read FOnAlignInsertBefore write FOnAlignInsertBefore;\r\n    property OnAlignPosition: TAlignPositionEvent read FOnAlignPosition write FOnAlignPosition;\r\n    property OnCanResize: TCanResizeEvent read FOnCanResize write FOnCanResize;\r\n    property OnConstrainedResize: TConstrainedResizeEvent read FOnConstrainedResize write FOnConstrainedResize;\r\n    property OnContextPopup: TContextPopupEvent read FOnContextPopup write FOnContextPopup;\r\n    property OnDockDrop: TDockDropEvent read FOnDockDrop write FOnDockDrop;\r\n    property OnDockOver: TDockOverEvent read FOnDockOver write FOnDockOver;\r\n    property OnEndDock: TEndDragEvent read FOnEndDock write FOnEndDock;\r\n    property OnGesture: TGestureEvent read FOnGesture write FOnGesture;\r\n    property OnGetSiteInfo: TGetSiteInfoEvent read FOnGetSiteInfo write FOnGetSiteInfo;\r\n    property OnMouseActivate: TMouseActivateEvent read FOnMouseActivate write FOnMouseActivate;\r\n    property OnMouseWheelDown: TMouseWheelUpDownEvent read FOnMouseWheelDown write FOnMouseWheelDown;\r\n    property OnMouseWheelUp: TMouseWheelUpDownEvent read FOnMouseWheelUp write FOnMouseWheelUp;\r\n    property OnStartDock: TStartDockEvent read FOnStartDock write FOnStartDock;\r\n    property OnUnDock: TUnDockEvent read FOnUnDock write FOnUnDock;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    constructor CreateNew(AOwner: TComponent);\r\n    destructor Destroy; override;\r\n    procedure LoadFromForm;\r\n  end;\r\n\r\n  TFrameClass = class of TFrame;\r\n  TFrame = class(TCustomFrame)\r\n  published\r\n    property Align;\r\n    property Anchors;\r\n    property AutoScroll;\r\n    property AutoSize;\r\n    property BiDiMode;\r\n    property Constraints;\r\n    property DockSite;\r\n    property DoubleBuffered;\r\n    property DragCursor;\r\n    property DragKind;\r\n    property DragMode;\r\n    property Enabled;\r\n    property Color nodefault;\r\n    property Ctl3D;\r\n    property Font;\r\n    property Padding;\r\n    property ParentBackground default True;\r\n    property ParentBiDiMode;\r\n    property ParentColor;\r\n    property ParentCtl3D;\r\n    property ParentDoubleBuffered;\r\n    property ParentFont;\r\n    property ParentShowHint;\r\n    property PopupMenu;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    //property Touch;\r\n    property Visible;\r\n    property OnAlignInsertBefore;\r\n    property OnAlignPosition;\r\n    property OnCanResize;\r\n    property OnClick;\r\n    property OnConstrainedResize;\r\n    property OnContextPopup;\r\n    property OnDblClick;\r\n    property OnDockDrop;\r\n    property OnDockOver;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDock;\r\n    property OnEndDrag;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnGesture;\r\n    property OnGetSiteInfo;\r\n    property OnMouseActivate;\r\n    property OnMouseDown;\r\n    property OnMouseEnter;\r\n    property OnMouseLeave;\r\n    property OnMouseMove;\r\n    property OnMouseUp;\r\n    property OnMouseWheel;\r\n    property OnMouseWheelDown;\r\n    property OnMouseWheelUp;\r\n    property OnResize;\r\n    property OnStartDock;\r\n    property OnStartDrag;\r\n    property OnUnDock;\r\n  end;\r\n\r\n  TApplicationError = record\r\n    AMessage: string;\r\n    AFile: string;\r\n    ALineNumber: integer;\r\n    AColNumber: integer;\r\n    AStack: string;\r\n    AError: TJSObject;\r\n  end;\r\n\r\n  THintPosition = (hpLeft, hpTop, hpRight, hpBottom);\r\n\r\n  TOnlineStatus = (osOnline, osOffline);\r\n\r\n  TApplicationErrorEvent = procedure(Sender: TObject; AError: TApplicationError; var Handled: boolean) of object;\r\n\r\n  TApplicationHashChangeEvent = procedure(Sender: TObject; AHash: string; var Handled: boolean) of object;\r\n\r\n  TApplicationOnlineChangeEvent = procedure(Sender: TObject; AStatus: TOnlineStatus) of object;\r\n\r\n  TApplicationActiveChangeEvent = procedure(Sender: TObject; Active: boolean) of object;\r\n\r\n  TApplicationCallBackEvent = procedure(Sender: TObject; AQuery: string) of object;\r\n\r\n  TApplication = class(TControl)\r\n  private\r\n    FAppContainer: TElementID;\r\n    FMainFormOnTaskBar: Boolean;\r\n    FCanCreateForm: Boolean;\r\n    FAppInitializing: Boolean;\r\n    FLastReq: TJSXMLHttpRequest;\r\n    FFormCaptionHeight: integer;\r\n    {$IFDEF SINGLEINSTANCE}\r\n    FWebSocket: TSocketClient;\r\n    {$ENDIF}\r\n    FActiveForm: TCustomForm;\r\n    FMainForm: TCustomForm;\r\n    FLoadForm: TCustomForm;\r\n    FInitFormClassName: string;\r\n    FFormStack: TList;\r\n    FParameters: TStrings;\r\n    FIsRedirect: boolean;\r\n    FLanguage: TUILanguage;\r\n    FOnImageCacheReady: TNotifyEvent;\r\n    FOnError: TApplicationErrorEvent;\r\n    FOnHashChange: TApplicationHashChangeEvent;\r\n    FAutoFormRoute: boolean;\r\n    FErrorType: TApplicationErrorType;\r\n    FClientConnector: TClientConnector;\r\n    FOnOnlineChange: TApplicationOnlineChangeEvent;\r\n    FOnActivate: TApplicationActiveChangeEvent;\r\n    FThemeTextColor: TColor;\r\n    FThemeColor: TColor;\r\n    FThemed: boolean;\r\n    FThemeButtonClassName: string;\r\n    FOnOAuthToken: TApplicationCallBackEvent;\r\n    FOnOAuthCallBack: TApplicationCallBackEvent;\r\n    FOnFontCacheReady: TNotifyEvent;\r\n    FMaxZIndex: integer;\r\n    FCreatedProc: TFormCreatedProc;\r\n    FHintPause: integer;\r\n    FHintHidePause: integer;\r\n    FHintPosition: THintPosition;\r\n    FHintClassName: string;\r\n    {$IFDEF FREEWARE}\r\n    FNotifyCount: integer;\r\n    {$ENDIF}\r\n    {$IFDEF HOTRELOAD}\r\n    FHotReloadPollInterval: Integer;\r\n    FHotReloadReq: TJSXMLHttpRequest;\r\n    FHotReloadTimer: NativeInt;\r\n    FHotReloadVersion: Integer;\r\n    FHotReloadFile: string;\r\n    {$ENDIF}\r\n    function DoFormLoad(Event: TEventListenerEvent): boolean;\r\n    function DoFormAbort(Event: TEventListenerEvent): boolean;\r\n    function DoHandleError(Event: TJSErrorEvent): boolean;\r\n    function DoHashChange(Event: TEventListenerEvent): boolean;\r\n    function DoErrorClose(Event: TJSMOuseEvent): boolean;\r\n    function DoUpdateOnlineStatus(Event: TEventListenerEvent): boolean;\r\n    function DoVisibilityChange(Event: TEventListenerEvent): boolean;\r\n    procedure SetLanguage(const Value: TUILanguage);\r\n    function GetIsOnline: boolean;\r\n    function GetIsMobile: boolean;\r\n    function GetIsPWA: boolean;\r\n    procedure InternalDownloadFile(const AData: TJSUint8Array; const AFileName, AType: string; const ANewTab: Boolean);\r\n    {$IFDEF SINGLEINSTANCE}\r\n    procedure DoGetDataReceived(Sender: TObject; Origin: string; Data: TJSObjectRecord);\r\n    procedure DoGetConnected(Sender: TObject);\r\n    {$ENDIF}\r\n    {$IFDEF HOTRELOAD}\r\n    procedure OnHotReloadTick;\r\n    function OnHotReloadLoad(AEvent: TEventListenerEvent): Boolean;\r\n    function OnHotReloadAbort(AEvent: TEventListenerEvent): Boolean;\r\n    procedure HandleHotReload(const AData: TJSObject);\r\n    procedure StartHotReload;\r\n    procedure StopHotReload;\r\n    {$ENDIF}\r\n  protected\r\n    procedure CreateNewForm(AForm: TCustomForm; HTML: string); overload; virtual;\r\n    function GetFormExtension: string;\r\n    function GetAuthorizationPageHTML(const AAuthorizationSuccess: Boolean): string;\r\n    function GetColorScheme: TApplicationColorScheme; virtual;\r\n    function GetActive: boolean;\r\n    procedure ReloadForm;\r\n    procedure ActivateChildScripts(AElement: TJSHTMLElement);\r\n    procedure ChangeMaxZIndex(Delta: integer);\r\n    procedure TriggerNotification;\r\n  public\r\n    procedure PushForm(AForm: TCustomForm);\r\n    function PopForm: TCustomForm;\r\n    procedure LockForm(AForm: TCustomForm);\r\n    procedure UnLockForm(AForm: TCustomForm);\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    property MaxZIndex: integer read FMaxZIndex write FMaxZIndex;\r\n    function MaxZIndexStr: string;\r\n\r\n    function CreateNewForm(AInstanceClass: TFormClass): TCustomForm; overload;\r\n    function CreateNewForm(AInstanceClass: TFormClass; AElementID: string): TCustomForm; overload;\r\n    procedure CreateForm(AInstanceClass: TFormClass; var AReference); overload;\r\n    procedure CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference); overload;\r\n    procedure CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference; AProc: TFormCreatedProc); overload;\r\n    procedure CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference; AProc: TFormCreatedProc; LoadHTML: boolean); overload;\r\n    procedure CreateForm(AInstanceClass: TDataModuleClass; var AReference); overload;\r\n    procedure CreateForm(AInstanceClass: TFrameClass; var AReference); overload;\r\n    procedure CreateForm(AInstanceClass: TFormClass; AElement: TJSHTMLElement; var AReference); overload;\r\n    procedure CreateFormDirect(AInstanceClass: TFormClass; var AReference); overload;\r\n    procedure CreateFormDirect(AInstanceClass: TDataModuleClass; var AReference); overload;\r\n    procedure CreateFormDirect(AInstanceClass: TFrameClass; var AReference); overload;\r\n    procedure LoadForm(AForm: TCustomForm; AFormFile: string); overload; virtual;\r\n    procedure LoadForm(AForm: TCustomForm; AFormFile: string; FormLoaded: TFormCreatedProc); overload; virtual;\r\n    procedure ChangeCSS(id: string; href:string);\r\n    procedure InsertCSS(id, href: string);\r\n    procedure RemoveCSS(id: string);\r\n    function HasCSS(href:string): boolean;\r\n    procedure ChangeLanguage(const Value: TUILanguage); virtual;\r\n    procedure Initialize;\r\n    procedure InitFormatSettings(const BrowserLocale: string);\r\n    procedure ReceiveMessageFromClient(const AMessage: string);\r\n    procedure RouteForm(AParameter: string);\r\n    procedure Run;\r\n    procedure RunScript(Source: string);\r\n    procedure Navigate(const AURL: string; ATarget: TNavigationTarget = ntBlank);\r\n    procedure Download(const AURL: string);\r\n    procedure DownloadTextFile(const AText: string; AFileName: string = '');\r\n    procedure DownloadBinaryFile(const AData: TJSBlob; const AFileName: string = ''; const ANewTab: Boolean = False); overload;\r\n    procedure DownloadBinaryFile(const AData: TBytes; const AFileName: string = ''; const ANewTab: Boolean = False); overload;\r\n    procedure DownloadBinaryFile(const AData: TJSUint8Array; const AFileName: string = ''; const ANewTab: Boolean = False); overload;\r\n    procedure DownloadPDFFile(const AData: TBytes; const AFileName: string = ''; const ANewTab: Boolean = False); overload;\r\n    procedure DownloadPDFFile(const AData: TJSUint8Array; const AFileName: string = ''; const ANewTab: Boolean = False); overload;\r\n    function EXEName: string;\r\n    function IDETheme: string;\r\n    function IDECSS: string;\r\n    function Version: string;\r\n    procedure IDEMessage(const Msg: string);\r\n    procedure IDEOpenURL(const URL: string);\r\n    function NeedsFormRouting: Boolean;\r\n    function ObjectURL(AFile: TJSHTMLFile): string;\r\n    property Active: boolean read GetActive;\r\n    property AppContainer: TElementID read FAppContainer write FAppContainer;\r\n    property AutoFormRoute: boolean read FAutoFormRoute write FAutoFormRoute;\r\n    property ErrorType: TApplicationErrorType read FErrorType write FErrorType;\r\n    property FormCaptionHeight: integer read FFormCaptionHeight write FFormCaptionHeight;\r\n    property HintHidePause: integer read FHintHidePause write FHintHidePause;\r\n    property HintPause: integer read FHintPause write FHintPause;\r\n    property HintClassName: string read FHintCLassName write FHintClassName;\r\n    property HintPosition: THintPosition read FHintPosition write FHintPosition;\r\n    property IsOnline: boolean read GetIsOnline;\r\n    property IsMobile: boolean read GetIsMobile;\r\n    property IsPWA: boolean read GetIsPWA;\r\n    property ActiveForm: TCustomForm read FActiveForm;\r\n    property ColorScheme: TApplicationColorScheme read GetColorScheme;\r\n    property MainForm: TCustomForm read FMainForm;\r\n    property MainFormOnTaskBar: boolean read FMainFormOnTaskBar write FMainFormOnTaskBar;\r\n    property Parameters: TStrings read FParameters;\r\n    property Language: TUILanguage read FLanguage write SetLanguage;\r\n    property Themed: boolean read FThemed write FThemed;\r\n    property ThemeColor: TColor read FThemeColor write FThemeColor;\r\n    property ThemeTextColor: TColor read FThemeTextColor write FThemeTextColor;\r\n    property ThemeButtonClassName: string read FThemeButtonClassName write FThemeButtonClassName;\r\n    property OnError: TApplicationErrorEvent read FOnError write FOnError;\r\n    property OnImageCacheReady: TNotifyEvent read FOnImageCacheReady write FOnImageCacheReady;\r\n    property OnFontCacheReady: TNotifyEvent read FOnFontCacheReady write FOnFontCacheReady;\r\n    property OnHashChange: TApplicationHashChangeEvent read FOnHashChange write FOnHashChange;\r\n    property OnOnlineChange: TApplicationOnlineChangeEvent read FOnOnlineChange write FOnOnlineChange;\r\n    property OnOAuthCallBack: TApplicationCallBackEvent read FOnOAuthCallBack write FOnOAuthCallBack;\r\n    property OnOAuthToken: TApplicationCallBackEvent read FOnOAuthToken write FOnOAuthToken;\r\n    property OnActivate: TApplicationActiveChangeEvent read FOnActivate write FOnActivate;\r\n    property ClientConnector: TClientConnector read FClientConnector write FClientConnector;\r\n{$IFDEF HOTRELOAD}\r\n    property HotReloadPollInterval: Integer read FHotReloadPollInterval write FHotReloadPollInterval;\r\n    property HotReloadFile: string read FHotReloadFile write FHotReloadFile;\r\n{$ENDIF}\r\n  end;\r\n\r\nfunction GetParentForm(AControl: TControl): TCustomForm;\r\nprocedure Log(v: JSValue); overload;\r\nprocedure Log(arr: array of JSValue); overload;\r\nfunction WinWidth: integer;\r\nfunction WinHeight: integer;\r\n\r\nvar\r\n  Application: TApplication;\r\n  HandShakeScript: TJSHTMLScriptElement;\r\n  VSIDE: TJSObject;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Dialogs, WEBLib.WebTools, WEBLib.JSON, WEBLib.Utils, Math;\r\n\r\ntype\r\n  TFramePreviewForm = class(TWebForm)\r\n  private\r\n    FFrame: TFrame;\r\n  protected\r\n    procedure LoadDFMValues; override;\r\n  end;\r\n\r\nprocedure Log(v: JSValue);\r\nbegin\r\n  asm\r\n    console.log(v);\r\n  end;\r\nend;\r\n\r\nfunction WinHeight: integer;\r\nvar\r\n  h: integer;\r\nbegin\r\n  if Assigned(VSIDE) then\r\n  begin\r\n     asm\r\n       h = pas[\"WEBLib.Forms\"].VSIDE.clientHeight();\r\n     end;\r\n  end\r\n  else\r\n    h := window.innerHeight;\r\n\r\n  Result := h;\r\nend;\r\n\r\nfunction WinWidth: integer;\r\nvar\r\n  w: integer;\r\nbegin\r\n  if Assigned(VSIDE) then\r\n  begin\r\n    asm\r\n      w = pas[\"WEBLib.Forms\"].VSIDE.clientWidth();\r\n    end;\r\n  end\r\n  else\r\n    w := window.innerWidth;\r\n\r\n  Result := w;\r\nend;\r\n\r\n\r\n{$HINTS OFF}\r\nprocedure Log(arr: array of JSValue);\r\nvar\r\n  i: integer;\r\n  s,su: string;\r\nbegin\r\n  s := '[';\r\n  for i := 0 to length(arr) - 1 do\r\n  begin\r\n    asm\r\n      function isPrimitive(test) {\r\n        return (test !== Object(test));\r\n      };\r\n\r\n      if (isPrimitive(arr[i])) {\r\n         var su = arr[i].toString();\r\n         if (s != \"[\") { s = s + \",\"; }\r\n         s = s + su;\r\n         }\r\n      else\r\n      {\r\n        console.log(arr[i]);\r\n         if (s != \"[\") { s = s + \",\"; }\r\n         s = s + \"#object\";\r\n      }\r\n    end;\r\n  end;\r\n\r\n  s := s + ']';\r\n\r\n  log(s);\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction GetParentForm(AControl: TControl): TCustomForm;\r\nvar\r\n  FOwner: TComponent;\r\nbegin\r\n  Result := nil;\r\n\r\n  FOwner := AControl;\r\n\r\n  while Assigned(FOwner) and not (FOwner is TCustomForm) do\r\n  begin\r\n    FOwner := FOwner.Owner;\r\n  end;\r\n\r\n  if Assigned(FOwner) and (FOwner is TCustomForm) then\r\n    Result := (FOwner as TCustomForm);\r\nend;\r\n\r\n\r\n{ TCustomForm }\r\n\r\nfunction TCustomForm.Load: TJSPromise;\r\nbegin\r\n  FormFileName := GetHTMLFileName;\r\n\r\n  if FormFileName = '' then\r\n  begin\r\n     Result := TJSPromise.new(procedure(ASuccess, AFailed: TJSPromiseResolver)\r\n       begin\r\n         Asuccess(Self);\r\n       end);\r\n  end\r\n  else\r\n  begin\r\n    Result := TJSPromise.new(\r\n      procedure(ASuccess, AFailed: TJSPromiseResolver)\r\n      begin\r\n        Application.LoadForm(Self, FormFileName, procedure(AForm: TObject)\r\n          begin\r\n            ASuccess(AForm);\r\n          end);\r\n      end\r\n    );\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.Execute: TJSPromise;\r\nbegin\r\n  Result := TJSPromise.new(\r\n    procedure(ASuccess, AFailed: TJSPromiseResolver)\r\n    begin\r\n      ShowModal(procedure(AValue: TModalResult)\r\n        begin\r\n          ASuccess(AValue);\r\n        end);\r\n    end\r\n    );\r\nend;\r\n\r\nprocedure TCustomForm.BindEvents;\r\nbegin\r\n  inherited;\r\n\r\n  if (document.readyState <> 'loading') then\r\n    if Assigned(OnDOMContentLoaded) then\r\n      OnDomContentLoaded(Self);\r\n\r\n  window.addEventListener('resize', FResizePtr);\r\n  window.addEventListener('load', FLoadedPtr);\r\n  window.addEventListener('DOMContentLoaded', FDOMContentLoadedPtr);\r\n  document.addEventListener('scroll', FScrollPtr);\r\n  window.addEventListener('unload', FUnloadPtr);\r\n  window.addEventListener('beforeunload', FBeforeUnloadPtr);\r\n  window.addEventListener('keydown', FKeyDownPtr);\r\n  window.addEventListener('orientationchange',FOrientationChangePtr);\r\n  window.addEventListener('hashchange',FHashChangePtr);\r\nend;\r\n\r\nprocedure ReleaseForm(AForm: TCustomForm);\r\nbegin\r\n  AForm.Free;\r\n  AForm := nil;\r\nend;\r\n\r\nprocedure TCustomForm.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FLoadedPtr := nil;\r\n  FDOMContentLoadedPtr := nil;\r\n  FUnloadPtr := nil;\r\n  FBeforeUnloadPtr := nil;\r\n  FResizePtr := nil;\r\n  FScrollPtr := nil;\r\n  FDocMouseUpPtr := nil;\r\n  FDocMouseMovePtr := nil;\r\n  FTitleDownPtr := nil;\r\n  FDoClickPtr := nil;\r\n  FKeyDownPtr := nil;\r\n  FOrientationChangePtr := nil;\r\n  FHashChangePtr := nil;\r\nend;\r\n\r\nprocedure TCustomForm.AddCSS(const id: string; const css: string);\r\nbegin\r\n  asm\r\n    function writeStylesOnce(styleName, cssText) {\r\n        var styleElement = document.getElementById(styleName);\r\n        if (styleElement) {\r\n             styleElement.innerHTML = cssText;\r\n          return;\r\n          }\r\n        styleElement = document.createElement('style');\r\n        styleElement.type = 'text/css';\r\n        styleElement.id = styleName;\r\n        styleElement.innerHTML = cssText;\r\n        document.getElementsByTagName('head')[0].appendChild(styleElement);\r\n    }\r\n    writeStylesOnce(id,css);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.RemoveCSS(const id: string);\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  el := document.getElementById(id);\r\n  if Assigned(el) then\r\n    document.head.removeChild(el);\r\nend;\r\n\r\nprocedure TCustomForm.Close;\r\nvar\r\n  lAction: TCloseAction;\r\n  el: TJSElement;\r\nbegin\r\n  if CloseQuery then\r\n  begin\r\n    UnbindEvents;\r\n\r\n    lAction := caHide;\r\n\r\n    if FTimerID <> -1 then\r\n    begin\r\n      window.clearInterval(FTimerID);\r\n      FTimerID := -1;\r\n    end;\r\n\r\n    if Assigned(OnClose) then\r\n      OnClose(Self, lAction);\r\n\r\n    //if lAction = caFree then\r\n    //  DestroyControls;\r\n\r\n    if lAction <> caNone then\r\n    begin\r\n      if Assigned(FLayer) then\r\n      begin\r\n        if Container.parentNode = FLayer then\r\n        begin\r\n          FLayer.removeChild(Container);\r\n        end\r\n        else\r\n        begin\r\n          if Container.parentNode.parentNode = FLayer then\r\n            FLayer.removeChild(Container.parentNode);\r\n        end;\r\n\r\n        Container := nil;\r\n        if FormContainerElement = FLayer.parentNode then\r\n        begin\r\n          FormContainerElement.removeChild(FLayer);\r\n          Application.ChangeMaxZIndex(-1);\r\n        end;\r\n        FLayer := nil;\r\n      end;\r\n\r\n      if (FormFileName = '') then\r\n      begin\r\n        if (FFormElement <> '') and Assigned(Container) then\r\n        begin\r\n          Container.innerHTML := '';\r\n          Container := nil;\r\n        end\r\n        else\r\n          if Assigned(Container) then\r\n          begin\r\n            if FormContainerElement = Container.parentNode then\r\n              FormContainerElement.removeChild(Container);\r\n            Container := nil;\r\n          end;\r\n      end\r\n      else\r\n      begin\r\n        if FFormElement <> '' then\r\n        begin\r\n          Container.innerHTML := '';\r\n          Container := nil;\r\n        end\r\n      end;\r\n\r\n      if (FFormElement <> FormContainer) and (FFormElement <> '') then\r\n      begin\r\n        el := document.getElementById(FFormElement);\r\n        if Assigned(el) then\r\n          el.innerHTML := '';\r\n      end;\r\n\r\n      DoClose(lAction);\r\n\r\n      if (lAction = caFree) and not (csDestroying in ComponentState) then\r\n      begin\r\n        ReleaseForm(Self);\r\n        if Application.FMainForm = Self then\r\n          Application.FMainForm := nil;\r\n      end;\r\n\r\n      Application.FActiveForm := FPrevActiveForm;\r\n\r\n      Visible := False;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.CloseQuery: Boolean;\r\nbegin\r\n  Result := True;\r\n  if Assigned(FOnCloseQuery) then\r\n    FOnCloseQuery(Self, Result);\r\nend;\r\n\r\nprocedure TCustomForm.ColorChanging;\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n  begin\r\n    TJSHTMLElement(Container).style.setProperty(CSSBackground, ColorToHTML(Color));\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.ContainerElement: TJSElement;\r\nbegin\r\n  Result := FormContainerElement;\r\nend;\r\n\r\nconstructor TCustomForm.Create(AOwner: TComponent);\r\nbegin\r\n  FNoHTML := false;\r\n  FCreating := true;\r\n  FResizeObserver := nil;\r\n  inherited;\r\n  FBorder := fbSingle;\r\n  FFormFileName := '';\r\n  FPopupMode := pmNone;\r\n  FPopupClose := pcOnDeactivate;\r\n  FPopup := True;\r\n  FPosition := poScreenCenter;\r\n  FPopupOpacity := 1.0;\r\nend;\r\n\r\nfunction TCustomForm.CreateCaption: TJSHTMLElement;\r\nvar\r\n  BarHeight: string;\r\nbegin\r\n  BarHeight := IntToStr(Application.FormCaptionHeight);\r\n  FCaptionElement := TJSHTMLElement(document.createElement('DIV'));\r\n  FCaptionElement.innerHTML := Caption;\r\n  FCaptionElement.style.setProperty(CSSBackground, ColorToHTML(Application.ThemeColor));\r\n  FCaptionElement.style.setProperty('color', ColorToHTML(Application.ThemeTextColor));\r\n  FCaptionElement.style.setProperty('cursor', 'move');\r\n  //title.style.setProperty('padding', Padding + 'px');\r\n  FCaptionElement.style.setProperty('height', BarHeight + 'px');\r\n  FCaptionElement.style.setProperty('line-height', BarHeight + 'px');\r\n  FCaptionElement.style.setProperty('border-bottom', '1px solid black');\r\n  FCaptionElement.style.setProperty('padding-left','4px');\r\n\r\n  FCaptionElement.style.setProperty('-moz-user-select','none');\r\n  FCaptionElement.style.setProperty('-webkit-user-select','none');\r\n  FCaptionElement.style.setProperty('-ms-user-select','none');\r\n  FCaptionElement.style.setProperty('user-select','none');\r\n  FCaptionElement.style.setProperty('-o-user-select','none');\r\n\r\n  if ElementCaptionClassName <> '' then\r\n    FCaptionElement.setAttribute('class',ElementCaptionClassName);\r\n\r\n  SetHTMLElementFont(FCaptionElement, Font, not ((ElementCaptionClassName = '') and (ElementFont = efProperty)));\r\n\r\n  if not Assigned(FTitleDownPtr) then\r\n    GetMethodPointers;\r\n\r\n  FCaptionElement.innerHTML := FCaption;\r\n  FCaptionElement.addEventListener('mousedown', FTitleDownPtr);\r\n  FHasCaption := true;\r\n\r\n  Result := FCaptionElement;\r\nend;\r\n\r\nprocedure TCustomForm.CreateControl;\r\nbegin\r\n  if not Visible and not FPopup then\r\n    Exit;\r\n  inherited;\r\n  UpdateSize;\r\nend;\r\n\r\nfunction TCustomForm.CreateLayer: TJSHTMLElement;\r\nbegin\r\n  Result := TJSHTMLElement(document.createElement('SPAN'));\r\n  Result.style.setProperty('top', '0');\r\n  Result.style.setProperty('left', '0');\r\n  Result.style.setProperty('right', '0');\r\n  Result.style.setProperty('bottom', '0');\r\n\r\n  Result.style.setProperty('webkit-user-select', 'none');\r\n  Result.style.setProperty('moz-user-select', 'none');\r\n  Result.style.setProperty('khtml-user-select', 'none');\r\n  Result.style.setProperty('ms-user-select', 'none');\r\n  Result.style.setProperty('user-select', 'none');\r\n  Result.style.setProperty('position', 'absolute');\r\n  Result.style.setProperty('z-index', Application.MaxZIndexStr);\r\nend;\r\n\r\nfunction TCustomForm.CreateElement: TJSElement;\r\nvar\r\n  eh,caph: TJSHTMLElement;\r\n\r\nbegin\r\n  if not FPopup and Assigned(FormContainerElement) then\r\n  begin\r\n    Result := FormContainerElement;\r\n    Exit;\r\n  end;\r\n\r\n  //if FPopup then\r\n  begin\r\n    Result := document.createElement('DIV');\r\n\r\n    FLayer := CreateLayer;\r\n    document.body.appendChild(FLayer);\r\n\r\n    eh := TJSHTMLElement(FLayer);\r\n\r\n    if FPopupClose = pcOnDeactivate then\r\n    begin\r\n      // ensure method pointers exist\r\n      GetMethodPointers;\r\n      eh.addEventListener('click', FDoClickPtr);\r\n    end;\r\n\r\n    eh.style.setProperty(CSSZINDEX, Application.MaxZIndexStr);\r\n\r\n    if (Border = fbSizeable) then\r\n    begin\r\n      TJSHTMLElement(Result).style.setProperty('resize','both');\r\n      TJSHTMLElement(Result).style.setProperty('overflow','auto');\r\n    end;\r\n\r\n    FHasCaption := false;\r\n\r\n    if (Border in [fbSizeable, fbDialog, fbDialogSizeable]) then\r\n    begin\r\n      caph := CreateCaption;\r\n      Result.appendChild(caph);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.LoadDFMValues;\r\nbegin\r\nend;\r\n\r\nprocedure TCustomForm.Loaded;\r\nbegin\r\n  inherited;\r\n  LoadedDone;\r\nend;\r\n\r\nprocedure TCustomForm.LoadedDone;\r\nbegin\r\n  Application.TriggerNotification;\r\nend;\r\n\r\nprocedure TCustomForm.Init;\r\nbegin\r\nend;\r\n\r\nfunction TCustomForm.IsFocused: Boolean;\r\nbegin\r\n  // form is not focused only controls\r\n  Result := false;\r\nend;\r\n\r\nfunction TCustomForm.IsMiletus: boolean;\r\nvar\r\n  cl: TClass;\r\nbegin\r\n  cl := ClassType;\r\n  Result := false;\r\n\r\n  repeat\r\n    cl := cl.ClassParent;\r\n    if Assigned(cl) and (cl.ClassName = 'TMiletusForm') then\r\n    begin\r\n      Result := true;\r\n      break;\r\n    end;\r\n  until not Assigned(cl) or (cl.ClassName = 'TForm');\r\nend;\r\n\r\nprocedure TCustomForm.Resize;\r\nvar\r\n  i,ch: integer;\r\n  neww, newh: integer;\r\n  eh: TJSHTMLElement;\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if (csDestroying in ComponentState) then\r\n    Exit;\r\n\r\n  FIsResizing := true;\r\n\r\n  if FPopup and Assigned(FPopupElement) then\r\n  begin\r\n    eh := FPopupElement;\r\n    dr := eh.getBoundingClientRect;\r\n\r\n    neww := Round(dr.Right - dr.Left - 2);\r\n    if (Border in [fbDialog, fbDialogSizeable]) then\r\n    begin\r\n      ch := GetCaptionHeight;\r\n      newh := Round(dr.Bottom - dr.Top - ch - 2)\r\n    end\r\n    else\r\n      newh := Round(dr.Bottom - dr.Top - 2)\r\n  end\r\n  else\r\n  begin\r\n    neww := window.innerWidth;\r\n    newh := window.innerHeight;\r\n  end;\r\n\r\n  UpdateControlSize(neww, newh);\r\n\r\n  if not (IsAndroid and (document.activeElement.tagName = 'INPUT')) then\r\n    AlignControl(Self);\r\n\r\n  DoResize;\r\n\r\n  FIsResizing := false;\r\n\r\n  if not IsUpdating then\r\n  begin\r\n    if (OrigRect.Left = -1) and (OrigRect.Top = -1) then\r\n      InitAnchoring;\r\n\r\n    for i := 0 to ControlCount - 1 do\r\n      Controls[i].UpdateAnchoring;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetActiveControl(const Value: TWinControl);\r\nbegin\r\n  FActiveControl := Value;\r\n  if Assigned(FActiveControl) then\r\n    FActiveControl.SetFocus;\r\nend;\r\n\r\nprocedure TCustomForm.SetBorder(const Value: TFormBorderStyle);\r\nbegin\r\n  if (FBorder <> Value) then\r\n  begin\r\n    FBorder := Value;\r\n    if Assigned(Container) then\r\n      AlignControl(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetBounds(X, Y, AWidth, AHeight: Integer);\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Resize;\r\n    SetBoundsInt(X, Y, AWidth, AHeight);\r\n  end\r\n  else\r\n    inherited SetBounds(X, Y, AWidth, AHeight);\r\nend;\r\n\r\nprocedure TCustomForm.SetCaption(const AValue: string);\r\nbegin\r\n  if FCaption <> AValue then\r\n  begin\r\n    FCaption := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetColorScheme(AScheme: TApplicationColorScheme);\r\nvar\r\n  s: string;\r\nbegin\r\n  if not Application.Themed then\r\n    Exit;\r\n\r\n  case AScheme of\r\n  csDark:\r\n    begin\r\n      s :=\r\n        'label,option,td,table,ul,li {background-color: #202124; color: #BEC1C6;}'+#13#10 +\r\n        'body,input,textarea,select,fieldset {background-color: #202124; color: #BEC1C6; border: 1px solid gray;}'+#13#10 +\r\n        'input:focus, textarea:focus, select:focus, span:focus { border: 1px solid silver; outline: none !important;}';\r\n      AddCSS('appscheme',s);\r\n    end;\r\n  csLight: RemoveCSS('appscheme');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetElementClassName(AValue: string);\r\nbegin\r\n  inherited;\r\n  if FPopup and Assigned(FPopupElement) then\r\n  begin\r\n    FPopupElement['class'] := AValue;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetFormContainer(const Value: TElementID);\r\nvar\r\n  el,old: TJSElement;\r\n  i: integer;\r\n\r\nbegin\r\n  old := Container;\r\n\r\n  if (csDesigning in ComponentState) then\r\n    FFormContainer := Value\r\n  else\r\n  begin\r\n    if Uppercase(Value) = 'BODY' then\r\n      FFormContainer := ''\r\n    else\r\n      FFormContainer := Value;\r\n  end;\r\n\r\n  if (csLoading in ComponentState) and not (csDesigning in ComponentState) then\r\n    Exit;\r\n\r\n   // displayed on top of other in layer\r\n  if Assigned(FLayer) then\r\n    el := FLayer\r\n  else\r\n   // update container element\r\n  if Value = '' then\r\n  begin\r\n    el := document.body;\r\n  end\r\n  else\r\n  begin\r\n    el := document.getElementById(Value);\r\n    if not Assigned(el) then\r\n      el := document.body;\r\n  end;\r\n\r\n  if Assigned(el) then\r\n  begin\r\n    Container := el;\r\n\r\n    if Assigned(old) then\r\n    begin\r\n      for i := 0 to ControlCount - 1 do\r\n      begin\r\n        if (Controls[i].ParentElement = old) then\r\n          Controls[i].ParentElementHandle := TJSHTMLElement(el);\r\n\r\n        if Assigned(Controls[i].ElementHandle) and (Controls[i].ElementHandle.parentElement = old) then\r\n        begin\r\n          el.appendChild(Controls[i].ElementHandle);\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetFormPos;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if Position = poScreenCenter then\r\n  begin\r\n    FLeft := Round((WinWidth - Width)/2) + window.scrollX;\r\n    FTop := Round((WinHeight - Height)/2) +  window.scrollY;\r\n  end;\r\n\r\n  TJSHTMLElement(Container).style.setProperty('position','absolute');\r\n  TJSHTMLElement(Container).style.setProperty('width',inttostr(Width)+'px');\r\n  TJSHTMLElement(Container).style.setProperty('height',inttostr(Height)+'px');\r\n  TJSHTMLElement(Container).style.setProperty('left',inttostr(Left)+'px');\r\n  TJSHTMLElement(Container).style.setProperty('top',inttostr(Top)+'px');\r\nend;\r\n\r\nprocedure TCustomForm.SetFormStyle(const Value: TFormStyle);\r\nbegin\r\n  FFormStyle := Value;\r\nend;\r\n\r\nprocedure TCustomForm.SetHeight(AValue: Integer);\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  if ((csLoading in ComponentState) and (FFormContainer <> '')) or (not Popup and not Assigned(ElementHandle)) then\r\n  begin\r\n    SetHeightInt(AValue);\r\n    Exit;\r\n  end;\r\n\r\n  inherited;\r\n  if Popup then\r\n  begin\r\n    eh := FPopupElement;\r\n    if Assigned(eh) then\r\n      eh.style.setProperty('height',inttostr(avalue)+'px');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetLeft(AValue: Integer);\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n  if Popup then\r\n  begin\r\n    eh := FPopupElement;\r\n    if Assigned(eh) then\r\n      eh.style.setProperty('left',inttostr(avalue)+'px');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetModalResult(const Value: TModalResult);\r\nbegin\r\n  FModalResult := Value;\r\n  if (FModalResult <> mrNone) then\r\n    Close;\r\nend;\r\n\r\nprocedure TCustomForm.SetPosition(const Value: TPosition);\r\nbegin\r\n  FPosition := Value;\r\nend;\r\n\r\nprocedure TCustomForm.SetShadow(const Value: boolean);\r\nbegin\r\n  if (FShadow <> Value) then\r\n  begin\r\n    FShadow := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetTop(AValue: Integer);\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n  if Popup then\r\n  begin\r\n    eh := FPopupElement;\r\n    if Assigned(eh) then\r\n      eh.style.setProperty('top',IntToStr(avalue)+'px');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetWidth(AValue: Integer);\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  if ((csLoading in ComponentState) and (FFormContainer <> '')) or (not Popup and not Assigned(ElementHandle)) then\r\n  begin\r\n    SetWidthInt(AValue);\r\n    Exit;\r\n  end;\r\n\r\n  inherited;\r\n\r\n  if Popup then\r\n  begin\r\n    eh := FPopupElement;\r\n    if Assigned(eh) then\r\n      eh.style.setProperty('width',IntToStr(avalue)+'px');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SelectFirst;\r\nbegin\r\n  if ControlCount > 0 then\r\n    Controls[0].SetFocus;\r\nend;\r\n\r\nprocedure TCustomForm.SelectNext(CurControl: TControl; GoForward: boolean; CheckTabStop: boolean);\r\nvar\r\n  i: integer;\r\nbegin\r\n  if ControlCount > 0 then\r\n  begin\r\n    for i := 0 to ControlCount - 1 do\r\n    begin\r\n      if Controls[i] = CurControl then\r\n      begin\r\n        if GoForward then\r\n        begin\r\n          if i + 1 <= ControlCount - 1  then\r\n            Controls[i + 1].SetFocus\r\n          else\r\n            Controls[0].SetFocus;\r\n        end\r\n        else\r\n        begin\r\n          if i - 1 >= 0 then\r\n            Controls[i - 1].SetFocus\r\n          else\r\n            Controls[ControlCount - 1].SetFocus;\r\n        end;\r\n        break;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.Show;\r\nvar\r\n  i: integer;\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if FCreating and FPopup then\r\n  begin\r\n    Application.ChangeMaxZIndex(+1);\r\n    FCreating := false;\r\n    UpdateElement;\r\n  end;\r\n\r\n  if (FormFileName = '') then\r\n  begin\r\n    if not Assigned(Container) then\r\n    begin\r\n      if FPopup then\r\n      begin\r\n        Container := CreateElement;\r\n//        TJSHTMLElement(FLayer).style.setProperty(CSSBackground,'silver');\r\n        FPopupElement := TJSHTMLElement(Container);\r\n        SetFormPos;\r\n        UpdateElement;\r\n        FLayer.appendChild(Container);\r\n      end\r\n      else\r\n      begin\r\n        Container := CreateLayer;\r\n        TJSHTMLElement(Container).style.setProperty(CSSBackground,ColorToHTML(Color));\r\n        document.body.appendChild(Container);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      if FPopup then\r\n      begin\r\n        SetFormPos;\r\n        FLayer.appendChild(Container)\r\n      end\r\n      else\r\n      begin\r\n        if Assigned(FLayer) then\r\n        begin\r\n          FLayer.appendChild(Container)\r\n        end\r\n        else\r\n        begin\r\n          document.body.appendChild(Container);\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if FPopup then\r\n    begin\r\n      if (Border = fbSizeable) then\r\n      begin\r\n        dr := Container.getBoundingClientRect;\r\n        FOrigWidth := Round(dr.Right - dr.Left);\r\n        FOrigHeight := Round(dr.Bottom - dr.Top);\r\n        FTimerID := window.setInterval(@HandleDoResize, 100);\r\n      end\r\n      else\r\n      begin\r\n        TJSHTMLElement(Container).style.setProperty('resize','');\r\n        TJSHTMLElement(Container).style.setProperty('overflow','');\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  Visible := True;\r\n\r\n  //DoShow;\r\n\r\n  // Auto focus control on form\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    if (Controls[i].TabOrder = 0) and (Controls[i].TabStop) then\r\n      Controls[i].SetFocus;\r\n  end;\r\n\r\nend;\r\n\r\nfunction TCustomForm.ShowModal: Integer;\r\nbegin\r\n  Result := ShowModal(nil);\r\nend;\r\n\r\nfunction TCustomForm.ShowModal(AProc: TModalResultProc): TModalResult;\r\nbegin\r\n  // create runtime form without HTML\r\n  if FNoHTML then\r\n  begin\r\n    FPrevActiveForm := Application.ActiveForm;\r\n    Application.FActiveForm := Self;\r\n    Application.CreateNewForm(Self, '');\r\n  end;\r\n\r\n  Result := mrNone;\r\n  FNoHTML := false;\r\n  FModalProc := AProc;\r\n  ModalResult := mrNone;\r\n  Show;\r\nend;\r\n\r\nprocedure TCustomForm.UnbindEvents;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(FLayer) and (FPopupClose = pcOnDeactivate) then\r\n    FLayer.removeEventListener('click', FDoClickPtr);\r\n\r\n  if Assigned(FResizeObserver) then\r\n  begin\r\n    asm\r\n      this.FResizeObserver.disconnect();\r\n    end;\r\n  end;\r\n\r\n  window.removeEventListener('resize', FResizePtr);\r\n  window.removeEventListener('load', FLoadedPtr);\r\n  window.removeEventListener('DOMContentLoaded',FDOMContentLoadedPtr);\r\n  document.removeEventListener('scroll', FScrollPtr);\r\n  window.removeEventListener('unload', FUnloadPtr);\r\n  window.removeEventListener('beforeunload', FBeforeUnloadPtr);\r\n  window.removeEventListener('keydown', FKeyDownPtr);\r\n  window.removeEventListener('orientationchange',FOrientationChangePtr);\r\n  window.removeEventListener('hashchange',FHashChangePtr);\r\nend;\r\n\r\nprocedure TCustomForm.UpdateCSS(const id, css: string);\r\nbegin\r\n  RemoveCSS(id);\r\n  AddCSS(id,css);\r\nend;\r\n\r\nprocedure TCustomForm.UpdateElement;\r\nvar\r\n  clr: string;\r\n  el: TJSNode;\r\n\r\nbegin\r\n  if FCreating then\r\n    Exit;\r\n\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) or Assigned(Container) then\r\n  begin\r\n    if (FCaption <> '') then\r\n    begin\r\n      if not FPopup then\r\n        window.document.title := FCaption\r\n      else\r\n      begin\r\n        if Assigned(FCaptionElement) then\r\n        begin\r\n          el := FCaptionElement.childNodes[0];\r\n          if Assigned(el) then\r\n             el.nodeValue := FCaption;\r\n\r\n          if ShowClose and not Assigned(FCaptionCloseElement) then\r\n          begin\r\n            FCaptionCloseElement := TJSHTMLElement(document.createElement('SPAN'));\r\n            FCaptionCloseElement.style.setProperty('float','right');\r\n            FCaptionCloseElement.style.setProperty('cursor','default');\r\n            FCaptionCloseElement.style.setProperty('margin-right','8px');\r\n            FCaptionCloseElement.innerHTML := '&#x2716;';\r\n            FCaptionElement.appendChild(FCaptionCloseElement);\r\n            FCaptionCloseElement.addEventListener('click', @HandleCloseClick);\r\n          end;\r\n\r\n          SetHTMLElementFont(FCaptionElement, Font, not ((ElementCaptionClassName = '') and (ElementFont = efProperty)));\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    clr := ColorToHtml(Color);\r\n\r\n    if Assigned(Container) then\r\n    begin\r\n      if (Color <> clNone) and ((Color <> clWhite) and not Popup) and (ElementClassName = '') then\r\n        TJSHTMLElement(Container).style.setProperty(CSSBackground,clr);\r\n\r\n      if (ElementClassName <> '') or (Color = clNone) or ((Color = clWhite) and not Popup) then\r\n        TJSHTMLElement(Container).style.removeProperty(CSSBackground);\r\n\r\n      if (ElementClassName = '') and not Popup then\r\n      begin\r\n        // make sure body stretches over the entire page\r\n        //TJSHTMLElement(Container).style.setProperty('height','100%');\r\n        asm\r\n          document.documentElement.style.setProperty('height','100%');\r\n        end;\r\n      end;\r\n\r\n      SetHTMLElementFont(TJSHTMLElement(Container), Font, not ((ElementClassName = '') and (ElementFont = efProperty)));\r\n    end;\r\n\r\n    if FPopup then\r\n    begin\r\n      if not Assigned(FPopupElement) then\r\n        FPopupElement := TJSHTMLElement(Container);\r\n\r\n      if FShadow then\r\n      begin\r\n        TJSHTMLElement(FPopupElement).style.setProperty('box-shadow','3px 3px 3px silver')\r\n      end\r\n      else\r\n      begin\r\n        TJSHTMLElement(FPopupElement).style.removeProperty('box-shadow');\r\n      end;\r\n\r\n      TJSHTMLElement(FPopupElement).style.setProperty('border','1px solid gray');\r\n    end\r\n    else\r\n    begin\r\n      TJSHTMLElement(Container).style.removeProperty('box-shadow');\r\n    end;\r\n  end;\r\n\r\n\r\nend;\r\n\r\nprocedure TCustomForm.VisibleChanged;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(FLayer) then\r\n  begin\r\n    if Visible then\r\n      TJSHTMLElement(FLayer).style.setProperty('display','')\r\n    else\r\n      TJSHTMLElement(FLayer).style.setProperty('display','none');\r\n  end\r\n  else\r\n  begin\r\n    if Assigned(Container) and (FormContainer <> '') then\r\n    begin\r\n      if Visible then\r\n        TJSHTMLElement(Container).style.setProperty('display','')\r\n      else\r\n        TJSHTMLElement(Container).style.setProperty('display','none');\r\n    end;\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TCustomForm.Paint;\r\nbegin\r\n  //\r\nend;\r\n\r\nprocedure TCustomForm.PreventDefault;\r\nbegin\r\n  ElementEvent.preventDefault();\r\nend;\r\n\r\nfunction TCustomForm.HandleObserver: boolean;\r\nbegin\r\n  Resize;\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.HandleOrientationChange(Event: TJSEvent): Boolean;\r\nvar\r\n  so: TScreenOrientation;\r\n  isPortrait: boolean;\r\nbegin\r\n  Resize;\r\n  Realign;\r\n  Result := true;\r\n\r\n  if Assigned(OnOrientationChange) then\r\n  begin\r\n    asm\r\n      var mql = window.matchMedia(\"(orientation: portrait)\");\r\n      isPortrait = (mql.matches);\r\n    end;\r\n\r\n    if isPortrait then\r\n      so := soLandscape\r\n    else\r\n      so := soPortrait;\r\n\r\n    OnOrientationChange(Self, so);\r\n  end;\r\n\r\n  if Assigned(OnResize) then\r\n    OnResize(Self);\r\nend;\r\n\r\nfunction TCustomForm.HandleResize(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Visible then\r\n  begin\r\n    if not Assigned(Container) then\r\n      CreateControl;\r\n\r\n    Resize;\r\n  end;\r\n\r\n  // make sure HandleObserver is not optimized away\r\n  if (1<0) then\r\n  begin\r\n    HandleObserver;\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.GetActiveControl: TWinControl;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := FActiveControl;\r\n\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    if Controls[i].ElementHandle = document.activeElement then\r\n    begin\r\n      Result := TWinControl(Controls[i]);\r\n      break;\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.GetCanvas: TCanvas;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nfunction TCustomForm.GetCaptionHeight: integer;\r\nvar\r\n  r: TJSDOMRect;\r\nbegin\r\n  Result := 0;\r\n  if Assigned(FCaptionElement) and (Border in [fbDialog, fbDialogSizeable]) then\r\n  begin\r\n    r := FCaptionElement.getBoundingClientRect;\r\n    Result := Round(r.Bottom - r.Top);\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.GetClientRect: TRect;\r\n//var\r\n//  ch: integer;\r\nbegin\r\n  Result := inherited GetClientRect;\r\n\r\n//  if FHasCaption then\r\n//  begin\r\n//    ch := GetCaptionHeight - 2;\r\n//    Result.Top := Result.Top + ch;\r\n//    Result.Bottom := Result.Bottom + ch;\r\n//  end;\r\nend;\r\n\r\nfunction TCustomForm.GetElementBindHandle: TJSEventTarget;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Result := TJSEventTarget(window);\r\n    Exit;\r\n  end;\r\n\r\n  if (FormContainer <> '') then\r\n  begin\r\n    Result := TJSEventTarget(window);\r\n  end\r\n  else\r\n  begin\r\n    if not FPopup then\r\n    begin\r\n      Result := TJSEventTarget(window);\r\n    end\r\n    else\r\n      Result := inherited GetElementBindHandle;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.GetElementHandle: TJSHTMLElement;\r\nbegin\r\n  if FPopup then\r\n    Result := inherited GetElementHandle\r\n  else\r\n    Result := TJSHTMLElement(FormContainerElement);\r\nend;\r\n\r\nfunction TCustomForm.GetFormStyle: TFormStyle;\r\nbegin\r\n  Result := FFormStyle;\r\nend;\r\n\r\nfunction TCustomForm.GetHeight: Integer;\r\nvar\r\n  d: integer;\r\n  s: string;\r\n  css: TJSCSSStyleDeclaration;\r\n  el: TJSHTMLElement;\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if (FFormElement <> '') then\r\n  begin\r\n    el := TJSHTMLElement(document.getElementById(FFormElement));\r\n    if Assigned(el) then\r\n    begin\r\n      dr := el.getBoundingClientRect;\r\n      Result := Round(dr.bottom - dr.top);\r\n      Exit;\r\n    end\r\n  end;\r\n\r\n  if (ElementHandle = document.body) then\r\n  begin\r\n    css := window.getComputedStyle(ElementHandle);\r\n    s := css.getPropertyValue('margin-top');\r\n    s := Copy(s,1,Length(s) - 2);\r\n    d := Round(StrToFloat(s, TFormatSettings.Invariant) - 2); // div 2;\r\n\r\n    dr := document.documentElement.getBoundingClientRect;\r\n    Result := Round(dr.Height);\r\n\r\n    if Result > window.innerHeight then\r\n      Result := window.innerHeight - Max(0,d);\r\n  end\r\n  else\r\n  begin\r\n    if FPopup then\r\n    begin                            // take caption border in account\r\n      Result := inherited GetHeight  // GetCaptionHeight - 2;\r\n    end\r\n    else\r\n    begin\r\n      Result := Round(ElementHandle.offsetHeight);\r\n      if Result = 0 then\r\n      begin\r\n        if FFormContainer <> '' then\r\n          Result := inherited GetHeight\r\n        else\r\n          Result:= window.innerHeight;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TCustomForm.GetHTMLFileName: string;\r\nbegin\r\n  Result := Self.UnitName + Application.GetFormExtension;\r\nend;\r\n\r\nfunction TCustomForm.GetLeft: Integer;\r\nvar\r\n  el: TJSHTMLElement;\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if FPopup then\r\n  begin\r\n    Result := inherited GetLeft\r\n  end\r\n  else\r\n  begin\r\n    if (FFormElement <> '') then\r\n    begin\r\n      el := TJSHTMLElement(document.getElementById(FFormElement));\r\n      if Assigned(el) then\r\n      begin\r\n        dr := el.getBoundingClientRect;\r\n        Result := Round(dr.left);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      el := nil;\r\n      if (FormContainer <> '') then\r\n        el := TJSHTMLElement(document.getElementById(FormContainer));\r\n\r\n      if not Assigned(el) then\r\n         el := ElementHandle; \r\n\r\n      Result := Round(el.offsetLeft);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n\r\n  if FLoadedPtr = nil then\r\n  begin\r\n    FLoadedPtr := @HandleLoaded;\r\n    FDOMContentLoadedPtr := @HandleDOMContentLoaded;\r\n    FUnloadPtr := @HandleUnLoad;\r\n    FBeforeUnloadPtr := @HandleBeforeUnload;\r\n    FResizePtr := @HandleResize;\r\n    FScrollPtr := @HandleScroll;\r\n    FDocMouseUpPtr := @HandleDocMouseUp;\r\n    FDocMouseMovePtr := @HandleDocMouseMove;\r\n    FTitleDownPtr := @HandleTitleDown;\r\n    FDoClickPtr := @HandleDoClick;\r\n    FKeyDownPtr := @HandleKeyDown;\r\n    FOrientationChangePtr := @HandleOrientationChange;\r\n    FHashChangePtr := @HandleHashChange;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.GetTop: Integer;\r\nvar\r\n  el: TJSHTMLElement;\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if FPopup then\r\n    Result := inherited GetTop\r\n  else\r\n  begin\r\n    if (FFormElement <> '') then\r\n    begin\r\n      el := TJSHTMLElement(document.getElementById(FFormElement));\r\n      if Assigned(el) then\r\n      begin\r\n        dr := el.getBoundingClientRect;\r\n        Result := Round(dr.top);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      el := nil;\r\n      if (FormContainer <> '') then\r\n        el := TJSHTMLElement(document.getElementById(FormContainer));\r\n\r\n      if not Assigned(el) then\r\n          el := ElementHandle; \r\n      Result := Round(el.offsetTop);\r\n    end; \r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.GetUniqueComponentName(AComponent: TComponent): string;\r\nvar\r\n  s: string;\r\n  i,j: integer;\r\n  found: boolean;\r\nbegin\r\n  i := 1;\r\n  repeat\r\n    found := false;\r\n\r\n    s := Copy(ClassName,2, Length(ClassName)) + '_' + Copy(AComponent.ClassName, 2, Length(AComponent.ClassName)) + IntToStr(i);\r\n    inc(i);\r\n\r\n    for j := 0 to ComponentCount - 1 do\r\n    begin\r\n      if Components[j].Name = s then\r\n      begin\r\n        found := true;\r\n        break;\r\n      end;\r\n    end;\r\n\r\n  until found = false;\r\n\r\n  Result := s;\r\nend;\r\n\r\nfunction TCustomForm.GetWidth: Integer;\r\nvar\r\n  dr: TJSDOMRect;\r\n  el: TJSHTMLElement;\r\n//  s: string;\r\n//  d: integer;\r\n//  css: TJSCSSStyleDeclaration;\r\nbegin\r\n  if (FFormElement <> '') then\r\n  begin\r\n    el := TJSHTMLElement(document.getElementById(FFormElement));\r\n    if Assigned(el) then\r\n    begin\r\n      dr := el.getBoundingClientRect;\r\n      Result := Round(dr.right - dr.left);\r\n      Exit;\r\n    end\r\n  end;\r\n\r\n  if (ElementHandle = document.body) then\r\n  begin\r\n    {\r\n    css := window.getComputedStyle(ElementHandle);\r\n    s := css.getPropertyValue('margin-left');\r\n    s := Copy(s,1,Length(s) - 2);\r\n    d := StrToInt(s) - 2;\r\n    Result := window.innerWidth - d + 4;\r\n    }\r\n    Result := window.innerWidth;\r\n\r\n    dr := document.documentElement.getBoundingClientRect;\r\n    Result := Round(dr.Width);\r\n\r\n    if Result > window.innerWidth then\r\n      Result := window.innerWidth;\r\n  end\r\n  else\r\n  begin\r\n    if FPopup then\r\n      Result := inherited GetWidth\r\n    else\r\n    begin\r\n\r\n      Result := Round(ElementHandle.offsetWidth);\r\n      if Result = 0 then\r\n      begin\r\n        if FFormContainer <> '' then\r\n          Result := inherited GetWidth\r\n        else\r\n          Result := window.innerWidth;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.HandleBeforeUnload(Event: TEventListenerEvent): boolean;\r\nvar\r\n  msg: string;\r\nbegin\r\n  msg := '';\r\n  if Assigned(OnBeforeUnload) then\r\n    OnBeforeUnload(Self,msg);\r\n\r\n    if msg <> '' then\r\n    begin\r\n      asm\r\n        Event.returnValue = msg;\r\n        return msg;\r\n      end;\r\n    end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.HandleCloseClick(Event: TEventListenerEvent): boolean;\r\nvar\r\n  CanClose: boolean;\r\n\r\nbegin\r\n  CanClose := true;\r\n\r\n  if Assigned(OnCloseQuery) then\r\n   OnCloseQuery(self, CanClose);\r\n\r\n  if CanClose then\r\n    Close;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  Event.stopPropagation;\r\n\r\n  if FPopupClose = pcOnDeactivate then\r\n    Close;\r\n\r\n  Result := True;\r\nend;\r\n\r\nfunction TCustomForm.HandleDocMouseMove(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  deltax,deltay: double;\r\n  el: TJSHTMLElement;\r\n  l,t: integer;\r\nbegin\r\n  if FDown then\r\n  begin\r\n    deltax := Event.screenX - FMdx;\r\n    deltay := Event.screenY - FMdy;\r\n\r\n    if FHasCaption and (FormFileName <> '') then\r\n      el := TJSHTMLElement(Container.parentNode)\r\n    else\r\n      el := TJSHTMLElement(Container);\r\n\r\n    el.style.setProperty('transform','');\r\n    el.style.setProperty('position','absolute');\r\n\r\n    l := round(FDlgX + deltax);\r\n    t := round(FDlgY + deltay);\r\n\r\n    el.style.setProperty('left', inttostr(l)+'px');\r\n    el.style.setProperty('top', inttostr(t)+'px');\r\n\r\n    FLeft := l;\r\n    FTop := t;\r\n\r\n//    el := TJSHTMLElement(FCancel);\r\n//    el.style.setProperty('position', 'absolute');\r\n//    el.style.setProperty('top', '0');\r\n//    el.style.setProperty('right', '0');\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.HandleDocMouseUp(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if FDown then\r\n  begin\r\n    FCaptured := false;\r\n    FDown := false;\r\n    document.body.removeEventListener('mousemove', FDocMouseMovePtr);\r\n    document.body.removeEventListener('mouseup', FDocMouseUpPtr);\r\n    if Assigned(FMoveSpan) then\r\n      document.body.removeChild(FMoveSpan);\r\n\r\n    EventStopPropagation :=   EventStopPropagation + [eeMouseMove, eeMouseUp];\r\n\r\n    FMoveSpan := nil;\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.HandleDOMContentLoaded(\r\n  Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Assigned(OnDOMContentLoaded) then\r\n    OnDOMContentLoaded(Self);\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomForm.HandleDoResize;\r\nvar\r\n  dr: TJSDOMRect;\r\n  neww,newh: integer;\r\nbegin\r\n  dr := Container.getBoundingClientRect;\r\n\r\n  neww := Round(dr.Right - dr.Left);\r\n  newh := Round(dr.Bottom - dr.Top);\r\n\r\n  if (neww <> FOrigWidth) or (newh <> FOrigHeight) then\r\n  begin\r\n    Width := neww;\r\n    Height := newh;\r\n\r\n    dr := Container.getBoundingClientRect;\r\n    FOrigWidth := Round(dr.Right - dr.Left);\r\n    FOrigHeight := Round(dr.Bottom - dr.Top);\r\n\r\n    AlignControl(Self);\r\n  end;\r\nend;\r\n\r\n\r\nfunction TCustomForm.HandleHashChange(Event: TEventListenerEvent): boolean;\r\nvar\r\n  oldURL,newURL: string;\r\nbegin\r\n  asm\r\n    oldURL = Event.oldURL;\r\n    newURL = Event.newURL;\r\n  end;\r\n\r\n  if Assigned(OnHashChange) then\r\n  begin\r\n    OnHashChange(Self, oldURL, newURL);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.HandleKeyDown(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  k: Word;\r\nbegin\r\n  k := GetKeyCode(Event.Key);\r\n  if not Assigned(k) then\r\n    Exit;\r\n\r\n  if (k = VK_ESCAPE) and not (csDesigning in ComponentState) and Popup then\r\n  begin\r\n    Close;\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.HandleTitleDown(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  r: TJSDOMRect;\r\nbegin\r\n  Event.StopPropagation;\r\n  Event.PreventDefault;\r\n\r\n  FPopupClose := pcNever;\r\n\r\n  FMdx := Round(Event.screenX);\r\n  FMdy := Round(Event.screenY);\r\n\r\n  if FHasCaption and (FormFileName <> '') then\r\n    r := TJSHTMLElement(Container.parentNode).getBoundingClientRect()\r\n  else\r\n    r := TJSHTMLElement(Container).getBoundingClientRect();\r\n\r\n  FDlgX := Round(int(r.left));\r\n  FDlgY := Round(int(r.top));\r\n\r\n  FDown := true;\r\n\r\n  if not FCaptured then\r\n  begin\r\n    FCaptured := true;\r\n    FMoveSpan := TJSHTMLElement(document.createElement('SPAN'));\r\n    FMoveSpan.style.setProperty('top', '0');\r\n    FMoveSpan.style.setProperty('left', '0');\r\n    FMoveSpan.style.setProperty('right', '0');\r\n    FMoveSpan.style.setProperty('bottom', '0');\r\n    FMoveSpan.style.setProperty('position', 'absolute');\r\n\r\n    document.body.appendChild(FMoveSpan);\r\n\r\n    EventStopPropagation :=   EventStopPropagation - [eeMouseMove, eeMouseUp];\r\n\r\n    document.body.addEventListener('mousemove', FDocMouseMovePtr);\r\n    document.body.addEventListener('mouseup', FDocMouseUpPtr);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomForm.DoClose(var CloseAction: TCloseAction);\r\nbegin\r\n  if Assigned(FModalProc) and (CloseAction <> caNone) then\r\n  begin\r\n    FModalProc(FModalResult);\r\n    FModalProc := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.DoCreate;\r\nbegin\r\n  BeginUpdate;\r\n  LoadDFMValues;\r\n  Loaded;\r\n\r\n  if Assigned(OnCreate) then\r\n    OnCreate(Self);\r\n\r\n  FCreating := false;\r\n\r\n  EndUpdate;\r\n\r\n  UpdateChildren(Self);\r\n\r\n  Realign;\r\n\r\n  DoResize;\r\nend;\r\n\r\nfunction TCustomForm.HandleScroll(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Assigned(OnScroll) then\r\n    OnScroll(Self);\r\n\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomForm.DoShow;\r\nbegin\r\n  if Assigned(OnShow) then\r\n    OnShow(Self);\r\nend;\r\n\r\nfunction TCustomForm.HandleUnload(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Assigned(OnUnload) then\r\n    OnUnload(Self);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.FormContainerElement: TJSElement;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    if Assigned(FDesignContainer) then\r\n      Result := FDesignContainer\r\n  end;\r\n\r\n  if (FormContainer <> '') then\r\n  begin\r\n    Result := document.getElementById(FormContainer);\r\n    if not Assigned(Result) then\r\n      Result := document.body;\r\n  end\r\n  else\r\n  begin\r\n    Result := document.body;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.HandleLoaded(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  Resize;\r\n  InitAnchoring;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomForm.Realign;\r\nvar\r\n  el: TJSHTMLElement;\r\n  dr: TJSDOMRect;\r\n  r: TRect;\r\nbegin\r\n  if (FFormContainer <> '') and (Align <> alNone) then\r\n  begin\r\n    el := TJSHTMLElement( document.getElementById(FFormContainer) );\r\n    if Assigned(el) then\r\n    begin\r\n      dr := el.getBoundingClientRect;\r\n\r\n      if (dr.width = 0) and (dr.height = 0) and (el.style.getPropertyValue('position') = 'absolute') then\r\n      begin\r\n        r := GetHTMLElementAbsoluteRect(el);\r\n      end\r\n      else\r\n      begin\r\n        r := Rect(Round(dr.left), Round(dr.Top), Round(dr.Right), Round(dr.Bottom));\r\n      end;\r\n\r\n      SetBoundsInt(r.Left, r.Top, r.Right - r.Left, r.Bottom - r.Top);\r\n    end;\r\n  end;\r\n\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomForm.DoResize;\r\nvar\r\n  w,h: integer;\r\nbegin\r\n  w := Width;\r\n  h := Height;\r\n\r\n  if (w = FOldWidth) and (h = FOldHeight) then\r\n    Exit;\r\n\r\n  FOldWidth := w;\r\n  FOldHeight := h;\r\n\r\n  if Assigned(OnResize) then\r\n    OnResize(Self);\r\nend;\r\n\r\ndestructor TCustomForm.Destroy;\r\nbegin\r\n  if Visible then\r\n    Close;\r\n\r\n  if Assigned(OnDestroy) then\r\n    OnDestroy(Self);\r\n\r\n  inherited;\r\n\r\n  if Assigned(FLayer) then\r\n  begin\r\n    if FormContainerElement = FLayer.parentNode then\r\n      FormContainerElement.removeChild(FLayer);\r\n    FLayer := nil;\r\n  end;\r\nend;\r\n\r\nconstructor TCustomForm.Create(id: string);\r\nbegin\r\n  FNoHTML := false;\r\n  FCreating := true;\r\n  FFormContainer := id;\r\n  if id = '' then\r\n    inherited Create(cBodyTag)\r\n  else\r\n    inherited Create(id);\r\n\r\n  FFormElement := '';\r\n  FModalResult := mrNone;\r\n  FFormStyle := fsNormal;\r\n  DoCreate;\r\nend;\r\n\r\nconstructor TCustomForm.Create(id: string; var AReference);\r\nbegin\r\n  FCreating := true;\r\n  FFormContainer := id;\r\n  inherited Create(id);\r\n  AReference := Self;\r\n  FFormElement := '';\r\n  FModalResult := mrNone;\r\n  FFormStyle := fsNormal;\r\n  DoCreate;\r\nend;\r\n\r\nprocedure TCustomForm.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  AllowTouch := True;\r\n  FModalResult := mrNone;\r\n  FFormStyle := fsNormal;\r\n  FBorder := fbSizeable;\r\n  FShadow := true;\r\n  FShowClose := true;\r\n  FTimerID := -1;\r\n  FCaptionElement := nil;\r\n  BeginUpdate;\r\n  Color := clWhite;\r\n  EndUpdate;\r\n  TJSEventTarget(window).addEventListener('load', FLoadedPtr);\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AOwner: TComponent; Dummy: Integer = 0);\r\nbegin\r\n  Create(AOwner);\r\nend;\r\n\r\nconstructor TCustomForm.CreateDialog(ACaption: string);\r\nvar\r\n  AFileName: string;\r\nbegin\r\n  FCreating := true;\r\n  AFileName := GetHTMLFileName;\r\n  inherited Create(cBodyTag);\r\n  Caption := ACaption;\r\n  Popup := true;\r\n  Border := fbDialog;\r\n  FormFileName := AFileName;\r\n  Application.LoadForm(Self, AFileName);\r\nend;\r\n\r\nconstructor TCustomForm.CreateDialogNew(ACaption: string);\r\nvar\r\n  AFileName: string;\r\nbegin\r\n  FNoHTML := true;\r\n  FCreating := true;\r\n  AFileName := GetHTMLFileName;\r\n  inherited Create(cBodyTag);\r\n  Caption := ACaption;\r\n  Popup := true;\r\n  Border := fbDialog;\r\n  FormFileName := AFileName;\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew;\r\nvar\r\n  AFileName: string;\r\nbegin\r\n  FCreating := true;\r\n  AFileName := GetHTMLFileName;\r\n  inherited Create(cBodyTag);\r\n  FormFileName := AFileName;\r\n  if FormFileName <> '' then\r\n    Application.LoadForm(Self, AFileName);\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AFileName: string);\r\nbegin\r\n  FCreating := true;\r\n  inherited Create(cBodyTag);\r\n  FormFileName := AFileName;\r\n  if FormFileName <> '' then\r\n    Application.LoadForm(Self, AFileName);\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AProc: TFormCreatedProc);\r\nbegin\r\n  FCreatedProc := AProc;\r\n  CreateNew;\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AElementID: string; AProc: TFormCreatedProc);\r\nbegin\r\n  CreateNew(AElementID, '', AProc);\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AElementID, AFileName: string; AProc: TFormCreatedProc);\r\nbegin\r\n  FCreating := true;\r\n  FFormContainer := AElementID;\r\n  inherited Create(AElementID);\r\n  FCreatedProc := AProc;\r\n  FFormElement := AElementID;\r\n  if AFileName = '' then\r\n    AFileName := GetHTMLFileName;\r\n\r\n  if AFileName <> '' then\r\n    Application.LoadForm(Self, AFileName)\r\n  else\r\n    if Assigned(FCreatedProc) then\r\n      FCreatedProc(Self);\r\nend;\r\n\r\n{ TApplication }\r\n\r\nfunction TApplication.CreateNewForm(AInstanceClass: TFormClass): TCustomForm;\r\nbegin\r\n  if not Assigned(VSIDE) then\r\n    Result := AInstanceClass.Create(cBodyTag)\r\n  else\r\n    Result := AInstanceClass.Create('');\r\nend;\r\n\r\nfunction TApplication.CreateNewForm(AInstanceClass: TFormClass; AElementID: string): TCustomForm;\r\nvar\r\n  el: TJSHTMLElement;\r\n  AForm: TForm;\r\nbegin\r\n  el := TJSHTMLElement(document.getElementById(AElementID));\r\n\r\n  AForm := AInstanceClass.Create(AElementID);\r\n  AForm.FDesignContainer := el;\r\n  AForm.FormContainer := AElementID;\r\n  AForm.FFormElement := AElementID;\r\n  AForm.CreateControl;\r\n  AForm.Container := el;\r\n  AForm.Init;\r\n\r\n  Result := AForm;\r\nend;\r\n\r\nprocedure TApplication.LoadForm(AForm: TCustomForm; AFormFile: string; FormLoaded: TFormCreatedProc);\r\nbegin\r\n  FCreatedProc := FormLoaded;\r\n  LoadForm(AForm, AFormFile);\r\nend;\r\n\r\nprocedure TApplication.LoadForm(AForm: TCustomForm; AFormFile: string);\r\nbegin\r\n  AForm.FPrevActiveForm := FActiveForm;\r\n\r\n  FActiveForm := AForm;\r\n  FLoadForm := AForm;\r\n\r\n  if FMainForm = nil then\r\n    FMainForm := AForm;\r\n\r\n  FLastReq := TJSXMLHttpRequest.new;\r\n  FLastReq.addEventListener('load', @DoFormLoad);\r\n  FLastReq.addEventListener('abort', @DoFormAbort);\r\n  FLastReq.open('GET', AFormFile);\r\n  FLastReq.send;\r\nend;\r\n\r\nprocedure TApplication.Navigate(const AURL: string; ATarget: TNavigationTarget );\r\nbegin\r\n  if ATarget = ntBlank then\r\n    window.open(AURL, '_blank')\r\n  else\r\n    window.location.href := AURL;\r\nend;\r\n\r\nfunction TApplication.NeedsFormRouting: Boolean;\r\nvar\r\n  s: string;\r\nbegin\r\n  Result := HasQueryParam('form', s);\r\n  if Result then\r\n    RouteForm(s);\r\nend;\r\n\r\nfunction TApplication.ObjectURL(AFile: TJSHTMLFile): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    res = URL.createObjectURL(AFile);\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nprocedure TApplication.CreateFormDirect(AInstanceClass: TFormClass; var AReference);\r\nbegin\r\n  CreateForm(AInstanceClass, FAppContainer, AReference, nil, false);\r\nend;\r\n\r\nprocedure TApplication.CreateFormDirect(AInstanceClass: TDataModuleClass; var AReference);\r\nbegin\r\n  CreateForm(AInstanceClass, AReference);\r\nend;\r\n\r\nprocedure TApplication.CreateFormDirect(AInstanceClass: TFrameClass; var AReference);\r\nbegin\r\n  CreateForm(AInstanceClass, AReference);\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference);\r\nbegin\r\n  CreateForm(AInstanceClass, AElementID, AReference, nil);\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFormClass; AElement: TJSHTMLElement; var AReference); overload;\r\nbegin\r\n  CreateForm(AInstanceClass, AElement.ID, AReference, nil);\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference; AProc: TFormCreatedProc);\r\nbegin\r\n  CreateForm(AInstanceClass, AElementID, AReference, AProc, true);\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference; AProc: TFormCreatedProc; LoadHTML: boolean);\r\nvar\r\n  LFileName: string;\r\n\r\n  function DoStatusCreate(Event: TEventListenerEvent): boolean;\r\n  var\r\n    LElem: TJSHTMLElement;\r\n    LForm: TForm;\r\n    LResponse: string;\r\n    LIsBody: boolean;\r\n    LisLoaded: boolean;\r\n  begin\r\n    LisLoaded := Assigned(Event);\r\n    // HTML of the form being loaded\r\n    if LisLoaded then\r\n    begin\r\n      asm\r\n        LResponse = Event.target.responseText;\r\n      end;\r\n\r\n      LIsBody := LowerCase(AElementID) = cBodyTag;\r\n\r\n      if LIsBody then\r\n        LElem := TJSHTMLElement(document.body)\r\n      else\r\n        LElem := TJSHTMLElement(document.getElementById(AElementID));\r\n\r\n      LElem.innerHTML := LResponse;\r\n    end\r\n    else\r\n    begin\r\n      LElem := TJSHTMLElement(document.body);\r\n    end;\r\n\r\n    LForm := AInstanceClass.Create(AElementID, AReference);\r\n    LForm.FormFileName := LFileName;\r\n\r\n    if LForm.FormContainer = '' then\r\n      LForm.FormContainer := AElementID;\r\n\r\n    if not LIsBody then\r\n    begin\r\n      LForm.FFormElement := AElementID;\r\n      LForm.Container := LElem;\r\n    end;\r\n\r\n    LForm.CreateControl;\r\n    LForm.Init;\r\n\r\n    LForm.SetColorScheme(Application.ColorScheme);\r\n\r\n    // set previous active form\r\n    LForm.FPrevActiveForm := FActiveForm;\r\n\r\n    FActiveForm := LForm;\r\n\r\n    if FMainForm = nil then\r\n      FMainForm := LForm;\r\n\r\n    if Assigned(AProc) then\r\n      AProc(LForm);\r\n\r\n    Result := true;\r\n\r\n    if LisLoaded then\r\n      ActivateChildScripts(LElem);\r\n\r\n    FActiveForm.DoShow;\r\n    // force resize\r\n    FActiveForm.Resize;\r\n  end;\r\n\r\nbegin\r\n  if FIsRedirect then\r\n    Exit;\r\n\r\n  if FAppInitializing then\r\n  begin\r\n    if FCanCreateForm then\r\n      FCanCreateForm := False\r\n    else\r\n      Exit;\r\n  end;\r\n\r\n\r\n  LFileName := AInstanceClass.GetHTMLFileName;\r\n  if (LFileName <> '') and LoadHTML then\r\n  begin\r\n    FLastReq := TJSXMLHttpRequest.new;\r\n    FLastReq.addEventListener('load', @DoStatusCreate);\r\n    FLastReq.open('GET', lFileName);\r\n    {$IFDEF DEBUG}\r\n    FLastReq.setRequestHeader('Cache-Control', 'no-cache');\r\n    {$ENDIF}\r\n    FLastReq.send;\r\n  end\r\n  else\r\n  begin\r\n    DoStatusCreate(nil);\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.ActivateChildScripts(AElement: TJSHTMLElement);\r\nbegin\r\n  // activate possible child scripts\r\n  asm\r\n    function nodeScriptReplace(node) {\r\n            if ( nodeScriptIs(node) === true ) {\r\n                    node.parentNode.replaceChild( nodeScriptClone(node) , node );\r\n            }\r\n            else {\r\n                    var i        = 0;\r\n                    var children = node.childNodes;\r\n                    while ( i < children.length ) {\r\n                            nodeScriptReplace( children[i++] );\r\n                    }\r\n            }\r\n\r\n            return node;\r\n    }\r\n    function nodeScriptIs(node) {\r\n            return node.tagName === 'SCRIPT';\r\n    }\r\n    function nodeScriptClone(node){\r\n            var script  = document.createElement(\"script\");\r\n            script.async = false;\r\n            script.text = node.innerHTML;\r\n            for( var i = node.attributes.length-1; i >= 0; i-- ) {\r\n                    script.setAttribute( node.attributes[i].name, node.attributes[i].value );\r\n            }\r\n            return script;\r\n    }\r\n    nodeScriptReplace(AElement);\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.ReloadForm;\r\nvar\r\n  lFileName: string;\r\n\r\n  function DoStatusCreate(Event: TEventListenerEvent): boolean;\r\n  var\r\n    i: integer;\r\n    ctl: TControl;\r\n    s: string;\r\n    sl: TStringList;\r\n    response: string;\r\n\r\n  begin\r\n    asm\r\n      response = Event.target.responseText;\r\n    end;\r\n\r\n    sl := TStringList.Create;\r\n\r\n    // persist control state\r\n    for i := FActiveForm.ControlCount - 1 downto 0 do\r\n    begin\r\n      ctl := FActiveForm.Controls[i];\r\n      s := ctl.SaveState;\r\n      ctl.ElementHandle.Id := ctl.Name;\r\n      //s := ctl.Name +'='+ctl.ElementHandle.outerHTML;\r\n      s := ctl.Name +'='+ s;\r\n      sl.Add(s);\r\n    end;\r\n\r\n    for i := FActiveForm.ControlCount - 1 downto 0 do\r\n    begin\r\n      ctl := FActiveForm.Controls[i];\r\n      FActiveForm.RemoveComponent(ctl);\r\n      ctl.Free;\r\n    end;\r\n\r\n    FActiveForm.ClearControls;\r\n    FActiveForm.UnbindEvents;\r\n\r\n    // HTML of the form being loaded\r\n    document.body.innerHTML := response;\r\n\r\n    FActiveForm.CreateControl;\r\n    FActiveForm.DoCreate;\r\n    FActiveForm.Init;\r\n\r\n    // persist control state\r\n    for i := FActiveForm.ControlCount - 1 downto 0 do\r\n    begin\r\n      ctl := FActiveForm.Controls[i];  // get controls back after form init\r\n      // get HTML saved for control\r\n      s := sl.Values[ctl.Name];\r\n\r\n      if s <> '' then\r\n        ctl.LoadState(s);\r\n\r\n      //ctl.ElementHandle.outerHTML := s;\r\n      //ctl.Container := document.getElementById(ctl.Name);\r\n      //ctl.BindEvents;\r\n    end;\r\n\r\n    sl.Free;\r\n\r\n    FActiveForm.DoShow;\r\n\r\n    Result := true;\r\n  end;\r\n\r\nbegin\r\n  lFileName := FActiveForm.GetHTMLFileName;\r\n\r\n  FLastReq := TJSXMLHttpRequest.new;\r\n  FLastReq.addEventListener('load', @DoStatusCreate);\r\n  FLastReq.open('GET', lFileName);\r\n  {$IFDEF DEBUG}\r\n  FLastReq.setRequestHeader('Cache-Control', 'no-cache');\r\n  {$ENDIF}\r\n  FLastReq.send;\r\nend;\r\n\r\nfunction TApplication.HasCSS(href:string): boolean;\r\nvar\r\n  els: TJSNodeList;\r\n  i: integer;\r\n  s: string;\r\nbegin\r\n  Result := false;\r\n  els := document.querySelectorAll('head > link');\r\n  for i := 0 to els.length - 1 do\r\n  begin\r\n    s := TJSHTMLLinkElement(els[i]).href;\r\n\r\n    if CompareText(s, href) = 0 then\r\n    begin\r\n      Result := true;\r\n      break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.RemoveCSS(id: string);\r\nvar\r\n  styleElement: TJSElement;\r\nbegin\r\n  styleElement := document.getElementById(id);\r\n  if Assigned(styleElement) then\r\n  begin\r\n    styleElement.parentNode.removeChild(styleElement);\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.RouteForm(AParameter: string);\r\nvar\r\n  frm: TCustomForm;\r\n  fc: TFormClass;\r\nbegin\r\n  fc := TFormClass(GetClass(AParameter));\r\n  Application.CreateForm(fc, frm);\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFormClass; var AReference);\r\nbegin\r\n  CreateForm(AInstanceClass, FAppContainer, AReference, nil);\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TDataModuleClass; var AReference);\r\nvar\r\n  lModule: TDataModule;\r\nbegin\r\n  lModule := AInstanceClass.Create(Self);\r\n  AReference := lModule;\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFrameClass; var AReference);\r\nconst\r\n  cHTMLCode = '<html><head><meta http-equiv=\"Content-type\" content=\"text/html; ' +\r\n    'charset=utf-8\" /><title>TMS Web Project</title><style></style></head>' +\r\n    '<body></body></html>';\r\nvar\r\n  lFrame: TFrame;\r\n  lForm: TFramePreviewForm;\r\nbegin\r\n  lForm := TFramePreviewForm.Create(Application);\r\n  lFrame := AInstanceClass.Create(lForm);\r\n  lForm.FFrame := lFrame;\r\n  lForm.Popup := False;\r\n  AReference := lFrame;\r\n\r\n  Application.FActiveForm := lForm;\r\n  Application.CreateNewForm(lForm, cHTMLCode);\r\nend;\r\n\r\nprocedure TApplication.CreateNewForm(AForm: TCustomForm; HTML: string);\r\nvar\r\n  eh,op,span,childspan,formspan: TJSHTMLElement;\r\n  l,t,w,h: integer;\r\n  LCreatedProc: TFormCreatedProc;\r\n  LCaptionDiv: TJSHTMLElement;\r\n  LCaptionHeight: integer;\r\n  ro: TJSOBject;\r\nbegin\r\n  if FMainForm = nil then\r\n    FMainForm := AForm;\r\n\r\n  span := nil;\r\n  formspan := nil;\r\n  LCaptionHeight := 0;\r\n\r\n  // form hosted in designated container\r\n  if not AForm.Popup and (AForm.FFormElement <> '') then\r\n  begin\r\n    AForm.FLayer := nil;\r\n    eh := TJSHTMLElement(document.getElementById(AForm.FFormElement));\r\n    if Assigned(eh) then\r\n    begin\r\n      eh.innerHTML := HTML;\r\n      if (AForm.ElementClassname = '') then\r\n        eh.style.setProperty(CSSBackground,ColorToHTML(AForm.Color));\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    AForm.ClearControls;\r\n    // transparent mouse blocking layer\r\n    AForm.FLayer := AForm.CreateLayer;\r\n\r\n    document.body.appendChild(AForm.FLayer);\r\n    eh := TJSHTMLElement(AForm.FLayer);\r\n\r\n    // insert opacity layer\r\n    if AForm.Popup and (AForm.PopupOpacity < 1) then\r\n    begin\r\n      op := AForm.CreateLayer;\r\n      op.style.setProperty(CSSBackground, 'black');\r\n      op.style.setProperty('opacity', DoubleToHTML(AForm.PopupOpacity));\r\n      op.style.setProperty(CSSZIndex, Application.MaxZIndexStr);\r\n      eh.appendChild(op);\r\n    end;\r\n\r\n    Application.ChangeMaxZIndex(+1);\r\n\r\n    span := TJSHTMLElement(document.createElement('DIV'));\r\n    // highest z-index but below modal dialog z-index\r\n    span.style.setProperty(CSSZIndex, Application.MaxZIndexStr);\r\n    AForm.FPopupElement := span;\r\n\r\n    if (AForm.Border = fbDialogSizeable) then\r\n    begin\r\n      span.style.setProperty('resize','both');\r\n      span.style.setProperty('overflow','auto');\r\n\r\n      ro := nil;\r\n      asm\r\n        try\r\n        {\r\n        var frm = AForm;\r\n        ro = new ResizeObserver( function(entries)  {\r\n           window.requestAnimationFrame(() => {\r\n              if (!Array.isArray(entries) || !entries.length) {\r\n                return;\r\n              }\r\n           entries.forEach( function(entry) {\r\n             frm.HandleObserver();\r\n             });\r\n             } );\r\n        });\r\n          // Observe the scrollingElement for when the window gets resized\r\n          ro.observe(span);\r\n        }\r\n        catch(err)\r\n        {\r\n          span.style.removeProperty('resize');\r\n          span.style.removeProperty('overflow');\r\n        }\r\n      end;\r\n\r\n      AForm.FResizeObserver := ro;\r\n    end;\r\n\r\n    if AForm.ElementClassName <> '' then\r\n      span.setAttribute('class', AForm.ElementClassName);\r\n\r\n    if AForm.Shadow and AForm.Popup then\r\n      span.style.setProperty('box-shadow','3px 3px 3px silver');\r\n\r\n    eh.appendChild(span);\r\n\r\n    if (AForm.Border in [fbDialog, fbDialogSizeable]) then\r\n    begin\r\n      AForm.GetMethodPointers;\r\n      LCaptionDiv := AForm.CreateCaption;\r\n      span.appendChild(LCaptionDiv);\r\n      childspan := TJSHTMLElement(document.createElement('DIV'));\r\n      childspan.style.setProperty('position','absolute');\r\n      childspan.style.setProperty('width','100%');\r\n//      childspan.style.setProperty('height','100%');\r\n      childspan['id']:= 'childspan';\r\n      span.appendChild(childspan);\r\n      formspan := childspan;\r\n      LCaptionHeight := Application.FormCaptionHeight;\r\n    end\r\n    else\r\n    begin\r\n      formspan := span;\r\n    end;\r\n\r\n    formspan.innerHTML := HTML;\r\n    AForm.Container := formspan;\r\n  end;\r\n\r\n  AForm.Init;\r\n  AForm.LoadDFMValues;\r\n\r\n  if (AForm.Border in [fbDialog, fbDialogSizeable]) and (AForm.ElementCaptionClassName <> '') then\r\n  begin\r\n    LCaptionDiv.ClassList.Add(AForm.ElementCaptionClassName);\r\n    LCaptionDiv.style.removeProperty('background-color');\r\n    LCaptionDiv.style.removeProperty('color');\r\n  end;\r\n\r\n  if Assigned(AForm.FLayer) then\r\n  begin\r\n    // ensure full screen background is white or adopts the form elementclassname when it is not popup\r\n    if not AForm.Popup then\r\n    begin\r\n      if (AForm.ElementClassName = '') then\r\n      begin\r\n        if AForm.Color <> clNone then\r\n          eh.style.setProperty(CSSBackground, ColorToHTML(AForm.Color))\r\n        else\r\n          eh.style.setProperty(CSSBackground, 'white')\r\n      end\r\n      else\r\n      eh.setAttribute('class',AForm.ElementClassName);\r\n    end;\r\n  end;\r\n\r\n  // position popup form centered\r\n  if Assigned(span) and (AForm.FormContainer = '') and AForm.Popup then\r\n  begin\r\n    span.style.setProperty('position', 'absolute');\r\n\r\n    l := max(0,Round((WinWidth - AForm.Width)/2)) + window.scrollX;\r\n    t := max(0,Round((WinHeight - AForm.Height)/2)) + window.scrollY;\r\n\r\n    w := AForm.Width;\r\n    h := AForm.Height + LCaptionHeight;\r\n\r\n    if (AForm.ElementClassName = '') then\r\n    begin\r\n      span.style.setProperty(CSSBackground,ColorToHTML(AForm.Color));\r\n      span.style.setProperty('border','1px Black solid');\r\n    end;\r\n\r\n    span.style.setProperty('top',IntTostr(t)+'px');\r\n    span.style.setProperty('left',IntToStr(l)+'px');\r\n    span.style.setProperty('width',IntToStr(w)+'px');\r\n    span.style.setProperty('height',IntToStr(h)+'px');\r\n  end;\r\n\r\n  if Assigned(formspan) then\r\n    ActivateChildScripts(formspan);\r\n\r\n  if Assigned(AForm.FCreatedProc) then\r\n  begin\r\n    LCreatedProc := AForm.FCreatedProc;\r\n    AForm.FCreatedProc := nil;\r\n    LCreatedProc(AForm);\r\n  end;\r\n\r\n  if Assigned(AForm.OnCreate) then\r\n    AForm.OnCreate(AForm);\r\n\r\n  AForm.Loaded;\r\n  AForm.InitAnchoring;\r\n  AForm.UpdateChildAnchoring;\r\n  AForm.FCreating := false;\r\n  AForm.UpdateElement;\r\n\r\n  if not AForm.EventsBound then\r\n    AForm.BindEvents;\r\n\r\n  AForm.Resize;\r\n  AForm.DoShow;\r\nend;\r\n\r\nfunction TApplication.DoFormLoad(Event: TEventListenerEvent): boolean;\r\nvar\r\n  LResponse: string;\r\nbegin\r\n  asm\r\n    LResponse = Event.target.responseText;\r\n  end;\r\n\r\n  CreateNewForm(FLoadForm, LResponse);\r\n\r\n  if Assigned(FCreatedProc) then\r\n  begin\r\n    FCreatedProc(Self);\r\n    FCreatedProc := nil;\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TApplication.DoHandleError(Event: TJSErrorEvent): boolean;\r\nvar\r\n  err: TApplicationError;\r\n  el,sp,x: TJSHTMLElement;\r\n  msg,s: string;\r\n  isError: boolean;\r\n\r\nbegin\r\n  isError := true;\r\n  \r\n  asm\r\n    if (Event.message == undefined)\r\n    {\r\n      isError = false;\r\n    }\r\n  end;\r\n\r\n  if not isError then\r\n  begin\r\n    err.AMessage := 'Undefined JavaScript exception';\r\n    err.AFile := '';\r\n    err.ALineNumber := 0;\r\n    err.AColNumber := 0;\r\n    err.AError := nil;\r\n\r\n    if Assigned(OnError) then\r\n      OnError(Self, err, Result);\r\n    Exit;\r\n  end;\r\n\r\n  err.AMessage := Event.message;\r\n  err.AFile := Event.filename;\r\n  err.ALineNumber := Event.lineno;\r\n  err.AColNumber := Event.colno;\r\n  err.AError := Event.error;\r\n  err.AStack := '';\r\n\r\n  s := '';\r\n  // try to get stack & RTL exception message\r\n  if Assigned(Event.error) then\r\n  begin\r\n\r\n    asm\r\n      if (Event.error.stack) {\r\n        err.AStack = Event.error.stack;\r\n      }\r\n      if (Event.error.fMessage) {\r\n        err.AMessage = Event.error.fMessage;\r\n      }\r\n    end;\r\n\r\n    asm\r\n      function objToString (obj) {\r\n      var str = '';\r\n      for (var p in obj) {\r\n          if (obj.hasOwnProperty(p)) {\r\n              str += p + '::' + obj[p] + '\\n';\r\n          }\r\n      }\r\n      return str;\r\n      }\r\n      s = objToString(Event.error);\r\n    end;\r\n  end;\r\n\r\n\r\n  Result := false;\r\n\r\n  msg := 'ERROR<br>' + err.AMessage + ' | ' + s + err.AStack + '<BR> at '+err.AFile + ' [' +inttostr(err.ALineNumber)+':'+inttostr(err.AColNumber)+']';\r\n\r\n  case ErrorType of\r\n  aeFooter:\r\n    begin\r\n      el := TJSHTMLElement(document.getElementById('tmserrormessage'));\r\n\r\n      if Assigned(el) then\r\n      begin\r\n        (el.firstChild as TJSHTMLElement).innerHTML := msg;\r\n      end\r\n      else\r\n      begin\r\n        el := TJSHTMLElement(document.createElement('DIV'));\r\n        el.setAttribute('id','tmserrormessage');\r\n        el.style.setProperty('position','absolute');\r\n        el.style.setProperty('font-family','Courier');\r\n        el.style.setProperty('font-size','8pt');\r\n        el.style.setProperty('bottom','0');\r\n        el.style.setProperty('width','100%');\r\n        el.style.setProperty('height','100px');\r\n        el.style.setProperty('background','#ff0000');\r\n        el.style.setProperty('color','#ffffff');\r\n        TJSHTMLElement(document.body).style.setProperty('padding','0');\r\n        TJSHTMLElement(document.body).style.setProperty('margin','0');\r\n        sp := TJSHTMLElement(document.createElement('SPAN'));\r\n        sp.style.setProperty('margin-left','4px');\r\n        sp.style.setProperty('float','left');\r\n        sp.style.setProperty('overflow','hidden');\r\n        sp.style.setProperty('display','block');\r\n        sp.innerHTML := msg;\r\n        el.appendChild(sp);\r\n\r\n        x := TJSHTMLElement(document.createElement('SPAN'));\r\n        x.style.setProperty('font-family','Courier');\r\n        x.style.setProperty('font-size','8pt');\r\n        x.style.setProperty('font-weight','bold');\r\n        x.style.setProperty('position','absolute');\r\n        x.style.setProperty('width','20px');\r\n        x.style.setProperty('vertical-align','top');\r\n        x.style.setProperty('cursor','pointer');\r\n        x.style.setProperty('text-align','right');\r\n        x.style.setProperty('right','4px');\r\n        x.style.setProperty('display','block');\r\n        x.innerHTML := 'X';\r\n        x.onClick := @DoErrorClose;\r\n        el.appendChild(x);\r\n\r\n        document.body.appendChild(el);\r\n      end;\r\n    end;\r\n  aeAlert: window.alert(msg);\r\n  aeDialog:\r\n    begin\r\n        AddControlLink('googlematerial', 'https://fonts.googleapis.com/icon?family=Material+Icons');\r\n      MessageDlg(msg, mtError, [mbOK]);\r\n    end;\r\n  end;\r\n\r\n  if Assigned(OnError) then\r\n    OnError(Self, err, Result);\r\nend;\r\n\r\nfunction TApplication.DoHashChange(Event: TEventListenerEvent): boolean;\r\nvar\r\n  s: string;\r\n  fc: TFormClass;\r\n  frm: TCustomForm;\r\n  bdy: TJSHTMLElement;\r\n  Handled: boolean;\r\n\r\nbegin\r\n  Result := true;\r\n\r\n  if not AutoFormRoute then\r\n    Exit;\r\n\r\n  asm\r\n    s  = location.hash;\r\n  end;\r\n\r\n  // remove hash sign to get class name\r\n  Delete(s,1,1);\r\n\r\n  Handled := false;\r\n\r\n  if Assigned(OnHashChange) then\r\n    OnHashChange(Self, s, Handled);\r\n\r\n  if Handled then\r\n    Exit;\r\n\r\n  if s = '' then\r\n    s := FInitFormClassName;\r\n\r\n  if s <> '' then\r\n  begin\r\n    if FInitFormClassName = '' then\r\n      FInitFormClassName := FActiveForm.ClassName;\r\n\r\n    fc := TFormClass(GetClass(s));\r\n\r\n    if Assigned(fc) then\r\n    begin\r\n      bdy := TJSHTMLElement(document.body);\r\n      CreateForm(fc, bdy, frm);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TApplication.DoUpdateOnlineStatus(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  Result := true;\r\n\r\n  if Assigned(OnOnlineChange) then\r\n  begin\r\n    if window.navigator.onLine then\r\n      OnOnlineChange(Self, osOnline)\r\n    else\r\n      OnOnlineChange(Self, osOffline);\r\n  end;\r\nend;\r\n\r\nfunction TApplication.DoVisibilityChange(Event: TEventListenerEvent): boolean;\r\nvar\r\n  res: boolean;\r\nbegin\r\n  Result := true;\r\n\r\n  res :=  (document.visibilityState = 'visible');\r\n\r\n  if Assigned(OnActivate) then\r\n    OnActivate(Self, res);\r\nend;\r\n\r\nprocedure TApplication.Download(const AURL: string);\r\nbegin\r\n  asm\r\n    window.location.href = AURL;\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.DownloadTextFile(const AText: string; AFileName: string = '');\r\nbegin\r\n  asm\r\n    var element = document.createElement('a');\r\n    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(AText));\r\n    if (AFileName != ''){\r\n      element.setAttribute('download', AFileName);\r\n    }\r\n    element.style.display = 'none';\r\n    document.body.appendChild(element);\r\n    element.click();\r\n    document.body.removeChild(element);\r\n  end;\r\nend;\r\n\r\nfunction TApplication.EXEName: string;\r\nbegin\r\n  Result := window.document.location.href;\r\nend;\r\n\r\nfunction TApplication.GetActive: boolean;\r\nbegin\r\n  Result := not document.hidden;\r\nend;\r\n\r\nfunction TApplication.GetColorScheme: TApplicationColorScheme;\r\nbegin\r\n  Result := csNoScheme;\r\n\r\n  if (window.matchMedia('(prefers-color-scheme)').media <> 'not all') then\r\n  begin\r\n\r\n    if (window.matchMedia('(prefers-color-scheme: dark)').matches) then\r\n      Result := csDark\r\n    else\r\n      Result := csLight;\r\n  end;\r\nend;\r\n\r\nfunction TApplication.IDETheme: string;\r\nvar\r\n  s: string;\r\nbegin\r\n  Result := '';\r\n\r\n  if not Assigned(VSIDE) then\r\n    Exit;\r\n\r\n  asm\r\n    s = pas[\"WEBLib.Forms\"].VSIDE.theme;\r\n  end;\r\n\r\n  Result := s;\r\nend;\r\n\r\nprocedure TApplication.IDEOpenURL(const URL: string);\r\nbegin\r\n  asm\r\n    pas[\"WEBLib.Forms\"].VSIDE.Open(URL);\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.IDEMessage(const Msg: string);\r\nbegin\r\n  asm\r\n    pas[\"WEBLib.Forms\"].VSIDE.ShowMessage(Msg);\r\n  end;\r\nend;\r\n\r\nfunction TApplication.IDECSS: string;\r\nbegin\r\n  Result := '';\r\n  if IDETheme = 'vscode-light' then\r\n  begin\r\n    Result := '.IDECaption { background-color: #F0F0F0 !important; color: #555555 !important; border: 1px solid #DDDDDD !important}'+#13#10+\r\n              '.IDEBkg { background-color: white !important; color: #555555 !important; border: 1px solid #DDDDDD !important}'+#13#10+\r\n              '.IDEButton { background-color: #FAFAFA !important; font-size:10pt; color: #555555 !important; border: 1px solid #DDDDDD !important}'+#13#10+\r\n              '.IDEButton:hover {background-color:#F0F0F0 !important}'+#13#10+\r\n              '.IDEFont {font-size:10pt !important}';\r\n  end;\r\n\r\n  if IDETheme = 'vscode' then\r\n  begin\r\n    Result := '.IDECaption,.IDEButton { background-color: #3F3E43 !important; color: #FFFFFF !important; border: 1px solid #35353A !important}'+#13#10+\r\n              '.IDEBkg { background-color: #2A2A2C !important; color: #A9ACB4 !important; border: 1px solid #35353A !important}'+#13#10+\r\n              '.IDEButton:hover {background-color:#434857 !important}'+#13#10+\r\n              '.IDEFont {font-size:10pt !important}';\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.InternalDownloadFile(const AData: TJSUint8Array; const AFileName, AType: string; const ANewTab: Boolean);\r\nbegin\r\n  asm\r\n    var lElement = document.createElement('a');\r\n    var lBlob = new Blob([AData], {type: AType})\r\n    var lUrl = window.URL.createObjectURL(lBlob);\r\n    lElement.href = lUrl;\r\n    if (AFileName != ''){\r\n      lElement.setAttribute('download', AFileName);\r\n    }\r\n    lElement.style.display = 'none';\r\n    if (ANewTab == true) {\r\n      lElement.target = '_blank';\r\n    }\r\n    document.body.appendChild(lElement);\r\n    lElement.click();\r\n    document.body.removeChild(lElement);\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.DownloadBinaryFile(const AData: TJSBlob; const AFileName: string = ''; const ANewTab: Boolean = False);\r\nbegin\r\n  asm\r\n    var lElement = document.createElement('a');\r\n    var lUrl = window.URL.createObjectURL(AData);\r\n    lElement.href = lUrl;\r\n\r\n    if (AFileName != ''){\r\n      lElement.setAttribute('download', AFileName);\r\n    }\r\n\r\n    lElement.style.display = 'none';\r\n    if (ANewTab == true) {\r\n      lElement.target = '_blank';\r\n    }\r\n    document.body.appendChild(lElement);\r\n    lElement.click();\r\n    document.body.removeChild(lElement);\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.DownloadBinaryFile(const AData: TBytes; const AFileName: string; const ANewTab: Boolean);\r\nbegin\r\n  DownloadBinaryFile(TJSUint8Array.from(AData), AFileName, ANewTab);\r\nend;\r\n\r\nprocedure TApplication.DownloadBinaryFile(const AData: TJSUint8Array; const AFileName: string; const ANewTab: Boolean);\r\nbegin\r\n  InternalDownloadFile(AData, AFileName, 'octet/stream', ANewTab);\r\nend;\r\n\r\nprocedure TApplication.DownloadPDFFile(const AData: TBytes; const AFileName: string; const ANewTab: Boolean);\r\nbegin\r\n  DownloadPDFFile(TJSUint8Array.from(AData), AFileName, ANewTab);\r\nend;\r\n\r\nprocedure TApplication.DownloadPDFFile(const AData: TJSUint8Array; const AFileName: string; const ANewTab: Boolean);\r\nbegin\r\n  InternalDownloadFile(AData, AFileName, 'application/pdf', ANewTab);\r\nend;\r\n\r\nfunction TApplication.GetAuthorizationPageHTML(const AAuthorizationSuccess: Boolean): string;\r\nconst\r\n  sExternalBrowserAuthorizationOK = '<div class=\"text2\">Application succesfully authorized</div>You can close this browser window';\r\n  sExternalBrowserAuthorizationFailed = '<div class=\"text2\">Application authorization failed</div><br/>Please try again.';\r\n  LB = #13#10;\r\n\r\n  ImageFail = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeA'+\r\n  'AAACXBIWXMAAA7DAAAOwwHHb6hkAAABtElEQVR4nO2bUY7CMAxEhz0NB+EgrDjXCg6yB+E4+9NKCAiN'+\r\n  '7XHcjf1+ED+Z6ahNHScFiqIoBNwvp+v9crpG+3hG6+sgFQFwXv7ejj+/31JBDyy+ugN4ElkJD8Hqqyu'+\r\n  'AhohYjA3D12YAGyIiMSYsXx8D6BTpFmPB9NUMQCjSJcaA7ettAEqRTTErHr5eAjCKfBSz4OXryzhgiz'+\r\n  'OzWCJd/Fs8HoFHzHeCtxf2JNgt3MMID8zXoMpAtDarEDIbidJklMJUQ6MDty6GNDSNRdxtluWwhReDU'+\r\n  'fONKADAx2jkZCsOAOAaXn4pY2let6oAAN/qTIG61lAHAOwmBFO1aQoACA/BXGqbAwDCQqCsOCkBAMND'+\r\n  'oC23aQEAw0Kg9hqoAQDuIdAbLfQAALcQXFptLgEA9BDc+oxeLbF/Qz0C7AFTT4KpX4OpC6HUpXDqxVD'+\r\n  'q5fBOLn5lbEMkdUssdVM0dVs89cZI6q2x1JujqbfHUx+Q2MPFj/LidUqsKajB05NXS4y6Zl/GurHGe6'+\r\n  'QOSpLF5jgqqxSb67C0UGzO4/KdYnN/MLEhluOTmYZY+MWvDPU122dzRVHk5g+X6Lw5aVkK9AAAAABJRU5ErkJggg==';\r\n\r\n  ImageSuccess = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaX'+\r\n  'HeAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACC0lEQVR4nO2Zv3GDMBSHv+QyQEbICM4EOW+Q9BS4o2QTU'+\r\n  '9LZBQNkg6zgETyCR0iRkOMIAv3Xk0+/zsiI931nI3iCkpKSkpKSkpKSkpJ7SDN0x2bo3nW//xCymNhp'+\r\n  'hu4E1MAN2PdVe9k6524ETODHXIHXvmpva+c9BqwpWhbgAV6Ar61zsxeggB+z+x1XJmsBG/Bj6mboWtV'+\r\n  'gtvcATfhpPvqq/ZwfzFKABTwoVobsBFjCj7kyWxmyugc4wsPCypCNAA/wY/L7C3iEP/dVe5geEC8gJD'+\r\n  'wIFxAaHgQLiAEPQgXEggeBAmLCgzABseFBkIAU8CBEQCp4ECAgJTwYChibCzYXWpmv9jCVFTwYCJgVa'+\r\n  '31BxXwucapFS4CiWOsLS4EHDQEbxRoXIAkeNgRoFqtdiDR4WBFgWOxmQRLhQdEQsSi2bobuqBqUCg8L'+\r\n  'vwDHYg991Z49zjeNd3iYCfBU7J8E6fAAT7PPOw9znpqhA3hDODz8F7Dnp2vqKmJ1O8ogQeFh+R7wjB8'+\r\n  'JrgkOD4plUICEKPCw/hyQSkI0eNh+EowtISo86L0LxJIQHR703wZDS0gCD2b9gFASksGDeUfIt4Sk8G'+\r\n  'DRE/QoITk8WDZFPUgQAQ8OXWEHCWLgwbEtbiFBFDx42BcwkCAOHjxtjGhIEAkPHneGViSIhQfPW2MLE'+\r\n  'kTDQ4C9wYmEi3T4kpKSkm+5ax+YhPsUTQAAAABJRU5ErkJggg==';\r\n\r\n  PlaceHolderImage = '#PLACEHOLDERIMAGE#';\r\n  PlaceHolderText = '#PLACEHOLDERTEXT#';\r\n  PlaceHolderColor = '#PLACEHOLDERCOLOR#';\r\n\r\n  AuthHTMLTemplate =\r\n  '<!doctype html>'+LB+\r\n  '<html lang=\"en\">'+LB+\r\n  '<head>'+LB+\r\n  '  <title>Authentication Result</title>'+LB+\r\n  '  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">'+LB+\r\n  '</head>'+LB+\r\n  '<body>'+LB+\r\n  '<style>'+LB+\r\n  '  hr'+LB+\r\n  '  {'+LB+\r\n  '    border: none;'+LB+\r\n  '    height: 1px;'+LB+\r\n  '    background-color: rgb(171, 171, 171);'+LB+\r\n  '  }'+LB+\r\n  '  div.container'+LB+\r\n  '  {'+LB+\r\n  '    position: fixed;'+LB+\r\n  '    font-family: Arial;'+LB+\r\n  '    font-size: 12pt;'+LB+\r\n  '    max-width: 100%;'+LB+\r\n  '    max-height: 100%;'+LB+\r\n  '    top: 50%;'+LB+\r\n  '    left: 50%;'+LB+\r\n  '    transform: translate(-50%, -50%);'+LB+\r\n  '  }'+LB+\r\n  '  div.section'+LB+\r\n  '  {'+LB+\r\n  '    display: inline-block;'+LB+\r\n  '    margin: 15px;'+LB+\r\n  '    padding: 5px;'+LB+\r\n  '    float: left;'+LB+\r\n  '  }'+LB+\r\n  '  div.image img'+LB+\r\n  '  {'+LB+\r\n  '    height: 100%;'+LB+\r\n  '  }'+LB+\r\n  '  div.text'+LB+\r\n  '  {'+LB+\r\n  '    padding-top: 15px;'+LB+\r\n  '  }'+LB+\r\n  '  div.text2'+LB+\r\n  '  {'+LB+\r\n  '    font-size: 18pt;'+LB+\r\n  '    color: #PLACEHOLDERCOLOR#;'+LB+\r\n  '  }'+LB+\r\n  '  span.title'+LB+\r\n  '  {'+LB+\r\n  '    font-size: 26px;'+LB+\r\n  '  }'+LB+\r\n  '</style>'+LB+\r\n  '  <div class=\"container\">'+LB+\r\n  '  <div class=\"section image\">'+LB+\r\n  '    <img src=\"#PLACEHOLDERIMAGE#\">'+LB+\r\n  '  </div>'+LB+\r\n  '  <div class=\"section text\">'+LB+\r\n  '  #PLACEHOLDERTEXT#'+LB+\r\n  '  </div>'+LB+\r\n  '  </div>'+LB+\r\n  ' </body>'+LB+\r\n  '</html>';\r\n\r\n  function ReplacePlaceHolders(APlaceHolders: array of string; APlaceHolderValues: array of string): string;\r\n  var\r\n    I: Integer;\r\n    s: string;\r\n  begin\r\n    s := AuthHTMLTemplate;\r\n    for I := 0 to Length(APlaceHolders) - 1 do\r\n      s := StringReplace(s, APlaceHolders[I], APlaceHolderValues[I], [rfReplaceAll]);\r\n\r\n    Result := s;\r\n  end;\r\n\r\nbegin\r\n  if AAuthorizationSuccess then\r\n    Result := ReplacePlaceHolders([PlaceHolderImage, PlaceHolderText, PlaceHolderColor], [ImageSuccess, sExternalBrowserAuthorizationOK, 'rgb(104, 164, 144)'])\r\n  else\r\n    Result := ReplacePlaceHolders([PlaceHolderImage, PlaceHolderText, PlaceHolderColor], [ImageFail, sExternalBrowserAuthorizationFailed, 'rgb(216, 99, 68)']);\r\nend;\r\n\r\nfunction TApplication.GetFormExtension: string;\r\nbegin\r\n  if Language <> lNone then\r\n    Result := '_' + GetLanguageISO639_1Code(Language) + cHTMLExt\r\n  else\r\n    Result := cHTMLExt;\r\nend;\r\n\r\nfunction TApplication.GetIsOnline: boolean;\r\nbegin\r\n  Result := window.navigator.onLine;\r\nend;\r\n\r\nfunction TApplication.GetIsPWA: boolean;\r\nvar\r\n  pwa: boolean;\r\nbegin\r\n  asm\r\n    pwa = ('standalone' in window.navigator) && (window.navigator.standalone);\r\n  end;\r\n\r\n  Result := pwa;\r\nend;\r\n\r\nfunction TApplication.GetIsMobile: boolean;\r\nvar\r\n  mob: boolean;\r\nbegin\r\n  asm\r\n    function TestMobile() {\r\n      var check = false;\r\n     (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);\r\n     return check;\r\n     };\r\n\r\n    mob = TestMobile();\r\n  end;\r\n\r\n  Result := mob;\r\nend;\r\n\r\n{$IFDEF SINGLEINSTANCE}\r\nprocedure TApplication.DoGetDataReceived(Sender: TObject; Origin: string;\r\n  Data: TJSObjectRecord);\r\nbegin\r\n  if Data.jsobject.toString = '#reload' then\r\n  begin\r\n    asm\r\n      location.reload();\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.DoGetConnected(Sender: TObject);\r\nvar\r\n  url,agent:string;\r\nbegin\r\n  url := window.location.href;\r\n  agent := window.navigator.useragent;\r\n\r\n  if Pos('Edg', agent) > 0 then\r\n    agent := 'Edge'\r\n  else if Pos('Opera', agent) > 0 then\r\n    agent := 'Opera'\r\n  else if Pos('OPR', agent) > 0 then\r\n    agent := 'Opera'\r\n  else if Pos('Chrome', agent) > 0 then\r\n    agent := 'Chrome'\r\n  else if Pos('Safari', agent) > 0 then\r\n    agent := 'Safari'\r\n  else if Pos('Firefox', agent) > 0 then\r\n    agent := 'Firefox'\r\n  else if Pos('Trident', agent) > 0 then\r\n    agent := 'MSIE'\r\n  else\r\n    agent := '';\r\n\r\n  FWebSocket.Send(url + ';' + agent);\r\nend;\r\n{$ENDIF}\r\n\r\nfunction TApplication.DoErrorClose(Event: TJSMouseEvent): boolean;\r\nbegin\r\n  document.body.removeChild(Event.targetElement.parentElement);\r\n  Result := true;\r\nend;\r\n\r\nfunction TApplication.DoFormAbort(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  ShowMessage('Failed to load form HTML template file');\r\n  Result := true;\r\nend;\r\n\r\nprocedure TApplication.TriggerNotification;\r\nbegin\r\n  {$IFDEF FREEWARE}\r\n  if FNotifyCount = 0 then\r\n  begin\r\n    {$IFDEF TMS}\r\n    asm\r\n      alert('TMS WEB Core \\u00A9 2018 - 2021 tmssoftware.com - Trial Version');\r\n    end;\r\n    {$ENDIF}\r\n    {$IFNDEF TMS}\r\n    asm\r\n      alert('Application created with an unlicensed trial version of software');\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\n  inc(FNotifyCount);\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TApplication.InitFormatSettings(const BrowserLocale: string);\r\nvar\r\n  timestr: string;\r\n  i: integer;\r\n  locale: string;\r\nbegin\r\n  locale := BrowserLocale;\r\n\r\n  FormatSettings.ShortDateFormat := GetLocaleShortDateFormat(locale);\r\n\r\n  if (Pos('/',FormatSettings.ShortDateFormat) > 0) then\r\n    FormatSettings.DateSeparator := '/';\r\n\r\n  if (Pos('.',FormatSettings.ShortDateFormat) > 0) then\r\n    FormatSettings.DateSeparator := '.';\r\n\r\n  if (Pos('-',FormatSettings.ShortDateFormat) > 0) then\r\n    FormatSettings.DateSeparator := '-';\r\n\r\n  asm\r\n    var event = new Date('Jan 1, 1980 06:07:08 GMT+00:00');\r\n    var loc = \"\";\r\n    if (locale == \"\") { loc = navigator.language; } else\r\n    { loc = locale; }\r\n    timestr = event.toLocaleTimeString(loc);\r\n  end;\r\n\r\n  if pos(':',timestr) > 0 then\r\n    FormatSettings.TimeSeparator := ':';\r\n\r\n  if pos('.',timestr) > 0 then\r\n    FormatSettings.TimeSeparator := '.';\r\n\r\n  if pos('-',timestr) > 0 then\r\n    FormatSettings.TimeSeparator := '-';\r\n\r\n  for i := 1 to 7 do\r\n  begin\r\n    FormatSettings.ShortDayNames[i] := GetLocaleShortDayName(i,locale);\r\n    FormatSettings.LongDayNames[i] := GetLocaleLongDayName(i,locale);\r\n  end;\r\n\r\n  for i := 1 to 12 do\r\n  begin\r\n    FormatSettings.ShortMonthNames[i] := GetLocaleShortMonthName(i,locale);\r\n    FormatSettings.LongMonthNames[i] := GetLocaleLongMonthName(i,locale);\r\n  end;\r\n\r\n  FormatSettings.DecimalSeparator := GetLocaleDecimalSeparator;\r\n\r\n  if FormatSettings.DecimalSeparator = '.' then\r\n    FormatSettings.ThousandSeparator := ','\r\n  else\r\n    FormatSettings.ThousandSeparator := '.';\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TApplication.Initialize;\r\nvar\r\n  query, token: string;\r\n  p: Integer;\r\n  b: Boolean;\r\nbegin\r\n  FCanCreateForm := True;\r\n  FAppInitializing := True;\r\n  FParameters.Clear;\r\n  query := window.location.href;\r\n\r\n  InitFormatSettings(GetBrowserLocale);\r\n\r\n  FParameters.Delimiter := '&';\r\n  FParameters.StrictDelimiter := true;\r\n  p := Pos('?', query);\r\n  if p > 0 then\r\n    query := Copy(query, p + 1, Length(query));\r\n  FParameters.DelimitedText := query;\r\n\r\n  asm\r\n    b = (window.name == \"Authentication\");\r\n  end;\r\n\r\n  if Assigned(OnOAuthCallBack) then\r\n  begin\r\n    if (FParameters.IndexOfName('oauthcallback') <> -1) or b then\r\n    begin\r\n      OnOauthCallBack(Self, query);\r\n\r\n      FIsRedirect := true;\r\n      document.body.innerHTML := GetAuthorizationPageHTML(True);\r\n      Exit;\r\n    end;\r\n  end;\r\n\r\n  if Assigned(OnOAuthToken) then\r\n  begin\r\n    if FParameters.IndexOfName('code') <> -1 then\r\n    begin\r\n      OnOauthToken(Self, query);\r\n\r\n      FIsRedirect := true;\r\n      token := FParameters.Values['code'];\r\n      asm\r\n        if (window.opener && window.opener.processAuthData){\r\n          window.opener.processAuthData(token);\r\n          window.close();\r\n        }\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  window.addEventListener('hashchange',@DoHashChange);\r\n  window.addEventListener('online',  @DoUpdateOnlineStatus);\r\n  window.addEventListener('offline', @DoUpdateOnlineStatus);\r\n  document.addEventListener('visibilitychange', @DoVisibilityChange);\r\n\r\n  if (window.opener <> nil) then\r\n    if (FParameters.IndexOfName('access_token') <> -1) then\r\n    begin\r\n      FIsRedirect := true;\r\n      token := FParameters.Values['access_token'];\r\n      asm\r\n        if (window.opener && window.opener.processAuthData){\r\n          window.opener.processAuthData(token);\r\n        \twindow.close();\r\n        }\r\n      end;\r\n    end;\r\nend;\r\n\r\nprocedure TApplication.InsertCSS(id, href: string);\r\nvar\r\n  styleElement: TJSElement;\r\nbegin\r\n\r\n  styleElement := document.getElementById(id);\r\n  if Assigned(styleElement) then\r\n  begin\r\n    asm\r\n      styleElement.href = href;\r\n    end;\r\n    Exit;\r\n  end;\r\n\r\n  styleElement := document.createElement('link');\r\n  styleElement.id := id;\r\n\r\n  asm\r\n    styleElement.rel = 'stylesheet';\r\n    styleElement.href = href;\r\n  end;\r\n\r\n  document.getElementsByTagName('head')[0].appendChild(styleElement);\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nprocedure TApplication.Run;\r\nbegin\r\n  FCanCreateForm := True;\r\n  FAppInitializing := False;\r\nend;\r\n\r\nprocedure TApplication.RunScript(Source: string);\r\nbegin\r\n  asm\r\n    eval(Source);\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.ReceiveMessageFromClient(const AMessage: string);\r\nbegin\r\n  if Assigned(FClientConnector) then\r\n    FClientConnector.Receive(AMessage);\r\nend;\r\n\r\nprocedure TApplication.ChangeLanguage(const Value: TUILanguage);\r\nbegin\r\n  FLanguage := Value;\r\n  if Assigned(FMainForm) then\r\n    ReloadForm;\r\nend;\r\n\r\nprocedure TApplication.SetLanguage(const Value: TUILanguage);\r\nbegin\r\n  FLanguage := Value;\r\nend;\r\n\r\nprocedure TApplication.ChangeCSS(id, href: string);\r\nbegin\r\n  asm\r\n    var styleElement = document.getElementById(id);\r\n    if (styleElement) {\r\n      styleElement.href = href;\r\n      return;\r\n    }\r\n  end;\r\nend;\r\n\r\nfunction TApplication.MaxZIndexStr: string;\r\nbegin\r\n  Result := IntToStr(FMaxZIndex);\r\nend;\r\n\r\nprocedure TApplication.ChangeMaxZIndex(Delta: integer);\r\nbegin\r\n  FMaxZIndex := FMaxZIndex + Delta;\r\nend;\r\n\r\nconstructor TApplication.Create(AOwner: TComponent);\r\n{$IFDEF HOTRELOAD}\r\nconst\r\n  cDefPollInterval = 1000;\r\n  cDefFileName = 'TMSHotreloadVersion.json';\r\n  {$ENDIF}\r\nbegin\r\n  FFormStack := TList.Create;\r\n  FParameters := TStringList.Create;\r\n  FAppContainer := cBodyTag;\r\n  FMainForm := nil;\r\n  FActiveForm := nil;\r\n  FInitFormClassName := '';\r\n  FIsRedirect := false;\r\n  FAutoFormRoute := false;\r\n  FThemed := false;\r\n  FThemeColor := clTMSBlue;\r\n  FThemeTextColor := clWhite;\r\n  FFormCaptionHeight := 22;\r\n  FMaxZIndex := 999998;\r\n  FHintPause := 200;\r\n  FHintHidePause := 250;\r\n  FHintPosition := hpTop;\r\n  FHintClassName := '';\r\n  {$IFDEF FREEWARE}\r\n  FNotifyCount := 0;\r\n  {$ENDIF}\r\n  {$IFDEF HOTRELOAD}\r\n  FHotReloadPollInterval := cDefPollInterval;\r\n  FHotReloadFile := cDefFileName;\r\n  StartHotReload;\r\n  {$ENDIF}\r\n  {$IFDEF SINGLEINSTANCE}\r\n  FWebSocket := TSocketClient.Create(Self);\r\n  FWebSocket.Port := DefaultPort;\r\n  FWebSocket.OnDataReceived := @DoGetDataReceived;\r\n  FWebSocket.OnConnect := @DoGetConnected;\r\n  FWebSocket.Connect;\r\n  {$ENDIF}\r\n\r\n  window.addEventListener('error', @DoHandleError);\r\n  window.addEventListener('unhandledrejection', @DoHandleError);\r\n\r\n  FErrorType := aeSilent;\r\n  {$IFDEF DEBUG}\r\n  FErrorType := aeFooter;\r\n  {$ENDIF}\r\n\r\n  //TriggerNotification;\r\nend;\r\n\r\ndestructor TApplication.Destroy;\r\nbegin\r\n  {$IFDEF HOTRELOAD}\r\n  StopHotReload;\r\n  {$ENDIF}\r\n  {$IFDEF SINGLEINSTANCE}\r\n  FWebSocket.Free;\r\n  {$ENDIF}\r\n  FFormStack.Free;\r\n  FParameters.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TApplication.LockForm(AForm: TCustomForm);\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to AForm.ControlCount - 1 do\r\n  begin\r\n    AForm.Controls[i].DisableTab;\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.UnLockForm(AForm: TCustomForm);\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to AForm.ControlCount - 1 do\r\n  begin\r\n    AForm.Controls[i].EnableTab;\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.PushForm(AForm: TCustomForm);\r\nvar\r\n  i: integer;\r\nbegin\r\n  // persist all control settings in HTML to be saved\r\n  for i := 0 to AForm.ControlCount - 1 do\r\n  begin\r\n    AForm.Controls[i].PersistInHTML;\r\n  end;\r\n\r\n  // save with form\r\n  AForm.FormContent := document.body.innerHTML;\r\n\r\n  for i := 0 to AForm.ControlCount - 1 do\r\n  begin\r\n    AForm.Controls[i].DisableTab;\r\n  end;\r\n\r\n  FFormStack.Add(AForm);\r\nend;\r\n\r\nfunction TApplication.PopForm: TCustomForm;\r\nvar\r\n  i: integer;\r\n  frm: string;\r\nbegin\r\n  if (FFormStack.Count > 0) then\r\n  begin\r\n    Result := TCustomForm(FFormStack.Items[FFormStack.Count - 1]);\r\n    frm := Result.FormContent;\r\n    FFormStack.Delete(FFormStack.Count - 1);\r\n\r\n    // restore document\r\n    document.body.innerHTML := frm;\r\n\r\n    Result.InitFromHTML;\r\n\r\n    // rebind form events\r\n    Result.BindEvents;\r\n\r\n    // rehook controls\r\n    for i := 0 to Result.ControlCount - 1 do\r\n      Result.Controls[i].HookElement;\r\n\r\n    for i := 0 to Result.ControlCount - 1 do\r\n    begin\r\n      Result.Controls[i].RecreateCanvas;\r\n      Result.Controls[i].InternalResize;\r\n    end;\r\n\r\n    Application.FActiveForm := Result;\r\n  end;\r\nend;\r\n\r\nfunction TApplication.Version: string;\r\nbegin\r\n  Result := WEBCOREVERSION;\r\nend;\r\n\r\n{$IFDEF HOTRELOAD}\r\nprocedure TApplication.OnHotReloadTick;\r\nconst\r\n  cMethodLoad = 'load';\r\n  cMethodAbort = 'abort';\r\n  cMethodGet = 'GET';\r\n  cDeli = '/';\r\nvar\r\n  lReq: TJSXMLHttpRequest;\r\n  lBuffer: string;\r\nbegin\r\n  if FHotReloadReq <> nil then\r\n    Exit;\r\n\r\n  lReq := TJSXMLHttpRequest.New;\r\n  lReq.AddEventListener(cMethodLoad, @OnHotReloadLoad);\r\n  lReq.AddEventListener(cMethodAbort, @OnHotReloadAbort);\r\n  lBuffer := window.document.location.href;\r\n  lBuffer := TPath.GetDirectoryName(lBuffer);\r\n  lBuffer := lBuffer + cDeli + FHotReloadFile;\r\n  lReq.Open(cMethodGet, lBuffer);\r\n  lReq.setRequestHeader('Cache-Control', 'no-cache, no-store, must-revalidate');\r\n  lReq.Send;\r\n  FHotReloadReq := lReq;\r\nend;\r\n\r\nfunction TApplication.OnHotReloadAbort(AEvent: TEventListenerEvent): Boolean;\r\nbegin\r\n  FHotReloadReq := nil;\r\n  Result := False;\r\nend;\r\n\r\nfunction TApplication.OnHotReloadLoad(AEvent: TEventListenerEvent): Boolean;\r\nvar\r\n  lData: TJSObject;\r\nbegin\r\n  try\r\n    lData := TJSJSON.parseObject(FHotReloadReq.responseText);\r\n    HandleHotReload(lData);\r\n  except\r\n    console.error('Error parsing Hotreload JSON: '+ FHotReloadReq.responseText);\r\n  end;\r\n  FHotReloadReq := nil;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TApplication.HandleHotReload(const AData: TJSObject);\r\nconst\r\n  cAttributeVersion = 'version';\r\nvar\r\n  lVersion: JSValue;\r\nbegin\r\n  lVersion := AData[cAttributeVersion];\r\n  if FHotReloadVersion = 0 then\r\n  begin\r\n    FHotReloadVersion := Integer(lVersion);\r\n    Exit;\r\n  end;\r\n\r\n  if Integer(lVersion) > FHotReloadVersion then\r\n  begin\r\n    FHotReloadVersion := Integer(lVersion);\r\n    window.location.reload(false);\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.StartHotReload;\r\nbegin\r\n  if FHotReloadTimer = 0 then\r\n    FHotReloadTimer := Window.setInterval(@OnHotReloadTick, FHotReloadPollInterval);\r\nend;\r\n\r\nprocedure TApplication.StopHotReload;\r\nbegin\r\n  if FHotReloadTimer <> 0 then\r\n  begin\r\n    Window.ClearInterval(FHotReloadTimer);\r\n    FHotReloadTimer := 0;\r\n  end;\r\nend;\r\n\r\n{$ENDIF}\r\n\r\n{ TCustomFrame }\r\n\r\nconstructor TCustomFrame.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner);\r\n  FConstraints := TSizeConstraints.Create(Self);\r\n  //FTouchManager := TTouchManager.Create(Self);\r\nend;\r\n\r\nconstructor TCustomFrame.CreateNew(AOwner: TComponent);\r\nbegin\r\n  Create(AOwner);\r\n  BeforeLoadDFMValues;\r\n  try\r\n    LoadFromForm;\r\n  finally\r\n    AfterLoadDFMValues;\r\n  end;\r\nend;\r\n\r\ndestructor TCustomFrame.Destroy;\r\nbegin\r\n  FConstraints.Free;\r\n  //FTouchManager.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TCustomFrame.LoadDFMValues;\r\nbegin\r\nend;\r\n\r\nprocedure TCustomFrame.LoadFromForm;\r\nbegin\r\n  LoadDFMValues;\r\nend;\r\n\r\nprocedure TCustomFrame.UpdateElement;\r\nvar\r\n  nocolor: boolean;\r\nbegin\r\n  inherited;\r\n\r\n  nocolor := Color in [clBtnFace, clNone, clWhite, clWindow];\r\n\r\n  if Assigned(ElementHandle) and not IsUpdating and (csDesigning in ComponentState) and nocolor then\r\n  begin\r\n    ElementHandle.style.setProperty('background-color',ColorToHTML($F0F0F0));\r\n  end;\r\nend;\r\n\r\nprocedure TCustomFrame.SetConstraints(const AValue: TSizeConstraints);\r\nbegin\r\n  FConstraints.Assign(AValue);\r\nend;\r\n\r\nprocedure TCustomFrame.SetPopupMenu(AValue: TPopupMenu);\r\nbegin\r\n  FPopupMenu := AValue;\r\nend;\r\n\r\n//procedure TCustomFrame.SetTouchManager(AValue: TTouchManager);\r\n//begin\r\n//  FTouchManager.Assign(AValue);\r\n//end;\r\n\r\n{ TCustomSizeConstraints }\r\n\r\nconstructor TCustomSizeConstraints.Create(AControl: TControl);\r\nbegin\r\n  inherited Create;\r\n  FControl := AControl;\r\nend;\r\n\r\nprocedure TCustomSizeConstraints.AssignTo(ADest: TPersistent);\r\nbegin\r\n  if ADest is TCustomSizeConstraints then\r\n  begin\r\n    with TCustomSizeConstraints(ADest) do\r\n    begin\r\n      FMinHeight := Self.FMinHeight;\r\n      FMaxHeight := Self.FMaxHeight;\r\n      FMinWidth := Self.FMinWidth;\r\n      FMaxWidth := Self.FMaxWidth;\r\n      Change;\r\n    end;\r\n   end\r\n  else\r\n    inherited AssignTo(ADest);\r\nend;\r\n\r\nprocedure TCustomSizeConstraints.SetConstraints(AIndex: Integer; AValue: TConstraintSize);\r\nbegin\r\n  case AIndex of\r\n    0:\r\n      if AValue <> FMaxHeight then\r\n      begin\r\n        FMaxHeight := AValue;\r\n//        if not FControl.FIScaling then\r\n        begin\r\n          if (AValue > 0) and (AValue < FMinHeight) then\r\n            FMinHeight := AValue;\r\n          Change;\r\n        end;\r\n      end;\r\n    1:\r\n      if AValue <> FMaxWidth then\r\n      begin\r\n        FMaxWidth := AValue;\r\n//        if not FControl.FIScaling then\r\n        begin\r\n          if (AValue > 0) and (AValue < FMinWidth) then\r\n            FMinWidth := AValue;\r\n          Change;\r\n        end;\r\n      end;\r\n    2:\r\n      if AValue <> FMinHeight then\r\n      begin\r\n        FMinHeight := AValue;\r\n//        if not FControl.FIScaling then\r\n        begin\r\n          if (FMaxHeight > 0) and (AValue > FMaxHeight) then\r\n            FMaxHeight := AValue;\r\n          Change;\r\n        end;\r\n      end;\r\n    3:\r\n      if AValue <> FMinWidth then\r\n      begin\r\n        FMinWidth := AValue;\r\n //       if not FControl.FIScaling then\r\n        begin\r\n          if (FMaxWidth > 0) and (AValue > FMaxWidth) then\r\n            FMaxWidth := AValue;\r\n          Change;\r\n        end;\r\n      end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomSizeConstraints.Change;\r\nbegin\r\n  if Assigned(FOnChange) then\r\n    FOnChange(Self);\r\nend;\r\n\r\n{ TDragDockObject }\r\n\r\nconstructor TDragDockObject.Create(AControl: TControl);\r\nbegin\r\n  inherited Create;\r\n  FBrush := TBrush.Create;\r\nend;\r\n\r\ndestructor TDragDockObject.Destroy;\r\nbegin\r\n  FBrush.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TDragDockObject.Assign(Source: TDragObject);\r\nbegin\r\nend;\r\n\r\nprocedure TFramePreviewForm.LoadDFMValues;\r\nbegin\r\n  inherited LoadDFMValues;\r\n\r\n  FFrame.SetParentComponent(Self);\r\n  FFrame.LoadFromForm;\r\n  FFrame.BeforeLoadDFMValues;\r\n  try\r\n    FFrame.Name := 'Frame1';\r\n    FFrame.Left := 0;\r\n    FFrame.Top := 0;\r\n    FFrame.Width := 640;\r\n    FFrame.Height := 480;\r\n  finally\r\n    FFrame.AfterLoadDFMValues;\r\n  end;\r\n\r\n  Name := 'Form1';\r\n  Left := 0;\r\n  Top := 0;\r\n  Width := 640;\r\n  Height := 480;\r\nend;\r\n\r\n\r\ninitialization\r\nbegin\r\n  HandShakeScript := TJSHTMLScriptElement(document.createElement('script'));\r\n  HandShakeScript.id := 'HandShakeScript';\r\n  HandShakeScript.type_ := 'text/javascript';\r\n  HandShakeScript.innerHTML :=\r\n  'var IDE = null;'+#13#10+\r\n  'var TMSWEBCoreClientIdentifier = \"unknown\";'+#13#10+\r\n  'var TMSWEBCoreOAuthCallback = \"unknown\";'+#13#10+\r\n  'function HandShake(cid){'+#13#10+\r\n  '  TMSWEBCoreClientIdentifier = cid;'+#13#10+\r\n  '}';\r\n  document.body.appendChild(HandShakeScript);\r\n\r\n  Application := TApplication.Create(nil);\r\nend;\r\n\r\nend.\r\n\r\n\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2022                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.StdCtrls;\r\n\r\n{$DEFINE NOPP}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Controls, SysUtils, Web, WEBLib.Graphics, Types, WEBlib.WebTools,\r\n  WEBLib.Forms, WEBLib.Menus;\r\n\r\ntype\r\n  Single = Double;\r\n  TEditCharCase = (wecLowerCase, wecNormal, wecMixedCase, wecUpperCase);\r\n  TCheckBoxState = (cbChecked, cbGrayed, cbUnchecked);\r\n  TDateTimeKind = (dtkDate, dtkTime);\r\n  TEllipsisPosition = (epEndEllipsis, epNone, epPathEllipsis, epWordEllipsis);\r\n  TTextLayout = (tlTop, tlCenter, tlBottom);\r\n  TSysLinkType = (sltID, sltURL);\r\n\r\n  TAutoCompletion = (acOff,acHonorificPrefix, acGivenName, acAdditionalName, acFamilyName, acHonorificSuffix,\r\n    acNickName, acEmail, acUserName, acNewPassword, acCurrentPassword, acOrganizationTitle, acOrganization,\r\n    acStreetAddress, acAddressLine1, acAddressLine2, acAddressLine3, acAddressLevel1, acAddressLevel2,\r\n    acAddressLevel3, acAddressLevel4, acCountry, acCountryName, acPostalCode, acCCName, acCCGivenName,\r\n    acCCAdditionalName, acCCFamilyName, acCCNumber, acExpiry, acExpiryMonth, acExpiryYear, acCSC,\r\n    acType, acTransactionCurrency, acTransactionAmount, acLanguage, acBirthday, acBirthdayDay,\r\n    acBirthDayMonth, acBirthDayYear, acSex, acTelephone, acTelephoneCountryCode, acTelephoneNational,\r\n    acTelephoneAreaCode, acTelephoneLocal, acTelephoneExtension, acIMPP, acURL, acPhoto, acNone, acNope);\r\n\r\n  TEditType = (weString, weFloat, weHex, weNumeric, weSignedFloat, weSignedNumeric, weSearch);\r\n\r\n  THTMLType = (tLABELTAG, tSPAN, tDIV, tH1,tH2, tH3, tH4, tH5, tH6, tP);\r\n\r\n  TLinkClickEvent = procedure(Sender: TObject; Link: string; LinkType: TSysLinkType) of object;\r\n\r\n  TCustomLabel = class(TWebCustomControl)\r\n  private\r\n    FContent: TJSElement;\r\n    FAutoSize: boolean;\r\n    FEllipsisPosition: TEllipsisPosition;\r\n    FWordWrap: Boolean;\r\n    FAlignment: TAlignment;\r\n    FLayout: TTextLayout;\r\n    FTransparent: boolean;\r\n    FHTMLType: THTMLType;\r\n    FFocusControl: TWinControl;\r\n    FShowAccelChar: boolean;\r\n    FColor: TColor;\r\n    FHasAccel: boolean;\r\n    FHasHTML: boolean;\r\n    FElementLabelClassName: TElementClassName;\r\n    FOrigWidth: integer;\r\n    FOldWidth, FOldHeight: integer;\r\n    FHTML: string;\r\n    procedure SetLayout(const Value: TTextLayout);\r\n    procedure SetAlignment(const Value: TAlignment);\r\n    function GetContentHandle: TJSHTMLElement;\r\n    procedure SetTransparent(const Value: boolean);\r\n    procedure SetHTMLType(const Value: THTMLType);\r\n    procedure SetColorEx(const Value: TColor);\r\n    procedure SetElementLabelClassName(const Value: TElementClassName);\r\n    procedure SetHTML(const Value: string);\r\n  protected\r\n    procedure SetWidth(AValue: Integer); override;\r\n    function CreateElement: TJSElement; override;\r\n    function CreateLabelElement: TJSElement; virtual;\r\n    function GetDisplayText: string; virtual;\r\n    function CanShowFocus: boolean; override;\r\n    procedure SetParent(AValue: TControl); override;\r\n    procedure BindElement; override;\r\n    procedure Loaded; override;\r\n    procedure UpdateAutoSize; virtual;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure UpdateElementSize; override;\r\n    procedure SetAutoSize(AValue: boolean);\r\n    procedure SetCaption(const AValue: string); override;\r\n    procedure SetControlCursor(const Value: TCursor); override;\r\n    procedure SetEllipsisPosition(AValue: TEllipsisPosition);\r\n    property ContentHandle: TJSHTMLElement read GetContentHandle;\r\n    property Alignment: TAlignment read FAlignment write SetAlignment default taLeftJustify;\r\n    property AutoSize: boolean read FAutoSize write SetAutoSize default true;\r\n    property ElementLabelClassName: TElementClassName read FElementLabelClassName write SetElementLabelClassName;\r\n    property EllipsisPosition: TEllipsisPosition read FEllipsisPosition write SetEllipsisPosition default epNone;\r\n    property FocusControl: TWinControl read FFocusControl write FFocusControl;\r\n    property Layout: TTextLayout read FLayout write SetLayout default tlTop;\r\n    property ShowAccelChar: boolean read FShowAccelChar write FShowAccelChar default true;\r\n    property Transparent: boolean read FTransparent write SetTransparent default true;\r\n    property WordWrap: Boolean read FWordWrap write FWordWrap default false;\r\n    property HTML: string read FHTML write SetHTML;\r\n    property HTMLType: THTMLType read FHTMLType write SetHTMLType default tLABELTAG;\r\n    property Color: TColor read FColor write SetColorEx default clWhite;\r\n\r\n    function GetWidth: Integer; override;\r\n    function GetHeight: Integer; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  end;\r\n\r\n  TLabel = class(TCustomLabel)\r\n  published\r\n    property Align;\r\n    property Alignment;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize;\r\n    property Caption;\r\n    property ChildOrder;\r\n    property Color;\r\n    property DragMode;\r\n    property EllipsisPosition;\r\n    property Enabled;\r\n    property ElementClassName;\r\n    property ElementLabelClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property FocusControl;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property HTML;\r\n    property HTMLType;\r\n    property Layout;\r\n    property Left;\r\n    property Margins;\r\n    property ParentFont;\r\n    property PopupMenu;\r\n    property ShowAccelChar;\r\n    property ShowHint;\r\n    property TextDirection;\r\n    property Top;\r\n    property Transparent;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property WordWrap;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnTouchStart;\r\n    property OnTouchEnd;\r\n    property OnTouchMove;\r\n    property OnTouchCancel;\r\n    property OnDragOver;\r\n    property OnDragDrop;\r\n    property OnStartDrag;\r\n    property OnEndDrag;\r\n  end;\r\n\r\n  TWebLabel = class(TLabel);\r\n\r\n  TCustomInput = class(TWebCustomControl)\r\n  private\r\n  protected\r\n    function IsInputControl: Boolean; override;\r\n    function GetInputType: string; virtual;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure LoadState(AState: string); override;\r\n    function SaveState: string; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  end;\r\n\r\n  TCustomEdit = class(TCustomInput)\r\n  private\r\n    FCharCase: TEditCharCase;\r\n    FMaxLength: integer;\r\n    FReadOnly: Boolean;\r\n    FText: string;\r\n    FTextHint: string;\r\n    FSelStart: Integer;\r\n    FAlignment: TAlignment;\r\n    FHideSelection: Boolean;\r\n    FPasswordChar: Char;\r\n    FOnChange: TNotifyEvent;\r\n    FAutoSize: Boolean;\r\n    FAutoSelect: Boolean;\r\n    FSelLength: Integer;\r\n    FNumeric: Boolean;\r\n    FAutoCompletion: TAutoCompletion;\r\n    FEditType: TEditType;\r\n    FRequired: Boolean;\r\n    FAutoFocus: boolean;\r\n    FPattern: string;\r\n    FHandlePastePtr: pointer;\r\n    FHandleCutPtr: pointer;\r\n    FHandleChangePtr: pointer;\r\n    FHandleInvalidPtr: pointer;\r\n    FSpellCheck: boolean;\r\n    FRequiredText: string;\r\n    procedure SetAlignment(const Value: TAlignment);\r\n    procedure SetHideSelection(const Value: Boolean);\r\n    procedure SetAutoSelect(const Value: Boolean);\r\n    procedure SetAutoSize(const Value: Boolean);\r\n    procedure SetSelLength(const Value: Integer);\r\n    procedure SetSelStart(const Value: Integer);\r\n    procedure SetPasswordChar(const Value: Char);\r\n    procedure SetNumeric(const Value: Boolean);\r\n    procedure SetAutoCompletion(const Value: TAutoCompletion);\r\n    procedure SetAutoFocus(const Value: boolean);\r\n    procedure SetRequired(const Value: Boolean);\r\n    procedure SetPattern(const Value: string);\r\n    function GetSelLength: Integer;\r\n    function GetSelStart: Integer;\r\n    procedure SetEditType(const Value: TEditType);\r\n    function GetSelText: string;\r\n    procedure SetSpellCheck(const Value: boolean);\r\n  protected\r\n    function GetElementInputHandle: TJSHTMLInputElement; virtual;\r\n    function DoHandlePaste(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleCut(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleInvalid(Event: TJSEvent): Boolean; virtual;\r\n    function IsCustomEditor: Boolean; virtual;\r\n    procedure KeyPress(var Key: Char); override;\r\n    function GetInputType: string; override;\r\n    procedure PersistinHTML; override;\r\n    function GetText: string;\r\n    function GetDisplayText: string; virtual;\r\n    function IsReadOnly: boolean; virtual;\r\n    function Validate(AValue: string): boolean; virtual;\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n    procedure BindEvents; override;\r\n    procedure UnBindEvents; override;\r\n    procedure UpdateElementData; override;\r\n    procedure SetCharCase(AValue: TEditCharCase); virtual;\r\n    procedure SetMaxLength(AValue: integer);\r\n    procedure SetReadOnly(AValue: boolean);\r\n    procedure SetText(AValue: string);\r\n    procedure SetTextHint(AValue: string);\r\n    function CanPaste(AValue: string): boolean; virtual;\r\n    function CanCut: boolean; virtual;\r\n    property Font;\r\n    property AutoCompletion: TAutoCompletion read FAutoCompletion write SetAutoCompletion default acOff;\r\n    property AutoFocus: boolean read FAutoFocus write SetAutoFocus default false;\r\n    property Color;\r\n    property BorderStyle;\r\n    property HideSelection: Boolean read FHideSelection write SetHideSelection;\r\n    property CharCase: TEditCharCase read FCharCase write SetCharCase default wecNormal;\r\n    property MaxLength: integer read FMaxLength write SetMaxLength default 0;\r\n    property Numeric: Boolean read FNumeric write SetNumeric default false;\r\n    property PasswordChar: Char read FPasswordChar write SetPasswordChar default #0;\r\n    property Pattern: string read FPattern write SetPattern;\r\n    property ReadOnly: Boolean read FReadOnly write SetReadOnly default false;\r\n    property Required: Boolean read FRequired write SetRequired default false;\r\n    property RequiredText: string read FRequiredText write FRequiredText;\r\n    property Text: string read GetText write SetText;\r\n    property TextHint: string read FTextHint write SetTextHint;\r\n    property AutoSize: Boolean read FAutoSize write SetAutoSize default false;\r\n    property AutoSelect: Boolean read FAutoSelect write SetAutoSelect default false;\r\n    property Alignment: TAlignment read FAlignment write SetAlignment;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property SelStart: Integer read GetSelStart write SetSelStart;\r\n    property SelLength: Integer read GetSelLength write SetSelLength;\r\n    procedure Clear;\r\n    procedure ClearSelection;\r\n    procedure Change; virtual;\r\n    procedure SelectAll;\r\n    procedure SetSelection(ASelStart, ASelLength: integer);\r\n    property SelText: string read GetSelText;\r\n    property SpellCheck: boolean read FSpellCheck write SetSpellCheck default true;\r\n    property EditType: TEditType read FEditType write SetEditType default weString;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n  end;\r\n\r\n  TEdit = class(TCustomEdit)\r\n  published\r\n    property Alignment;\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoCompletion;\r\n    property AutoFocus;\r\n    property AutoSize;\r\n    property AutoSelect;\r\n    property BiDiMode;\r\n    property BorderStyle;\r\n    property CharCase;\r\n    property ChildOrder;\r\n    property Color;\r\n    property DragMode;\r\n    property EditType;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property HideSelection;\r\n    property Left;\r\n    property ParentFont;\r\n    property PasswordChar;\r\n    property Pattern;\r\n    property Margins;\r\n    property MaxLength;\r\n    property PopupMenu;\r\n    property ReadOnly;\r\n    property Required;\r\n    property RequiredText;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property SpellCheck;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property TextDirection;\r\n    property TextHint;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebEdit = class(TEdit);\r\n\r\n  TSpinEdit = class(TCustomInput)\r\n  private\r\n    FIncrement: integer;\r\n    FMaxValue: integer;\r\n    FMinValue: integer;\r\n    FValue: integer;\r\n    FAutoSize: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    FReadOnly: boolean;\r\n    FHandleChangePtr: pointer;\r\n    FHandleInvalidPtr: pointer;\r\n    FRequiredText: string;\r\n    FRequired: Boolean;\r\n    function GetText: string;\r\n    procedure SetText(const Value: string);\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n    procedure SetReadOnly(const Value: boolean);\r\n    procedure SetRequired(const Value: Boolean);\r\n  protected\r\n    procedure KeyPress(var Key: Char); override;\r\n    procedure PersistinHTML; override;\r\n    function GetInputType: string; override;\r\n    procedure UpdateElementData; override;\r\n    function GetValue: integer;\r\n    procedure SetIncrement(AValue: integer);\r\n    procedure SetMaxValue(AValue: integer);\r\n    procedure SetMinValue(AValue: integer);\r\n    procedure SetValue(AValue: integer);\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    function DoHandleInvalid(Event: TJSEvent): Boolean; virtual;\r\n    function IsReadOnly: boolean; virtual;\r\n    function GetDisplayText: string; virtual;\r\n    procedure BindEvents; override;\r\n    procedure UnBindEvents; override;\r\n    procedure Change; virtual;\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n    property Text: string read GetText write SetText;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize: Boolean read FAutoSize write FAutoSize;\r\n    property BiDiMode;\r\n    property BorderStyle;\r\n    property ChildOrder;\r\n    property Color;\r\n    property DragMode;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Increment: integer read FIncrement write SetIncrement;\r\n    property Left;\r\n    property Margins;\r\n    property MaxValue: integer read FMaxValue write SetMaxValue default 100;\r\n    property MinValue: integer read FMinValue write SetMinValue default 0;\r\n    property ParentFont;\r\n    property ReadOnly: boolean read FReadOnly write SetReadOnly default false;\r\n    property Required: Boolean read FRequired write SetRequired default false;\r\n    property RequiredText: string read FRequiredText write FRequiredText;\r\n    property Role;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabStop;\r\n    property TabOrder;\r\n    property TextDirection;\r\n    property Value: integer read GetValue write SetValue;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebSpinEdit = class(TSpinEdit);\r\n\r\n  TDateTimePicker = class(TCustomInput)\r\n  private\r\n    FDate: TDate;\r\n    FTime: TTime;\r\n    FKind: TDateTimeKind;\r\n    FOnChange: TNotifyEvent;\r\n    FReadOnly: Boolean;\r\n    FElementCheck: TJSHTMLElement;\r\n    FElementPicker: TJSHTMLElement;\r\n    FShowCheckBox: boolean;\r\n    FClickPtr: pointer;\r\n    FHandleChangePtr: pointer;\r\n    FFocusPtr: pointer;\r\n    FBlurPtr: pointer;\r\n    FChecked: boolean;\r\n    FShowSeconds: boolean;\r\n    FAutoDropDown: boolean;\r\n    procedure SetDate(AValue: TDate);\r\n    function GetDate: TDate;\r\n    procedure SetTime(AValue: TTime);\r\n    function GetTime: TTime;\r\n    procedure SetKind(AValue: TDateTimeKind);\r\n    procedure SetText(const Value: String);\r\n    function GetText: String;\r\n    procedure SetReadOnly(const Value: boolean);\r\n    procedure SetShowCheckBox(const Value: boolean);\r\n    procedure SetChecked(const Value: boolean);\r\n    function GetDateTime: TDateTime;\r\n    procedure SetDateTime(const Value: TDateTime);\r\n    procedure SetShowSeconds(const Value: boolean);\r\n  protected\r\n    function DoCheckClick(Event: TEventListenerEvent): Boolean;\r\n    function DoPickerFocus(Event: TEventListenerEvent): Boolean;\r\n    function DoPickerBlur(Event: TEventListenerEvent): Boolean;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    function HandleDoEnter(Event: TJSFocusEvent): Boolean; override;\r\n    function GetElementBindHandle: TJSEventTarget; override;\r\n    procedure BindEvents; override;\r\n    procedure UnBindEvents; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    function CreateElement: TJSElement; override;\r\n    function GetInputType: string; override;\r\n    procedure Change; virtual;\r\n    function IsReadOnly: boolean; virtual;\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n    function GetElementPicker: TJSHTMLElement;\r\n    procedure SetEnabled(Value: Boolean); override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure Clear;\r\n    property DateTime: TDateTime read GetDateTime write SetDateTime;\r\n    procedure SetFocus; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoDropDown: boolean read FAutoDropDown write FAutoDropDown default false;\r\n    property BorderStyle;\r\n    property Checked: boolean read FChecked write SetChecked default false;\r\n    property ChildOrder;\r\n    property Color;\r\n    property Date: TDate read GetDate write SetDate;\r\n    property DragMode;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Kind: TDateTimeKind read FKind write SetKind;\r\n    property Left;\r\n    property Margins;\r\n    property ParentFont;\r\n    property ReadOnly: boolean read FReadOnly write SetReadOnly default false;\r\n    property Role;\r\n    property ShowCheckBox: boolean read FShowCheckBox write SetShowCheckBox default false;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property ShowSeconds: boolean read FShowSeconds write SetShowSeconds default true;\r\n    property TabStop;\r\n    property TabOrder;\r\n    property Text: String read GetText write SetText;\r\n    property TextDirection;\r\n    property Time: TTime read GetTime write SetTime;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebDateTimePicker = class(TDateTimePicker);\r\n\r\n  TButton = class(TWebCustomControl)\r\n  private\r\n    FModalResult: TModalResult;\r\n    FDefault: Boolean;\r\n    FCancel: Boolean;\r\n    FButtonType: string;\r\n    procedure SetButtonType(const Value: string);\r\n    procedure SetDefault(const Value: Boolean);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetCaption(const AValue: string); override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property ModalResult: TModalResult read FModalResult write FModalResult;\r\n    property Cancel: Boolean read FCancel write FCancel;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BiDiMode;\r\n    property BorderStyle;\r\n    property ButtonType: string read FButtonType write SetButtonType;\r\n    property Caption;\r\n    property ChildOrder;\r\n    property Color;\r\n    property Default: Boolean read FDefault write SetDefault;\r\n    property DragMode;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Left;\r\n    property Margins;\r\n    property PopupMenu;\r\n    property Role;\r\n    property ParentFont;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property TextDirection;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebButton = class(TButton);\r\n\r\n  TCheckBox = class(TWebCustomControl)\r\n  private\r\n    FChecked: boolean;\r\n    FState: TCheckBoxState;\r\n    FElementButtonClassName: TElementClassName;\r\n    FElementLabelClassName: TElementClassName;\r\n    FOnCheckClick: TNotifyEvent;\r\n  protected\r\n    procedure Loaded; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementSize; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure PersistinHTML; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetChecked(AValue: boolean);\r\n    function GetChecked: boolean;\r\n    procedure SetState(AValue: TCheckBoxState);\r\n    function GetState: TCheckBoxState;\r\n    procedure SetCaption(const AValue: string); override;\r\n    procedure SetEnabled(Value: boolean); override;\r\n    function HandleLabelClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleCheckClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    procedure Click; override;\r\n    procedure DoCheckClick; virtual;\r\n    function GetCheckElement: TJSHTMLElement;\r\n    procedure KeyPress(var ch: char); override;\r\n    procedure LoadState(AState: string); override;\r\n    function SaveState: string; override;\r\n    property OnCheckClick: TNotifyEvent read FOnCheckClick write FOnCheckClick;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Caption;\r\n    property Checked: boolean read GetChecked write SetChecked default False;\r\n    property ChildOrder;\r\n    property Color default clNone;\r\n    property DragMode;\r\n    property ElementClassName;\r\n    property ElementButtonClassName: TElementClassName read FElementButtonClassName write FElementButtonClassName;\r\n    property ElementLabelClassName: TElementClassName read FElementLabelClassName write FElementLabelClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Left;\r\n    property Margins;\r\n    property ParentFont;\r\n    property PopupMenu;\r\n    property Role;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property State: TCheckBoxState read GetState write SetState;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebCheckBox = class(TCheckBox);\r\n\r\n  TRadioButton = class(TWebCustomControl)\r\n  private\r\n    FChecked: boolean;\r\n    FGroupName: string;\r\n    FElementButtonClassName: TElementClassName;\r\n    FElementLabelClassName: TElementClassName;\r\n  protected\r\n    procedure PersistInHTML; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetChecked(AValue: boolean);\r\n    function GetChecked: boolean;\r\n    procedure SetEnabled(Value: boolean); override;\r\n    procedure SetCaption(const AValue: string); override;\r\n    procedure SetGroupName(AValue: string);\r\n    function HandleLabelClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleRadioClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    procedure UpdateElementSize; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    function GetRadioElement: TJSHTMLElement;\r\n    procedure Keypress(var ch: Char); override;\r\n    procedure LoadState(AState: string); override;\r\n    function SaveState: string; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Caption;\r\n    property Checked: boolean read GetChecked write SetChecked default false;\r\n    property ChildOrder;\r\n    property Color default clNone;\r\n    property DragMode;\r\n    property ElementClassName;\r\n    property ElementButtonClassName: TElementClassName read FElementButtonClassName write FElementButtonClassName;\r\n    property ElementLabelClassName: TElementClassName read FElementLabelClassName write FElementLabelClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property GroupName: string read FGroupName write SetGroupName;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Left;\r\n    property ParentFont;\r\n    property PopupMenu;\r\n    property Role;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebRadioButton = class(TRadioButton);\r\n\r\n  TListBox = class(TWebCustomControl)\r\n  private\r\n    FItems: TStrings;\r\n    FItemIndex: integer;\r\n    FMultiSelect: boolean;\r\n    FSelected: TList;\r\n    FItemHeight: Integer;\r\n    FSorted: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    FHandleChangePtr: pointer;\r\n    FElementItemClassName: string;\r\n    procedure SetItemHeight(const Value: Integer);\r\n    procedure SetSorted(const Value: Boolean);\r\n    function GetCount: Integer;\r\n    function GetElementSelectHandle: TJSHTMLSelectElement;\r\n    function GetSelCount: integer;\r\n  protected\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    procedure DoItemsChange(Sender: TObject);\r\n    procedure DoUpdateList; virtual;\r\n    procedure PersistinHTML; override;\r\n    function GetItemIndex: integer; virtual;\r\n    function CreateElement: TJSElement; override;\r\n    function GetSelected(AIndex: integer): boolean;\r\n    procedure SetSelected(AIndex: Integer; AValue: boolean);\r\n    procedure SetItems(AItems: TStrings);\r\n    procedure SetItemIndex(AIndex: integer); virtual;\r\n    procedure SetMultiSelect(AValue: boolean);\r\n    procedure Loaded; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure UpdateParent; override;\r\n    procedure BindEvents; override;\r\n    procedure UnBindEvents; override;\r\n    procedure Change; virtual;\r\n    function SaveState: string; override;\r\n    procedure LoadState(AState: string); override;\r\n    procedure EnableDrag; override;\r\n    procedure DisableDrag; override;\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure EndUpdate; override;\r\n    procedure ClearSelection;\r\n    procedure SelectAll;\r\n    property Sorted: Boolean read FSorted write SetSorted;\r\n    property Count: Integer read GetCount;\r\n    property SelCount: integer read GetSelCount;\r\n    property ElementSelectHandle: TJSHTMLSelectElement read GetElementSelectHandle;\r\n    procedure AddItem(Item: string; AObject: TObject);\r\n    property Selected[i: Integer]: boolean read GetSelected write SetSelected;\r\n    procedure Clear;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BiDiMode;\r\n    property BorderStyle;\r\n    property ChildOrder;\r\n    property Color;\r\n    property DragMode;\r\n    property Font;\r\n    property ElementClassName;\r\n    property ElementItemClassName: string read FElementItemClassName write FElementItemClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property ItemHeight: Integer read FItemHeight write SetItemHeight;\r\n    property ItemIndex: integer read GetItemIndex write SetItemIndex default -1;\r\n    property Items: TStrings read FItems write SetItems;\r\n    property Left;\r\n    property MultiSelect: boolean read FMultiSelect write SetMultiSelect;\r\n    property ParentColor;\r\n    property ParentFont;\r\n    property PopupMenu;\r\n    property Role;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property TextDirection;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnMouseWheel;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebListBox = class(TListBox);\r\n\r\n  TComboBoxStyle = (csDropDownList, csDropDown);\r\n\r\n  TCustomComboBox = class(TWebCustomControl)\r\n  private\r\n    FItems: TStrings;\r\n    FItemIndex: integer;\r\n    FStyle: TComboBoxStyle;\r\n    FDroppedDown: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    FTextHint: string;\r\n    FListName: string;\r\n    FText: string;\r\n    FHandleChangePtr: pointer;\r\n    FHandleInputPtr: pointer;\r\n    FHandleFocusInPtr: pointer;\r\n    FHandleFocusOutPtr: pointer;\r\n    FOnFocusOut: TNotifyEvent;\r\n    FOnFocusIn: TNotifyEvent;\r\n    function GetText: string;\r\n    procedure SetText(const Value: string);\r\n    procedure SetStyle(const Value: TComboBoxStyle);\r\n    procedure SetDroppedDown(const Value: Boolean);\r\n    function GetElementSelectHandle: TJSHTMLSelectElement;\r\n    procedure SetTextHint(const Value: string);\r\n  protected\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleInput(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleFocusIn(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleFocusOut(Event: TEventListenerEvent): Boolean; virtual;\r\n    procedure DoItemsChange(Sender: TObject);\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n    procedure AddTextHint; virtual;\r\n    procedure DoUpdateList; virtual;\r\n    procedure LoadState(AState: string); override;\r\n    function SaveState: string; override;\r\n    function GetItemIndex: integer;\r\n    function CreateElement: TJSElement; override;\r\n    procedure BindEvents; override;\r\n    procedure UnBindEvents; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateParent; override;\r\n    procedure SetItems(AItems: TStrings);\r\n    procedure SetItemIndex(AIndex: integer);\r\n    procedure Loaded; override;\r\n    procedure Change; virtual;\r\n    procedure PersistinHTML; override;\r\n    property Items: TStrings read FItems write SetItems;\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property BiDiMode;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property ItemIndex: integer read GetItemIndex write SetItemIndex default -1;\r\n    property Left;\r\n    property PopupMenu;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text: string read GetText write SetText;\r\n    property TextHint: string read FTextHint write SetTextHint;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnFocusIn: TNotifyEvent read FOnFocusIn write FOnFocusIn;\r\n    property OnFocusOut: TNotifyEvent read FOnFocusOut write FOnFocusOut;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnMouseWheel;\r\n    property OnEnter;\r\n    property OnExit;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Clear;\r\n    procedure AddItem(Item: string; AObject: TObject);\r\n    property ElementSelectHandle: TJSHTMLSelectElement read GetElementSelectHandle;\r\n    property Style: TComboBoxStyle read FStyle write SetStyle;\r\n    property DroppedDown: Boolean read FDroppedDown write SetDroppedDown;\r\n  end;\r\n\r\n  TComboBox = class(TCustomComboBox)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BiDiMode;\r\n    property ChildOrder;\r\n    property Color;\r\n    property DragMode;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property ItemIndex;\r\n    property Items;\r\n    property Left;\r\n    property ParentFont;\r\n    property Role;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property Style;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property TextDirection;\r\n    property TextHint;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebComboBox = class(TComboBox);\r\n\r\n  TFontPicker = class(TCustomComboBox)\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property Items;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property ItemIndex;\r\n    property Left;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebFontPicker = class(TFontPicker);\r\n\r\n  TFontSizePickerMode = (fmPointSize, fmRelativeSize);\r\n\r\n  TFontSizePicker = class(TCustomComboBox)\r\n  private\r\n    FPickerMode: TFontSizePickerMode;\r\n    procedure SetPickerMode(const AValue: TFontSizePickerMode);\r\n  protected\r\n    procedure Init; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property Items;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property ItemIndex;\r\n    property Left;\r\n    property PickerMode: TFontSizePickerMode read FPickerMode write SetPickerMode;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TLineSpacingPicker = class(TCustomComboBox)\r\n  private\r\n  protected\r\n    procedure CreateInitialize; override;\r\n  public\r\n    property Items;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property ItemIndex;\r\n    property Left;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n\r\n  TWebFontSizePicker = class(TFontSizePicker);\r\n\r\n  TCaretPosition = TPoint;\r\n\r\n  TCustomMemo = class(TWebCustomControl)\r\n  private\r\n    FWordWrap: Boolean;\r\n    FBlockChange: Boolean;\r\n    FLines: TStrings;\r\n    FSelStart: Integer;\r\n    FSelLength: Integer;\r\n    FCaretPosition: TCaretPosition;\r\n    FAutoSize: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    FReadOnly: boolean;\r\n    FTextHint: string;\r\n    FHandleChangePtr: pointer;\r\n    FHandlePastePtr: pointer;\r\n    FHandleCutPtr: pointer;\r\n    FHandleInputPtr: pointer;\r\n    FWantTabs: boolean;\r\n    FAutoCompletion: TAutoCompletion;\r\n    FSpellCheck: boolean;\r\n    FModified: boolean;\r\n    function GetText: String;\r\n    procedure SetText(const Value: String);\r\n    procedure SetSelLength(const Value: Integer);\r\n    procedure SetSelStart(const Value: Integer);\r\n    procedure SetAutoSize(const Value: Boolean);\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n    procedure SetReadOnly(const Value: boolean);\r\n    function GetSelLength: Integer;\r\n    function GetSelStart: Integer;\r\n    procedure SetTextHint(const Value: string);\r\n    procedure SetAutoCompletion(const Value: TAutoCompletion);\r\n    procedure SetSpellCheck(const Value: boolean);\r\n    procedure SetWantTabs(const Value: boolean);\r\n    procedure SetWordWrap(const Value: Boolean);\r\n  protected\r\n    function IsInputControl: Boolean; override;\r\n    function HandleDoKeyDown(Event: TJSKeyBoardEvent): Boolean; override;\r\n    function CreateElement: TJSElement; override;\r\n    function DoHandlePaste(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleCut(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleInput(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean; virtual;\r\n    function IsReadOnly: boolean; virtual;\r\n    procedure PersistinHTML; override;\r\n    function GetDisplayText: string; virtual;\r\n    procedure BindEvents; override;\r\n    procedure UnBindEvents; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure SetLines(ALines: TStrings);\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n    procedure DoLinesChange(Sender: TObject);\r\n    function CanPaste(AValue: string): boolean; virtual;\r\n    function CanCut: boolean; virtual;\r\n    function SaveState: string; override;\r\n    procedure LoadState(AState: string); override;\r\n    property Font;\r\n    property Color;\r\n    property BorderStyle;\r\n    property AutoSize: Boolean read FAutoSize write SetAutoSize;\r\n    property Lines: TStrings read FLines write SetLines;\r\n    property ReadOnly: boolean read FReadOnly write SetReadOnly;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    procedure Change; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Clear;\r\n    property AutoCompletion: TAutoCompletion read FAutoCompletion write SetAutoCompletion default acOff;\r\n    property CaretPosition: TCaretPosition read FCaretPosition write FCaretPosition;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n    property Modified: boolean read FModified write FModified;\r\n    property SelStart: Integer read GetSelStart write SetSelStart;\r\n    property SelLength: Integer read GetSelLength write SetSelLength;\r\n    property Spellcheck: boolean read FSpellCheck write SetSpellCheck default true;\r\n    property Text: String read GetText write SetText;\r\n    property TextHint: string read FTextHint write SetTextHint;\r\n    property WantTabs: boolean read FWantTabs write SetWantTabs default false;\r\n    property WordWrap: Boolean read FWordWrap write SetWordWrap default true;\r\n  end;\r\n\r\n  TMemo = class(TCustomMemo)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize;\r\n    property BiDiMode;\r\n    property BorderStyle;\r\n    property ChildOrder;\r\n    property Color;\r\n    property DragMode;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Left;\r\n    property Lines;\r\n    property Margins;\r\n    property ParentColor;\r\n    property ParentFont;\r\n    property PopupMenu;\r\n    property ReadOnly;\r\n    property Role;\r\n    property SelStart;\r\n    property SelLength;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property SpellCheck;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property TextDirection;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnMouseWheel;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebMemo = class(TMemo);\r\n\r\n  TControlGroup = class(TWebCustomControl)\r\n  private\r\n    FControls: TList;\r\n    FOldCount: integer;\r\n    FColumns: integer;\r\n    FItems: TStrings;\r\n    FOnChange: TNotifyEvent;\r\n    FElementButtonClassName: TElementClassName;\r\n    FElementLabelClassName: TElementClassName;\r\n    FElementGroupClassName: TElementClassName;\r\n    FControlPosition: TElementPosition;\r\n    FElementLegendClassName: TElementClassName;\r\n    procedure SetControlPosition(const Value: TElementPosition);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    procedure DoHandleClick(AControl: TCustomControl); virtual;\r\n    procedure DoItemsChange(Sender: TObject);\r\n    procedure DoControlClick(Sender: TObject);\r\n    procedure SetCaption(const AValue: string); override;\r\n    procedure SetColumns(AValue: integer);\r\n    procedure SetItems(AItems: TStrings);\r\n    procedure DoUpdateList; virtual;\r\n    procedure Change; virtual;\r\n    procedure Loaded; override;\r\n    function CreateGroupControl(ALeft, ATop, AIndex: integer; ACaption: string; APosition: TElementPosition; AState, AEnabled: boolean): TCustomControl; virtual;\r\n    function GetGroupControlState(AIndex: integer): boolean; virtual;\r\n    function GetGroupControl(AIndex: integer): TCustomControl;\r\n    procedure SetEnabled(Value: Boolean); override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure EndUpdate; override;\r\n    procedure SetHeight(AValue: Integer); override;\r\n    procedure SetWidth(AValue: Integer); override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Caption;\r\n    property ChildOrder;\r\n    property Columns: integer read FColumns write SetColumns;\r\n    property ControlPosition: TElementPosition read FControlPosition write SetControlPosition default epAbsolute;\r\n    property DragMode;\r\n    property ElementClassName;\r\n    property ElementButtonClassName: TElementClassName read FElementButtonClassName write FElementButtonClassName;\r\n    property ElementGroupClassName: TElementClassName read FElementGroupClassName write FElementGroupClassName;\r\n    property ElementLabelClassName: TElementClassName read FElementLabelClassName write FElementLabelClassName;\r\n    property ElementLegendClassName: TElementClassName read FElementLegendClassName write FElementLegendClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Items: TStrings read FItems write SetItems;\r\n    property Margins;\r\n    property ParentFont;\r\n    property PopupMenu;\r\n    property Role;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TRadioGroup = class(TControlGroup)\r\n  private\r\n    FItemIndex: integer;\r\n    FOldItemIndex: integer;\r\n  protected\r\n    procedure DoHandleClick(AControl: TCustomControl); override;\r\n    function GetItemIndex: integer;\r\n    procedure SetItemIndex(AIndex: integer);\r\n    function CreateGroupControl(ALeft, ATop, AIndex: integer; ACaption: string; APosition: TElementPosition; AState, AEnabled: boolean): TCustomControl; override;\r\n    function GetGroupControlState(AIndex: integer): boolean; override;\r\n    procedure LoadState(AState: string); override;\r\n    function SaveState: string; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure SetFocus; override;\r\n  published\r\n    property ItemIndex: integer read GetItemIndex write SetItemIndex;\r\n  end;\r\n\r\n  TWebRadioGroup = class(TRadioGroup);\r\n\r\n  TCheckClickEvent = procedure(Sender: TObject; AIndex: integer) of object;\r\n\r\n  TCheckGroup = class(TControlGroup)\r\n  private\r\n    FOnCheckClick: TCheckClickEvent;\r\n    function GetChecked(AIndex: integer): boolean;\r\n    procedure SetChecked(AIndex: integer; const Value: boolean);\r\n  protected\r\n    procedure DoHandleClick(AControl: TCustomControl); override;\r\n    function CreateGroupControl(ALeft, ATop, AIndex: integer; ACaption: string; APosition: TElementPosition; AState, AEnabled: boolean): TCustomControl; override;\r\n    function GetGroupControlState(AIndex: integer): boolean; override;\r\n    function SaveState: string; override;\r\n    procedure LoadState(AState: string); override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property Checked[AIndex: integer]: boolean read GetChecked write SetChecked;\r\n    procedure SetFocus; override;\r\n  published\r\n    property OnCheckClick: TCheckClickEvent read FOnCheckClick write FOnCheckClick;\r\n  end;\r\n\r\n  TWebCheckGroup = class(TCheckGroup);\r\n\r\n  TColorPicker = class(TCustomInput)\r\n  private\r\n    FColor: TColor;\r\n    FOnSelect: TNotifyEvent;\r\n    FHandleChangePtr: pointer;\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n  protected\r\n    procedure UpdateElementVisual; override;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    function GetInputType: string; override;\r\n    function GetColor: TColor;\r\n    procedure SetColor(AValue: TColor); reintroduce;\r\n    procedure BindEvents; override;\r\n    procedure UnBindEvents; override;\r\n    procedure Select; virtual;\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n    property Selected: TColor read GetColor write SetColor;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ChildOrder;\r\n    property Color: TColor read GetColor write SetColor;\r\n    property DragMode;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Height;\r\n    property HeightPercent;\r\n    property Left;\r\n    property Margins;\r\n    property Role;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property OnClick;\r\n    property OnSelect: TNotifyEvent read FOnSelect write FOnSelect;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebColorPicker = class(TColorPicker);\r\n\r\n  TScrollBarContent = class(TCustomControl)\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n  end;\r\n\r\n  TScrollBarInc = Integer;\r\n\r\n  TScrollBar = class(TCustomControl)\r\n  private\r\n    FScrolling: Boolean;\r\n    FContent: TScrollBarContent;\r\n    FKind: TScrollBarKind;\r\n    FPosition: Integer;\r\n    FSmallChange: TScrollBarInc;\r\n    FMax: Integer;\r\n    FMin: Integer;\r\n    FLargeChange: TScrollBarInc;\r\n    FPageSize: Integer;\r\n    FOnChange: TNotifyEvent;\r\n    FScrollPtr: pointer;\r\n    procedure SetKind(const Value: TScrollBarKind);\r\n    procedure SetPosition(const Value: Integer);\r\n    procedure SetMax(const Value: Integer);\r\n    procedure SetMin(const Value: Integer);\r\n    procedure SetPageSize(const Value: Integer);\r\n    function GetPosition: Integer;\r\n    function GetPageSize: Integer;\r\n  protected\r\n    function GetValue(XYPos: Double): Double;\r\n    function CreateElement: TJSElement; override;\r\n    function DoScroll(Event: TJSUIEvent): Boolean; virtual;\r\n    procedure BindEvents; override;\r\n    procedure UnBindEvents; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure UpdateContent; virtual;\r\n    procedure Loaded; override;\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure SetBounds(X, Y, AWidth, AHeight: Integer); override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property DragMode;\r\n    property Height;\r\n    property Kind: TScrollBarKind read FKind write SetKind;\r\n    property Position: Integer read GetPosition write SetPosition;\r\n    property Left;\r\n    property SmallChange: TScrollBarInc read FSmallChange write FSmallChange;\r\n    property LargeChange: TScrollBarInc read FLargeChange write FLargeChange;\r\n    property Max: Integer read FMax write SetMax;\r\n    property Min: Integer read FMin write SetMin;\r\n    property PageSize: Integer read GetPageSize write SetPageSize;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDrag;\r\n    property OnStartDrag;\r\n  end;\r\n\r\n  TWebScrollBar = class(TScrollBar);\r\n\r\nfunction GetAutoCompletionName(aAutoCompletion: TAutoCompletion): string;\r\n\r\nimplementation\r\n\r\nfunction GetAutoCompletionName(aAutoCompletion: TAutoCompletion): string;\r\nbegin\r\n  case aAutoCompletion of\r\n    acOff: Result := '';\r\n    acHonorificPrefix: Result := 'honorific-prefix';\r\n    acGivenName: Result := 'given-name';\r\n    acAdditionalName: Result := 'additional-name';\r\n    acFamilyName: Result := 'family-name';\r\n    acHonorificSuffix: Result := 'honorific-suffix';\r\n    acNickName: Result := 'nickname';\r\n    acEmail: Result := 'email';\r\n    acUserName: Result := 'username';\r\n    acNewPassword: Result := 'new-password';\r\n    acCurrentPassword: Result := 'current-password';\r\n    acOrganizationTitle: Result := 'organization-title';\r\n    acOrganization: Result := 'organization';\r\n    acStreetAddress: Result := 'street-address';\r\n    acAddressLine1: Result := 'address-line1';\r\n    acAddressLine2: Result := 'address-line2';\r\n    acAddressLine3: Result := 'address-line3';\r\n    acAddressLevel1: Result := 'address-level1';\r\n    acAddressLevel2: Result := 'address-level2';\r\n    acAddressLevel3: Result := 'address-level3';\r\n    acAddressLevel4: Result := 'address-level4';\r\n    acCountry: Result := 'country';\r\n    acCountryName: Result := 'country-name';\r\n    acPostalCode: Result := 'postal-code';\r\n    acCCName: Result := 'cc-name';\r\n    acCCGivenName: Result := 'cc-given-name';\r\n    acCCAdditionalName: Result := 'cc-additional-name';\r\n    acCCFamilyName: Result := 'cc-family-name';\r\n    acCCNumber: Result := 'cc-number';\r\n    acExpiry: Result := 'cc-exp';\r\n    acExpiryMonth: Result := 'cc-exp-month';\r\n    acExpiryYear: Result := 'cc-exp-year';\r\n    acCSC: Result := 'cc-csc';\r\n    acType: Result := 'cc-type';\r\n    acTransactionCurrency: Result := 'transaction-currency';\r\n    acTransactionAmount: Result := 'transaction-amount';\r\n    acLanguage: Result := 'language';\r\n    acBirthday: Result := 'bday';\r\n    acBirthdayDay: Result := 'bday-day';\r\n    acBirthDayMonth: Result := 'bday-month';\r\n    acBirthDayYear: Result := 'bday-year';\r\n    acSex: Result := 'sex';\r\n    acTelephone: Result := 'tel';\r\n    acTelephoneCountryCode: Result := 'tel-country-code';\r\n    acTelephoneNational: Result := 'tel-national';\r\n    acTelephoneAreaCode: Result := 'tel-area-code';\r\n    acTelephoneLocal: Result := 'tel-local';\r\n    acTelephoneExtension: Result := 'tel-extension';\r\n    acIMPP: Result := 'impp';\r\n    acURL: Result := 'url';\r\n    acPhoto: Result := 'photo';\r\n    acNope: Result := 'nope';\r\n  end;\r\nend;\r\n\r\n{ TCustomLabel }\r\n\r\nprocedure TCustomLabel.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FAutoSize := true;\r\n  FLayout := tlTop;\r\n  FEllipsisPosition := epNone;\r\n  FColor := clWhite;\r\n  FTransparent := True;\r\n  FAlignment := taLeftJustify;\r\n  TabStop := false;\r\n  FShowAccelChar := true;\r\nend;\r\n\r\nfunction TCustomLabel.CanShowFocus: boolean;\r\nbegin\r\n  Result := false;\r\nend;\r\n\r\nfunction TCustomLabel.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\n\r\n  FContent := CreateLabelElement;\r\n  Result.appendChild(FContent);\r\nend;\r\n\r\nfunction TCustomLabel.CreateLabelElement: TJSElement;\r\nbegin\r\n  Result := nil;\r\n\r\n  case HTMLType of\r\n  tSPAN: Result := document.createElement('SPAN');\r\n  tDIV: Result := document.createElement('DIV');\r\n  tH1: Result := document.createElement('H1');\r\n  tH2: Result := document.createElement('H2');\r\n  tH3: Result := document.createElement('H3');\r\n  tH4: Result := document.createElement('H4');\r\n  tH5: Result := document.createElement('H5');\r\n  tH6: Result := document.createElement('H6');\r\n  tLABELTAG: Result := document.createElement('LABEL');\r\n  tP: Result := document.createElement('P');\r\n  end;\r\n\r\n  Result.setAttribute('data-lbl','lbl');\r\nend;\r\n\r\nprocedure TCustomLabel.BindElement;\r\nbegin\r\n  FContent := Container.firstElementChild;\r\nend;\r\n\r\nfunction TCustomLabel.GetContentHandle: TJSHTMLElement;\r\nbegin\r\n  Result := TJSHTMLElement(FContent);\r\nend;\r\n\r\nfunction TCustomLabel.GetDisplayText: string;\r\nbegin\r\n  Result := Caption;\r\nend;\r\n\r\nfunction TCustomLabel.GetHeight: Integer;\r\nbegin\r\n  if AutoSize and Assigned(ElementHandle) and Assigned(Parent) then\r\n  begin\r\n    Result := Round(TJSHTMLElement(ElementHandle).offsetHeight);\r\n    if Result = 0 then\r\n       Result := inherited GetHeight;\r\n\r\n    if (Result = 0) and (Caption <> '') and (csDesigning in ComponentState) then\r\n      Result := FOldHeight;\r\n  end\r\n  else\r\n    Result := inherited GetHeight;\r\nend;\r\n\r\nfunction TCustomLabel.GetWidth: Integer;\r\nbegin\r\n  if AutoSize and Assigned(ElementHandle) and Assigned(Parent) then\r\n  begin\r\n    Result := Round(TJSHTMLElement(ElementHandle).offsetWidth);\r\n\r\n    if Result = 0 then\r\n      Result := inherited GetWidth;\r\n\r\n    if (Result = 0) and (Caption <> '') and (csDesigning in ComponentState) then\r\n      Result := FOldWidth;\r\n  end\r\n  else\r\n    Result := inherited GetWidth;\r\nend;\r\n\r\nprocedure TCustomLabel.Loaded;\r\nbegin\r\n  inherited;\r\n\r\n  if ShowAccelChar and Assigned(FocusControl) then\r\n    UpdateElementData;\r\nend;\r\n\r\nprocedure TCustomLabel.SetAutoSize(AValue: boolean);\r\nbegin\r\n  if (FAutoSize <> AValue) then\r\n  begin\r\n    FAutoSize := AValue;\r\n    UpdateAutoSize;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetCaption(const AValue: string);\r\nvar\r\n  dw: integer;\r\nbegin\r\n  if Caption <> AValue then\r\n  begin\r\n    dw := Width;\r\n    inherited SetCaption(AValue);\r\n    UpdateAutoSize;\r\n    UpdateElement;\r\n    dw := dw - Width;\r\n    if AutoSize and (Alignment <> taLeftJustify) and (dw <> 0) and (akRight in Anchors) and not IsUpdating then\r\n      Left := Left + dw;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetColorEx(const Value: TColor);\r\nbegin\r\n  FColor := Value;\r\n\r\n  if (csDesigning in ComponentState) and (Color <> clWhite) then\r\n    Transparent := false;\r\n\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomLabel.SetControlCursor(const Value: TCursor);\r\nbegin\r\n  inherited;\r\n  if (ElementClassName = '') and Assigned(ContentHandle) then\r\n    SetElementPointer(ContentHandle, Cursor);\r\nend;\r\n\r\nprocedure TCustomLabel.SetElementLabelClassName(const Value: TElementClassName);\r\nbegin\r\n  if (FElementLabelClassName <> Value) then\r\n  begin\r\n    FElementLabelClassName := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetEllipsisPosition(AValue: TEllipsisPosition);\r\nbegin\r\n  if FEllipsisPosition <> AValue then\r\n  begin\r\n    FEllipsisPosition := AValue;\r\n    if FEllipsisPosition <> epNone then\r\n      FAutoSize := False;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetHTML(const Value: string);\r\nbegin\r\n  if (FHTML <> Value) then\r\n  begin\r\n    FHTML := Value;\r\n    UpdateElementData;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetHTMLType(const Value: THTMLType);\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  if (FHTMLType <> Value) then\r\n  begin\r\n    FHTMLType := Value;\r\n\r\n    if FHTMLType in [tH1..tH6] then\r\n      ElementFont := efCSS;\r\n\r\n    if Assigned(ElementHandle) and Assigned(FContent) then\r\n    begin\r\n      el := TJSElement(ElementHandle.firstChild);\r\n\r\n      if Assigned(el) and (el.getAttribute('data-lbl') = 'lbl') then\r\n      begin\r\n        ElementHandle.removeChild(FContent);\r\n        FContent := CreateLabelElement;\r\n        ElementHandle.appendChild(FContent);\r\n        UpdateElement;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetLayout(const Value: TTextLayout);\r\nbegin\r\n  if FLayout <> Value then\r\n  begin\r\n    FLayout := Value;\r\n    UpdateElementVisual;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetParent(AValue: TControl);\r\nbegin\r\n  inherited;\r\n  if AutoSize and (Alignment <> taLeftJustify) and (FOrigWidth <> -1) then\r\n  begin\r\n    Left := Left + FOrigWidth - Width;\r\n    FOrigWidth := -1;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetTransparent(const Value: boolean);\r\nbegin\r\n  if (FTransparent <> Value) then\r\n  begin\r\n    FTransparent := Value;\r\n    UpdateElementVisual;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetWidth(AValue: Integer);\r\nbegin\r\n  if (AValue <> -1) and (csLoading in ComponentState) then\r\n    FOrigWidth := AValue;\r\n\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomLabel.SetAlignment(const Value: TAlignment);\r\nbegin\r\n  if FAlignment <> Value then\r\n  begin\r\n    FAlignment := Value;\r\n    UpdateElementVisual;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.UpdateAutoSize;\r\nbegin\r\n  if FAutoSize and (Align = alNone) then\r\n  begin\r\n    if Assigned(ElementHandle) and ElementVisible(ElementHandle) {and not (csDesigning in ComponentState)} then\r\n    begin\r\n      Width := -1;\r\n      Height := -1;\r\n    end;\r\n    FEllipsisPosition := epNone;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.UpdateElementData;\r\nvar\r\n  lTxt: string;\r\n  acc: string;\r\n  contentelement: TJSElement;\r\nbegin\r\n  inherited;\r\n\r\n  acc := '';\r\n\r\n  if ShowAccelChar then\r\n    lTxt := ProcessAccelerator(GetDisplayText,acc)\r\n  else\r\n    lTxt := GetDisplayText;\r\n\r\n  if HTML = '' then\r\n    lTxt := HTMLToString(lTxt)\r\n  else\r\n    lTxt := HTML;\r\n\r\n  if IsLinked and (lTxt = '') and (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  if Assigned(ContentHandle) then\r\n  begin\r\n    if isLinked then\r\n    begin\r\n      contentelement := ContentHandle;\r\n\r\n      if (ElementID <> '') then\r\n      begin\r\n        contentelement := document.getElementById(ElementID);\r\n      end;\r\n\r\n      if Assigned(contentelement) then\r\n      begin\r\n        if Assigned(ContentHandle.nodeValue) then\r\n          contentelement.nodeValue := lTxt\r\n        else\r\n          if contentelement.childelementcount = 0 then\r\n            contentelement.innerHTML := lTxt;\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      if (ContentHandle.childElementCount > 0) and not FHasAccel and not FHasHTML then\r\n        ContentHandle.nodeValue := lTxt\r\n      else\r\n        ContentHandle.innerHTML := lTxt\r\n    end;\r\n  end\r\n  else\r\n    ElementHandle.innerHTML := lTxt;\r\n\r\n  FHasHTML := pos('</', lTxt) > 0;\r\n  FHasAccel := acc <> '';\r\n\r\n  // https://www.htmlgoodies.com/tutorials/html_401/article.php/3479621\r\n  if (acc <> '') and Assigned(FocusControl) then\r\n  begin\r\n    ContentHandle['accesskey'] := acc;\r\n    ContentHandle['for'] := FocusControl.GetID;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.UpdateElementSize;\r\nbegin\r\n  inherited;\r\n\r\n  if AutoSize and (Align = alNone) and Assigned(ElementHandle) then\r\n  begin\r\n    if not (csDesigning in ComponentState) then\r\n    begin\r\n      ElementHandle.style.removeProperty('width');\r\n      ElementHandle.style.removeProperty('height');\r\n    end;\r\n  end;\r\n\r\n  if Assigned(ContentHandle) and (Align in [alLeft, alRight, alClient]) and not AutoSize and (Layout in [tlCenter, tlBottom]) then\r\n  begin\r\n    ContentHandle.style.setProperty('height', Height.ToString+'px');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.UpdateElementVisual;\r\nvar\r\n  ow,oh: integer;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    oh := Round(TJSHTMLElement(ElementHandle).offsetHeight);\r\n    ow := Round(TJSHTMLElement(ElementHandle).offsetWidth);\r\n\r\n    if oh > 0 then\r\n      FOldHeight := oh;\r\n    if ow > 0 then\r\n      FOldWidth := ow;\r\n\r\n    if Visible and (not AutoSize or (Align <> alNone)) and (Alignment <> taLeftJustify) then\r\n      ElementHandle.style.setProperty('display', 'table');\r\n\r\n    ElementHandle['zindex'] := '1';\r\n\r\n    if AutoSize and (Align = alNone) and not (csDesigning in ComponentState) then\r\n      ElementHandle.style.setProperty('overflow', '')\r\n    else\r\n      ElementHandle.style.setProperty('overflow', 'hidden');\r\n  end;\r\n\r\n  if Assigned(ContentHandle) then\r\n  begin\r\n    case Layout of\r\n      tlTop: ContentHandle.style.setProperty('vertical-align', 'top');\r\n      tlCenter: ContentHandle.style.setProperty('vertical-align', 'middle');\r\n      tlBottom: ContentHandle.style.setProperty('vertical-align', 'bottom');\r\n    end;\r\n\r\n    case Alignment of\r\n    taLeftJustify: ContentHandle.style.removeProperty('text-align');\r\n    taCenter: ContentHandle.style.setProperty('text-align', 'center');\r\n    taRightJustify: ContentHandle.style.setProperty('text-align', 'right');\r\n    end;\r\n\r\n    SetHTMLElementColor(ElementHandle, Color, Transparent or (Color = clNone) or (Color = clWindow));\r\n    SetHTMLElementColor(ContentHandle, Color, Transparent or (Color = clNone) or (Color = clWindow));\r\n\r\n    ContentHandle.style.setProperty('display', 'table-cell');\r\n\r\n    if ElementClassName = '' then\r\n    begin\r\n      if Enabled and (ElementFont = efProperty) and not IsLinked then\r\n        ContentHandle.style.setProperty('color', ColorToHtml(Font.Color))\r\n      else\r\n        ContentHandle.style.removeProperty('color');\r\n\r\n      SetElementPointer(ContentHandle, Cursor);\r\n      SetHTMLElementFont(ContentHandle, Font, not ((ElementFont = efProperty) and not IsLinked) );\r\n    end\r\n    else\r\n    begin\r\n      ContentHandle.style.removeProperty('color');\r\n      SetHTMLElementFont(ContentHandle, Font, true);\r\n    end;\r\n\r\n    if ElementLabelClassName <> '' then\r\n      ContentHandle['class'] := ElementLabelClassName\r\n    else\r\n      ContentHandle.removeAttribute('class');\r\n\r\n    if (ElementPosition = epAbsolute) or (WidthStyle = ssAbsolute) then\r\n    begin\r\n      if FEllipsisPosition = epNone then\r\n        ContentHandle.style.setProperty('text-overflow', 'clip')\r\n      else\r\n        ContentHandle.style.setProperty('text-overflow', 'ellipsis');\r\n    end\r\n    else\r\n      ContentHandle.style.removeProperty('text-overflow');\r\n\r\n    if WordWrap then\r\n      ContentHandle.style.setProperty('white-space', 'normal')\r\n    else\r\n      ContentHandle.style.setProperty('white-space', 'nowrap');\r\n\r\n    // allow selection in labels\r\n    ElementHandle.style.setProperty('user-select', '');\r\n\r\n    // allow default caret on text\r\n    if Cursor = crDefault then\r\n      ElementHandle.style.setProperty('cursor', '');\r\n\r\n    if AutoSize and (Align = alNone) and not (csDesigning in ComponentState) then\r\n    begin\r\n      ElementHandle.style.removeProperty('width');\r\n      ElementHandle.style.removeProperty('height');\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TCustomInput }\r\n\r\nfunction TCustomInput.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('INPUT');\r\n  Result['type'] := GetInputType;\r\nend;\r\n\r\nprocedure TCustomInput.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) and not IsLinked then\r\n  begin\r\n    TJSHTMLInputElement(Container).style.setProperty('-moz-box-sizing', 'border-box');\r\n    TJSHTMLInputElement(Container).style.setProperty('-webkit-box-sizing', 'border-box');\r\n    TJSHTMLInputElement(Container).style.setProperty('box-sizing', 'border-box');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomInput.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  ShowFocus := true;\r\n  NoUserSelect := false;\r\nend;\r\n\r\nfunction TCustomInput.GetInputType: string;\r\nbegin\r\n   Result := 'EDIT';\r\nend;\r\n\r\nfunction TCustomInput.IsInputControl: Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nprocedure TCustomInput.LoadState(AState: string);\r\nbegin\r\n  TJSHTMLInputElement(ElementHandle).value := AState;\r\nend;\r\n\r\nfunction TCustomInput.SaveState: string;\r\nbegin\r\n  Result := TJSHTMLInputElement(ElementHandle).value;\r\nend;\r\n\r\n{ TCustomEdit }\r\n\r\nprocedure TCustomEdit.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.addEventListener('input', FHandleChangePtr);\r\n    ElementInputHandle.addEventListener('paste', FHandlePastePtr);\r\n    ElementInputHandle.addEventListener('cut', FHandleCutPtr);\r\n    ElementInputHandle.addEventListener('invalid', FHandleInvalidPtr);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.UnBindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.removeEventListener('input', FHandleChangePtr);\r\n    ElementInputHandle.removeEventListener('paste', FHandlePastePtr);\r\n    ElementInputHandle.removeEventListener('cut', FHandleCutPtr);\r\n    ElementInputHandle.removeEventListener('invalid', FHandleInvalidPtr);\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TCustomEdit.Change;\r\nbegin\r\n  if Assigned(ElementHandle) then\r\n    FText := ElementInputHandle.value;\r\n\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TCustomEdit.Clear;\r\nbegin\r\n  Text := '';\r\nend;\r\n\r\nprocedure TCustomEdit.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandlePastePtr := nil;\r\n  FHandleCutPtr := nil;\r\n  FHandleChangePtr := nil;\r\n  FHandleInvalidPtr := nil;\r\nend;\r\n\r\nprocedure TCustomEdit.ClearSelection;\r\nvar\r\n  s: string;\r\nbegin\r\n  s := Text;\r\n  Text := Copy(s, 1, SelStart) + Copy(s, SelStart + SelLength, Length(s));\r\nend;\r\n\r\nprocedure TCustomEdit.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FAutoCompletion := acOff;\r\n  FEditType := weString;\r\n  FText := '';\r\n  FCharCase := wecNormal;\r\n  FMaxLength := 0;\r\n  FReadOnly := false;\r\n  FTextHint := '';\r\n  FPasswordChar := #0;\r\n  FSpellCheck := true;\r\n  Height := 25;\r\nend;\r\n\r\nfunction TCustomEdit.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\n  if FRequiredText <> '' then\r\n  begin\r\n    ElementInputHandle.setCustomValidity('');\r\n  end;\r\nend;\r\n\r\nfunction TCustomEdit.DoHandleCut(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  if not CanCut then\r\n  begin\r\n    asm\r\n      Event.preventDefault();\r\n      Event.stopPropagation();\r\n    end;\r\n  end;\r\n\r\n  Result := False;\r\nend;\r\n\r\nfunction TCustomEdit.DoHandleInvalid(Event: TJSEvent): Boolean;\r\nbegin\r\n  ElementInputHandle.setCustomValidity(FRequiredText);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomEdit.DoHandlePaste(Event: TEventListenerEvent): Boolean;\r\nvar\r\n  s: string;\r\n\r\nbegin\r\n  asm\r\n    var clipboardData = Event.clipboardData || window.clipboardData;\r\n    s = clipboardData.getData('Text');\r\n  end;\r\n\r\n  if not CanPaste(s) or not Validate(s) then\r\n  begin\r\n    asm\r\n      Event.preventDefault();\r\n      Event.stopPropagation();\r\n    end;\r\n  end;\r\n\r\n  Result := False;\r\nend;\r\n\r\nfunction TCustomEdit.CanCut: boolean;\r\nbegin\r\n  Result := True\r\nend;\r\n\r\nfunction TCustomEdit.CanPaste(AValue: string): boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nprocedure TCustomEdit.SetReadOnly(AValue: Boolean);\r\nbegin\r\n  FReadOnly := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetRequired(const Value: Boolean);\r\nbegin\r\n  FRequired := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetSelection(ASelStart, ASelLength: integer);\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  FSelStart := ASelStart;\r\n  FSelLength := ASelLength;\r\n  eh := ElementInputHandle;\r\n  if Assigned(eh) then\r\n  begin\r\n    asm\r\n      eh.setSelectionRange(ASelStart, ASelStart + ASelLength);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetSelLength(const Value: Integer);\r\nbegin\r\n  FSelLength := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetSelStart(const Value: Integer);\r\nbegin\r\n  FSelStart := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetSpellCheck(const Value: boolean);\r\nbegin\r\n  if (FSpellCheck <> Value) then\r\n  begin\r\n    FSpellCheck := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetPasswordChar(const Value: Char);\r\nbegin\r\n  FPasswordChar := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetPattern(const Value: string);\r\nbegin\r\n  if FPattern <> Value then\r\n  begin\r\n    FPattern := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetNumeric(const Value: Boolean);\r\nbegin\r\n  FNumeric := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetText(AValue: string);\r\nbegin\r\n  FText := AValue;\r\n\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.value := GetDisplayText;\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n  end;\r\nend;\r\n\r\nfunction TCustomEdit.GetText: string;\r\nbegin\r\n  Result := FText;\r\n  if Assigned(ElementInputHandle) then\r\n    Result := ElementInputHandle.value;\r\n\r\n  if CharCase = wecUpperCase  then\r\n    Result := Uppercase(Result);\r\n\r\n  if CharCase = wecLowerCase  then\r\n    Result := Lowercase(Result);\r\nend;\r\n\r\nfunction TCustomEdit.IsCustomEditor: Boolean;\r\nbegin\r\n  Result := False;\r\nend;\r\n\r\nfunction TCustomEdit.IsReadOnly: boolean;\r\nbegin\r\n  Result := ReadOnly;\r\nend;\r\n\r\nprocedure TCustomEdit.KeyPress(var Key: Char);\r\nvar\r\n  isValid: boolean;\r\n\r\nbegin\r\n  inherited KeyPress(Key);\r\n\r\n  isValid := true;\r\n\r\n  case EditType of\r\n  weNumeric: isValid := (Key in ['0'..'9']);\r\n  weSignedNumeric: isValid := (Key in ['0'..'9','+','-']);\r\n  weFloat: isValid := (Key in ['0'..'9',',','.']);\r\n  weSignedFloat: isValid := (Key in ['0'..'9',',','.','+','-']);\r\n  weHex: isValid := (Key in ['0'..'9','A'..'F']);\r\n  end;\r\n\r\n  if not isValid then\r\n    Key := #0;\r\nend;\r\n\r\nprocedure TCustomEdit.SetTextHint(AValue: string);\r\nbegin\r\n  FTextHint := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TCustomEdit.UpdateElementData;\r\nvar\r\n  eh: TJSHTMLElement;\r\n  ss, sl: Integer;\r\n  isNum: boolean;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    if not IsLinked then\r\n    begin\r\n      case CharCase of\r\n        wecUpperCase: ElementInputHandle.style.setProperty('text-transform', 'uppercase');\r\n        wecLowerCase: ElementInputHandle.style.setProperty('text-transform', 'lowercase');\r\n        wecMixedCase: ElementInputHandle.style.setProperty('text-transform', 'capitalize');\r\n        wecNormal: ElementInputHandle.style.setProperty('text-transform', 'initial');\r\n      end;\r\n    end;\r\n\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n\r\n    if TextHint <> '' then\r\n      ElementInputHandle.placeholder := TextHint;\r\n\r\n    if not isLinked then\r\n    begin\r\n      ElementInputHandle['type'] := GetInputType;\r\n      ElementInputHandle['role'] := 'textbox';\r\n\r\n      if AutoCompletion = acNope then\r\n      begin\r\n        TJSHTMLElement(ElementInputHandle).setAttribute('autocomplete','nope');\r\n        TJSHTMLElement(ElementInputHandle).removeAttribute('name');\r\n      end\r\n      else\r\n      if AutoCompletion = acNone then\r\n      begin\r\n        TJSHTMLElement(ElementInputHandle).setAttribute('autocomplete','off');\r\n        TJSHTMLElement(ElementInputHandle).removeAttribute('name');\r\n      end\r\n      else\r\n      if AutoCompletion <> acOff then\r\n      begin\r\n        TJSHTMLElement(ElementInputHandle).setAttribute('autocomplete','on');\r\n        TJSHTMLElement(ElementInputHandle).setAttribute('name', GetAutoCompletionName(AutoCompletion));\r\n      end\r\n      else\r\n      begin\r\n        TJSHTMLElement(ElementInputHandle).removeAttribute('autocomplete');\r\n        TJSHTMLElement(ElementInputHandle).removeAttribute('name');\r\n      end;\r\n\r\n      case Alignment of\r\n      taLeftJustify: TJSHTMLElement(ElementInputHandle).style.removeProperty('text-align');\r\n      taCenter: TJSHTMLElement(ElementInputHandle).style.setProperty('text-align', 'center');\r\n      taRightJustify: TJSHTMLElement(ElementInputHandle).style.setProperty('text-align', 'right');\r\n      end;\r\n    end;\r\n\r\n    if AutoFocus then\r\n      ElementInputHandle.setAttribute('autofocus','')\r\n    else\r\n      ElementInputHandle.removeAttribute('autofocus');\r\n\r\n    if Required then\r\n      ElementInputHandle.setAttribute('required','')\r\n    else\r\n      ElementInputHandle.removeAttribute('required');\r\n\r\n    if FPattern <> '' then\r\n      ElementInputHandle.setAttribute('pattern',FPattern)\r\n    else\r\n      ElementInputHandle.removeAttribute('pattern');\r\n\r\n    if MaxLength <= 0 then\r\n      ElementInputHandle.removeAttribute('maxLength')\r\n    else\r\n      ElementInputHandle.maxLength := MaxLength;\r\n\r\n    ElementInputHandle.value := GetDisplayText;\r\n\r\n    isNum := Uppercase(GetInputType) = 'NUMBER';\r\n\r\n    if not SpellCheck then\r\n      ElementInputHandle['spellcheck'] := 'false'\r\n    else\r\n      ElementInputHandle.removeAttribute('spellcheck');\r\n\r\n    if (not isNum) and (not isLinked) and (not IsCustomEditor) then\r\n    begin\r\n      ss := FSelStart;\r\n      sl := FSelStart + FSelLength;\r\n      eh := ElementInputHandle;\r\n      asm\r\n        setTimeout(function() {\r\n          eh.setSelectionRange(ss, sl);\r\n        }, 1);\r\n      end;\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nfunction TCustomEdit.Validate(AValue: string): boolean;\r\nvar\r\n  i: integer;\r\n  Key: char;\r\n  isvalid: boolean;\r\nbegin\r\n  Result := true;\r\n\r\n  for i := 1 to Length(AValue) do\r\n  begin\r\n    Key := AValue[i];\r\n    isValid := true;\r\n\r\n    case EditType of\r\n    weNumeric: isValid := (Key in ['0'..'9']);\r\n    weSignedNumeric: isValid := (Key in ['0'..'9','+','-']);\r\n    weFloat: isValid := (Key in ['0'..'9',',','.']);\r\n    weSignedFloat: isValid := (Key in ['0'..'9',',','.','+','-']);\r\n    weHex: isValid := (Key in ['0'..'9','A'..'F']);\r\n    end;\r\n\r\n    if not IsValid then\r\n    begin\r\n      Result := false;\r\n      break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SelectAll;\r\nbegin\r\n  if Assigned(ElementInputHandle) then\r\n    ElementInputHandle.select;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAlignment(const Value: TAlignment);\r\nbegin\r\n  FAlignment := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAutoCompletion(const Value: TAutoCompletion);\r\nbegin\r\n  if (FAutoCompletion <> Value) then\r\n  begin\r\n    FAutoCompletion := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAutoFocus(const Value: boolean);\r\nbegin\r\n  if (FAutoFocus <> Value) then\r\n  begin\r\n    FAutoFocus := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAutoSelect(const Value: Boolean);\r\nbegin\r\n  if FAutoSelect <> Value then\r\n  begin\r\n    FAutoSelect := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAutoSize(const Value: Boolean);\r\nbegin\r\n  if FAutoSize <> Value then\r\n  begin\r\n    FAutoSize := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetCharCase(AValue: TEditCharCase);\r\nbegin\r\n  if (FCharcase <> AValue) then\r\n  begin\r\n    FCharcase := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetEditType(const Value: TEditType);\r\nbegin\r\n  if (FEditType <> Value) then\r\n  begin\r\n    FEditType := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetHideSelection(const Value: Boolean);\r\nbegin\r\n  if (FHideSelection <> Value) then\r\n  begin\r\n    FHideSelection := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetMaxLength(AValue: integer);\r\nbegin\r\n  if (FMaxLength <> AValue) then\r\n  begin\r\n    FMaxLength := AValue;\r\n    UpdateElementData;\r\n  end;\r\nend;\r\n\r\nfunction TCustomEdit.GetDisplayText: string;\r\nbegin\r\n  Result := FText;\r\nend;\r\n\r\nfunction TCustomEdit.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nfunction TCustomEdit.GetInputType: string;\r\nbegin\r\n  if (PasswordChar <> #0) then\r\n    Result := 'PASSWORD'\r\n  else if Numeric then\r\n    Result := 'NUMBER'\r\n  else\r\n    if (EditType in [weFloat, weNumeric]) then\r\n      Result := 'TEL'\r\n    else\r\n      if EditType = weSearch then\r\n        Result := 'SEARCH'\r\n      else\r\n        Result := 'TEXT';\r\nend;\r\n\r\nprocedure TCustomEdit.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandlePastePtr := @DoHandlePaste;\r\n  FHandleCutPtr := @DoHandleCut;\r\n  FHandleChangePtr := @DoHandleChange;\r\n  FHandleInvalidPtr := @DoHandleInvalid;\r\nend;\r\n\r\nfunction TCustomEdit.GetSelLength: Integer;\r\nbegin\r\n  Result := -1;\r\n  if Assigned(ElementInputHandle) then\r\n    Result := ElementInputHandle.selectionEnd - ElementInputHandle.selectionStart;\r\nend;\r\n\r\nfunction TCustomEdit.GetSelStart: Integer;\r\nbegin\r\n  Result := -1;\r\n  if Assigned(ElementInputHandle) then\r\n    Result := ElementInputHandle.selectionStart;\r\nend;\r\n\r\nfunction TCustomEdit.GetSelText: string;\r\nbegin\r\n  Result := Copy(Text,SelStart + 1, SelLength);\r\nend;\r\n\r\nprocedure TCustomEdit.PersistinHTML;\r\nbegin\r\n  ElementInputHandle.setAttribute('value', Text);\r\nend;\r\n\r\n{ TSpinEdit }\r\n\r\nprocedure TSpinEdit.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FIncrement := 1;\r\n  FMaxValue := 100;\r\n  FMinValue := 0;\r\n  ShowFocus := true;\r\n  Height := 25;\r\n\r\n  // make the spin buttons always visible\r\n  AddControlStyle('input[type=\"number\"]::-webkit-inner-spin-button { opacity: 1 !important; }');\r\nend;\r\n\r\nprocedure TSpinEdit.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.addEventListener('input', FHandleChangePtr);\r\n    ElementInputHandle.addEventListener('invalid', FHandleInvalidPtr);\r\n  end;\r\nend;\r\n\r\nprocedure TSpinEdit.UnBindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.removeEventListener('input', FHandleChangePtr);\r\n    ElementInputHandle.removeEventListener('invalid', FHandleInvalidPtr);\r\n  end;\r\nend;\r\n\r\nfunction TSpinEdit.GetDisplayText: string;\r\nbegin\r\n  Result := IntToStr(FValue);\r\nend;\r\n\r\nfunction TSpinEdit.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nfunction TSpinEdit.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\n  if FRequiredText <> '' then\r\n  begin\r\n    ElementInputHandle.setCustomValidity('');\r\n  end;\r\nend;\r\n\r\nfunction TSpinEdit.DoHandleInvalid(Event: TJSEvent): Boolean;\r\nbegin\r\n  ElementInputHandle.setCustomValidity(FRequiredText);\r\n  Result := true;\r\nend;\r\n\r\nprocedure TSpinEdit.Change;\r\nbegin\r\n  FValue := GetValue;\r\n\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TSpinEdit.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleChangePtr := nil;\r\n  FHandleInvalidPtr := nil;\r\nend;\r\n\r\nfunction TSpinEdit.GetInputType: string;\r\nbegin\r\n  Result := 'NUMBER';\r\nend;\r\n\r\nprocedure TSpinEdit.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleChangePtr := @DoHandleChange;\r\n  FHandleInvalidPtr := @DoHandleInvalid;\r\nend;\r\n\r\nfunction TSpinEdit.GetText: string;\r\nbegin\r\n  Result := IntToStr(Value);\r\nend;\r\n\r\nfunction TSpinEdit.GetValue: integer;\r\nvar\r\n  s: string;\r\nbegin\r\n  Result := FValue;\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  s := TJSHTMLInputElement(Container).value;\r\n  if (s <> '') then\r\n    Result := StrToInt(s);\r\nend;\r\n\r\nfunction TSpinEdit.IsReadOnly: boolean;\r\nbegin\r\n  Result := FReadOnly;\r\nend;\r\n\r\nprocedure TSpinEdit.KeyPress(var Key: Char);\r\nbegin\r\n  if not (Key in ['0'..'9']) then\r\n  begin\r\n    Key := #0;\r\n    PreventDefault;\r\n    StopPropagation;\r\n  end;\r\n  inherited;\r\nend;\r\n\r\nprocedure TSpinEdit.SetIncrement(AValue: integer);\r\nbegin\r\n  FIncrement := AValue;\r\n  if Assigned(Container) then\r\n    Container['step'] := IntToStr(AValue);\r\nend;\r\n\r\nprocedure TSpinEdit.SetMaxValue(AValue: integer);\r\nbegin\r\n  FMaxValue := AValue;\r\n  if Assigned(Container) then\r\n    Container['max'] := IntToStr(AValue);\r\nend;\r\n\r\nprocedure TSpinEdit.SetMinValue(AValue: integer);\r\nbegin\r\n  FMinValue := AValue;\r\n  if Assigned(Container) then\r\n    Container['min'] := IntToStr(AValue);\r\nend;\r\n\r\nprocedure TSpinEdit.SetReadOnly(const Value: boolean);\r\nbegin\r\n  if (FReadOnly <> Value) then\r\n  begin\r\n    FReadOnly := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TSpinEdit.SetRequired(const Value: Boolean);\r\nbegin\r\n  if (FRequired <> Value) then\r\n  begin\r\n    FRequired := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TSpinEdit.SetText(const Value: string);\r\nvar\r\n  i: Integer;\r\nbegin\r\n  i := 0;\r\n  if TryStrToInt(Value, i) then\r\n    Self.Value := i\r\n  else\r\n    Self.Value := 0;\r\nend;\r\n\r\nprocedure TSpinEdit.PersistinHTML;\r\nbegin\r\n  ElementInputHandle.setAttribute('value',IntToStr(Value));\r\nend;\r\n\r\nprocedure TSpinEdit.SetValue(AValue: integer);\r\nbegin\r\n  FValue := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TSpinEdit.UpdateElementData;\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n  begin\r\n    Container['inputmode'] := 'numeric';\r\n    Container['pattern'] := '[0-9]*';\r\n    TJSHTMLInputElement(Container).value := GetDisplayText;\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n\r\n    if Required then\r\n      ElementInputHandle.setAttribute('required','')\r\n    else\r\n      ElementInputHandle.removeAttribute('required');\r\n  end;\r\nend;\r\n\r\n{ TDateTimePicker }\r\n\r\nfunction TDateTimePicker.GetInputType: string;\r\nbegin\r\n   if FKind = dtkDate then\r\n    Result := 'DATE'\r\n  else\r\n    Result := 'TIME';\r\nend;\r\n\r\nprocedure TDateTimePicker.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleChangePtr := @DoHandleChange;\r\n  FClickPtr := @DoCheckClick;\r\n  FFocusPtr := @DoPickerFocus;\r\n  FBlurPtr := @DoPickerBlur;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetChecked(const Value: boolean);\r\nbegin\r\n  if (FChecked <> Value) then\r\n  begin\r\n    FChecked := Value;\r\n    UpdateElementVisual;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetDate(AValue: TDate);\r\nbegin\r\n  if FDate <> AValue then\r\n  begin\r\n    FDate := Int(AValue);\r\n    FTime := 0;\r\n    UpdateElementData;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetDateTime(const Value: TDateTime);\r\nbegin\r\n  FDate := Int(Value);\r\n  FTime := Frac(Value);\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetEnabled(Value: Boolean);\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n  el := TJSHTMLElement(GetElementPicker);\r\n  if  Assigned(el) then\r\n  begin\r\n    if Value then\r\n      el.removeAttribute('disabled')\r\n    else\r\n      el.setAttribute('disabled','');\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetFocus;\r\nbegin\r\n  if Assigned(GetElementPicker) then\r\n  begin\r\n    TJSHTMLElement(GetElementPicker).Focus();\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n  begin\r\n    TJSHTMLInputElement(Container).addEventListener('input', FHandleChangePtr);\r\n  end;\r\n\r\n  if Assigned(FElementCheck) then\r\n    FElementCheck.addEventListener('click',FClickPtr);\r\n\r\n  if Assigned(GetElementPicker) then\r\n  begin\r\n    GetElementPicker.addEventListener('focus',FFocusPtr);\r\n    GetElementPicker.addEventListener('blur',FBlurPtr);\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.UnBindEvents;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    TJSHTMLInputElement(Container).removeEventListener('input', FHandleChangePtr);\r\n  end;\r\n\r\n  if Assigned(FElementCheck) then\r\n    FElementCheck.removeEventListener('click',FClickPtr);\r\n\r\n  if Assigned(GetElementPicker) then\r\n  begin\r\n    GetElementPicker.removeEventListener('focus',FFocusPtr);\r\n    GetElementPicker.removeEventListener('blur',FBlurPtr);\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TDateTimePicker.Change;\r\nbegin\r\n  FTime := GetTime;\r\n  FDate := GetDate;\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TDateTimePicker.Clear;\r\nbegin\r\n  TJSHTMLInputElement(GetElementPicker).value := '';\r\nend;\r\n\r\nprocedure TDateTimePicker.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleChangePtr := nil;\r\n  FBlurPtr := nil;\r\n  FFocusPtr := nil;\r\n  FClickPtr := nil;\r\nend;\r\n\r\nfunction TDateTimePicker.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\n\r\n  FElementCheck := TJSHTMLElement(document.createElement('INPUT'));\r\n  FElementPicker := TJSHTMLElement(document.createElement('INPUT'));\r\n\r\n  Result.appendChild(FElementCheck);\r\n  Result.appendChild(FElementPicker);\r\nend;\r\n\r\nprocedure TDateTimePicker.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Date := now;\r\n  ShowFocus := true;\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 170;\r\n    Height := 25;\r\n  end;\r\n\r\n  FDate := Int(Now);\r\n  FTime := 0;\r\n  FReadOnly := false;\r\n  FShowSeconds := true;\r\nend;\r\n\r\nfunction TDateTimePicker.DoCheckClick(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  FChecked := TJSHTMLInputElement(FElementCheck).checked;\r\n\r\n  if FChecked then\r\n    GetElementPicker.removeAttribute('disabled')\r\n  else\r\n    GetElementPicker.setAttribute('disabled','true');\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TDateTimePicker.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := true;\r\nend;\r\n\r\nfunction TDateTimePicker.DoPickerBlur(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  ElementHandle.style.setProperty('outline','none');\r\n  Result := true;\r\n  DoExit;\r\nend;\r\n\r\nfunction TDateTimePicker.DoPickerFocus(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  ElementHandle.style.setProperty('outline','auto');\r\n  Result := true;\r\n  DoEnter;\r\nend;\r\n\r\nfunction TDateTimePicker.GetDate: TDate;\r\nvar\r\n  str: string;\r\n  ye,mo,da: string;\r\n  yei,moi,dai: word;\r\n  e: integer;\r\n\r\nbegin\r\n  Result := Int(FDate) + Frac(FTime);\r\n  if not Assigned(GetElementPicker) then\r\n    Exit;\r\n\r\n  str := TJSHTMLInputElement(GetElementPicker).value;\r\n\r\n  if Kind = dtkDate then\r\n  begin\r\n    ye := copy(str,1,4);\r\n    mo := copy(str,6,2);\r\n    da := copy(str,9,2);\r\n\r\n    val(ye, yei, e);\r\n    val(mo, moi, e);\r\n    val(da, dai, e);\r\n\r\n    if (yei <> 0) and (moi <> 0) and (dai <> 0) then\r\n      Result := EncodeDate(yei, moi, dai) + Frac(FTime)\r\n    else\r\n      Result := Frac(FTime);\r\n  end\r\n  else\r\n    Result := FTime;\r\nend;\r\n\r\nfunction TDateTimePicker.GetDateTime: TDateTime;\r\nbegin\r\n  Result := Int(FDate) + Frac(FTime);\r\nend;\r\n\r\nfunction TDateTimePicker.GetElementBindHandle: TJSEventTarget;\r\nbegin\r\n  Result := GetElementPicker;\r\n//  if\r\nend;\r\n\r\nfunction TDateTimePicker.GetElementPicker: TJSHTMLElement;\r\nbegin\r\n  if IsLinked then\r\n    Result := ElementHandle\r\n  else\r\n    Result := FElementPicker;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetText(const Value: String);\r\nbegin\r\n  if not Assigned(GetElementPicker) then\r\n    Exit;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetTime(AValue: TTime);\r\nbegin\r\n  if FTime <> AValue then\r\n  begin\r\n    FDate := 0;\r\n    FTime := AValue;\r\n    UpdateElementData;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.UpdateElementData;\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n\r\n  el := GetElementPicker;\r\n\r\n  if Assigned(el) then\r\n  begin\r\n    el['step'] := '1';\r\n\r\n    case Kind of\r\n      dtkTime:\r\n        begin\r\n          TJSHTMLInputElement(el).value := FormatDateTime(TFormatSettings.Invariant.LongTimeFormat, FTime);\r\n          if not ShowSeconds then\r\n            el['step'] := '60';\r\n        end;\r\n      dtkDate:\r\n        begin\r\n          if FDate = 0 then\r\n            TJSHTMLInputElement(el).value := ''\r\n          else\r\n            TJSHTMLInputElement(el).value := FormatDateTime('yyyy-MM-dd', FDate);\r\n        end;\r\n    end;\r\n\r\n    TJSHTMLInputElement(el).readOnly := IsReadOnly;\r\n\r\n    if IsEnabled then\r\n      el.removeAttribute('disabled')\r\n    else\r\n      el.setAttribute('disabled','');\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(GetElementPicker) and Assigned(ElementHandle) and Assigned(FElementCheck) then\r\n  begin\r\n    FElementCheck['type'] := 'CHECKBOX';\r\n\r\n    if FKind = dtkDate then\r\n      GetElementPicker['type'] := 'DATE'\r\n    else\r\n      GetElementPicker['type'] := 'TIME';\r\n\r\n    GetElementPicker.style.setProperty('border','none');\r\n    GetElementPicker.style.setProperty('border-width','0px');\r\n    GetElementPicker.style.setProperty('outline','none');\r\n    GetElementPicker.style.setProperty('font-family','inherit');\r\n    GetElementPicker.style.setProperty('font-size','inherit');\r\n    GetElementPicker.style.setProperty('width','100%');\r\n    GetElementPicker.style.setProperty('height','100%');\r\n\r\n    ElementHandle.style.setProperty('padding','1px');\r\n    ElementHandle.style.setProperty('outline','none');\r\n\r\n    if BorderStyle = bsSingle then\r\n    begin\r\n      if not Enabled then\r\n        ElementHandle.style.setProperty('border','1px silver solid')\r\n      else\r\n        ElementHandle.style.setProperty('border','1px solid');\r\n\r\n      ElementHandle.style.setProperty('border-radius','3px');\r\n    end\r\n    else\r\n      ElementHandle.style.removeProperty('border');\r\n\r\n    if Assigned(FElementCheck) then\r\n    begin\r\n      if ShowCheckBox then\r\n        FElementCheck.style.SetProperty('display','')\r\n      else\r\n        FElementCheck.style.SetProperty('display','none');\r\n    end;\r\n\r\n    if ShowCheckBox then\r\n    begin\r\n      if Checked then\r\n        GetElementPicker.removeAttribute('disabled')\r\n      else\r\n        GetElementPicker.setAttribute('disabled','true');\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TDateTimePicker.GetText: String;\r\nbegin\r\n  Result := '';\r\n  if not Assigned(GetElementPicker) then\r\n    Exit;\r\n\r\n  Result := TJSHTMLInputElement(GetElementPicker).value;\r\nend;\r\n\r\nfunction TDateTimePicker.GetTime: TTime;\r\nvar\r\n  str: string;\r\n  d: TDateTime;\r\nbegin\r\n  if FDate > 0 then\r\n    Result := Frac(FTime) + Int(FDate)\r\n  else\r\n    Result := Frac(FTime);\r\n\r\n  if not Assigned(GetElementPicker) then\r\n    Exit;\r\n\r\n  str := TJSHTMLInputElement(GetElementPicker).value;\r\n  if TryStrToTime(str, d) then\r\n  begin\r\n    Result := d + Int(FDate);\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TDateTimePicker.HandleDoEnter(Event: TJSFocusEvent): Boolean;\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  Result := inherited HandleDoEnter(Event);\r\n  if AutoDropDown then\r\n  begin\r\n    el := GetElementPicker;\r\n    asm\r\n      el.showPicker();\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction TDateTimePicker.IsReadOnly: boolean;\r\nbegin\r\n  Result := FReadOnly;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetKind(AValue: TDateTimeKind);\r\nvar\r\n  dt: TDateTime;\r\nbegin\r\n  FKind := AValue;\r\n  if Assigned(GetElementPicker) then\r\n  begin\r\n    dt := Int(FDate) + Frac(FTime);\r\n    if AValue = dtkDate then\r\n      GetElementPicker['type'] := 'DATE'\r\n    else\r\n      GetElementPicker['type'] := 'TIME';\r\n\r\n    Date := dt;\r\n    Time := dt;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetReadOnly(const Value: boolean);\r\nbegin\r\n  FReadOnly := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetShowCheckBox(const Value: boolean);\r\nbegin\r\n  if (FShowCheckBox <> Value) then\r\n  begin\r\n    FShowCheckBox := Value;\r\n    UpdateElementVisual;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetShowSeconds(const Value: boolean);\r\nbegin\r\n  if (FShowSeconds <> Value) then\r\n  begin\r\n    FShowSeconds := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\n{ TButton }\r\n\r\nprocedure TButton.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  if (csDesigning in ComponentState) and (Caption = '') then\r\n    Caption := Name;\r\n  Color := clNone;\r\nend;\r\n\r\nfunction TButton.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('BUTTON');\r\n  Result['type'] := 'BUTTON';\r\nend;\r\n\r\nprocedure TButton.SetCaption(const AValue: string);\r\nbegin\r\n  if Caption <> AValue then\r\n  begin\r\n    inherited SetCaption(AValue);\r\n    UpdateElementData;\r\n  end;\r\nend;\r\n\r\nprocedure TButton.SetDefault(const Value: Boolean);\r\nbegin\r\n  FDefault := Value;\r\n  if FDefault then\r\n    SetFocus;\r\nend;\r\n\r\nprocedure TButton.SetButtonType(const Value: string);\r\nbegin\r\n  FButtonType := Value;\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure TButton.UpdateElementData;\r\nvar\r\n  acc: string;\r\nbegin\r\n  inherited;\r\n\r\n  if IsLinked and (Caption = '') then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if (ElementHandle.childElementCount = 0) or (Pos('</', Caption) > 0) or not IsLinked then\r\n    begin\r\n      ElementHandle.innerHTML := ProcessAccelerator(Caption,acc);\r\n    end;\r\n\r\n    if acc <> '' then\r\n      ElementHandle['accesskey'] := acc;\r\n\r\n    ElementHandle['role'] := 'button';\r\n    ElementHandle['aria-label'] := Caption;\r\n\r\n    if FButtonType <> '' then\r\n      ElementHandle['type'] := FButtonType\r\n    else\r\n      ElementHandle['type'] := 'BUTTON';\r\n  end;\r\nend;\r\n\r\nprocedure TButton.UpdateElementVisual;\r\nvar\r\n  ecn: string;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.removeProperty('outline');\r\n    ElementHandle.style.removeProperty('user-select');\r\n\r\n    ecn := Uppercase(ElementClassName);\r\n\r\n    if (ecn = 'BTN') or (pos('BTN ', ecn) > 0)  then\r\n    begin\r\n//      ElementHandle.style.setProperty('border','none');\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TCheckBox }\r\n\r\nprocedure TCheckBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Color := clNone;\r\n  FChecked := False;\r\n  FState := cbUnchecked;\r\n\r\n  if (csDesigning in ComponentState) and (Caption = '') then\r\n     Caption := Name;\r\n\r\n  ShowFocus := true;\r\nend;\r\n\r\nprocedure TCheckBox.DoCheckClick;\r\nbegin\r\n  if Assigned(OnCheckClick) then\r\n    OnCheckClick(Self);\r\nend;\r\n\r\nprocedure TCheckBox.Click;\r\nbegin\r\n  inherited;\r\n  FChecked := GetChecked;\r\n  if FChecked then\r\n    FState := cbChecked\r\n  else\r\n    FState := cbUnChecked;\r\n\r\n  SetFocus;\r\nend;\r\n\r\nfunction TCheckBox.CreateElement: TJSElement;\r\nvar\r\n  btn, lbl: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\n  btn := document.createElement('INPUT');\r\n  lbl := document.createElement('SPAN');\r\n\r\n  btn['TYPE'] := 'CHECKBOX';\r\n  btn['id'] := GetID;\r\n  btn['role'] := 'checkbox';\r\n  lbl['id'] := GetID + 'lbl';\r\n  lbl['value'] := GetID;\r\n\r\n  Result.appendChild(btn);\r\n  Result.appendChild(lbl);\r\n\r\n  (btn as TJSHTMLInputElement).OnClick := @HandleCheckClick;\r\nend;\r\n\r\nfunction TCheckBox.HandleCheckClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  DoCheckClick;\r\n  Result := true;\r\nend;\r\n\r\nfunction TCheckBox.HandleLabelClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  chk: TJSHTMLInputElement;\r\nbegin\r\n  if Assigned(Container) and Enabled then\r\n  begin\r\n    chk := TJSHTMLInputElement(GetCheckElement);\r\n    chk.checked := not chk.checked;\r\n\r\n    Checked := chk.checked;\r\n  end;\r\n  DoCheckClick;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCheckBox.KeyPress(var ch: char);\r\nvar\r\n  chk: TJSHTMLInputElement;\r\nbegin\r\n  inherited;\r\n  if ch = #32 then\r\n  begin\r\n    if Assigned(Container) then\r\n    begin\r\n      chk := TJSHTMLInputElement(GetCheckElement);\r\n      chk.checked := not chk.checked;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.Loaded;\r\nvar\r\n  lbl: TJSHTMLInputElement;\r\n\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    if not IsLinked then\r\n    begin\r\n      lbl := TJSHTMLInputElement(Container.children[1]);\r\n      lbl.OnClick := @HandleLabelClick;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.UpdateElementData;\r\nvar\r\n  chk: TJSHTMLInputElement;\r\n  btn: TJSElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    chk := TJSHTMLInputElement(GetCheckElement);\r\n    chk.disabled := not IsEnabled;\r\n    chk.checked := FChecked;\r\n    chk.indeterminate := (State = cbGrayed);\r\n\r\n    if not IsLinked then\r\n    begin\r\n      if (Caption <> '') then\r\n        Container.lastElementChild.innerHTML := Caption;\r\n\r\n      ElementHandle.setAttribute('tabindex','-1');\r\n\r\n      btn := TJSElement(ElementHandle.firstChild);\r\n      btn.setAttribute('tabindex','-1');\r\n    end;\r\n\r\n    if TabStop then\r\n      Container.setAttribute('tabindex',inttostr(TabOrder));\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.UpdateElementSize;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) and not IsLinked and (ElementPosition = epAbsolute) then\r\n  begin\r\n    if HeightStyle <> ssAuto then\r\n      TJSHTMLElement(Container.firstElementChild).style.setProperty('height','100%')\r\n    else\r\n      TJSHTMLElement(Container.firstElementChild).style.removeProperty('height');\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.UpdateElementVisual;\r\nvar\r\n  btn,lbl: TJSElement;\r\n  frm: TCustomForm;\r\n  isbs: boolean;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    btn := TJSElement(ElementHandle.firstChild);\r\n\r\n    if Assigned(btn) then\r\n    begin\r\n      if Assigned(TJSHTMLElement(btn).style) then\r\n        TJSHTMLElement(btn).style.setProperty('margin-right','4px');\r\n\r\n      if FElementButtonClassName <> '' then\r\n        btn.setAttribute('class',FElementButtonClassName)\r\n      else\r\n        btn.removeAttribute('class');\r\n    end;\r\n\r\n    lbl := TJSElement(ElementHandle.lastElementChild);\r\n\r\n    if Assigned(lbl) then\r\n    begin\r\n      if FElementLabelClassName <> '' then\r\n        lbl.setAttribute('class',FElementLabelClassName)\r\n      else\r\n        lbl.removeAttribute('class');\r\n    end;\r\n\r\n    if not TabStop or not ShowFocus or (ElementClassName <> '') then\r\n      ElementHandle.style.setProperty('outline','none');\r\n\r\n    if not IsLinked then\r\n    begin\r\n      ElementHandle.style.setProperty('user-select','none');\r\n\r\n      if ElementPosition = epAbsolute then\r\n      begin\r\n        if ElementButtonClassName = '' then\r\n        begin\r\n          TJSHTMLElement(btn).style.setProperty('float','left');\r\n\r\n          if HeightStyle = ssAuto then\r\n            TJSHTMLElement(btn).style.removeProperty('height')\r\n          else\r\n            if (ElementPosition = epAbsolute) then\r\n              TJSHTMLElement(btn).style.setProperty('height','100%');\r\n\r\n          TJSHTMLElement(btn).style.setProperty('vertical-align','middle');\r\n          TJSHTMLElement(btn).style.setProperty('margin-top','0px');\r\n          TJSHTMLElement(btn).style.setProperty('margin-bottom','0px');\r\n        end;\r\n\r\n        frm := GetParentForm(Self);\r\n        isbs := Assigned(frm) and (frm.CSSLibrary = cssBootstrap);\r\n\r\n        if (ElementLabelClassName = '') or isbs then\r\n        begin\r\n          lbl := TJSElement(Container.lastElementChild);\r\n          TJSHTMLElement(lbl).style.setProperty('vertical-align','middle');\r\n          TJSHTMLElement(lbl).style.setProperty('min-height','100%');\r\n          TJSHTMLElement(lbl).style.setProperty('height','100%');\r\n          TJSHTMLElement(lbl).style.setProperty('position','absolute');\r\n          TJSHTMLElement(lbl).style.setProperty('overflow','hidden');\r\n          TJSHTMLElement(lbl).style.setProperty('display','inline-flex');\r\n          TJSHTMLElement(lbl).style.setProperty('align-items','center');\r\n        end;\r\n      end;\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.SetCaption(const AValue: string);\r\nbegin\r\n  if Caption <> AValue then\r\n  begin\r\n    inherited SetCaption(AValue);\r\n    if Assigned(Container) and not IsLinked then\r\n    begin\r\n      if Assigned(Container.lastElementChild) then\r\n        Container.lastElementChild.innerHTML := AValue;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.SetEnabled(Value: boolean);\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n    TJSHTMLInputElement(GetCheckElement).disabled := not Value;\r\nend;\r\n\r\nprocedure TCheckBox.SetChecked(AValue: boolean);\r\nbegin\r\n  FChecked := AValue;\r\n  if AValue then\r\n    FState := cbChecked\r\n  else\r\n    FState := cbUnChecked;\r\n\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TCheckBox.GetChecked: boolean;\r\nbegin\r\n  if Assigned(Container) then\r\n    FChecked := TJSHTMLInputElement(GetCheckElement).checked;\r\n\r\n  Result := FChecked;\r\nend;\r\n\r\nfunction TCheckBox.GetCheckElement: TJSHTMLElement;\r\nbegin\r\n  if IsLinked then\r\n    Result := TJSHTMLElement(ElementHandle)\r\n  else\r\n    Result := TJSHTMLElement(Container.firstElementChild);\r\nend;\r\n\r\nprocedure TCheckBox.SetState(AValue: TCheckBoxState);\r\nbegin\r\n  FState := AValue;\r\n  FChecked := FState = cbChecked;\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TCheckBox.GetState: TCheckBoxState;\r\nbegin\r\n  Result := FState;\r\nend;\r\n\r\nprocedure TCheckBox.PersistinHTML;\r\nvar\r\n  cb: TJSHTMLInputElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  cb := TJSHTMLInputElement(GetCheckElement);\r\n\r\n  if (cb.checked) then\r\n    cb.setAttribute('checked','checked')\r\n  else\r\n    cb.removeAttribute('checked');\r\nend;\r\n\r\nprocedure TCheckBox.LoadState(AState: string);\r\nvar\r\n  cb: TJSHTMLInputElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  cb := TJSHTMLInputElement(GetCheckElement);\r\n  cb.checked := AState = '1';\r\nend;\r\n\r\nfunction TCheckBox.SaveState: string;\r\nvar\r\n  cb: TJSHTMLInputElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  cb := TJSHTMLInputElement(GetCheckElement);\r\n\r\n  if (cb.checked) then\r\n    Result := '1'\r\n  else\r\n    Result := '0';\r\nend;\r\n\r\n{ TRadioButton }\r\n\r\nprocedure TRadioButton.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Color := clNone;\r\n\r\n  if (csDesigning in ComponentState) and (Caption = '') then\r\n    Caption := Name;\r\n\r\n  FGroupName := '';\r\n  ShowFocus := true;\r\nend;\r\n\r\nfunction TRadioButton.CreateElement: TJSElement;\r\nvar\r\n  btn, lbl: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\n  btn := document.createElement('INPUT');\r\n  lbl := document.createElement('SPAN');\r\n  Result.addEventListener('click', @HandleLabelClick);\r\n\r\n  btn['TYPE'] := 'RADIO';\r\n  btn['id'] := GetID + 'rd';\r\n  btn['name'] := GroupName;\r\n  btn['role'] := 'radio';\r\n  btn['tabindex'] := '-1';\r\n  btn.AddEventListener('click',@HandleRadioClick);\r\n\r\n  lbl['id'] := GetID + 'lbl';\r\n  lbl['value'] := GetID;\r\n\r\n  Result.appendChild(btn);\r\n  Result.appendChild(lbl);\r\nend;\r\n\r\nfunction TRadioButton.HandleLabelClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  rb: TJSHTMLInputElement;\r\nbegin\r\n  if Assigned(Container) and Enabled then\r\n  begin\r\n    rb := TJSHTMLInputElement(GetRadioElement);\r\n    rb.checked := true;\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nfunction TRadioButton.HandleRadioClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  SetFocus;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TRadioButton.Keypress(var ch: Char);\r\nvar\r\n  rb: TJSHTMLInputElement;\r\nbegin\r\n  inherited;\r\n  if ch = #32 then\r\n  begin\r\n    rb := TJSHTMLInputElement(GetRadioElement);\r\n    rb.checked := true;\r\n  end;\r\nend;\r\n\r\nprocedure TRadioButton.LoadState(AState: string);\r\nvar\r\n  rb: TJSHTMLInputElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  rb := TJSHTMLInputElement(GetRadioElement);\r\n  rb.checked := AState = '1';\r\nend;\r\n\r\nprocedure TRadioButton.SetCaption(const AValue: string);\r\nbegin\r\n  if (Caption <> AValue) then\r\n  begin\r\n    inherited SetCaption(AValue);\r\n    if Assigned(Container) and not IsLinked then\r\n      Container.lastElementChild.innerHTML := AValue;\r\n  end;\r\nend;\r\n\r\nprocedure TRadioButton.SetEnabled(Value: boolean);\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n    TJSHTMLInputElement(GetRadioElement).disabled := not Value;\r\nend;\r\n\r\nprocedure TRadioButton.SetGroupName(AValue: string);\r\nbegin\r\n  FGroupName := AValue;\r\n  UpdateElementData;\r\nend;\r\n\r\nfunction TRadioButton.SaveState: string;\r\nvar\r\n  rb: TJSHTMLInputElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  rb := TJSHTMLInputElement(GetRadioElement);\r\n\r\n  if rb.checked then\r\n    Result := '1'\r\n  else\r\n    Result := '0';\r\nend;\r\n\r\nprocedure TRadioButton.UpdateElementData;\r\nvar\r\n  btn: TJSElement;\r\n\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n  begin\r\n    if IsLinked then\r\n      TJSHTMLElement(ElementHandle)['name'] := FGroupName\r\n    else\r\n    begin\r\n      Container.firstElementChild['name'] := FGroupName;\r\n      btn := TJSElement(ElementHandle.firstChild);\r\n      TJSHTMLInputElement(btn).disabled := not Enabled;\r\n    end;\r\n\r\n    if not IsLinked then\r\n    begin\r\n      if (Caption <> '') then\r\n        Container.lastElementChild.innerHTML := Caption;\r\n\r\n      ElementHandle.setAttribute('tabindex','-1');\r\n\r\n      if TabStop and Assigned(btn) then\r\n        btn.setAttribute('tabindex','-1');\r\n    end;\r\n\r\n    if TabStop then\r\n      Container.setAttribute('tabindex',inttostr(TabOrder));\r\n  end;\r\nend;\r\n\r\nprocedure TRadioButton.UpdateElementSize;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) and not IsLinked then\r\n  begin\r\n    if (HeightStyle <> ssAuto) then\r\n      TJSHTMLElement(Container.firstElementChild).style.setProperty('height','100%')\r\n    else\r\n      TJSHTMLElement(Container.firstElementChild).style.removeProperty('height')\r\n  end;\r\nend;\r\n\r\nprocedure TRadioButton.UpdateElementVisual;\r\nvar\r\n  btn,lbl: TJSElement;\r\n  isbs: boolean;\r\n  frm: TCustomForm;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n\r\n    if not IsLinked  then\r\n    begin\r\n      btn := TJSElement(ElementHandle.firstChild);\r\n      TJSHTMLElement(btn).style.setProperty('margin-right','4px');\r\n\r\n      if Assigned(btn) then\r\n      begin\r\n        if FElementButtonClassName <> '' then\r\n          btn.setAttribute('class',FElementButtonClassName)\r\n        else\r\n          btn.removeAttribute('class');\r\n      end;\r\n\r\n      lbl := TJSElement(ElementHandle.lastElementChild);\r\n\r\n      if Assigned(lbl) then\r\n      begin\r\n        if FElementLabelClassName <> '' then\r\n          lbl.setAttribute('class',FElementLabelClassName)\r\n        else\r\n          lbl.removeAttribute('class');\r\n      end;\r\n    end;\r\n\r\n    if not TabStop or not ShowFocus or (ElementClassName <> '') then\r\n      ElementHandle.style.setProperty('outline','none');\r\n\r\n    if not IsLinked then\r\n    begin\r\n      ElementHandle.style.setProperty('user-select','none');\r\n      ElementHandle.style.setProperty('white-space','normal');\r\n\r\n      if ElementPosition = epAbsolute then\r\n      begin\r\n        if ElementButtonClassName = '' then\r\n        begin\r\n          TJSHTMLElement(btn).style.setProperty('float','left');\r\n\r\n          if HeightStyle <> ssAuto then\r\n            TJSHTMLElement(btn).style.setProperty('height','100%')\r\n          else\r\n            TJSHTMLElement(btn).style.removeProperty('height');\r\n          TJSHTMLElement(btn).style.setProperty('vertical-align','middle');\r\n          TJSHTMLElement(btn).style.setProperty('margin-top','0px');\r\n          TJSHTMLElement(btn).style.setProperty('margin-bottom','0px');\r\n        end;\r\n\r\n        frm := GetParentForm(Self);\r\n        isbs := Assigned(frm) and (frm.CSSLibrary = cssBootstrap);\r\n\r\n        if (ElementLabelClassName = '') or isbs then\r\n        begin\r\n          lbl := TJSElement(Container.lastElementChild);\r\n          TJSHTMLElement(lbl).style.setProperty('vertical-align','middle');\r\n          TJSHTMLElement(lbl).style.setProperty('min-height','100%');\r\n          TJSHTMLElement(lbl).style.setProperty('height','100%');\r\n          if not (Parent is TRadioGroup) then\r\n            TJSHTMLElement(lbl).style.setProperty('position','absolute');\r\n          TJSHTMLElement(lbl).style.setProperty('overflow','hidden');\r\n          TJSHTMLElement(lbl).style.setProperty('display','inline-flex');\r\n          TJSHTMLElement(lbl).style.setProperty('align-items','center');\r\n        end;\r\n      end;\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\nprocedure TRadioButton.SetChecked(AValue: boolean);\r\nbegin\r\n  FChecked := AValue;\r\n\r\n  if Assigned(Container) then\r\n    TJSHTMLInputElement(GetRadioElement).checked := AValue;\r\nend;\r\n\r\nfunction TRadioButton.GetChecked: boolean;\r\nbegin\r\n  Result := FChecked;\r\n  if Assigned(Container) then\r\n    Result := TJSHTMLInputElement(GetRadioElement).checked;\r\nend;\r\n\r\nfunction TRadioButton.GetRadioElement: TJSHTMLElement;\r\nbegin\r\n  if IsLinked then\r\n    Result := TJSHTMLElement(ElementHandle)\r\n  else\r\n    Result := TJSHTMLElement(Container.firstElementChild);\r\nend;\r\n\r\nprocedure TRadioButton.PersistInHTML;\r\nvar\r\n  rb: TJSHTMLInputElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  rb := TJSHTMLInputElement(GetRadioElement);\r\n  if (rb.checked) then\r\n    rb.setAttribute('checked','checked')\r\n  else\r\n    rb.removeAttribute('checked');\r\nend;\r\n\r\n{ TListBox }\r\n\r\nprocedure TListBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FItems := TStringList.Create;\r\n  FItems.SkipLastLinebreak := true;\r\n  TStringList(FItems).OnChange := DoItemsChange;\r\n  FMultiSelect := false;\r\n  FSelected := TList.Create;\r\n  FItemIndex := -1;\r\n  ShowFocus := true;\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 160;\r\n    Height := 180;\r\n  end;\r\nend;\r\n\r\nfunction TListBox.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SELECT');\r\n  Result['Size'] := '2';\r\nend;\r\n\r\ndestructor TListBox.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  FSelected.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TListBox.DisableDrag;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  for I := 0 to TJSHTMLSelectElement(Container).options.length - 1 do\r\n    TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[I]).Attrs['draggable'] := 'false';\r\nend;\r\n\r\nfunction TListBox.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TListBox.AddItem(Item: string; AObject: TObject);\r\nbegin\r\n  FItems.AddObject(Item, AObject);\r\nend;\r\n\r\nprocedure TListBox.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.addEventListener('change', FHandleChangePtr);\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.UnBindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.removeEventListener('change', FHandleChangePtr);\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TListBox.Change;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TListBox.Clear;\r\nbegin\r\n  BeginUpdate;\r\n  FItems.Clear;\r\n  EndUpdate;\r\nend;\r\n\r\nprocedure TListBox.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleChangePtr := nil;\r\nend;\r\n\r\nprocedure TListBox.ClearSelection;\r\nvar\r\n  i: integer;\r\nbegin\r\n  ItemIndex := -1;\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if ElementHandle.tagName <> 'SELECT' then\r\n    Exit;\r\n\r\n  for i := 0 to TJSHTMLSelectElement(Container).options.length - 1 do\r\n    TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).selected := false;\r\nend;\r\n\r\nfunction TListBox.SaveState: string;\r\nvar\r\n  i: integer;\r\n  s: string;\r\nbegin\r\n  for i := 0 to Items.Count - 1 do\r\n  begin\r\n    if Selected[i] then\r\n      s := s + ',1'\r\n    else\r\n      s := s + ',0';\r\n  end;\r\n  Delete(s,1,1);\r\n  Result := s;\r\nend;\r\n\r\nprocedure TListBox.SelectAll;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if ElementHandle.tagName <> 'SELECT' then\r\n    Exit;\r\n\r\n  for i := 0 to TJSHTMLSelectElement(Container).options.length - 1 do\r\n  begin\r\n    Selected[i] := true;\r\n    TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).selected := true;\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.SetItems(AItems: TStrings);\r\nbegin\r\n  FItems.Assign(AItems);\r\nend;\r\n\r\nfunction TListBox.GetCount: Integer;\r\nbegin\r\n  Result := FItems.Count;\r\nend;\r\n\r\nfunction TListBox.GetElementSelectHandle: TJSHTMLSelectElement;\r\nbegin\r\n  Result := TJSHTMLSelectElement(Container);\r\nend;\r\n\r\nfunction TListBox.GetItemIndex: integer;\r\nbegin\r\n  Result := FItemIndex;\r\n  if Assigned(Container) then\r\n    Result := TJSHTMLSelectElement(Container).selectedIndex;\r\nend;\r\n\r\nprocedure TListBox.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleChangePtr := @DoHandleChange;\r\nend;\r\n\r\nprocedure TListBox.PersistinHTML;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if ElementHandle.tagName <> 'SELECT' then\r\n    Exit;\r\n\r\n  for i := 0 to TJSHTMLSelectElement(Container).options.length - 1 do\r\n  begin\r\n    if TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).selected then\r\n      TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).setAttribute('selected','selected')\r\n    else\r\n      TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).removeAttribute('selected');\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.SetItemHeight(const Value: Integer);\r\nbegin\r\n  FItemHeight := Value;\r\nend;\r\n\r\nprocedure TListBox.SetItemIndex(AIndex: integer);\r\nbegin\r\n  if FItemIndex <> AIndex then\r\n  begin\r\n    FItemIndex := AIndex;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.SetMultiSelect(AValue: boolean);\r\nbegin\r\n  FMultiSelect := AValue;\r\n  if Assigned(Container) then\r\n    TJSHTMLSelectElement(Container).multiple := AValue;\r\nend;\r\n\r\nfunction TListBox.GetSelCount: integer;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := 0;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    for i := 0 to FItems.Count - 1 do\r\n    begin\r\n      if TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).selected then\r\n        inc(Result);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TListBox.GetSelected(AIndex: integer): boolean;\r\nbegin\r\n  if (AIndex < FSelected.Count) then\r\n    Result := boolean(FSelected.Items[AIndex])\r\n  else\r\n    Result := False;\r\n\r\n  if ElementHandle.tagName <> 'SELECT' then\r\n    Exit;\r\n\r\n  if Assigned(Container) and (AIndex < TJSHTMLSelectElement(Container).options.length) then\r\n    Result := TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[Aindex]).selected;\r\nend;\r\n\r\n\r\nprocedure TListBox.Loaded;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TListBox.LoadState(AState: string);\r\nvar\r\n  sl: TStringList;\r\n  i: integer;\r\nbegin\r\n  sl := TStringList.Create;\r\n  sl.Delimiter := ',';\r\n  sl.CommaText := AState;\r\n\r\n  for i := 0 to sl.Count - 1 do\r\n  begin\r\n    Selected[i] := sl.Strings[i] = '1';\r\n  end;\r\n\r\n  sl.Free;\r\nend;\r\n\r\nprocedure TListBox.SetSelected(AIndex: integer; AValue: boolean);\r\nbegin  \r\n  while (AIndex >= FSelected.Count) do\r\n    FSelected.Add(false);\r\n\r\n  FSelected.Items[AIndex] := AValue;\r\n\r\n  if Assigned(Container) then\r\n    TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[Aindex]).selected := AValue;\r\nend;\r\n\r\nprocedure TListBox.SetSorted(const Value: Boolean);\r\nbegin\r\n  FSorted := Value;\r\n  TStringList(Items).Sort;\r\nend;\r\n\r\nprocedure TListBox.UpdateElementData;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementSelectHandle) then\r\n  begin\r\n    ElementSelectHandle.style.setProperty('overflow', 'auto');\r\n    ElementSelectHandle.selectedIndex := FItemIndex;\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementSelectHandle) then\r\n  begin\r\n    ElementSelectHandle.style.setProperty('overflow', 'auto');\r\n    ElementSelectHandle['role'] := 'listbox';\r\n    ElementSelectHandle['aria-busy'] := 'true';\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.UpdateParent;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TListBox.DoItemsChange(Sender: TObject);\r\nbegin\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TListBox.DoUpdateList;\r\nvar\r\n  i: integer;\r\n  opt: TJSHTMLOptionElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if ElementHandle.tagName <> 'SELECT' then\r\n    Exit;\r\n\r\n  for i := TJSHTMLSelectElement(Container).options.length - 1 downto 0 do\r\n    TJSHTMLSelectElement(Container).remove(i);\r\n\r\n  for i := 0 to FItems.Count - 1 do\r\n  begin\r\n    opt := TJSHTMLOptionElement.New(FItems[i]);\r\n    opt['role'] := 'listitem';\r\n    if ElementItemClassName <> '' then\r\n      opt['class'] := ElementItemClassName;\r\n\r\n    if DragMode = dmAutomatic then\r\n      opt['draggable'] := 'true';\r\n    TJSHTMLSelectElement(Container).add(opt);\r\n    Selected[i] := false;\r\n  end;\r\n\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure TListBox.EnableDrag;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  for I := 0 to TJSHTMLSelectElement(Container).options.length - 1 do\r\n    TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[I]).Attrs['draggable'] := 'true';\r\nend;\r\n\r\nprocedure TListBox.EndUpdate;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\n{ TCustomComboBox }\r\n\r\nprocedure TCustomComboBox.AddItem(Item: string; AObject: TObject);\r\nbegin\r\n  FItems.AddObject(Item, AObject);\r\nend;\r\n\r\nprocedure TCustomComboBox.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.addEventListener('input', FHandleInputPtr);\r\n    ElementHandle.addEventListener('change', FHandleChangePtr);\r\n\r\n    ElementHandle.addEventListener('focusin', FHandleFocusInPtr);\r\n    ElementHandle.addEventListener('focusout', FHandleFocusOutPtr);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.UnBindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.removeEventListener('input', FHandleInputPtr);\r\n    ElementHandle.removeEventListener('change', FHandleChangePtr);\r\n\r\n    ElementHandle.removeEventListener('focusin', FHandleFocusInPtr);\r\n    ElementHandle.removeEventListener('focusout', FHandleFocusOutPtr);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.Clear;\r\nbegin\r\n  Items.Clear;\r\nend;\r\n\r\nprocedure TCustomComboBox.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleChangePtr := nil;\r\n  FHandleInputPtr := nil;\r\nend;\r\n\r\nprocedure TCustomComboBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FItems := TStringList.Create;\r\n  TStringList(FItems).OnChange := DoItemsChange;\r\n  FItemIndex := -1;\r\n  FStyle := csDropDownList;\r\n  ShowFocus := true;\r\n  Height := 25;\r\nend;\r\n\r\n\r\nfunction TCustomComboBox.CreateElement: TJSElement;\r\nbegin\r\n  if FStyle = csDropDownList then\r\n    Result := document.createElement('SELECT')\r\n  else\r\n  begin\r\n    Result := document.createElement('INPUT');\r\n    FListName := Name+'_LIST';\r\n    Result['list'] := FListName;\r\n  end;\r\nend;\r\n\r\ndestructor TCustomComboBox.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomComboBox.SetItems(AItems: TStrings);\r\nbegin\r\n  FItems.Assign(AItems);\r\nend;\r\n\r\nprocedure TCustomComboBox.SetStyle(const Value: TComboBoxStyle);\r\nbegin\r\n  if FStyle <> Value then\r\n  begin\r\n    FStyle := Value;\r\n    if not IsLinked then\r\n      RecreateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.SetText(const Value: string);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if Style = csDropDown then\r\n  begin\r\n    FText := Value;\r\n    UpdateElement;\r\n  end\r\n  else\r\n  begin\r\n    for I := 0 to Items.Count - 1 do\r\n    begin\r\n      if Value = Items[I] then\r\n        ItemIndex := I;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.SetTextHint(const Value: string);\r\nbegin\r\n  if (FTextHint <> Value) then\r\n  begin\r\n    FTextHint := Value;\r\n    DoUpdateList;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.UpdateElementData;\r\nvar\r\n  d: integer;\r\nbegin\r\n  inherited;\r\n\r\n  if Style = csDropDown then\r\n  begin\r\n    if Assigned(ElementHandle) then\r\n    begin\r\n      TJSHTMLInputELement(ElementHandle).Value := FText;\r\n\r\n      FListName := Name+'_LIST';\r\n      ElementHandle['list'] := FListName;\r\n    end;\r\n  end\r\n  else\r\n    if Assigned(ElementSelectHandle) then\r\n    begin\r\n      d := 0;\r\n      if (TextHint <> '') then\r\n        d := 1;\r\n\r\n      ElementSelectHandle.selectedIndex := FItemIndex + d;\r\n      ElementSelectHandle['role'] := 'combobox';\r\n    end;\r\nend;\r\n\r\nprocedure TCustomComboBox.UpdateParent;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nfunction TCustomComboBox.GetElementSelectHandle: TJSHTMLSelectElement;\r\nbegin\r\n  Result := TJSHTMLSelectElement(Container);\r\nend;\r\n\r\nfunction TCustomComboBox.GetItemIndex: integer;\r\nbegin\r\n  if Style = csDropDown then\r\n  begin\r\n    Result := Items.IndexOf(Text);\r\n  end\r\n  else\r\n  begin\r\n    Result := FItemIndex;\r\n\r\n    if Assigned(Container) then\r\n    begin\r\n      Result := TJSHTMLSelectElement(Container).selectedIndex;\r\n      if TextHint <> '' then\r\n        Result := Result - 1;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleChangePtr := @DoHandleChange;\r\n  FHandleInputPtr := @DoHandleInput;\r\n  FHandleFocusInPtr := @DoHandleFocusIn;\r\n  FHandleFocusOutPtr := @DoHandleFocusOut;\r\nend;\r\n\r\nfunction TCustomComboBox.GetText: string;\r\nbegin\r\n  Result := '';\r\n  if Style = csDropDown then\r\n  begin\r\n    if Assigned(ElementHandle) then\r\n      Result := TJSHTMLInputElement(ElementHandle).value;\r\n  end\r\n  else\r\n    if ItemIndex >= 0 then\r\n      Result := Items[ItemIndex]\r\nend;\r\n\r\nprocedure TCustomComboBox.Change;\r\nbegin\r\n  FItemIndex := GetItemIndex;\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TCustomComboBox.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nfunction TCustomComboBox.DoHandleFocusIn(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  if Assigned(OnFocusIn) then\r\n    OnFocusIn(Self);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomComboBox.DoHandleFocusOut(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  if Assigned(OnFocusOut) then\r\n    OnFocusOut(Self);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomComboBox.DoHandleInput(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  if Style = csDropDown then\r\n    Change;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TCustomComboBox.Loaded;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TCustomComboBox.LoadState(AState: string);\r\nvar\r\n  idx,e: integer;\r\nbegin\r\n  val(AState, idx, e);\r\n  if e = 0 then\r\n    ItemIndex := idx;\r\nend;\r\n\r\nprocedure TCustomComboBox.PersistinHTML;\r\nvar\r\n  sel: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n\r\n  sel := TJSHTMLElement(ElementHandle.children[ItemIndex]);\r\n  if Assigned(sel) then\r\n    sel.setAttribute('selected','selected');\r\nend;\r\n\r\nfunction TCustomComboBox.SaveState: string;\r\nbegin\r\n  Result := IntToStr(ItemIndex);\r\nend;\r\n\r\nprocedure TCustomComboBox.SetDroppedDown(const Value: Boolean);\r\nbegin\r\n  FDroppedDown := Value;\r\nend;\r\n\r\nprocedure TCustomComboBox.SetItemIndex(AIndex: integer);\r\nbegin\r\n  if (FItemIndex <> AIndex) then\r\n  begin\r\n    FItemIndex := AIndex;\r\n\r\n    if (AIndex >= 0) and (Style in [csDropDown, csDropDownList]) and (AIndex < Items.Count) then\r\n      FText := Items[AIndex];\r\n\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.DoItemsChange(Sender: TObject);\r\nbegin\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TCustomComboBox.AddTextHint;\r\nvar\r\n  opt: TJSElement;\r\n\r\nbegin\r\n  if (TextHint <> '') and (Style = csDropDownList) then\r\n  begin\r\n    opt := document.createElement('OPTION');\r\n    opt['value'] := '';\r\n    opt['disabled'] := 'true';\r\n    opt['selected'] := 'true';\r\n    opt['hidden'] := 'true';\r\n    opt.innerHTML := TextHint;\r\n    Container.appendChild(opt);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.DoUpdateList;\r\nvar\r\n  i,j: integer;\r\n  s,k,v: string;\r\n  opt: TJSElement;\r\n  el: TJSElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if ElementHandle.tagName = 'INPUT' then\r\n  begin\r\n    TJSHTMLInputElement(ElementHandle).value := Text;\r\n\r\n    el := document.getElementById(Name+'_LIST');\r\n    if Assigned(el) then\r\n      el.parentNode.removeChild(el);\r\n\r\n    if TextHint <> '' then\r\n      TJSHTMLInputElement(ElementHandle).placeholder := TextHint;\r\n\r\n    el := document.createElement('DATALIST');\r\n    el['id'] := FListName;\r\n    document.body.appendChild(el);\r\n\r\n    for i := 0 to FItems.Count - 1 do\r\n    begin\r\n      s := FItems[i];\r\n      opt := document.createElement('OPTION');\r\n\r\n      k := s;\r\n      v := s;\r\n      j := pos(FItems.NameValueSeparator,s);\r\n\r\n      if j > 0 then\r\n      begin\r\n        v := copy(s,1,j-1);\r\n        k := copy(s,j+1,$FFFF);\r\n      end;\r\n\r\n      opt['value'] := v;\r\n      opt.innerHTML := k;\r\n      el.appendChild(opt);\r\n    end;\r\n\r\n  end\r\n  else\r\n  begin\r\n    if ElementHandle.tagName <> 'SELECT' then\r\n      Exit;\r\n\r\n    for i := TJSHTMLSelectElement(Container).options.length - 1 downto 0 do\r\n      TJSHTMLSelectElement(Container).remove(i);\r\n\r\n    AddTextHint;\r\n\r\n    for i := 0 to FItems.Count - 1 do\r\n    begin\r\n      s := FItems[i];\r\n      opt := document.createElement('OPTION');\r\n\r\n      k := s;\r\n      v := s;\r\n      j := pos(FItems.NameValueSeparator,s);\r\n\r\n      if j > 0 then\r\n      begin\r\n        v := copy(s,1,j-1);\r\n        k := copy(s,j+1,$FFFF);\r\n      end;\r\n\r\n      opt['value'] := v;\r\n      opt.innerHTML := k;\r\n      Container.appendChild(opt);\r\n    end;\r\n  end;\r\n\r\n  UpdateElement;\r\nend;\r\n\r\n\r\n{ TFontPicker }\r\n\r\nprocedure TFontPicker.CreateInitialize;\r\nvar\r\n  tst: boolean;\r\n  \r\n  procedure Add(s: string);\r\n  begin\r\n    asm\r\n      tst = d.detect(s);\r\n    end;\r\n    if tst then\r\n      Self.Items.Add(s);\r\n  end;\r\n\r\nbegin\r\n  inherited;\r\n\r\n  asm\r\n    var Detector = function() {\r\n    // a font will be compared against all the three default fonts.\r\n    // and if it doesn't match all 3 then that font is not available.\r\n    var baseFonts = ['monospace', 'sans-serif', 'serif'];\r\n\r\n    //we use m or w because these two characters take up the maximum width.\r\n    // And we use a LLi so that the same matching fonts can get separated\r\n    var testString = \"mmmmmmmmmmlli\";\r\n\r\n    //we test using 72px font size, we may use any size. I guess larger the better.\r\n    var testSize = '72px';\r\n\r\n    var h = document.getElementsByTagName(\"body\")[0];\r\n\r\n    // create a SPAN in the document to get the width of the text we use to test\r\n    var s = document.createElement(\"span\");\r\n    s.style.fontSize = testSize;\r\n    s.innerHTML = testString;\r\n    var defaultWidth = {};\r\n    var defaultHeight = {};\r\n    for (var index in baseFonts) {\r\n        //get the default width for the three base fonts\r\n        s.style.fontFamily = baseFonts[index];\r\n        h.appendChild(s);\r\n        defaultWidth[baseFonts[index]] = s.offsetWidth; //width for the default font\r\n        defaultHeight[baseFonts[index]] = s.offsetHeight; //height for the defualt font\r\n        h.removeChild(s);\r\n    }\r\n\r\n    function detect(font) {\r\n        var detected = false;\r\n        for (var index in baseFonts) {\r\n            s.style.fontFamily = font + ',' + baseFonts[index]; // name of the font along with the base font for fallback.\r\n            h.appendChild(s);\r\n            var matched = (s.offsetWidth != defaultWidth[baseFonts[index]] || s.offsetHeight != defaultHeight[baseFonts[index]]);\r\n            h.removeChild(s);\r\n            detected = detected || matched;\r\n        }\r\n        return detected;\r\n    }\r\n\r\n    this.detect = detect;\r\n    };\r\n\r\n    var d = new Detector();\r\n    //tst = d.detect(\"Arial\");\r\n  end;\r\n\r\n  Add('Arial');\r\n  Add('Arial Black');\r\n  Add('Arial Narrow');\r\n  Add('Courier');\r\n  Add('Courier New');\r\n  Add('Georgia');\r\n  Add('Lucida Console');\r\n  Add('Modena');\r\n  Add('Monotype Corsiva');\r\n  Add('Papyrus');\r\n  Add('Tahoma');\r\n  Add('Times');\r\n  Add('Times New Roman');\r\n  Add('Trebuchet MS');\r\n  Add('Verdana');\r\n  Add('Verona');\r\nend;\r\n\r\n{ TFontSizePicker }\r\n\r\nprocedure TFontSizePicker.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  PickerMode := fmPointSize;\r\nend;\r\n\r\nprocedure TFontSizePicker.Init;\r\nbegin\r\n  Items.Clear;\r\n\r\n  case PickerMode of\r\n    fmPointSize:\r\n    begin\r\n      Items.Add('8');\r\n      Items.Add('9');\r\n      Items.Add('10');\r\n      Items.Add('11');\r\n      Items.Add('12');\r\n      Items.Add('14');\r\n      Items.Add('16');\r\n      Items.Add('18');\r\n      Items.Add('20');\r\n      Items.Add('22');\r\n      Items.Add('24');\r\n      Items.Add('26');\r\n      Items.Add('28');\r\n      Items.Add('36');\r\n      Items.Add('48');\r\n      Items.Add('72');\r\n    end;\r\n    fmRelativeSize:\r\n    begin\r\n      Items.Add('8');\r\n      Items.Add('9');\r\n      Items.Add('10');\r\n      Items.Add('14');\r\n      Items.Add('18');\r\n      Items.Add('24');\r\n      Items.Add('36');\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TFontSizePicker.SetPickerMode(const AValue: TFontSizePickerMode);\r\nbegin\r\n  FPickerMode := AValue;\r\n  Init;\r\nend;\r\n\r\n\r\n{ TCustomMemo }\r\n\r\nfunction TCustomMemo.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  FModified := true;\r\n  Change;\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomMemo.DoHandleCut(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  if not CanCut then\r\n  begin\r\n    asm\r\n      Event.preventDefault();\r\n      Event.stopPropagation();\r\n    end;\r\n  end;\r\n\r\n  Result := False;\r\nend;\r\n\r\nprocedure TCustomMemo.BindEvents;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.addEventListener('input', FHandleInputPtr);\r\n    ElementInputHandle.addEventListener('change', FHandleChangePtr);\r\n    ElementInputHandle.addEventListener('paste', FHandlePastePtr);\r\n    ElementInputHandle.addEventListener('cut', FHandleCutPtr);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.UnBindEvents;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.removeEventListener('input', FHandleInputPtr);\r\n    ElementInputHandle.removeEventListener('change', FHandleChangePtr);\r\n    ElementInputHandle.removeEventListener('paste', FHandlePastePtr);\r\n    ElementInputHandle.removeEventListener('cut', FHandleCutPtr);\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TCustomMemo.Change;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TCustomMemo.Clear;\r\nbegin\r\n  Lines.Clear;\r\nend;\r\n\r\nprocedure TCustomMemo.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleChangePtr := nil;\r\n  FHandleInputPtr := nil;\r\n  FHandlePastePtr := nil;\r\n  FHandleCutPtr := nil;\r\nend;\r\n\r\nprocedure TCustomMemo.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FSpellCheck := true;\r\n  FLines := TStringList.Create;\r\n  FLines.SkipLastLineBreak := true;\r\n  TStringList(FLines).OnChange := DoLinesChange;\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 400;\r\n    Height := 300;\r\n  end;\r\n  ShowFocus := true;\r\n  ClipChildren := false;\r\n  FWantTabs := false;\r\n  FAutoCompletion := acOff;\r\n  FWordWrap := true;\r\n  NoUserSelect := false;\r\nend;\r\n\r\nfunction TCustomMemo.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('TEXTAREA');\r\nend;\r\n\r\ndestructor TCustomMemo.Destroy;\r\nbegin\r\n  FLines.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TCustomMemo.DoHandleInput(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  GetText;\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nfunction TCustomMemo.DoHandlePaste(Event: TEventListenerEvent): Boolean;\r\nvar\r\n  s: string;\r\nbegin\r\n  asm\r\n    var clipboardData = Event.clipboardData || window.clipboardData;\r\n    s = clipboardData.getData('Text');\r\n  end;\r\n\r\n  if not CanPaste(s) then\r\n  begin\r\n    asm\r\n      Event.preventDefault();\r\n      Event.stopPropagation();\r\n    end;\r\n  end;\r\n\r\n  Result:= false;\r\nend;\r\n\r\nprocedure TCustomMemo.DoLinesChange(Sender: TObject);\r\nbegin\r\n  if Assigned(ElementInputHandle) and not FBlockChange then\r\n  begin\r\n    ElementInputHandle.value := GetDisplayText;\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n   end;\r\nend;\r\n\r\nfunction TCustomMemo.CanCut: boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TCustomMemo.CanPaste(AValue: string): boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TCustomMemo.SaveState: string;\r\nbegin\r\n  Result := Lines.Text;\r\nend;\r\n\r\nprocedure TCustomMemo.SetAutoCompletion(const Value: TAutoCompletion);\r\nbegin\r\n  if (FAutoCompletion <> Value) then\r\n  begin\r\n    FAutoCompletion := Value;\r\n    UpdateElementData;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetAutoSize(const Value: Boolean);\r\nbegin\r\n  if FAutoSize <> Value then\r\n  begin\r\n    FAutoSize := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetLines(ALines: TStrings);\r\nbegin\r\n  FLines.Assign(ALines);\r\nend;\r\n\r\nprocedure TCustomMemo.SetReadOnly(const Value: boolean);\r\nbegin\r\n  if (FReadOnly <> Value) then\r\n  begin\r\n    FReadOnly := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetSelLength(const Value: Integer);\r\nbegin\r\n  if FSelLength <> Value then\r\n  begin\r\n    FSelLength := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetSelStart(const Value: Integer);\r\nbegin\r\n  if FSelStart <> Value then\r\n  begin\r\n    FSelStart := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetSpellCheck(const Value: boolean);\r\nbegin\r\n  if FSpellCheck <> Value then\r\n  begin\r\n    FSpellCheck := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetText(const Value: String);\r\nbegin\r\n  FLines.Text := Value;\r\nend;\r\n\r\nprocedure TCustomMemo.SetTextHint(const Value: string);\r\nbegin\r\n  if FTextHint <> Value then\r\n  begin\r\n    FTextHint := Value;\r\n    UpdateElement;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TCustomMemo.SetWantTabs(const Value: boolean);\r\nbegin\r\n  if (FWantTabs <> Value) then\r\n  begin\r\n    FWantTabs := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetWordWrap(const Value: Boolean);\r\nbegin\r\n  if (FWordWrap <> Value) then\r\n  begin\r\n    FWordWrap := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TCustomMemo.UpdateElementData;\r\nvar\r\n  ss,sl: integer;\r\n  e: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) and not FBlockChange then\r\n  begin\r\n    ElementInputHandle.value := GetDisplayText;\r\n\r\n    if (ElementInputHandle.TagName = 'TEXTAREA') then\r\n    begin\r\n      ElementInputHandle.setSelectionRange(SelStart, SelStart + SelLength);\r\n    end;\r\n\r\n    if not IsLinked then\r\n    begin\r\n      ElementInputHandle.style.setProperty('resize', 'none');\r\n    end;\r\n\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n\r\n    if TextHint <> '' then\r\n      ElementInputHandle.placeholder := TextHint;\r\n\r\n    if not isLinked then\r\n    begin\r\n      if AutoCompletion = acNone then\r\n      begin\r\n        TJSHTMLElement(ElementInputHandle).setAttribute('autocomplete','none');\r\n        TJSHTMLElement(ElementInputHandle).removeAttribute('name');\r\n      end\r\n      else\r\n      if AutoCompletion <> acOff then\r\n      begin\r\n        TJSHTMLElement(ElementInputHandle).setAttribute('autocomplete','on');\r\n        TJSHTMLElement(ElementInputHandle).setAttribute('name', GetAutoCompletionName(AutoCompletion));\r\n      end\r\n      else\r\n      begin\r\n        TJSHTMLElement(ElementInputHandle).removeAttribute('autocomplete');\r\n        TJSHTMLElement(ElementInputHandle).removeAttribute('name');\r\n      end;\r\n\r\n      ss := FSelStart;\r\n      sl := FSelStart + FSelLength;\r\n      e := ElementInputHandle;\r\n      asm\r\n        setTimeout(function() {\r\n          e.setSelectionRange(ss, sl);\r\n        }, 1);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TCustomMemo.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) and not FBlockChange and not IsLinked then\r\n  begin\r\n    ElementInputHandle.style.setProperty('overflow', 'auto');\r\n    ElementInputHandle.style.setProperty('margin', '0');\r\n\r\n    if (Color <> clNone) and (Color <> clWindow) then\r\n      ElementInputHandle.style.setProperty('background-color', ColorToHtml(Color))\r\n    else\r\n      ElementInputHandle.style.removeProperty('background-color');\r\n\r\n    if not SpellCheck then\r\n      ElementInputHandle['spellcheck'] := 'false'\r\n    else\r\n      if ElementInputHandle.hasAttribute('spellcheck') then\r\n        ElementInputHandle.removeAttribute('spellcheck');\r\n\r\n    if not WordWrap then\r\n      ElementInputHandle['wrap'] := 'off'\r\n    else\r\n      if ElementInputHandle.hasAttribute('wrap') then\r\n        ElementInputHandle.removeAttribute('wrap');\r\n  end;\r\nend;\r\n\r\nfunction TCustomMemo.GetText: String;\r\nbegin\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    FBlockChange := True;\r\n    FLines.Text := ElementInputHandle.value;\r\n    FBlockChange := False;\r\n  end;\r\n\r\n  Result := FLines.Text;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TCustomMemo.HandleDoKeyDown(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  if (GetKeyCode(Event.Key) = 9) and WantTabs then\r\n  begin\r\n    eh := ElementInputHandle;\r\n\r\n    asm\r\n      var sstart = eh.selectionStart;\r\n      var send = eh.selectionEnd;\r\n\r\n      eh.value = eh.value.substring(0, sstart) + \"\\t\" +eh.value.substring(send);\r\n      // put caret at right position again\r\n      eh.selectionStart = eh.selectionEnd = sstart + 1;\r\n\r\n      Event.stopPropagation();\r\n      Event.preventDefault();\r\n    end;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction TCustomMemo.IsInputControl: Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TCustomMemo.IsReadOnly: boolean;\r\nbegin\r\n  Result := FReadOnly;\r\nend;\r\n\r\nprocedure TCustomMemo.LoadState(AState: string);\r\nbegin\r\n  Lines.Text := AState;\r\nend;\r\n\r\nprocedure TCustomMemo.PersistinHTML;\r\nbegin\r\n  ElementInputHandle.innerHTML := Lines.Text;\r\nend;\r\n\r\nfunction TCustomMemo.GetDisplayText: string;\r\nbegin\r\n  Result := FLines.Text;\r\nend;\r\n\r\nfunction TCustomMemo.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nprocedure TCustomMemo.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleChangePtr := @DoHandleChange;\r\n  FHandleInputPtr := @DoHandleInput;\r\n  FHandlePastePtr := @DoHandlePaste;\r\n  FHandleCutPtr := @DoHandleCut;\r\nend;\r\n\r\nfunction TCustomMemo.GetSelLength: Integer;\r\nbegin\r\n  Result := -1;\r\n  if Assigned(ElementInputHandle) then\r\n    Result := ElementInputHandle.selectionEnd - ElementInputHandle.selectionStart;\r\nend;\r\n\r\nfunction TCustomMemo.GetSelStart: Integer;\r\nbegin\r\n  Result := -1;\r\n  if Assigned(ElementInputHandle) then\r\n    Result := ElementInputHandle.selectionStart;\r\nend;\r\n\r\n{ TControlGroup }\r\n\r\nprocedure TControlGroup.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FColumns := 1;\r\n  FControls := TList.Create;\r\n  FItems := TStringList.Create;\r\n  TStringList(FItems).OnChange := DoItemsChange;\r\n  //BorderWidth := 1;\r\n  FOldCount := -1;\r\n  FControlPosition := epAbsolute;\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 200;\r\n    Height := 200;\r\n  end;\r\nend;\r\n\r\nprocedure TControlGroup.Change;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TControlGroup.CreateGroupControl(ALeft, ATop, AIndex: integer;\r\n  ACaption: string; APosition: TElementPosition; AState, AEnabled: boolean): TCustomControl;\r\nbegin\r\n  //\r\n  Result := nil;\r\nend;\r\n\r\nfunction TControlGroup.CreateElement: TJSElement;\r\nvar\r\n  legend: TJSElement;\r\nbegin\r\n  Result := document.createElement('FIELDSET');\r\n  legend := document.createElement('LEGEND');\r\n  Result.appendChild(legend);\r\n  legend.innerHTML := Caption;\r\n  legend['class'] := 'w-auto ' + ElementLegendClassName;\r\n\r\n  if Caption = '' then\r\n    TJSHTMLElement(legend).style.setProperty('display', 'none')\r\n  else\r\n    TJSHTMLElement(legend).style.setProperty('display', '');\r\n\r\n  TJSHTMLElement(legend).style.setProperty('float', 'none');\r\n\r\n  TJSHTMLElement(Result).style.setProperty('display', 'inline-block');\r\n\r\n  TJSHTMLElement(Result).style.setProperty('-webkit-padding-before','0px');\r\n  TJSHTMLElement(Result).style.setProperty('-webkit-padding-after','0px');\r\n  TJSHTMLElement(Result).style.setProperty('-webkit-padding-end','0px');\r\n  TJSHTMLElement(Result).style.setProperty('-webkit-padding-start','0px');\r\n  TJSHTMLElement(Result).style.setProperty('border','1px');\r\nend;\r\n\r\ndestructor TControlGroup.Destroy;\r\nbegin\r\n  FControls.Free;\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TControlGroup.Loaded;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TControlGroup.SetCaption(const AValue: string);\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  inherited SetCaption(AValue);\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  el := TJSHTMLElement(Container.firstElementChild);\r\n\r\n  if Assigned(el) then\r\n  begin\r\n    el.innerHTML := AValue;\r\n\r\n    if AValue = '' then\r\n      el.style.setProperty('display', 'none')\r\n    else\r\n      el.style.setProperty('display', '');\r\n  end;\r\nend;\r\n\r\nprocedure TControlGroup.SetColumns(AValue: integer);\r\nbegin\r\n  if (FColumns > 0) and (FColumns <> AValue) then\r\n  begin\r\n    FColumns := AValue;\r\n    DoUpdateList;\r\n  end;\r\nend;\r\n\r\nprocedure TControlGroup.SetControlPosition(const Value: TElementPosition);\r\nbegin\r\n  if (FControlPosition <> Value) then\r\n  begin\r\n    FControlPosition := Value;\r\n    DoUpdateList;\r\n  end;\r\nend;\r\n\r\nprocedure TControlGroup.SetEnabled(Value: Boolean);\r\nvar\r\n  i: integer;\r\nbegin\r\n  inherited;\r\n  for i := 0 to FControls.Count - 1 do\r\n  begin\r\n    TCustomControl(FControls.Items[i]).Enabled := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TControlGroup.SetHeight(AValue: Integer);\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TControlGroup.SetItems(AItems: TStrings);\r\nbegin\r\n  FItems.Assign(AItems);\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TControlGroup.SetWidth(AValue: Integer);\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nfunction TControlGroup.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TControlGroup.DoHandleClick(AControl: TCustomControl);\r\nbegin\r\n  Change;\r\nend;\r\n\r\nprocedure TControlGroup.DoItemsChange(Sender: TObject);\r\nbegin\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TControlGroup.DoControlClick(Sender: TObject);\r\nbegin\r\n  DoHandleClick((Sender as TCustomControl));\r\nend;\r\n\r\nprocedure TControlGroup.DoUpdateList;\r\nvar\r\n  i: integer;\r\n  s: string;\r\n  rd: TCustomControl;\r\n  dx, dy, dc, col, row, ypos: integer;\r\n  legend: TJSElement;\r\n  chk: array of boolean;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if FItems.Count = 0 then\r\n    Exit;\r\n\r\n  dy := Round(Font.Size * 2.5);\r\n  dx := Width div FColumns;\r\n  if Caption <> '' then\r\n    dc := Font.Size\r\n  else\r\n    dc := 4;\r\n\r\n  col := 0;\r\n  row := 0;\r\n\r\n  if FOldCount > 0 then\r\n    setLength(chk, FOldCount);\r\n\r\n  for i := 0 to FOldCount - 1 do\r\n  begin\r\n    rd := TCustomControl(FControls[i]);\r\n\r\n    if rd is TRadioButton then\r\n      chk[i] := (rd as TRadioButton).Checked;\r\n    if rd is TCheckBox then\r\n      chk[i] := (rd as TCheckBox).Checked;\r\n\r\n    rd.Free;\r\n  end;\r\n  FControls.Clear;\r\n\r\n  while Container.childElementCount > 0 do\r\n    Container.removeChild(Container.firstChild);\r\n\r\n  if Caption <> '' then\r\n  begin\r\n    legend := document.createElement('LEGEND');\r\n    ElementHandle.appendChild(legend);\r\n    legend.innerHTML := Caption;\r\n    legend['class'] := 'w-auto ' + ElementLegendClassName;\r\n\r\n    TJSHTMLElement(legend).style.setProperty('float','none');\r\n\r\n    SetHTMLElementFont(TJSHTMLElement(legend), Font, not((ElementFont = efProperty) and (ElementClassName = '')));\r\n  end;\r\n\r\n  if ElementGroupClassName <> '' then\r\n    ElementHandle.setAttribute('class', ElementGroupClassName)\r\n  else\r\n    ElementHandle.setAttribute('class','border p-2');\r\n\r\n  TJSHTMLElement(Container).style.setProperty('margin','0px');\r\n\r\n  for i := 0 to FItems.Count - 1 do\r\n  begin\r\n    ypos := dc + row * dy;\r\n    s := FItems[i];\r\n    rd := CreateGroupControl(4 + col * dx, ypos, i, s, ControlPosition, GetGroupControlState(i), true);\r\n    rd.Enabled := Enabled;\r\n    FControls.Add(rd);\r\n\r\n    if i <= FOldCount then\r\n    begin\r\n      if rd is TRadioButton then\r\n        (rd as TRadioButton).Checked := chk[i];\r\n      if rd is TCheckBox then\r\n        (rd as TCheckBox).Checked := chk[i];\r\n    end;\r\n\r\n    if not IsLinked then\r\n    begin\r\n      TJSHTMLElement(rd.Container).style.setProperty('float', 'left');\r\n      TJSHTMLElement(rd.Container).style.setProperty('width',  IntToStr(Trunc(100 / FColumns) - 5) + '%');\r\n    end;\r\n\r\n    if i mod FColumns = 0 then\r\n      TJSHTMLElement(rd.Container).style.setProperty('clear', 'left');\r\n\r\n    ElementHandle.appendChild(rd.Container);\r\n\r\n    if col < FColumns - 1 then\r\n      inc(col)\r\n    else\r\n    begin\r\n      col := 0;\r\n      inc(row);\r\n    end;\r\n  end;\r\n\r\n  FOldCount := Items.Count;\r\nend;\r\n\r\nprocedure TControlGroup.EndUpdate;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\n\r\nfunction TControlGroup.GetGroupControl(AIndex: integer): TCustomControl;\r\nbegin\r\n  Result := TCustomControl(FControls[AIndex]);\r\nend;\r\n\r\nfunction TControlGroup.GetGroupControlState(AIndex: integer): boolean;\r\nbegin\r\n  Result := false;\r\nend;\r\n\r\nfunction TRadioGroup.CreateGroupControl(ALeft, ATop, AIndex: integer;\r\n  ACaption: string; APosition: TElementPosition; AState, AEnabled: boolean): TCustomControl;\r\nvar\r\n  rd: TRadioButton;\r\n  id: string;\r\nbegin\r\n  id := GetID;\r\n  if (id = '') then\r\n    id := Name;\r\n\r\n  rd := TRadioButton.Create(id + IntToStr(AIndex));\r\n  rd.ElementPosition := APosition;\r\n  rd.ElementFont := ElementFont;\r\n  rd.ElementClassName := ElementClassName;\r\n  rd.ElementButtonClassName := ElementButtonClassName;\r\n  rd.ElementLabelClassName := ElementLabelClassName;\r\n  rd.HeightStyle := ssAuto;\r\n  rd.ParentFont := false;\r\n  rd.Font.Assign(Font);\r\n  rd.Parent := Self;\r\n  rd.Caption := ACaption;\r\n  rd.GroupName := id;\r\n  rd.Top := ATop; //dc + row * dy;\r\n  rd.Left := ALeft; //4 + col * dx;\r\n  rd.WidthStyle := ssAuto;\r\n  rd.WidthPercent := 100;\r\n  rd.OnClick := DoControlClick;\r\n  rd.Checked := AState;\r\n  rd.Enabled := AEnabled;\r\n  rd.Tag := AIndex;\r\n  rd.TabStop := true;\r\n  Result := rd;\r\nend;\r\n\r\nprocedure TRadioGroup.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FItemIndex := -1;\r\n  FOldItemIndex := -2;\r\nend;\r\n\r\nprocedure TRadioGroup.DoHandleClick(AControl: TCustomControl);\r\nbegin\r\n  if ItemIndex = FOldItemIndex then\r\n    Exit;\r\n\r\n  Change;\r\n\r\n  FOldItemIndex := ItemIndex;\r\nend;\r\n\r\nfunction TRadioGroup.GetGroupControlState(AIndex: integer): boolean;\r\nbegin\r\n  Result := AIndex = FItemIndex;\r\nend;\r\n\r\nfunction TRadioGroup.GetItemIndex: integer;\r\nvar\r\n  el: TJSElement;\r\n  i: integer;\r\nbegin\r\n  Result := FItemIndex;\r\n\r\n  for i := 0 to FItems.Count -1 do\r\n  begin\r\n    el := document.getElementByID(GetID + IntToStr(i) + 'rd');\r\n    if Assigned(el) then\r\n    begin\r\n      if TJSHTMLInputElement(el).checked then\r\n        Result := i;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TRadioGroup.LoadState(AState: string);\r\nvar\r\n  idx,e: integer;\r\nbegin\r\n  val(AState, idx, e);\r\n\r\n  if (e = 0) then\r\n    ItemIndex := idx;\r\nend;\r\n\r\nfunction TRadioGroup.SaveState: string;\r\nbegin\r\n  Result := IntToStr(ItemIndex);\r\nend;\r\n\r\nprocedure TRadioGroup.SetFocus;\r\nvar\r\n  idx: integer;\r\n  rd: TRadioButton;\r\nbegin\r\n  if Items.Count = 0 then\r\n    Exit;\r\n\r\n  idx := ItemIndex;\r\n  if idx < 0 then\r\n    idx := 0;\r\n\r\n  rd := TRadioButton(GetGroupControl(idx));\r\n  if Assigned(rd) then\r\n    rd.SetFocus;\r\nend;\r\n\r\nprocedure TRadioGroup.SetItemIndex(AIndex: integer);\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  // clear selection\r\n  if (AIndex = -1) and (ItemIndex >= 0) then\r\n  begin\r\n    el := document.getElementByID(GetID + IntToStr(ItemIndex) + 'rd');\r\n\r\n    if Assigned(el) then\r\n      TJSHTMLInputElement(el).checked := False;\r\n\r\n    FItemIndex := -1;\r\n  end\r\n  else\r\n  begin\r\n    // new selection\r\n    FItemIndex := AIndex;\r\n    if (AIndex >= 0) and (AIndex < Items.Count) then\r\n    begin\r\n      el := document.getElementByID(GetID + IntToStr(AIndex) + 'rd');\r\n      if Assigned(el) then\r\n        TJSHTMLInputElement(el).checked := True;\r\n    end;\r\n  end;\r\nend;\r\n\r\n\r\n\r\n{ TColorPicker }\r\n\r\nprocedure TColorPicker.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleChangePtr := nil;\r\nend;\r\n\r\nprocedure TColorPicker.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FColor := clBlack;\r\nend;\r\n\r\nprocedure TColorPicker.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.addEventListener('input', FHandleChangePtr);\r\n  end;\r\nend;\r\n\r\nfunction TColorPicker.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nprocedure TColorPicker.UnBindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.removeEventListener('input', FHandleChangePtr);\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TColorPicker.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('padding','0px'); \r\n    ElementHandle.style.setProperty('width', IntToStr(Width - 2) + 'px');\r\n    ElementHandle.style.setProperty('height',IntToStr(Height - 2) + 'px');\r\n  end;\r\nend;\r\n\r\nfunction TColorPicker.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin   \r\n  Select;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TColorPicker.Select;\r\nbegin\r\n  if Assigned(OnSelect) then\r\n    OnSelect(Self);\r\nend;\r\n\r\nfunction TColorPicker.GetColor: TColor;\r\nbegin\r\n  Result := FColor;\r\n\r\n  if Assigned(Container) then\r\n    Result := HexToColor(TJSHTMLInputElement(Container).value);\r\nend;\r\n\r\nprocedure TColorPicker.SetColor(AValue: TColor);\r\nbegin\r\n  FColor := AValue;\r\n\r\n  if Assigned(Container) then\r\n    TJSHTMLInputElement(Container).value := ColorToHTML(AValue);\r\nend;\r\n\r\nfunction TColorPicker.GetInputType: string;\r\nbegin \r\n  Result := 'COLOR';\r\nend;\r\n\r\nprocedure TColorPicker.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleChangePtr := @DoHandleChange;\r\nend;\r\n\r\n{ TScrollBar }\r\n\r\nprocedure TScrollBar.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  TabStop := True;\r\n  FKind := sbHorizontal;\r\n  FPosition := 0;\r\n  FMin := 0;\r\n  FMax := 100;\r\n  FSmallChange := 1;\r\n  FLargeChange := 1;\r\n\r\n  FContent := TScrollBarContent.Create(Self);\r\n  FContent.Parent := Self;\r\n  FContent.Width := 121;\r\n  FContent.Height := 17;\r\n\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 121;\r\n    Height := 17;\r\n  end;\r\n\r\n  UpdateContent;\r\nend;\r\n\r\nprocedure TScrollBar.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n    ElementHandle.addEventListener('scroll', FScrollPtr);\r\nend;\r\n\r\nprocedure TScrollBar.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FScrollPtr := nil;\r\nend;\r\n\r\nfunction TScrollBar.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\ndestructor TScrollBar.Destroy;\r\nbegin\r\n  FContent.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TScrollBar.DoScroll(Event: TJSUIEvent): Boolean;\r\nbegin\r\n  FScrolling := True;\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\n\r\n  FScrolling := False;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TScrollBar.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n  FScrollPtr := @DoScroll;\r\nend;\r\n\r\nfunction TScrollBar.GetPageSize: Integer;\r\nbegin\r\n  Result := FPageSize;\r\n  if Result = 0 then\r\n    Result := 25;\r\nend;\r\n\r\nfunction TScrollBar.GetValue(XYPos: Double): Double;\r\nbegin\r\n  Result := 0;\r\n  if Assigned(FContent) then\r\n  begin\r\n    case Kind of\r\n      sbHorizontal:\r\n      begin\r\n        if FContent.Width > 0 then\r\n          Result := (XYPos / FContent.Width) * (Max - Min)\r\n      end;\r\n      sbVertical:\r\n      begin\r\n        if FContent.Height > 0 then\r\n          Result := (XYPos / FContent.Height) * (Max - Min);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TScrollBar.GetPosition: Integer;\r\nbegin\r\n  Result := 0;\r\n  if Assigned(Element) then\r\n  begin\r\n    case Kind of\r\n      sbHorizontal: Result := Round(GetValue(Element.scrollLeft));\r\n      sbVertical: Result := Round(GetValue(Element.scrollTop));\r\n    end;\r\n  end\r\n  else\r\n    Result := FPosition;\r\nend;\r\n\r\nprocedure TScrollBar.Loaded;\r\nbegin\r\n  inherited;\r\n  UpdateContent;\r\nend;\r\n\r\nprocedure TScrollBar.SetBounds(X, Y, AWidth, AHeight: Integer);\r\nbegin\r\n  inherited;\r\n  UpdateContent;\r\nend;\r\n\r\nprocedure TScrollBar.SetKind(const Value: TScrollBarKind);\r\nbegin\r\n  if FKind <> Value then\r\n  begin\r\n    FKind := Value;\r\n//    if not (csLoading in ComponentState) then\r\n    begin\r\n      case Kind of\r\n        sbHorizontal:\r\n        begin\r\n          SetBounds(Left, Top, Height, 17)\r\n        end;\r\n        sbVertical:\r\n        begin\r\n          SetBounds(Left, Top, 17, Width)\r\n        end;\r\n      end;\r\n    end;\r\n    UpdateElement;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.SetMax(const Value: Integer);\r\nbegin\r\n  if FMax <> Value then\r\n  begin\r\n    FMax := Value;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.SetMin(const Value: Integer);\r\nbegin\r\n  if FMin <> Value then\r\n  begin\r\n    FMin := Value;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.SetPageSize(const Value: Integer);\r\nbegin\r\n  if FPageSize <> Value then\r\n  begin\r\n    FPageSize := Value;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.SetPosition(const Value: Integer);\r\nbegin\r\n  if FPosition <> Value then\r\n  begin\r\n    FPosition := Value;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('overflow', 'auto');\r\n    case Kind of\r\n      sbHorizontal:\r\n      begin\r\n        ElementHandle.style.setProperty('overflow-y', 'hidden');\r\n        ElementHandle.style.setProperty('overflow-x', '');\r\n      end;\r\n      sbVertical:\r\n      begin\r\n        ElementHandle.style.setProperty('overflow-y', '');\r\n        ElementHandle.style.setProperty('overflow-x', 'hidden');\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.UnBindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n    ElementHandle.removeEventListener('scroll', FScrollPtr);\r\nend;\r\n\r\nprocedure TScrollBar.UpdateContent;\r\nvar\r\n  x, y, w, h: Integer;\r\n  ps: Integer;\r\n  v: Single;\r\nbegin\r\n  if not Assigned(FContent) or not Assigned(ElementHandle) or FScrolling then\r\n    Exit;\r\n\r\n  ps := PageSize;\r\n  v := (Max - Min) / ps;\r\n\r\n  case Kind of\r\n    sbHorizontal:\r\n    begin\r\n      y := 0;\r\n      h := Height;\r\n      w := Round(v * Width);\r\n      x := Round(((FPosition - Min) / (Max - Min)) * w);\r\n    end;\r\n    sbVertical:\r\n    begin\r\n      x := 0;\r\n      w := Width;\r\n      h := Round(v * Height);\r\n      y := Round(((FPosition - Min) / (Max - Min)) * h);\r\n    end;\r\n  end;\r\n\r\n  FContent.SetBounds(0, 0, w, h);\r\n  ElementHandle.scrollLeft := x;\r\n  ElementHandle.scrollTop := y;\r\nend;\r\n\r\n{ TScrollBarContent }\r\n\r\nfunction TScrollBarContent.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\n{ TCheckGroup }\r\n\r\nfunction TCheckGroup.CreateGroupControl(ALeft, ATop, AIndex: integer;\r\n  ACaption: string; APosition: TElementPosition; AState, AEnabled: boolean): TCustomControl;\r\nvar\r\n  cb: TCheckBox;\r\n  id: string;\r\nbegin\r\n  id := GetID;\r\n  if id = '' then\r\n    id := Name;\r\n\r\n  cb := TCheckBox.Create(id + IntToStr(AIndex));\r\n  cb.Caption := ACaption;\r\n  cb.ElementPosition := APosition;\r\n  cb.ElementFont := ElementFont;\r\n  cb.ElementClassName := ElementClassName;\r\n  cb.ElementButtonClassName := ElementButtonClassName;\r\n  cb.ElementLabelClassName := ElementLabelClassName;\r\n  cb.ParentFont := false;\r\n  cb.Font.Assign(Font);\r\n  cb.Parent := Self;\r\n  cb.Top := ATop;\r\n  cb.Left := ALeft;\r\n  cb.WidthStyle := ssPercent;\r\n  cb.WidthPercent := 100;\r\n  cb.HeightStyle := ssAuto;\r\n\r\n  cb.OnCheckClick := DoControlClick;\r\n  cb.Checked := AState;\r\n  cb.Enabled := AEnabled;\r\n  cb.Tag := AIndex;\r\n  cb.TabStop := true;\r\n  Result := cb;\r\nend;\r\n\r\nprocedure TCheckGroup.CreateInitialize;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TCheckGroup.DoHandleClick(AControl: TCustomControl);\r\nbegin\r\n  inherited;\r\n  if Assigned(OnCheckClick) then\r\n    OnCheckClick(Self, AControl.Tag);\r\nend;\r\n\r\nfunction TCheckGroup.GetChecked(AIndex: integer): boolean;\r\nbegin\r\n  Result := (GetGroupControl(AIndex) as TCheckBox).Checked;\r\nend;\r\n\r\nfunction TCheckGroup.GetGroupControlState(AIndex: integer): boolean;\r\nbegin\r\n  Result := false;\r\nend;\r\n\r\nprocedure TCheckGroup.LoadState(AState: string);\r\nvar\r\n  sl: TStringList;\r\n  i: integer;\r\nbegin\r\n  sl := TStringList.Create;\r\n  sl.Delimiter := ',';\r\n  sl.CommaText := AState;\r\n\r\n  for i := 0 to sl.Count - 1 do\r\n  begin\r\n    Checked[i] := sl.Strings[i] = '1';\r\n  end;\r\n\r\n  sl.Free;\r\nend;\r\n\r\nfunction TCheckGroup.SaveState: string;\r\nvar\r\n  i: integer;\r\n  s: string;\r\nbegin\r\n  s := '';\r\n  for i := 0 to Items.Count - 1 do\r\n  begin\r\n    if Checked[i] then\r\n      s := s + ',1'\r\n    else\r\n      s := s + ',0';\r\n  end;\r\n\r\n  Delete(s,1,1);\r\n  Result := s;\r\nend;\r\n\r\nprocedure TCheckGroup.SetChecked(AIndex: integer; const Value: boolean);\r\nbegin\r\n  (GetGroupControl(AIndex) as TCheckBox).Checked := Value;\r\nend;\r\n\r\nprocedure TCheckGroup.SetFocus;\r\nvar\r\n  cb: TCheckBox;\r\nbegin\r\n  if Items.Count > 0 then\r\n  begin\r\n    cb := TCheckBox(GetGroupControl(0));\r\n    if Assigned(cb) then\r\n      cb.SetFocus;\r\n  end;\r\nend;\r\n\r\n\r\n{ TLineSpacingPicker }\r\n\r\nprocedure TLineSpacingPicker.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Items.Clear;\r\n  Items.Add('1');\r\n  Items.Add('1.5');\r\n  Items.Add('2');\r\nend;\r\n\r\nend.\r\n","unit Unit1;\r\n\r\ninterface\r\n\r\nuses\r\n  System.SysUtils,\r\n  System.Classes,\r\n  System.Math,\r\n\r\n  JS,\r\n  Web,\r\n\r\n  WEBLib.Graphics,\r\n  WEBLib.Controls,\r\n  WEBLib.Forms,\r\n  WEBLib.Dialogs,\r\n  WEBLib.WebCtrls,\r\n\r\n  Vcl.Controls, Vcl.StdCtrls, WEBLib.StdCtrls;\r\n\r\ntype\r\n  TForm1 = class(TForm)\r\n    divMain: THTMLDiv;\r\n    divFooter: THTMLDiv;\r\n    divHeader: THTMLDiv;\r\n    btnPrevious: TButton;\r\n    btnNext: TButton;\r\n    divTitle: THTMLDiv;\r\n    divSubTitle: THTMLDiv;\r\n    btnAbout: TButton;\r\n    btnMessage: TButton;\r\n    divMiddle: THTMLDiv;\r\n    divAbout: THTMLDiv;\r\n    divFeedback: THTMLDiv;\r\n    divFeedbackHeader: THTMLDiv;\r\n    divFeedbackTitle: THTMLDiv;\r\n    btnFeedbackAbout: TButton;\r\n    btnFeedbackFeedback: TButton;\r\n    divBottomFeedback: THTMLDiv;\r\n    btnSubmitFeedback: TButton;\r\n    btnCancelFeedback: TButton;\r\n    divAboutHeader: THTMLDiv;\r\n    divAboutTitle: THTMLDiv;\r\n    btnAboutAbout: TButton;\r\n    btnAboutMessage: TButton;\r\n    divAboutFooter: THTMLDiv;\r\n    btnAboutOK: TButton;\r\n    divAboutContent: THTMLDiv;\r\n    divFeedbackForm: THTMLDiv;\r\n    procedure WebFormResize(Sender: TObject);\r\n    procedure btnMessageClick(Sender: TObject);\r\n    procedure btnSubmitFeedbackClick(Sender: TObject);\r\n    procedure btnCancelFeedbackClick(Sender: TObject);\r\n    procedure btnAboutClick(Sender: TObject);\r\n    procedure btnAboutOKClick(Sender: TObject);\r\n    procedure WebFormCreate(Sender: TObject);\r\n  private\r\n    { Private declarations }\r\n  public\r\n    { Public declarations }\r\n    MainState: String;\r\n    SurveyState: String;\r\n  protected procedure LoadDFMValues; override; end;\r\n\r\nvar\r\n  Form1: TForm1;\r\n\r\nimplementation\r\n\r\n{$R *.dfm}\r\n\r\nprocedure TForm1.btnAboutClick(Sender: TObject);\r\nbegin\r\n  divMain.ElementHandle.classList.add('HideTransition');\r\n  divMain.ElementHandle.classList.remove('ShowTransition');\r\n  divFeedback.ElementHandle.classList.add('HideTransition');\r\n  divFeedback.ElementHandle.classList.remove('ShowTransition');\r\n  divAbout.ElementHandle.classList.add('ShowTransition');\r\n  divAbout.ElementHandle.classList.remove('HideTransition');\r\nend;\r\n\r\nprocedure TForm1.btnAboutOKClick(Sender: TObject);\r\nbegin\r\n  divAbout.ElementHandle.classList.add('HideTransition');\r\n  divAbout.ElementHandle.classList.remove('ShowTransition');\r\n  divFeedback.ElementHandle.classList.add('HideTransition');\r\n  divFeedback.ElementHandle.classList.remove('ShowTransition');\r\n  divMain.ElementHandle.classList.add('ShowTransition');\r\n  divMain.ElementHandle.classList.remove('HideTransition');\r\nend;\r\n\r\nprocedure TForm1.btnCancelFeedbackClick(Sender: TObject);\r\nbegin\r\n  divFeedback.ElementHandle.classList.add('HideTransition');\r\n  divFeedback.ElementHandle.classList.remove('ShowTransition');\r\n  divAbout.ElementHandle.classList.add('HideTransition');\r\n  divAbout.ElementHandle.classList.remove('ShowTransition');\r\n  divMain.ElementHandle.classList.add('ShowTransition');\r\n  divMain.ElementHandle.classList.remove('HideTransition');\r\nend;\r\n\r\nprocedure TForm1.btnMessageClick(Sender: TObject);\r\nbegin\r\n  divMain.ElementHandle.classList.add('HideTransition');\r\n  divMain.ElementHandle.classList.remove('ShowTransition');\r\n  divAbout.ElementHandle.classList.add('HideTransition');\r\n  divAbout.ElementHandle.classList.remove('ShowTransition');\r\n  divFeedback.ElementHandle.classList.add('ShowTransition');\r\n  divFeedback.ElementHandle.classList.remove('HideTransition');\r\nend;\r\n\r\nprocedure TForm1.btnSubmitFeedbackClick(Sender: TObject);\r\nbegin\r\n  divFeedback.ElementHandle.classList.add('HideTransition');\r\n  divFeedback.ElementHandle.classList.remove('ShowTransition');\r\n  divAbout.ElementHandle.classList.add('HideTransition');\r\n  divAbout.ElementHandle.classList.remove('ShowTransition');\r\n  divMain.ElementHandle.classList.add('ShowTransition');\r\n  divMain.ElementHandle.classList.remove('HideTransition');\r\nend;\r\n\r\nprocedure TForm1.WebFormCreate(Sender: TObject);\r\nvar\r\n  AppVer: String;\r\n  AppRel: String;\r\nbegin\r\n  // Output Version Information\r\n  asm\r\n    AppVer = ProjectName;\r\n    AppRel = document.lastModified;\r\n  end;\r\n  console.log('AppVersion: '+AppVer);\r\n  console.log('AppRelease: '+AppRel);\r\n  console.log('TMSWEBCore: '+Application.Version);\r\n\r\n  // Display in the UI in case nothing else is loaded\r\n  divAboutContent.HTML.Text := '<div>'+\r\n                                 'AppVersion: '+AppVer+'<br />'+\r\n                                 'AppRelease: '+AppRel+'<br />'+\r\n                                 'TMSWEBCore: '+Application.Version+\r\n                               '</div>';\r\n\r\n  // Just keeping track of where things are at for the main form\r\n  MainState := 'Start';\r\n\r\n  // Where are we at in the actual survey\r\n  SurveyState := 'Initializing';\r\n\r\n\r\n\r\n\r\n  // We're ready to go\r\n  if SurveyState <> 'Initializing' then\r\n  begin\r\n    btnNext.Enabled := True;\r\n    btnNext.Caption := '<i class=\"fa-solid '+\r\n                               'fa-circle-right '+\r\n                               'fa-2x fa-beat-fade\" '+\r\n                               'style=\"--fa-beat-fade-opacity: 0.7; '+\r\n                                      '--fa-beat-fade-scale: 1.2; '+\r\n                                      '--fa-animation-duration: 2s;'+\r\n                                      'font-size: 42px; '+\r\n                                      'margin-top: -4px; '+\r\n                                      'margin-left: -8px; '+\r\n                       '\"></i>';\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TForm1.WebFormResize(Sender: TObject);\r\nvar\r\n  PageWidth: Integer;\r\n  PageHeight: Integer;\r\nconst\r\n  MaxWidth = 510;\r\n  MaxHeight = 910;\r\n  MainMargin = 5;\r\nbegin\r\n  PageWidth := Form1.Width;\r\n  PageHeight := Form1.Height;\r\n\r\n  divMain.Height := min(PageHeight, MaxHeight) - 2*(MainMargin);\r\n  divMain.Width := min(PageWidth, MaxWidth) - 2*(MainMargin);\r\n  divMain.Top := (PageHeight - divMain.Height) div 2;\r\n  divMain.Left := (PageWidth - divMain.Width) div 2;\r\n\r\n  divFeedback.Width := divMain.Width;\r\n  divFeedback.Height := divMain.Height;\r\n  divFeedback.Top := divMain.Top;\r\n  divFeedback.Left := divMain.Left;\r\n\r\n  divAbout.Width := divMain.Width;\r\n  divAbout.Height := divMain.Height;\r\n  divAbout.Top := divMain.Top;\r\n  divAbout.Left := divMain.Left;\r\n\r\n  if (MainState = 'Start') then\r\n  begin\r\n    divFeedback.ElementHandle.style.setProperty('opacity', '0');\r\n    divFeedback.ElementHandle.style.setProperty('pointer-events', 'none');\r\n    divAbout.ElementHandle.style.setProperty('opacity', '0');\r\n    divAbout.ElementHandle.style.setProperty('pointer-events', 'none');\r\n    MainState := 'Open';\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TForm1.LoadDFMValues;\r\nbegin\r\n  inherited LoadDFMValues;\r\n\r\n  divMain := THTMLDiv.Create('divMain');\r\n  divFooter := THTMLDiv.Create('divFooter');\r\n  btnPrevious := TButton.Create('btnPrevious');\r\n  btnNext := TButton.Create('btnNext');\r\n  divSubTitle := THTMLDiv.Create('divSubtitle');\r\n  divHeader := THTMLDiv.Create('divHeader');\r\n  divTitle := THTMLDiv.Create('divTitle');\r\n  btnAbout := TButton.Create('btnAbout');\r\n  btnMessage := TButton.Create('btnMessage');\r\n  divMiddle := THTMLDiv.Create('divMiddle');\r\n  divAbout := THTMLDiv.Create('divAbout');\r\n  divAboutHeader := THTMLDiv.Create('divAboutHeader');\r\n  divAboutTitle := THTMLDiv.Create('divTitle');\r\n  btnAboutAbout := TButton.Create('btnAboutAbout');\r\n  btnAboutMessage := TButton.Create('btnAboutMessage');\r\n  divAboutFooter := THTMLDiv.Create('divBottomFeedback');\r\n  btnAboutOK := TButton.Create('btnAboutOK');\r\n  divAboutContent := THTMLDiv.Create('divAboutContent');\r\n  divFeedback := THTMLDiv.Create('divFeedback');\r\n  divFeedbackHeader := THTMLDiv.Create('divFeedbackHeader');\r\n  divFeedbackTitle := THTMLDiv.Create('divTitle');\r\n  btnFeedbackAbout := TButton.Create('btnAbout');\r\n  btnFeedbackFeedback := TButton.Create('btnMessage');\r\n  divBottomFeedback := THTMLDiv.Create('divBottomFeedback');\r\n  btnSubmitFeedback := TButton.Create('btnSubmitFeedback');\r\n  btnCancelFeedback := TButton.Create('btnCancelFeedback');\r\n  divFeedbackForm := THTMLDiv.Create('divFeedbackForm');\r\n\r\n  divMain.BeforeLoadDFMValues;\r\n  divFooter.BeforeLoadDFMValues;\r\n  btnPrevious.BeforeLoadDFMValues;\r\n  btnNext.BeforeLoadDFMValues;\r\n  divSubTitle.BeforeLoadDFMValues;\r\n  divHeader.BeforeLoadDFMValues;\r\n  divTitle.BeforeLoadDFMValues;\r\n  btnAbout.BeforeLoadDFMValues;\r\n  btnMessage.BeforeLoadDFMValues;\r\n  divMiddle.BeforeLoadDFMValues;\r\n  divAbout.BeforeLoadDFMValues;\r\n  divAboutHeader.BeforeLoadDFMValues;\r\n  divAboutTitle.BeforeLoadDFMValues;\r\n  btnAboutAbout.BeforeLoadDFMValues;\r\n  btnAboutMessage.BeforeLoadDFMValues;\r\n  divAboutFooter.BeforeLoadDFMValues;\r\n  btnAboutOK.BeforeLoadDFMValues;\r\n  divAboutContent.BeforeLoadDFMValues;\r\n  divFeedback.BeforeLoadDFMValues;\r\n  divFeedbackHeader.BeforeLoadDFMValues;\r\n  divFeedbackTitle.BeforeLoadDFMValues;\r\n  btnFeedbackAbout.BeforeLoadDFMValues;\r\n  btnFeedbackFeedback.BeforeLoadDFMValues;\r\n  divBottomFeedback.BeforeLoadDFMValues;\r\n  btnSubmitFeedback.BeforeLoadDFMValues;\r\n  btnCancelFeedback.BeforeLoadDFMValues;\r\n  divFeedbackForm.BeforeLoadDFMValues;\r\n  try\r\n    Name := 'Form1';\r\n    Width := 960;\r\n    Height := 469;\r\n    ElementFont := efCSS;\r\n    SetEvent(Self, 'OnCreate', 'WebFormCreate');\r\n    SetEvent(Self, 'OnResize', 'WebFormResize');\r\n    SetEvent(Self, 'OnShow', 'WebFormResize');\r\n    divMain.SetParentComponent(Self);\r\n    divMain.Name := 'divMain';\r\n    divMain.Left := 8;\r\n    divMain.Top := 8;\r\n    divMain.Width := 300;\r\n    divMain.Height := 449;\r\n    divMain.ElementClassName := 'rounded border border-primary bg-light';\r\n    divMain.Role := '';\r\n    divFooter.SetParentComponent(divMain);\r\n    divFooter.Name := 'divFooter';\r\n    divFooter.AlignWithMargins := True;\r\n    divFooter.Left := 4;\r\n    divFooter.Top := 401;\r\n    divFooter.Width := 292;\r\n    divFooter.Height := 44;\r\n    divFooter.Margins.Left := 4;\r\n    divFooter.Margins.Top := 4;\r\n    divFooter.Margins.Right := 4;\r\n    divFooter.Margins.Bottom := 4;\r\n    divFooter.Align := alBottom;\r\n    divFooter.ChildOrder := 1;\r\n    divFooter.ElementFont := efCSS;\r\n    divFooter.Role := '';\r\n    btnPrevious.SetParentComponent(divFooter);\r\n    btnPrevious.Name := 'btnPrevious';\r\n    btnPrevious.Left := 0;\r\n    btnPrevious.Top := 0;\r\n    btnPrevious.Width := 44;\r\n    btnPrevious.Height := 44;\r\n    btnPrevious.Align := alLeft;\r\n    btnPrevious.Caption := '<i class=\"fa-solid fa-circle-left fa-2x\" style=\"font-size:42px; margin-top:-4px; margin-left:-8px;\"></i>';\r\n    btnPrevious.ElementClassName := 'btn btn-light btn-sm text-primary rounded-circle';\r\n    btnPrevious.ElementFont := efCSS;\r\n    btnPrevious.Enabled := False;\r\n    btnPrevious.HeightPercent := 100.000000000000000000;\r\n    btnPrevious.WidthPercent := 100.000000000000000000;\r\n    btnNext.SetParentComponent(divFooter);\r\n    btnNext.Name := 'btnNext';\r\n    btnNext.Left := 248;\r\n    btnNext.Top := 0;\r\n    btnNext.Width := 44;\r\n    btnNext.Height := 44;\r\n    btnNext.Align := alRight;\r\n    btnNext.Caption := '<i class=\"fa-solid fa-circle-right fa-2x\" style=\"font-size:42px; margin-top:-4px; margin-left:-8px;\"></i>';\r\n    btnNext.ChildOrder := 2;\r\n    btnNext.ElementClassName := 'btn btn-light btn-sm text-primary rounded-circle';\r\n    btnNext.ElementFont := efCSS;\r\n    btnNext.Enabled := False;\r\n    btnNext.HeightPercent := 100.000000000000000000;\r\n    btnNext.WidthPercent := 100.000000000000000000;\r\n    divSubTitle.SetParentComponent(divFooter);\r\n    divSubTitle.Name := 'divSubTitle';\r\n    divSubTitle.AlignWithMargins := True;\r\n    divSubTitle.Left := 48;\r\n    divSubTitle.Top := 0;\r\n    divSubTitle.Width := 196;\r\n    divSubTitle.Height := 44;\r\n    divSubTitle.Margins.Left := 4;\r\n    divSubTitle.Margins.Top := 0;\r\n    divSubTitle.Margins.Right := 4;\r\n    divSubTitle.Margins.Bottom := 0;\r\n    divSubTitle.ElementClassName := 'SubTitle rounded border border-primary bg-white d-flex align-items-center justify-content-center';\r\n    divSubTitle.Align := alClient;\r\n    divSubTitle.ChildOrder := 1;\r\n    divSubTitle.ElementFont := efCSS;\r\n    divSubTitle.HTML.BeginUpdate;\r\n    try\r\n      divSubTitle.HTML.Clear;\r\n      divSubTitle.HTML.Add('Check Survey Link');\r\n    finally\r\n      divSubTitle.HTML.EndUpdate;\r\n    end;\r\n    divSubTitle.Role := '';\r\n    divHeader.SetParentComponent(divMain);\r\n    divHeader.Name := 'divHeader';\r\n    divHeader.AlignWithMargins := True;\r\n    divHeader.Left := 4;\r\n    divHeader.Top := 4;\r\n    divHeader.Width := 292;\r\n    divHeader.Height := 44;\r\n    divHeader.Margins.Left := 4;\r\n    divHeader.Margins.Top := 4;\r\n    divHeader.Margins.Right := 4;\r\n    divHeader.Margins.Bottom := 4;\r\n    divHeader.Align := alTop;\r\n    divHeader.ElementFont := efCSS;\r\n    divHeader.Role := '';\r\n    divTitle.SetParentComponent(divHeader);\r\n    divTitle.Name := 'divTitle';\r\n    divTitle.AlignWithMargins := True;\r\n    divTitle.Left := 48;\r\n    divTitle.Top := 0;\r\n    divTitle.Width := 196;\r\n    divTitle.Height := 44;\r\n    divTitle.Margins.Left := 4;\r\n    divTitle.Margins.Top := 0;\r\n    divTitle.Margins.Right := 4;\r\n    divTitle.Margins.Bottom := 0;\r\n    divTitle.ElementClassName := 'Title rounded border border-primary bg-white d-flex align-items-center justify-content-center';\r\n    divTitle.Align := alClient;\r\n    divTitle.ElementFont := efCSS;\r\n    divTitle.HTML.BeginUpdate;\r\n    try\r\n      divTitle.HTML.Clear;\r\n      divTitle.HTML.Add('No Survey Specified');\r\n    finally\r\n      divTitle.HTML.EndUpdate;\r\n    end;\r\n    divTitle.Role := '';\r\n    btnAbout.SetParentComponent(divHeader);\r\n    btnAbout.Name := 'btnAbout';\r\n    btnAbout.Left := 0;\r\n    btnAbout.Top := 0;\r\n    btnAbout.Width := 44;\r\n    btnAbout.Height := 44;\r\n    btnAbout.Hint := 'About';\r\n    btnAbout.Align := alLeft;\r\n    btnAbout.Caption := '<i class=\"fa-solid fa-chart-simple fa-fw fa-2x\"></i>';\r\n    btnAbout.ChildOrder := 1;\r\n    btnAbout.ElementClassName := 'btn btn-primary btn-sm text-white d-flex justify-content-center align-items-center';\r\n    btnAbout.ElementFont := efCSS;\r\n    btnAbout.HeightPercent := 100.000000000000000000;\r\n    btnAbout.WidthPercent := 100.000000000000000000;\r\n    SetEvent(btnAbout, Self, 'OnClick', 'btnAboutClick');\r\n    btnMessage.SetParentComponent(divHeader);\r\n    btnMessage.Name := 'btnMessage';\r\n    btnMessage.Left := 248;\r\n    btnMessage.Top := 0;\r\n    btnMessage.Width := 44;\r\n    btnMessage.Height := 44;\r\n    btnMessage.Hint := 'Feedback';\r\n    btnMessage.Align := alRight;\r\n    btnMessage.Caption := '<i class=\"fa-solid fa-message fa-fw fa-2x\"></i>';\r\n    btnMessage.ChildOrder := 2;\r\n    btnMessage.ElementClassName := 'btn btn-primary btn-sm text-white d-flex justify-content-center align-items-center';\r\n    btnMessage.ElementFont := efCSS;\r\n    btnMessage.HeightPercent := 100.000000000000000000;\r\n    btnMessage.WidthPercent := 100.000000000000000000;\r\n    SetEvent(btnMessage, Self, 'OnClick', 'btnMessageClick');\r\n    divMiddle.SetParentComponent(divMain);\r\n    divMiddle.Name := 'divMiddle';\r\n    divMiddle.AlignWithMargins := True;\r\n    divMiddle.Left := 4;\r\n    divMiddle.Top := 52;\r\n    divMiddle.Width := 292;\r\n    divMiddle.Height := 345;\r\n    divMiddle.Margins.Left := 4;\r\n    divMiddle.Margins.Top := 0;\r\n    divMiddle.Margins.Right := 4;\r\n    divMiddle.Margins.Bottom := 0;\r\n    divMiddle.ElementClassName := 'Content';\r\n    divMiddle.Align := alClient;\r\n    divMiddle.ChildOrder := 2;\r\n    divMiddle.ElementFont := efCSS;\r\n    divMiddle.HTML.BeginUpdate;\r\n    try\r\n      divMiddle.HTML.Clear;\r\n      divMiddle.HTML.Add('<div class=\"rounded border border-primary bg-white d-flex align-items-center justify-content-center\">');\r\n      divMiddle.HTML.Add('  <div class=\"mx-3\">');\r\n      divMiddle.HTML.Add('    <p>Sorry!</p>');\r\n      divMiddle.HTML.Add('    <p>No survey was found using the information in the link provided.<br />');\r\n      divMiddle.HTML.Add('    <p>The survey may have been updated to use a new link, or the survey may have been removed.</p>');\r\n      divMiddle.HTML.Add('    <p>Please contact the survey provider for more information.</p>');\r\n      divMiddle.HTML.Add('  </div>');\r\n      divMiddle.HTML.Add('</div>');\r\n      divMiddle.HTML.Add('');\r\n    finally\r\n      divMiddle.HTML.EndUpdate;\r\n    end;\r\n    divMiddle.Role := '';\r\n    divAbout.SetParentComponent(Self);\r\n    divAbout.Name := 'divAbout';\r\n    divAbout.Left := 326;\r\n    divAbout.Top := 8;\r\n    divAbout.Width := 300;\r\n    divAbout.Height := 449;\r\n    divAbout.ElementClassName := 'rounded border border-primary bg-light';\r\n    divAbout.ChildOrder := 1;\r\n    divAbout.ElementFont := efCSS;\r\n    divAbout.Role := '';\r\n    divAboutHeader.SetParentComponent(divAbout);\r\n    divAboutHeader.Name := 'divAboutHeader';\r\n    divAboutHeader.AlignWithMargins := True;\r\n    divAboutHeader.Left := 4;\r\n    divAboutHeader.Top := 4;\r\n    divAboutHeader.Width := 292;\r\n    divAboutHeader.Height := 44;\r\n    divAboutHeader.Margins.Left := 4;\r\n    divAboutHeader.Margins.Top := 4;\r\n    divAboutHeader.Margins.Right := 4;\r\n    divAboutHeader.Margins.Bottom := 4;\r\n    divAboutHeader.Align := alTop;\r\n    divAboutHeader.ElementFont := efCSS;\r\n    divAboutHeader.Role := '';\r\n    divAboutTitle.SetParentComponent(divAboutHeader);\r\n    divAboutTitle.Name := 'divAboutTitle';\r\n    divAboutTitle.AlignWithMargins := True;\r\n    divAboutTitle.Left := 48;\r\n    divAboutTitle.Top := 0;\r\n    divAboutTitle.Width := 196;\r\n    divAboutTitle.Height := 44;\r\n    divAboutTitle.Margins.Left := 4;\r\n    divAboutTitle.Margins.Top := 0;\r\n    divAboutTitle.Margins.Right := 4;\r\n    divAboutTitle.Margins.Bottom := 0;\r\n    divAboutTitle.ElementClassName := 'Title rounded border border-primary bg-white d-flex align-items-center justify-content-center';\r\n    divAboutTitle.Align := alClient;\r\n    divAboutTitle.ElementFont := efCSS;\r\n    divAboutTitle.HTML.BeginUpdate;\r\n    try\r\n      divAboutTitle.HTML.Clear;\r\n      divAboutTitle.HTML.Add('About SurveyApp');\r\n    finally\r\n      divAboutTitle.HTML.EndUpdate;\r\n    end;\r\n    divAboutTitle.Role := '';\r\n    btnAboutAbout.SetParentComponent(divAboutHeader);\r\n    btnAboutAbout.Name := 'btnAboutAbout';\r\n    btnAboutAbout.Left := 0;\r\n    btnAboutAbout.Top := 0;\r\n    btnAboutAbout.Width := 44;\r\n    btnAboutAbout.Height := 44;\r\n    btnAboutAbout.Hint := 'About';\r\n    btnAboutAbout.Align := alLeft;\r\n    btnAboutAbout.Caption := '<i class=\"fa-solid fa-chart-simple fa-fw fa-2x\"></i>';\r\n    btnAboutAbout.ChildOrder := 1;\r\n    btnAboutAbout.ElementClassName := 'pe-none btn btn-primary btn-sm text-white d-flex justify-content-center align-items-center';\r\n    btnAboutAbout.ElementFont := efCSS;\r\n    btnAboutAbout.HeightPercent := 100.000000000000000000;\r\n    btnAboutAbout.WidthPercent := 100.000000000000000000;\r\n    SetEvent(btnAboutAbout, Self, 'OnClick', 'btnAboutClick');\r\n    btnAboutMessage.SetParentComponent(divAboutHeader);\r\n    btnAboutMessage.Name := 'btnAboutMessage';\r\n    btnAboutMessage.Left := 248;\r\n    btnAboutMessage.Top := 0;\r\n    btnAboutMessage.Width := 44;\r\n    btnAboutMessage.Height := 44;\r\n    btnAboutMessage.Hint := 'Feedback';\r\n    btnAboutMessage.Align := alRight;\r\n    btnAboutMessage.Caption := '<i class=\"fa-solid fa-message fa-fw fa-2x\"></i>';\r\n    btnAboutMessage.ChildOrder := 2;\r\n    btnAboutMessage.ElementClassName := 'btn btn-primary btn-sm text-white d-flex justify-content-center align-items-center';\r\n    btnAboutMessage.ElementFont := efCSS;\r\n    btnAboutMessage.HeightPercent := 100.000000000000000000;\r\n    btnAboutMessage.WidthPercent := 100.000000000000000000;\r\n    SetEvent(btnAboutMessage, Self, 'OnClick', 'btnMessageClick');\r\n    divAboutFooter.SetParentComponent(divAbout);\r\n    divAboutFooter.Name := 'divAboutFooter';\r\n    divAboutFooter.AlignWithMargins := True;\r\n    divAboutFooter.Left := 4;\r\n    divAboutFooter.Top := 399;\r\n    divAboutFooter.Width := 292;\r\n    divAboutFooter.Height := 44;\r\n    divAboutFooter.Margins.Left := 4;\r\n    divAboutFooter.Margins.Top := 4;\r\n    divAboutFooter.Margins.Right := 4;\r\n    divAboutFooter.Margins.Bottom := 6;\r\n    divAboutFooter.ElementClassName := 'd-flex justify-content-center';\r\n    divAboutFooter.Align := alBottom;\r\n    divAboutFooter.ChildOrder := 1;\r\n    divAboutFooter.ElementFont := efCSS;\r\n    divAboutFooter.Role := '';\r\n    btnAboutOK.SetParentComponent(divAboutFooter);\r\n    btnAboutOK.Name := 'btnAboutOK';\r\n    btnAboutOK.Left := 97;\r\n    btnAboutOK.Top := 0;\r\n    btnAboutOK.Width := 97;\r\n    btnAboutOK.Height := 44;\r\n    btnAboutOK.Caption := '<div style=\"font-size:16px;\" class=\"ms-2 me-2\"><i class=\"fa-solid fa-thumbs-up fa-xl me-1\"></i> Got It!</div>';\r\n    btnAboutOK.ElementClassName := 'btn btn-sm btn-primary me-1';\r\n    btnAboutOK.ElementFont := efCSS;\r\n    btnAboutOK.ElementPosition := epIgnore;\r\n    btnAboutOK.HeightPercent := 100.000000000000000000;\r\n    btnAboutOK.WidthStyle := ssAuto;\r\n    btnAboutOK.WidthPercent := 100.000000000000000000;\r\n    SetEvent(btnAboutOK, Self, 'OnClick', 'btnAboutOKClick');\r\n    divAboutContent.SetParentComponent(divAbout);\r\n    divAboutContent.Name := 'divAboutContent';\r\n    divAboutContent.AlignWithMargins := True;\r\n    divAboutContent.Left := 4;\r\n    divAboutContent.Top := 52;\r\n    divAboutContent.Width := 292;\r\n    divAboutContent.Height := 343;\r\n    divAboutContent.Margins.Left := 4;\r\n    divAboutContent.Margins.Top := 0;\r\n    divAboutContent.Margins.Right := 4;\r\n    divAboutContent.Margins.Bottom := 0;\r\n    divAboutContent.ElementClassName := 'About rounded border border-primary bg-white d-flex align-items-center justify-content-center';\r\n    divAboutContent.Align := alClient;\r\n    divAboutContent.ChildOrder := 2;\r\n    divAboutContent.Role := '';\r\n    divFeedback.SetParentComponent(Self);\r\n    divFeedback.Name := 'divFeedback';\r\n    divFeedback.Left := 646;\r\n    divFeedback.Top := 8;\r\n    divFeedback.Width := 300;\r\n    divFeedback.Height := 449;\r\n    divFeedback.ElementClassName := 'rounded border border-primary bg-light';\r\n    divFeedback.ChildOrder := 1;\r\n    divFeedback.ElementFont := efCSS;\r\n    divFeedback.Role := '';\r\n    divFeedbackHeader.SetParentComponent(divFeedback);\r\n    divFeedbackHeader.Name := 'divFeedbackHeader';\r\n    divFeedbackHeader.AlignWithMargins := True;\r\n    divFeedbackHeader.Left := 4;\r\n    divFeedbackHeader.Top := 4;\r\n    divFeedbackHeader.Width := 292;\r\n    divFeedbackHeader.Height := 44;\r\n    divFeedbackHeader.Margins.Left := 4;\r\n    divFeedbackHeader.Margins.Top := 4;\r\n    divFeedbackHeader.Margins.Right := 4;\r\n    divFeedbackHeader.Margins.Bottom := 4;\r\n    divFeedbackHeader.Align := alTop;\r\n    divFeedbackHeader.ElementFont := efCSS;\r\n    divFeedbackHeader.Role := '';\r\n    divFeedbackTitle.SetParentComponent(divFeedbackHeader);\r\n    divFeedbackTitle.Name := 'divFeedbackTitle';\r\n    divFeedbackTitle.AlignWithMargins := True;\r\n    divFeedbackTitle.Left := 48;\r\n    divFeedbackTitle.Top := 0;\r\n    divFeedbackTitle.Width := 196;\r\n    divFeedbackTitle.Height := 44;\r\n    divFeedbackTitle.Margins.Left := 4;\r\n    divFeedbackTitle.Margins.Top := 0;\r\n    divFeedbackTitle.Margins.Right := 4;\r\n    divFeedbackTitle.Margins.Bottom := 0;\r\n    divFeedbackTitle.ElementClassName := 'Title rounded border border-primary bg-white d-flex align-items-center justify-content-center';\r\n    divFeedbackTitle.Align := alClient;\r\n    divFeedbackTitle.ElementFont := efCSS;\r\n    divFeedbackTitle.HTML.BeginUpdate;\r\n    try\r\n      divFeedbackTitle.HTML.Clear;\r\n      divFeedbackTitle.HTML.Add('Feedback');\r\n    finally\r\n      divFeedbackTitle.HTML.EndUpdate;\r\n    end;\r\n    divFeedbackTitle.Role := '';\r\n    btnFeedbackAbout.SetParentComponent(divFeedbackHeader);\r\n    btnFeedbackAbout.Name := 'btnFeedbackAbout';\r\n    btnFeedbackAbout.Left := 0;\r\n    btnFeedbackAbout.Top := 0;\r\n    btnFeedbackAbout.Width := 44;\r\n    btnFeedbackAbout.Height := 44;\r\n    btnFeedbackAbout.Hint := 'About';\r\n    btnFeedbackAbout.Align := alLeft;\r\n    btnFeedbackAbout.Caption := '<i class=\"fa-solid fa-chart-simple fa-fw fa-2x\"></i>';\r\n    btnFeedbackAbout.ChildOrder := 1;\r\n    btnFeedbackAbout.ElementClassName := 'btn btn-primary btn-sm text-white d-flex justify-content-center align-items-center';\r\n    btnFeedbackAbout.ElementFont := efCSS;\r\n    btnFeedbackAbout.HeightPercent := 100.000000000000000000;\r\n    btnFeedbackAbout.WidthPercent := 100.000000000000000000;\r\n    SetEvent(btnFeedbackAbout, Self, 'OnClick', 'btnAboutClick');\r\n    btnFeedbackFeedback.SetParentComponent(divFeedbackHeader);\r\n    btnFeedbackFeedback.Name := 'btnFeedbackFeedback';\r\n    btnFeedbackFeedback.Left := 248;\r\n    btnFeedbackFeedback.Top := 0;\r\n    btnFeedbackFeedback.Width := 44;\r\n    btnFeedbackFeedback.Height := 44;\r\n    btnFeedbackFeedback.Hint := 'Feedback';\r\n    btnFeedbackFeedback.Align := alRight;\r\n    btnFeedbackFeedback.Caption := '<i class=\"fa-solid fa-message fa-fw fa-2x\"></i>';\r\n    btnFeedbackFeedback.ChildOrder := 2;\r\n    btnFeedbackFeedback.ElementClassName := 'pe-none btn btn-primary btn-sm text-white d-flex justify-content-center align-items-center';\r\n    btnFeedbackFeedback.ElementFont := efCSS;\r\n    btnFeedbackFeedback.HeightPercent := 100.000000000000000000;\r\n    btnFeedbackFeedback.WidthPercent := 100.000000000000000000;\r\n    SetEvent(btnFeedbackFeedback, Self, 'OnClick', 'btnMessageClick');\r\n    divBottomFeedback.SetParentComponent(divFeedback);\r\n    divBottomFeedback.Name := 'divBottomFeedback';\r\n    divBottomFeedback.AlignWithMargins := True;\r\n    divBottomFeedback.Left := 4;\r\n    divBottomFeedback.Top := 399;\r\n    divBottomFeedback.Width := 292;\r\n    divBottomFeedback.Height := 44;\r\n    divBottomFeedback.Margins.Left := 4;\r\n    divBottomFeedback.Margins.Top := 4;\r\n    divBottomFeedback.Margins.Right := 4;\r\n    divBottomFeedback.Margins.Bottom := 6;\r\n    divBottomFeedback.ElementClassName := 'd-flex justify-content-center';\r\n    divBottomFeedback.Align := alBottom;\r\n    divBottomFeedback.ChildOrder := 1;\r\n    divBottomFeedback.ElementFont := efCSS;\r\n    divBottomFeedback.Role := '';\r\n    btnSubmitFeedback.SetParentComponent(divBottomFeedback);\r\n    btnSubmitFeedback.Name := 'btnSubmitFeedback';\r\n    btnSubmitFeedback.Left := 33;\r\n    btnSubmitFeedback.Top := 0;\r\n    btnSubmitFeedback.Width := 97;\r\n    btnSubmitFeedback.Height := 44;\r\n    btnSubmitFeedback.Caption := '<div style=\"font-size:16px;\" class=\"ms-1 me-2\"><i class=\"fa-solid fa-paper-plane fa-xl me-1\"></i> Submit Feedback</div>';\r\n    btnSubmitFeedback.ElementClassName := 'btn btn-sm btn-primary me-1';\r\n    btnSubmitFeedback.ElementFont := efCSS;\r\n    btnSubmitFeedback.ElementPosition := epIgnore;\r\n    btnSubmitFeedback.HeightPercent := 100.000000000000000000;\r\n    btnSubmitFeedback.WidthStyle := ssAuto;\r\n    btnSubmitFeedback.WidthPercent := 100.000000000000000000;\r\n    SetEvent(btnSubmitFeedback, Self, 'OnClick', 'btnSubmitFeedbackClick');\r\n    btnCancelFeedback.SetParentComponent(divBottomFeedback);\r\n    btnCancelFeedback.Name := 'btnCancelFeedback';\r\n    btnCancelFeedback.Left := 136;\r\n    btnCancelFeedback.Top := 0;\r\n    btnCancelFeedback.Width := 100;\r\n    btnCancelFeedback.Height := 44;\r\n    btnCancelFeedback.Caption := '<div style=\"font-size:16px;\"  class=\"ms-1 me-2\"><i class=\"fa-solid fa-cross fa-xmark me-1 fa-xl\"></i> Cancel Feedback</div>';\r\n    btnCancelFeedback.ChildOrder := 2;\r\n    btnCancelFeedback.ElementClassName := 'btn btn-sm btn-danger ms-1';\r\n    btnCancelFeedback.ElementFont := efCSS;\r\n    btnCancelFeedback.ElementPosition := epIgnore;\r\n    btnCancelFeedback.HeightPercent := 100.000000000000000000;\r\n    btnCancelFeedback.WidthStyle := ssAuto;\r\n    btnCancelFeedback.WidthPercent := 100.000000000000000000;\r\n    SetEvent(btnCancelFeedback, Self, 'OnClick', 'btnCancelFeedbackClick');\r\n    divFeedbackForm.SetParentComponent(divFeedback);\r\n    divFeedbackForm.Name := 'divFeedbackForm';\r\n    divFeedbackForm.AlignWithMargins := True;\r\n    divFeedbackForm.Left := 4;\r\n    divFeedbackForm.Top := 52;\r\n    divFeedbackForm.Width := 292;\r\n    divFeedbackForm.Height := 343;\r\n    divFeedbackForm.Margins.Left := 4;\r\n    divFeedbackForm.Margins.Top := 0;\r\n    divFeedbackForm.Margins.Right := 4;\r\n    divFeedbackForm.Margins.Bottom := 0;\r\n    divFeedbackForm.ElementClassName := 'Feedback rounded border border-primary bg-white d-flex align-items-center justify-content-center';\r\n    divFeedbackForm.Align := alClient;\r\n    divFeedbackForm.ChildOrder := 2;\r\n    divFeedbackForm.Role := '';\r\n  finally\r\n    divMain.AfterLoadDFMValues;\r\n    divFooter.AfterLoadDFMValues;\r\n    btnPrevious.AfterLoadDFMValues;\r\n    btnNext.AfterLoadDFMValues;\r\n    divSubTitle.AfterLoadDFMValues;\r\n    divHeader.AfterLoadDFMValues;\r\n    divTitle.AfterLoadDFMValues;\r\n    btnAbout.AfterLoadDFMValues;\r\n    btnMessage.AfterLoadDFMValues;\r\n    divMiddle.AfterLoadDFMValues;\r\n    divAbout.AfterLoadDFMValues;\r\n    divAboutHeader.AfterLoadDFMValues;\r\n    divAboutTitle.AfterLoadDFMValues;\r\n    btnAboutAbout.AfterLoadDFMValues;\r\n    btnAboutMessage.AfterLoadDFMValues;\r\n    divAboutFooter.AfterLoadDFMValues;\r\n    btnAboutOK.AfterLoadDFMValues;\r\n    divAboutContent.AfterLoadDFMValues;\r\n    divFeedback.AfterLoadDFMValues;\r\n    divFeedbackHeader.AfterLoadDFMValues;\r\n    divFeedbackTitle.AfterLoadDFMValues;\r\n    btnFeedbackAbout.AfterLoadDFMValues;\r\n    btnFeedbackFeedback.AfterLoadDFMValues;\r\n    divBottomFeedback.AfterLoadDFMValues;\r\n    btnSubmitFeedback.AfterLoadDFMValues;\r\n    btnCancelFeedback.AfterLoadDFMValues;\r\n    divFeedbackForm.AfterLoadDFMValues;\r\n  end;\r\nend;\r\n\r\nend.\r\n","program Project1;\r\n\r\n{$R *.dres}\r\n\r\nuses\r\n  Vcl.Forms,\r\n  WEBLib.Forms,\r\n  Unit1 in 'Unit1.pas'{*.html};\r\n\r\n{$R *.res}\r\n\r\nbegin\r\n  Application.Initialize;\r\n  Application.MainFormOnTaskbar := True;\r\n  Application.CreateForm(TForm1, Form1);\r\n  Application.Run;\r\nend.\r\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACz/CA;;;;AAaY,oBAAG;AACH,oBAAG;AAIb,mBAAmB;AACW;AAA9B,kCAAyC,cAAC,EAAD;AACf;AAA1B,8BAAqC,cAAC,EAAD;AACrC,4BAA4B;AAGjB,qBAAG;AACH,qBAAG,CAAC;AACJ,qBAAG;AACH,qBAAG,CAAC;AACR,iBAAG;AACH,iBAAG;AACA,oBAAI;AACH,qBAAY;AAEjB,gBAAG;AACI,uBAAG;AAyBZ;AACI;AAEC;AACJ,gCADI,wBACJ;AACA,gCAFI,wBAEJ;AAIC;AACD;AAED;AAKM;AAKS;;AAEL;;AAGC,qCAHD,sCAGC;AAQV;AACH;AACA;AACA;AAHG;;aAIH;AAJG;;;aACH,kBACA,IAAA,kBACA,IAAA,kBACA,6BAFA;AAFG;;AACH;AACA;AACA;AACA;AAJG;;;AACH;AACA;AACA;AACS,iDAAE,CAAF;AAAT,qBAAS,wBAAT;AAJG;AAMM;AAEJ,mCACA,+BADA;AACA;AACL;AACA;AAFK;aACL,sBACA;AAFK;;AACL;AACA;AAFK;;;AACL;AACA;AAFK;AAWA;AAND,iCAMC,mCAND;AAMC;;;;;AAuwBiB;AAAC;AAAD;AAKA;;AAKJ;AAEpB;AAFoB;AAKU;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;;AA4jK8B;AAE/C;AAF+C;AAuVL;AAE1C;AAF0C;AAlVc;AAExD;AACA;AACA;AAJwD;AAOL;AAEnD;AACA;AACA;AAJmD;AAOE;AAErD;AACA;AAHqD;AAMC;AAAvB;AAE7B,eAAU;AAEV,UAAG,cAAS,CAAC,OAAD,CAAU,KAAE,OAAxB,EACE,SAAU,eADZ;AAJ6B;AAAuB;AAU/C,gBAAG;AACI,uBAAG;AAHsC;AAAxB;AAK7B;AACA;AAEA,YAAc;AAEd,gBAAkB,gCAAP;;;;UAAO;AAElB,eAAiB,gCAAP;;;;WAAgB,KAAT;AAEjB,UAAG,MAAO,IAAG,CAAb;AAEE,kBAAkB,oCAAP;;;;aAAkB,EAAG,MAAd,CAAsB,GAA2B,gCAAR,CAAV,qCAAP;;;;eAAkB,MAAX,GAAU;;;;YAAQ,CAA3B;;AAIxC,YAAU,kCAAP;;;;YAAO,CAAQ,KAAE,CAApB,EACE,UAAW,OAAgB,GAAN,KAAF,GAAiB,gCAAP;;;;YAAO,CADtC;;AAKJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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CnB;AADmB;;;AACnB;AADmB;AAQN;;aACb;AADa;;AACb;AADa;;;AACb;AADa;AAQC;AACd;AADc;aACd,sBACA;AAFc;;AACd;AACA;AAFc;;;AACd;AACA;AAFc;AASK;AACnB;AACA;AACA;AAHmB;aACnB,wCACA,IAAA,0CACA,0BADA;AAFmB;;AACnB;AACA;AACA;AAHmB;;;AACnB;AACA,iCH7kBW,6BG6kBX;AACA;AAHmB;AAUR;;aACX;AADW;;AACX;AADW;;;AACX,wBHvsBa,+BGusBb;AADW;AAQD;AACV;AADU;aACV;AADU;;AACV;AADU;;;AACV;AADU;AAQE;AACZ;AACA;AAFY;aACZ,wBACA;AAFY;;AACZ;AACA;AAFY;;;AACZ,wBHtmBW,6BGsmBX;AACA,4BHvmBW,6BGumBX;AAFY;AASA;;aACZ;AADY;;AACZ;AADY;;;AACZ;AADY;AAQK;;aACjB;AADiB;;AACjB;AADiB;;;AACjB;AADiB;AAQC;;aAClB;AADkB;;AAClB;AADkB;;;AAClB;AADkB;AAQD;;aACjB;AADiB;;AACjB;AADiB;;;AACjB,yBAgGU,0BAhGV;AADiB;AAQF;;aACf;AADe;;AACf;AADe;;;AACf,yBAwFU,0BAxFV;AADe;AAQA;AACf;AACA;AAFe;aACf,wBACA;AAFe;;AACf;AACA;AAFe;;;AACf,wBHvpBW,6BGupBX;AACA,4BHxpBW,6BGwpBX;AAFe;AASN;AACT;AADS;aACT;AADS;;AACT;AADS;;;AACT;AADS;AAQM;;aACf;AADe;;AACf;AADe;;;AACf;AADe;AAQP;AACR;AACA;AACA;AAHQ;aACR,sBACA,IAAA,sBACA,0BADA;AAFQ;;AACR;AACA;AACA;AAHQ;;;AACR;AACA,uBHlyBa,+BGkyBb;AACA,uBHnyBa,+BGmyBb;AAHQ;AAUQ;AAChB;AACA;AACA;AAHgB;aAChB,gBACA,IAAA,gBACA,oBADA;AAFgB;;AAChB;AACA;AACA;AAHgB;;;AAChB;AACA;AACA;AAHgB;AAUS,sDAVT,wCAUS;AACjB;AACR;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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BAAI;AACP,qBAAG;AACL,mBAAG;AACH,mBAAG;AACN,gBAAG;AACE,qBAAG;AACF,sBAAG;AACJ,qBAAG;AACH,qBAAG;AACC,yBAAG;AACL,uBAAG;AACD,yBAAG;AACN,sBAAG;AACI,6BAAG;AACb,mBAAG;AACK,2BAAG;AACR,sBAAG;AACJ,qBAAG;AACH,qBAAG;AACR,gBAAG;AACA,mBAAG;AACH,mBAAG;AACK,2BAAG;AACV,oBAAG;AACH,oBAAG;AACL,kBAAG;AACF,mBAAG;AACG,yBAAG;AACd,cAAG;AACH,cAAG;AACH,cAAG;AACH,cAAG;AACH,cAAG;AACH,cAAG;AACH,cAAG;AACH,cAAG;AACH,cAAG;AACF,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACD,iBAAG;AACH,iBAAG;AACH,iBAAG;AACH,iBAAG;AACD,mBAAG;AACL,iBAAG;AACH,iBAAG;AACA,oBAAG;AACR,eAAG;AACE,oBAAG;AACL,kBAAG;AACD,oBAAG;AACF,qBAAG;AACH,qBAAG;AACR,gBAAG;AACD,kBAAG;AACE,uBAAG;AACP,mBAAG;AACJ,kBAAG;AACH,kBAAG;AACE,uBAAG;AACE,4BAAG;AACP,wBAAG;AACL,sBAAG;AACJ,qBAAG;AA1IH;AAwJK,2CA9PN,oCA8PM;AAuDG;AAzBF;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATe;aACf,wBACA,IAAA,0BACA,IAAA,kCACA,IAAA,sCACA,IAAA,4CACA,IAAA,oCACA,IAAA,wCACA,IAAA,kDACA,kCAPA;AAFe;;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATe;;;AACf;AACA,yBA/mHK,qBA+mHL;AACA,6BAhjHS,yBAgjHT;AACA,+BAjjHS,yBAijHT;AACA,kCAlnHK,qBAknHL;AACA,8BAnnHK,qBAmnHL;AACA;AACA;AACA;AATe;AAYK,iDAZL,uCAYK;AACH,6EAAmC,aADhC,oCACgC,EAAkC,YAYrE,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AFjD;OAFF;AAPoC;AAiBH;AAEjC;AACA,oBAAS,GAAT;AACA,qBAAU,GAAV;AAJiC;AAl3BzB;;AAcQ,6BFqDV,uCErDU;AACU;AACP;AACD;AAjBV;AAoBG;;;AAEG,qEAAmB,UbuC1B,2BavC0B,EAAc,mBAAK,kBAAtC;AACD,oEAAmB,UbsCzB,2BatCyB,EAAoB,yBAAvC;AACO,2EAAmB,UbqChC,2BarCgC,EAAiB,uBAAkB,WFwF3D,+CExF2D,CAAtD;AACC,4EAAmB,UboCjC,2BapCiC,EAAiB,uBAAmB,YFuF7D,+CEvF6D,CAAvD;AACC,6EAAmB,UbmClC,2BanCkC,EAAiB,uBAAoB,aFsF/D,+CEtF+D,CAAxD;AACF,2EAAmB,UbkChC,2BalCgC,EAAiB,uBAAkB,WFqF3D,+CErF2D,CAAtD;AACG,8EAAmB,UbiCnC,2BajCmC,EAAiB,uBAAqB,cFoFjE,+CEpFiE,CAAzD;AACN,wEAAmB,UbgC7B,2BahC6B,EAAiB,uBAAe,QFmFrD,+CEnFqD,CAAnD;AAEC;;AACA;;AACD;;AACH;;AACC;;AA+BJ;AA3BO;;;AAEhB;AACA;AACA;AACA;AACA;AACA;AAPgB;;;;;;AAumIuB;AAEzC,uBAAY,OAAO,CAAC,KAAD;AAFsB;AAqCH;AAEtC;AACA;AACA;AAEA,uBAAa;AACb,YAAO,WAAM;AAEb,UAAG,CAAY,CAAC,GAAD,SAAf,EACE,MADF;AAGA,UAAG,cAAU,KAAE,iCAAf;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A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,CAA0C,IAAR,CAArB,+BAAW,UAAU,KAAG,IAAH,CAA1B,IAAuE,CAAhC,+BAAW,UAAS,YAAY,KAAE,4CAAF,CAA/F;AAEE,qBAAU,CAAC,KAAM,+BAAe,cAAC,oBAAD,EAhFqF,IAgF3G;;AAKd;;AATqB;AAcJ;AAAR;AAEP;AAIF;AACA;AACA;AACA;AAGE,aAAU;AAZH;AAAQ;AAeE;AAAV;AAEP;AACA;AAEA,eAAY;AACZ,QAAK;AAGP;AACA;AACA;AACA;AACA;AAGE,QAAG,QAAH,EACE,UAAS,CAAT,CADF;AAGA,aAAU;AAnBH;AAAU;AAsBH;AAAP;AAEP;AAGF;AAEE,aAAU;AAPH;AAAO;AA9ThB,mBAqMc;AAMH,sBAAG;AAED,wBACT,qLAiDqL,GAhDrL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,qLADqL,GAErL,8EADqL;AAIvL;AAEmB;AAAZ;AAEP,eAAU,0BAAa,CAAC,OAAO,KAAI,OAAO,cAAC,4CAAD,CAAnB;AACvB,eAAU,0BAAa,CAAC,OAAO,KAAI,GAAG,cAAC,4CAAD,CAAf;AAHhB;AAAY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;AAAD;AAXF;AAEvB,UAAc,aAAH,eAAP,MAAO,CAAX;AAEE,qBAAiB,OAAP,OAAU,aAAH,CAAY;AAC7B,sBAAkB,OAAP,OAAU,aAAH,CAAY;AAC9B,oBAAgB,OAAP,OAAU,aAAH,CAAY;AAC5B,uBAAmB,OAAP,OAAU,aAAH,CAAY;OALjC;AAFuB;AArvLf;AAeO;AACD;AACE;AACC;AAlBT;AAwBA;;;AAEN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAe;AACf;AACA;AACA;AACA;AAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApIM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqkKwB;AAAhB;AAEhB,eAAgB,WAAC,cAAD;AAFA;AAAgB;AAmDL;AAAX;AAEhB,eAAU,cAAS,CAAC,KAAD;AAFH;AAAW;AAnkGA;AAE3B,UAAI,aAAS,KAAG,MAAhB;AAEE;AACA,wBAAY;AACZ;AACA;AACA,yBAAY,CAAC,IAAD;AACZ;OAPF;AAF2B;AAyOH;AAExB,UAAG,UAAM,KAAG,MAAZ;AAEE,qBAAS;AACT;OAHF;AAFwB;AATI;AA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,2BAAG;AACJ,0BAAG;AACF,2BAAG;AAEH,2BAChB,iBA0Da,GA1DK,EAAD,GACjB,kBADoB,GACD,EAAD,GAClB,QADqB,GACZ,EAAD,GACR,wCADW,GAC8B,EAAD,GACxC,wEAD2C,GAC8B,EAAD,GACxE,SAD2E,GACjE,EAAD,GACT,QADY,GACH,EAAD,GACR,SADW,GACD,EAAD,GACT,MADY,GACL,EAAD,GACN,KADS,GACH,EAAD,GACL,mBADQ,GACY,EAAD,GACnB,kBADsB,GACH,EAAD,GAClB,2CADqB,GACuB,EAAD,GAC3C,KAD8C,GACxC,EAAD,GACL,iBADQ,GACU,EAAD,GACjB,KADoB,GACd,EAAD,GACL,sBADQ,GACe,EAAD,GACtB,yBADyB,GACC,EAAD,GACzB,sBAD4B,GACL,EAAD,GACtB,sBADyB,GACF,EAAD,GACtB,uBADyB,GACD,EAAD,GACvB,eAD0B,GACV,EAAD,GACf,gBADkB,GACD,EAAD,GAChB,uCADmB,GACqB,EAAD,GACvC,KAD0C,GACpC,EAAD,GACL,eADQ,GACQ,EAAD,GACf,KADkB,GACZ,EAAD,GACL,4BADQ,GACqB,EAAD,GAC5B,mBAD+B,GACX,EAAD,GACnB,mBADsB,GACF,EAAD,GACnB,kBADsB,GACH,EAAD,GAClB,KADqB,GACf,EAAD,GACL,iBADQ,GACU,EAAD,GACjB,KADoB,GACd,EAAD,GACL,mBADQ,GACY,EAAD,GACnB,KADsB,GAChB,EAAD,GACL,YADQ,GACK,EAAD,GACZ,KADe,GACT,EAAD,GACL,wBADQ,GACiB,EAAD,GACxB,KAD2B,GACrB,EAAD,GACL,aADQ,GACM,EAAD,GACb,KADgB,GACV,EAAD,GACL,sBADQ,GACe,EAAD,GACtB,gCADyB,GACQ,EAAD,GAChC,KADmC,GAC7B,EAAD,GACL,cADQ,GACO,EAAD,GACd,KADiB,GACX,EAAD,GACL,sBADQ,GACe,EAAD,GACtB,KADyB,GACnB,EAAD,GACL,UADQ,GACG,EAAD,GACV,2BADa,GACe,EAAD,GAC3B,+BAD8B,GACE,EAAD,GAC/B,oCADkC,GACG,EAAD,GAC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"}